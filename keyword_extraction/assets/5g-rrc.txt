4 General
4.1 Introduction
This specification is organised as follows: a) clause 4.2 describes the RRC protocol model; b) clause 4.3 specifies the services provided to upper layers as well as the services expected from lower layers; c) clause 4.4 lists the RRC functions; d) clause 5 specifies RRC procedures, including UE state transitions; e) clause 6 specifies the RRC messages in ASN.1 and description; f) clause 7 specifies the variables (including protocol timers and constants) and counters to be used by the UE; g) clause 8 specifies the encoding of the RRC messages; h) clause 9 specifies the specified and default radio configurations; i) clause 10 specifies generic error handling; j) clause 11 specifies the RRC messages transferred across network nodes; k) clause 12 specifies the UE capability related constraints and performance requirements.
4.2 Architecture
4.2.1 UE states and state transitions including inter RAT
A UE is either in RRC_CONNECTED state or in RRC_INACTIVE state when an RRC connection has been
established. If this is not the case, i.e. no RRC connection is established, the UE is in RRC_IDLE state. The RRC states can further be characterised as follows: a) RRC_IDLE: b) A UE specific DRX may be configured by upper layers; c) An MBS broadcast specific DRX may be configured by upper layers; d) UE controlled mobility based on network configuration; e) The UE: f) Monitors Short Messages transmitted with P-RNTI over DCI (see clause 6.5); g) Monitors a Paging channel for CN paging using 5G-S-TMSI; h) If configured by upper layers for MBS multicast reception, monitors Paging channel for CN paging using TMGI; i) Performs neighbouring cell measurements and cell (re-)selection; j) Acquires system information and can send SI request (if configured); k) Performs logging of available measurements together with location and time for logged measurement configured UEs; l) Performs idle/inactive measurements for idle/inactive measurement configured UEs; m) If configured by upper layers for MBS broadcast reception, acquires MCCH change notification and MBS broadcast control information and data. n) RRC_INACTIVE: o) A UE specific DRX may be configured by upper layers or by RRC layer; p) UE controlled mobility based on network configuration; q) The UE stores the UE Inactive AS context; r) A RAN-based notification area is configured by RRC layer; s) Transfer of unicast data and/or signalling to/from UE over radio bearers configured for SDT; The UE: t) Monitors Short Messages transmitted with P-RNTI over DCI (see clause 6.5); u) During SDT procedure, monitors control channels associated with the shared data channel to determine if data is scheduled for it; v) While SDT procedure is not ongoing, monitors a Paging channel for CN paging using 5G-S-TMSI and RAN paging using fullI-RNTI; w) If configured by upper layers for MBS multicast reception, monitors Paging channel for paging using TMGI; x) Performs neighbouring cell measurements and cell (re-)selection; y) Performs RAN-based notification area updates periodically and when moving outside the configured RAN-based notification area; z) Acquires system information, while SDT procedure is not ongoing, and can send SI request (if configured); a) While SDT procedure is not ongoing, performs logging of available measurements together with location and time for logged measurement configured UEs; b) While SDT procedure is not ongoing, performs idle/inactive measurements for idle/inactive measurement configured UEs; c) If configured by upper layers for MBS broadcast reception, acquires MCCH change notification and MBS broadcast control information and data. d) RRC_CONNECTED: e) The UE stores the AS context; f) Transfer of unicast data to/from UE; g) Transfer of MBS multicast data to UE; h) At lower layers, the UE may be configured with a UE specific DRX; i) For UEs supporting CA, use of one or more SCells, aggregated with the SpCell, for increased bandwidth; j) For UEs supporting DC, use of one SCG, aggregated with the MCG, for increased bandwidth; k) Network controlled mobility within NR, to/from E-UTRA, and to UTRA-FDD; l) The UE: m) Monitors Short Messages transmitted with P-RNTI over DCI (see clause 6.5), if configured; n) Monitors control channels associated with the shared data channel to determine if data is scheduled for it; o) Provides channel quality and feedback information; p) Performs neighbouring cell measurements and measurement reporting; q) Acquires system information; r) Performs immediate MDT measurement together with available location reporting; s) If configured by upper layers for MBS broadcast reception, acquires MCCH change notification and MBS broadcast control information and data.
state in NR at one time.
NR RRC_CONNECTED
Resume / Release with Suspend
Establish /
Release NR RRC_INACTIVE
Release NR RRC_IDLE supported between NR/5GC, E-UTRA/EPC and E-UTRA/5GC.
4.2.2 Signalling radio bearers "Signalling Radio Bearers" (SRBs) are defined as Radio Bearers (RBs) that are used only for the transmission of RRC and NAS messages. More specifically, the following SRBs are defined: a) SRB0 is for RRC messages using the CCCH logical channel; b) SRB1 is for RRC messages (which may include a piggybacked NAS message) as well as for NAS messages prior to the establishment of SRB2, all using DCCH logical channel; c) SRB2 is for NAS messages and for RRC messages which include logged measurement information, all using DCCH logical channel. SRB2 has a lower priority than SRB1 and may be configured by the network after AS security activation; d) SRB3 is for specific RRC messages when UE is in (NG)EN-DC or NR-DC, all using DCCH logical channel; e) SRB4 is for RRC messages which include application layer measurement report information, all using DCCH logical channel. SRB4 can only be configured by the network after AS security activation.
In downlink, piggybacking of NAS messages is used only for one dependant (i.e. with joint success/failure) procedure:
bearer establishment/modification/release. In uplink piggybacking of NAS message is used only for transferring the initial NAS message during connection setup and connection resume.
NOTE 1: The NAS messages transferred via SRB2 are also contained in RRC messages, which however do not include any RRC protocol control information.
Once AS security is activated, all RRC messages on SRB1, SRB2, SRB3 and SRB4, including those containing NAS messages, are integrity protected and ciphered by PDCP. NAS independently applies integrity protection and ciphering to the NAS messages, see TS 24.501 .
Split SRB is supported for all the MR-DC options in both SRB1 and SRB2 (split SRB is not supported for SRB0 and SRB3).
For operation with shared spectrum channel access, SRB0, SRB1 and SRB3 are assigned with the highest priority
Channel Access Priority Class (CAPC), (i.e. CAPC = 1) while CAPC for SRB2 is configurable.
4.3 Services
4.3.1 Services provided to upper layers
The RRC protocol offers the following services to upper layers: a) Broadcast of common control information; b) Notification of UEs in RRC_IDLE, e.g. about a mobile terminating call; c) Notification of UEs about ETWS and/or CMAS; d) Transfer of dedicated signalling; e) Broadcast of positioning assistance data; f) Transfer of application layer measurement configuration and reporting.
4.3.2 Services expected from lower layers
In brief, the following are the main services that RRC expects from lower layers: a) Integrity protection, ciphering and loss-less in-sequence delivery of information without duplication;
4.4 Functions
The RRC protocol includes the following main functions: a) Broadcast of system information: b) Including NAS common information; c) Information applicable for UEs in RRC_IDLE and RRC_INACTIVE (e.g. cell (re-)selection parameters, neighbouring cell information) and information (also) applicable for UEs in RRC_CONNECTED (e.g.
assignment/modification of UE identity (C-RNTI, fullI-RNTI, etc.), establishment/modification/suspension/resumption/release of SRBs (except for SRB0); a) Access barring; b) Initial AS security activation, i.e. initial configuration of AS integrity protection (SRBs, DRBs) and AS ciphering (SRBs, DRBs); c) RRC connection mobility including e.g. intra-frequency and inter-frequency handover, associated AS security handling, i.e. key/algorithm change, specification of RRC context information transferred between network nodes; d) Establishment/modification/suspension/resumption/release of RBs carrying user data (DRBs/MRBs); e) Radio configuration control including e.g. assignment/modification of ARQ configuration, HARQ configuration, DRX configuration; f) In case of DC, cell management including e.g. change of PSCell, addition/modification/release of SCG cell(s); g) In case of CA, cell management including e.g. addition/modification/release of SCell(s); h) QoS control including assignment/ modification of semi-persistent scheduling (SPS) configuration and configured grant configuration for DL and UL respectively, assignment/ modification of parameters for UL rate control in the UE, i.e. allocation of a priority and a prioritised bit rate (PBR) for each RB of UE and logical channel of IAB-MT. i) Recovery from radio link failure. j) Inter-RAT mobility including e.g. AS security activation, transfer of RRC context information; k) Measurement configuration and reporting: l) Establishment/modification/release of measurement configuration (e.g. intra-frequency, inter-frequency and inter- RAT measurements); m) Setup and release of measurement gaps; n) Measurement reporting. o) Configuration of BAP entity and BH RLC channels for the support of IAB-node. p) Other functions including e.g. generic protocol error handling, transfer of dedicated NAS information, transfer of UE radio access capability information. q) Support of self-configuration and self-optimisation. r) Support of measurement logging and reporting for network performance optimisation, as specified in TS 37.320
; a) Support of transfer of application layer measurement configuration and reporting.
5 Procedures
5.1 General
5.1.1 Introduction
This clause covers the general requirements.
5.1.2 General requirements
The UE shall:
1&gt; process the received messages in order of reception by RRC, i.e. the processing of a message shall be completed before starting the processing of a subsequent message; NOTE: Network may initiate a subsequent procedure prior to receiving the UE's response of a previously initiated
1&gt; within a clause execute the steps according to the order specified in the procedural description;
1&gt; consider the term 'radio bearer' (RB) to cover SRBs, DRBs and MRBs unless explicitly stated otherwise;
1&gt; set the rrc-TransactionIdentifier in the response message, if included, to the same value as included in the message received from the network that triggered the response message;
1&gt; upon receiving a choice value set to setup:
2&gt; apply the corresponding received configuration and start using the associated resources, unless explicitly specified otherwise;
1&gt; upon receiving a choice value set to release:
2&gt; clear the corresponding configuration and stop using the associated resources;
1&gt; in case the size of a list is extended, upon receiving an extension field comprising the entries in addition to the ones carried by the original field (regardless of whether the network signals more entries in total); apply the following generic behaviour unless explicitly stated otherwise:
2&gt; create a combined list by concatenating the additional entries included in the extension field to the original field while maintaining the order among both the original and the additional entries;
2&gt; for the combined list, created according to the previous, apply the same behaviour as defined for the original
5.1.3 Requirements for UE in MR-DC
In this specification, the UE considers itself to be in: a) EN-DC, if and only if it is configured with nr-SecondaryCellGroupConfig according to TS 36.331, and it is connected to EPC, b) NGEN-DC, if and only if it is configured with nr-SecondaryCellGroupConfig according to TS 36.331, and it is connected to 5GC, c) NE-DC, if and only if it is configured with mrdc-SecondaryCellGroup set to eutra-SCG, d) NR-DC, if and only if it is configured with mrdc-SecondaryCellGroup set to nr-SCG, e) MR-DC, if and only if it is in (NG)EN-DC, NE-DC or NR-DC.
NOTE: This use of these terms deviates from the definition in TS 37.340 and other specifications. In TS
37.340, these terms include also the case where the UE is configured with E-UTRA or NR MCG only (i.e. no NR or E-UTRA SCG) but with one or more bearers terminated in a secondary node (i.e. using NR PDCP).
The UE in (NG)EN-DC only executes a subclause of clause 5 in this specification when the subclause: a) is referred to from a subclause under execution, either in this specification or in TS 36.331 ; or b) applies to a message received on SRB3 (if SRB3 is established); or c) applies to field(s), IE(s), UE variable(s) or timer(s) in this specification that the UE is configured with.
When executing a subclause of clause 5 in this specification, the UE follows the requirements in clause 5.1.2 and in all subclauses of this specification applicable to the messages (including processing time requirements), fields, IEs, timers and UE variables indicated in the subclause under execution.
5.2 System information
5.2.1 Introduction
System Information (SI) is divided into the MIB and a number of SIBs and posSIBs where: a) the MIB is always transmitted on the BCH with a periodicity of 80 ms and repetitions made within 80 ms (TS
38.212 , clause 7.1) and it includes parameters that are needed to acquire SIB1 from the cell. The first transmission of the MIB is scheduled in subframes as defined in TS 38.213 , clause 4.1 and repetitions are scheduled according to the period of SSB; a) the SIB1 is transmitted on the DL-SCH with a periodicity of 160 ms and variable transmission repetition periodicity within 160 ms as specified in TS 38.213 , clause 13. The default transmission repetition periodicity of SIB1 is 20 ms but the actual transmission repetition periodicity is up to network implementation.
For SSB and CORESET multiplexing pattern 1, SIB1 repetition transmission period is 20 ms. For SSB and CORESET multiplexing pattern 2/3, SIB1 transmission repetition period is the same as the SSB period (TS
38.213 , clause 13). SIB1 includes information regarding the availability and scheduling (e.g. mapping of SIBs to SI message, periodicity, SI-window size) of other SIBs with an indication whether one or more SIBs are only provided on-demand and, in that case, the configuration needed by the UE to perform the SI request. SIB1 is cell-specific SIB; a) SIBs other than SIB1 and posSIBs are carried in SystemInformation (SI) messages, which are transmitted on the DL-SCH. Only SIBs or posSIBs having the same periodicity can be mapped to the same SI message. SIBs and posSIBs are mapped to the different SI messages. Each SI message is transmitted within periodically occurring time domain windows (referred to as SI-windows with same length for all SI messages). Each SI message is associated with an SI-window and the SI-windows of different SI messages do not overlap. That is, within one SI-window only the corresponding SI message is transmitted. An SI message may be transmitted a number of times within the SI-window. Any SIB or posSIB except SIB1 can be configured to be cell specific or area specific, using an indication in SIB1. The cell specific SIB is applicable only within a cell that provides the SIB while the area specific SIB is applicable within an area referred to as SI area, which consists of one or several cells and is identified by systemInformationAreaID; b) The mapping of SIBs to SI messages is configured in schedulingInfoList and schedulingInfoList2, while the mapping of posSIBs to SI messages is configured in posSchedulingInfoList and schedulingInfoList2. SIBs and posSIBs are mapped to separate SI messages even when configured using a common schedulingInfoList2. Each SIB is contained only in a single SI message. In the case of posSIB, a posSIB carrying GNSS Generic Assistance
Data for different GNSS/SBAS is contained in different SI messages. Each SIB and posSIB, including a posSIB carrying GNSS Generic Assistance Data for one GNSS/SBAS, is contained at most once in that SI message; a) For a UE in RRC_CONNECTED, the network can provide system information through dedicated signalling using the RRCReconfiguration message, e.g. if the UE has an active BWP with no common search space configured to monitor system information, paging, or upon request from the UE. b) For PSCell and SCells, the network provides the required SI by dedicated signalling, i.e. within an RRCReconfiguration message. Nevertheless, the UE shall acquire MIB of the PSCell to get SFN timing of the SCG (which may be different from MCG). Upon change of relevant SI for SCell, the network releases and adds the concerned SCell. For PSCell, the required SI can only be changed with Reconfiguration with Sync.
NOTE: The physical layer imposes a limit to the maximum size a SIB can take. The maximum SIB1 or SI message size is 2976 bits.
5.2.2 System information acquisition
5.2.2.1 General UE requirements MIB SIB1 SystemInformationRequest SystemInformation messages
The UE applies the SI acquisition procedure to acquire the AS, NAS- and positioning assistance data information. The procedure applies to UEs in RRC_IDLE, in RRC_INACTIVE and in RRC_CONNECTED.
The UE in RRC_IDLE and RRC_INACTIVE shall ensure having a valid version of (at least) the MIB, SIB1 through SIB4, SIB5 (if the UE supports E-UTRA), SIB11 (if the UE is configured for idle/inactive measurements), SIB12 (if UE is capable of NR sidelink communication/discovery and is configured by upper layers to receive or transmit NR sidelink communication/discovery), and SIB13, SIB14 (if UE is capable of V2X sidelink communication and is configured by upper layers to receive or transmit V2X sidelink communication), SIB16 (if the UE is configured for slice specific cell reselection information), SIB19 (if UE is accessing NR via satellite access).
The UE capable of MBS broadcast which is receiving or interested to receive MBS broadcast service(s) via a broadcast MRB shall ensure having a valid version of SIB20 and SIB21, regardless of the RRC state the UE is in.
The UE shall ensure having a valid version of the posSIB requested by upper layers.
5.2.2.2 SIB validity and need to (re)-acquire SIB
5.2.2.2.1 SIB validity
The UE shall apply the SI acquisition procedure as defined in clause 5.2.2.3 upon cell selection (e.g. upon power on), cell-reselection, return from out of coverage, after reconfiguration with sync completion, after entering the network from another RAT, upon receiving an indication that the system information has changed, upon receiving a PWS notification, upon receiving request (e.g., a positioning request) from upper layers; and whenever the UE does not have
a valid version of a stored SIB or posSIB or a valid version of a requested SIB.
When the UE acquires a MIB or a SIB1 or an SI message in a serving cell as described in clause 5.2.2.3, and if the UE stores the acquired SIB, then the UE shall store the associated areaScope, if present, the first PLMN-Identity in the PLMN-IdentityInfoList for non-NPN-only cells or the first NPN identity (SNPN identity in case of SNPN, or PNI-NPN identity in case of PNI-NPN) in the NPN-IdentityInfoList for NPN-only cells, the cellIdentity, the systemInformationAreaID, if present, and the valueTag, if present, as indicated in the si-SchedulingInfo for the SIB. If the UE stores the acquired posSIB, then the UE shall store the associated areaScope, if present, the cellIdentity, the systemInformationAreaID, if present, the valueTag, if provided in assistanceDataSIB-Element, and the expirationTime if provided in assistanceDataSIB-Element. The UE may use a valid stored version of the SI except MIB, SIB1, SIB6, SIB7 or SIB8 e.g. after cell re-selection, upon return from out of coverage or after the reception of SI change indication.
The valueTag and expirationTime for posSIB is optionally provided in assistanceDataSIB-Element, as specified in TS
NOTE: The storage and management of the stored SIBs in addition to the SIBs valid for the current serving cell is left to UE implementation.
The UE shall:
1&gt; delete any stored version of a SIB after 3 hours from the moment it was successfully confirmed as valid;
1&gt; for each stored version of a SIB:
2&gt; if the areaScope is associated and its value for the stored version of the SIB is the same as the value received in the si-SchedulingInfo for that SIB from the serving cell:
3&gt; if the UE is NPN capable and the cell is an NPN-only cell:
4&gt; if the first NPN identity included in the NPN-IdentityInfoList, the systemInformationAreaID and the valueTag that are included in the si-SchedulingInfo for the SIB received from the serving cell are identical to the NPN identity, the systemInformationAreaID and the valueTag associated with the stored version of that SIB:
5&gt; consider the stored SIB as valid for the cell;
3&gt; else if the first PLMN-Identity included in the PLMN-IdentityInfoList, the systemInformationAreaID and the valueTag that are included in the si-SchedulingInfo for the SIB received from the serving cell are identical to the PLMN-Identity, the systemInformationAreaID and the valueTag associated with the stored version of that SIB:
4&gt; consider the stored SIB as valid for the cell;
2&gt; if the areaScope is not present for the stored version of the SIB and the areaScope value is not included in the si-SchedulingInfo for that SIB from the serving cell:
3&gt; if the UE is NPN capable and the cell is an NPN-only cell:
4&gt; if the first NPN identity in the NPN-IdentityInfoList, the cellIdentity and valueTag that are included in the si-SchedulingInfo for the SIB received from the serving cell are identical to the NPN identity, the cellIdentity and the valueTag associated with the stored version of that SIB:
5&gt; consider the stored SIB as valid for the cell;
3&gt; else if the first PLMN-Identity in the PLMN-IdentityInfoList, the cellIdentity and valueTag that are included in the si-SchedulingInfo for the SIB received from the serving cell are identical to the PLMN- Identity, the cellIdentity and the valueTag associated with the stored version of that SIB:
4&gt; consider the stored SIB as valid for the cell;
1&gt; for each stored version of a posSIB:
2&gt; if the areaScope is associated and its value for the stored version of the posSIB is the same as the value received in the posSIB-MappingInfo for that posSIB from the serving cell and the systemInformationAreaID included in the si-SchedulingInfo is identical to the systemInformationAreaID associated with the stored version of that posSIB:
3&gt; if the valueTag (see TS 37.355 ) for the posSIB received from the serving cell is identical to the valueTag associated with the stored version of that posSIB; or if the expirationTime (see TS 37.355 ) associated with the stored posSIB has not been expired:
4&gt; consider the stored posSIB as valid for the cell;
2&gt; if the areaScope is not present for the stored version of the posSIB and the areaScope value is not included in the posSIB-MappingInfo for that posSIB from the serving cell and the cellIdentity for the posSIB received from the serving cell is identical to the cellIdentity associated with the stored version of that posSIB:
3&gt; if the valueTag (see TS 37.355 ) for the posSIB received from the serving cell is identical to the valueTag associated with the stored version of that posSIB; or if the expirationTime (see TS 37.355 ) associated with the stored posSIB has not been expired:
4&gt; consider the stored posSIB as valid for the cell;
5.2.2.2.2 SI change indication and PWS notification
For UEs in RRC_IDLE or RRC_INACTIVE configured to use an eDRX cycle longer than the modification period, an eDRX acquisition period is defined. The boundaries of the eDRX acquisition period are determined by H-SFN values for which H-SFN mod 1024 = 0.
The UE receives indications about SI modifications and/or PWS notifications using Short Message transmitted with P- RNTI over DCI (see clause 6.5). Repetitions of SI change indication may occur within preceding modification period or within preceding eDRX acquisition period. SI change indication is not applicable for SI messages containing posSIBs.
UEs in RRC_IDLE or in RRC_INACTIVE while T319a is not running shall monitor for SI change indication in their own paging occasion(s) every DRX cycle. UEs in RRC_CONNECTED shall monitor for SI change indication in any paging occasion at least once per modification period if the UE is provided with common search space, including pagingSearchSpace, searchSpaceSIB1 and searchSpaceOtherSystemInformation, on the active BWP to monitor paging, as specified in TS 38.213 , clause 13.
UEs in RRC_INACTIVE while T319a is running shall monitor for SI change indication in any paging occasion at least once per modification period.
During a modification period where ETWS or CMAS transmission is started or stopped, the SI messages carrying the posSIBs scheduled in posSchedulingInfoList may change, so the UE might not be able to successfully receive those posSIBs in the remainder of the current modification period and next modification period according to the scheduling information received prior to the change.
ETWS or CMAS capable UEs in RRC_IDLE or in RRC_INACTIVE while T319a is not running shall monitor for indications about PWS notification in its own paging occasion every DRX cycle. ETWS or CMAS capable UEs in RRC_CONNECTED shall monitor for indication about PWS notification in any paging occasion at least once every defaultPagingCycle if the UE is provided with common search space, including pagingSearchSpace, searchSpaceSIB1 and searchSpaceOtherSystemInformation, on the active BWP to monitor paging.
ETWS or CMAS capable UEs in RRC_INACTIVE while T319a is running shall monitor for indication about PWS notification in any paging occasion at least once every defaultPagingCycle.
For Short Message reception in a paging occasion, the UE monitors the PDCCH monitoring occasion(s) for paging as specified in TS 38.304 and TS 38.213 .
If the UE receives a Short Message, the UE shall:
1&gt; if the UE is ETWS capable or CMAS capable, the etwsAndCmasIndication bit of Short Message is set, and the UE is provided with searchSpaceSIB1 and searchSpaceOtherSystemInformation on the active BWP or the initial BWP:
2&gt; if the UE is ETWS capable and si-SchedulingInfo includes scheduling information for SIB6:
3&gt; acquire SIB6, as specified in clause 5.2.2.3.2, immediately;
2&gt; if the UE is ETWS capable and si-SchedulingInfo includes scheduling information for SIB7:
3&gt; acquire SIB7, as specified in clause 5.2.2.3.2, immediately;
2&gt; if the UE is CMAS capable and si-SchedulingInfo includes scheduling information for SIB8:
3&gt; acquire SIB8, as specified in clause 5.2.2.3.2, immediately; NOTE: In case SIB6, SIB7, or SIB8 overlap with a measurement gap it is left to UE implementation how to immediately acquire SIB6, SIB7, or SIB8.
1&gt; if the UE is not configured with an eDRX cycle longer than the modification period and the systemInfoModification bit of Short Message is set:
2&gt; apply the SI acquisition procedure as defined in clause 5.2.2.3 from the start of the next modification period;
1&gt; if the UE is configured with an RRC_IDLE eDRX cycle longer than the modification period and the systemInfoModification-eDRX bit of Short Message is set:
2&gt; apply the SI acquisition procedure as defined in clause 5.2.2.3 from the start of the next eDRX acquisition period boundary.
5.2.2.3 Acquisition of System Information
5.2.2.3.1 Acquisition of MIB and SIB1
The UE shall:
1&gt; apply the specified BCCH configuration defined in 9.1.1.1;
1&gt; if the UE is in RRC_IDLE or in RRC_INACTIVE; or
1&gt; if the UE is in RRC_CONNECTED while T311 is running:
2&gt; acquire the MIB, which is scheduled as specified in TS 38.213 ;
2&gt; if the UE is unable to acquire the MIB;
3&gt; perform the actions as specified in clause 5.2.2.5;
3&gt; perform the actions specified in clause 5.2.2.4.1.
1&gt; if the UE is in RRC_CONNECTED with an active BWP with common search space configured by searchSpaceSIB1 and pagingSearchSpace and has received an indication about change of system information; or
1&gt; if the UE is in RRC_CONNECTED with an active BWP with common search space configured by searchSpaceSIB1 and the UE has not stored a valid version of a SIB or posSIB, in accordance with clause
5.2.2.2.1, of one or several required SIB(s) or posSIB(s) in accordance with clause 5.2.2.1, and, UE has not acquired SIB1 in current modification period; or
1&gt; if the UE is in RRC_CONNECTED with an active BWP with common search space configured by searchSpaceSIB1, and, the UE has not stored a valid version of a SIB or posSIB, in accordance with clause
5.2.2.2.1, of one or several required SIB(s) or posSIB(s) in accordance with clause 5.2.2.1, and, si- BroadcastStatus for the required SIB(s) or posSI-BroadcastStatus for the required posSIB(s) is set to notbroadcasting in acquired SIB1 in current modification period; or
1&gt; if the UE is in RRC_IDLE or in RRC_INACTIVE; or
1&gt; if the UE is in RRC_CONNECTED while T311 is running:
2&gt; if ssb-SubcarrierOffset indicates SIB1 is transmitted in the cell (TS 38.213 ) and if SIB1 acquisition is required for the UE:
3&gt; acquire the SIB1, which is scheduled as specified in TS 38.213 ;
3&gt; if the UE is unable to acquire the SIB1:
4&gt; perform the actions as specified in clause 5.2.2.5;
4&gt; upon acquiring SIB1, perform the actions specified in clause 5.2.2.4.2.
2&gt; else if SIB1 acquisition is required for the UE and ssb-SubcarrierOffset indicates that SIB1 is not scheduled in the cell:
3&gt; perform the actions as specified in clause 5.2.2.5.
NOTE: The UE in RRC_CONNECTED is only required to acquire broadcasted SIB1 if the UE can acquire it without disrupting unicast or MBS multicast data reception, i.e. the broadcast and unicast/MBS multicast beams are quasi co-located.
5.2.2.3.2 Acquisition of an SI message
For SI message acquisition PDCCH monitoring occasion(s) are determined according to searchSpaceOtherSystemInformation. If searchSpaceOtherSystemInformation is set to zero, PDCCH monitoring occasions for SI message reception in SI-window are same as PDCCH monitoring occasions for SIB1 where the mapping between PDCCH monitoring occasions and SSBs is specified in TS 38.213. If searchSpaceOtherSystemInformation is not set to zero, PDCCH monitoring occasions for SI message are determined based on search space indicated by searchSpaceOtherSystemInformation. PDCCH monitoring occasions for SI message which are not overlapping with UL symbols (determined according to tdd-UL-DL-ConfigurationCommon) are sequentially numbered from one in the SI window. The [xN+K]th PDCCH monitoring occasion (s) for SI message in SI-window corresponds to the Kth transmitted SSB, where x = 0, 1, ...X-1, K = 1, 2, N, N is the number of actual transmitted SSBs determined according to ssb-PositionsInBurst in SIB1 and X is equal to CEIL(number of PDCCH monitoring occasions in SI-window/N). The actual transmitted SSBs are sequentially numbered from one in ascending order of their SSB indexes. The UE assumes that, in the SI window, PDCCH for an SI message is transmitted in at least one PDCCH monitoring occasion corresponding to each transmitted SSB and thus the selection of SSB for the reception SI messages is up to UE implementation.
When acquiring an SI message, the UE shall:
1&gt; determine the start of the SI-window for the concerned SI message as follows:
2&gt; if the concerned SI message is configured in the schedulingInfoList:
3&gt; for the concerned SI message, determine the number n which corresponds to the order of entry in the list of SI messages configured by schedulingInfoList in si-SchedulingInfo in SIB1;
3&gt; determine the integer value x = (n 1) w, where w is the si-WindowLength;
3&gt; the SI-window starts at the slot #a, where a = x mod N, in the radio frame for which SFN mod T = FLOOR(x/N), where T is the si-Periodicity of the concerned SI message and N is the number of slots in a radio frame as specified in TS 38.213 ;
2&gt; else if the concerned SI message is configured in the schedulingInfoList2;
3&gt; determine the integer value x = (si-WindowPosition -1) w, where w is the si-WindowLength;
3&gt; the SI-window starts at the slot #a, where a = x mod N, in the radio frame for which SFN mod T = FLOOR(x/N), where T is the si-Periodicity of the concerned SI message and N is the number of slots in a radio frame as specified in TS 38.213 ;
2&gt; else if the concerned SI message is configured in the posSchedulingInfoList and offsetToSI-Used is not configured:
3&gt; create a concatenated list of SI messages by appending the posSchedulingInfoList in posSI-SchedulingInfo in SIB1 to schedulingInfoList in si-SchedulingInfo in SIB1;
3&gt; for the concerned SI message, determine the number n which corresponds to the order of entry in the concatenated list;
3&gt; determine the integer value x = (n 1) w, where w is the si-WindowLength;
3&gt; the SI-window starts at the slot #a, where a = x mod N, in the radio frame for which SFN mod T = FLOOR(x/N), where T is the posSI-Periodicity of the concerned SI message and N is the number of slots in a radio frame as specified in TS 38.213 ;
2&gt; else if the concerned SI message is configured by the posSchedulingInfoList and offsetToSI-Used is configured:
3&gt; determine the number m which corresponds to the number of SI messages with an associated si- Periodicity of 8 radio frames (80 ms), configured by schedulingInfoList in SIB1;
3&gt; for the concerned SI message, determine the number n which corresponds to the order of entry in the list of SI messages configured by posSchedulingInfoList in SIB1;
3&gt; determine the integer value x = m w + (n 1) w, where w is the si-WindowLength;
3&gt; the SI-window starts at the slot #a, where a = x mod N, in the radio frame for which SFN mod T = FLOOR(x/N) +8, where T is the posSI-Periodicity of the concerned SI message and N is the number of slots in a radio frame as specified in TS 38.213 ;
1&gt; receive the PDCCH containing the scheduling RNTI, i.e. SI-RNTI in the PDCCH monitoring occasion(s) for SI message acquisition, from the start of the SI-window and continue until the end of the SI-window whose absolute length in time is given by si-WindowLength, or until the SI message was received;
1&gt; if the SI message was not received by the end of the SI-window, repeat reception at the next SI-window occasion for the concerned SI message in the current modification period; NOTE 1: The UE is only required to acquire broadcasted SI message if the UE can acquire it without disrupting unicast or MBS multicast data reception, i.e. the broadcast and unicast/MBS multicast beams are quasi co-located.
NOTE 2: The UE is not required to monitor PDCCH monitoring occasion(s) corresponding to each transmitted SSB in SI-window.
NOTE 3: If the concerned SI message was not received in the current modification period, handling of SI message acquisition is left to UE implementation.
NOTE 4: A UE in RRC_CONNECTED may stop the PDCCH monitoring during the SI window for the concerned SI message when the requested SIB(s) are acquired.
NOTE 5: A UE capable of NR sidelink communication and configured by upper layers to perform NR sidelink communication on a frequency, may acquire SIB12 or SystemInformationBlockType28 from a cell other than current serving cell (for RRC_INACTIVE or RRC_IDLE) or current PCell (for RRC_CONNECTED), if SIB12 of current serving cell (for RRC_INACTIVE or RRC_IDLE) or current PCell (for RRC_CONNECTED) does not provide configuration for NR sidelink communication for the frequency, and if the other cell providing configuration for NR sidelink communication for the frequency meets the S-criteria as defined in TS 38.304 or TS 36.304 .
1&gt; perform the actions for the acquired SI message as specified in clause 5.2.2.4.
5.2.2.3.3 Request for on demand system information
The UE shall, while T319a is not running:
1&gt; if SIB1 includes si-SchedulingInfo containing si-RequestConfigSUL and criteria to select supplementary uplink as defined in TS 38.321, clause 5.1.1 is met:
2&gt; trigger the lower layer to initiate the Random Access procedure on supplementary uplink in accordance with message(s) that the UE requires to operate within the cell, and for which si-BroadcastStatus is set to notBroadcasting;
2&gt; if acknowledgement for SI request is received from lower layers:
3&gt; acquire the requested SI message(s) as defined in clause 5.2.2.3.2, immediately;
1&gt; else if SIB1 includes si-SchedulingInfo containing si-RequestConfig and criteria to select normal uplink as defined in TS 38.321, clause 5.1.1 is met:
2&gt; trigger the lower layer to initiate the random access procedure on normal uplink in accordance with TS
38.321 using the PRACH preamble(s) and PRACH resource(s) in si-RequestConfig corresponding to the SI message(s) that the UE requires to operate within the cell, and for which si-BroadcastStatus is set to notBroadcasting;
2&gt; if acknowledgement for SI request is received from lower layers:
3&gt; acquire the requested SI message(s) as defined in clause 5.2.2.3.2, immediately;
2&gt; apply the default L1 parameter values as specified in corresponding physical layer specifications except for the parameters for which values are provided in SIB1;
2&gt; apply the default MAC Cell Group configuration as specified in 9.2.2;
2&gt; apply the timeAlignmentTimerCommon included in SIB1;
2&gt; apply the CCCH configuration as specified in 9.1.1.2;
2&gt; initiate transmission of the RRCSystemInfoRequest message in accordance with 5.2.2.3.4;
2&gt; if acknowledgement for RRCSystemInfoRequest message is received from lower layers:
3&gt; acquire the requested SI message(s) as defined in clause 5.2.2.3.2, immediately;
1&gt; if cell reselection occurs while waiting for the acknowledgment for SI request from lower layers:
2&gt; if SI request is based on RRCSystemInfoRequest message:
3&gt; release RLC entity for SRB0.
NOTE: After RACH failure for SI request it is up to UE implementation when to retry the SI request.
5.2.2.3.3a Request for on demand positioning system information
The UE shall, while T319a is not running:
1&gt; if SIB1 includes posSI-SchedulingInfo containing posSI-RequestConfigSUL and criteria to select supplementary uplink as defined in TS 38.321, clause 5.1.1 is met:
2&gt; trigger the lower layer to initiate the Random Access procedure on supplementary uplink in accordance with SI message(s) that the UE requires to operate within the cell, and for which posSI-BroadcastStatus is set to notBroadcasting;
2&gt; if acknowledgement for SI request is received from lower layers:
3&gt; acquire the requested SI message(s) as defined in clause 5.2.2.3.2, immediately;
1&gt; else if SIB1 includes posSI-SchedulingInfo containing posSI-RequestConfig and criteria to select normal uplink as defined in TS 38.321, clause 5.1.1 is met:
2&gt; trigger the lower layer to initiate the random access procedure on normal uplink in accordance with TS
38.321 using the PRACH preamble(s) and PRACH resource(s) in posSI-RequestConfig corresponding to the SI message(s) that the UE upper layers require for positioning operations , and for which posSI- BroadcastStatus is set to notBroadcasting;
2&gt; if acknowledgement for SI request is received from lower layers:
3&gt; acquire the requested SI message(s) as defined in clause 5.2.2.3.2, immediately;
2&gt; apply the default L1 parameter values as specified in corresponding physical layer specifications except for the parameters for which values are provided in SIB1;
2&gt; apply the default MAC Cell Group configuration as specified in 9.2.2;
2&gt; apply the timeAlignmentTimerCommon included in SIB1;
2&gt; apply the CCCH configuration as specified in 9.1.1.2;
2&gt; initiate transmission of the RRCSystemInfoRequest message with rrcPosSystemInfoRequest in accordance with 5.2.2.3.4;
2&gt; if acknowledgement for RRCSystemInfoRequest message with rrcPosSystemInfoRequest is received from lower layers:
3&gt; acquire the requested SI message(s) as defined in clause 5.2.2.3.2, immediately;
1&gt; if cell reselection occurs while waiting for the acknowledgment for SI request from lower layers:
2&gt; if SI request is based on RRCSystemInfoRequest message with rrcPosSystemInfoRequest:
3&gt; release RLC entity for SRB0.
NOTE: After RACH failure for SI request it is up to UE implementation when to retry the SI request.
5.2.2.3.4 Actions related to transmission of RRCSystemInfoRequest message
The UE shall set the contents of RRCSystemInfoRequest message as follows:
1&gt; if the procedure is triggered to request the required SI message(s) other than positioning:
2&gt; set the requested-SI-List to indicate the SI message(s) that the UE requires to operate within the cell, and for which si-BroadcastStatus is set to notBroadcasting;
1&gt; else if the procedure is triggered to request the required SI message(s) for positioning:
2&gt; set the requestedPosSI-List to indicate the SI message(s) that the UE upper layers require for positioning operations, and for which posSI-BroadcastStatus is set to notBroadcasting.
The UE shall submit the RRCSystemInfoRequest message to lower layers for transmission.
5.2.2.3.5 Acquisition of SIB(s) or posSIB(s) in RRC_CONNECTED
The UE shall:
1&gt; if the UE is in RRC_CONNECTED with an active BWP not configured with common search space with the field searchSpaceOtherSystemInformation and the UE has not stored a valid version of a SIB or posSIB, in accordance with clause 5.2.2.2.1, of one or several required SIB(s) or posSIB(s) in accordance with clause
2&gt; for the SI message(s) that, according to the si-SchedulingInfo or posSI-SchedulingInfo in the stored SIB1, contain at least one required SIB or requested posSIB:
3&gt; if onDemandSIB-Request is configured and timer T350 is not running:
4&gt; initiate transmission of the DedicatedSIBRequest message in accordance with 5.2.2.3.6;
4&gt; start timer T350 with the timer value set to the onDemandSIB-RequestProhibitTimer;
1&gt; else if the UE is in RRC_CONNECTED with an active BWP configured with common search space with the field searchSpaceOtherSystemInformation and the UE has not stored a valid version of a SIB or posSIB, in accordance with clause 5.2.2.2.1, of one or several required SIB(s) or posSIB(s) in accordance with clause
2&gt; for the SI message(s) that, according to the si-SchedulingInfo in the stored SIB1, contain at least one required SIB and for which si-BroadcastStatus is set to broadcasting:
3&gt; acquire the SI message(s) as defined in clause 5.2.2.3.2;
2&gt; for the SI message(s) that, according to the si-SchedulingInfo in the stored SIB1, contain at least one required SIB and for which si-BroadcastStatus is set to notBroadcasting:
3&gt; if onDemandSIB-Request is configured and timer T350 is not running:
4&gt; initiate transmission of the DedicatedSIBRequest message in accordance with 5.2.2.3.6;
4&gt; start timer T350 with the timer value set to the onDemandSIB-RequestProhibitTimer;
4&gt; acquire the requested SI message(s) corresponding to the requested SIB(s) as defined in clause
2&gt; for the SI message(s) that, according to the posSI-SchedulingInfo in the stored SIB1, contain at least one requested posSIB and for which posSI-BroadcastStatus is set to broadcasting:
3&gt; acquire the SI message(s) as defined in clause 5.2.2.3.2;
2&gt; for the SI message(s) that, according to the posSI-SchedulingInfo in the stored SIB1, contain at least one requested posSIB and for which posSI-BroadcastStatus is set to notBroadcasting:
3&gt; if onDemandSIB-Request is configured and timer T350 is not running:
4&gt; initiate transmission of the DedicatedSIBRequest message in accordance with 5.2.2.3.6;
4&gt; start timer T350 with the timer value set to the onDemandSIB-RequestProhibitTimer;
4&gt; acquire the requested SI message(s) corresponding to the requested posSIB(s) as defined in clause
NOTE: UE may include on demand request for SIB and/or posSIB(s) in the same DedicatedSIBRequest message.
5.2.2.3.6 Actions related to transmission of DedicatedSIBRequest message
The UE shall set the contents of DedicatedSIBRequest message as follows:
1&gt; if the procedure is triggered to request the required SIB(s):
2&gt; include requestedSIB-List in the onDemandSIB-RequestList to indicate the requested SIB(s);
1&gt; if the procedure is triggered to request the required posSIB(s):
2&gt; include requestedPosSIB-List in the onDemandSIB-RequestList to indicate the requested posSIB(s).
The UE shall submit the DedicatedSIBRequest message to lower layers for transmission.
5.2.2.4 Actions upon receipt of System Information
5.2.2.4.1 Actions upon reception of the MIB
Upon receiving the MIB the UE shall:
1&gt; store the acquired MIB;
1&gt; if the UE is in RRC_IDLE or in RRC_INACTIVE, or if the UE is in RRC_CONNECTED while T311 is running:
2&gt; if the cellBarred in the acquired MIB is set to barred:
3&gt; if the UE is a RedCap UE:
4&gt; if ssb-SubcarrierOffset indicates SIB1 is transmitted in the cell (TS 38.213 )
5&gt; acquire the SIB1, which is scheduled as specified in TS 38.213 ;3&gt; consider the cell as barred in accordance with TS 38.304 ;
3&gt; perform cell re-selection to other cells on the same frequency as the barred cell as specified in TS 38.304
5.2.2.4.2 Actions upon reception of the SIB1
Upon receiving the SIB1 the UE shall:
1&gt; store the acquired SIB1;
1&gt; if the UE is a RedCap UE and it is in RRC_IDLE or in RRC_INACTIVE, or if the RedCap UE is in RRC_CONNECTED while T311 is running:
2&gt; if intraFreqReselectionRedCap is not present in SIB1:
3&gt; consider the cell as barred in accordance with TS 38.304 ;
3&gt; perform barring as if intraFreqReselectionRedCap is set to allowed;
3&gt; if the cellBarredRedCap1Rx is present in the acquired SIB1 and is set to barred and the UE is equipped with 1 Rx branch; or
3&gt; if the cellBarredRedCap2Rx is present in the acquired SIB1 and is set to barred and the UE is equipped with 2 Rx branches; or
3&gt; if the halfDuplexRedCapAllowed is not present in the acquires SIB1 and the UE supports only half-duplex FDD operation:
4&gt; consider the cell as barred in accordance with TS 38.304 ;
4&gt; consider cell re-selection to other cells on the same frequency as the barred cell as specified in TS
1&gt; if the cellAccessRelatedInfo contains an entry of a selected SNPN or PLMN and in case of PLMN the UE is either allowed or instructed to access the PLMN via a cell for which at least one CAG ID is broadcast:
2&gt; in the remainder of the procedures use npn-IdentityList, trackingAreaCode, trackingAreaList, and cellIdentity for the cell as received in the corresponding entry of npn-IdentityInfoList containing the selected PLMN or SNPN;
1&gt; else if the cellAccessRelatedInfo contains an entry with the PLMN-Identity of the selected PLMN:
2&gt; in the remainder of the procedures use plmn-IdentityList, trackingAreaCode, trackingAreaList, and cellIdentity for the cell as received in the corresponding PLMN-IdentityInfo containing the selected PLMN;
1&gt; if in RRC_CONNECTED while T311 is not running:
2&gt; disregard the frequencyBandList, if received, while in RRC_CONNECTED;
2&gt; forward the cellIdentity to upper layers;
2&gt; forward the trackingAreaCode to upper layers;
2&gt; forward the trackingAreaList to upper layers, if included;
2&gt; forward the received posSIB-MappingInfo to upper layers, if included;
2&gt; apply the configuration included in the servingCellConfigCommon;
2&gt; if the UE has a stored valid version of a SIB or posSIB, in accordance with clause 5.2.2.2.1, that the UE requires to operate within the cell in accordance with clause 5.2.2.1:
3&gt; use the stored version of the required SIB or posSIB;
3&gt; acquire the required SIB or posSIB requested by upper layer as defined in clause 5.2.2.3.5; NOTE: Void.
2&gt; if the UE supports one or more of the frequency bands indicated in the frequencyBandList for downlink for TDD, or one or more of the frequency bands indicated in the frequencyBandList for uplink for FDD, and they are not downlink only bands, and
2&gt; if the UE is IAB-MT or supports at least one additionalSpectrumEmission in the NR-NS-PmaxList for a supported band in the downlink for TDD, or a supported band in uplink for FDD, and
2&gt; if the UE supports an uplink channel bandwidth with a maximum transmission bandwidth configuration (see TS 38.101-1 and TS 38.101-2 ) which a) is smaller than or equal to the carrierBandwidth (indicated in uplinkConfigCommon for the SCS of the initial uplink BWP or, for RedCap UE, of the initial uplink BWP for RedCap if configured), and which b) is wider than or equal to the bandwidth of the initial uplink BWP or, for RedCap UE, of the initial uplink BWP for RedCap if configured, and
2&gt; if the UE supports a downlink channel bandwidth with a maximum transmission bandwidth configuration (see TS 38.101-1 and TS 38.101-2 ) which a) is smaller than or equal to the carrierBandwidth (indicated in downlinkConfigCommon for the SCS of the initial downlink BWP or, for RedCap UE, of the initial downlink BWP for RedCap if configured), and which b) is wider than or equal to the bandwidth of the initial downlink BWP or, for RedCap UE, of the initial downlink BWP for RedCap if configured, and
2&gt; if frequencyShift7p5khz is present and the UE supports corresponding 7.5kHz frequency shift on this band; or frequencyShift7p5khz is not present:
3&gt; if trackingAreaCode and trackingAreaList are not provided for the selected PLMN nor the registered PLMN nor PLMN of the equivalent PLMN list:
4&gt; consider the cell as barred in accordance with TS 38.304 ;
4&gt; perform cell re-selection to other cells on the same frequency as the barred cell as specified in TS
3&gt; else if UE is IAB-MT and if iab-Support is not provided for the selected PLMN nor the registered PLMN nor PLMN of the equivalent PLMN list nor the selected SNPN nor the registered SNPN:
4&gt; consider the cell as barred for IAB-MT in accordance with TS 38.304 ;
4&gt; apply a supported uplink channel bandwidth with a maximum transmission bandwidth which a) is contained within the carrierBandwidth indicated in uplinkConfigCommon for the SCS of the initial uplink BWP or, for RedCap UEs, initial uplink BWP for RedCap, if configured, and which b) is wider than or equal to the bandwidth of the initial BWP for the uplink;
4&gt; apply a supported downlink channel bandwidth with a maximum transmission bandwidth which a) is contained within the carrierBandwidth indicated in downlinkConfigCommon for the SCS of the initial downlink BWP or, for RedCap UEs, initial downlink BWP for RedCap, if configured, and which b) is wider than or equal to the bandwidth of the initial BWP for the downlink;
4&gt; select the first frequency band in the frequencyBandList, for FDD from frequencyBandList for uplink, or for TDD from frequencyBandList for downlink, which the UE supports and for which the UE supports at least one of the additionalSpectrumEmission values in nr-NS-PmaxList, if present;
4&gt; forward the cellIdentity to upper layers;
4&gt; forward the trackingAreaCode to upper layers;
4&gt; forward the trackingAreaList to upper layers, if included;
4&gt; forward the received posSIB-MappingInfo to upper layers, if included;
4&gt; forward the PLMN identity or SNPN identity or PNI-NPN identity to upper layers;
4&gt; if in RRC_INACTIVE and the forwarded information does not trigger message transmission by upper layers:
5&gt; if the serving cell does not belong to the configured ran-NotificationAreaInfo:
6&gt; initiate an RNA update as specified in 5.3.13.8;
4&gt; forward the ims-EmergencySupport to upper layers, if present;
4&gt; forward the eCallOverIMS-Support to upper layers, if present;
4&gt; forward the UAC-AccessCategory1-SelectionAssistanceInfo or UAC-AC1-SelectAssistInfo for the selected PLMN/SNPN to upper layers, if present and set to a, b or c;
4&gt; if the UE is in SNPN access mode:
5&gt; forward the imsEmergencySupportForSNPN indicators with the corresponding SNPN identities to upper layers, if present;
4&gt; apply the configuration included in the servingCellConfigCommon;
4&gt; apply the specified PCCH configuration defined in 9.1.1.3;
4&gt; if the UE has a stored valid version of a SIB, in accordance with clause 5.2.2.2.1, that the UE requires to operate within the cell in accordance with clause 5.2.2.1:
5&gt; use the stored version of the required SIB;
4&gt; if the UE has not stored a valid version of a SIB, in accordance with clause 5.2.2.2.1, of one or several required SIB(s), in accordance with clause 5.2.2.1:
5&gt; for the SI message(s) that, according to the si-SchedulingInfo, contain at least one required SIB and for which si-BroadcastStatus is set to broadcasting:
6&gt; acquire the SI message(s) as defined in clause 5.2.2.3.2;
5&gt; for the SI message(s) that, according to the si-SchedulingInfo, contain at least one required SIB and for which si-BroadcastStatus is set to notBroadcasting:
6&gt; trigger a request to acquire the SI message(s) as defined in clause 5.2.2.3.3;
4&gt; if the UE has a stored valid version of a posSIB, in accordance with clause 5.2.2.2.1, of one or several required posSIB(s), in accordance with clause 5.2.2.1:
5&gt; use the stored version of the required posSIB;
4&gt; if the UE has not stored a valid version of a posSIB, in accordance with clause 5.2.2.2.1, of one or several posSIB(s) in accordance with clause 5.2.2.1:
5&gt; for the SI message(s) that, according to the posSI-SchedulingInfo, contain at least one requested posSIB and for which posSI-BroadcastStatus is set to broadcasting:
6&gt; acquire the SI message(s) as defined in clause 5.2.2.3.2;
5&gt; for the SI message(s) that, according to the posSI-SchedulingInfo, contain at least one requested posSIB for which posSI-BroadcastStatus is set to notBroadcasting:
6&gt; trigger a request to acquire the SI message(s) as defined in clause 5.2.2.3.3a;
4&gt; apply the first listed additionalSpectrumEmission which it supports among the values included in NR- NS-PmaxList within frequencyBandList in uplinkConfigCommon for FDD or in downlinkConfigCommon for TDD;
4&gt; if the additionalPmax is present in the same entry of the selected additionalSpectrumEmission within NR-NS-PmaxList:
5&gt; apply the additionalPmax for UL;
5&gt; apply the p-Max in uplinkConfigCommon for UL;
4&gt; if supplementaryUplink is present in servingCellConfigCommon; and
4&gt; if the UE supports one or more of the frequency bands indicated in the frequencyBandList for the supplementaryUplink; and
4&gt; if the UE supports at least one additionalSpectrumEmission in the NR-NS-PmaxList for a supported supplementary uplink band; and
4&gt; if the UE supports an uplink channel bandwidth with a maximum transmission bandwidth configuration (see TS 38.101-1 and TS 38.101-2 ) which a) is smaller than or equal to the carrierBandwidth (indicated in supplementaryUplink for the SCS of the initial uplink BWP), and which b) is wider than or equal to the bandwidth of the initial uplink BWP of the SUL:
5&gt; consider supplementary uplink as configured in the serving cell;
5&gt; select the first frequency band in the frequencyBandList for the supplementaryUplink which the UE supports and for which the UE supports at least one of the additionalSpectrumEmission values in nr-NS-PmaxList, if present;
5&gt; apply a supported supplementary uplink channel bandwidth with a maximum transmission bandwidth which a) is contained within the carrierBandwidth (indicated in supplementaryUplink for the SCS of the initial uplink BWP), and which b) is wider than or equal to the bandwidth of the initial BWP of the SUL;
5&gt; apply the first listed additionalSpectrumEmission which it supports among the values included in NR-NS-PmaxList within frequencyBandList for the supplementaryUplink;
5&gt; if the additionalPmax is present in the same entry of the selected additionalSpectrumEmission within NR-NS-PmaxList for the supplementaryUplink:
6&gt; apply the additionalPmax in supplementaryUplink for SUL;
6&gt; apply the p-Max in supplementaryUplink for SUL;
3&gt; consider the cell as barred in accordance with TS 38.304 ; and
3&gt; perform barring as if intraFreqReselection is set to notAllowed;
5.2.2.4.3 Actions upon reception of SIB2
Upon receiving SIB2, the UE shall:
1&gt; if in RRC_IDLE or in RRC_INACTIVE or in RRC_CONNECTED while T311 is running:
2&gt; if, for the entry in frequencyBandList with the same index as the frequency band selected in clause 5.2.2.4.2, the UE supports at least one additionalSpectrumEmission in the NR-NS-PmaxList within the frequencyBandList:
3&gt; apply the first listed additionalSpectrumEmission which it supports among the values included in NR-NS- PmaxList within frequencyBandList;
3&gt; if the additionalPmax is present in the same entry of the selected additionalSpectrumEmission within NR- NS-PmaxList:
4&gt; apply the additionalPmax;
4&gt; apply the p-Max;
3&gt; if the UE selects a frequency band (from the procedure in clause 5.2.2.4.2) for the supplementary uplink:
4&gt; if, for the entry in frequencyBandListSUL with the same index as the frequency band selected in clause 5.2.2.4.2, the UE supports at least one additionalSpectrumEmission in the NR-NS-PmaxList within the frequencyBandListSUL:
5&gt; apply the first listed additionalSpectrumEmission which it supports among the values included in NR-NS-PmaxList within frequencyBandListSUL;
5&gt; if the additionalPmax is present in the same entry of the selected additionalSpectrumEmission within NR-NS-PmaxList:
6&gt; apply the additionalPmax;
6&gt; apply the p-Max;
5&gt; apply the p-Max.
3&gt; apply the p-Max;
5.2.2.4.4 Actions upon reception of SIB3
No UE requirements related to the contents of this SIB3 apply other than those specified elsewhere e.g. within procedures using the concerned system information, and/ or within the corresponding field descriptions.
5.2.2.4.5 Actions upon reception of SIB4
Upon receiving SIB4 the UE shall:
1&gt; if in RRC_IDLE, or in RRC_INACTIVE or in RRC_CONNECTED while T311 is running:
2&gt; for each entry in the interFreqCarrierFreqList:
3&gt; if the UE is not a RedCap UE or if redcapAccessReject is absent:
4&gt; select the first frequency band in the frequencyBandList, and frequencyBandListSUL, if present, which the UE supports and for which the UE supports at least one of the additionalSpectrumEmission values in NR-NS-PmaxList, if present:
4&gt; if, the frequency band selected by the UE in frequencyBandList to represent a non-serving NR carrier frequency is not a downlink only band:
5&gt; if, for the selected frequency band, the UE supports at least one additionalSpectrumEmission in the NR-NS-PmaxList within the frequencyBandList:
6&gt; apply the first listed additionalSpectrumEmission which it supports among the values included in NR-NS-PmaxList within frequencyBandList;
6&gt; if the additionalPmax is present in the same entry of the selected additionalSpectrumEmission within NR-NS-PmaxList:
7&gt; apply the additionalPmax;
7&gt; apply the p-Max;
6&gt; if frequencyBandListSUL is present in SIB4 and, for the frequency band selected in frequencyBandListSUL, the UE supports at least one additionalSpectrumEmission in the NR-NS- PmaxList within FrequencyBandListSUL:
7&gt; apply the first listed additionalSpectrumEmission which it supports among the values included in NR-NS-PmaxList within frequencyBandListSUL;
7&gt; if the additionalPmax is present in the same entry of the selected additionalSpectrumEmission within NR-NS-PmaxList:
8&gt; apply the additionalPmax;
8&gt; apply the p-Max;
7&gt; apply the p-Max;
6&gt; apply the p-Max;
1&gt; if in RRC_IDLE or RRC_INACTIVE, and T331 is running:
2&gt; perform the actions as specified in 5.7.8.1a;
5.2.2.4.6 Actions upon reception of SIB5
No UE requirements related to the contents of this SIB5 apply other than those specified elsewhere e.g. within procedures using the concerned system information, and/ or within the corresponding field descriptions.
5.2.2.4.7 Actions upon reception of SIB6
Upon receiving the SIB6 the UE shall:
1&gt; forward the received warningType, messageIdentifier and serialNumber to upper layers;
5.2.2.4.8 Actions upon reception of SIB7
Upon receiving the SIB7 the UE shall:
1&gt; if there is no current value for messageIdentifier and serialNumber for SIB7; or
1&gt; if either the received value of messageIdentifier or of serialNumber, or of both messageIdentifier and serialNumber are different from the current values of messageIdentifier and serialNumber for SIB7:
2&gt; use the received values of messageIdentifier and serialNumber for SIB7 as the current values of messageIdentifier and serialNumber for SIB7;
2&gt; discard any previously buffered warningMessageSegment;
2&gt; if all segments of a warning message have been received:
3&gt; assemble the warning message from the received warningMessageSegment(s);
3&gt; forward the received warning message, messageIdentifier, serialNumber and dataCodingScheme to upper layers;
3&gt; stop reception of SIB7;
3&gt; discard the current values of messageIdentifier and serialNumber for SIB7;
3&gt; store the received warningMessageSegment;
3&gt; continue reception of SIB7;
1&gt; else if all segments of a warning message have been received:
2&gt; assemble the warning message from the received warningMessageSegment(s);
2&gt; forward the received complete warning message, messageIdentifier, serialNumber and dataCodingScheme to upper layers;
2&gt; stop reception of SIB7;
2&gt; discard the current values of messageIdentifier and serialNumber for SIB7;
2&gt; store the received warningMessageSegment;
2&gt; continue reception of SIB7; The UE should discard any stored warningMessageSegment and the current value of messageIdentifier and serialNumber for SIB7 if the complete warning message has not been assembled within a period of 3 hours.
5.2.2.4.9 Actions upon reception of SIB8
Upon receiving the SIB8 the UE shall:
1&gt; if the SIB8 contains a complete warning message and the complete geographical area coordinates (if any):
2&gt; forward the received warning message, messageIdentifier, serialNumber, dataCodingScheme and the geographical area coordinates (if any) to upper layers;
2&gt; continue reception of SIB8;
2&gt; if the received values of messageIdentifier and serialNumber are the same (each value is the same) as a pair for which a warning message and the geographical area coordinates (if any) are currently being assembled:
3&gt; store the received warningMessageSegment;
3&gt; store the received warningAreaCoordinatesSegment (if any);
3&gt; if all segments of a warning message and geographical area coordinates (if any) have been received:
4&gt; assemble the warning message from the received warningMessageSegment;
4&gt; assemble the geographical area coordinates from the received warningAreaCoordinatesSegment (if any);
4&gt; forward the received warning message, messageIdentifier, serialNumber, dataCodingScheme and geographical area coordinates (if any) to upper layers;
4&gt; stop assembling a warning message and geographical area coordinates (if any) for this messageIdentifier and serialNumber and delete all stored information held for it;
3&gt; continue reception of SIB8;
2&gt; else if the received values of messageIdentifier and/or serialNumber are not the same as any of the pairs for which a warning message is currently being assembled:
3&gt; start assembling a warning message for this messageIdentifier and serialNumber pair;
3&gt; start assembling the geographical area coordinates (if any) for this messageIdentifier and serialNumber pair;
3&gt; store the received warningMessageSegment;
3&gt; store the received warningAreaCoordinatesSegment (if any);
3&gt; continue reception of SIB8; The UE should discard warningMessageSegment and warningAreaCoordinatesSegment (if any) and the associated values of messageIdentifier and serialNumber for SIB8 if the complete warning message and the geographical area coordinates (if any) have not been assembled within a period of 3 hours.
NOTE: The number of warning messages that a UE can re-assemble simultaneously is a function of UE
5.2.2.4.10 Actions upon reception of SIB9
Upon receiving SIB9 with referenceTimeInfo, the UE may perform the related actions as specified in clause 5.7.1.3.
5.2.2.4.11 Actions upon reception of SIB10
Upon receiving SIB10, the UE shall:
1&gt; Forward the HRNN-list entries with the corresponding PNI-NPN and SNPN identities to upper layers;
5.2.2.4.12 Actions upon reception of SIB11
Upon receiving SIB11, the UE shall:
1&gt; if in RRC_IDLE or RRC_INACTIVE, and T331 is running:
2&gt; perform the actions as specified in 5.7.8.1a;
5.2.2.4.13 Actions upon reception of SIB12
Upon receiving SIB12, the UE shall:
1&gt; if the UE has stored at least one segment of SIB12 and the value tag of SIB12 has changed since a previous segment was stored:
2&gt; discard all stored segments;
1&gt; store the segment;
1&gt; if all segments have been received:
2&gt; assemble SIB12-IEs from the received segments;
2&gt; if sl-FreqInfoList is included in sl-ConfigCommonNR:
3&gt; if configured to receive NR sidelink communication:
4&gt; use the resource pool(s) indicated by sl-RxPool for NR sidelink communication reception, as specified in 5.8.7;
3&gt; if configured to transmit NR sidelink communication:
4&gt; use the resource pool(s) indicated by sl-TxPoolSelectedNormal, sl-TxPoolSelectedNormalPS, or sl- TxPoolExceptional for NR sidelink communication transmission, as specified in 5.8.8;
4&gt; perform CBR measurement on the transmission resource pool(s) indicated by sl- TxPoolSelectedNormal, sl-TxPoolSelectedNormalPS and sl-TxPoolExceptional for NR sidelink communication transmission, as specified in 5.5.3.1;
4&gt; use the synchronization configuration parameters for NR sidelink communication on frequencies included in sl-FreqInfoList, as specified in 5.8.5;
3&gt; if configured to receive NR sidelink discovery:
4&gt; use the resource pool(s) indicated by sl-DiscRxPool or sl-RxPool for NR sidelink discovery reception, as specified in 5.8.13.2;
3&gt; if configured to transmit NR sidelink discovery:
4&gt; use the resource pool(s) indicated by sl-DiscTxPoolSelected, sl-TxPoolExceptional or sl- TxPoolSelectedNormal for NR sidelink discovery transmission, as specified in 5.8.13.3;
4&gt; perform CBR measurement on the transmission resource pool(s) indicated by sl- TxPoolSelectedNormal, sl-DiscTxPoolSelected or sl-TxPoolExceptional for NR sidelink discovery transmission, as specified in 5.5.3.1;
4&gt; use the synchronization configuration parameters for NR sidelink discovery on frequencies included in sl-FreqInfoList, as specified in 5.8.5;
2&gt; if sl-RadioBearerConfigList or sl-RLC-BearerConfigList is included in sl-ConfigCommonNR:
3&gt; perform sidelink DRB addition/modification/release as specified in 5.8.9.1a.1/5.8.9.1a.2;
2&gt; if sl-MeasConfigCommon is included in sl-ConfigCommonNR:
3&gt; store the NR sidelink measurement configuration.
2&gt; if sl-DRX-ConfigCommon-GC-BC is included in SIB12-IEs:
3&gt; store the NR sidelink DRX configuration and perform sidelink DRX operation for groupcast and
The UE should discard any stored segments for SIB12 if the complete SIB12 has not been assembled within a period of
3 hours. The UE shall discard any stored segments for SIB12 upon cell (re-)selection.
5.2.2.4.14 Actions upon reception of SIB13
Upon receiving SIB13, the UE shall perform the actions upon reception of SystemInformationBlockType21 as specified in 5.2.2.28 in TS 36.331 .
5.2.2.4.15 Actions upon reception of SIB14
Upon receiving SIB14, the UE shall perform the actions upon reception of SystemInformationBlockType26 as specified in 5.2.2.33 in TS 36.331 .
5.2.2.4.16 Actions upon reception of SIBpos
No UE requirements related to the contents of the SIBpos apply other than those specified elsewhere e.g. within TS
37.355 , and/or within the corresponding field descriptions.
5.2.2.4.17 Actions upon reception of SIB15
Upon receiving SIB15, the UE shall:
1&gt; forward the applicable PLMNs with disaster condition for each PLMN sharing the cell to upper layers.
Editor's note: The one-bit-approach described in the CT1 LS in R2-2109818 may require some modification of the
above. The impact is pending further CT1 input.
5.2.2.4.18 Actions upon reception of SIB16
Upon receiving SIB16 with cell reselection priorities for slicing, the UE shall perform the actions as specified in clause in TS 38.304 .
5.2.2.4.19 Actions upon reception of SIB17
Upon receiving SIB17, the UE shall:
1&gt; if the UE has stored at least one segment of SIB17 and the value tag of SIB17 has changed since a previous segment was stored:
2&gt; discard all stored segments;
1&gt; store the segment;
1&gt; if all segments have been received:
2&gt; assemble SIB17-IEs from the received segments.
The UE should discard any stored segments for SIB17 if the complete SIB17 has not been assembled within a period of
3 hours. The UE shall discard any stored segments for SIB17 upon cell (re-) selection.
5.2.2.4.20 Actions upon reception of SIB18
Upon receiving SIB18, the UE shall:
1&gt; forward the Group IDs for Network selection (GINs) in SIB18 with the corresponding SNPN identities to upper layers;
5.2.2.4.21 Actions upon reception of SIB19
Upon receiving SIB19, the UE shall:
1&gt; instruct the lower layers to start or restart ntn-UlSyncValidityDuration from the subframe indicated by epochTime; NOTE: UE should attempt to re-acquire SIB19 before the end of the duration indicated by ntn- UlSyncValidityDuration and epochTime by UE implementation.
5.2.2.4.22 Actions upon reception of SIB20
No UE requirements related to the contents of SIB20 apply other than those specified elsewhere e.g. within procedures using the concerned system information, and/or within the corresponding field descriptions.
5.2.2.4.23 Actions upon reception of SIB21
No UE requirements related to the contents of SIB21 apply other than those specified elsewhere e.g. within procedures using the concerned system information, and/or within the corresponding field descriptions.
5.2.2.5 Essential system information missing
The UE shall:
1&gt; if in RRC_IDLE or in RRC_INACTIVE or in RRC_CONNECTED while T311 is running:
2&gt; if the UE is unable to acquire the MIB:
3&gt; consider the cell as barred in accordance with TS 38.304 ;
3&gt; perform barring as if intraFreqReselection is set to allowed;
2&gt; else if the UE is unable to acquire the SIB1:
3&gt; consider the cell as barred in accordance with TS 38.304 ;
3&gt; if the UE is a RedCap UE:
4&gt; peform barring as if intraFreqReselectionRedCap is set to allowed;
4&gt; perform cell re-selection to other cells on the same frequency as the barred cell as specified in TS
5.3 Connection control
5.3.1 Introduction
5.3.1.1 RRC connection control RRC connection establishment involves the establishment of SRB1. The network completes RRC connection establishment prior to completing the establishment of the NG connection, i.e. prior to receiving the UE context information from the 5GC. Consequently, AS security is not activated during the initial phase of the RRC connection.
During this initial phase of the RRC connection, the network may configure the UE to perform measurement reporting, but the UE only sends the corresponding measurement reports after successful AS security activation. However, the UE only accepts a re-configuration with sync message when AS security has been activated.
Upon receiving the UE context from the 5GC, the RAN activates AS security (both ciphering and integrity protection) using the initial AS security activation procedure. The RRC messages to activate AS security (command and successful
response) are integrity protected, while ciphering is started only after completion of the procedure. That is, the response to the message used to activate AS security is not ciphered, while the subsequent messages (e.g. used to establish SRB2, DRBs and multicast MRBs) are both integrity protected and ciphered. After having initiated the initial AS security activation procedure, the network may initiate the establishment of SRB2 and DRBs and/or multicast MRBs, i.e. the network may do this prior to receiving the confirmation of the initial AS security activation from the UE. In any case, the network will apply both ciphering and integrity protection for the RRC reconfiguration messages used to establish SRB2, DRBs and multicast MRBs. The network should release the RRC connection if the initial AS security activation and/ or the radio bearer establishment fails. A configuration with SRB2 without DRB or multicast MRB, or with DRB or multicast MRB without SRB2 is not supported (i.e., SRB2 and at least one DRB or multicast MRB must be configured in the same RRC Reconfiguration message, and it is not allowed to release all the DRBs without releasing the RRC Connection). For IAB-MT, a configuration with SRB2 without any DRB/MRB is supported.
The release of the RRC connection normally is initiated by the network. The procedure may be used to re-direct the UE to an NR frequency or an E-UTRA carrier frequency.
The suspension of the RRC connection is initiated by the network. When the RRC connection is suspended, the UE stores the UE Inactive AS context and any configuration received from the network, and transits to RRC_INACTIVE
state. The RRC message to suspend the RRC connection is integrity protected and ciphered.
The resumption of a suspended RRC connection is initiated by upper layers when the UE needs to transit from RRC_INACTIVE state to RRC_CONNECTED state or by RRC layer to perform a RNA update or by RAN paging from NG-RAN or for SDT. When the RRC connection is resumed, network configures the UE according to the RRC connection resume procedure based on the stored UE Inactive AS context and any RRC configuration received from the
network. The RRC connection resume procedure re-activates AS security and re-establishes SRB(s) and DRB(s) and/or multicast MRB(s), if configured.
Upon initiating the resume procedure for SDT, security is re-activated for SRB1 and for the radio bearers configured with SDT. Further, SRB1 and the radio bearers configured for SDT are re-established and resumed whilst the UE remains in RRC_INACTIVE state. Transmission and reception of data and/or signalling messages over radio bearers configured for SDT can happen whilst the UE is in RRC_INACTIVE state and T319a is running.
In response to a request to resume the RRC connection, the network may resume the suspended RRC connection and send UE to RRC_CONNECTED, or reject the request to resume and send UE to RRC_INACTIVE (with a wait timer), or directly re-suspend the RRC connection and send UE to RRC_INACTIVE, or directly release the RRC connection and send UE to RRC_IDLE, or instruct the UE to initiate NAS level recovery (in this case the network sends an RRC setup message).
In response to a resume procedure initiated for SDT, the network may resume the suspended RRC connection and send UE to RRC_CONNECTED, or reject the request to resume and send UE to RRC_INACTIVE (with a wait timer), or directly re-suspend the RRC connection and send UE to RRC_INACTIVE, or directly release the RRC connection and send UE to RRC_IDLE, or instruct the UE to initiate NAS level recovery (in this case the network sends an RRC setup message).
NOTE: In case the UE receives the configurations for NR sidelink communication via the E-UTRA, the configurations for NR sidelink communication in SIB12 and sl-ConfigDedicatedNR within RRCReconfiguration used in clause 5.3 are provided by the configurations in SystemInformationBlockType28 and sl-ConfigDedicatedForNR within RRCConnectionReconfiguration as specified in TS 36.331, respectively.
5.3.1.2 AS Security AS security comprises of the integrity protection and ciphering of RRC signalling (SRBs) and user data (DRBs).
RRC handles the configuration of the AS security parameters which are part of the AS configuration: the integrity protection algorithm, the ciphering algorithm, if integrity protection and/or ciphering is enabled for a DRB and two parameters, namely the keySetChangeIndicator and the nextHopChainingCount, which are used by the UE to determine the AS security keys upon reconfiguration with sync (with key change), connection re-establishment and/or connection
NOTE 0: All DRBs related to the same PDU session have the same enable/disable setting for ciphering and the same enable/disable setting for integrity protection, as specified in TS 33.501 .
RRC integrity protection and ciphering are always activated together, i.e. in one message/procedure. RRC integrity protection and ciphering for SRBs are never de-activated. However, it is possible to switch to a 'NULL' ciphering algorithm (nea0).
The 'NULL' integrity protection algorithm (nia0) is used only for SRBs and for the UE in lim ited service mode, see TS
33.501 and when used for SRBs, integrity protection is disabled for DRBs. In case the NULL' integrity protection algorithm is used, 'NULL' ciphering algorithm is also used.
NOTE 1: Lower layers discard RRC messages for which the integrity protection check has failed and indicate the integrity protection verification check failure to RRC.
The AS applies four different security keys: one for the integrity protection of RRC signalling (K ), one for the RRCint ciphering of RRC signalling (K ), one for integrity protection of user data (K ) and one for the ciphering of user RRCenc UPint data (K ). All four AS keys are derived from the K key. The K key is based on the K key (as specified in UPenc gNB gNB AMF TS 33.501 ), which is handled by upper layers.
The integrity protection and ciphering algorithms can only be changed with reconfiguration with sync. The AS keys (K , K , K , K and K ) change upon reconfiguration with sync (if masterKeyUpdate is included), and gNB RRCint RRCenc UPint UPenc upon connection re-establishment and connection resume.
For each radio bearer an independent counter (COUNT, as specified in TS 38.323 ) is maintained for each direction.
For each radio bearer, the COUNT is used as input for ciphering and integrity protection.
It is not allowed to use the same COUNT value more than once for a given security key. As specified in TS 33.501 clause 6.9.4.1 , the network is responsible for avoiding reuse of the COUNT with the same RB identity and with the same key, e.g. due to the transfer of large volumes of data, release and establishment of new RBs, and multiple termination point changes for RLC-UM bearers and multiple termination point changes for RLC-AM bearer with SN terminated PDCP re-establishment (COUNT reset) due to SN only full configuration whilst the key stream inputs (i.e.
bearer ID, security key) at MN have not been updated. In order to avoid such re-use, the network may e.g. use different RB identities for RB establishments, change the AS security key, or an RRC_CONNECTED to RRC_IDLE/RRC_INACTIVE and then to RRC_CONNECTED transition.
In order to limit the signalling overhead, individual messages/ packets include a short sequence number (PDCP SN, as specified in TS 38.323 ). In addition, an overflow counter mechanism is used: the hyper frame number (HFN, as specified in TS 38.323 ). The HFN needs to be synchronized between the UE and the network.
For each SRB, the value provided by RRC to lower layers to derive the 5-bit BEARER parameter used as input for ciphering and for integrity protection is the value of the corresponding srb-Identity with the MSBs padded with zeroes.
For a UE provided with an sk-counter, keyToUse indicates whether the UE uses the master key (K ) or the secondary gNB key (S-K or S-K ) for a particular DRB. The secondary key is derived from the master key and sk-Counter, as eNB gNB defined in TS 33.501. Whenever there is a need to refresh the secondary key, e.g. upon change of MN with K gNB change or to avoid COUNT reuse, the security key update is used (see 5.3.5.7). When the UE is in NR-DC, the network may provide a UE configured with an SCG with an sk-Counter even when no DRB is setup using the secondary key (S- K ) in order to allow the configuration of SRB3. The network can also provide the UE with an sk-Counter, even if no gNB SCG is configured, when using SN terminated MCG bearers.
5.3.2 Paging
5.3.2.1 General
Paging
The purpose of this procedure is: a) to transmit paging information to a UE in RRC_IDLE or RRC_INACTIVE.
5.3.2.2 Initiation
The network initiates the paging procedure by transmitting the Paging message at the UE's paging occasion as specified in TS 38.304 . The network may address multiple UEs within a Paging message by including one PagingRecord for each UE.
5.3.2.3 Reception of the Paging message by the UE
Upon receiving the Paging message, the UE shall:
1&gt; if in RRC_IDLE, for each of the PagingRecord, if any, included in the Paging message:
2&gt; if the ue-Identity included in the PagingRecord matches the UE identity allocated by upper layers:
3&gt; if upper layers indicate the support of paging cause:
4&gt; forward the ue-Identity, accessType (if present) and paging cause (if determined) to the upper layers;
4&gt; forward the ue-Identity and accessType (if present) to the upper layers;
1&gt; if in RRC_INACTIVE, for each of the PagingRecord, if any, included in the Paging message:
2&gt; if the ue-Identity included in the PagingRecord matches the UE's stored fullI-RNTI:
3&gt; if the UE is configured by upper layers with Access Identity 1:
4&gt; initiate the RRC connection resumption procedure according to 5.3.13 with resumeCause set to mps- PriorityAccess;
3&gt; else if the UE is configured by upper layers with Access Identity 2:
4&gt; initiate the RRC connection resumption procedure according to 5.3.13 with resumeCause set to mcs- PriorityAccess;
3&gt; else if the UE is configured by upper layers with one or more Access Identities equal to 11-15:
4&gt; initiate the RRC connection resumption procedure according to 5.3.13 with resumeCause set to highPriorityAccess;
4&gt; initiate the RRC connection resumption procedure according to 5.3.13 with resumeCause set to mt- Access;
2&gt; else if the ue-Identity included in the PagingRecord matches the UE identity allocated by upper layers:
3&gt; if upper layers indicate the support of paging cause:
4&gt; forward the ue-Identity, accessType (if present) and paging cause (if determined) to the upper layers;
4&gt; forward the ue-Identity and accessType (if present) to the upper layers;
3&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11 with release cause 'other';
1&gt; for each TMGI included in pagingGroupList, if any, included in the Paging message:
2&gt; if the UE has joined an MBS session indicated by the TMGI included in the pagingGroupList:
3&gt; forward the TMGI to the upper layers;
1&gt; if in RRC_INACTIVE and the UE has joined one or more MBS session(s) indicated by the TMGI included in the pagingGroupList; and
1&gt; if none of the ue-Identity included in any of the PagingRecord, if included in the Paging message, matches the UE identity allocated by upper layers:
2&gt; initiate the RRC connection resumption procedure according to 5.3.13 with resumeCause set as below:
3&gt; if the UE is configured by upper layers with Access Identity 1:
4&gt; resumeCause is set to mps-PriorityAccess;
3&gt; else if the UE is configured by upper layers with Access Identity 2:
4&gt; resumeCause is set to mcs-PriorityAccess;
3&gt; else if the UE is configured by upper layers with one or more Access Identities equal to 11-15:
4&gt; resumeCause is set to highPriorityAccess;
4&gt; resumeCause is set to mt-Access.
1&gt; if the UE is acting as a L2 U2N Relay UE, for each of the PagingRecord, if any, included in the Paging message:
2&gt; if the ue-Identity included in the PagingRecord in the Paging message matches the UE identity in sl- PagingIdentity-RemoteUE included in sl-PagingInfo-RemoteUE:
3&gt; inititate the Uu Message transfer in sidelink as specified in 5.8.9.9;
5.3.3 RRC connection establishment
5.3.3.1 General RRCSetupRequest RRCSetup RRCSetupComplete RRCSetupRequest RRCReject
The purpose of this procedure is to establish an RRC connection. RRC connection establishment involves SRB1
establishment. The procedure is also used to transfer the initial NAS dedicated information/ message from the UE to the
The network applies the procedure e.g.as follows: a) When establishing an RRC connection; b) When UE is resuming or re-establishing an RRC connection, and the network is not able to retrieve or verify the UE context. In this case, UE receives RRCSetup and responds with RRCSetupComplete.
5.3.3.1a Conditions for establishing RRC Connection for NR sidelink communication/discovery/V2X sidelink communication
For NR sidelink communication/discovery, an RRC connection establishment is initiated only in the following cases:
1&gt; if configured by upper layers to transmit NR sidelink communication/discovery and related data is available for transmission:
2&gt; if the frequency on which the UE is configured to transmit NR sidelink communication is included in sl- FreqInfoList within SIB12 provided by the cell on which the UE camps; and if the valid version of SIB12 does not include sl-TxPoolSelectedNormal for the concerned frequency; or
2&gt; if the frequency on which the UE is configured to transmit NR sidelink discovery is included in sl- FreqInfoList within SIB12 provided by the cell on which the UE camps; and if the valid version of SIB12 does not include sl-DiscTxPoolSelected or sl-TxPoolSelectedNormal for the concerned frequency; For L2 U2N Relay UE in RRC_IDLE, an RRC connection establishment is initiated in the following cases:
1&gt; if any message is received from a L2 U2N Remote UE via SL-RLC0 as specified in 9.1.1.4 or SL-RLC1 as specified in 9.2.4; For V2X sidelink communication, an RRC connection is initiated only when the conditions specified for V2X sidelink communication in clause 5.3.3.1a of TS 36.331 are met.
NOTE: Upper layers initiate an RRC connection. The interaction with NAS is left to UE implementation.
5.3.3.2 Initiation
The UE initiates the procedure when upper layers request establishment of an RRC connection while the UE is in RRC_IDLE and it has acquired essential system information, or for sidelink communication as specified in clause
The UE shall ensure having valid and up to date essential system information as specified in clause 5.2.2.2 before initiating this procedure.
Upon initiation of the procedure, the UE shall:
1&gt; if the upper layers provide an Access Category and one or more Access Identities upon requesting establishment of an RRC connection:
2&gt; perform the unified access control procedure as specified in 5.3.14 using the Access Category and Access
Identities provided by upper layers;
3&gt; if the access attempt is barred, the procedure ends;
1&gt; if the UE is connected with a L2 U2N Relay UE via PC5-RRC connection (i.e. the UE is a L2 U2N Remote UE):
2&gt; apply the specified configuration of SL-RLC0 as specified in 9.1.1.4;
2&gt; apply the SDAP configuration and PDCP configuration as specified in 9.1.1.2 for SRB0;
1&gt; else:2&gt; apply the default L1 parameter values as specified in corresponding physical layer specifications except for the parameters for which values are provided in SIB1;
2&gt; apply the default MAC Cell Group configuration as specified in 9.2.2;
2&gt; apply the CCCH configuration as specified in 9.1.1.2;
2&gt; apply the timeAlignmentTimerCommon included in SIB1;
1&gt; start timer T300;
1&gt; initiate transmission of the RRCSetupRequest message in accordance with 5.3.3.3;
5.3.3.3 Actions related to transmission of RRCSetupRequest message
The UE shall set the contents of RRCSetupRequest message as follows:
1&gt; set the ue-Identity as follows:
2&gt; if upper layers provide a 5G-S-TMSI:
3&gt; set the ue-Identity to ng-5G-S-TMSI-Part1;
3&gt; draw a 39-bit random value in the range 0..239-1 and set the ue-Identity to this value; NOTE 1: Upper layers provide the 5G-S-TMSI if the UE is registered in the TA of the current cell.
1&gt; if the establishment of the RRC connection is the result of release with redirect with mpsPriorityIndication (either in NR or E-UTRAN):
2&gt; set the establishmentCause to mps-PriorityAccess;
2&gt; set the establishmentCause in accordance with the information received from upper layers; NOTE 2: In case the L2 U2N Relay UE initiates RRC connection establishment according to conditions as specified in 5.3.3.1a, the L2 U2N Relay UE sets the establishmentCause by implementation. If the cause value in the message received from the L2 U2N Remote UE via SL-RLC0 is emergency, mps- PriorityAccess, or mcs-PriorityAccess, the L2 U2N Relay UE can set the same valuel Otherwise, the L2 U2N Relay UE does not set the value as emergency, mps-PriorityAccess, or mcs-PriorityAccess.
The UE shall submit the RRCSetupRequest message to lower layers for transmission.
The UE shall continue cell re-selection related measurements as well as cell re-selection evaluation. If the conditions for cell re-selection are fulfilled, the UE shall perform cell re-selection as specified in 5.3.3.6.
NOTE 3: For L2 U2N Remote UE in RRC_IDLE/INACTIVE, the cell (re)selection procedure as specified in TS
38.304 and relay (re)selection procedure as specified in 5.8.15.3 are performed independently and up to UE implementation to select either a cell or a L2 U2N Relay UE.
5.3.3.4 Reception of the RRCSetup by the UE
The UE shall perform the following actions upon reception of the RRCSetup:
1&gt; if the RRCSetup is received in response to an RRCReestablishmentRequest; or
1&gt; if the RRCSetup is received in response to an RRCResumeRequest or RRCResumeRequest1:
2&gt; discard any stored UE Inactive AS context and suspendConfig;
2&gt; discard any current AS security context including the K key, the K key, the K key and the RRCenc RRCint UPint
K key; UPenc
2&gt; release radio resources for all established RBs except SRB0, including release of the RLC entities, of the associated PDCP entities and of SDAP;
2&gt; release the RRC configuration except for the default L1 parameter values, default MAC Cell Group configuration and CCCH configuration;
2&gt; indicate to upper layers fallback of the RRC connection;
2&gt; discard any application layer measurement reports which were not transmitted yet;
2&gt; inform upper layers about the release of all application layer measurement configurations;
2&gt; stop timer T380, if running;
1&gt; perform the cell group configuration procedure in accordance with the received masterCellGroup and as specified in 5.3.5.5;
1&gt; perform the radio bearer configuration procedure in accordance with the received radioBearerConfig and as specified in 5.3.5.6;
1&gt; if stored, discard the cell reselection priority information provided by the cellReselectionPriorities or inherited from another RAT;
2&gt; stop timer T390 for all access categories;
2&gt; perform the actions as specified in 5.3.14.4;
2&gt; stop timer T302;
2&gt; perform the actions as specified in 5.3.14.4;
1&gt; stop timer T320, if running;
1&gt; if the RRCSetup is received in response to an RRCResumeRequest, RRCResumeRequest1 or RRCSetupRequest:
3&gt; stop timer T331;
3&gt; perform the actions as specified in 5.7.8.3;
2&gt; stop the cell re-selection procedure;
2&gt; stop relay (re)selection procedure if any for L2 U2N Remote UE;
1&gt; consider the current cell to be the PCell;
1&gt; if the RRCSetup message includes the sl-L2RemoteUEConfig (i.e. the UE is a L2 U2N Remote UE):
2&gt; perform the L2 U2N Remote UE configuration procedure as specified in 5.3.5.16;
1&gt; if the UE has radio link failure or handover failure information available in VarRLF-Report and if the RPLMN is included in plmn-IdentityList stored in VarRLF-Report:
2&gt; if reconnectCellId in VarRLF-Report is not set, and if the received RRCSetup is in response to an RRCSetupRequest:
3&gt; if choCellId in VarRLF-Report is set:
4&gt; set timeUntilReconnection in VarRLF-Report to the time that elapsed since the radio link failure or handover failure experienced in the failedPCellId stored in VarRLF-Report;
4&gt; set timeUntilReconnection in VarRLF-Report to the time that elapsed since the last radio link failure or handover failure;
3&gt; set nrReconnectCellId in reconnectCellId in VarRLF-Report to the global cell identity and the tracking area code of the PCell;
1&gt; if the UE supports RLF report for inter-RAT MRO NR as defined in TS 36.306 , and if the UE has radio link failure or handover failure information available in VarRLF-Report of TS 36.331 and if the RPLMN is included in plmn-IdentityList stored in VarRLF-Report of TS 36.331 :
2&gt; if reconnectCellId in VarRLF-Report of TS 36.331 is not set:
3&gt; set timeUntilReconnection in VarRLF-Report of TS 36.331 to the time that elapsed since the last radio link failure or handover failure in LTE;
3&gt; set nrReconnectCellId in reconnectCellId in VarRLF-Report of TS 36.331 to the global cell identity and the tracking area code of the PCell;
1&gt; set the content of RRCSetupComplete message as follows:
2&gt; if upper layers provide a 5G-S-TMSI:
3&gt; if the RRCSetup is received in response to an RRCSetupRequest:
4&gt; set the ng-5G-S-TMSI-Value to ng-5G-S-TMSI-Part2;
4&gt; set the ng-5G-S-TMSI-Value to ng-5G-S-TMSI;
2&gt; if upper layers selected an SNPN or a PLMN and in case of PLMN UE is either allowed or instructed to access the PLMN via a cell for which at least one CAG ID is broadcast:
3&gt; set the selectedPLMN-Identity from the npn-IdentityInfoList;
3&gt; set the selectedPLMN-Identity to the PLMN selected by upper layers from the plmn-IdentityInfoList;
2&gt; if upper layers provide the 'Registered AMF':
3&gt; include and set the registeredAMF as follows:
4&gt; if the PLMN identity of the 'Registered AMF' is different from the PLMN selected by the upper layers:
5&gt; include the plmnIdentity in the registeredAMF and set it to the value of the PLMN identity in the
'Registered AMF' received from upper layers;
4&gt; set the amf-Identifier to the value received from upper layers;
3&gt; include and set the guami-Type to the value provided by the upper layers;
2&gt; if upper layers provide one or more S-NSSAI (see TS 23.003 ):
3&gt; include the s-NSSAI-List and set the content to the values provided by the upper layers;
2&gt; if upper layers provide onboarding request indication:
3&gt; include the onboardingRequest;
2&gt; set the dedicatedNAS-Message to include the information received from upper layers;
2&gt; if connecting as an IAB-node:
3&gt; include the iab-NodeIndication;
2&gt; if the SIB1 contains idleModeMeasurementsNR and the UE has NR idle/inactive measurement information concerning cells other than the PCell available in VarMeasIdleReport; or
2&gt; if the SIB1 contains idleModeMeasurementsEUTRA and the UE has E-UTRA idle/inactive measurement information available in VarMeasIdleReport:
3&gt; include the idleMeasAvailable;
2&gt; if the UE has logged measurements available for NR and if the RPLMN is included in plmn-IdentityList stored in VarLogMeasReport:
3&gt; if the sigLoggedMeasType in VarLogMeasReport is included:
4&gt; include the sigLogMeasConfigAvailable in the RRCSetupComplete message and set it according to the following:
5&gt; if T330 timer is running:
6&gt; set sigLogMeasConfigAvailable to true in the RRCSetupComplete message;
6&gt; set sigLogMeasConfigAvailable to false in the RRCSetupComplete message;
3&gt; include the logMeasAvailable in the RRCSetupComplete message;
3&gt; if Bluetooth measurement results are included in the logged measurements the UE has available for NR:
4&gt; include the logMeasAvailableBT in the RRCSetupComplete message;
3&gt; if WLAN measurement results are included in the logged measurements the UE has available for NR:
4&gt; include the logMeasAvailableWLAN in the RRCSetupComplete message;
2&gt; if the sigLoggedMeasType in VarLogMeasReport is included:
3&gt; if T330 timer is running:
4&gt; set sigLogMeasConfigAvailable to true in the RRCSetupComplete message;
4&gt; if the UE has logged measurements available for NR:
5&gt; set sigLogMeasConfigAvailable to false in the RRCSetupComplete message;
2&gt; if the UE has connection establishment failure or connection resume failure information available in VarConnEstFailReport or VarConnEstFailReportList and if the RPLMN is equal to plmn-Identity stored in VarConnEstFailReport or VarConnEstFailReportList:
3&gt; include connEstFailInfoAvailable in the RRCSetupComplete message;
2&gt; if the UE has radio link failure or handover failure information available in VarRLF-Report and if the RPLMN is included in plmn-IdentityList stored in VarRLF-Report, or
2&gt; if the UE has radio link failure or handover failure information available in VarRLF-Report of TS 36.331
, and if the UE is capable of cross-RAT RLF reporting and if the RPLMN is included in plmn- IdentityList stored in VarRLF-Report of TS 36.331 :
3&gt; include rlf-InfoAvailable in the RRCSetupComplete message;
2&gt; if the UE has successful handover information available in VarSuccessHO-Report and if the RPLMN is included in plmn-IdentityList stored in VarSuccessHO-Report:
3&gt; include successHO-InfoAvailable in the RRCSetupComplete message;
2&gt; if the UE supports storage of mobility history information and the UE has mobility history information available in VarMobilityHistoryReport:
3&gt; include the mobilityHistoryAvail in the RRCSetupComplete message;
2&gt; if the RRCSetup is received in response to an RRCResumeRequest, RRCResumeRequest1 or RRCSetupRequest:
3&gt; if speedStateReselectionPars is configured in the SIB2:
4&gt; include the mobilityState in the RRCSetupComplete message and set it to the mobility state (as specified in TS 38.304 ) of the UE just prior to entering RRC_CONNECTED state;
1&gt; submit the RRCSetupComplete message to lower layers for transmission, upon which the procedure ends.
5.3.3.5 Reception of the RRCReject by the UE
The UE shall:
1&gt; perform the actions as specified in 5.3.15;
5.3.3.6 Cell re-selection or cell selection while T390, T300 or T302 is running (UE in RRC_IDLE)
The UE shall:
1&gt; if cell reselection occurs while T300 or T302 is running; or
1&gt; if relay reselection occurs while T300 is running; or
1&gt; if cell changes due to relay reselection while T302 is running:
2&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11 with release cause 'RRC connection failure';
1&gt; else if cell selection or reselection occurs while T390 is running, or cell change due to relay selection or reselection occurs while T390 is running:
2&gt; stop T390 for all access categories;
2&gt; perform the actions as specified in 5.3.14.4.
The UE shall:
2&gt; reset MAC, release the MAC configuration and re-establish RLC for all RBs that are established;
2&gt; if the UE supports RRC Connection Establishment failure with temporary offset and the T300 has expired a consecutive connEstFailCount times on the same cell for which connEstFailureControl is included in SIB1:
3&gt; for a period as indicated by connEstFailOffsetValidity:
4&gt; use connEstFailOffset for the parameter Qoffsettemp for the concerned cell when performing cell selection and reselection according to TS 38.304 and TS 36.304 ; NOTE 1: When performing cell selection, if no suitable or acceptable cell can be found, it is up to UE implementation whether to stop using connEstFailOffset for the parameter Qoffsettemp during connEstFailOffsetValidity for the concerned cell.
2&gt; if the UE has connection establishment failure information or connection resume failure information available in VarConnEstFailReport and if the RPLMN is not equal to plmn-identity stored in VarConnEstFailReport; or
2&gt; if the cell identity of current cell is not equal to the cell identity stored in measResultFailedCell in VarConnEstFailReport:
3&gt; reset the numberOfConnFail to 0;
2&gt; clear the content included in VarConnEstFailReport except for the numberOfConnFail, if any;
2&gt; store the following connection establishment failure information in the VarConnEstFailReport by setting its fields as follows:
3&gt; set the plmn-Identity to the PLMN selected by upper layers (see TS 24.501 ) from the PLMN(s) included in the plmn-IdentityInfoList in SIB1;
3&gt; set the measResultFailedCell to include the global cell identity, tracking area code, the cell level and SS/PBCH block level RSRP, and RSRQ, and SS/PBCH block indexes, of the failed cell based on the available SSB measurements collected up to the moment the UE detected connection establishment failure;
3&gt; if available, set the measResultNeighCells, in order of decreasing ranking-criterion as used for cell re- selection, to include neighbouring cell measurements for at most the following number of neighbouring cells: 6 intra-frequency and 3 inter-frequency neighbours per frequency as well as 3 inter-RAT neighbours, per frequency/ set of frequencies per RAT and according to the following:
4&gt; for each neighbour cell included, include the optional fields that are available; NOTE 2: The UE includes the latest results of the available measurements as used for cell reselection evaluation, which are performed in accordance with the performance requirements as specified in TS 38.133 .
3&gt; if available, set the locationInfo as follows:
4&gt; if available, set the commonLocationInfo to include the detailed location information
4&gt; if available, set the bt-LocationInfo to include the Bluetooth measurement results, in order of decreasing RSSI for Bluetooth beacons;
4&gt; if available, set the wlan-LocationInfo to include the WLAN measurement results, in order of decreasing RSSI for WLAN APs;
4&gt; if available, set the sensor-LocationInfo to include the sensor measurement results as follows;
5&gt; if available, include the sensor-MeasurementInformation;
5&gt; if available, include the sensor-MotionInformation; NOTE 3: Which location information related configuration is used by the UE to make the locationInfo available for inclusion in the VarConnEstFailReport is left to UE implementation.
3&gt; set perRAInfoList to indicate the performed random access procedure related information as specified in
3&gt; if the numberOfConnFail is smaller than 8:
4&gt; increment the numberOfConnFail by 1;
2&gt; inform upper layers about the failure to establish the RRC connection, upon which the procedure ends; The UE may discard the connection establishment failure or connection resume failure information, i.e. release the UE variable VarConnEstFailReport, 48 hours after the last connection establishment failure is detected.
The L2 U2N Relay UE either triggers PC5-S release or sends Notification message to the connected L2 U2N Remote UE(s) in accordance with 5.8.9.10.
5.3.3.8 Abortion of RRC connection establishment
If upper layers abort the RRC connection establishment procedure, due to a NAS procedure being aborted as specified in TS 24.501 , while the UE has not yet entered RRC_CONNECTED, the UE shall:
1&gt; stop timer T300, if running;
1&gt; reset MAC, release the MAC configuration and re-establish RLC for all RBs that are established.
5.3.4 Initial AS security activation
5.3.4.1 General SecurityModeCommand SecurityModeComplete SecurityModeCommand SecurityModeFailure
The purpose of this procedure is to activate AS security upon RRC connection establishment.
5.3.4.2 Initiation
The network initiates the security mode command procedure to a UE in RRC_CONNECTED. Moreover, the network applies the procedure as follows: a) when only SRB1 is established, i.e. prior to establishment of SRB2, multicast MRBs and/ or DRBs.
5.3.4.3 Reception of the SecurityModeCommand by the UE
The UE shall:
1&gt; derive the K key, as specified in TS 33.501 ; gNB
1&gt; derive the K key associated with the integrityProtAlgorithm indicated in the SecurityModeCommand RRCint message, as specified in TS 33.501 ;
1&gt; request lower layers to verify the integrity protection of the SecurityModeCommand message, using the algorithm indicated by the integrityProtAlgorithm as included in the SecurityModeCommand message and the
K key; RRCint
1&gt; if the SecurityModeCommand message passes the integrity protection check:
2&gt; derive the K key and the K key associated with the cipheringAlgorithm indicated in the RRCenc UPenc SecurityModeCommand message, as specified in TS 33.501 ;
2&gt; derive the K key associated with the integrityProtAlgorithm indicated in the SecurityModeCommand UPint message, as specified in TS 33.501 ;
2&gt; configure lower layers to apply SRB integrity protection using the indicated algorithm and the K key RRCint immediately, i.e. integrity protection shall be applied to all subsequent messages received and sent by the UE, including the SecurityModeComplete message;
2&gt; configure lower layers to apply SRB ciphering using the indicated algorithm, the K keyafter completing RRCenc the procedure, i.e. ciphering shall be applied to all subsequent messages received and sent by the UE, except for the SecurityModeComplete message which is sent unciphered;
2&gt; consider AS security to be activated;
2&gt; submit the SecurityModeComplete message to lower layers for transmission, upon which the procedure ends;
2&gt; continue using the configuration used prior to the reception of the SecurityModeCommand message, i.e.
neither apply integrity protection nor ciphering.
2&gt; submit the SecurityModeFailure message to lower layers for transmission, upon which the procedure ends.
5.3.5 RRC reconfiguration
5.3.5.1 General RRCReconfiguration RRCReconfigurationComplete RRCReconfiguration RRC connection re-establishment
The purpose of this procedure is to modify an RRC connection, e.g. to establish/modify/release RBs/BH RLC channels, to perform reconfiguration with sync, to setup/modify/release measurements, to add/modify/release SCells and cell groups, to add/modify/release conditional handover configuration, to add/modify/release conditional PSCell change or conditional PSCell addition configuration. As part of the procedure, NAS dedicated information may be transferred from the Network to the UE.
RRC reconfiguration to perform reconfiguration with sync includes, but is not limited to, the following cases: a) reconfiguration with sync and security key refresh, involving RA to the PCell/PSCell, MAC reset, refresh of security and re-establishment of RLC and PDCP triggered by explicit L2 indicators; b) reconfiguration with sync but without security key refresh, involving RA to the PCell/PSCell, MAC reset and RLC re-establishment and PDCP data recovery (for AM DRB or AM MRB) triggered by explicit L2 indicators. c) reconfiguration with sync for DAPS and security key refresh, involving RA to the target PCell, establishment of target MAC, and d) for non-DAPS bearer: refresh of security and re-establishment of RLC and PDCP triggered by explicit L2 indicators; e) for DAPS bearer: establishment of RLC for the target PCell, refresh of security and reconfiguration of PDCP to add the ciphering function, the integrity protection function and ROHC function of the target PCell; f) for SRB: refresh of security and establishment of RLC and PDCP for the target PCell; g) reconfiguration with sync for DAPS but without security key refresh, involving RA to the target PCell, establishment of target MAC, and h) for non-DAPS bearer: RLC re-establishment and PDCP data recovery (for AM DRB or AM MRB) triggered by explicit L2 indicators. i) for DAPS bearer: establishment of RLC for target PCell, reconfiguration of PDCP to add the ciphering function, the integrity protection function and ROHC function of the target PCell; j) for SRB: establishment of RLC and PDCP for the target PCell.
5.3.5.2 Initiation
The Network may initiate the RRC reconfiguration procedure to a UE in RRC_CONNECTED. The Network applies the procedure as follows: a) the establishment of RBs (other than SRB1, that is established during RRC connection establishment) is performed only when AS security has been activated; b) the establishment of BH RLC Channels for IAB is performed only when AS security has been activated; c) the establishment of Uu Relay RLC channels for L2 U2N Relay UE is performed only when AS security has been activated; d) the addition of Secondary Cell Group and SCells is performed only when AS security has been activated; e) the reconfigurationWithSync is included in secondaryCellGroup only when at least one RLC bearer or BH RLC channel is setup in SCG; f) the reconfigurationWithSync is included in masterCellGroup only when AS security has been activated, and SRB2 with at least one DRB or multicast MRB or, for IAB, SRB2, are setup and not suspended; g) the conditionalReconfiguration for CPC is included only when at least one RLC bearer is setup in SCG; h) the conditionalReconfiguration for CHO or CPA is included only when AS security has been activated, and SRB2 with at least one DRB or, for IAB, SRB2, are setup and not suspended.
5.3.5.3 Reception of an RRCReconfiguration by the UE
The UE shall perform the following actions upon reception of the RRCReconfiguration, or upon execution of the conditional reconfiguration (CHO, CPA or CPC):
1&gt; if the RRCReconfiguration was received neither within mrdc-SecondaryCellGroup nor within E-UTRA RRCConnectionReconfiguration nor within E-UTRA RRCConnectionResume:
2&gt; if the RRCReconfiguration includes the scg-State:
3&gt; perform SCG deactivation as specified in 5.3.5.13b;
3&gt; perform SCG activation as specified in 5.3.5.13a; Editor's note: FFS how to ensure that the notification to MAC is only processed at the time the SCG configuration is processed, if included.
1&gt; if the RRCReconfiguration is applied due to a conditional reconfiguration execution upon cell selection performed while timer T311 was running, as defined in 5.3.7.3:
2&gt; remove all the entries within VarConditionalReconfig, if any;
1&gt; if the RRCReconfiguration includes the daps-SourceRelease:
2&gt; reset the source MAC and release the source MAC configuration;
2&gt; for each DAPS bearer:
3&gt; release the RLC entity or entities as specified in TS 38.322 , clause 5.1.3, and the associated logical channel for the source SpCell;
3&gt; reconfigure the PDCP entity to release DAPS as specified in TS 38.323 ;
2&gt; for each SRB:
3&gt; release the PDCP entity for the source SpCell;
3&gt; release the RLC entity as specified in TS 38.322 , clause 5.1.3, and the associated logical channel for the source SpCell;
2&gt; release the physical channel configuration for the source SpCell;
2&gt; discard the keys used in the source SpCell (the K key, the K key, the K key, the K key and gNB RRCenc RRCint UPint the K key), if any; UPenc
1&gt; if the RRCReconfiguration is received via other RAT (i.e., inter-RAT handover to NR):
2&gt; if the RRCReconfiguration does not include the fullConfig and the UE is connected to 5GC (i.e., delta signalling during intra 5GC handover):
3&gt; re-use the source RAT SDAP and PDCP configurations if available (i.e., current SDAP/PDCP configurations for all RBs from source E-UTRA RAT prior to the reception of the inter-RAT HO RRCReconfiguration message);
2&gt; if the RRCReconfiguration includes the fullConfig:
3&gt; perform the full configuration procedure as specified in 5.3.5.11;
1&gt; if the RRCReconfiguration includes the masterCellGroup:
2&gt; perform the cell group configuration for the received masterCellGroup according to 5.3.5.5;
1&gt; if the RRCReconfiguration includes the masterKeyUpdate:
2&gt; perform AS security key update procedure as specified in 5.3.5.7;
1&gt; if the RRCReconfiguration includes the sk-Counter:
2&gt; perform security key update procedure as specified in 5.3.5.7;
1&gt; if the RRCReconfiguration includes the secondaryCellGroup:
2&gt; perform the cell group configuration for the SCG according to 5.3.5.5;
1&gt; if the RRCReconfiguration includes the mrdc-SecondaryCellGroupConfig:
2&gt; if the mrdc-SecondaryCellGroupConfig is set to setup:
3&gt; if the mrdc-SecondaryCellGroupConfig includes mrdc-ReleaseAndAdd:
4&gt; perform MR-DC release as specified in clause 5.3.5.10;
3&gt; if the received mrdc-SecondaryCellGroup is set to nr-SCG:
4&gt; perform the RRC reconfiguration according to 5.3.5.3 for the RRCReconfiguration message included in nr-SCG;
3&gt; if the received mrdc-SecondaryCellGroup is set to eutra-SCG:
4&gt; perform the RRC connection reconfiguration as specified in TS 36.331 , clause 5.3.5.3 for the RRCConnectionReconfiguration message included in eutra-SCG;
2&gt; else (mrdc-SecondaryCellGroupConfig is set to release):
3&gt; perform MR-DC release as specified in clause 5.3.5.10;
1&gt; if the RRCReconfiguration message includes the radioBearerConfig:
2&gt; perform the radio bearer configuration according to 5.3.5.6;
1&gt; if the RRCReconfiguration message includes the radioBearerConfig2:
2&gt; perform the radio bearer configuration according to 5.3.5.6;
1&gt; if the RRCReconfiguration message includes the measConfig:
2&gt; perform the measurement configuration procedure as specified in 5.5.2;
1&gt; if the RRCReconfiguration message includes the dedicatedNAS-MessageList:
2&gt; forward each element of the dedicatedNAS-MessageList to upper layers in the same order as listed;
1&gt; if the RRCReconfiguration message includes the dedicatedSIB1-Delivery:
2&gt; perform the action upon reception of SIB1 as specified in 5.2.2.4.2; NOTE 0: If this RRCReconfiguration is associated to the MCG and includes reconfigurationWithSync in spCellConfig and dedicatedSIB1-Delivery, the UE initiates (if needed) the request to acquire required SIBs, according to clause 5.2.2.3.5, only after the random access procedure towards the target SpCell is
1&gt; if the RRCReconfiguration message includes the dedicatedSystemInformationDelivery:
2&gt; perform the action upon reception of System Information as specified in 5.2.2.4;
1&gt; if the RRCReconfiguration message includes the dedicatedPosSysInfoDelivery:
2&gt; perform the action upon reception of the contained posSIB(s), as specified in clause 5.2.2.4.16;
1&gt; if the RRCReconfiguration message includes the otherConfig:
2&gt; perform the other configuration procedure as specified in 5.3.5.9;
1&gt; if the RRCReconfiguration message includes the bap-Config:
2&gt; perform the BAP configuration procedure as specified in 5.3.5.12;
1&gt; if the RRCReconfiguration message includes the iab-IP-AddressConfigurationList:
3&gt; perform release of IP address as specified in 5.3.5.12a.1.1;
3&gt; perform IAB IP address addition/update as specified in 5.3.5.12a.1.2;
1&gt; if the RRCReconfiguration message includes the conditionalReconfiguration:
2&gt; perform conditional reconfiguration as specified in 5.3.5.13;
1&gt; if the RRCReconfiguration message includes the needForGapsConfigNR:
2&gt; if needForGapsConfigNR is set to setup:
3&gt; consider itself to be configured to provide the measurement gap requirement information of NR target bands;
3&gt; consider itself not to be configured to provide the measurement gap requirement information of NR target bands;
1&gt; if the RRCReconfiguration message includes the needForNCSG-ConfigNR:
2&gt; if needForNCSG-ConfigNR is set to setup:
3&gt; consider itself to be configured to provide the measurement gap and NCSG requirement information of NR target bands;
3&gt; consider itself not to be configured to provide the measurement gap and NCSG requirement information of NR target bands;
1&gt; if the RRCReconfiguration message includes the needForNCSG-ConfigEUTRA:
2&gt; if needForNCSG-ConfigEUTRA is set to setup:
3&gt; consider itself to be configured to provide the measurement gap and NCSG requirement information of E-UTRA target bands;
3&gt; consider itself not to be configured to provide the measurement gap and NCSG requirement information of E-UTRA target bands;
1&gt; if the RRCReconfiguration message includes the sl-ConfigDedicatedNR:
2&gt; perform the sidelink dedicated configuration procedure as specified in 5.3.5.14; NOTE 0a: If the sl-ConfigDedicatedNR was received embedded within an E-UTRA RRCConnectionReconfiguration message, the UE does not build an NR RRCReconfigurationComplete message for the received sl- ConfigDedicatedNR.
1&gt; if the RRCReconfiguration message includes the sl-L2RelayUEConfig:
2&gt; perform the L2 U2N Relay UE configuration procedure as specified in 5.3.5.15;
1&gt; if the RRCReconfiguration message includes the sl-L2RemoteUEConfig:
2&gt; perform the L2 U2N Remote UE configuration procedure as specified in 5.3.5.16;
1&gt; if the RRCReconfiguration message includes the dedicatedPagingDelivery:
2&gt; if the ue-Identity included in the PagingRecord in the Paging message matches the UE identity in sl- PagingIdentity-RemoteUE in sl-PagingInfo-RemoteUE received in RemoteUEInformationSidelink message in accordance with 5.8.9.8.3:
3&gt; inititate the Uu Message transfer in sidelink as specified in 5.8.9.9;
1&gt; if the RRCReconfiguration message includes the sl-ConfigDedicatedEUTRA-Info:
2&gt; perform related procedures for V2X sidelink communication in accordance with TS 36.331 , clause
5.3.10 and clause 5.5.2;
1&gt; if the RRCReconfiguration message includes the ul-GapFR2-Config:
2&gt; perform the FR2 UL gap configuration procedure as specified in 5.3.5.13c;
1&gt; if the RRCReconfiguration message includes the musim-GapConfig:
2&gt; for each periodic musim-GapID included in the received musim-GapToReleaseList:
3&gt; release the MUSIM periodic gap associated to the musim-GapID from the musim-GapConfigList;
2&gt; for each periodic musim-GapID included in the received musim-GapToAddModList:
3&gt; if an entry with the matching musim-GapID exists in the musim-GapConfigList:
4&gt; replace the entry with the value received for this musim-GapID;
4&gt; add a new entry for this musim-GapID;
1&gt; if the RRCReconfiguration message includes the appLayerMeasConfig:
2&gt; perform the application layer measurement configuration procedure as specified in 5.3.5.13d;
1&gt; set the content of the RRCReconfigurationComplete message as follows:
2&gt; if the RRCReconfiguration includes the masterCellGroup containing the reportUplinkTxDirectCurrent:
3&gt; include the uplinkTxDirectCurrentList for each MCG serving cell with UL;
3&gt; include uplinkDirectCurrentBWP-SUL for each MCG serving cell configured with SUL carrier, if any, within the uplinkTxDirectCurrentList;
2&gt; if the RRCReconfiguration includes the masterCellGroup containing the reportUplinkTxDirectCurrentTwoCarrier:
3&gt; include in the uplinkTxDirectCurrentTwoCarrierList the list of uplink Tx DC locations for the configured intra-band uplink carrier aggregation in the MCG;
2&gt; if the RRCReconfiguration includes the secondaryCellGroup containing the reportUplinkTxDirectCurrent:
3&gt; include the uplinkTxDirectCurrentList for each SCG serving cell with UL;
3&gt; include uplinkDirectCurrentBWP-SUL for each SCG serving cell configured with SUL carrier, if any, within the uplinkTxDirectCurrentList;
2&gt; if the RRCReconfiguration includes the secondaryCellGroup containing the reportUplinkTxDirectCurrentTwoCarrier:
3&gt; include in the uplinkTxDirectCurrentTwoCarrierList the list of uplink Tx DC locations for the configured intra-band uplink carrier aggregation in the SCG; NOTE 0b: It is expected that the reportUplinkTxDirectCurrentTwoCarrier is only received either in masterCellGroup or in secondaryCellGroup but not both.
2&gt; if the RRCReconfiguration message includes the mrdc-SecondaryCellGroupConfig with mrdc- SecondaryCellGroup set to eutra-SCG:
3&gt; include in the eutra-SCG-Response the E-UTRA RRCConnectionReconfigurationComplete message in accordance with TS 36.331 clause 5.3.5.3;
2&gt; if the RRCReconfiguration message includes the mrdc-SecondaryCellGroupConfig with mrdc- SecondaryCellGroup set to nr-SCG:
3&gt; include in the nr-SCG-Response the SCG RRCReconfigurationComplete message;
3&gt; if the RRCReconfiguration message is applied due to conditional reconfiguration execution:
4&gt; include in the selectedCondRRCReconfig the condReconfigId for the selected cell of conditional reconfiguration execution;
2&gt; if the RRCReconfiguration includes the reconfigurationWithSync in spCellConfig of an MCG:
3&gt; if the UE has logged measurements available for NR and if the RPLMN is included in plmn-IdentityList stored in VarLogMeasReport:
4&gt; if the sigLoggedMeasType in VarLogMeasReport is included:
5&gt; include the sigLogMeasConfigAvailable in the RRCReconfigurationComplete message and set it according to the following:
6&gt; if T330 timer is running:
7&gt; set sigLogMeasConfigAvailable to true in the RRCReconfigurationComplete message;
7&gt; set sigLogMeasConfigAvailable to false in the RRCReconfigurationComplete message;
4&gt; include the logMeasAvailable in the RRCReconfigurationComplete message;
4&gt; if Bluetooth measurement results are included in the logged measurements the UE has available for NR:
5&gt; include the logMeasAvailableBT in the RRCReconfigurationComplete message;
4&gt; if WLAN measurement results are included in the logged measurements the UE has available for NR:
5&gt; include the logMeasAvailableWLAN in the RRCReconfigurationComplete message;
3&gt; if the sigLoggedMeasType in VarLogMeasReport is included:
4&gt; if T330 timer is running:
5&gt; set sigLogMeasConfigAvailable to true in the RRCReconfigurationComplete message;
5&gt; if the UE has logged measurements available for NR:
6&gt; set sigLogMeasConfigAvailable to false in the RRCReconfigurationComplete message;
3&gt; if the UE has connection establishment failure or connection resume failure information available in VarConnEstFailReport or VarConnEstFailReportList and if the RPLMN is equal to plmn-Identity stored in VarConnEstFailReport or VarConnEstFailReportList:
4&gt; include connEstFailInfoAvailable in the RRCReconfigurationComplete message;
3&gt; if the UE has radio link failure or handover failure information available in VarRLF-Report and if the RPLMN is included in plmn-IdentityList stored in VarRLF-Report; or
3&gt; if the UE has radio link failure or handover failure information available in VarRLF-Report of TS 36.331 IdentityList stored in VarRLF-Report of TS 36.331 :
4&gt; include rlf-InfoAvailable in the RRCReconfigurationComplete message;
3&gt; if the UE was configured with successHO-Config when connected to the source PCell; and
3&gt; if the applied RRCReconfiguration is not due to a conditional reconfiguration execution upon cell selection performed while timer T311 was running, as defined in 5.3.7.3:
4&gt; perform the actions for the successful handover report determination as specified in clause 5.7.10.6, upon successfully completing the Random Access procedure triggered for the reconfigurationWithSync in spCellConfig of the MCG;
3&gt; if the UE has successful handover information available in VarSuccessHO-Report and if the RPLMN is included in plmn-IdentityList stored in VarSuccessHO-Report:
4&gt; include successHO-InfoAvailable in the RRCReconfigurationComplete message;
2&gt; if the RRCReconfiguration message was received via SRB1, but not within mrdc-SecondaryCellGroup or E- UTRA RRCConnectionReconfiguration or E-UTRA RRCConnectionResume:
3&gt; if the UE is configured to provide the measurement gap requirement information of NR target bands:
4&gt; if the RRCReconfiguration message includes the needForGapsConfigNR; or
4&gt; if the NeedForGapsInfoNR information is changed compared to last time the UE reported this information:
5&gt; include the NeedForGapsInfoNR and set the contents as follows:
6&gt; include intraFreq-needForGap and set the gap requirement information of intra-frequency measurement for each NR serving cell;
6&gt; if requestedTargetBandFilterNR is configured, for each supported NR band that is also included in requestedTargetBandFilterNR, include an entry in interFreq-needForGap and set the gap requirement information for that band; otherwise, include an entry in interFreq- needForGap and set the corresponding gap requirement information for each supported NR band;
3&gt; if the UE is configured to provide the measurement gap and NCSG requirement information of NR target bands:
4&gt; if the RRCReconfiguration message includes the needForNCSG-ConfigNR; or
4&gt; if the needForNCSG-InfoNR information is changed compared to last time the UE reported this information:
5&gt; include the NeedForNCSG-InfoNR and set the contents as follows:
6&gt; include intraFreq-needForNCSG and set the gap and NCSG requirement information of intra- frequency measurement for each NR serving cell;
6&gt; if requestedTargetBandFilterNCSG-NR is configured, for each supported NR band included in requestedTargetBandFilterNCSG-NR, include an entry in interFreq-needForNCSG and set the NCSG requirement information for that band; otherwise, include an entry for each supported NR band in interFreq-needForNCSG and set the corresponding NCSG requirement information;
3&gt; if the UE is configured to provide the measurement gap and NCSG requirement information of E-UTRA target bands:
4&gt; if the RRCReconfiguration message includes the needForNCSG-ConfigEUTRA; or
4&gt; if the needForNCSG-InfoEUTRA information is changed compared to last time the UE reported this information:
5&gt; include the NeedForNCSG-InfoEUTRA and set the contents as follows:
6&gt; if requestedTargetBandFilterNCSG-EUTRA is configured, for each supported E-UTRA band included in requestedTargetBandFilterNCSG-EUTRA, include an entry in needForNCSG- EUTRA and set the NCSG requirement information for that band; otherwise, include an entry for each supported E-UTRA band in needForNCSG-EUTRA and set the corresponding NCSG requirement information;
1&gt; if the UE is configured with E-UTRA nr-SecondaryCellGroupConfig (UE in (NG)EN-DC):
2&gt; if the RRCReconfiguration message was received via E-UTRA SRB1 as specified in TS 36.331 ; or
2&gt; if the RRCReconfiguration message was received via E-UTRA RRC message RRCConnectionReconfiguration within MobilityFromNRCommand (handover from NR standalone to (NG)EN-DC);
3&gt; if the RRCReconfiguration is applied due to a conditional reconfiguration execution for CPC which is configured via conditionalReconfiguration contained in nr-SecondaryCellGroupConfig specified in TS
4&gt; submit the RRCReconfigurationComplete message via the E-UTRA MCG embedded in E-UTRA RRC message ULInformationTransferMRDC as specified in TS 36.331 , clause 5.6.2a.
3&gt; else if the RRCReconfiguration message was included in E-UTRA RRCConnectionResume message:
4&gt; submit the RRCReconfigurationComplete message via E-UTRA embedded in E-UTRA RRC message RRCConnectionResumeComplete as specified in TS 36.331 , clause 5.3.3.4a;
4&gt; submit the RRCReconfigurationComplete via E-UTRA embedded in E-UTRA RRC message RRCConnectionReconfigurationComplete as specified in TS 36.331 , clause
3&gt; if the scg-State is not included in the E-UTRA RRCConnectionReconfiguration message containing the RRCReconfiguration message:
4&gt; if reconfigurationWithSync was included in spCellConfig of an SCG; or
4&gt; if the SCG was deactivated before the reception of the E-UTRA RRC message containing the RRCReconfiguration message and lower layers consider that a Random Access procedure is needed for SCG activation:
5&gt; initiate the Random Access procedure on the SpCell, as specified in TS 38.321 ;
5&gt; the procedure ends;
4&gt; the procedure ends;
2&gt; if the RRCReconfiguration message was received within nr-SecondaryCellGroupConfig in RRCConnectionReconfiguration message received via SRB3 within DLInformationTransferMRDC:
3&gt; submit the RRCReconfigurationComplete via E-UTRA embedded in E-UTRA RRC message RRCConnectionReconfigurationComplete as specified in TS 36.331 , clause 5.3.5.3/5.3.5.4;
3&gt; if reconfigurationWithSync was included in spCellConfig of an SCG:
4&gt; initiate the Random Access procedure on the SpCell, as specified in TS 38.321 ;
4&gt; the procedure ends; NOTE 1: The order the UE sends the RRCConnectionReconfigurationComplete message and performs the Random
Access procedure towards the SCG is left to UE implementation.
2&gt; else (RRCReconfiguration was received via SRB3) but not within DLInformationTransferMRDC:
3&gt; submit the RRCReconfigurationComplete message via SRB3 to lower layers for transmission using the new configuration; NOTE 2: In (NG)EN-DC and NR-DC, in the case RRCReconfiguration is received via SRB1 or within DLInformationTransferMRDC via SRB3, the random access is triggered by RRC layer itself as there is not necessarily other UL transmission. In the case RRCReconfiguration is received via SRB3 but not within DLInformationTransferMRDC, the random access is triggered by the MAC layer due to arrival of RRCReconfigurationComplete.
1&gt; else if the RRCReconfiguration message was received via SRB1 within the nr-SCG within mrdc- SecondaryCellGroup (UE in NR-DC, mrdc-SecondaryCellGroup was received in RRCReconfiguration or RRCResume via SRB1):
2&gt; if the RRCReconfiguration is applied due to a conditional reconfiguration execution for CPC which is configured via conditionalReconfiguration contained in nr-SCG within mrdc-SecondaryCellGroup:
3&gt; submit the RRCReconfigurationComplete message via the NR MCG embedded in NR RRC message ULInformationTransferMRDC as specified in clause 5.7.2a.3.
2&gt; if the scg-State is not included in the RRCReconfiguration or RRCResume message containing the RRCReconfiguration message:
3&gt; if reconfigurationWithSync was included in spCellConfig in nr-SCG; or
3&gt; if the SCG was deactivated before the reception of the NR RRC message containing the RRCReconfiguration message and lower layers consider that a Random Access procedure is needed for SCG activation:
4&gt; initiate the Random Access procedure on the PSCell, as specified in TS 38.321 ;
4&gt; the procedure ends;
2&gt; else
3&gt; the procedure ends; NOTE 2a: The order in which the UE sends the RRCReconfigurationComplete message and performs the Random
Access procedure towards the SCG is left to UE implementation.
1&gt; else if the RRCReconfiguration message was received via SRB3 (UE in NR-DC):
2&gt; if the RRCReconfiguration message was received within DLInformationTransferMRDC:
3&gt; if the RRCReconfiguration message was received within the nr-SCG within mrdc-SecondaryCellGroup (NR SCG RRC Reconfiguration):
4&gt; if reconfigurationWithSync was included in spCellConfig in nr-SCG:
5&gt; initiate the Random Access procedure on the PSCell, as specified in TS 38.321 ;
5&gt; the procedure ends;
4&gt; submit the RRCReconfigurationComplete message via SRB1 to lower layers for transmission using the new configuration;
3&gt; submit the RRCReconfigurationComplete message via SRB3 to lower layers for transmission using the new configuration;
1&gt; else (RRCReconfiguration was received via SRB1):
2&gt; submit the RRCReconfigurationComplete message via SRB1 to lower layers for transmission using the new configuration;
2&gt; if this is the first RRCReconfiguration message after successful completion of the RRC re-establishment procedure:
3&gt; resume SRB2, SRB4, and DRBs, multicast MRB, and BH RLC channels for IAB-MT, that are suspended;
1&gt; if reconfigurationWithSync was included in spCellConfig of an MCG or SCG, and when MAC of an NR cell group successfully completes a Random Access procedure triggered above:
2&gt; stop timer T304 for that cell group;
2&gt; stop timer T310 for source SpCell if running;
2&gt; apply the parts of the CSI reporting configuration, the scheduling request configuration and the sounding RS configuration that do not require the UE to know the SFN of the respective target SpCell, if any;
2&gt; apply the parts of the measurement and the radio resource configuration that require the UE to know the SFN of the respective target SpCell (e.g. measurement gaps, periodic CQI reporting, scheduling request configuration, sounding RS configuration), if any, upon acquiring the SFN of that target SpCell;
2&gt; for each DRB configured as DAPS bearer, request uplink data switching to the PDCP entity, as specified in TS 38.323 ;
2&gt; if the reconfigurationWithSync was included in spCellConfig of an MCG:
4&gt; stop timer T390 for all access categories;
4&gt; perform the actions as specified in 5.3.14.4.
4&gt; stop timer T350;
3&gt; if RRCReconfiguration does not include dedicatedSIB1-Delivery and
3&gt; if the active downlink BWP, which is indicated by the firstActiveDownlinkBWP-Id for the target SpCell of the MCG, has a common search space configured by searchSpaceSIB1:
4&gt; acquire the SIB1, which is scheduled as specified in TS 38.213 , of the target SpCell of the MCG;
4&gt; upon acquiring SIB1, perform the actions specified in clause 5.2.2.4.2;
2&gt; if the reconfigurationWithSync was included in spCellConfig of an MCG; or
2&gt; if the reconfigurationWithSync was included in spCellConfig of an SCG and the CPA or CPC was configured
3&gt; remove all the entries within VarConditionalReconfig, if any;
3&gt; remove all the entries within VarConditionalReconfiguration as specified in TS 36.331 , clause
3&gt; for each measId of the source SpCell configuration, if the associated reportConfig has a reportType set to condTriggerConfig:
4&gt; for the associated reportConfigId:
5&gt; remove the entry with the matching reportConfigId from the reportConfigList within the VarMeasConfig;
4&gt; if the associated measObjectId is only associated to a reportConfig with reportType set to condTriggerConfig:
5&gt; remove the entry with the matching measObjectId from the measObjectList within the VarMeasConfig;
4&gt; remove the entry with the matching measId from the measIdList within the VarMeasConfig;
2&gt; if reconfigurationWithSync was included in masterCellGroup or secondaryCellGroup:
3&gt; if the UE initiated transmission of a UEAssistanceInformation message for the corresponding cell group during the last 1 second, and the UE is still configured to provide the concerned UE assistance information for the corresponding cell group; or
3&gt; if the RRCReconfiguration message is applied due to a conditional reconfiguration execution, and the UE is configured to provide UE assistance information for the corresponding cell group, and the UE has initiated transmission of a UEAssistanceInformation message for the corresponding cell group since it was configured to do so in accordance with 5.7.4.2:
4&gt; initiate transmission of a UEAssistanceInformation message for the corresponding cell group in accordance with clause 5.7.4.3 to provide the concerned UE assistance information;
4&gt; start or restart the prohibit timer (if exists) associated with the concerned UE assistance information with the timer value set to the value in corresponding configuration;
3&gt; if SIB12 is provided by the target PCell; and the UE initiated transmission of a SidelinkUEInformationNR message indicating a change of NR sidelink communication related parameters relevant in target PCell (i.e. change of sl-RxInterestedFreqList or sl-TxResourceReqList) during the last 1 second preceding reception of the RRCReconfiguration message including reconfigurationWithSync in spCellConfig of an MCG; or
3&gt; if the RRCReconfiguration message is applied due to a conditional reconfiguration execution and the UE is capable of NR sidelink communication and SIB12 is provided by the target PCell, and the UE has initiated transmission of a SidelinkUEInformationNR message since it was configured to do so in accordance with 5.8.3.2:
4&gt; initiate transmission of the SidelinkUEInformationNR message in accordance with 5.8.3.3;
2&gt; the procedure ends.
NOTE 3: The UE is only required to acquire broadcasted SIB1 if the UE can acquire it without disrupting unicast or MBS multicast data reception, i.e. the broadcast and unicast/MBS multicast beams are quasi co-located.
NOTE 4: The UE sets the content of UEAssistanceInformation according to latest configuration (i.e. the configuration after applying the RRCReconfiguration message) and latest UE preference. The UE may include more than the concerned UE assistance information within the UEAssistanceInformation according to 5.7.4.2. Therefore, the content of UEAssistanceInformation message might not be the same as the content of the previous UEAssistanceInformation message.
5.3.5.4 Secondary cell group release
The UE shall:
1&gt; as a result of SCG release triggered by E-UTRA (i.e. (NG)EN-DC case) or NR (i.e. NR-DC case):
2&gt; reset SCG MAC, if configured;
2&gt; for each RLC bearer that is part of the SCG configuration:
3&gt; perform RLC bearer release procedure as specified in 5.3.5.5.3;
2&gt; for each BH RLC channel that is part of the SCG configuration:
3&gt; perform BH RLC channel release procedure as specified in 5.3.5.5.10;
2&gt; release the SCG configuration;
2&gt; if CPC was configured,
3&gt; remove all the entries within VarConditionalReconfig, if any;
2&gt; stop timer T310 for the corresponding SpCell, if running;
2&gt; stop timer T312 for the corresponding SpCell, if running;
2&gt; stop timer T304 for the corresponding SpCell, if running.
NOTE: Release of cell group means only release of the lower layer configuration of the cell group but the RadioBearerConfig may not be released.
5.3.5.5 Cell Group configuration
5.3.5.5.1 General
The network configures the UE with Master Cell Group (MCG), and zero or one Secondary Cell Group (SCG). In (NG)EN-DC, the MCG is configured as specified in TS 36.331 , and for NE-DC, the SCG is configured as specified in TS 36.331 . The network provides the configuration parameters for a cell group in the CellGroupConfig IE.
The UE performs the following actions based on a received CellGroupConfig IE:
1&gt; if the CellGroupConfig contains the spCellConfig with reconfigurationWithSync:
2&gt; perform Reconfiguration with sync according to 5.3.5.5.2;
2&gt; resume all suspended radio bearers except the SRBs for the source cell group, and resume SCG transmission for all radio bearers, and resume BH RLC channels and resume SCG transmission for BH RLC channels for IAB-MT, if suspended; NOTE: If the SCG is deactivated, resuming SCG transmission for all radio bearers does not imply that PDCP PDUs can be transmitted or received on SCG RLC bearers.
1&gt; if the CellGroupConfig contains the rlc-BearerToReleaseList or rlc-BearerToReleaseListExt:
2&gt; perform RLC bearer release as specified in 5.3.5.5.3;
1&gt; if the CellGroupConfig contains the rlc-BearerToAddModList:
2&gt; perform the RLC bearer addition/modification as specified in 5.3.5.5.4;
1&gt; if the CellGroupConfig contains the mac-CellGroupConfig:
2&gt; configure the MAC entity of this cell group as specified in 5.3.5.5.5;
1&gt; if the CellGroupConfig contains the sCellToReleaseList:
2&gt; perform SCell release as specified in 5.3.5.5.8;
1&gt; if the CellGroupConfig contains the spCellConfig:
2&gt; configure the SpCell as specified in 5.3.5.5.7;
1&gt; if the CellGroupConfig contains the sCellToAddModList:
2&gt; perform SCell addition/modification as specified in 5.3.5.5.9;
1&gt; if the CellGroupConfig contains the bh-RLC-ChannelToReleaseList:
2&gt; perform BH RLC channel release as specified in 5.3.5.5.10;
1&gt; if the CellGroupConfig contains the bh-RLC-ChannelToAddModList:
2&gt; perform the BH RLC channel addition/modification as specified in 5.3.5.5.11;
1&gt; if the CellGroupConfig contains the uu-Relay-RLC-ChannelToReleaseList:
2&gt; perform Uu Relay RLC channel release as specified in 5.3.5.5.12;
1&gt; if the CellGroupConfig contains the uu-Relay-RLC-ChannelToAddModList:
2&gt; perform the Uu Relay RLC channel addition/modification as specified in 5.3.5.5.13;
5.3.5.5.2 Reconfiguration with sync
The UE shall perform the following actions to execute a reconfiguration with sync.
1&gt; if the AS security is not activated, perform the actions upon going to RRC_IDLE as specified in 5.3.11 with the release cause 'other' upon which the procedure ends;
1&gt; if no DAPS bearer is configured:
2&gt; stop timer T310 for the corresponding SpCell, if running;
1&gt; if this procedure is executed for the MCG:
2&gt; if timer T316 is running;
3&gt; stop timer T316;
3&gt; clear the information included in VarRLF-Report, if any;
2&gt; resume MCG transmission, if suspended.
1&gt; stop timer T312 for the corresponding SpCell, if running;
2&gt; consider the target L2 U2N Relay UE to be the one indicated by the targetRelayUEIdentity in the sl- PathSwitchConfig;
2&gt; start timer T420 for the corresponding target L2 U2N Relay UE with the timer value set to T420, as included in the sl-PathSwitchConfig;
2&gt; apply the value of the newUE-Identity as the C-RNTI;
2&gt; perform the PC5-RRC connection establishment with the target L2 U2N Relay UE indicated by the targetRelayUEIdentity, if needed;
2&gt; apply the default configuration of SL-RLC1 as defined in 9.2.4 for SRB1;
1&gt; else (sl-PathSwitchConfig is not included):
2&gt; if this procedure is executed for the MCG or if this procedure is executed for an SCG not indicated as deactivated in the E-UTRA or NR RRC message in which the RRCReconfiguration message is embedded:
3&gt; start timer T304 for the corresponding SpCell with the timer value set to t304, as included in the reconfigurationWithSync;
2&gt; if the frequencyInfoDL is included:
3&gt; consider the target SpCell to be one on the SSB frequency indicated by the frequencyInfoDL with a physical cell identity indicated by the physCellId;
3&gt; consider the target SpCell to be one on the SSB frequency of the source SpCell with a physical cell identity indicated by the physCellId;
2&gt; start synchronising to the DL of the target SpCell;
2&gt; apply the specified BCCH configuration defined in 9.1.1.1 for the target SpCell;
2&gt; acquire the MIB of the target SpCell, which is scheduled as specified in TS 38.213 ; NOTE 1: The UE should perform the reconfiguration with sync as soon as possible following the reception of the RRC message triggering the reconfiguration with sync, which could be before confirming successful reception (HARQ and ARQ) of this message.
NOTE 2: The UE may omit reading the MIB if the UE already has the required timing information, or the timing information is not needed for random access.
NOTE 2a: A UE with DAPS bearer does not monitor for system information updates in the source PCell.
2&gt; If any DAPS bearer is configured:
3&gt; create a MAC entity for the target cell group with the same configuration as the MAC entity for the source cell group;
3&gt; for each DAPS bearer:
4&gt; establish an RLC entity or entities for the target cell group, with the same configurations as for the source cell group;
4&gt; establish the logical channel for the target cell group, with the same configurations as for the source cell group; NOTE 2b: In order to understand if a DAPS bearer is configured, the UE needs to check the presence of the field daps-Config within the RadioBearerConfig IE received in radioBearerConfig or radioBearerConfig2.
3&gt; for each SRB:
4&gt; establish an RLC entity for the target cell group, with the same configurations as for the source cell group;
4&gt; establish the logical channel for the target cell group, with the same configurations as for the source cell group;
3&gt; suspend SRBs for the source cell group; NOTE 3: Void
3&gt; apply the value of the newUE-Identity as the C-RNTI in the target cell group;
3&gt; configure lower layers for the target SpCell in accordance with the received spCellConfigCommon;
3&gt; configure lower layers for the target SpCell in accordance with any additional fields, not covered in the previous, if included in the received reconfigurationWithSync.
3&gt; reset the MAC entity of this cell group;
3&gt; consider the SCell(s) of this cell group, if configured, that are not included in the SCellToAddModList in the RRCReconfiguration message, to be in deactivated state;
3&gt; apply the value of the newUE-Identity as the C-RNTI for this cell group;
3&gt; configure lower layers in accordance with the received spCellConfigCommon;
3&gt; configure lower layers in accordance with any additional fields, not covered in the previous, if included in the received reconfigurationWithSync.
2&gt; if the UE is connected with a L2 U2N Relay UE (i.e. the UE is a L2 U2N Remote UE at the source side):
3&gt; perform the PC5-RRC connection release as specified in 5.8.9.5.
Upon L2 U2N Relay UE receiving reconfigurationWithSync, it either triggers PC5-S release or sends Notification message to the connected L2 U2N Remote UE(s) in accordance with 5.8.9.10.
5.3.5.5.3 RLC bearer release
The UE shall:
1&gt; for each logicalChannelIdentity/LogicalChannelIdentityExt value included in the rlc-BearerToReleaseList/rlc- BearerToReleaseListExt that is part of the current UE configuration within the same cell group (LCH release); or
1&gt; for each logicalChannelIdentity value that is to be released as the result of an SCG release according to 5.3.5.4:
2&gt; release the RLC entity or entities as specified in TS 38.322 , clause 5.1.3;
2&gt; release the corresponding logical channel.
5.3.5.5.4 RLC bearer addition/modification
For each RLC-BearerConfig received in the rlc-BearerToAddModList IE the UE shall:
1&gt; if the UE's current configuration contains an RLC bearer with the received logicalChannelIdentity/LogicalChannelIdentityExt within the same cell group:
2&gt; if the RLC bearer is associated with an DAPS bearer, or
2&gt; if any DAPS bearer is configured and the RLC bearer is associated with an SRB:
3&gt; reconfigure the RLC entity or entities for the target cell group in accordance with the received rlc-Config;
3&gt; reconfigure the logical channel for the target cell group in accordance with the received mac- LogicalChannelConfig;
3&gt; if reestablishRLC is received:
4&gt; re-establish the RLC entity as specified in TS 38.322 ;
3&gt; reconfigure the RLC entity or entities in accordance with the received rlc-Config;
3&gt; reconfigure the logical channel in accordance with the received mac-LogicalChannelConfig; NOTE 1: The network does not re-associate an already configured logical channel with another radio bearer. Hence servedRadioBearer or servedMBS-RadioBearer is not present in this case.
NOTE 2: In DAPS handover, the UE may perform RLC entity re-establishment (if reestablishRLC is set) for an RLC bearer associated with a non-DAPS bearer when indication of successful completion of random access towards target cell is received from lower layers as specified in TS 38.321 .
1&gt; else (a logical channel with the given logicalChannelIdentity/LogicalChannelIdentityExt is not configured within the same cell group, including the case when full configuration option is used):
2&gt; if the servedRadioBearer associates the logical channel with an SRB and rlc-Config is not included:
3&gt; establish an RLC entity in accordance with the default configuration defined in 9.2 for the corresponding SRB;
3&gt; establish an RLC entity in accordance with the received rlc-Config;
2&gt; if the servedRadioBearer associates the logical channel with an SRB and if mac-LogicalChannelConfig is not included:
3&gt; configure this MAC entity with a logical channel in accordance to the default configuration defined in 9.2 for the corresponding SRB;
3&gt; configure this MAC entity with a logical channel in accordance to the received mac- LogicalChannelConfig;
2&gt; associate this logical channel with the PDCP entity identified by servedRadioBearer or servedMBS- RadioBearer.
5.3.5.5.5 MAC entity configuration
The UE shall:
1&gt; if SCG MAC is not part of the current UE configuration (i.e. SCG establishment):
2&gt; create an SCG MAC entity;
1&gt; if any DAPS bearer is configured:
2&gt; reconfigure the MAC main configuration for the target cell group in accordance with the received mac- CellGroupConfig excluding tag-ToReleaseList and tag-ToAddModList;
2&gt; reconfigure the MAC main configuration of the cell group in accordance with the received mac- CellGroupConfig excluding tag-ToReleaseList and tag-ToAddModList;
1&gt; if the received mac-CellGroupConfig includes the tag-ToReleaseList:
2&gt; for each TAG-Id value included in the tag-ToReleaseList that is part of the current UE configuration:
3&gt; release the TAG indicated by TAG-Id;
1&gt; if the received mac-CellGroupConfig includes the tag-ToAddModList:
2&gt; for each tag-Id value included in tag-ToAddModList that is not part of the current UE configuration (TAG addition):
3&gt; add the TAG, corresponding to the tag-Id, in accordance with the received timeAlignmentTimer;
2&gt; for each tag-Id value included in tag-ToAddModList that is part of the current UE configuration (TAG modification):
3&gt; reconfigure the TAG, corresponding to the tag-Id, in accordance with the received timeAlignmentTimer.
5.3.5.5.6 RLF Timers &amp; Constants configuration
The UE shall:
1&gt; if the received rlf-TimersAndConstants is set to release:
2&gt; if any DAPS bearer is configured:
3&gt; use values for timers T301, T310, T311 and constants N310, N311 for the target cell group, as included in ue-TimersAndConstants received in SIB1;
3&gt; use values for timers T301, T310, T311 and constants N310, N311, as included in ue- TimersAndConstants received in SIB1;
2&gt; if any DAPS bearer is configured:
3&gt; configure the value of timers and constants for the target cell group in accordance with received rlf- TimersAndConstants;
3&gt; (re-)configure the value of timers and constants in accordance with received rlf-TimersAndConstants;
3&gt; stop timer T310 for this cell group, if running;
3&gt; stop timer T312 for this cell group, if running;
3&gt; reset the counters N310 and N311.
5.3.5.5.7 SpCell Configuration
The UE shall:
1&gt; if the UE is connected with a L2 U2N Relay UE via the PC5-RRC connection (i.e. the UE is a L2 U2N Remote UE):
2&gt; use values for timers T300, T301 and T319 as included in ue-TimersAndConstants-RemoteUE received in SIB1;
2&gt; use value for timers T311, as included in ue-TimersAndConstants received in SIB1;
1&gt; else
2&gt; if the SpCellConfig contains the rlf-TimersAndConstants:
3&gt; configure the RLF timers and constants for this cell group as specified in 5.3.5.5.6;
2&gt; else if rlf-TimersAndConstants is not configured for this cell group:
3&gt; if any DAPS bearer is configured:
4&gt; use values for timers T301, T310, T311 and constants N310, N311 for the target cell group, as included in ue-TimersAndConstants received in SIB1;
3&gt; else
4&gt; use values for timers T301, T310, T311 and constants N310, N311, as included in ue- TimersAndConstants received in SIB1;
2&gt; if the SpCellConfig contains spCellConfigDedicated:
3&gt; configure the SpCell in accordance with the spCellConfigDedicated;
3&gt; consider the bandwidth part indicated in firstActiveUplinkBWP-Id if configured to be the active uplink bandwidth part;
3&gt; consider the bandwidth part indicated in firstActiveDownlinkBWP-Id if configured to be the active downlink bandwidth part or the bandwidth part for Radio Link Monitoring, Beam Failure Detection and measurements if the SpCellConfig is included in an RRCReconfiguration message contained in an NR or E-UTRA RRC message indicating that the SCG is deactivated;
3&gt; if any of the reference signal(s) that are used for radio link monitoring are reconfigured by the received spCellConfigDedicated:
4&gt; stop timer T310 for the corresponding SpCell, if running;
4&gt; stop timer T312 for the corresponding SpCell, if running;
4&gt; reset the counters N310 and N311.
1&gt; if the SpCellConfig contains the lowMobilityEvaluationConnected:
2&gt; the UE may perform the evaluation of the low mobility criterion for this cell group as specified in 5.7.13.1;
1&gt; if the SpCellConfig contains the goodServingCellEvaluationRLM:
2&gt; the UE may perform the evaluation of the good serving cell quality criterion for this cell group as specified in
1&gt; if the SpCellConfig contains the goodServingCellEvaluationBFD:
2&gt; the UE may perform the evaluation of the good serving cell quality criterion for this serving cell as specified in 5.7.13.2;
5.3.5.5.8 SCell Release
The UE shall:
1&gt; if the release is triggered by reception of the sCellToReleaseList:
2&gt; for each sCellIndex value included in the sCellToReleaseList:
3&gt; if the current UE configuration includes an SCell with value sCellIndex:
4&gt; release the SCell.
The UE shall:
1&gt; for each sCellIndex value included in the sCellToAddModList that is not part of the current UE configuration (SCell addition):
2&gt; add the SCell, corresponding to the sCellIndex, in accordance with the sCellConfigCommon and sCellConfigDedicated;
2&gt; if the sCellState is included:
3&gt; configure lower layers to consider the SCell to be in activated state;
3&gt; configure lower layers to consider the SCell to be in deactivated state;
2&gt; for each measId included in the measIdList within VarMeasConfig:
3&gt; if SCells are not applicable for the associated measurement; and
3&gt; if the concerned SCell is included in cellsTriggeredList defined within the VarMeasReportList for this measId:
4&gt; remove the concerned SCell from cellsTriggeredList defined within the VarMeasReportList for this measId;
2&gt; if the SCellConfig contains the goodServingCellEvaluationBFD:
3&gt; the UE may perform the evaluation of the good serving cell quality criterion for this serving cell as specified in 5.7.13.2.
1&gt; for each sCellIndex value included in the sCellToAddModList that is part of the current UE configuration (SCell modification):
2&gt; modify the SCell configuration in accordance with the sCellConfigDedicated;
2&gt; if the sCellToAddModList was received in an RRCReconfiguration message including reconfigurationWithSync, or received in an RRCResume message, or received in an RRCReconfiguration message including reconfigurationWithSync embedded in an RRCResume message or embedded in an RRCReconfiguration message or embedded in an E-UTRA RRCConnectionReconfiguration message or embedded in an E-UTRA RRCConnectionResume message:
3&gt; if the sCellState is included:
4&gt; configure lower layers to consider the SCell to be in activated state;
4&gt; configure lower layers to consider the SCell to be in deactivated state.
2&gt; if the SCellConfig contains the goodServingCellEvaluationBFD:
3&gt; the UE may perform the evaluation of the good serving cell quality criterion for this serving cell as specified in 5.7.13.2.
5.3.5.5.10 BH RLC channel release
1&gt; for each BH-RLC-ChannelID value included in the bh-RLC-ChannelToReleaseList that is part of the current IAB-node configuration within the same cell group (LCH release); or
1&gt; for each BH-RLC-ChannelID value that is to be released as the result of an SCG release according to 5.3.5.4:
2&gt; release the RLC entity or entities as specified in TS 38.322 , clause 5.1.3;
2&gt; release the corresponding logical channel.
5.3.5.5.11 BH RLC channel addition/modification
For each BH-RLC-ChannelConfig received in the bh-RLC-ChannelToAddModList IE the IAB-node shall:
1&gt; if the current configuration contains a BH RLC Channel with the received bh-RLC-ChannelID within the same cell group:
2&gt; if reestablishRLC is received:
3&gt; re-establish the RLC entity as specified in TS 38.322 ;
2&gt; reconfigure the RLC entity or entities in accordance with the received rlc-Config;
2&gt; reconfigure the logical channel in accordance with the received mac-LogicalChannelConfig;
1&gt; else (a backhaul logical channel with the given BH-RLC-ChannelID was not configured before within the same cell group):
2&gt; establish an RLC entity in accordance with the received rlc-Config;
2&gt; configure this MAC entity with a logical channel in accordance to the received mac-LogicalChannelConfig.
5.3.5.5.12 Uu Relay RLC channel release
The L2 U2N Relay UE shall:
1&gt; for each Uu-Relay-RLC-ChannelID value included in the uu-Relay-RLC-ChannelToReleaseList that is part of the current configuration within the same cell group (LCH release):
2&gt; release the RLC entity as specified in TS 38.322 , clause 5.1.3;
2&gt; release the corresponding logical channel.
5.3.5.5.13 Uu Relay RLC channel addition/modification
For each Uu-Relay-RLC-ChannelConfig received in the Uu-Relay-RLC-ChannelToAddModList IE the L2 U2N Relay UE shall:
1&gt; if the current configuration contains a Uu Relay RLC channel with the received uu-Relay-RLC-ChannelID within the same cell group:
2&gt; if reestablishRLC is received:
3&gt; re-establish the RLC entity as specified in TS 38.322 ;
2&gt; reconfigure the RLC entity in accordance with the received rlc-Config;
2&gt; reconfigure the logical channel in accordance with the received mac-LogicalChannelConfig;
1&gt; else (a logical channel with the given Uu-Relay-RLC-ChannelID was not configured before within the same cell group):
2&gt; establish an RLC entity in accordance with the received rlc-Config;
2&gt; configure this MAC entity with a logical channel in accordance to the received mac-LogicalChannelConfig.
5.3.5.6 Radio Bearer configuration
5.3.5.6.1 General
The UE shall perform the following actions based on a received RadioBearerConfig IE:
1&gt; if the RadioBearerConfig includes the srb3-ToRelease or srb4-ToRelease:
2&gt; perform the SRB release as specified in 5.3.5.6.2;
1&gt; if the RadioBearerConfig includes the srb-ToAddModList or if any DAPS bearer is configured:
2&gt; perform the SRB addition or reconfiguration as specified in 5.3.5.6.3;
1&gt; if the RadioBearerConfig includes the drb-ToReleaseList:
2&gt; perform DRB release as specified in 5.3.5.6.4;
1&gt; if the RadioBearerConfig includes the drb-ToAddModList:
2&gt; perform DRB addition or reconfiguration as specified in 5.3.5.6.5;
1&gt; if the RadioBearerConfig includes the mrb-ToReleaseList:
2&gt; perform multicast MRB release as specified in 5.3.5.6.6;
1&gt; if the RadioBearerConfig includes the mrb-ToAddModList:
2&gt; perform multicast MRB addition or reconfiguration as specified in 5.3.5.6.7;
1&gt; release all SDAP entities, if any, that have no associated DRB as specified in TS 37.324 clause 5.1.2, and indicate the release of the user plane resources for PDU Sessions associated with the released SDAP entities to upper layers;
1&gt; release all SDAP entities that have no associated multicast MRB, and indicate the release of user plane resources for these MBS multicast sessions to upper layers.
5.3.5.6.2 SRB release
The UE shall:
1&gt; release the PDCP entity and the srb-Identity of the SRB3 or SRB4.
The UE shall:
1&gt; If any DAPS bearer is configured, for each SRB:
2&gt; establish a PDCP entity for the target cell group as specified in TS 38.323 , with the same configuration as the PDCP entity for the source cell group;
2&gt; if the masterKeyUpdate is received:
3&gt; configure the PDCP entity with the security algorithms according to securityConfig and apply the keys (K and K ) associated with the master key (K ); RRCenc RRCint gNB
3&gt; configure the PDCP entity for the target cell group with state variables continuation as specified in TS
38.323 , and with the same security configuration as the PDCP entity for the source cell group;
1&gt; for each srb-Identity value included in the srb-ToAddModList that is not part of the current UE configuration (SRB establishment or reconfiguration from E-UTRA PDCP to NR PDCP):
2&gt; establish a PDCP entity;
2&gt; if AS security has been activated:
3&gt; if target RAT of handover is E-UTRA/5GC; or
3&gt; if the UE is connected to E-UTRA/5GC:
4&gt; if the UE is capable of E-UTRA/5GC, but not capable of NGEN-DC:
5&gt; configure the PDCP entity with the security algorithms and keys (K and K ) RRCenc RRCint configured/derived as specified in TS 36.331 ;
4&gt; else (i.e., UE capable of NGEN-DC):
5&gt; configure the PDCP entity with the security algorithms according to securityConfig and apply the keys (K and K ) associated with the master key (K ) or secondary key (S-K ) as RRCenc RRCint eNB gNB indicated in keyToUse, if applicable;
3&gt; else (i.e., UE connected to NR or UE connected to E-UTRA/EPC):
4&gt; configure the PDCP entity with the security algorithms according to securityConfig and apply the keys (K and K ) associated with the master key (K / K ) or secondary key (S-K ) as RRCenc RRCint eNB gNB gNB indicated in keyToUse, if applicable;
2&gt; if the current UE configuration as configured by E-UTRA in TS 36.331 includes an SRB identified with the same srb-Identity value:
3&gt; associate the E-UTRA RLC entity and DCCH of this SRB with the NR PDCP entity;
3&gt; release the E-UTRA PDCP entity of this SRB;
2&gt; if the pdcp-Config is included:
3&gt; configure the PDCP entity in accordance with the received pdcp-Config;
3&gt; configure the PDCP entity in accordance with the default configuration defined in 9.2.1 for the corresponding SRB;
1&gt; if any DAPS bearer is configured, for each srb-Identity value included in the srb-ToAddModList that is part of the current UE configuration:
2&gt; if the pdcp-Config is included:
3&gt; reconfigure the PDCP entity for the target cell group in accordance with the received pdcp-Config;
1&gt; else, for each srb-Identity value included in the srb-ToAddModList that is part of the current UE configuration:
2&gt; if the reestablishPDCP is set:
3&gt; if target RAT of handover is E-UTRA/5GC; or
3&gt; if the UE is connected to E-UTRA/5GC:
4&gt; if the UE is capable of E-UTRA/5GC, but not capable of NGEN-DC:
5&gt; configure the PDCP entity to apply the integrity protection algorithm and K key RRCint configured/derived as specified in TS 36.331 , i.e. the integrity protection configuration shall be applied to all subsequent messages received and sent by the UE, including the message used to indicate the successful completion of the procedure;
5&gt; configure the PDCP entity to apply the ciphering algorithm and K key configured/derived as RRCenc specified in TS 36.331 , i.e. the ciphering configuration shall be applied to all subsequent messages received and sent by the UE, including the message used to indicate the successful completion of the procedure;
4&gt; else (i.e., a UE capable of NGEN-DC):
5&gt; configure the PDCP entity to apply the integrity protection algorithm and K key associated RRCint with the master key (K ) or secondary key (S-K ), as indicated in keyToUse, i.e. the integrity eNB gNB protection configuration shall be applied to all subsequent messages received and sent by the UE, including the message used to indicate the successful completion of the procedure;
5&gt; configure the PDCP entity to apply the ciphering algorithm and K key associated with the RRCenc master key (K ) or secondary key (S-K ) as indicated in keyToUse, i.e. the ciphering eNB gNB configuration shall be applied to all subsequent messages received and sent by the UE, including the message used to indicate the successful completion of the procedure;
3&gt; else (i.e., UE connected to NR or UE in EN-DC):
4&gt; configure the PDCP entity to apply the integrity protection algorithm and K key associated with RRCint the master key (K /K ) or secondary key (S-K ), as indicated in keyToUse , i.e. the integrity eNB gNB gNB protection configuration shall be applied to all subsequent messages received and sent by the UE, including the message used to indicate the successful completion of the procedure;
4&gt; configure the PDCP entity to apply the ciphering algorithm and K key associated with the master RRCenc key (K /K ) or secondary key (S-K ) as indicated in keyToUse, i.e. the ciphering configuration eNB gNB gNB shall be applied to all subsequent messages received and sent by the UE, including the message used to indicate the successful completion of the procedure;
3&gt; re-establish the PDCP entity of this SRB as specified in TS 38.323 ;
2&gt; else, if the discardOnPDCP is set:
3&gt; trigger the PDCP entity to perform SDU discard as specified in TS 38.323 ;
2&gt; if the pdcp-Config is included:
3&gt; reconfigure the PDCP entity in accordance with the received pdcp-Config.
5.3.5.6.4 DRB release
The UE shall:
1&gt; for each drb-Identity value included in the drb-ToReleaseList that is part of the current UE configuration; or
1&gt; for each drb-Identity value that is to be released as the result of full configuration according to 5.3.5.11:
2&gt; release the PDCP entity and the drb-Identity;
2&gt; if SDAP entity associated with this DRB is configured:
3&gt; indicate the release of the DRB to SDAP entity associated with this DRB (TS 37.324 , clause 5.3.3);
2&gt; if the DRB is associated with an eps-BearerIdentity:
3&gt; if a new bearer is not added either with NR or E-UTRA with same eps-BearerIdentity:
4&gt; indicate the release of the DRB and the eps-BearerIdentity of the released DRB to upper layers.
NOTE 1: The UE does not consider the message as erroneous if the drb-ToReleaseList includes any drb-Identity value that is not part of the current UE configuration.
NOTE 2: Whether or not the RLC and MAC entities associated with this PDCP entity are reset or released is determined by the CellGroupConfig.
The UE shall:
1&gt; for each drb-Identity value included in the drb-ToAddModList that is not part of the current UE configuration (DRB establishment including the case when full configuration option is used):
2&gt; establish a PDCP entity and configure it in accordance with the received pdcp-Config;
2&gt; if the PDCP entity of this DRB is not configured with cipheringDisabled:
3&gt; if target RAT of handover is E-UTRA/5GC; or
3&gt; if the UE is connected to E-UTRA/5GC:
4&gt; if the UE is capable of E-UTRA/5GC but not capable of NGEN-DC:
5&gt; configure the PDCP entity with the ciphering algorithm and K key configured/derived as UPenc specified in TS 36.331 ;
4&gt; else (i.e., a UE capable of NGEN-DC):
5&gt; configure the PDCP entity with the ciphering algorithms according to securityConfig and apply the key (K ) associated with the master key (K ) or secondary key (S-K ) as indicated in UPenc eNB gNB keyToUse, if applicable;
3&gt; else (i.e., UE connected to NR or UE connected to E-UTRA/EPC):
4&gt; configure the PDCP entity with the ciphering algorithms according to securityConfig and apply the
K key associated with the master key (K /K ) or the secondary key (S-K /S-K ) as UPenc eNB gNB gNB eNB indicated in keyToUse;
2&gt; if the PDCP entity of this DRB is configured with integrityProtection:
3&gt; configure the PDCP entity with the integrity protection algorithms according to securityConfig and apply the K key associated with the master (K /K ) or the secondary key (S-K ) as indicated in UPint eNB gNB gNB keyToUse;
2&gt; if an sdap-Config is included:
3&gt; if an SDAP entity with the received pdu-Session does not exist:
4&gt; establish an SDAP entity as specified in TS 37.324 clause 5.1.1;
4&gt; if an SDAP entity with the received pdu-Session did not exist prior to receiving this reconfiguration:
5&gt; indicate the establishment of the user plane resources for the pdu-Session to upper layers;
3&gt; configure the SDAP entity in accordance with the received sdap-Config as specified in TS 37.324 and associate the DRB with the SDAP entity;
3&gt; for each QFI value added in mappedQoS-FlowsToAdd, if the QFI value is previously configured, the QFI value is released from the old DRB;
2&gt; if the DRB is associated with an eps-BearerIdentity:
3&gt; if the DRB was configured with the same eps-BearerIdentity either by NR or E-UTRA prior to receiving this reconfiguration:
4&gt; associate the established DRB with the corresponding eps-BearerIdentity;
4&gt; indicate the establishment of the DRB(s) and the eps-BearerIdentity of the established DRB(s) to upper layers;
1&gt; for each drb-Identity value included in the drb-ToAddModList that is part of the current UE configuration and configured as DAPS bearer:
2&gt; reconfigure the PDCP entity to configure DAPS with the ciphering function, integrity protection function and ROHC function of the target cell group as specified in TS 38.323 and configure it in accordance with the received pdcp-Config;
2&gt; if the masterKeyUpdate is received:
3&gt; if the ciphering function of the target cell group PDCP entity is not configured with cipheringDisabled:
4&gt; configure the ciphering function of the target cell group PDCP entity with the ciphering algorithm according to securityConfig and apply the K key associated with the master key (K ), as UPenc gNB indicated in keyToUse, i.e. the ciphering configuration shall be applied to all subsequent PDCP PDUs received from the target cell group and sent to the target cell group by the UE;
3&gt; if the integrity protection function of the target cell group PDCP entity is configured with integrityProtection:
4&gt; configure the integrity protection function of the target cell group PDCP entity with the integrity protection algorithms according to securityConfig and apply the K key associated with the master UPint key (K ) as indicated in keyToUse; gNB
3&gt; configure the ciphering function and the integrity protection function of the target cell group PDCP entity with the same security configuration as the PDCP entity for the source cell group;
2&gt; if the sdap-Config is included and when indication of successful completion of random access towards target cell is received from lower layers as specified in :
3&gt; reconfigure the SDAP entity in accordance with the received sdap-Config as specified in TS 37.324 ;
3&gt; for each QFI value added in mappedQoS-FlowsToAdd, if the QFI value is previously configured, the QFI value is released from the old DRB;
1&gt; for each drb-Identity value included in the drb-ToAddModList that is part of the current UE configuration and not configured as DAPS bearer:
2&gt; if the reestablishPDCP is set:
3&gt; if target RAT of handover is E-UTRA/5GC; or
3&gt; if the UE is connected to E-UTRA/5GC:
4&gt; if the UE is capable of E-UTRA/5GC but not capable of NGEN-DC:
5&gt; if the PDCP entity of this DRB is not configured with cipheringDisabled:
6&gt; configure the PDCP entity with the ciphering algorithm and K key configured/derived as UPenc specified in TS 36.331 , clause 5.4.2.3, i.e. the ciphering configuration shall be applied to all subsequent PDCP PDUs received and sent by the UE;
4&gt; else (i.e., a UE capable of NGEN-DC):
5&gt; if the PDCP entity of this DRB is not configured with cipheringDisabled:
6&gt; configure the PDCP entity with the ciphering algorithm and K key associated with the UPenc master key (K ) or the secondary key (S-K ), as indicated in keyToUse, i.e. the ciphering eNB gNB configuration shall be applied to all subsequent PDCP PDUs received and sent by the UE;
3&gt; else (i.e., UE connected to NR or UE connected to E-UTRA/EPC (in EN-DC or capable of EN-DC)):
4&gt; if the PDCP entity of this DRB is not configured with cipheringDisabled:
5&gt; configure the PDCP entity with the ciphering algorithm and K key associated with the master UPenc key (K / K ) or the secondary key (S-K /S-K ), as indicated in keyToUse, i.e. the eNB gNB gNB eNB ciphering configuration shall be applied to all subsequent PDCP PDUs received and sent by the UE;
4&gt; if the PDCP entity of this DRB is configured with integrityProtection:
5&gt; configure the PDCP entity with the integrity protection algorithms according to securityConfig and apply the K key associated with the master key (K /K ) or the secondary key (S-K ) as UPint eNB gNB gNB indicated in keyToUse;
3&gt; if drb-ContinueROHC is included in pdcp-Config:
4&gt; indicate to lower layer that drb-ContinueROHC is configured;
3&gt; if drb-ContinueEHC-DL is included in pdcp-Config:
4&gt; indicate to lower layer that drb-ContinueEHC-DL is configured;
3&gt; if drb-ContinueEHC-UL is included in pdcp-Config:
4&gt; indicate to lower layer that drb-ContinueEHC-UL is configured;
3&gt; if drb-ContinueUDC is included in pdcp-Config:
4&gt; indicate to lower layer that drb-ContinueUDC is configured;3&gt; re-establish the PDCP entity of this DRB as specified in TS 38.323 , clause 5.1.2;
2&gt; else, if the recoverPDCP is set:
3&gt; trigger the PDCP entity of this DRB to perform data recovery as specified in TS 38.323 ;
2&gt; if the pdcp-Config is included:
3&gt; reconfigure the PDCP entity in accordance with the received pdcp-Config.
2&gt; if the sdap-Config is included:
3&gt; reconfigure the SDAP entity in accordance with the received sdap-Config as specified in TS37.324 ;
3&gt; for each QFI value added in mappedQoS-FlowsToAdd, if the QFI value is previously configured, the QFI value is released from the old DRB; NOTE 1: Void.
NOTE 2: When determining whether a drb-Identity value is part of the current UE configuration, the UE does not distinguish which RadioBearerConfig and DRB-ToAddModList that DRB was originally configured in.
To re-associate a DRB with a different key (K to S-K ,K to S-K , K to S-K , or vice eNB gNB gNB eNB gNB gNB versa), the network provides the drb-Identity value in the (target) drb-ToAddModList and sets the reestablishPDCP flag. The network does not list the drb-Identity in the (source) drb-ToReleaseList.
NOTE 3: When setting the reestablishPDCP flag for a radio bearer, the network ensures that the RLC receiver entities do not deliver old PDCP PDUs to the re-established PDCP entity. It does that e.g. by triggering a reconfiguration with sync of the cell group hosting the old RLC entity or by releasing the old RLC entity.
NOTE 4: In this specification, UE configuration refers to the parameters configured by NR RRC unless otherwise
NOTE 5: Ciphering and integrity protection can be enabled or disabled for a DRB. The enabling/disabling of ciphering or integrity protection can be changed only by releasing and adding the DRB.
NOTE 6: In DAPS handover, the UE may perform PDCP entity re-establishment (if reestablishPDCP is set) or the PDCP data recovery (if recoverPDCP is set) for a non-DAPS bearer when indication of successful completion of random access towards target cell is received from lower layers as specified in TS 38.321
. In this case, the UE suspends data transmission and reception for all non-DAPS bearers in the source MCG for duration of the DAPS handover.
5.3.5.6.6 Multicast MRB release
The UE shall:
1&gt; for each mrb-Identity value included in the mrb-ToReleaseList that is part of the current UE configuration; or
1&gt; for each mrb-Identity value that is to be released as the result of full configuration according to 5.3.5.11:
2&gt; release the PDCP entity and the mrb-Identity;
2&gt; indicate the release of the multicast MRB and the tmgi of the released multicast MRB to upper layers.
NOTE 1: The UE does not consider the message as erroneous if the mrb-ToReleaseList includes any mrb-Identity value that is not part of the current UE configuration.
NOTE 2: Whether or not the RLC and MAC entities associated with this PDCP entity are reset or released is determined by the CellGroupConfig.
5.3.5.6.7 Multicast MRB addition/modification
The UE shall:
1&gt; for each mrb-Identity value included in the mrb-ToAddModList for which mrb-IdentityNew is included (multicast MRB ID change):
2&gt; update the mrb-Identity to the value mrb-IdentityNew;
1&gt; for each mrb-Identity value included in the mrb-ToAddModList that is not part of the current UE configuration (multicast MRB establishment including the case when full configuration option is used):
2&gt; establish a PDCP entity and configure it in accordance with the received pdcp-Config;
2&gt; if the multicast MRB was configured with the same tmgi prior to receiving this reconfiguration message:
3&gt; associate the established multicast MRB with the corresponding tmgi;
3&gt; indicate the establishment of the multicast MRB(s) and the tmgi of the established multicast MRB(s) to upper layers;
2&gt; if an SDAP entity with the received tmgi does not exist:
3&gt; establish an SDAP entity as specified in TS 37.324 clause 5.1.1;
1&gt; for each mrb-Identity value included in the mrb-ToAddModList that is part of the current UE configuration (prior treating this mrb-ToAddModList):
2&gt; if the reestablishPDCP is set:
3&gt; if drb-ContinueROHC is included in pdcp-Config:
4&gt; indicate to lower layer that drb-ContinueROHC is configured;
3&gt; if drb-ContinueEHC-DL is included in pdcp-Config:
4&gt; indicate to lower layer that drb-ContinueEHC-DL is configured;
3&gt; re-establish the PDCP entity of this multicast MRB as specified in TS 38.323 , clause 5.1.2;
2&gt; else, if the recoverPDCP is set:
3&gt; trigger the PDCP entity of this MRB to perform data recovery as specified in TS 38.323 ;
2&gt; if the pdcp-Config is included:
3&gt; reconfigure the PDCP entity in accordance with the received pdcp-Config.
NOTE 1: When setting the reestablishPDCP flag for a radio bearer, the network ensures that the RLC receiver entities do not deliver old PDCP PDUs to the re-established PDCP entity. It does that e.g. by triggering a reconfiguration with sync of the cell group hosting the old RLC entity or by releasing the old RLC entity.
NOTE 2: In this specification, UE configuration refers to the parameters configured by NR RRC unless otherwise
5.3.5.7 AS Security key update
The UE shall:
1&gt; if UE is connected to E-UTRA/EPC or E-UTRA/5GC:
2&gt; upon reception of sk-Counter as specified in TS 36.331 :
3&gt; update the S-K key based on the K key and using the received sk-Counter value, as specified in TS gNB eNB
33.401 for EN-DC, or TS 33.501 for NGEN-DC;
3&gt; derive the K and K keys as specified in TS 33.401 for EN-DC, or TS 33.501 for RRCenc UPenc NGEN-DC;
3&gt; derive the K and K keys as specified in TS 33.401 for EN-DC or TS 33.501 for NGEN- RRCint UPint DC.
1&gt; else if this procedure was initiated due to reception of the masterKeyUpdate:
2&gt; if the nas-Container is included in the received masterKeyUpdate:
3&gt; forward the nas-Container to the upper layers;
2&gt; if the keySetChangeIndicator is set to true:
3&gt; derive or update the K key based on the K key, as specified in TS 33.501 ; gNB AMF
3&gt; derive or update the K key based on the current K key or the NH, using the nextHopChainingCount gNB gNB value indicated in the received masterKeyUpdate, as specified in TS 33.501 ;
2&gt; store the nextHopChainingCount value;
2&gt; derive the keys associated with the K key as follows:
gNB
3&gt; if the securityAlgorithmConfig is included in SecurityConfig:
4&gt; derive the K and K keys associated with the cipheringAlgorithm indicated in the RRCenc UPenc securityAlgorithmConfig, as specified in TS 33.501 ;
4&gt; derive the K and K keys associated with the integrityProtAlgorithm indicated in the RRCint UPint securityAlgorithmConfig, as specified in TS 33.501 ;
4&gt; derive the K and K keys associated with the current cipheringAlgorithm, as specified in TS RRCenc UPenc
4&gt; derive the K and K keys associated with the current integrityProtAlgorithm, as specified in RRCint UPint TS 33.501 .
NOTE 1: Ciphering and integrity protection are optional to configure for the DRBs.
1&gt; else if this procedure was initiated due to reception of the sk-Counter (UE is in NE-DC, or NR-DC, or is configured with SN terminated bearer(s)):
2&gt; derive or update the secondary key (S-K or S-KeNB) based on the KgNB key and using the received sk- gNB
Counter value, as specified in TS 33.501 ;
2&gt; derive the K key and the K key as specified in TS 33.501 using the ciphering algorithms RRCenc UPenc indicated in the RadioBearerConfig associated with the secondary key (S-K or S-KeNB) as indicated by gNB keyToUse;
2&gt; derive the K key and the K key as specified in TS 33.501 using the integrity protection RRCint UPint algorithms indicated in the RadioBearerConfig associated with the secondary key (S-K or S-KeNB) as gNB indicated by keyToUse; NOTE 2: If the UE has no radio bearer configured with keyToUse set to secondary and receives the sk-Counter without any RadioBearerConfig with keyToUse set to secondary, the UE does not consider it as an invalid reconfiguration.
5.3.5.8 Reconfiguration failure
5.3.5.8.1 Void
5.3.5.8.2 Inability to comply with RRCReconfiguration NOTE 00: The UE behaviour specified in this clause does not apply to the fields in ServingCellConfigCommon that are defined in release-16 and later. The UE ignores, i.e. does not take an action on and does not store, the fields that it does not support or does not comprehend.
The UE shall:
1&gt; if the UE is in (NG)EN-DC:
2&gt; if the UE is unable to comply with (part of) the configuration included in the RRCReconfiguration message received over SRB3;
3&gt; if the RRCReconfiguration message was received as part of ConditionalReconfiguration:
4&gt; continue using the configuration used prior to when the inability to comply with the RRCReconfiguration message was detected;
4&gt; continue using the configuration used prior to the reception of RRCReconfiguration message;
3&gt; if MCG transmission is not suspended:
4&gt; initiate the SCG failure information procedure as specified in clause 5.7.3 to report SCG reconfiguration error, upon which the connection reconfiguration procedure ends;
4&gt; initiate the connection re-establishment procedure as specified in TS 36.331 , clause 5.3.7, upon which the connection reconfiguration procedure ends;
2&gt; else, if the UE is unable to comply with (part of) the configuration included in the RRCReconfiguration message received over SRB1;
3&gt; if the RRCReconfiguration message was received as part of ConditionalReconfiguration:
4&gt; continue using the configuration used prior to when the inability to comply with the RRCReconfiguration message was detected;
4&gt; continue using the configuration used prior to the reception of RRCReconfiguration message;
3&gt; initiate the connection re-establishment procedure as specified in TS 36.331 , clause 5.3.7, upon which the connection reconfiguration procedure ends.
1&gt; else if RRCReconfiguration is received via NR (i.e., NR standalone, NE-DC, or NR-DC):
2&gt; if the UE is unable to comply with (part of) the configuration included in the RRCReconfiguration message received over SRB3; NOTE 0: This case does not apply in NE-DC.
3&gt; if the RRCReconfiguration message was received as part of ConditionalReconfiguration:
4&gt; continue using the configuration used prior to when the inability to comply with the RRCReconfiguration message was detected;
4&gt; continue using the configuration used prior to the reception of RRCReconfiguration message;
3&gt; if MCG transmission is not suspended:
4&gt; initiate the SCG failure information procedure as specified in clause 5.7.3 to report SCG reconfiguration error, upon which the connection reconfiguration procedure ends;
4&gt; initiate the connection re-establishment procedure as specified in clause 5.3.7, upon which the connection reconfiguration procedure ends;
2&gt; else if the UE is unable to comply with (part of) the configuration included in the RRCReconfiguration message received over the SRB1 or if the upper layers indicate that the nas-Container is invalid:
NOTE 0a: The compliance also covers the SCG configuration carried within octet strings e.g. field mrdc- SecondaryCellGroupConfig. I.e. the failure behaviour defined also applies in case the UE cannot comply with the embedded SCG configuration or with the combination of (parts of) the MCG and SCG
NOTE 0b: The compliance also covers the V2X sidelink configuration carried within an octet string, e.g. field sl- ConfigDedicatedEUTRA. I.e. the failure behaviour defined also applies in case the UE cannot comply with the embedded V2X sidelink configuration.
3&gt; if the RRCReconfiguration message was received as part of ConditionalReconfiguration:
4&gt; continue using the configuration used prior to when the inability to comply with the RRCReconfiguration message was detected;
4&gt; continue using the configuration used prior to the reception of RRCReconfiguration message;
3&gt; if AS security has not been activated:
4&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'other'
3&gt; else if AS security has been activated but SRB2 and at least one DRB or multicast MRB or, for IAB, SRB2, have not been setup:
4&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'RRC connection failure';
4&gt; initiate the connection re-establishment procedure as specified in 5.3.7, upon which the reconfiguration procedure ends;
1&gt; else if RRCReconfiguration is received via other RAT (Handover to NR failure):
2&gt; if the UE is unable to comply with any part of the configuration included in the RRCReconfiguration message or if the upper layers indicate that the nas-Container is invalid:
3&gt; perform the actions defined for this failure case as defined in the specifications applicable for the other RAT.
NOTE 1: The UE may apply above failure handling also in case the RRCReconfiguration message causes a protocol error for which the generic error handling as defined in clause 10 specifies that the UE shall ignore the message.
NOTE 2: If the UE is unable to comply with part of the configuration, it does not apply any part of the configuration, i.e. there is no partial success/failure.
NOTE 3: It is up to UE implementation whether the compliance check for an RRCReconfiguration received as part of ConditionalReconfiguration is performed upon the reception of the message or upon CHO, CPA and CPC execution (when the message is required to be applied).
5.3.5.8.3 T304 expiry (Reconfiguration with sync Failure) or T420 expiry (Path switch
The UE shall:
1&gt; if T304 of the MCG expires, or
1&gt; if the target L2 U2N Relay UE changes its serving PCell before path switch (i.e. the received RRCReconfiguration message containing reconfigurationWithSync indicating path switch as specified in
2&gt; release dedicated preambles provided in rach-ConfigDedicated if configured;
2&gt; release dedicated msgA PUSCH resources provided in rach-ConfigDedicated if configured;
2&gt; if any DAPS bearer is configured, and radio link failure is not detected in the source PCell, according to clause 5.3.10.3:
3&gt; reset MAC for the target PCell and release the MAC configuration for the target PCell;
3&gt; for each DAPS bearer:
4&gt; release the RLC entity or entities as specified in TS 38.322 , clause 5.1.3, and the associated logical channel for the target PCell;
4&gt; reconfigure the PDCP entity to release DAPS as specified in TS 38.323 ;
3&gt; for each SRB:
4&gt; if the masterKeyUpdate was not received:
5&gt; configure the PDCP entity for the source PCell with state variables continuation as specified in TS
4&gt; release the PDCP entity for the target PCell;
4&gt; release the RLC entity as specified in TS 38.322 , clause 5.1.3, and the associated logical channel for the target PCell;
4&gt; trigger the PDCP entity for the source PCell to perform SDU discard as specified in TS 38.323 ;
4&gt; re-establish the RLC entity for the source PCell;
3&gt; release the physical channel configuration for the target PCell;
3&gt; discard the keys used in target PCell (the K key, the K key, the K key, the K key and the gNB RRCenc RRCint UPint
K key), if any; UPenc
3&gt; resume suspended SRBs in the source PCell;
4&gt; revert back to the UE configuration used for the DRB or multicast MRB in the source PCell, includes PDCP, RLC states variables, the security configuration and the data stored in transmission and reception buffers in PDCP and RLC entities ;
3&gt; revert back to the UE measurement configuration used in the source PCell;
3&gt; store the handover failure information in VarRLF-Report as described in the clause 5.3.10.5;
3&gt; initiate the failure information procedure as specified in clause 5.7.5 to report DAPS handover failure.
3&gt; revert back to the UE configuration used in the source PCell;
3&gt; if the associated T304 was not initiated upon cell selection performed while timer T311 was running, as defined in clause 5.3.7.3:
4&gt; store the handover failure information in VarRLF-Report as described in the clause 5.3.10.5;
3&gt; initiate the connection re-establishment procedure as specified in clause 5.3.7.
NOTE 1: In the context above, "the UE configuration" includes state variables and parameters of each radio bearer.
1&gt; else if T304 of a secondary cell group expires:
2&gt; if MCG transmission is not suspended:
3&gt; release dedicated preambles provided in rach-ConfigDedicated, if configured;
3&gt; initiate the SCG failure information procedure as specified in clause 5.7.3 to report SCG reconfiguration with sync failure, upon which the RRC reconfiguration procedure ends;
3&gt; if the UE is in NR-DC:
4&gt; initiate the connection re-establishment procedure as specified in clause 5.3.7;
3&gt; else (the UE is in (NG) EN-DC):
4&gt; initiate the connection re-establishment procedure as specified in TS 36.331 , clause 5.3.7;
1&gt; else if T304 expires when RRCReconfiguration is received via other RAT (HO to NR failure):
2&gt; perform the actions defined for this failure case as defined in the specifications applicable for the other RAT.
NOTE 2: In this clause, the term 'handover failure' has been used to refer to 'reconfiguration with sync failure'.
5.3.5.9 Other configuration
The UE shall:
1&gt; if the received otherConfig includes the delayBudgetReportingConfig:
2&gt; if delayBudgetReportingConfig is set to setup:
3&gt; consider itself to be configured to send delay budget reports in accordance with 5.7.4;
3&gt; consider itself not to be configured to send delay budget reports and stop timer T342, if running.
1&gt; if the received otherConfig includes the overheatingAssistanceConfig:
2&gt; if overheatingAssistanceConfig is set to setup:
3&gt; consider itself to be configured to provide overheating assistance information in accordance with 5.7.4;
3&gt; consider itself not to be configured to provide overheating assistance information and stop timer T345, if running;
1&gt; if the received otherConfig includes the idc-AssistanceConfig:
2&gt; if idc-AssistanceConfig is set to setup:
3&gt; consider itself to be configured to provide IDC assistance information in accordance with 5.7.4;
3&gt; consider itself not to be configured to provide IDC assistance information;
1&gt; if the received otherConfig includes the drx-PreferenceConfig:
2&gt; if drx-PreferenceConfig is set to setup:
3&gt; consider itself to be configured to provide its preference on DRX parameters for power saving for the cell group in accordance with 5.7.4;
3&gt; consider itself not to be configured to provide its preference on DRX parameters for power saving for the cell group and stop timer T346a associated with the cell group, if running;
1&gt; if the received otherConfig includes the maxBW-PreferenceConfig:
2&gt; if maxBW-PreferenceConfig is set to setup:
3&gt; consider itself to be configured to provide its preference on the maximum aggregated bandwidth for power saving for the cell group in accordance with 5.7.4;
3&gt; if otherConfig includes maxBW-PreferenceConfigFR2-2:
4&gt; consider itself to be configured to provide its preference on the maximum aggregated bandwidth for FR2-2 for power saving for the cell group in accordance with 5.7.4;
3&gt; consider itself not to be configured to provide its preference on the maximum aggregated bandwidth for power saving for the cell group and stop timer T346b associated with the cell group, if running;
1&gt; if the received otherConfig includes the maxCC-PreferenceConfig:
2&gt; if maxCC-PreferenceConfig is set to setup:
3&gt; consider itself to be configured to provide its preference on the maximum number of secondary component carriers for power saving for the cell group in accordance with 5.7.4;
3&gt; consider itself not to be configured to provide its preference on the maximum number of secondary component carriers for power saving for the cell group and stop timer T346c associated with the cell group, if running;
1&gt; if the received otherConfig includes the maxMIMO-LayerPreferenceConfig:
2&gt; if maxMIMO-LayerPreferenceConfig is set to setup:
3&gt; consider itself to be configured to provide its preference on the maximum number of MIMO layers for power saving for the cell group in accordance with 5.7.4;
3&gt; if otherConfig includes maxMIMO-LayerPreferenceConfigFR2-2:
4&gt; consider itself to be configured to provide its preference on the maximum number of MIMO layers for FR2-2 for power saving for the cell group in accordance with 5.7.4;
3&gt; consider itself not to be configured to provide its preference on the maximum number of MIMO layers for power saving for the cell group and stop timer T346d associated with the cell group, if running;
1&gt; if the received otherConfig includes the minSchedulingOffsetPreferenceConfig:
2&gt; if minSchedulingOffsetPreferenceConfig is set to setup:
3&gt; consider itself to be configured to provide its preference on the minimum scheduling offset for cross-slot scheduling for power saving for the cell group in accordance with 5.7.4;
3&gt; if otherConfig includes minSchedulingOffsetPreferenceConfigExt:
4&gt; consider itself to be configured to provide its preference on the minimum scheduling offset for 480 kHz SCS and/or 960 kHz SCS for cross-slot scheduling for power saving for the cell group in accordance with 5.7.4;
3&gt; consider itself not to be configured to provide its preference on the minimum scheduling offset for cross- slot scheduling for power saving for the cell group and stop timer T346e associated with the cell group, if running;
1&gt; if the received otherConfig includes the releasePreferenceConfig:
2&gt; if releasePreferenceConfig is set to setup:
3&gt; consider itself to be configured to provide assistance information to transition out of RRC_CONNECTED in accordance with 5.7.4;
3&gt; consider itself not to be configured to provide assistance information to transition out of RRC_CONNECTED and stop timer T346f, if running.
1&gt; if the received otherConfig includes the obtainCommonLocation:
2&gt; include available detailed location information for any subsequent measurement report or any subsequent RLF report and SCGFailureInformation; NOTE 1: The UE is requested to attempt to have valid detailed location information available whenever sending a measurement report for which it is configured to include available detailed location information. The UE may not succeed e.g. because the user manually disabled the GPS hardware, due to no/poor satellite
coverage. Further details, e.g. regarding when to activate GNSS, are up to UE implementation.
1&gt; if the received otherConfig includes the btNameList:
2&gt; if btNameList is set to setup, include available Bluetooth measurement results for any subsequent measurement report or any subsequent RLF report and SCGFailureInformation;
1&gt; if the received otherConfig includes the wlanNameList:
2&gt; if wlanNameList is set to setup, include available WLAN measurement results for any subsequent measurement report or any subsequent RLF report and SCGFailureInformation;
1&gt; if the received otherConfig includes the sensorNameList:
2&gt; if sensorNameList is set to setup, include available Sensor measurement results for any subsequent measurement report or any subsequent RLF report and SCGFailureInformation; NOTE 2: The UE is requested to attempt to have valid Bluetooth measurements, WLAN measurements and Sensor measurements whenever sending a measurement report for which it is configured to include these
measurements. The UE may not succeed e.g. because the user manually disabled the WLAN or Bluetooth or Sensor hardware. Further details, e.g. regarding when to activate WLAN or Bluetooth or Sensor, are up to UE implementation.
1&gt; if the received otherConfig includes the sl-AssistanceConfigNR:
2&gt; consider itself to be configured to provide configured grant assistance information for NR sidelink communication in accordance with 5.7.4;
1&gt; if the received otherConfig includes the referenceTimePreferenceReporting:
2&gt; consider itself to be configured to provide UE reference time assistance information in accordance with 5.7.4;
2&gt; consider itself not to be configured to provide UE reference time assistance information;
1&gt; if the received otherConfig includes the successHO-Config:
2&gt; consider itself to be configured to provide the successful handover information in accordance with 5.7.10.6;
2&gt; consider itself not to be configured to provide the successful handover information.
1&gt; if the received otherConfig includes the ul-GapFR2-PreferenceConfig:
2&gt; consider itself to be configured to provide its preference on FR2 UL gap in accordance with 5.7.4;
2&gt; consider itself not to be configured to provide its preference on FR2 UL gap;
1&gt; if the received otherConfig includes the musim-GapAssistanceConfig:
2&gt; if musim-GapAssistanceConfig is set to setup:
3&gt; consider itself to be configured to provide MUSIM assistance information without leaving RRC_CONNECTED in accordance with 5.7.4;
3&gt; consider itself not to be configured to provide MUSIM assistance information without leaving RRC_CONNECTED in accordance with 5.7.4 and stop timer T346h, if running;
1&gt; if the received otherConfig includes the musim-LeaveAssistanceConfig:
2&gt; if musim-LeaveAssistanceConfig is set to setup:
3&gt; consider itself to be configured to provide MUSIM assistance information for leaving RRC_CONNECTED in accordance with 5.7.4;
3&gt; consider itself not to be configured to provide MUSIM assistance information for leaving RRC_CONNECTED in accordance with 5.7.4 and stop timer T346g, if running.
1&gt; if the received otherConfig includes the rlm-RelaxationReportingConfig:
2&gt; if rlm-RelaxationReportingConfig is set to setup:
3&gt; consider itself to be configured to report the relaxation state of RLM measurements with 5.7.4;
3&gt; consider itself not to be configured to report the relaxation state of RLM measurements;
1&gt; if the received otherConfig includes the bfd-RelaxationReportingConfig:
2&gt; if bfd-RelaxationReportingConfig is set to setup:
3&gt; consider itself to be configured to report the relaxation state of BFD measurements with 5.7.4;
3&gt; consider itself not to be configured to report the relaxation state of BFD measurements;
1&gt; if the received otherConfig includes the scg-DeactivationPreferenceConfig:
2&gt; if the scg-DeactivationPreferenceConfig is set to setup:
3&gt; consider itself to be configured to provide its SCG deactivation preference in accordance with 5.7.4;
3&gt; consider itself not to be configured to provide its SCG deactivation preference and stop timer T346i, if
The UE shall:
1&gt; as a result of MR-DC release triggered by E-UTRA or NR:
2&gt; release SRB3, if established, as specified in 5.3.5.6.2;
2&gt; release measConfig associated with SCG;
2&gt; if the UE is configured with NR SCG:
3&gt; release the SCG configuration as specified in clause 5.3.5.4;
3&gt; release otherConfig associated with the SCG, if configured;
3&gt; release bap-Config associated with the SCG, if configured;
3&gt; release iab-IP-AddressConfigurationList associated with the SCG, if configured;
2&gt; else if the UE is configured with E-UTRA SCG:
3&gt; release the SCG configuration as specified in TS 36.331 , clause 5.3.10.19 to release the E-UTRA SCG;
5.3.5.11 Full configuration
The UE shall:
1&gt; release/ clear all current dedicated radio configurations except for the following: a) the MCG C-RNTI; b) the AS security configurations associated with the master key; c) the SRB1/SRB2 configurations and DRB/multicast MRB configurations as configured by radioBearerConfig or radioBearerConfig2.
NOTE 1: Radio configuration is not just the resource configuration but includes other configurations like MeasConfig. Radio configuration also includes the RLC bearer configurations as configured by RLC- BearerConfig. In case NR-DC or NE-DC is configured, this also includes the entire NR or E-UTRA SCG configuration which are released according to the MR-DC release procedure as specified in 5.3.5.10.
NOTE 1a: For NR sidelink communication, the radio configuration includes the sidelink RRC configuration received from the network, but does not include the sidelink RRC reconfiguration and sidelink UE capability received from other UEs via PC5-RRC. In addition, the UE considers the new NR sidelink configurations as full configuration, in case of state transition and change of system information used for NR sidelink communication.
NOTE 1b: To establish the RLC bearer of SRB(s) after release due to fullConfig, the network can include the srb- Identity within srb-ToAddModList (i.e. the UE applies RLC default configuration) and/or provide rlc- BearerToAddModList of concerned SRB(s) explicitly. a) the logged measurement configuration;
1&gt; if the spCellConfig in the masterCellGroup includes the reconfigurationWithSync:
2&gt; release/ clear all current common radio configurations;
2&gt; use the default values specified in 9.2.3 for timers T310, T311 and constants N310, N311;
1&gt; else (full configuration after re-establishment or during RRC resume):
2&gt; if the UE is connected with a L2 U2N Relay UE via the PC5-RRC connection (i.e. the UE is a L2 U2N
Remote UE):
3&gt; use values for timers T300, T301 and T319 as included in ue-TimersAndConstants-RemoteUE received in SIB1;
3&gt; use value for timer T311, as included in ue-TimersAndConstants received in SIB1
3&gt; use values for timers T301, T310, T311 and constants N310, N311, as included in ue- TimersAndConstants received in SIB1;
1&gt; if no measConfigAppLayerId is included:
2&gt; inform upper layers about the release of all application layer measurement configurations;
2&gt; discard any received application layer measurement report from upper layers;
2&gt; consider itself not to be configured to send application layer measurement report.
1&gt; apply the default L1 parameter values as specified in corresponding physical layer specifications except for the following: a) parameters for which values are provided in SIB1;
1&gt; apply the default MAC Cell Group configuration as specified in 9.2.2;
1&gt; for each srb-Identity value included in the srb-ToAddModList (SRB reconfiguration):
2&gt; establish an RLC entity for the corresponding SRB;
2&gt; apply the default SRB configuration defined in 9.2.1 for the corresponding SRB; NOTE 2: This is to get the SRBs (SRB1 and SRB2 for reconfiguration with sync and SRB2 for resume and reconfiguration after re-establishment) to a known state from which the reconfiguration message can do further configuration.
1&gt; for each pdu-Session that is part of the current UE configuration:
2&gt; release the SDAP entity (clause 5.1.2 in TS 37.324 );
2&gt; release each DRB associated to the pdu-Session as specified in 5.3.5.6.4; NOTE 3: This will retain the pdu-Session but remove the DRBs including drb-identity of these bearers from the current UE configuration. Setup of the DRBs within the AS is described in clause 5.3.5.6.5 using the new
configuration. The pdu-Session acts as the anchor for associating the released and re-setup DRB. In the AS the DRB re-setup is equivalent with a new DRB setup (including new PDCP and logical channel configurations).
1&gt; for each tmgi that is part of the current UE configuration:
2&gt; release the SDAP entity (clause 5.1.2 in TS 37.324 );
2&gt; release each multicast MRB associated to the tmgi as specified in 5.3.5.6.6; NOTE 4: This will retain the tmgi but remove the multicast MRBs including mrb-identity of these bearers from the current UE configuration. Setup of the multicast MRBs within the AS is described in clause 5.3.5.6.7 using the new configuration. The tmgi acts as the anchor for associating the released and re-setup multicast MRB. In the AS the multicast MRB re-setup is equivalent with a new multicast MRB setup (including new PDCP and logical channel configurations).
1&gt; for each pdu-Session that is part of the current UE configuration but not added with same pdu-Session in the drb- ToAddModList:
2&gt; if the procedure was triggered due to reconfiguration with sync:
3&gt; indicate the release of the user plane resources for the pdu-Session to upper layers after successful reconfiguration with sync;
3&gt; indicate the release of the user plane resources for the pdu-Session to upper layers immediately;
1&gt; for each tmgi that is part of the current UE configuration but not added with the same tmgi in the mrb- ToAddModList:
2&gt; if the procedure was triggered due to reconfiguration with sync:
3&gt; indicate the release of the user plane resources for the tmgi to upper layers after successful reconfiguration with sync;
3&gt; indicate the release of the user plane resources for the tmgi to upper layers immediately.
5.3.5.12 BAP configuration
1&gt; if the bap-Config is set to setup:
2&gt; if no BAP entity is established:
3&gt; establish a BAP entity as specified in TS 38.340 ;
3&gt; configure the BAP entity to use the bap-Address as this node's BAP address;
3&gt; configure the BAP entity to apply the default UL BAP routing ID according to the configuration;
2&gt; if defaultUL-BH-RLC-Channel is included
3&gt; configure the BAP entity to apply the default UL BH RLC channel according to the configuration;
2&gt; if flowControlFeedbackType is included:
3&gt; configure the BAP entity to apply the flow control feedback according to the configuration;
1&gt; if the bap-Config is set to release:
2&gt; release the BAP entity as specified in TS 38.340 .
5.3.5.12a IAB Other Configuration
5.3.5.12a.1 IP address management
5.3.5.12a.1.1 IP Address Release
1&gt; if the release is triggered by reception of the iab-IP-AddressToReleaseList:
2&gt; for each iab-IP-AddressIndex value included in iab-IP-AddressToReleaseList:
3&gt; release the corresponding IAB-IP-AddressConfiguration.
5.3.5.12a.1.2 IP Address Addition/Modification
1&gt; for each iab-IP-AddressIndex value included in the iab-IP-AddressToAddModList that is not part of the current IAB-MT configuration:
2&gt; add the IP address indicated in iab-IP-Address, corresponding to the iab-IP-AddressIndex.
2&gt; if added IP address is iPv4-Address:
3&gt; if iab-IP-Usage is set to f1-C:
4&gt; store the received IPv4 address for F1-C traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
3&gt; else if iab-IP-Usage is set to f1-U:
4&gt; store the received IPv4 address for F1-U traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
3&gt; else if iab-IP-Usage is set to non-F1:
4&gt; store the received IPv4 address for non-F1 traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
4&gt; store the received IPv4 address for all traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
2&gt; else if iPv6-Address is included:
3&gt; if iab-IP-Usage is set to f1-C:
4&gt; store the received IPv6 address for F1-C traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
3&gt; else if iab-IP-Usage is set to f1-U:
4&gt; store the received IPv6 address for F1-U traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
3&gt; else if iab-IP-Usage is set to non-F1:
4&gt; store the received IPv6 address for non-F1 traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
4&gt; store the received IPv6 address for all traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
2&gt; else if iPv6-Prefix is included in iab-IP-AddressToAddModList:
3&gt; if iab-IP-Usage is set to f1-C:
4&gt; store the received IPv6 address prefix for F1-C traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
3&gt; else if iab-IP-Usage is set to f1-U:
4&gt; store the received IPv6 address prefix for F1-U traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
3&gt; else if iab-IP-Usage is set to non-F1:
4&gt; store the received IPv6 address prefix for non-F1 traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
4&gt; store the received IPv6 address prefix for all traffic together with the IAB-donor-DU BAP address corresponding to the iab-IP-AddressIndex.
1&gt; for each iab-IP-AddressIndex value included in the iab-IP-AddressToAddModList that is part of the current IAB- MT configuration:
2&gt; modify the IP address configuration(s) in accordance with the IAB-IP-AddressConfiguration corresponding to the iab-IP-AddressIndex.
5.3.5.13 Conditional Reconfiguration
5.3.5.13.1 General
The network configures the UE with one or more candidate target SpCells in the conditional reconfiguration. The UE evaluates the condition of each configured candidate target SpCell. The UE applies the conditional reconfiguration associated with one of the target SpCells which fulfils associated execution condition. The network provides the configuration parameters for the target SpCell in the ConditionalReconfiguration IE.
The UE performs the following actions based on a received ConditionalReconfiguration IE:
1&gt; if the ConditionalReconfiguration contains the condReconfigToRemoveList:
2&gt; perform conditional reconfiguration removal procedure as specified in 5.3.5.13.2;
1&gt; if the ConditionalReconfiguration contains the condReconfigToAddModList:
2&gt; perform conditional reconfiguration addition/modification as specified in 5.3.5.13.3;
5.3.5.13.2 Conditional reconfiguration removal
The UE shall:
1&gt; for each condReconfigId value included in the condReconfigToRemoveList that is part of the current UE conditional reconfiguration in VarConditionalReconfig:
2&gt; remove the entry with the matching condReconfigId from the VarConditionalReconfig; NOTE: The UE does not consider the message as erroneous if the condReconfigToRemoveList includes any condReconfigId value that is not part of the current UE configuration.
5.3.5.13.3 Conditional reconfiguration addition/modification
For each condReconfigId received in the condReconfigToAddModList IE the UE shall:
1&gt; if an entry with the matching condReconfigId exists in the condReconfigToAddModList within the VarConditionalReconfig:
2&gt; if the entry in condReconfigToAddModList includes an condExecutionCond or condExecutionCondSCG;
3&gt; replace condExecutionCond or condExecutionCondSCG within the VarConditionalReconfig with the value received for this condReconfigId;
2&gt; if the entry in condReconfigToAddModList includes an condRRCReconfig;
3&gt; replace condRRCReconfig within the VarConditionalReconfig with the value received for this condReconfigId;
2&gt; add a new entry for this condReconfigId within the VarConditionalReconfig;
1&gt; perform conditional reconfiguration evaluation as specified in 5.3.5.13.4;
5.3.5.13.4 Conditional reconfiguration evaluation
The UE shall:
1&gt; for each condReconfigId within the VarConditionalReconfig:
2&gt; if the RRCReconfiguration within condRRCReconfig includes the masterCellGroup including the reconfigurationWithSync, consider the cell which has a physical cell identity matching the value indicated in the ServingCellConfigCommon included in the reconfigurationWithSync within the masterCellGroup in the received condRRCReconfig to be applicable cell;
2&gt; if the RRCReconfiguration within condRRCReconfig includes the secondaryCellGroup including the reconfigurationWithSync, consider the cell which has a physical cell identity matching the value indicated in the ServingCellConfigCommon included in the reconfigurationWithSync within the secondaryCellGroup within the received condRRCReconfig to be applicable cell;
2&gt; if condExecutionCondSCG is configured:
3&gt; in the remainder of the procedures, consider each measId indicated in the condExecutionCondSCG as a measId in the VarMeasConfig associated with the SCG measConfig;
2&gt; if condExecutionCond is configured:
3&gt; if it is configured via SRB3 or configured within nr-SCG or within nr-SecondaryCellGroupConfig (specified in TS 36.331) via SRB1:
4&gt; in the remainder of the procedures, consider each measId indicated in the condExecutionCond as a measId in the VarMeasConfig associated with the SCG measConfig;
4&gt; in the remainder of the procedures, consider each measId indicated in the condExecutionCond as a measId in the VarMeasConfig associated with the MCG measConfig;
2&gt; for each measId included in the measIdList within VarMeasConfig indicated in the condExecutionCond or condExecutionCondSCG associated to condReconfigId:
3&gt; if the condEventId is associated with condEventT1, and if the entry condition(s) applicable for this event associated with the condReconfigId, i.e. the event corresponding with the condEventId(s) of the corresponding condTriggerConfig within VarConditionalReconfig, is fulfilled for the applicable cells; or
3&gt; if the condEventId is associated with condEventD1, and if the entry condition(s) applicable for this event associated with the condReconfigId, i.e. the event corresponding with the condEventId(s) of the corresponding condTriggerConfig within VarConditionalReconfig, is fulfilled for the applicable cells during the corresponding timeToTrigger defined for this event within the VarConditionalReconfig; or
3&gt; if the condEventId is associated with condEventA3, condEventA4 or condEventA5, and if the entry condition(s) applicable for this event associated with the condReconfigId, i.e. the event corresponding with the condEventId(s) of the corresponding condTriggerConfig within VarConditionalReconfig, is fulfilled for the applicable cells for all measurements after layer 3 filtering taken during the corresponding timeToTrigger defined for this event within the VarConditionalReconfig:
4&gt; consider the event associated to that measId to be fulfilled;
3&gt; if the measId for this event associated with the condReconfigId has been modified; or
3&gt; if the condEventId is associated with condEventT1, and if the leaving condition(s) applicable for this event associated with the condReconfigId, i.e. the event corresponding with the condEventId(s) of the corresponding condTriggerConfig within VarConditionalReconfig, is fulfilled for the applicable cells; or
3&gt; if the condEventId is associated with condEventD1, and if the leaving condition(s) applicable for this event associated with the condReconfigId, i.e. the event corresponding with the condEventId(s) of the corresponding condTriggerConfig within VarConditionalReconfig, is fulfilled for the applicable cells during the corresponding timeToTrigger defined for this event within the VarConditionalReconfig; or
3&gt; if the condEventId is associated with condEventA3, condEventA4 or condEventA5, and if the leaving condition(s) applicable for this event associated with the condReconfigId, i.e. the event corresponding with the condEventId(s) of the corresponding condTriggerConfig within VarConditionalReconfig, is fulfilled for the applicable cells for all measurements after layer 3 filtering taken during the corresponding timeToTrigger defined for this event within the VarConditionalReconfig:
4&gt; consider the event associated to that measId to be not fulfilled;
2&gt; if event(s) associated to all measId(s) within condTriggerConfig for a target candidate cell within the stored condRRCReconfig are fulfilled:
3&gt; consider the target candidate cell within the stored condRRCReconfig, associated to that condReconfigId, as a triggered cell;
3&gt; initiate the conditional reconfiguration execution, as specified in 5.3.5.13.5; NOTE: Up to 2 MeasId can be configured for each condReconfigId. The conditional reconfiguration event of the
2 MeasId may have the same or different event conditions, triggering quantity, time to trigger, and triggering threshold.
5.3.5.13.4a Conditional reconfiguration evaluation of SN initiated inter-SN CPC for EN-DC
Editors Note: FFS If EN-DC support in 5.3.5.13.4a should be merged to 5.3.5.13.4.
The UE shall:
1&gt; for each condReconfigId within the VarConditionalReconfig specified in TS 36.331,:
1&gt; in the remainder of the procedures, consider each measId indicated in the IE of CondReconfigExecCondSN contained in the triggerConditionSN as specified in TS 36.331, as a measId in the VarMeasConfig associated with the SCG measConfig;
1&gt; for each measId included in the measIdList within VarMeasConfig indicated in the CondReconfigExecCondSN contained in the triggerConditionSN associated to the condReconfigurationId as specified in TS 36.331:
2&gt; if the entry condition(s) applicable for the event associated with that measId, is fulfilled for the applicable cells for all measurements after layer 3 filtering taken during the corresponding timeToTrigger defined for this event associated with that measId:
3&gt; consider this event to be fulfilled;
2&gt; if the measId for this event has been modified; or
2&gt; if the leaving condition(s) applicable for this event associated with that measId, is fulfilled for the applicable cells for all measurements after layer 3 filtering taken during the corresponding timeToTrigger defined for this event associated with that measId:
3&gt; consider this event associated to that measId to be not fulfilled;
1&gt; if trigger conditions for all events associated with the measId(s) indicated in the IE of CondReconfigExecCondSN contained in the triggerConditionSN as specified in TS 36.331), are fulfilled:
2&gt; consider the target cell candidate within the RRCReconfiguration message contained in nr- SecondaryCellGroupConfig in the RRCConnectionReconfiguration message, as specified in TS 36.331, contained in the stored condReconfigurationToApply, associated to that condReconfigurationId as specified in TS 36.331), clause 5.3.5.9.4, as a triggered cell;
2&gt; initiate the conditional reconfiguration execution, as specified in TS 36.331), clause 5.3.5.9.5; NOTE: If multiple NR cells are triggered in conditional reconfiguration execution, it is up to UE implementation which one to select, e.g. the UE considers beams and beam quality to select one of the triggered cells for
5.3.5.13.5 Conditional reconfiguration execution
The UE shall:
1&gt; if more than one triggered cell exists:
2&gt; select one of the triggered cells as the selected cell for conditional reconfiguration execution;
2&gt; consider the triggered cell as the selected cell for conditional reconfiguration execution;
1&gt; for the selected cell of conditional reconfiguration execution:
2&gt; apply the stored condRRCReconfig of the selected cell and perform the actions as specified in 5.3.5.3; NOTE: If multiple NR cells are triggered in conditional reconfiguration execution, it is up to UE implementation which one to select, e.g. the UE considers beams and beam quality to select one of the triggered cells for
5.3.5.13a SCG activation
Upon initiating the procedure, the UE shall:
1&gt; if the UE is configured with an SCG after receiving the message for which this procedure is initiated:
2&gt; consider the SCG to be activated;
2&gt; if the UE was configured with a deactivated SCG before receiving the message for which this procedure is initiated:
Editor's note:FFS whether to remove the condition above if that is handled in TS 38.321.
3&gt; resume performing radio link monitoring on the SCG, if previously stopped;
3&gt; indicate to lower layers that the SCG is activated.
5.3.5.13b SCG deactivation
Upon initiating the procedure, the UE shall:
1&gt; consider the SCG to be deactivated;
1&gt; reset SCG MAC;
1&gt; indicate to lower layers that the SCG is deactivated; Editor's note: FFS whether to make the above statement conditional to the SCG being previously activated.
1&gt; If bfd-and-RLM is not configured to true:
2&gt; stop radio link monitoring on the SCG;
2&gt; indicate to lower layers to stop beam failure detection on the PSCell;
2&gt; stop timer T310 for this cell group, if running;
2&gt; stop timer T312 for this cell group, if running;
2&gt; reset the counters N310 and N311;
1&gt; if the UE was in RRC_CONNECTED and the SCG was activated before receiving the message for which this procedure is initiated:
2&gt; if SRB3 was configured before the reception of the RRCReconfiguration or of the RRCConnectionReconfiguration and SRB3 is not to be released according to any RadioBearerConfig included in the RRCReconfiguration or in the RRCConnectionReconfiguration as specified in TS 36.331:
3&gt; trigger the PDCP entity of SRB3 to perform SDU discard as specified in TS 38.323 ;
3&gt; re-establish the RLC entity of SRB3 as specified in TS 38.322 .
5.3.5.13c FR2 UL gap configuration
The UE shall:
1&gt; if ul-GapFR2-Config is set to setup:
2&gt; if an FR2 UL gap configuration is already setup, release the FR2 UL gap configuration;
2&gt; setup the FR2 UL gap configuration indicated by the ul-GapFR2-Config in accordance with the received gapOffset, i.e., the first subframe of each gap occurs at an SFN and subframe meeting the following condition:
SFN mod T = FLOOR (gapOffse/10); if the UGRP is larger than 5ms:
subframe = gapOffset mod 10; else:
subframe = gapOffset or (gapOffset +5); with T = CEIL(UGRP/10).
1&gt; else if ul-GapFR2-Config is set to release:
2&gt; release the FR2 UL gap configuration.
NOTE 1: For ul-GapFR2-Config configuration with synchronous CA, the SFN and subframe of a serving cell on FR2 frequency is used in the gap calculation. For ul-GapFR2-Config configuration with asynchronous CA, the SFN and subframe of a serving cell on FR2 frequency indicated by the refFR2ServCellAsyncCA in ul-GapFR2-Config is used in the gap calculation.
5.3.5.13d Application layer measurement configuration
The UE shall:
1&gt; if measConfigAppLayerToAddReleaseList is included in appLayerMeasConfig within RRCReconfiguration or RRCResume:
2&gt; for each measConfigAppLayerId value included in the measConfigAppLayerToReleaseList:
3&gt; forward the measConfigAppLayerId and inform upper layers about the release of the application layer measurement configuration including any RAN visible configuration;
3&gt; discard any received application layer measurement report received from upper layers;
3&gt; consider itself not to be configured to send application layer measurement report for the measConfigAppLayerId.
1&gt; if measConfigAppLayerToAddModList is included in appLayerMeasConfig within RRCReconfiguration or RRCResume:
2&gt; for each measConfigAppLayerId value included in the measConfigAppLayerToAddModList:
3&gt; if measConfigAppLayerContainer is included for the corresponding MeasConfigAppLayer configuration:
4&gt; forward the measConfigAppLayerContainer, the measConfigAppLayerId and the serviceType to upper layers considering the serviceType;
3&gt; consider itself to be configured to send application layer measurement report for the measConfigAppLayerId in accordance with 5.7.16;
3&gt; forward the transmissionOfSessionStartStop, if received, to upper layers;
3&gt; if ran-VisibleParameters is set to setup and the parameters have been received;
4&gt; forward the measConfigAppLayerId, the ran-VisiblePeriodicity, the numberOfBufferLevelEntries and the reportInitialPlayOutDelay to upper layers considering the serviceType;
3&gt; else if ran-VisibleParameters is set to release:
4&gt; forward the measConfigAppLayerId and inform upper layers about the release of the RAN visible application layer measurement configuration;
3&gt; if pauseReporting is set to true:
4&gt; if at least one segment, but not all segments, of a segmented MeasurementReportAppLayer message containing an application layer measurement report associated with the measConfigAppLayerId has been submitted to lower layers for transmission:
5&gt; submit the remaining segments of the MeasurementReportAppLayer message to lower layers for transmission;
4&gt; suspend submitting application layer measurement report containers to lower layers for the application layer measurement configuration associated with the measConfigAppLayerId;
4&gt; store any previously or subsequently received application layer measurement report containers associated with the measConfigAppLayerId for which no segment, or full message, has been submitted to lower layers for transmission;
3&gt; else if pauseReporting is set to false and if transmission of application layer measurement report containers has previously been suspended for the application layer measurement configuration associated with the measConfigAppLayerId:
4&gt; submit stored application layer measurement report containers to lower layers for the application layer measurements configuration associated with the measConfigAppLayerId;
4&gt; resume submitting application layer measurement report containers to lower layers for the application layer measurement configuration associated with the measConfigAppLayerId; NOTE 1: The UE may discard reports when the memory reserved for storing application layer measurement reports becomes full.
NOTE 2: The transmission of RAN visible reports is not paused when pauseReporting is set to true.
5.3.5.14 Sidelink dedicated configuration
Upon initiating the procedure, the UE shall:
1&gt; if sl-FreqInfoToReleaseList is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; for each entry included in the received sl-FreqInfoToReleaseList that is part of the current UE configuration:
3&gt; release the related configurations from the stored NR sidelink communication configurations;
1&gt; if sl-FreqInfoToAddModList is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; if configured to receive NR sidelink communication:
3&gt; use the resource pool(s) indicated by sl-RxPool for NR sidelink communication reception, as specified in
2&gt; if configured to transmit NR sidelink communication:
3&gt; use the resource pool(s) indicated by sl-TxPoolSelectedNormal, sl-TxPoolSelectedNormalPS, sl- TxPoolScheduling or sl-TxPoolExceptional for NR sidelink communication transmission, as specified in
2&gt; if configured to receive NR sidelink discovery:
3&gt; use the resource pool(s) indicated by sl-DiscRxPool or sl-RxPool for NR sidelink discovery reception, as specified in 5.8.13.2;
2&gt; if configured to transmit NR sidelink discovery:
2&gt; use the synchronization configuration parameters for NR sidelink communication on frequencies included in sl-FreqInfoToAddModList, as specified in 5.8.5;
1&gt; if sl-RadioBearerToReleaseList or sl-RLC-BearerToReleaseList is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; perform sidelink DRB release as specified in 5.8.9.1a.1;
1&gt; if sl-RadioBearerToAddModList or sl-RLC-BearerToAddModList is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; perform sidelink DRB addition/modification as specified in 5.8.9.1a.2;
1&gt; if sl-ScheduledConfig is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; configure the MAC entity parameters, which are to be used for NR sidelink communication, in accordance with the received sl-ScheduledConfig;
1&gt; if sl-UE-SelectedConfig is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; configure the parameters, which are to be used for NR sidelink communication, in accordance with the received sl-UE-SelectedConfig;
1&gt; if sl-MeasConfigInfoToReleaseList is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; for each SL-DestinationIndex included in the received sl-MeasConfigInfoToReleaseList that is part of the current UE configuration:
3&gt; remove the entry with the matching SL-DestinationIndex from the stored NR sidelink measurement configuration information;
1&gt; if sl-MeasConfigInfoToAddModList is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; for each sl-DestinationIndex included in the received sl-MeasConfigInfoToAddModList that is part of the current stored NR sidelink measurement configuration:
3&gt; reconfigure the entry according to the value received for this sl-DestinationIndex from the stored NR sidelink measurement configuration information;
2&gt; for each sl-DestinationIndex included in the received sl-MeasConfigInfoToAddModList that is not part of the current stored NR sidelink measurement configuration:
3&gt; add a new entry for this sl-DestinationIndex to the stored NR sidelink measurement configuration.
1&gt; if sl-DRX-ConfigUC-ToReleaseList is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; for each SL-DestinationIndex included in the received sl-DRX-ConfigUC-ToReleaseList that is part of the current UE configuration:
3&gt; remove the entry with the matching SL-DestinationIndex from the stored NR sidelink DRX configuration information;
1&gt; if sl-DRX-ConfigUC-ToAddModList is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; for each sl-DestinationIndex included in the received sl-DRX-ConfigUC-ToAddModList that is part of the current stored NR sidelink DRX configuration:
3&gt; reconfigure the entry according to the value received for this sl-DestinationIndex from the stored NR sidelink DRX configuration information;
2&gt; for each sl-DestinationIndex included in the received sl-DRX-ConfigUC-ToAddModList that is not part of the current stored NR sidelink DRX configuration:
3&gt; add a new entry for this sl-DestinationIndex to the stored NR sidelink DRX configuration.
1&gt; if sl-RLC-ChannelToReleaseList is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; perform PC5 Relay RLC channel release as specified in 5.8.9.1.2;
1&gt; if sl-RLC-ChannelToAddModList is included in sl-ConfigDedicatedNR within RRCReconfiguration:
2&gt; perform PC5 Relay RLC channel addition/modification as specified in 5.8.9.1.2;
5.3.5.15 L2 U2N Relay UE configuration
5.3.5.15.1 General
The network configures the L2 U2N Relay UE with relay operation related configurations. For each connected L2 U2N
Remote UE indicated in sl-L2Identity-Remote, the network provides the configuration parameters used for data
The UE performs the following actions based on a received sl-L2RelayUEConfig:
1&gt; if the sl-L2RelayUEConfig contains the sl-RemoteUE-ToReleaseList:
2&gt; perform the L2 U2N Remote UE release as specified in 5.3.5.15.2;
1&gt; if the sl-L2RelayUEConfig contains the sl-RemoteUE-ToAddModList:
2&gt; perform the L2 U2N Remote UE addition/modification as specified in 5.3.5.15.3;
5.3.5.15.2 L2 U2N Remote UE Release
The L2 U2N Relay UE shall:
1&gt; if the release is triggered by reception of the sl-RemoteUE-ToReleaseList:
2&gt; for each sl-L2Identity-Remote value included in the sl-RemoteUE-ToReleaseList:
3&gt; if the current UE has a PC5 RRC connection to a L2 U2N Remote UE with sl-L2Identity-Remote:
4&gt; perform the PC5-RRC connection release as specified in 5.8.9.5.
The L2 U2N Relay UE shall:
1&gt; for each sl-L2Identity-Remote value included in the sl-RemoteUE-ToAddModList that is not part of the current UE configuration (L2 U2N Remote UE Addition):
2&gt; configure the parameters to SRAP entity in accordance with the sl-SRAP-Config-Relay;
1&gt; for each sl-L2Identity-Remote value included in the sl-RemoteUE-ToAddModList that is part of the current UE configuration (L2 U2N Remote UE modification):
2&gt; modify the configuration in accordance with the sl-SRAP-Config-Relay;
5.3.5.16 L2 U2N Remote UE configuration
5.3.5.16.1 General
The network configures the L2 U2N Remote UE with relay operation related configurations, e.g. SRAP configuration.
The UE performs the following actions:
1&gt; if the sl-L2RemoteUEConfig contains the sl-SRAP-Config-Remote:
2&gt; configure the parameters to SRAP entity in accordance with the sl-SRAP-Config-Remote;
1&gt; if the sl-L2RemoteUEConfig contains the sl-ServingCellInfo:
2&gt; use the value of the sl-PhysCellId as the physical cell identity of the PCell;
2&gt; use the value of the sl-UEIdentityRemote as the C-RNTI in the PCell.
5.3.6 Counter check
5.3.6.1 General CounterCheck CounterCheckResponse
The counter check procedure is used by the network to request the UE to verify the amount of data sent/ received on each DRB. More specifically, the UE is requested to check if, for each DRB, the most significant bits of the COUNT match with the values indicated by the network.
NOTE: The procedure enables the network to detect packet insertion by an intruder (a 'man in the middle').
5.3.6.2 Initiation
The network initiates the procedure by sending a CounterCheck message.
NOTE: The network may initiate the procedure when any of the COUNT values reaches a specific value.
5.3.6.3 Reception of the CounterCheck message by the UE
Upon receiving the CounterCheck message, the UE shall:
1&gt; for each DRB that is established:
2&gt; if no COUNT exists for a given direction (uplink or downlink) because it is a uni-directional bearer configured only for the other direction:
3&gt; assume the COUNT value to be 0 for the unused direction;
2&gt; if the drb-Identity is not included in the drb-CountMSB-InfoList:
3&gt; include the DRB in the drb-CountInfoList in the CounterCheckResponse message by including the drb- Identity, the count-Uplink and the count-Downlink set to the value of TX_NEXT 1 and RX_NEXT 1 (specified in TS 38.323 ), respectively;
2&gt; else if, for at least one direction, the most significant bits of the COUNT are different from the value indicated in the drb-CountMSB-InfoList:
3&gt; include the DRB in the drb-CountInfoList in the CounterCheckResponse message by including the drb- Identity, the count-Uplink and the count-Downlink set to the value of TX_NEXT 1 and RX_NEXT 1 (specified in TS 38.323 ), respectively;
1&gt; for each DRB that is included in the drb-CountMSB-InfoList in the CounterCheck message that is not established:
2&gt; include the DRB in the drb-CountInfoList in the CounterCheckResponse message by including the drb- Identity, the count-Uplink and the count-Downlink with the most significant bits set identical to the corresponding values in the drb-CountMSB-InfoList and the least significant bits set to zero;
1&gt; submit the CounterCheckResponse message to lower layers for transmission upon which the procedure ends.
5.3.7 RRC connection re-establishment
5.3.7.1 General RRCReestablishmentRequest RRCReestablishment RRCReestablishmentComplete RRCReestablishmentRequest RRCSetup RRCSetupComplete
The purpose of this procedure is to re-establish the RRC connection. A UE in RRC_CONNECTED, for which AS security has been activated with SRB2 and at least one DRB/multicast MRB setup or, for IAB, SRB2, may initiate the procedure in order to continue the RRC connection. The connection re-establishment succeeds if the network is able to find and verify a valid UE context or, if the UE context cannot be retrieved, and the network responds with an RRCSetup according to clause 5.3.3.4.
The network applies the procedure e.g as follows: a) When AS security has been activated and the network retrieves or verifies the UE context: b) to re-activate AS security without changing algorithms; c) to re-establish and resume the SRB1; d) When UE is re-establishing an RRC connection, and the network is not able to retrieve or verify the UE context: e) to discard the stored AS Context and release all RBs and BH RLC channels and Uu Relay RLC channels; f) to fallback to establish a new RRC connection.
If AS security has not been activated, the UE shall not initiate the procedure but instead moves to RRC_IDLE directly, with release cause 'other'. If AS security has been activated, but SRB2 and at least one DRB or multicast MRB or, for IAB, SRB2, are not setup, the UE does not initiate the procedure but instead moves to RRC_IDLE directly, with release cause 'RRC connection failure'.
5.3.7.2 Initiation
The UE initiates the procedure when one of the following conditions is met:
1&gt; upon detecting radio link failure of the MCG and t316 is not configured, in accordance with 5.3.10; or
1&gt; upon detecting radio link failure of the MCG while SCG transmission is suspended, in accordance with 5.3.10; or
1&gt; upon detecting radio link failure of the MCG while PSCell change or PSCell addition is ongoing, in accordance with 5.3.10; or
1&gt; upon re-configuration with sync failure of the MCG, in accordance with clause 5.3.5.8.3; or
1&gt; upon mobility from NR failure, in accordance with clause 5.4.3.5; or
1&gt; upon integrity check failure indication from lower layers concerning SRB1 or SRB2, except if the integrity check failure is detected on the RRCReestablishment message; or
1&gt; upon an RRC connection reconfiguration failure, in accordance with clause 5.3.5.8.2; or
1&gt; upon detecting radio link failure for the SCG while MCG transmission is suspended, in accordance with clause
5.3.10.3 in NR-DC or in accordance with TS 36.331 clause 5.3.11.3 in NE-DC; or
1&gt; upon reconfiguration with sync failure of the SCG while MCG transmission is suspended in accordance with clause 5.3.5.8.3; or
1&gt; upon SCG change failure while MCG transmission is suspended in accordance with TS 36.331 clause
5.3.5.7a; or
1&gt; upon SCG configuration failure while MCG transmission is suspended in accordance with clause 5.3.5.8.2 in NR-DC or in accordance with TS 36.331 clause 5.3.5.5 in NE-DC; or
1&gt; upon integrity check failure indication from SCG lower layers concerning SRB3 while MCG is suspended; or
1&gt; upon T316 expiry, in accordance with clause 5.7.3b.5; or
1&gt; upon detecting sidelink radio link failure by L2 U2N Remote UE in RRC_CONNECTED, in accordance with clause 5.8.9.3; or
1&gt; upon reception of NotificationMessageSidelink including indicationType by L2 U2N Remote UE in RRC_CONNECTED, in accordance with clause 5.8.9.10.
Upon initiation of the procedure, the UE shall:
1&gt; stop timer T310, if running;
1&gt; stop timer T312, if running;
1&gt; stop timer T304, if running;
1&gt; start timer T311;
1&gt; stop timer T316, if running;
1&gt; if UE is not configured with conditionalReconfiguration:
2&gt; suspend all RBs, and BH RLC channels for IAB-MT, and Uu Relay RLC channels for L2 U2N Relay UE, except SRB0;
2&gt; release the MCG SCell(s), if configured;
3&gt; perform MR-DC release, as specified in clause 5.3.5.10;
2&gt; release delayBudgetReportingConfig, if configured and stop timer T342, if running;
2&gt; release overheatingAssistanceConfig, if configured and stop timer T345, if running;
2&gt; release drx-PreferenceConfig for the MCG, if configured and stop timer T346a associated with the MCG, if running;
2&gt; release maxBW-PreferenceConfig for the MCG, if configured and stop timer T346b associated with the MCG, if running;
2&gt; release maxCC-PreferenceConfig for the MCG, if configured and stop timer T346c associated with the MCG, if running;
2&gt; release maxMIMO-LayerPreferenceConfig for the MCG, if configured and stop timer T346d associated with the MCG, if running;
2&gt; release minSchedulingOffsetPreferenceConfig for the MCG, if configured stop timer T346e associated with the MCG, if running;
2&gt; release rlm-RelaxationReportingConfig for the MCG, if configured and stop timer T346j associated with the MCG, if running;
2&gt; release bfd-RelaxationReportingConfig for the MCG, if configured and stop timer T346k associated with the MCG, if running;
2&gt; release releasePreferenceConfig, if configured stop timer T346f, if running;
2&gt; release onDemandSIB-Request if configured, and stop timer T350, if running;
2&gt; release musim-GapAssistanceConfig, if configured and stop timer T346h, if running;
2&gt; release scg-DeactivationPreferenceConfig, if configured, and stop timer T346i, if running;
1&gt; if any DAPS bearer is configured:
2&gt; reset the source MAC and release the source MAC configuration;
2&gt; for each DAPS bearer:
3&gt; release the RLC entity or entities as specified in TS 38.322 , clause 5.1.3, and the associated logical channel for the source SpCell;
3&gt; reconfigure the PDCP entity to release DAPS as specified in TS 38.323 ;
2&gt; for each SRB:
3&gt; release the PDCP entity for the source SpCell;
3&gt; release the RLC entity as specified in TS 38.322 , clause 5.1.3, and the associated logical channel for the source SpCell;
2&gt; release the physical channel configuration for the source SpCell;
2&gt; discard the keys used in the source SpCell (the K key, the K key, the K key, the K key and gNB RRCenc RRCint UPint the K key), if any; UPenc
1&gt; release the SRAP entity, if configured;
1&gt; if the UE is connected with a L2 U2N Relay UE via PC5-RRC connection (i.e. the UE is a L2 U2N Remote UE):
2&gt; if the PC5-RRC connection with the U2N Relay UE is determined to be released:
3&gt; perform the PC5-RRC connection release as specified in 5.8.9.5;
3&gt; perform either cell selection in accordance with the cell selection process as specified in TS 38.304 , or relay selection as specified in clause 5.8.15.3, or both;
2&gt; else maintain the PC5 RRC connection and stop T311 if running; NOTE 1: It is up to Remote UE implementation whether to release or keep the current unicast PC5 link.
2&gt; perform cell selection in accordance with the cell selection process as specified in TS 38.304 .
NOTE 2: For L2 U2N Remote UE, if both a suitable cell and a suitable relay are available, the UE can select either one based on its implementation.
5.3.7.3 Actions following cell selection while T311 is running
Upon selecting a suitable NR cell, the UE shall:
1&gt; ensure having valid and up to date essential system information as specified in clause 5.2.2.2;
1&gt; stop timer T311;
2&gt; stop timer T390 for all access categories;
2&gt; perform the actions as specified in 5.3.14.4;
1&gt; if the cell selection is triggered by detecting radio link failure of the MCG or re-configuration with sync failure of the MCG or mobility from NR failure, and
1&gt; if attemptCondReconfig is configured; and
1&gt; if the selected cell is one of the candidate cells for which the reconfigurationWithSync is included in the masterCellGroup in VarConditionalReconfig:
2&gt; set the choCellId in the VarRLF-Report to the global cell identity and tracking area code, if available, otherwise to the physical cell identity and carrier frequency of the selected cell;
2&gt; apply the stored condRRCReconfig associated to the selected cell and perform actions as specified in 5.3.5.3; NOTE 1: It is left to network implementation to how to avoid keystream reuse in case of CHO based recovery after
a failed handover without key change.
2&gt; if UE is configured with conditionalReconfiguration:
3&gt; release the MCG SCell(s), if configured;
3&gt; release delayBudgetReportingConfig, if configured and stop timer T342, if running;
3&gt; release overheatingAssistanceConfig , if configured and stop timer T345, if running;
4&gt; perform MR-DC release, as specified in clause 5.3.5.10;
3&gt; release drx-PreferenceConfig for the MCG, if configured and stop timer T346a associated with the MCG, if running;
3&gt; release maxBW-PreferenceConfig for the MCG, if configured and stop timer T346b associated with the MCG, if running;
3&gt; release maxCC-PreferenceConfig for the MCG, if configured and stop timer T346c associated with the MCG, if running;
3&gt; release maxMIMO-LayerPreferenceConfig for the MCG, if configured and stop timer T346d associated with the MCG, if running;
3&gt; release minSchedulingOffsetPreferenceConfig for the MCG, if configured and stop timer T346e associated with the MCG, if running;
3&gt; release rlm-RelaxationReportingConfig for the MCG, if configured and stop timer T346j associated with the MCG, if running;
3&gt; release bfd-RelaxationReportingConfig for the MCG, if configured and stop timer T346k associated with the MCG, if running;
3&gt; release releasePreferenceConfig, if configured and stop timer T346f, if running;
3&gt; release onDemandSIB-Request if configured, and stop timer T350, if running;
3&gt; release scg-DeactivationPreferenceConfig, if configured, and stop timer T346i, if running;
3&gt; suspend all RBs, except SRB0;
2&gt; remove all the entries within VarConditionalReconfig, if any;
2&gt; for each measId, if the associated reportConfig has a reportType set to condTriggerConfig:
3&gt; for the associated reportConfigId:
4&gt; remove the entry with the matching reportConfigId from the reportConfigList within the VarMeasConfig;
3&gt; if the associated measObjectId is only associated to a reportConfig with reportType set to condTriggerConfig:
4&gt; remove the entry with the matching measObjectId from the measObjectList within the VarMeasConfig;
3&gt; remove the entry with the matching measId from the measIdList within the VarMeasConfig;
2&gt; start timer T301;
2&gt; apply the default L1 parameter values as specified in corresponding physical layer specifications except for the parameters for which values are provided in SIB1;
2&gt; apply the default MAC Cell Group configuration as specified in 9.2.2;
2&gt; apply the CCCH configuration as specified in 9.1.1.2;
2&gt; apply the timeAlignmentTimerCommon included in SIB1;
2&gt; initiate transmission of the RRCReestablishmentRequest message in accordance with 5.3.7.4; NOTE 2: This procedure applies also if the UE returns to the source PCell.
Upon selecting an inter-RAT cell, the UE shall:
1&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'RRC connection failure'.
5.3.7.3a Actions following relay selection while T311 is running
Upon selecting a suitable L2 U2N Relay UE, the L2 U2N Remote UE shall:
1&gt; ensure having valid and up to date essential system information as specified in clause 5.2.2.2;
1&gt; stop timer T311;
2&gt; stop timer T390 for all access categories;
2&gt; perform the actions as specified in 5.3.14.4;
1&gt; start timer T301;
1&gt; apply the specified configuration of SL-RLC0 as specified in 9.1.1.4;
1&gt; apply the SDAP configuration and PDCP configuration as specified in 9.1.1.2 for SRB0;
1&gt; initiate transmission of the RRCReestablishmentRequest message in accordance with 5.3.7.4.
5.3.7.4 Actions related to transmission of RRCReestablishmentRequest message
The UE shall set the contents of RRCReestablishmentRequest message as follows:
1&gt; if the procedure was initiated due to radio link failure as specified in 5.3.10.3 or reconfiguration with sync failure as specified in 5.3.5.8.3:
2&gt; set the reestablishmentCellId in the VarRLF-Report to the global cell identity of the selected cell;
1&gt; set the ue-Identity as follows:
2&gt; set the c-RNTI to the C-RNTI used in the source PCell (reconfiguration with sync or mobility from NR
failure) or used in the PCell in which the trigger for the re-establishment occurred (other cases);
2&gt; set the physCellId to the physical cell identity of the source PCell (reconfiguration with sync or mobility from NR failure) or of the PCell in which the trigger for the re-establishment occurred (other cases);
2&gt; set the shortMAC-I to the 16 least significant bits of the MAC-I calculated:
3&gt; over the ASN.1 encoded as per clause 8 (i.e., a multiple of 8 bits) VarShortMAC-Input;
3&gt; with the K key and integrity protection algorithm that was used in the source PCell (reconfiguration RRCint with sync or mobility from NR failure) or of the PCell in which the trigger for the re-establishment occurred (other cases); and
3&gt; with all input bits for COUNT, BEARER and DIRECTION set to binary ones;
1&gt; set the reestablishmentCause as follows:
2&gt; if the re-establishment procedure was initiated due to reconfiguration failure as specified in 5.3.5.8.2:
3&gt; set the reestablishmentCause to the value reconfigurationFailure;
2&gt; else if the re-establishment procedure was initiated due to reconfiguration with sync failure as specified in
3&gt; set the reestablishmentCause to the value handoverFailure;
3&gt; set the reestablishmentCause to the value otherFailure;
1&gt; if the UE is connected with a L2 U2N Relay UE via PC5-RRC connection (i.e. the UE is a L2 U2N Remote UE):
2&gt; apply the default configuration of SL-RLC1 as defined in 9.2.4 for SRB1;
2&gt; apply the default configuration of PDCP defined in 9.2.1 for SRB1;
2&gt; apply the default configuration defined in 9.2.1 for SRB1;
1&gt; configure lower layers to suspend integrity protection and ciphering for SRB1; NOTE: Ciphering is not applied for the subsequent RRCReestablishment message used to resume the connection.
An integrity check is performed by lower layers, but merely upon request from RRC.
1&gt; submit the RRCReestablishmentRequest message to lower layers for transmission.
5.3.7.5 Reception of the RRCReestablishment by the UE
The UE shall:
1&gt; stop timer T301;
1&gt; if the RRCReestablishment message includes the sl-L2RemoteUEConfig (i.e. the UE is a L2 U2N Remote UE):
2&gt; perform the L2 U2N Remote UE configuration procedure as specified in 5.3.5.16;
2&gt; consider the current cell to be the PCell;
1&gt; update the K key based on the current K key or the NH, using the received nextHopChainingCount value, gNB gNB as specified in TS 33.501 ;
1&gt; store the nextHopChainingCount value indicated in the RRCReestablishment message;
1&gt; derive the K and K keys associated with the previously configured cipheringAlgorithm, as specified in RRCenc UPenc TS 33.501 ;
1&gt; derive the K and K keys associated with the previously configured integrityProtAlgorithm, as specified RRCint UPint in TS 33.501 .
1&gt; request lower layers to verify the integrity protection of the RRCReestablishment message, using the previously configured algorithm and the K key; RRCint
1&gt; if the integrity protection check of the RRCReestablishment message fails:
2&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'RRC connection failure', upon which the procedure ends;
1&gt; configure lower layers to resume integrity protection for SRB1 using the previously configured algorithm and the K key immediately, i.e., integrity protection shall be applied to all subsequent messages received and RRCint sent by the UE, including the message used to indicate the successful completion of the procedure;
1&gt; configure lower layers to resume ciphering for SRB1 using the previously configured algorithm and, the K RRCenc key immediately, i.e., ciphering shall be applied to all subsequent messages received and sent by the UE, including the message used to indicate the successful completion of the procedure;
1&gt; release the measurement gap configuration indicated by the measGapConfig, if configured;
1&gt; release the measurement gap configuration indicated by the musim-GapConfig, if configured;
1&gt; set the content of RRCReestablishmentComplete message as follows:
2&gt; if the UE has logged measurements available for NR and if the RPLMN is included in plmn-IdentityList stored in VarLogMeasReport:
3&gt; if the sigLoggedMeasType in VarLogMeasReport is included:
4&gt; include the sigLogMeasConfigAvailable in the RRCReestablishmentComplete message and set it according to the following:
5&gt; if T330 timer is running:
6&gt; set sigLogMeasConfigAvailable to true in the RRCReestablishmentComplete message;
6&gt; set sigLogMeasConfigAvailable to false in the RRCReestablishmentComplete message;
3&gt; include the logMeasAvailable in the RRCReestablishmentComplete message;
3&gt; if Bluetooth measurement results are included in the logged measurements the UE has available for NR:
4&gt; include the logMeasAvailableBT in the RRCReestablishmentComplete message;
3&gt; if WLAN measurement results are included in the logged measurements the UE has available for NR:
4&gt; include the logMeasAvailableWLAN in the RRCReestablishmentComplete message;
2&gt; if the sigLoggedMeasType in VarLogMeasReport is included:
3&gt; if T330 timer is running:
4&gt; set sigLogMeasConfigAvailable to true in the RRCReestablishmentComplete message;
4&gt; if the UE has logged measurements available for NR:
5&gt; set sigLogMeasConfigAvailable to false in the RRCReestablishmentComplete message;
2&gt; if the UE has connection establishment failure or connection resume failure information available in VarConnEstFailReport or VarConnEstFailReportList and if the RPLMN is equal to plmn-Identity stored in VarConnEstFailReport or VarConnEstFailReportList:
3&gt; include connEstFailInfoAvailable in the RRCReestablishmentComplete message;
2&gt; if the UE has radio link failure or handover failure information available in VarRLF-Report and if the RPLMN is included in plmn-IdentityList stored in VarRLF-Report; or
2&gt; if the UE has radio link failure or handover failure information available in VarRLF-Report of TS 36.331 stored in VarRLF-Report of TS 36.331 :
3&gt; include rlf-InfoAvailable in the RRCReestablishmentComplete message;
2&gt; if the UE has successful handover information available in VarSuccessHO-Report and if the RPLMN is included in plmn-IdentityList stored in VarSuccessHO-Report:
3&gt; include successHO-InfoAvailable in the RRCReestablishmentComplete message;
1&gt; submit the RRCReestablishmentComplete message to lower layers for transmission;
1&gt; the procedure ends.
Upon T311 expiry, the UE shall:
1&gt; if the procedure was initiated due to radio link failure or handover failure:
2&gt; set the noSuitableCellFound in the VarRLF-Report to true;
1&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'RRC connection failure'.
5.3.7.7 T301 expiry or selected cell no longer suitable
The UE shall:
1&gt; if timer T301 expires; or
1&gt; if the selected cell becomes no longer suitable according to the cell selection criteria as specified in TS 38.304
2&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'RRC connection failure'.
5.3.7.8 Reception of the RRCSetup by the UE
The UE shall:
1&gt; perform the RRC connection establishment procedure as specified in 5.3.3.4.
5.3.8 RRC connection release
5.3.8.1 General RRCRelease
The purpose of this procedure is: a) to release the RRC connection, which includes the release of the established radio bearers (except for broadcast MRBs), BH RLC channels, Uu Relay RLC channels as well as all radio resources; or b) to suspend the RRC connection only if SRB2 and at least one DRB or multicast MRB or, for IAB, SRB2, are setup, which includes the suspension of the established radio bearers.
5.3.8.2 Initiation
The network initiates the RRC connection release procedure to transit a UE in RRC_CONNECTED to RRC_IDLE; or to transit a UE in RRC_CONNECTED to RRC_INACTIVE only if SRB2 and at least one DRB or multicast MRB or, for IAB, SRB2, is setup in RRC_CONNECTED; or to transit a UE in RRC_INACTIVE back to RRC_INACTIVE when the UE tries to resume; or to transit a UE in RRC_INACTIVE to RRC_IDLE when the UE tries to resume. The procedure can also be used to release and redirect a UE to another frequency.
5.3.8.3 Reception of the RRCRelease by the UE
The UE shall:
1&gt; delay the following actions defined in this clause 60 ms from the moment the RRCRelease message was received or optionally when lower layers indicate that the receipt of the RRCRelease message has been successfully acknowledged, whichever is earlier;
1&gt; stop timer T380, if running;
1&gt; stop timer T320, if running;
1&gt; if timer T316 is running;
2&gt; stop timer T316;
2&gt; clear the information included in VarRLF-Report, if any;
1&gt; stop timer T350, if running;
1&gt; stop timer T346g, if running;
1&gt; if the AS security is not activated:
2&gt; ignore any field included in RRCRelease message except waitTime;
2&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11 with the release cause 'other' upon which the procedure ends;
1&gt; if the RRCRelease message includes redirectedCarrierInfo indicating redirection to eutra:
2&gt; if cnType is included:
3&gt; after the cell selection, indicate the available CN Type(s) and the received cnType to upper layers; NOTE 1: Handling the case if the E-UTRA cell selected after the redirection does not support the core network type specified by the cnType, is up to UE implementation.
2&gt; if voiceFallbackIndication is included:
3&gt; consider the RRC connection release was for EPS fallback for IMS voice (see TS 23.502 );
1&gt; if the RRCRelease message includes the cellReselectionPriorities or freqPriorityListNRSlicing:
2&gt; store the cell reselection priority information provided by the cellReselectionPriorities or freqPriorityListNRSlicing;
2&gt; if the t320 is included:
3&gt; start timer T320, with the timer value set according to the value of t320;
2&gt; apply the cell reselection priority information broadcast in the system information;
1&gt; if deprioritisationReq is included and the UE supports RRC connection release with deprioritisation:
2&gt; start or restart timer T325 with the timer value set to the deprioritisationTimer signalled;
2&gt; store the deprioritisationReq until T325 expiry; NOTE 1a: The UE stores the deprioritisation request irrespective of any cell reselection absolute priority assignments (by dedicated or common signalling) and regardless of RRC connections in NR or other RATs unless specified otherwise.
1&gt; if the RRCRelease includes the measIdleConfig:
3&gt; stop timer T331;
3&gt; perform the actions as specified in 5.7.8.3;
2&gt; if the measIdleConfig is set to setup:
3&gt; store the received measIdleDuration in VarMeasIdleConfig;
3&gt; start timer T331 with the value set to measIdleDuration;
3&gt; if the measIdleConfig contains measIdleCarrierListNR:
4&gt; store the received measIdleCarrierListNR in VarMeasIdleConfig;
3&gt; if the measIdleConfig contains measIdleCarrierListEUTRA:
4&gt; store the received measIdleCarrierListEUTRA in VarMeasIdleConfig;
3&gt; if the measIdleConfig contains validityAreaList:
4&gt; store the received validityAreaList in VarMeasIdleConfig;
1&gt; if the RRCRelease includes suspendConfig:
2&gt; reset MAC and release the default MAC Cell Group configuration, if any;
2&gt; apply the received suspendConfig except the received nextHopChainingCount;
2&gt; if the sdt-Config is configured:
3&gt; for each of the DRB in the sdt-DRB-List:
4&gt; consider the DRB to be configured for SDT;
4&gt; consider the SRB2 to be configured for SDT;
3&gt; for each of the RLC bearer that is part of the UE configuration:
4&gt; re-establish the RLC entity as specified in TS 38.322 ;
3&gt; for SRB2, if it is resumed and for SRB1:
4&gt; trigger the PDCP entity to perform SDU discard as specified in TS 38.323 ;
3&gt; if configured grant resources for SDT are configured:
4&gt; configure the MAC entity with the configured grant resources for SDT and instruct MAC to start the cg-SDT-TimeAlignmentTimer;
2&gt; remove all the entries within VarConditionalReconfig, if any;
2&gt; for each measId, if the associated reportConfig has a reportType set to condTriggerConfig:
3&gt; for the associated reportConfigId:
4&gt; remove the entry with the matching reportConfigId from the reportConfigList within the VarMeasConfig;
3&gt; if the associated measObjectId is only associated to a reportConfig with reportType set to condTriggerConfig:
4&gt; remove the entry with the matching measObjectId from the measObjectList within the VarMeasConfig;
3&gt; remove the entry with the matching measId from the measIdList within the VarMeasConfig;
2&gt; re-establish RLC entities for SRB1;
2&gt; if the RRCRelease message with suspendConfig was received in response to an RRCResumeRequest or an RRCResumeRequest1:
3&gt; stop the timer T319 if running;
3&gt; stop timer T319a if running;
3&gt; in the stored UE Inactive AS context:
4&gt; replace the K and K keys with the current K and K keys; gNB RRCint gNB RRCint
4&gt; replace the nextHopChainingCount with the value of nextHopChainingCount received in the RRCRelease message;
4&gt; replace the cellIdentity with the cellIdentity of the cell the UE has received the RRCRelease message;
4&gt; if the suspendConfig contains the sl-ServingCellInfo (i.e. the UE is a L2 U2N Remote UE):
5&gt; replace the physical cell identity with the value of the sl-PhysCellId;
5&gt; replace the C-RNTI with the value of the sl-UEIdentityRemote;
5&gt; replace the C-RNTI with the C-RNTI used in the cell (see TS 38.321 ) the UE has received the RRCRelease message;
5&gt; replace the physical cell identity with the physical cell identity of the cell the UE has received the RRCRelease message;
3&gt; replace the nextHopChainingCount with the value associated with the current K ; gNB
3&gt; store any previously or subsequently received application layer measurement reports for which no segment, or full message, has been submitted to lower layers for transmission; NOTE 2: NR sidelink communication related configurations and logged measurement configuration are not stored as UE Inactive AS Context, when UE enters RRC_INACTIVE.
2&gt; suspend all SRB(s) and DRB(s) and multicast MRB(s), except SRB0;
2&gt; indicate PDCP suspend to lower layers of all DRBs and multicast MRBs;
2&gt; if the t380 is included:
3&gt; start timer T380, with the timer value set to t380;
2&gt; if the RRCRelease message is including the waitTime:
3&gt; start timer T302 with the value set to the waitTime;
3&gt; inform upper layers that access barring is applicable for all access categories except categories '0' and '2';
3&gt; stop timer T390 for all access categories;
3&gt; perform the actions as specified in 5.3.14.4;
2&gt; indicate the suspension of the RRC connection to upper layers;
2&gt; enter RRC_INACTIVE and perform cell selection as specified in TS 38.304 ;
1&gt; else
2&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with the release cause 'other'.
The UE shall:
2&gt; if stored, discard the cell reselection priority information provided by the cellReselectionPriorities or inherited from another RAT;
2&gt; apply the cell reselection priority information broadcast in the system information.
5.3.8.5 UE actions upon the expiry of DataInactivityTimer
Upon receiving the expiry of DataInactivityTimer from lower layers while in RRC_CONNECTED, the UE shall:
1&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'RRC connection failure'.
The UE shall:
2&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'other'.
5.3.9 RRC connection release requested by upper layers
5.3.9.1 General
The purpose of this procedure is to release the RRC connection. Access to the current PCell may be barred as a result of this procedure.
5.3.9.2 Initiation
The UE initiates the procedure when upper layers request the release of the RRC connection as specified in TS 24.501
. The UE shall not initiate the procedure for power saving purposes.
The UE shall:
1&gt; if the upper layers indicate barring of the PCell:
2&gt; treat the PCell used prior to entering RRC_IDLE as barred according to TS 38.304 ;
1&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'other'.
5.3.10 Radio link failure related actions
5.3.10.1 Detection of physical layer problems in RRC_CONNECTED
The UE shall:
1&gt; if any DAPS bearer is configured, upon receiving N310 consecutive "out-of-sync" indications for the source SpCell from lower layers and T304 is running:
2&gt; start timer T310 for the source SpCell.
2&gt; start timer T310 for the corresponding SpCell.
5.3.10.2 Recovery of physical layer problems
Upon receiving N311 consecutive "in-sync" indications for the SpCell from lower layers while T310 is running, the UE shall:
1&gt; stop timer T310 for the corresponding SpCell.
1&gt; stop timer T312 for the corresponding SpCell, if running.
NOTE 1: In this case, the UE maintains the RRC connection without explicit signalling, i.e. the UE maintains the entire radio resource configuration.
NOTE 2: Periods in time where neither "in-sync" nor "out-of-sync" is reported by L1 do not affect the evaluation of the number of consecutive "in-sync" or "out-of-sync" indications.
5.3.10.3 Detection of radio link failure
The UE shall:
1&gt; if any DAPS bearer is configured and T304 is running:
2&gt; upon T310 expiry in source SpCell; or
2&gt; upon random access problem indication from source MCG MAC; or
2&gt; upon indication from source MCG RLC that the maximum number of retransmissions has been reached; or
2&gt; upon consistent uplink LBT failure indication from source MCG MAC:
3&gt; consider radio link failure to be detected for the source MCG i.e. source RLF;
3&gt; suspend the transmission and reception of all DRBs and multicast MRBs in the source MCG;
3&gt; reset MAC for the source MCG;
3&gt; release the source connection.
2&gt; during a DAPS handover: the following only applies for the target PCell;
2&gt; upon T310 expiry in PCell; or
2&gt; upon T312 expiry in PCell; or
2&gt; upon random access problem indication from MCG MAC while neither T300, T301, T304, T311 nor T319 are running; or
2&gt; upon indication from MCG RLC that the maximum number of retransmissions has been reached; or
2&gt; if connected as an IAB-node, upon BH RLF indication received on BAP entity from the MCG; or
2&gt; upon consistent uplink LBT failure indication from MCG MAC while T304 is not running:
3&gt; if the indication is from MCG RLC and CA duplication is configured and activated for MCG, and for the corresponding logical channel allowedServingCells only includes SCell(s):
4&gt; initiate the failure information procedure as specified in 5.7.5 to report RLC failure.
4&gt; consider radio link failure to be detected for the MCG, i.e. MCG RLF;
4&gt; discard any segments of segmented RRC messages stored according to 5.7.6.3; NOTE: Void.
4&gt; if AS security has not been activated:
5&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'other';-
4&gt; else if AS security has been activated but SRB2 and at least one DRB or multicast MRB or, for IAB, SRB2, have not been setup:
5&gt; store the radio link failure information in the VarRLF-Report as described in clause 5.3.10.5;
5&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'RRC connection failure';
5&gt; store the radio link failure information in the VarRLF-Report as described in clause 5.3.10.5;
5&gt; if T316 is configured; and
5&gt; if SCG transmission is not suspended; and
5&gt; if the SCG is not deactivated; and
5&gt; if neither PSCell change nor PSCell addition is ongoing (i.e. timer T304 for the NR PSCell is not running in case of NR-DC or timer T307 of the E-UTRA PSCell is not running as specified in TS
6&gt; initiate the MCG failure information procedure as specified in 5.7.3b to report MCG radio link
6&gt; initiate the connection re-establishment procedure as specified in 5.3.7.
Upon L2 U2N Relay UE detecting radio link failure, it either triggers PC5-S release or sends Notification message to the connected L2 U2N Remote UE(s) in accordance with 5.8.9.10.
The UE shall:
1&gt; upon T310 expiry in PSCell; or
1&gt; upon T312 expiry in PSCell; or
1&gt; upon random access problem indication from SCG MAC; or
1&gt; upon indication from SCG RLC that the maximum number of retransmissions has been reached; or
1&gt; if connected as an IAB-node, upon BH RLF indication received on BAP entity from the SCG; or
1&gt; upon consistent uplink LBT failure indication from SCG MAC:
2&gt; if the indication is from SCG RLC and CA duplication is configured and activated for SCG, and for the corresponding logical channel allowedServingCells only includes SCell(s):
3&gt; initiate the failure information procedure as specified in 5.7.5 to report RLC failure.
3&gt; consider radio link failure to be detected for the SCG, i.e. SCG RLF;
3&gt; if MCG transmission is not suspended:
4&gt; initiate the SCG failure information procedure as specified in 5.7.3 to report SCG radio link failure.
4&gt; if the UE is in NR-DC:
5&gt; initiate the connection re-establishment procedure as specified in 5.3.7;
4&gt; else (the UE is in (NG)EN-DC):
5&gt; initiate the connection re-establishment procedure as specified in TS 36.331 , clause 5.3.7;
5.3.10.4 RLF cause determination
The UE shall set the rlf-Cause in the VarRLF-Report as follows:
1&gt; if the UE declares radio link failure due to T310 expiry:
2&gt; set the rlf-Cause as t310-Expiry;
1&gt; else if the UE declares radio link failure due to the random access problem indication from MCG MAC:
2&gt; if the random access procedure was initiated for beam failure recovery:
3&gt; set the rlf-Cause as beamFailureRecoveryFailure;
3&gt; set the rlf-Cause as randomAccessProblem;
1&gt; else if the UE declares radio link failure due to the reaching of maximum number of retransmissions from the MCG RLC:
2&gt; set the rlf-Cause as rlc-MaxNumRetx;
1&gt; else if the UE declares radio link failure due to consistent uplink LBT failures:
2&gt; set the rlf-Cause as lbtFailure;
1&gt; else if the IAB-MT declares radio link failure due to the reception of a BH RLF indication on BAP entity:
2&gt; set the rlf-Cause as bh-rlfRecoveryFailure.
1&gt; else if the UE declares radio link failure due to T312 expiry:
2&gt; set the rlf-Cause as t312-Expiry;
5.3.10.5 RLF report content determination
The UE shall determine the content in the VarRLF-Report as follows:
1&gt; clear the information included in VarRLF-Report, if any;
1&gt; set the plmn-IdentityList to include the list of EPLMNs stored by the UE (i.e. includes the RPLMN);
1&gt; set the measResultLastServCell to include the cell level RSRP, RSRQ and the available SINR, of the source PCell (in case HO failure) or PCell (in case RLF) based on the available SSB and CSI-RS measurements collected up to the moment the UE detected failure;
1&gt; if the SS/PBCH block-based measurement quantities are available:
2&gt; set the rsIndexResults in measResultLastServCell to include all the available measurement quantities of the source PCell (in case HO failure) or PCell (in case RLF), ordered such that the highest SS/PBCH block RSRP is listed first if SS/PBCH block RSRP measurement results are available, otherwise the highest SS/PBCH block RSRQ is listed first if SS/PBCH block RSRQ measurement results are available, otherwise the highest SS/PBCH block SINR is listed first, based on the available SS/PBCH block based measurements collected up to the moment the UE detected failure;
1&gt; if the CSI-RS based measurement quantities are available:
2&gt; set the rsIndexResults in measResultLastServCell to include all the available measurement quantities of the source PCell (in case HO failure) or PCell (in case RLF), ordered such that the highest CSI-RS RSRP is listed first if CSI-RS RSRP measurement results are available, otherwise the highest CSI-RS RSRQ is listed first if CSI-RS RSRQ measurement results are available, otherwise the highest CSI-RS SINR is listed first, based on the available CSI-RS based measurements collected up to the moment the UE detected failure;
1&gt; set the ssbRLMConfigBitmap and/or csi-rsRLMConfigBitmap in measResultLastServCell to include the radio link monitoring configuration of the source PCell(in case HO failure) or PCell (in case RLF), if available;
1&gt; for each of the configured measObjectNR in which measurements are available:
2&gt; if the SS/PBCH block-based measurement quantities are available:
3&gt; set the measResultListNR in measResultNeighCells to include all the available measurement quantities of the best measured cells, other than the source PCell (in case HO failure) or PCell (in case RLF), ordered such that the cell with highest SS/PBCH block RSRP is listed first if SS/PBCH block RSRP measurement results are available, otherwise the cell with highest SS/PBCH block RSRQ is listed first if SS/PBCH block RSRQ measurement results are available, otherwise the cell with highest SS/PBCH block SINR is listed first, based on the available SS/PBCH block based measurements collected up to the moment the UE detected failure;
4&gt; for each neighbour cell included, include the optional fields that are available;
2&gt; if the CSI-RS based measurement quantities are available:
3&gt; set the measResultListNR in measResultNeighCells to include all the available measurement quantities of the best measured cells, other than the source PCell (in case HO failure) or PCell (in case RLF), ordered such that the cell with highest CSI-RS RSRP is listed first if CSI-RS RSRP measurement results are available, otherwise the cell with highest CSI-RS RSRQ is listed first if CSI-RS RSRQ measurement results are available, otherwise the cell with highest CSI-RS SINR is listed first, based on the available CSI-RS based measurements collected up to the moment the UE detected radio link failure;
4&gt; for each neighbour cell included, include the optional fields that are available;
2&gt; for each neighbour cell, if any, included in measResultListNR in measResultNeighCells:
3&gt; if the neighbour cell is one of the candidate cells for which the reconfigurationWithSync is included in the masterCellGroup in VarConditionalReconfig at the moment of the detected failure:
4&gt; set choConfig in MeasResult2NR to the execution condition for each measId within condTriggerConfig associated to the neighbour cell within VarConditionalReconfig;
4&gt; if at least one execution condition included in choConfig in MeasResult2NR was fulfilled at the moment of conditional reconfiguration execution, or radio link failure:
5&gt; if the first entry of choConfig corresponds to a fullfilled execution condition at the moment of conditional reconfiguration execution, or radio link failure:
6&gt; set condFirstEventFullfilled to true;
5&gt; if the second entry of choConfig, if available, corresponds to a fullfilled execution condition at the moment of conditional reconfiguration execution, or radio link failure:
6&gt; set condSecondEventFullfilled to true;
5&gt; if the first entry of choConfig corresponds to a fulfilled execution condition at the moment of conditional reconfiguration execution, or radio link failure; and
5&gt; if the second entry of choConfig, if available, corresponds to a fulfilled execution condition at the moment of conditional reconfiguration execution, or radio link failure:
6&gt; set firstTriggeredEvent to the execution condition condFirstEvent corresponding to the first entry of choConfig or to the execution condition condSecondEvent corresponding to the second entry of choConfig, whichever execution condition was fulfilled first in time;
6&gt; set timeBetweenEvents to the elapsed time between the point in time of fullfilling the condition in choConfig that was fulfilled first in time, and the point in time of fullfilling the condition in choConfig that was fulfilled second in time;
1&gt; for each of the configured EUTRA frequencies in which measurements are available;
2&gt; set the measResultListEUTRA in measResultNeighCells to include the best measured cells ordered such that the cell with highest RSRP is listed first if RSRP measurement results are available, otherwise the cell with highest RSRQ is listed first, and based on measurements collected up to the moment the UE detected failure;
3&gt; for each neighbour cell included, include the optional fields that are available; NOTE 1: The measured quantities are filtered by the L3 filter as configured in the mobility measurement
configuration. The measurements are based on the time domain measurement resource restriction, if
configured. Exclude-listed cells are not required to be reported.
1&gt; set the c-RNTI to the C-RNTI used in the source PCell(in case HO failure) or PCell (in case RLF);
1&gt; if the failure is detected due to reconfiguration with sync failure as described in 5.3.5.8.3, set the fields in VarRLF-report as follows:
2&gt; set the connectionFailureType to hof;
2&gt; if any DAPS bearer was configured while T304 was running:
3&gt; if radio link failure was detected in the source PCell, according to clause 5.3.10.3:4&gt; set timeConnSourceDAPS-Failure to the time between the initiation of the DAPS handover execution and the radio link failure detected in the source PCell while T304 was running;
4&gt; set the rlf-Cause to the trigger for detecting the source radio link failure in accordance with clause
2&gt; set the nrFailedPCellId in failedPCellId to the global cell identity and tracking area code, if available, and otherwise to the physical cell identity and carrier frequency of the target PCell of the failed handover;
2&gt; include nrPreviousCell in previousPCellId and set it to the global cell identity and tracking area code of the PCell where the last RRCReconfiguration message including reconfigurationWithSync was received;
2&gt; set the timeConnFailure to the elapsed time since reception of the last RRCReconfiguration message including the reconfigurationWithSync;
1&gt; else if the failure is detected due to Mobility from NR failure as described in 5.4.3.5, set the fields in VarRLF- report as follows:
2&gt; set the connectionFailureType to hof;
2&gt; if last MobilityFromNRCommand concerned a failed inter-RAT handover from NR to E-UTRA and if the UE supports Radio Link Failure Report for Inter-RAT MRO EUTRA (NR to EUTRA):
3&gt; set the eutraFailedPCellId in failedPCellId to the global cell identity and tracking area code, if available, and otherwise to the physical cell identity and carrier frequency of the target PCell of the failed handover;
2&gt; include nrPreviousCell in previousPCellId and set it to the global cell identity and tracking area code of the PCell where the last MobilityFromNRCommand message was received;
2&gt; if configuration of the conditional handover is available in VarConditionalReconfig at the moment of the handover failure:
3&gt; set timeSinceCHO-Reconfig to the time elapsed between the execution of the last RRCReconfiguration message including reconfigurationWithSync for the target PCell of the failed conditional handover, and the reception in the source PCell of the last conditionalReconfiguration including the condRRCReconfig of the target PCell of the failed conditional handover;
3&gt; set choCandidateCellList to include the global cell identity and tracking area code, if available, and otherwise to the physical cell identity and carrier frequency of each of the candidate target cells for conditional handover included in condRRCReconfig within VarConditionalReconfig at the time of the failed conditional handover, excluding the candidate target cells included in measResulNeighCells;
2&gt; set the timeConnFailure to the elapsed time since the initialization of the handover associated to the last MobilityFromNRCommand message;
1&gt; else if the failure is detected due to radio link failure as described in 5.3.10.3, set the fields in VarRLF-report as follows:
2&gt; set the connectionFailureType to rlf;
2&gt; set the rlf-Cause to the trigger for detecting radio link failure in accordance with clause 5.3.10.4;
2&gt; set the nrFailedPCellId in failedPCellId to the global cell identity and the tracking area code, if available, and otherwise to the physical cell identity and carrier frequency of the PCell where radio link failure is detected;
2&gt; if an RRCReconfiguration message including the reconfigurationWithSync was received before the connection failure:
3&gt; if the last RRCReconfiguration message including the reconfigurationWithSync concerned an intra NR handover:
4&gt; include the nrPreviousCell in previousPCellId and set it to the global cell identity and the tracking area code of the PCell where the last executed RRCReconfiguration message including reconfigurationWithSync was received;
4&gt; if the last executed RRCReconfiguration message including reconfigurationWithSync was concerning
a DAPS handover:
4&gt; else if the last executed RRCReconfiguration message including reconfigurationWithSync was concerning a conditional handover:
4&gt; set the timeConnFailure to the elapsed time since the execution of the last RRCReconfiguration message including the reconfigurationWithSync;
3&gt; else if the last RRCReconfiguration message including the reconfigurationWithSync concerned a handover to NR from E-UTRA and if the UE supports Radio Link Failure Report for Inter-RAT MRO EUTRA:
4&gt; include the eutraPreviousCell in previousPCellId and set it to the global cell identity and the tracking area code of the E-UTRA PCell where the last RRCReconfiguration message including reconfigurationWithSync was received embedded in E-UTRA RRC message MobilityFromEUTRACommand message as specified in TS 36.331 clause 5.4.3.3;
4&gt; set the timeConnFailure to the elapsed time since reception of the last RRCReconfiguration message including the reconfigurationWithSync embedded in E-UTRA RRC message MobilityFromEUTRACommand message as specified in TS 36.331 clause 5.4.3.3;
3&gt; if configuration of the conditional handover is available in VarConditionalReconfig at the moment of radio link failure:
3&gt; set choCandidateCellList to include the global cell identity and tracking area code of all the candidate target cells for conditional handover included in condRRCReconfig within VarConditionalReconfig at the time of radio link failure, excluding the candidate target cells included in measResulNeighCells;
2&gt; if configuration of the conditional handover is available in VarConditionalReconfig at the moment of declaring the radio link failure:
3&gt; set timeSinceCHO-Reconfig to the time elapsed between the detection of the radio link failure, and the reception, in the source PCell, of the last conditionalReconfiguration including the condRRCReconfig message;
1&gt; if connectionFailureType is rlf and the rlf-Cause is set to randomAccessProblem or beamFailureRecoveryFailure; or
1&gt; if connectionFailureType is hof and if the failed handover is an intra-RAT handover:
2&gt; set the ra-InformationCommon to include the random-access related information as described in clause
1&gt; if available, set the locationInfo as in 5.3.3.7.
The UE may discard the radio link failure information or handover failure information, i.e. release the UE variable VarRLF-Report, 48 hours after the radio link failure/handover failure is detected.
NOTE 2: In this clause, the term 'handover failure' has been used to refer to 'reconfiguration with sync failure'.
5.3.11 UE actions upon going to RRC_IDLE
The UE shall:
1&gt; set the variable pendingRNA-Update to false, if that is set to true;
1&gt; if going to RRC_IDLE was triggered by reception of the RRCRelease message including a waitTime:
3&gt; stop timer T302;
2&gt; start timer T302 with the value set to the waitTime;
2&gt; inform upper layers that access barring is applicable for all access categories except categories '0' and '2'.
3&gt; stop timer T302;
3&gt; perform the actions as specified in 5.3.14.4;
2&gt; stop timer T390 for all access categories;
2&gt; perform the actions as specified in 5.3.14.4;
1&gt; if the UE is leaving RRC_INACTIVE:
2&gt; if going to RRC_IDLE was not triggered by reception of the RRCRelease message:
3&gt; if stored, discard the cell reselection priority information provided by the cellReselectionPriorities;
3&gt; stop the timer T320, if running;
1&gt; discard the UE Inactive AS context, if any;
1&gt; release the suspendConfig, if configured;
1&gt; remove all the entries within VarConditionalReconfig, if any;
1&gt; for each measId, if the associated reportConfig has a reportType set to condTriggerConfig:
2&gt; for the associated reportConfigId:
3&gt; remove the entry with the matching reportConfigId from the reportConfigList within the VarMeasConfig;
2&gt; if the associated measObjectId is only associated to a reportConfig with reportType set to condTriggerConfig:
3&gt; remove the entry with the matching measObjectId from the measObjectList within the VarMeasConfig;
2&gt; remove the entry with the matching measId from the measIdList within the VarMeasConfig;
1&gt; discard the K key, the S-K key, the S-K key, the K key, the K key, the K key and the gNB gNB eNB RRCenc RRCint UPint
K key, if any; UPenc
1&gt; release all radio resources, including release of the RLC entity, the BAP entity, the MAC configuration and the associated PDCP entity and SDAP for all established RBs, BH RLC channels, Uu Relay RLC channels, PC5
Relay channels and SRAP entity;
1&gt; indicate the release of the RRC connection to upper layers together with the release cause;
1&gt; inform upper layers about the release of all application layer measurement configurations;
1&gt; discard any application layer measurement reports which were not transmitted yet;
1&gt; discard any segments of segmented RRC messages stored according to 5.7.6.3;
1&gt; except if going to RRC_IDLE was triggered by inter-RAT cell reselection while the UE is in RRC_INACTIVE or RRC_IDLE or when selecting an inter-RAT cell while T311 was running or when selecting an E-UTRA cell for EPS fallback for IMS voice as specified in 5.4.3.5:
2&gt; enter RRC_IDLE and perform cell selection as specified in TS 38.304 ;
5.3.12 UE actions upon PUCCH/SRS release request
Upon receiving a PUCCH release request from lower layers, for all bandwidth parts of an indicated serving cell the UE shall:
1&gt; release PUCCH-CSI-Resources configured in CSI-ReportConfig;
1&gt; release SchedulingRequestResourceConfig instances configured in PUCCH-Config.
Upon receiving an SRS release request from lower layers, for all bandwidth parts of an indicated serving cell the UE shall:
1&gt; release SRS-Resource instances configured in SRS-Config.
Upon receiving a positioning SRS configuration for RRC_INACTIVE release request from lower layers, the UE shall:
1&gt; release the configured srs-PosRRC-InactiveConfig.
5.3.13 RRC connection resume
5.3.13.1 General RRCResumeRequest/RRCResumeRequest1 RRCResume RRCResumeComplete RRCResumeRequest/RRCResumeRequest1 RRCSetup RRCSetupComplete RRCResumeRequest/RRCResumeRequest1 RRCRelease RRCResumeRequest/RRCResumeRequest1 RRCRelease with suspend configuration RRCResumeRequest/RRCResumeRequest1 RRCReject
The purpose of this procedure is to resume a suspended RRC connection, including resuming SRB(s), DRB(s) and multicast MRB(s) or perform an RNA update. This procedure is also used to initiate SDT in RRC_INACTIVE.
5.3.13.1a Conditions for resuming RRC Connection for NR sidelink communication/discovery/V2X sidelink communication
For NR sidelink communication/discovery an RRC connection is resumed only in the following cases:
1&gt; if configured by upper layers to transmit NR sidelink communication/discovery and related data is available for transmission:
2&gt; if the frequency on which the UE is configured to transmit NR sidelink communication is included in sl- FreqInfoList within SIB12 provided by the cell on which the UE camps; and if the valid version of SIB12 does not include sl-TxPoolSelectedNormal for the concerned frequency; or
2&gt; if the frequency on which the UE is configured to transmit NR sidelink discovery is included in sl- FreqInfoList within SIB12 provided by the cell on which the UE camps; and if the valid version of SIB12 does not include sl-DiscTxPoolSelected or sl-TxPoolSelectedNormal for the concerned frequency; For L2 U2N Relay UE in RRC_INACTIVE, an RRC connection establishment is resumed in the following cases:
1&gt; if any message is received from the L2 U2N Remote UE via SL-RLC0 as specified in 9.1.1.4 or SL-RLC1 as specified in 9.2.4; For V2X sidelink communication an RRC connection resume is initiated only when the conditions specified for V2X sidelink communication in clause 5.3.3.1a of TS 36.331 are met.
NOTE: Upper layers initiate an RRC connection resume. The interaction with NAS is left to UE implementation.
5.3.13.1b Conditions for initiating SDT
A UE in RRC_INACTIVE initiates the resume procedure for SDT when all of the following conditions are fulfilled:
1&gt; the upper layers request resumption of RRC connection; and
1&gt; sdt-Config is configured; and1&gt; all the pending data in UL is mapped to the radio bearers configured for SDT; and
1&gt; lower layers indicate that conditions for initiating SDT as specified in TS 38.321 are fulfilled.
5.3.13.2 Initiation
The UE initiates the procedure when upper layers or AS (when responding to RAN paging, upon triggering RNA updates while the UE is in RRC_INACTIVE, for NR sidelink communication/V2X sidelink communication as specified in clause 5.3.13.1a) requests the resume of a suspended RRC connection or for initiating SDT as specified in clause 5.3.13.1b.
The UE shall ensure having valid and up to date essential system information as specified in clause 5.2.2.2 before initiating this procedure.
Upon initiation of the procedure, the UE shall:
1&gt; if the resumption of the RRC connection is triggered by response to NG-RAN paging:
2&gt; select '0' as the Access Category;
2&gt; perform the unified access control procedure as specified in 5.3.14 using the selected Access Category and one or more Access Identities provided by upper layers;
3&gt; if the access attempt is barred, the procedure ends;
1&gt; else if the resumption of the RRC connection is triggered by upper layers:
2&gt; if the upper layers provide an Access Category and one or more Access Identities:
3&gt; perform the unified access control procedure as specified in 5.3.14 using the Access Category and Access
Identities provided by upper layers;
4&gt; if the access attempt is barred, the procedure ends;
2&gt; if the resumption occurs after release with redirect with mpsPriorityIndication:
3&gt; set the resumeCause to mps-PriorityAccess;
3&gt; set the resumeCause in accordance with the information received from upper layers;
1&gt; else if the resumption of the RRC connection is triggered due to an RNA update as specified in 5.3.13.8:
2&gt; if an emergency service is ongoing:
NOTE 1: How the RRC layer in the UE is aware of an ongoing emergency service is up to UE implementation.
3&gt; select '2' as the Access Category;
3&gt; set the resumeCause to emergency;
3&gt; select '8' as the Access Category;
2&gt; perform the unified access control procedure as specified in 5.3.14 using the selected Access Category and one or more Access Identities to be applied as specified in TS 24.501 ;
3&gt; if the access attempt is barred:
4&gt; set the variable pendingRNA-Update to true;
4&gt; the procedure ends; NOTE 2: In case the L2 U2N Relay UE initiates RRC connection resume according to conditions as specified in
5.3.13.1a, the L2 U2N Relay UE sets the resumeCause by implementation. If the cause value in the message received from the L2 U2N Remote UE via SL-RLC0 is emergency, mps-PriorityAccess, or mcs- PriorityAccess, the L2 U2N Relay UE can set the same value. Otherwise, the L2 U2N Relay UE does not set the value as emergency, mps-PriorityAccess, or mcs-PriorityAccess.
1&gt; if the UE is in NE-DC or NR-DC:
2&gt; if the UE does not support maintaining SCG configuration upon connection resumption:
3&gt; release the MR-DC related configurations (i.e., as specified in 5.3.5.10) from the UE Inactive AS context, if stored;
1&gt; if the UE does not support maintaining the MCG SCell configurations upon connection resumption:
2&gt; release the MCG SCell(s) from the UE Inactive AS context, if stored;
1&gt; if the UE performs connection resumption in a different cell than the cell where srs-PosRRC-InactiveConfig was configured;
2&gt; release srs-PosRRC-InactiveConfig, if configured; Editor's Note: This agreement/clause may not be needed because we have this agreement TA timer configuration is invalidated upon any cell reselection; see 5.7.15.
1&gt; if the UE is connected with a L2 U2N Relay UE via PC5-RRC connection (i.e. the UE is a L2 U2N Remote UE):
2&gt; apply the default configuration of SL-RLC1 as defined in 9.2.4 for SRB1;
2&gt; apply the default PDCP configuration defined in 9.2.1 for SRB1;
2&gt; apply the default L1 parameter values as specified in corresponding physical layer specifications, except for the parameters for which values are provided in SIB1;
2&gt; apply the default SRB1 configuration as specified in 9.2.1;
2&gt; apply the default MAC Cell Group configuration as specified in 9.2.2;
1&gt; release delayBudgetReportingConfig from the UE Inactive AS context, if stored;
1&gt; stop timer T342, if running;
1&gt; release overheatingAssistanceConfig from the UE Inactive AS context, if stored;
1&gt; stop timer T345, if running;
1&gt; release idc-AssistanceConfig from the UE Inactive AS context, if stored;
1&gt; release drx-PreferenceConfig for all configured cell groups from the UE Inactive AS context, if stored;
1&gt; stop all instances of timer T346a, if running;
1&gt; release maxBW-PreferenceConfig for all configured cell groups from the UE Inactive AS context, if stored;
1&gt; stop all instances of timer T346b, if running;
1&gt; release maxCC-PreferenceConfig for all configured cell groups from the UE Inactive AS context, if stored;
1&gt; stop all instances of timer T346c, if running;
1&gt; release maxMIMO-LayerPreferenceConfig for all configured cell groups from the UE Inactive AS context, if stored;
1&gt; stop all instances of timer T346d, if running;
1&gt; release minSchedulingOffsetPreferenceConfig for all configured cell groups from the UE Inactive AS context, if stored;
1&gt; stop all instances of timer T346e, if running;
1&gt; release rlm-RelaxationReportingConfig for all configured cell groups from the UE Inactive AS context, if stored;
1&gt; stop all instances of timer T346j, if running;
1&gt; release bfd-RelaxationReportingConfig for all configured cell groups from the UE Inactive AS context, if stored;
1&gt; stop all instances of timer T346k, if running;
1&gt; release releasePreferenceConfig from the UE Inactive AS context, if stored;
1&gt; release wlanNameList from the UE Inactive AS context, if stored;
1&gt; release btNameList from the UE Inactive AS context, if stored;
1&gt; release sensorNameList from the UE Inactive AS context, if stored;
1&gt; release obtainCommonLocation from the UE Inactive AS context, if stored;
1&gt; stop timer T346f, if running;
1&gt; stop timer T346i, if running;
1&gt; release referenceTimePreferenceReporting from the UE Inactive AS context, if stored;
1&gt; release sl-AssistanceConfigNR from the UE Inactive AS context, if stored;
1&gt; release musim-GapAssistanceConfig from the UE Inactive AS context, if stored and stop timer T346h, if running;
1&gt; release musim-LeaveAssistanceConfig from the UE Inactive AS context, if stored;
1&gt; if the UE is connected with a L2 U2N Relay UE via PC5-RRC connection (i.e. the UE is a L2 U2N Remote UE):
2&gt; apply the specified configuration of SL-RLC0 used for the delivery of RRC message over SRB0 as specified in 9.1.1.4;
2&gt; apply the SDAP configuration and PDCP configuration as specified in 9.1.1.2 for SRB0;
2&gt; apply the CCCH configuration as specified in 9.1.1.2;
2&gt; apply the timeAlignmentTimerCommon included in SIB1;
2&gt; if the resume procedure is initiated in a cell that is different to the PCell in which the UE received the stored sdt-MAC-PHY-CG-Config:
3&gt; release the stored sdt-MAC-PHY-CG-Config;
1&gt; if conditions for initiating SDT in accordance with 5.3.13.1b are fulfilled:
2&gt; consider the resume procedure is initiated for SDT;
2&gt; start timer T319a;
2&gt; start timer T319;
2&gt; instruct the MAC entity to consider the cg-SDT-TimeAlignmentTimer as expired, if it is running;
1&gt; set the variable pendingRNA-Update to false;
1&gt; release successHO-Config from the UE Inactive AS context, if stored;
1&gt; initiate transmission of the RRCResumeRequest message or RRCResumeRequest1 in accordance with 5.3.13.3.
5.3.13.3 Actions related to transmission of RRCResumeRequest or RRCResumeRequest1 message
The UE shall set the contents of RRCResumeRequest or RRCResumeRequest1 message as follows:
1&gt; if field useFullResumeID is signalled in SIB1:
2&gt; select RRCResumeRequest1 as the message to use;
2&gt; set the resumeIdentity to the stored fullI-RNTI value;
2&gt; select RRCResumeRequest as the message to use;
2&gt; set the resumeIdentity to the stored shortI-RNTI value;
1&gt; set the resumeMAC-I to the 16 least significant bits of the MAC-I calculated:
2&gt; over the ASN.1 encoded as per clause 8 (i.e., a multiple of 8 bits) VarResumeMAC-Input;
2&gt; with the K key in the UE Inactive AS Context and the previously configured integrity protection RRCint algorithm; and
2&gt; with all input bits for COUNT, BEARER and DIRECTION set to binary ones;
1&gt; derive the K key based on the current K key or the NH, using the nextHopChainingCount value received gNB gNB in the previous RRCRelease message and stored in the UE Inactive AS Context, as specified in TS 33.501 ;
1&gt; derive the K key, the K key, the K key and the K key; RRCenc RRCint UPint UPenc
1&gt; configure lower layers to apply integrity protection for all radio bearers except SRB0 and MRBs using the configured algorithm and the K key and K key derived in this clause immediately, i.e., integrity RRCint UPint protection shall be applied to all subsequent messages received and sent by the UE; NOTE 1: Only DRBs with previously configured UP integrity protection shall resume integrity protection.
1&gt; configure lower layers to apply ciphering for all radio bearers except SRB0 and MRBs and to apply the configured ciphering algorithm, the K key and the K key derived in this clause, i.e. the ciphering RRCenc UPenc configuration shall be applied to all subsequent messages received and sent by the UE;
1&gt; re-establish PDCP entities for SRB1;
1&gt; if the resume procedure is initiated for SDT:
2&gt; for each radio bearer that is configured for SDT:
3&gt; restore the configuration associated with the RLC bearers of masterCellGroup and pdcp-Config from the UE Inactive AS context;
3&gt; re-establish PDCP entity for the radio bearer without triggering PDCP status report;
2&gt; resume all the radio bearers that are configured for SDT;
1&gt; submit the selected message RRCResumeRequest or RRCResumeRequest1 for transmission to lower layers.
NOTE 2: Only DRBs with previously configured UP ciphering shall resume ciphering.
If lower layers indicate an integrity check failure while T319 or T319a is running, perform actions specified in 5.3.13.5.
The UE shall continue cell re-selection related measurements as well as cell re-selection evaluation. If the conditions for cell re-selection are fulfilled, the UE shall perform cell re-selection as specified in 5.3.13.6.
5.3.13.4 Reception of the RRCResume by the UE
The UE shall:
1&gt; stop timer T319, if running;
1&gt; stop timer T319a, if running;
1&gt; stop timer T380, if running;
2&gt; stop timer T331;
2&gt; perform the actions as specified in 5.7.8.3;
1&gt; if the RRCResume includes the fullConfig:
2&gt; perform the full configuration procedure as specified in 5.3.5.11;
2&gt; if the RRCResume does not include the restoreMCG-SCells:
3&gt; release the MCG SCell(s) from the UE Inactive AS context, if stored;
2&gt; if the RRCResume does not include the restoreSCG:
3&gt; release the MR-DC related configurations (i.e., as specified in 5.3.5.10) from the UE Inactive AS context, if stored;
2&gt; restore the masterCellGroup, mrdc-SecondaryCellGroup, if stored, and pdcp-Config from the UE Inactive AS context;
2&gt; configure lower layers to consider the restored MCG and SCG SCell(s) (if any) to be in deactivated state;
1&gt; discard the UE Inactive AS context;
1&gt; store the used nextHopChainingCount value associated to the current K ; gNB
1&gt; release the suspendConfig except the ran-NotificationAreaInfo;
1&gt; if the RRCResume includes the masterCellGroup:
2&gt; perform the cell group configuration for the received masterCellGroup according to 5.3.5.5;
1&gt; if the RRCResume includes the mrdc-SecondaryCellGroup:
2&gt; if the received mrdc-SecondaryCellGroup is set to nr-SCG:
3&gt; if the RRCResume includes the scg-State:
4&gt; perform SCG deactivation as specified in 5.3.5.13b;
4&gt; perform SCG activation as specified in 5.3.5.13a;
3&gt; perform the RRC reconfiguration according to 5.3.5.3 for the RRCReconfiguration message included in nr-SCG;
2&gt; if the received mrdc-SecondaryCellGroup is set to eutra-SCG:
3&gt; perform the RRC connection reconfiguration as specified in TS 36.331 , clause 5.3.5.3 for the RRCConnectionReconfiguration message included in eutra-SCG;
1&gt; if the RRCResume includes the radioBearerConfig:
2&gt; perform the radio bearer configuration according to 5.3.5.6;
1&gt; if the RRCResume message includes the sk-Counter:
2&gt; perform security key update procedure as specified in 5.3.5.7;
1&gt; if the RRCResume message includes the radioBearerConfig2:
2&gt; perform the radio bearer configuration according to 5.3.5.6;
1&gt; if the RRCResume message includes the needForGapsConfigNR:
2&gt; if needForGapsConfigNR is set to setup:
3&gt; consider itself to be configured to provide the measurement gap requirement information of NR target bands;
3&gt; consider itself not to be configured to provide the measurement gap requirement information of NR target bands;
1&gt; if the RRCResume message includes the needForNCSG-ConfigNR:
2&gt; if needForNCSG-ConfigNR is set to setup:
3&gt; consider itself to be configured to provide the measurement gap and NCSG requirement information of NR target bands;
3&gt; consider itself not to be configured to provide the measurement gap and NCSG requirement information of NR target bands;
1&gt; if the RRCResume message includes the needForNCSG-ConfigEUTRA:
2&gt; if needForNCSG-ConfigEUTRA is set to setup:
3&gt; consider itself to be configured to provide the measurement gap and NCSG requirement information of E-UTRA target bands;
3&gt; consider itself not to be configured to provide the measurement gap and NCSG requirement information of E-UTRA target bands;
1&gt; if the RRCResume message includes the appLayerMeasConfig:
2&gt; perform the application layer measurement configuration procedure as specified in 5.3.5.13d;
1&gt; if stored, discard the cell reselection priority information provided by the cellReselectionPriorities or inherited from another RAT;
1&gt; stop timer T320, if running;
1&gt; if the RRCResume message includes the measConfig:
2&gt; perform the measurement configuration procedure as specified in 5.5.2;
1&gt; resume measurements if suspended;
2&gt; stop timer T390 for all access categories;
2&gt; perform the actions as specified in 5.3.14.4;
2&gt; stop timer T302;
2&gt; perform the actions as specified in 5.3.14.4;
1&gt; indicate to upper layers that the suspended RRC connection has been resumed;
1&gt; stop the cell re-selection procedure;
1&gt; stop relay reselection procedure if any for L2 U2N Remote UE;
1&gt; consider the current cell to be the PCell;
1&gt; set the content of the of RRCResumeComplete message as follows:
2&gt; if the upper layer provides NAS PDU, set the dedicatedNAS-Message to include the information received from upper layers;
2&gt; if upper layers provides a PLMN:
3&gt; if the UE is either allowed or instructed to access the PLMN via a cell for which at least one CAG ID is broadcast:
4&gt; set the selectedPLMN-Identity from the npn-IdentityInfoList;
4&gt; set the selectedPLMN-Identity to the PLMN selected by upper layers from the plmn-IdentityInfoList;
2&gt; if the masterCellGroup contains the reportUplinkTxDirectCurrent:
3&gt; include the uplinkTxDirectCurrentList for each MCG serving cell with UL;
3&gt; include uplinkDirectCurrentBWP-SUL for each MCG serving cell configured with SUL carrier, if any, within the uplinkTxDirectCurrentList;
2&gt; if the masterCellGroup contains the reportUplinkTxDirectCurrentTwoCarrier:
3&gt; include in the uplinkTxDirectCurrentTwoCarrierList the list of uplink Tx DC locations for the configured uplink carrier aggregation in the MCG;
2&gt; if the UE has idle/inactive measurement information concerning cells other than the PCell available in VarMeasIdleReport:
3&gt; if the idleModeMeasurementReq is included in the RRCResume message:
4&gt; set the measResultIdleEUTRA in the RRCResumeComplete message to the value of measReportIdleEUTRA in the VarMeasIdleReport, if available;
4&gt; set the measResultIdleNR in the RRCResumeComplete message to the value of measReportIdleNR in the VarMeasIdleReport, if available;
4&gt; discard the VarMeasIdleReport upon successful delivery of the RRCResumeComplete message is confirmed by lower layers;
4&gt; if the SIB1 contains idleModeMeasurementsNR and the UE has NR idle/inactive measurement information concerning cells other than the PCell available in VarMeasIdleReport; or
4&gt; if the SIB1 contains idleModeMeasurementsEUTRA and the UE has E-UTRA idle/inactive measurement information available in VarMeasIdleReport:
5&gt; include the idleMeasAvailable;
2&gt; if the RRCResume message includes mrdc-SecondaryCellGroup set to eutra-SCG:
3&gt; include in the eutra-SCG-Response the E-UTRA RRCConnectionReconfigurationComplete message in accordance with TS 36.331 clause 5.3.5.3;
2&gt; if the RRCResume message includes mrdc-SecondaryCellGroup set to nr-SCG:
3&gt; include in the nr-SCG-Response the SCG RRCReconfigurationComplete message;
2&gt; if the UE has logged measurements available for NR and if the RPLMN is included in plmn-IdentityList stored in VarLogMeasReport:
3&gt; if the sigLoggedMeasType in VarLogMeasReport is included:
4&gt; include the sigLogMeasConfigAvailable in the RRCResumeComplete message and set it according to the following:
5&gt; if T330 timer is running:
6&gt; set sigLogMeasConfigAvailable to true in the RRCResumeComplete message;
6&gt; set sigLogMeasConfigAvailable to false in the RRCResumeComplete message;
3&gt; include the logMeasAvailable in the RRCResumeComplete message;
3&gt; if Bluetooth measurement results are included in the logged measurements the UE has available for NR:
4&gt; include the logMeasAvailableBT in the RRCResumeComplete message;
3&gt; if WLAN measurement results are included in the logged measurements the UE has available for NR:
4&gt; include the logMeasAvailableWLAN in the RRCResumeComplete message;
2&gt; if the sigLoggedMeasType in VarLogMeasReport is included:
3&gt; if T330 timer is running:
4&gt; set sigLogMeasConfigAvailable to true in the RRCResumeComplete message;
4&gt; if the UE has logged measurements available for NR:
5&gt; set sigLogMeasConfigAvailable to false in the RRCResumeComplete message;
2&gt; if the UE has connection establishment failure or connection resume failure information available in VarConnEstFailReport or VarConnEstFailReportList and if the RPLMN is equal to plmn-Identity stored in VarConnEstFailReport or VarConnEstFailReportList:
3&gt; include connEstFailInfoAvailable in the RRCResumeComplete message;
2&gt; if the UE has radio link failure or handover failure information available in VarRLF-Report and if the RPLMN is included in plmn-IdentityList stored in VarRLF-Report; or
2&gt; if the UE has radio link failure or handover failure information available in VarRLF-Report of TS 36.331 stored in VarRLF-Report of TS 36.331 :
3&gt; include rlf-InfoAvailable in the RRCResumeComplete message;
2&gt; if the UE has successful handover information available in VarSuccessHO-Report and if the RPLMN is included in plmn-IdentityList stored in VarSuccessHO-Report:
3&gt; include successHO-InfoAvailable in the RRCResumeComplete message;
2&gt; if the UE supports storage of mobility history information and the UE has mobility history information available in VarMobilityHistoryReport:
3&gt; include the mobilityHistoryAvail in the RRCResumeComplete message;
2&gt; if speedStateReselectionPars is configured in the SIB2:
3&gt; include the mobilityState in the RRCResumeComplete message and set it to the mobility state (as specified in TS 38.304 ) of the UE just prior to entering RRC_CONNECTED state;
2&gt; if the UE is configured to provide the measurement gap requirement information of NR target bands:
3&gt; include the NeedForGapsInfoNR and set the contents as follows:
4&gt; include intraFreq-needForGap and set the gap requirement information of intra-frequency measurement for each NR serving cell;
4&gt; if requestedTargetBandFilterNR is configured, for each supported NR band that is also included in requestedTargetBandFilterNR, include an entry in interFreq-needForGap and set the gap requirement information for that band; otherwise, include an entry in interFreq-needForGap and set the corresponding gap requirement information for each supported NR band;
2&gt; if the UE is configured to provide the measurement gap and NCSG requirement information of NR target bands:
3&gt; include the NeedForNCSG-InfoNR and set the contents as follows:
4&gt; include intraFreq-needForNCSG and set the gap and NCSG requirement information of intra- frequency measurement for each NR serving cell;
4&gt; if requestedTargetBandFilterNCSG-NR is configured, for each supported NR band included in requestedTargetBandFilterNCSG-NR, include an entry in interFreq-needForNCSG and set the NCSG requirement information for that band; otherwise, include an entry for each supported NR band in interFreq-needForNCSG and set the corresponding NCSG requirement information;
2&gt; if the UE is configured to provide the measurement gap and NCSG requirement information of E-UTRA target bands:
3&gt; include the NeedForNCSG-InfoEUTRA and set the contents as follows:
4&gt; if requestedTargetBandFilterNCSG-EUTRA is configured, for each supported E-UTRA band included in requestedTargetBandFilterNCSG-EUTRA, include an entry in needForNCSG-EUTRA and set the NCSG requirement information for that band; otherwise, include an entry for each supported E-UTRA band in needForNCSG-EUTRA and set the corresponding NCSG requirement information;
1&gt; submit the RRCResumeComplete message to lower layers for transmission;
1&gt; the procedure ends.
5.3.13.5 Handling of failure to resume RRC Connection
The UE shall:
2&gt; if the UE has connection establishment failure information or connection resume failure information available in VarConnEstFailReport and if the RPLMN is not equal to plmn-identity stored in VarConnEstFailReport; or
2&gt; if the cell identity of current cell is not equal to the cell identity stored in measResultFailedCell in VarConnEstFailReport:
3&gt; reset the numberOfConnFail to 0;
2&gt; if the UE has connection establishment failure informaton or connection resume failure information available in VarConnEstFailReportList and if the RPLMN is not equal to plmn-identity stored in VarConnEstFailReportList:
3&gt; clear the content included in VarConnEstFailReportList;
2&gt; clear the content included in VarConnEstFailReport except for the numberOfConnFail, if any;
2&gt; store the following connection resume failure information in the VarConnEstFailReport by setting its fields as follows:
3&gt; set the plmn-Identity to the PLMN selected by upper layers (see TS 24.501 ) from the PLMN(s) included in the plmn-IdentityInfoList in SIB1;
3&gt; set the measResultFailedCell to include the global cell identity, tracking area code, the cell level and SS/PBCH block level RSRP, and RSRQ, and SS/PBCH block indexes, of the failed cell based on the available SSB measurements collected up to the moment the UE detected connection resume failure;
3&gt; if available, set the measResultNeighCells, in order of decreasing ranking-criterion as used for cell re- selection, to include neighbouring cell measurements for at most the following number of neighbouring cells: 6 intra-frequency and 3 inter-frequency neighbours per frequency as well as 3 inter-RAT neighbours, per frequency/ set of frequencies per RAT and according to the following:
4&gt; for each neighbour cell included, include the optional fields that are available; NOTE: The UE includes the latest results of the available measurements as used for cell reselection evaluation, which are performed in accordance with the performance requirements as specified in TS 38.133 .
3&gt; if available, set the locationInfo as in 5.3.3.7;
3&gt; set perRAInfoList to indicate the performed random access procedure related information as specified in
3&gt; if numberOfConnFail is smaller than 8:
4&gt; increment the numberOfConnFail by 1;
2&gt; if the UE supports multiple CEF report:
3&gt; if the cgi-Info in the measResultFailedCell in the newly added VarConnEstFailReport is the same as the cgi-Info in the measResultFailedCell in the last entry in the VarConnEstFailReportList:
4&gt; except for the numberOfConnFail, replace all information elements for the enty with the VarConnEstFailReport:
4&gt; if the maxCEFReport-r17 has not been reached:
5&gt; append the VarConnEstFailReport as a new entry in the VarConnEstFailReportList;
2&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11 with release cause 'RRC Resume failure'.
1&gt; else if upon receiving Integrity check failure indication from lower layers while T319 or T319a is running:
2&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11 with release cause 'RRC Resume failure'.
1&gt; else if indication from the MCG RLC that the maximum number of retransmissions has been reached is received while T319a is running; or
1&gt; if random access problem indication is received from MCG MAC while T319a is running; or
1&gt; if the lower layers indicate that cg-SDT-TimeAlignmentTimer expired before receiving network response for the UL CG-SDT transmission with CCCH message while T319a is running; or
2&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11 with release cause 'RRC Resume failure'.
The UE may discard the connection resume failure or connection establishment failure information, i.e. release the UE variable VarConnEstFailReport, 48 hours after the last connection resume failure is detected.
The L2 U2N Relay UE either triggers PC5-S release or sends Notification message to the connected L2 U2N Remote UE(s) in accordance with 5.8.9.10.
5.3.13.6 Cell re-selection or cell selection or L2 U2N relay (re)selection while T390, T319, T319a or T302 is running (UE in RRC_INACTIVE)
The UE shall:
1&gt; if cell reselection occurs while T319 or T302 or T319a is running; or
1&gt; if relay reselection occurs while T319 is running; or
1&gt; if cell changes due to relay reselection while T302 is running:
2&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11 with release cause 'RRC Resume failure';
1&gt; else if cell selection or reselection occurs while T390 is running, or cell change due to relay selection or reselection occurs while T390 is running:
2&gt; stop T390 for all access categories;
2&gt; perform the actions as specified in 5.3.14.4.
5.3.13.7 Reception of the RRCSetup by the UE
The UE shall:
1&gt; perform the RRC connection setup procedure as specified in 5.3.3.4.
5.3.13.8 RNA update
In RRC_INACTIVE state, the UE shall:
1&gt; if RNA Update is triggered at reception of SIB1, as specified in 5.2.2.4.2:
2&gt; if T319a is not running:
3&gt; initiate RRC connection resume procedure in 5.3.13.2 with resumeCause set to rna-Update;
1&gt; if barring is alleviated for Access Category '8' or Access Category '2', as specified in 5.3.14.4:
2&gt; if upper layers do not request RRC the resumption of an RRC connection, and
2&gt; if the variable pendingRNA-Update is set to true:
3&gt; initiate RRC connection resume procedure in 5.3.13.2 with resumeCause value set to rna-Update.
If the UE in RRC_INACTIVE state fails to find a suitable cell and camps on the acceptable cell to obtain limited service as defined in TS 38.304 , the UE shall:
1&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11 with release cause 'other'.
NOTE: It is left to UE implementation how to behave when T380 expires while the UE is camped neither on a suitable nor on an acceptable cell.
5.3.13.9 Reception of the RRCRelease by the UE
The UE shall:
1&gt; perform the actions as specified in 5.3.8.
5.3.13.10 Reception of the RRCReject by the UE
The UE shall:
1&gt; perform the actions as specified in 5.3.15.
5.3.13.11 Inability to comply with RRCResume
The UE shall:
1&gt; if the UE is unable to comply with (part of) the configuration included in the RRCResume message;
2&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11 with release cause RRC Resume
NOTE 1: The UE may apply above failure handling also in case the RRCResume message causes a protocol error for which the generic error handling as defined in 10 specifies that the UE shall ignore the message.
NOTE 2: If the UE is unable to comply with part of the configuration, it does not apply any part of the configuration, i.e. there is no partial success/failure.
5.3.13.12 Inter RAT cell reselection
Upon reselecting to an inter-RAT cell, the UE shall:
1&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'other'.
5.3.14 Unified Access Control
5.3.14.1 General
The purpose of this procedure is to perform access barring check for an access attempt associated with a given Access
Category and one or more Access Identities upon request from upper layers according to TS 24.501 or the RRC
layer. This procedure does not apply to IAB-MT. This procedure does not apply to L2 U2N Relay UE initiating RRC connection establishment or RRC connection resume upon reception of any message from a L2 U2N remote UE via SL- RLC0 or SL-RLC1 in accordance to 5.3.3.1a and 5.3.13.1a.
After a PCell change in RRC_CONNECTED the UE shall defer access barring checks until it has obtained SIB1 (as specified in 5.2.2.2) from the target cell.
5.3.14.2 Initiation
Upon initiation of the procedure, the UE shall:
1&gt; if timer T390 is running for the Access Category:
2&gt; consider the access attempt as barred;
1&gt; else if timer T302 is running and the Access Category is neither '2' nor '0':
2&gt; consider the access attempt as barred;
2&gt; if the Access Category is '0':
3&gt; consider the access attempt as allowed;
3&gt; if SIB1 includes uac-BarringPerPLMN-List that contains a UAC-BarringPerPLMN for the selected PLMN or SNPN:
4&gt; if the procedure in 5.2.2.4.2 for a selected PLMN resulted in use of information in npn-IdentityInfoList and UAC-BarringPerPLMN has an entry with the plmn-IdentityIndex corresponding to used information in this list:
5&gt; select the UAC-BarringPerPLMN entry with the plmn-IdentityIndex corresponding to used information in the npn-IdentityInfoList;
5&gt; select the UAC-BarringPerPLMN entry with the plmn-IdentityIndex corresponding to the selected PLMN and the PLMN-IdentityInfo, if any, or the selected SNPN and the npn-IdentityInfoList;
3&gt; if any UAC-BarringPerPLMN entry is selected:
4&gt; in the remainder of this procedure, use the selected UAC-BarringPerPLMN entry (i.e. presence or absence of access barring parameters in this entry) irrespective of the uac-BarringForCommon included in SIB1;
3&gt; else if SIB1 includes uac-BarringForCommon:
4&gt; in the remainder of this procedure use the uac-BarringForCommon (i.e. presence or absence of these
parameters) included in SIB1;
4&gt; consider the access attempt as allowed;
3&gt; if uac-BarringForCommon is applicable or the uac-ACBarringListType indicates that uac- ExplicitACBarringList is used:
4&gt; if the corresponding UAC-BarringPerCatList contains a UAC-BarringPerCat entry corresponding to the Access Category:
5&gt; if the uac-BarringInfoSetList contains a UAC-BarringInfoSet entry corresponding to the selected uac-barringInfoSetIndex in the UAC-BarringPerCat:
6&gt; perform access barring check for the Access Category as specified in 5.3.14.5, using the selected UAC-BarringInfoSet as "UAC barring parameter";
6&gt; consider the access attempt as allowed;
5&gt; consider the access attempt as allowed;
3&gt; else if the uac-ACBarringListType indicates that uac-ImplicitACBarringList is used:
4&gt; select the uac-BarringInfoSetIndex corresponding to the Access Category in the uac- ImplicitACBarringList;
4&gt; if the uac-BarringInfoSetList contains the UAC-BarringInfoSet entry corresponding to the selected uac-BarringInfoSetIndex:
5&gt; perform access barring check for the Access Category as specified in 5.3.14.5, using the selected UAC-BarringInfoSet as "UAC barring parameter";
5&gt; consider the access attempt as allowed;
4&gt; consider the access attempt as allowed;
1&gt; if the access barring check was requested by upper layers:
2&gt; if the access attempt is considered as barred:
3&gt; if timer T302 is running:
4&gt; if timer T390 is running for Access Category '2':
5&gt; inform the upper layer that access barring is applicable for all access categories except categories
'0', upon which the procedure ends;
4&gt; else
5&gt; inform the upper layer that access barring is applicable for all access categories except categories
'0' and '2', upon which the procedure ends;
4&gt; inform upper layers that the access attempt for the Access Category is barred, upon which the procedure ends;
3&gt; inform upper layers that the access attempt for the Access Category is allowed, upon which the procedure ends;
2&gt; the procedure ends.
5.3.14.3 Void
The UE shall:
1&gt; if timer T302 expires or is stopped:
2&gt; for each Access Category for which T390 is not running:
3&gt; consider the barring for this Access Category to be alleviated:
1&gt; else if timer T390 corresponding to an Access Category other than '2' expires or is stopped, and if timer T302 is not running:
2&gt; consider the barring for this Access Category to be alleviated;
1&gt; else if timer T390 corresponding to the Access Category '2' expires or is stopped:
2&gt; consider the barring for this Access Category to be alleviated;
1&gt; when barring for an Access Category is considered being alleviated:
2&gt; if the Access Category was informed to upper layers as barred:
3&gt; inform upper layers about barring alleviation for the Access Category.
2&gt; if barring is alleviated for Access Category '8'; or
2&gt; if barring is alleviated for Access Category '2':
3&gt; perform actions specified in 5.3.13.8;
5.3.14.5 Access barring check
The UE shall:
1&gt; if for at least one of these Access Identities the corresponding bit in the uac-BarringForAccessIdentity contained in "UAC barring parameter" is set to zero:
2&gt; consider the access attempt as allowed;
2&gt; if the establishment of the RRC connection is the result of release with redirect with mpsPriorityIndication (either in NR or E-UTRAN); and
2&gt; if the bit corresponding to Access Identity 1 in the uac-BarringForAccessIdentity contained in the "UAC barring parameter" is set to zero:
3&gt; consider the access attempt as allowed;
2&gt; else if Access Identity 3 is indicated:
3&gt; draw a random number 'rand' uniformly distributed in the range: 0 rand &lt; 1;
3&gt; if 'rand' is lower than the value indicated by uac-BarringFactorForAI3 included in "UAC barring parameter":
4&gt; consider the access attempt as allowed;
4&gt; consider the access attempt as barred;
3&gt; draw a random number 'rand' uniformly distributed in the range: 0 rand &lt; 1;
3&gt; if 'rand' is lower than the value indicated by uac-BarringFactor included in "UAC barring parameter":
4&gt; consider the access attempt as allowed;
4&gt; consider the access attempt as barred;
1&gt; if the access attempt is considered as barred:
2&gt; draw a random number 'rand' that is uniformly distributed in the range 0 rand &lt; 1;
2&gt; start timer T390 for the Access Category with the timer value calculated as follows, using the uac- BarringTime included in "UAC barring parameter":
5.3.15 RRC connection reject
5.3.15.1 Initiation
The UE initiates the procedure upon the reception of RRCReject when the UE tries to establish or resume an RRC
5.3.15.2 Reception of the RRCReject by the UE
The UE shall:
1&gt; stop timer T300, if running;
1&gt; stop timer T319, if running;
1&gt; stop timer T319a, if running;
1&gt; stop timer T302, if running;
1&gt; reset MAC and release the default MAC Cell Group configuration;
1&gt; if waitTime is configured in the RRCReject:
2&gt; start timer T302, with the timer value set to the waitTime;
1&gt; if RRCReject is received in response to a request from upper layers:
2&gt; inform the upper layer that access barring is applicable for all access categories except categories '0' and '2';
1&gt; if RRCReject is received in response to an RRCSetupRequest:
2&gt; inform upper layers about the failure to setup the RRC connection, upon which the procedure ends;
1&gt; else if RRCReject is received in response to an RRCResumeRequest or an RRCResumeRequest1:
2&gt; if resume is triggered by upper layers:
3&gt; inform upper layers about the failure to resume the RRC connection;
2&gt; if resume is triggered due to an RNA update; or
2&gt; if resume is triggered for SDT and T380 is not running:
3&gt; set the variable pendingRNA-Update to true;
2&gt; discard the current K key, the K key, the K key, the K key and the K key derived in gNB RRCenc RRCint UPint UPenc accordance with 5.3.13.3;
2&gt; suspend SRB1 and the radio bearers configured for SDT, if any;
2&gt; for each radio bearer configured for SDT:
3&gt; indicate PDCP suspend to lower layers;
3&gt; re-establish the RLC entity as specified in TS 38.322 ;
2&gt; the procedure ends; Upon L2 U2N Relay UE receives RRCReject, it either triggers PC5-S release or sends Notification message to the connected L2 U2N Remote UE(s) in accordance with 5.8.9.10.
The RRC_INACTIVE UE shall continue to monitor paging while the timer T302 is running.
NOTE: If timer T331 is running, the UE continues to perform idle/inactive measurements according to 5.7.8.
5.4.1 Introduction
Network controlled inter-RAT mobility between NR and E-UTRA, where E-UTRA can be connected to either EPC or 5GC, and from NR to UTRA-FDD is supported.
5.4.2 Handover to NR
5.4.2.1 General RRCReconfiguration (sent via other RAT) RRCReconfigurationComplete
The purpose of this procedure is to, under the control of the network, transfer a connection between the UE and another
Radio Access Network (e.g. E-UTRAN) to NR.
The handover to NR procedure applies when SRBs, possibly in combination with DRBs, are established in another RAT. Handover from E-UTRA to NR applies only after integrity has been activated in E-UTRA.
5.4.2.2 Initiation
The RAN using another RAT initiates the handover to NR procedure, in accordance with the specifications applicable for the other RAT, by sending the RRCReconfiguration message via the radio access technology from which the inter- RAT handover is performed.
The network applies the procedure as follows: a) to activate ciphering, possibly using NULL algorithm, if not yet activated in the other RAT; b) to re-establish SRBs and one or more DRBs;
5.4.2.3 Reception of the RRCReconfiguration by the UE
The UE shall:
1&gt; apply the default L1 parameter values as specified in corresponding physical layer specifications except for the parameters for which values are provided in SIB1;
1&gt; apply the default MAC Cell Group configuration as specified in 9.2.2;
1&gt; perform RRC reconfiguration procedure as specified in 5.3.5; NOTE: If the UE is connected to 5GC of the source E-UTRA cell, the delta configuration for PDCP and SDAP can be used for intra-system inter-RAT handover. For other cases, source RAT configuration is not considered when the UE applies the reconfiguration message of target RAT.
5.4.3 Mobility from NR
5.4.3.1 General MobilityFromNRCommand MobilityFromNRCommand RRC connection re-establishment
The purpose of this procedure is to move a UE in RRC_CONNECTED to a cell using other RAT, e.g. E-UTRA, UTRA-FDD. The mobility from NR procedure covers the following type of mobility: a) handover, i.e. the MobilityFromNRCommand message includes radio resources that have been allocated for the UE in the target cell;
5.4.3.2 Initiation
The network initiates the mobility from NR procedure to a UE in RRC_CONNECTED, possibly in response to a MeasurementReport or an MCGFailureInformation message, by sending a MobilityFromNRCommand message. The network applies the procedure as follows: a) the procedure is initiated only when AS security has been activated, and SRB2 with at least one DRB are setup and not suspended; b) the procedure is not initiated if any DAPS bearer is configured;
5.4.3.3 Reception of the MobilityFromNRCommand by the UE
The UE shall:
1&gt; stop timer T310, if running;
1&gt; stop timer T312, if running;
2&gt; stop timer T316;
2&gt; clear the information included in VarRLF-Report, if any;
2&gt; stop timer T390 for all access categories;
2&gt; perform the actions as specified in 5.3.14.4;
1&gt; if the targetRAT-Type is set to eutra:
2&gt; consider inter-RAT mobility as initiated towards E-UTRA;
2&gt; forward the nas-SecurityParamFromNR to the upper layers, if included;
1&gt; else if the targetRAT-Type is set to utra-fdd:
2&gt; consider inter-RAT mobility as initiated towards UTRA-FDD;
2&gt; forward the nas-SecurityParamFromNR to the upper layers, if included;
1&gt; access the target cell indicated in the inter-RAT message in accordance with the specifications of the target RAT.
5.4.3.4 Successful completion of the mobility from NR
Upon successfully completing the handover, at the source side the UE shall:
1&gt; stop all timers that are running except T325, T330 and T400;
1&gt; release the AS security context including the K key, the K key, the K key and the K key, if RRCenc RRCint UPint UPenc stored;
1&gt; release all radio resources, including release of the RLC entity and the MAC configuration;
1&gt; release the associated PDCP entity and SDAP entity for all established RBs; NOTE : PDCP and SDAP configured by the source RAT prior to the handover that are reconfigured and re-used by target RAT when delta signalling (i.e., during inter-RAT intra-system handover when fullConfig is not
present) is used, are not released as part of this procedure.
1&gt; if the targetRAT-Type is set to eutra and the nas-SecurityParamFromNR is included: or
1&gt; if the targetRAT-Type is set to utra-fdd:
2&gt; indicate the release of the RRC connection to upper layers together with the release cause 'other'.
5.4.3.5 Mobility from NR failure
The UE shall:
1&gt; if the UE does not succeed in establishing the connection to the target radio access technology:
2&gt; if the targetRAT-Type in the received MobilityFromNRCommand is set to eutra and the UE supports Radio
Link Failure Report for Inter-RAT MRO EUTRA:
3&gt; store handover failure information in VarRLF-Report according to 5.3.10.5;
2&gt; if voiceFallbackIndication is included in the MobilityFromNRCommand message:
3&gt; attempt to select an E-UTRA cell:
4&gt; if a suitable E-UTRA cell is selected:
5&gt; perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'RRC connection failure';
5&gt; revert back to the configuration used in the source PCell;
5&gt; initiate the connection re-establishment procedure as specified in clause 5.3.7;
3&gt; revert back to the configuration used in the source PCell;
3&gt; initiate the connection re-establishment procedure as specified in clause 5.3.7;
1&gt; else if the UE is unable to comply with any part of the configuration included in the MobilityFromNRCommand message; or
1&gt; if there is a protocol error in the inter RAT information included in the MobilityFromNRCommand message, causing the UE to fail the procedure according to the specifications applicable for the target RAT:
2&gt; if the targetRAT-Type in the received MobilityFromNRCommand is set to eutra and the UE supports Radio
Link Failure Report for Inter-RAT MRO EUTRA:
3&gt; store handover failure information in VarRLF-Report according to 5.3.10.5;
2&gt; revert back to the configuration used in the source PCell;
2&gt; initiate the connection re-establishment procedure as specified in clause 5.3.7.
5.5 Measurements
5.5.1 Introduction
The network may configure an RRC_CONNECTED UE to perform measurements. The network may configure the UE to report them in accordance with the measurement configuration or perform conditional reconfiguration evaluation in accordance with the conditional reconfiguration. The measurement configuration is provided by means of dedicated signalling i.e. using the RRCReconfiguration or RRCResume.
The network may configure the UE to perform the following types of measurements: a) NR measurements; b) Inter-RAT measurements of E-UTRA frequencies; c) Inter-RAT measurements of UTRA-FDD frequencies; d) NR sidelink measurements of L2 U2N Relay UEs.
The network may configure the UE to report the following measurement information based on CSI-RS resources: a) Measurement results per CSI-RS resource; b) Measurement results per cell based on CSI-RS resource(s); c) CSI-RS resource measurement identifiers.
The network may configure the UE to perform the following types of measurements for NR sidelink and V2X sidelink: a) CBR measurements.
The network may configure the UE to report the following CLI measurement information based on SRS resources: a) Measurement results per SRS resource; b) SRS resource(s) indexes.
The network may configure the UE to report the following Rx-Tx time difference measurement information based on CSI-RS for tracking or PRS: a) UE Rx-Tx time difference measurement result.
The measurement configuration includes the following parameters:
1. Measurement objects: A list of objects on which the UE shall perform the measurements. a) For intra-frequency and inter-frequency measurements a measurement object indicates the frequency/time location and subcarrier spacing of reference signals to be measured. Associated with this measurement object, the network may configure a list of cell specific offsets, a list of 'exclude-listed' cells and a list of
'allow-listed' cells. Exclude-listed cells are not applicable in event evaluation or measurement reporting.
Allow-listed cells are the only ones applicable in event evaluation or measurement reporting. a) The measObjectId of the MO which corresponds to each serving cell is indicated by servingCellMO within the serving cell configuration. b) For inter-RAT E-UTRA measurements a measurement object is a single E-UTRA carrier frequency.
Associated with this E-UTRA carrier frequency, the network can configure a list of cell specific offsets and a list of 'exclude-listed' cells. Exclude-listed cells are not applicable in event evaluation or measurement
reporting. a) For inter-RAT UTRA-FDD measurements a measurement object is a set of cells on a single UTRA-FDD carrier frequency. b) For NR sidelink measurements of L2 U2N Relay UEs, a measurement object is a single NR sidelink frequency to be measured. c) For CBR measurement of NR sidelink communication, a measurement object is a set of transmission resource pool(s) on a single carrier frequency for NR sidelink communication. d) For CLI measurements a measurement object indicates the frequency/time location of SRS resources and/or CLI-RSSI resources, and subcarrier spacing of SRS resources to be measured.
2. Reporting configurations: A list of reporting configurations where there can be one or multiple reporting configurations per measurement object. Each measurement reporting configuration consists of the following: a) Reporting criterion: The criterion that triggers the UE to send a measurement report. This can either be periodical or a single event description. b) RS type: The RS that the UE uses for beam and cell measurement results (SS/PBCH block or CSI-RS). c) Reporting format: The quantities per cell and per beam that the UE includes in the measurement report (e.g.
RSRP) and other associated information such as the maximum number of cells and the maximum number beams per cell to report.
In case of conditional reconfiguration, each configuration consists of the following: a) Execution criteria: The criteria the UE uses for conditional reconfiguration execution. b) RS type: The RS that the UE uses for obtaining beam and cell measurement results (SS/PBCH block-based or CSI-RS-based), used for evaluating conditional reconfiguration execution condition.
3. Measurement identities: For measurement reporting, a list of measurement identities where each measurement identity links one measurement object with one reporting configuration. By configuring multiple measurement identities, it is possible to link more than one measurement object to the same reporting configuration, as well as to link more than one reporting configuration to the same measurement object. The measurement identity is also included in the measurement report that triggered the reporting, serving as a reference to the network. For conditional reconfiguration triggering, one measurement identity links to exactly one conditional reconfiguration trigger configuration. And up to 2 measurement identities can be linked to one conditional reconfiguration execution condition.
4. Quantity configurations: The quantity configuration defines the measurement filtering configuration used for all event evaluation and related reporting, and for periodical reporting of that measurement. For NR measurements, the network may configure up to 2 quantity configurations with a reference in the NR measurement object to the configuration that is to be used. In each configuration, different filter coefficients can be configured for different measurement quantities, for different RS types, and for measurements per cell and per
5. Measurement gaps: Periods that the UE may use to perform measurements.
Editor Note: It is FFS whether and how the definition of measurement gap should be updated due to pre-configured MG.
A UE in RRC_CONNECTED maintains a measurement object list, a reporting configuration list, and a measurement identities list according to signalling and procedures in this specification. The measurement object list possibly includes NR measurement object(s), CLI measurement object(s), inter-RAT objects, and L2 U2N Relay objects. Similarly, the reporting configuration list includes NR, inter-RAT, and L2 U2N Relay reporting configurations. Any measurement object can be linked to any reporting configuration of the same RAT type. Some reporting configurations may not be linked to a measurement object. Likewise, some measurement objects may not be linked to a reporting configuration.
The measurement procedures distinguish the following types of cells:
1. The NR serving cell(s) these are the SpCell and one or more SCells.
2. Listed cells these are cells listed within the measurement object(s).
3. Detected cells these are cells that are not listed within the measurement object(s) but are detected by the UE on the SSB frequency(ies) and subcarrier spacing(s) indicated by the measurement object(s).
For NR measurement object(s), the UE measures and reports on the serving cell(s)/serving Relay UE (for L2 U2N
Remote UE), listed cells and/or detected cells. For inter-RAT measurements object(s) of E-UTRA, the UE measures and reports on listed cells and detected cells and, for RSSI and channel occupancy measurements, the UE measures and reports on the configured resources on the indicated frequency. For inter-RAT measurements object(s) of UTRA-FDD, the UE measures and reports on listed cells. For CLI measurement object(s), the UE measures and reports on configured measurement resources (i.e. SRS resources and/or CLI-RSSI resources). For L2 U2N Relay object(s), the UE measures and reports on the serving NR cell(s), as well as the discovered L2 U2N Relay UEs.
Whenever the procedural specification, other than contained in clause 5.5.2, refers to a field it concerns a field included in the VarMeasConfig unless explicitly stated otherwise i.e. only the measurement configuration procedure covers the direct UE action related to the received measConfig.
In NR-DC, the UE may receive two independent measConfig: a) a measConfig, associated with MCG, that is included in the RRCReconfiguration message received via SRB1; and b) a measConfig, associated with SCG, that is included in the RRCReconfiguration message received via SRB3, or, alternatively, included within a RRCReconfiguration message embedded in a RRCReconfiguration message received via SRB1.
In this case, the UE maintains two independent VarMeasConfig and VarMeasReportList, one associated with each measConfig, and independently performs all the procedures in clause 5.5 for each measConfig and the associated VarMeasConfig and VarMeasReportList, unless explicitly stated otherwise.
The configurations related to CBR measurements are only included in the measConfig associated with MCG.
The configurations related to Rx-Tx time difference measurement are only included in the measConfig associated with MCG.
5.5.2 Measurement configuration
5.5.2.1 General
The network applies the procedure as follows: a) to ensure that, whenever the UE has a measConfig associated with a CG, it includes a measObject for the SpCell and for each NR SCell of the CG to be measured; b) to configure at most one measurement identity across all CGs using a reporting configuration with the reportType set to reportCGI; c) to configure at most one measurement identity per the node hosting PDCP entity using a reporting configuration with the ul-DelayValueConfig; d) to configure at most one measurement identity per the node hosting PDCP entity using a reporting configuration with the ul-ExcessDelayConfig; e) to ensure that, in the measConfig associated with a CG: f) for all SSB based measurements there is at most one measurement object with the same ssbFrequency; g) an smtc1 included in any measurement object with the same ssbFrequency has the same value and that an smtc2 included in any measurement object with the same ssbFrequency has the same value and that an smtc3list included in any measurement object with the same ssbFrequency has the same value and that an smtc4list included in any measurement object with the same ssbFrequency has the same value; h) to ensure that all measurement objects configured in this specification and in TS 36.331 with the same ssbFrequency have the same ssbSubcarrierSpacing; i) to ensure that, if a measurement object associated with the MCG has the same ssbFrequency as a measurement object associated with the SCG: j) for that ssbFrequency, the measurement window according to the smtc1 configured by the MCG includes the measurement window according to the smtc1 configured by the SCG, or vice-versa, with an accuracy of the maximum receive timing difference specified in TS 38.133 . k) if both measurement objects are used for RSSI measurements, bits in measurementSlots in both objects corresponding to the same slot are set to the same value. Also, the endSymbol is the same in both objects. l) to ensure that, if a measurement object has the same ssbFrequency as a measurement object configured in TS
36.331 : a) for that ssbFrequency, the measurement window according to the smtc configured in TS 36.331 includes the measurement window according to the smtc1 configured in TS 38.331, or vice-versa, with an accuracy of the maximum receive timing difference specified in TS 38.133 . b) if both measurement objects are used for RSSI measurements, bits in measurementSlots in both objects corresponding to the same slot are set to the same value. Also, the endSymbol is the same in both objects. c) when the UE is in NE-DC, NR-DC, or NR standalone, to configure at most one measurement identity across all CGs using a reporting configuration with the reportType set to reportSFTD; For CSI-RS resources, the network applies the procedure as follows: d) to ensure that all CSI-RS resources configured in each measurement object have the same center frequency, (startPRB+floor(nrofPRBs/2)) e) to ensure that the total number of CSI-RS resources configured in each measurement object does not exceed the maximum number specified in TS 38.214 .
The UE shall:
1&gt; if the received measConfig includes the measObjectToRemoveList:
2&gt; perform the measurement object removal procedure as specified in 5.5.2.4;
1&gt; if the received measConfig includes the measObjectToAddModList:
2&gt; perform the measurement object addition/modification procedure as specified in 5.5.2.5;
1&gt; if the received measConfig includes the reportConfigToRemoveList:
2&gt; perform the reporting configuration removal procedure as specified in 5.5.2.6;
1&gt; if the received measConfig includes the reportConfigToAddModList:
2&gt; perform the reporting configuration addition/modification procedure as specified in 5.5.2.7;
1&gt; if the received measConfig includes the quantityConfig:
2&gt; perform the quantity configuration procedure as specified in 5.5.2.8;
1&gt; if the received measConfig includes the measIdToRemoveList:
2&gt; perform the measurement identity removal procedure as specified in 5.5.2.2;
1&gt; if the received measConfig includes the measIdToAddModList:
2&gt; perform the measurement identity addition/modification procedure as specified in 5.5.2.3;
1&gt; if the received measConfig includes the measGapConfig:
2&gt; perform the measurement gap configuration procedure as specified in 5.5.2.9;
1&gt; if the received measConfig includes the measGapSharingConfig:
2&gt; perform the measurement gap sharing configuration procedure as specified in 5.5.2.11;
1&gt; if the received measConfig includes the s-MeasureConfig:
2&gt; if s-MeasureConfig is set to ssb-RSRP, set parameter ssb-RSRP of s-MeasureConfig within VarMeasConfig to the lowest value of the RSRP ranges indicated by the received value of s-MeasureConfig;
2&gt; else, set parameter csi-RSRP of s-MeasureConfig within VarMeasConfig to the lowest value of the RSRP ranges indicated by the received value of s-MeasureConfig.
5.5.2.2 Measurement identity removal
The UE shall:
1&gt; for each measId included in the received measIdToRemoveList that is part of the current UE configuration in VarMeasConfig:
2&gt; remove the entry with the matching measId from the measIdList within the VarMeasConfig;
2&gt; remove the measurement reporting entry for this measId from the VarMeasReportList, if included;
2&gt; stop the periodical reporting timer or timer T321 or timer T322, whichever one is running, and reset the associated information (e.g. timeToTrigger) for this measId.
NOTE: The UE does not consider the message as erroneous if the measIdToRemoveList includes any measId value that is not part of the current UE configuration.
5.5.2.3 Measurement identity addition/modification
The network applies the procedure as follows: a) configure a measId only if the corresponding measurement object, the corresponding reporting configuration and the corresponding quantity configuration, are configured.
The UE shall:
1&gt; for each measId included in the received measIdToAddModList:
2&gt; if an entry with the matching measId exists in the measIdList within the VarMeasConfig:
3&gt; replace the entry with the value received for this measId;
3&gt; add a new entry for this measId within the VarMeasConfig;
2&gt; remove the measurement reporting entry for this measId from the VarMeasReportList, if included;
2&gt; stop the periodical reporting timer or timer T321 or timer T322, whichever one is running, and reset the associated information (e.g. timeToTrigger) for this measId; NOTE 1: If the measId associated with reportConfig for conditional reconfiguration is modified, the conditions are considered to be not fulfilled as specified in 5.3.5.13.4.
2&gt; if the reportType is set to reportCGI in the reportConfig associated with this measId:
3&gt; if the measObject associated with this measId concerns E-UTRA:
4&gt; if the useAutonomousGaps is included in the reportConfig associated with this measId:
5&gt; start timer T321 with the timer value set to 200 ms for this measId;
5&gt; start timer T321 with the timer value set to 1 second for this measId;
3&gt; if the measObject associated with this measId concerns NR:
4&gt; if the measObject associated with this measId concerns FR1:
5&gt; if the useAutonomousGaps is included in the reportConfig associated with this measId:
6&gt; start timer T321 with the timer value set to 2 seconds for this measId;
6&gt; start timer T321 with the timer value set to 2 seconds for this measId;
4&gt; if the measObject associated with this measId concerns FR2:
5&gt; if the useAutonomousGaps is included in the reportConfig associated with this measId:
6&gt; start timer T321 with the timer value set to 5 seconds for this measId;
6&gt; start timer T321 with the timer value set to 16 seconds for this measId.
2&gt; if the reportType is set to reportSFTD in the reportConfigNR associated with this measId and the drx-SFTD- NeighMeas is included:
3&gt; if the measObject associated with this measId concerns FR1:
4&gt; start timer T322 with the timer value set to 3 seconds for this measId;
3&gt; if the measObject associated with this measId concerns FR2:
4&gt; start timer T322 with the timer value set to 24 seconds for this measId.
5.5.2.4 Measurement object removal
The UE shall:
1&gt; for each measObjectId included in the received measObjectToRemoveList that is part of measObjectList in VarMeasConfig:
2&gt; remove the entry with the matching measObjectId from the measObjectList within the VarMeasConfig;
2&gt; remove all measId associated with this measObjectId from the measIdList within the VarMeasConfig, if any;
2&gt; if a measId is removed from the measIdList:
3&gt; remove the measurement reporting entry for this measId from the VarMeasReportList, if included;
3&gt; stop the periodical reporting timer or timer T321 or timer T322, whichever is running, and reset the associated information (e.g. timeToTrigger) for this measId.
NOTE: The UE does not consider the message as erroneous if the measObjectToRemoveList includes any measObjectId value that is not part of the current UE configuration.
5.5.2.5 Measurement object addition/modification
The UE shall:
1&gt; for each measObjectId included in the received measObjectToAddModList:
2&gt; if an entry with the matching measObjectId exists in the measObjectList within the VarMeasConfig, for this entry:
3&gt; if the received measObject includes the cellsToRemoveList:
4&gt; for each physCellId included in the cellsToRemoveList:
5&gt; remove the entry with the matching physCellId from the cellsToAddModList;
3&gt; if the received measObject includes the cellsToAddModList:
4&gt; for each physCellId value included in the cellsToAddModList:
5&gt; if an entry with the matching physCellId exists in the cellsToAddModList:
6&gt; replace the entry with the value received for this physCellId;
6&gt; add a new entry for the received physCellId to the cellsToAddModList;
3&gt; if the received measObject includes the excludedCellsToRemoveList:
4&gt; for each pci-RangeIndex included in the excludedCellsToRemoveList:
5&gt; remove the entry with the matching pci-RangeIndex from the excludedCellsToAddModList; NOTE 1: For each pci-RangeIndex included in the excludedCellsToRemoveList that concerns overlapping ranges of cells, a cell is removed from the exclude-list of cells only if all PCI ranges containing it are removed.
3&gt; if the received measObject includes the excludedCellsToAddModList:
4&gt; for each pci-RangeIndex included in the excludedCellsToAddModList:
5&gt; if an entry with the matching pci-RangeIndex is included in the excludedCellsToAddModList:
6&gt; replace the entry with the value received for this pci-RangeIndex;
6&gt; add a new entry for the received pci-RangeIndex to the excludedCellsToAddModList;
3&gt; if the received measObject includes the allowedCellsToRemoveList:
4&gt; for each pci-RangeIndex included in the allowedCellsToRemoveList:
5&gt; remove the entry with the matching pci-RangeIndex from the allowedCellsToAddModList; NOTE2: For each pci-RangeIndex included in the allowedCellsToRemoveList that concerns overlapping ranges of cells, a cell is removed from the allow-list of cells only if all PCI ranges containing it are removed.
3&gt; if the received measObject includes the allowedCellsToAddModList:
4&gt; for each pci-RangeIndex included in the allowedCellsToAddModList:
5&gt; if an entry with the matching pci-RangeIndex is included in the allowedCellsToAddModList:
6&gt; replace the entry with the value received for this pci-RangeIndex;
6&gt; add a new entry for the received pci-RangeIndex to the allowedCellsToAddModList
3&gt; for each measId associated with this measObjectId in the measIdList within the VarMeasConfig, if any:
4&gt; remove the measurement reporting entry for this measId from the VarMeasReportList, if included;
4&gt; stop the periodical reporting timer or timer T321 or timer T322, whichever one is running, and reset the associated information (e.g. timeToTrigger) for this measId;
3&gt; if the received measObject includes the tx-PoolMeasToRemoveList:
4&gt; for each transmission resource pool indicated in tx-PoolMeasToRemoveList:
5&gt; remove the entry with the matching identity of the transmission resource pool from the tx- PoolMeasToAddModList;
3&gt; if the received measObject includes the tx-PoolMeasToAddModList:
4&gt; for each transmission resource pool indicated in tx-PoolMeasToAddModList:
5&gt; if an entry with the matching identity of the transmission resource pool exists in the tx- PoolMeasToAddModList:
6&gt; replace the entry with the value received for this transmission resource pool;
6&gt; add a new entry for the received identity of the transmission resource pool to the tx- PoolMeasToAddModList;
3&gt; if the received measObject includes the ssb-PositionQCL-CellsToRemoveList:
4&gt; for each physCellId included in the ssb-PositionQCL-CellsToRemoveList:
5&gt; remove the entry with the matching physCellId from the ssb-PositionQCL-CellsToAddModList;
3&gt; if the received measObject includes the ssb-PositionQCL-CellsToAddModList:
4&gt; for each physCellId included in the ssb-PositionQCL-CellsToAddModList:
5&gt; if an entry with the matching physCellId exists in the ssb-PositionQCL-CellsToAddModList:
6&gt; replace the entry with the value received for this physCellId;
6&gt; add a new entry for the received physCellId to the ssb-PositionQCL-CellsToAddModList;
3&gt; add a new entry for the received measObject to the measObjectList within VarMeasConfig.
5.5.2.6 Reporting configuration removal
The UE shall:
1&gt; for each reportConfigId included in the received reportConfigToRemoveList that is part of the current UE configuration in VarMeasConfig:
2&gt; remove the entry with the matching reportConfigId from the reportConfigList within the VarMeasConfig;
2&gt; remove all measId associated with the reportConfigId from the measIdList within the VarMeasConfig, if any;
2&gt; if a measId is removed from the measIdList:
3&gt; remove the measurement reporting entry for this measId from the VarMeasReportList, if included;
3&gt; stop the periodical reporting timer or timer T321 or timer T322, whichever one is running, and reset the associated information (e.g. timeToTrigger) for this measId.
NOTE: The UE does not consider the message as erroneous if the reportConfigToRemoveList includes any reportConfigId value that is not part of the current UE configuration.
5.5.2.7 Reporting configuration addition/modification
The UE shall:
1&gt; for each reportConfigId included in the received reportConfigToAddModList:
2&gt; if an entry with the matching reportConfigId exists in the reportConfigList within the VarMeasConfig, for this entry:
3&gt; reconfigure the entry with the value received for this reportConfig;
3&gt; for each measId associated with this reportConfigId included in the measIdList within the VarMeasConfig, if any:
4&gt; remove the measurement reporting entry for this measId from the VarMeasReportList, if included;
4&gt; stop the periodical reporting timer or timer T321 or timer T322, whichever one is running, and reset the associated information (e.g. timeToTrigger) for this measId;
3&gt; add a new entry for the received reportConfig to the reportConfigList within the VarMeasConfig.
5.5.2.8 Quantity configuration
The UE shall:
1&gt; for each RAT for which the received quantityConfig includes parameter(s):
2&gt; set the corresponding parameter(s) in quantityConfig within VarMeasConfig to the value of the received quantityConfig parameter(s);
1&gt; for each measId included in the measIdList within VarMeasConfig:
2&gt; remove the measurement reporting entry for this measId from the VarMeasReportList, if included;
2&gt; stop the periodical reporting timer or timer T321 or timer T322, whichever one is running, and reset the associated information (e.g. timeToTrigger) for this measId.
5.5.2.9 Measurement gap configuration
The UE shall:
1&gt; if gapFR1 is set to setup:
2&gt; if an FR1 measurement gap configuration configured by gapFR1 is already setup, release the FR1 measurement gap configuration;
2&gt; setup the FR1 measurement gap configuration indicated by the gapFR1 in accordance with the received gapOffset, i.e., the first subframe of each gap occurs at an SFN and subframe meeting the following condition:
SFN mod T = FLOOR(gapOffset/10); subframe = gapOffset mod 10; with T = MGRP/10 as defined in TS 38.133 ;
2&gt; apply the specified timing advance mgta to the gap occurrences calculated above (i.e. the UE starts the measurement mgta ms before the gap subframe occurrences);
2&gt; associate the FR1 measurement gap with the measGapId indicated by the GapConfig (if present);
1&gt; else if gapFR1 is set to release:
2&gt; release the FR1 measurement gap configuration configured by gapFR1;
1&gt; if gapFR2 is set to setup:
2&gt; if an FR2 measurement gap configuration configured by gapFR2 is already setup, release the FR2 measurement gap configuration;
2&gt; setup the FR2 measurement gap configuration indicated by the gapFR2 in accordance with the received gapOffset, i.e., the first subframe of each gap occurs at an SFN and subframe meeting the following condition:
SFN mod T = FLOOR(gapOffset/10); subframe = gapOffset mod 10; with T = MGRP/10 as defined in TS 38.133 ;
2&gt; apply the specified timing advance mgta to the gap occurrences calculated above (i.e. the UE starts the measurement mgta ms before the gap subframe occurrences);
2&gt; associate the FR2 measurement gap with the measGapId indicated by the GapConfig (if present);
1&gt; else if gapFR2 is set to release:
2&gt; release the FR2 measurement gap configuration configured by gapFR2;
1&gt; if gapUE is set to setup:
2&gt; if a per UE measurement gap configuration configured by gapUE is already setup, release the per UE measurement gap configuration;
2&gt; setup the per UE measurement gap configuration indicated by the gapUE in accordance with the received gapOffset, i.e., the first subframe of each gap occurs at an SFN and subframe meeting the following condition:
SFN mod T = FLOOR(gapOffset/10); subframe = gapOffset mod 10; with T = MGRP/10 as defined in TS 38.133 ;
2&gt; apply the specified timing advance mgta to the gap occurrences calculated above (i.e. the UE starts the measurement mgta ms before the gap subframe occurrences);
2&gt; associate the per UE measurement gap with the measGapId indicated by the GapConfig (if present);
1&gt; else if gapUE is set to release:
2&gt; release the per UE measurement gap configuration configured by gapUE.
1&gt; for each measGapId included in the received gapFR1ToReleaseList:
2&gt; release the FR1 measurement gap configuration associated with the measGapId;
1&gt; for each measGapId included in the received gapFR2ToReleaseList:
2&gt; release the FR2 measurement gap configuration associated with the measGapId;
1&gt; for each measGapId included in the received gapUEToReleaseList:
2&gt; release the per UE measurement gap configuration associated with the measGapId;
1&gt; for each GapConfig received in gapFR1ToAddModList:
2&gt; if an FR1 measurement gap configuration associated with the measGapId indicated by the GapConfig is already setup, release the FR1 measurement gap configuration;
2&gt; setup an FR1 measurement gap configuration indicated by the GapConfig in accordance with the received gapOffset, i.e., the first subframe of each gap occurs at an SFN and subframe meeting the following condition:
SFN mod T = FLOOR(gapOffset/10); subframe = gapOffset mod 10; with T = MGRP/10 as defined in TS 38.133 ;
2&gt; apply the specified timing advance mgta to the gap occurrences calculated above (i.e. the UE starts the measurement mgta ms before the gap subframe occurrences);
2&gt; associate the FR1 measurement gap with the measGapId indicated by the GapConfig;
2&gt; if gapSharing in the GapConfig is present:
3&gt; setup the gap sharing configuration for the FR1 measurement gap in accordance with the received gapSharing as defined in TS 38.133 ;
3&gt; release the gap sharing configuration (if configured) for the FR1 measurement gap;
1&gt; for each GapConfig received in gapFR2ToAddModList:
2&gt; if an FR2 measurement gap configuration associated with the measGapId indicated by the GapConfig is already setup, release the FR2 measurement gap configuration;
2&gt; setup an FR2 measurement gap configuration indicated by the GapConfig in accordance with the received gapOffset, i.e., the first subframe of each gap occurs at an SFN and subframe meeting the following condition:
SFN mod T = FLOOR(gapOffset/10); subframe = gapOffset mod 10; with T = MGRP/10 as defined in TS 38.133 ;
2&gt; apply the specified timing advance mgta to the gap occurrences calculated above (i.e. the UE starts the measurement mgta ms before the gap subframe occurrences);
2&gt; associate the FR2 measurement gap with the measGapId indicated by the GapConfig;
2&gt; if gapSharing in the GapConfig is present:
3&gt; setup the gap sharing configuration for the FR2 measurement gap in accordance with the received gapSharing as defined in TS 38.133 ;
3&gt; release the gap sharing configuration (if configured) for the FR2 measurement gap;
1&gt; for each GapConfig received in gapUEToAddModList:
2&gt; if a per UE measurement gap configuration associated with the measGapId indicated by the GapConfig is already setup, release the per UE measurement gap configuration;
2&gt; setup a per UE measurement gap configuration indicated by the GapConfig in accordance with the received gapOffset, i.e., the first subframe of each gap occurs at an SFN and subframe meeting the following condition:
SFN mod T = FLOOR(gapOffset/10); subframe = gapOffset mod 10; with T = MGRP/10 as defined in TS 38.133 ;
2&gt; apply the specified timing advance mgta to the gap occurrences calculated above (i.e. the UE starts the measurement mgta ms before the gap subframe occurrences);
2&gt; associate the per UE measurement gap with the measGapId indicated by the GapConfig;
2&gt; if gapSharing in the GapConfig is present:
3&gt; setup the gap sharing configuration for the per UE measurement gap in accordance with the received gapSharing as defined in TS 38.133 ;
3&gt; release the gap sharing configuration (if configured) for the per UE measurement gap;
1&gt; for each FR1, FR2, and per UE measurement gap that is setup:
2&gt; if preConfigInd-r17 in the corresponding GapConfig is present:
3&gt; determine whether the measurement gap is activated or not according to TS 38.133 ;
3&gt; consider the measurement gap to be activated; NOTE 1: For FR2 gap configuration with synchronous CA, for the UE in NE-DC or NR-DC, the SFN and subframe of the serving cell indicated by the refServCellIndicator is used in the gap calculation.
Otherwise, the SFN and subframe of a serving cell on FR2 frequency is used in the gap calculation NOTE 2: For FR1 gap or per UE gap configuration, for the UE in NE-DC or NR-DC, the SFN and subframe of the serving cell indicated by the refServCellIndicator in is used in the gap calculation. Otherwise, the SFN and subframe of the PCell is used in the gap calculation.
NOTE 3: For FR2 gap configuration with asynchronous CA, for the UE in NE-DC or NR-DC, the SFN and subframe of the serving cell indicated by the refServCellIndicator and refFR2ServCellAsyncCA is used in the gap calculation. Otherwise, the SFN and subframe of a serving cell on FR2 frequency indicated by the refFR2ServCellAsyncCA is used in the gap calculation
5.5.2.10 Reference signal measurement timing configuration
The UE shall setup the first SS/PBCH block measurement timing configuration (SMTC) in accordance with the received periodicityAndOffset parameter (providing Periodicity and Offset value for the following condition) in the smtc1 configuration. The first subframe of each SMTC occasion occurs at an SFN and subframe of the NR SpCell meeting the following condition:
SFN mod T = (FLOOR (Offset/10)); if the Periodicity is larger than sf5:
subframe = Offset mod 10; else:
subframe = Offset or (Offset +5); with T = CEIL(Periodicity/10).
If smtc2 is present, for cells indicated in the pci-List parameter in smtc2 in the same MeasObjectNR, the UE shall setup an additional SS/PBCH block measurement timing configuration (SMTC) in accordance with the received periodicity parameter in the smtc2 configuration and use the Offset (derived from parameter periodicityAndOffset) and duration parameter from the smtc1 configuration. The first subframe of each SMTC occasion occurs at an SFN and subframe of the NR SpCell meeting the above condition.
If smtc2-LP is present, for cells indicated in the pci-List parameter in smtc2-LP in the same frequency (for intra frequency cell reselection) or different frequency (for inter frequency cell reselection), the UE shall setup an additional SS/PBCH block measurement timing configuration (SMTC) in accordance with the received periodicity parameter in the smtc2-LP configuration and use the Offset (derived from parameter periodicityAndOffset) and duration parameter from the smtc configuration for that frequency. The first subframe of each SMTC occasion occurs at an SFN and subframe of the NR SpCell or serving cell (for cell reselection) meeting the above condition.
If smtc3list is present, for cells indicated in the pci-List parameter in each SSB-MTC3 element of the list in the same MeasObjectNR, the IAB-MT shall setup an additional SS block measurement timing configuration in accordance with the received periodicityAndOffset parameter (using same condition as smtc1 to identify the SFN and the subframe for SMTC occasion) in each SSB-MTC3 configuration and use the duration and ssb-ToMeasure parameters from each SSB-MTC3 configuration.
On the indicated ssbFrequency, the UE shall not consider SS/PBCH block transmission in subframes outside the SMTC occasion for RRM measurements based on SS/PBCH blocks and for RRM measurements based on CSI-RS except for SFTD measurement (see TS 38.133 , clause 9.3.8).
5.5.2.10a RSSI measurement timing configuration
The UE shall setup the RSSI measurement timing configuration (RMTC) in accordance with the received rmtc- Periodicity and, if configured, with rmtc-SubframeOffset i.e. the first symbol of each RMTC occasion occurs at first symbol of an SFN and subframe of the NR SpCell meeting the following condition:
SFN mod T = FLOOR(rmtc-SubframeOffset/10); subframe = rmtc-SubframeOffset mod 10; with T = rmtc-Periodicity/10; On the frequency configured by rmtc-Frequency, the UE shall not consider RSSI measurements outside the configured RMTC occasion which lasts for measDurationSymbols for RSSI and channel occupancy measurements.
The UE derives the RSSI measurement duration from a combination of measDurationSymbols and ref-SCS-CP. At least for RSSI measurement confined within the active DL BWP, the UE performs RSSI measurement using the numerology of the active DL BWP during the derived measurement duration. Otherwise, the numerology used by the UE for measurements is up to UE implementation. If configured, the UE performs RSSI measurements on a bandwidth in accordance with the received rmtc-Bandwidth.
5.5.2.11 Measurement gap sharing configuration
The UE shall:
1&gt; if gapSharingFR1 is set to setup:
2&gt; if an FR1 measurement gap sharing configuration configured by gapSharingFR1 is already setup:
3&gt; release the FR1 measurement gap sharing configuration configured by gapSharingFR1;
2&gt; setup the FR1 measurement gap sharing configuration indicated by the measGapSharingConfig in accordance with the received gapSharingFR1 as defined in TS 38.133 ;
1&gt; else if gapSharingFR1 is set to release:
2&gt; release the FR1 measurement gap sharing configuration configured by gapSharingFR1;
1&gt; if gapSharingFR2 is set to setup:
2&gt; if an FR2 measurement gap sharing configuration configured by gapSharingFR2 is already setup:
3&gt; release the FR2 measurement gap sharing configuration configured by gapSharingFR2;
2&gt; setup the FR2 measurement gap sharing configuration indicated by the measGapSharingConfig in accordance with the received gapSharingFR2 as defined in TS 38.133 ;
1&gt; else if gapSharingFR2 is set to release:
2&gt; release the FR2 measurement gap sharing configuration configured by gapSharingFR2.
1&gt; if gapSharingUE is set to setup:
2&gt; if a per UE measurement gap sharing configuration configured by gapSharingUE is already setup:
3&gt; release the per UE measurement gap sharing configuration configured by gapSharingUE;
2&gt; setup the per UE measurement gap sharing configuration indicated by the measGapSharingConfig in accordance with the received gapSharingUE as defined in TS 38.133 ;
1&gt; else if gapSharingUE is set to release:
2&gt; release the per UE measurement gap sharing configuration configured by gapSharingUE.
5.5.3 Performing measurements
5.5.3.1 General
An RRC_CONNECTED UE shall derive cell measurement results by measuring one or multiple beams associated per cell as configured by the network, as described in 5.5.3.3. For all cell measurement results, except for RSSI, and CLI measurement results in RRC_CONNECTED, the UE applies the layer 3 filtering as specified in 5.5.3.2, before using the measured results for evaluation of reporting criteria, measurement reporting or the criteria to trigger conditional reconfiguration execution. For cell measurements, the network can configure RSRP, RSRQ, SINR, RSCP or EcN0 as trigger quantity. For CLI measurements, the network can configure SRS-RSRP or CLI-RSSI as trigger quantity. For cell and beam measurements, reporting quantities can be any combination of quantities (i.e. only RSRP; only RSRQ; only SINR; RSRP and RSRQ; RSRP and SINR; RSRQ and SINR; RSRP, RSRQ and SINR; only RSCP; only EcN0; RSCP and EcN0), irrespective of the trigger quantity, and for CLI measurements, reporting quantities can be either SRS-RSRP or CLI-RSSI. For conditional reconfiguration execution, the network can configure up to 2 quantities, both using same RS type. The UE does not apply the layer 3 filtering as specified in 5.5.3.2 to derive the CBR measurements. The UE does not apply the layer 3 filtering as specified in 5.5.3.2 to derive the Rx-Tx time difference measurements.
The network may also configure the UE to report measurement information per beam (which can either be measurement results per beam with respective beam identifier(s) or only beam identifier(s)), derived as described in 5.5.3.3a. If beam measurement information is configured to be included in measurement reports, the UE applies the layer 3 beam filtering as specified in 5.5.3.2. On the other hand, the exact L1 filtering of beam measurements used to derive cell measurement results is implementation dependent.
The UE shall:
1&gt; whenever the UE has a measConfig, perform RSRP and RSRQ measurements for each serving cell for which servingCellMO is configured as follows:
2&gt; if the reportConfig associated with at least one measId included in the measIdList within VarMeasConfig contains an rsType set to ssb and ssb-ConfigMobility is configured in the measObject indicated by the servingCellMO:
3&gt; if the reportConfig associated with at least one measId included in the measIdList within VarMeasConfig contains a reportQuantityRS-Indexes and maxNrofRS-IndexesToReport and contains an rsType set to ssb:
4&gt; derive layer 3 filtered RSRP and RSRQ per beam for the serving cell based on SS/PBCH block, as described in 5.5.3.3a;
3&gt; derive serving cell measurement results based on SS/PBCH block, as described in 5.5.3.3;
2&gt; if the reportConfig associated with at least one measId included in the measIdList within VarMeasConfig contains an rsType set to csi-rs and CSI-RS-ResourceConfigMobility is configured in the measObject indicated by the servingCellMO:
3&gt; if the reportConfig associated with at least one measId included in the measIdList within VarMeasConfig contains a reportQuantityRS-Indexes and maxNrofRS-IndexesToReport and contains an rsType set to csi- rs:
4&gt; derive layer 3 filtered RSRP and RSRQ per beam for the serving cell based on CSI-RS, as described in 5.5.3.3a;
3&gt; derive serving cell measurement results based on CSI-RS, as described in 5.5.3.3;
1&gt; for each serving cell for which servingCellMO is configured, if the reportConfig associated with at least one measId included in the measIdList within VarMeasConfig contains SINR as trigger quantity and/or reporting quantity:
2&gt; if the reportConfig contains rsType set to ssb and ssb-ConfigMobility is configured in the servingCellMO:
3&gt; if the reportConfigcontains a reportQuantityRS-Indexes and maxNrofRS-IndexesToReport:
4&gt; derive layer 3 filtered SINR per beam for the serving cell based on SS/PBCH block, as described in
3&gt; derive serving cell SINR based on SS/PBCH block, as described in 5.5.3.3;
2&gt; if the reportConfig contains rsType set to csi-rs and CSI-RS-ResourceConfigMobility is configured in the servingCellMO:
3&gt; if the reportConfigcontains a reportQuantityRS-Indexes and maxNrofRS-IndexesToReport:
4&gt; derive layer 3 filtered SINR per beam for the serving cell based on CSI-RS, as described in 5.5.3.3a;
3&gt; derive serving cell SINR based on CSI-RS, as described in 5.5.3.3;
1&gt; for each measId included in the measIdList within VarMeasConfig:
2&gt; if the reportType for the associated reportConfig is set to reportCGI and timer T321 is running:
3&gt; if useAutonomousGaps is configured for the associated reportConfig:
4&gt; perform the corresponding measurements on the frequency and RAT indicated in the associated measObject using autonomous gaps as necessary;
4&gt; perform the corresponding measurements on the frequency and RAT indicated in the associated measObject using available idle periods;
3&gt; if the cell indicated by reportCGI field for the associated measObject is an NR cell and that indicated cell is broadcasting SIB1 (see TS 38.213 , clause 13):
4&gt; try to acquire SIB1 in the concerned cell;
3&gt; if the cell indicated by reportCGI field is an E-UTRA cell:
4&gt; try to acquire SystemInformationBlockType1 in the concerned cell;
2&gt; if the ul-DelayValueConfig is configured for the associated reportConfig:
3&gt; ignore the measObject;
3&gt; for each of the configured DRBs, configure the PDCP layer to perform corresponding average UL PDCP packet delay measurement per DRB;
2&gt; if the ul-ExcessDelayConfig is configured for the associated reportConfig:
3&gt; ignore the measObject;
3&gt; for each of the configured DRBs, configure the PDCP layer to perform corresponding UL PDCP Excess
Packet Delay delay measurement according to the configured threshold per DRB;
2&gt; if the reportType for the associated reportConfig is periodical, eventTriggered or condTriggerConfig:
3&gt; if a measurement gap configuration is setup, or
3&gt; if the UE does not require measurement gaps to perform the concerned measurements:
4&gt; if s-MeasureConfig is not configured, or
4&gt; if s-MeasureConfig is set to ssb-RSRP and the NR SpCell RSRP based on SS/PBCH block, after layer
3 filtering, is lower than ssb-RSRP, or
4&gt; if s-MeasureConfig is set to csi-RSRP and the NR SpCell RSRP based on CSI-RS, after layer 3 filtering, is lower than csi-RSRP:
5&gt; if the measObject is associated to NR and the rsType is set to csi-rs:
6&gt; if reportQuantityRS-Indexes and maxNrofRS-IndexesToReport for the associated reportConfig are configured:
7&gt; derive layer 3 filtered beam measurements only based on CSI-RS for each measurement quantity indicated in reportQuantityRS-Indexes, as described in 5.5.3.3a;
6&gt; derive cell measurement results based on CSI-RS for the trigger quantity and each measurement quantity indicated in reportQuantityCell using parameters from the associated measObject, as described in 5.5.3.3;
5&gt; if the measObject is associated to NR and the rsType is set to ssb:
6&gt; if reportQuantityRS-Indexes and maxNrofRS-IndexesToReport for the associated reportConfig are configured:
7&gt; derive layer 3 beam measurements only based on SS/PBCH block for each measurement quantity indicated in reportQuantityRS-Indexes, as described in 5.5.3.3a;
6&gt; derive cell measurement results based on SS/PBCH block for the trigger quantity and each measurement quantity indicated in reportQuantityCell using parameters from the associated measObject, as described in 5.5.3.3;
5&gt; if the measObject is associated to E-UTRA:
6&gt; perform the corresponding measurements associated to neighbouring cells on the frequencies indicated in the concerned measObject, as described in 5.5.3.2;
5&gt; if the measObject is associated to UTRA-FDD:
6&gt; perform the corresponding measurements associated to neighbouring cells on the frequencies indicated in the concerned measObject, as described in 5.5.3.2;
5&gt; if the measObject is associated to L2 U2N Relay UE:
6&gt; perform the corresponding measurements associated to candidate Relay UEs on the frequencies indicated in the concerned measObject, as described in 5.5.3.4;
4&gt; if the measRSSI-ReportConfig is configured in the associated reportConfig:
5&gt; perform the RSSI and channel occupancy measurements on the frequency indicated in the associated measObject;
2&gt; if the reportType for the associated reportConfig is set to reportSFTD and the numberOfReportsSent as defined within the VarMeasReportList for this measId is less than one:
3&gt; if the reportSFTD-Meas is set to true:
4&gt; if the measObject is associated to E-UTRA:
5&gt; perform SFTD measurements between the PCell and the E-UTRA PSCell;
5&gt; if the reportRSRP is set to true;
6&gt; perform RSRP measurements for the E-UTRA PSCell;
4&gt; else if the measObject is associated to NR:
5&gt; perform SFTD measurements between the PCell and the NR PSCell;
5&gt; if the reportRSRP is set to true;
6&gt; perform RSRP measurements for the NR PSCell based on SSB;
3&gt; else if the reportSFTD-NeighMeas is included:
4&gt; if the measObject is associated to NR:
5&gt; if the drx-SFTD-NeighMeas is included:
6&gt; perform SFTD measurements between the PCell and the NR neighbouring cell(s) detected based on parameters in the associated measObject using available idle periods;
6&gt; perform SFTD measurements between the PCell and the NR neighbouring cell(s) detected based on parameters in the associated measObject;
5&gt; if the reportRSRP is set to true:
6&gt; perform RSRP measurements based on SSB for the NR neighbouring cell(s) detected based on parameters in the associated measObject;
2&gt; if the reportType for the associated reportConfig is cli-Periodical or cli-EventTriggered:
3&gt; perform the corresponding measurements associated to CLI measurement resources indicated in the concerned measObjectCLI;
2&gt; perform the evaluation of reporting criteria as specified in 5.5.4, except if reportConfig is condTriggerConfig.
NOTE 1: The evaluation of conditional reconfiguration execution criteria is specified in 5.3.5.13.
The UE capable of Rx-Tx time difference measurement when configured with measObjectRxTxDiff shall:
1&gt; perform the corresponding Rx-Tx time difference measurements associated with downlink reference signals indicated in the concerned measObjectRxTxDiff.
The UE capable of CBR measurement when configured to transmit NR sidelink communication shall:
1&gt; If the frequency used for NR sidelink communication is included in sl-FreqInfoToAddModList in sl- ConfigDedicatedNR within RRCReconfiguration message or included in sl-ConfigCommonNR within SIB12:
2&gt; if the UE is in RRC_IDLE or in RRC_INACTIVE:
3&gt; if the cell chosen for NR sidelink communication provides SIB12 which includes sl- TxPoolSelectedNormal or sl-TxPoolExceptional for the concerned frequency:
4&gt; perform CBR measurement on pools in sl-TxPoolSelectedNormal and sl-TxPoolExceptional for the concerned frequency in SIB12;
2&gt; if the UE is in RRC_CONNECTED:
3&gt; if tx-PoolMeasToAddModList is included in VarMeasConfig:
4&gt; perform CBR measurements on each transmission resource pool indicated in the tx- PoolMeasToAddModList;
3&gt; if sl-TxPoolSelectedNormal, sl-TxPoolScheduling or sl-TxPoolExceptional is included in sl- ConfigDedicatedNR for the concerned frequency within RRCReconfiguration:
4&gt; perform CBR measurement on pool(s) in sl-TxPoolSelectedNormal, sl-TxPoolScheduling or sl- TxPoolExceptional if included in sl-ConfigDedicatedNR for the concerned frequency within RRCReconfiguration;
3&gt; else if the cell chosen for NR sidelink communication provides SIB12 which includes sl- TxPoolSelectedNormal or sl-TxPoolExceptional for the concerned frequency:
4&gt; perform CBR measurement on pool(s) in sl-TxPoolSelectedNormal and sl-TxPoolExceptional for the concerned frequency in SIB12;
2&gt; perform CBR measurement on pool(s) in sl-TxPoolSelectedNormal and sl-TxPoolExceptional in SidelinkPreconfigNR for the concerned frequency.
NOTE 2: In case the configurations for NR sidelink communication and CBR measurement are acquired via the E- UTRA, configurations for NR sidelink communication in SIB12, sl-ConfigDedicatedNR within RRCReconfiguration used in this clause are provided by the configurations in SystemInformationBlockType28, sl-ConfigDedicatedForNR within RRCConnectionReconfiguration as specified in TS 36.331, respectively.
NOTE 3: If a UE that is configured by upper layers to transmit V2X sidelink communication is configured by NR with transmission resource pool(s) and the measurement objects concerning V2X sidelink communication (i.e. by sl-ConfigDedicatedEUTRA-Info), it shall perform CBR measurement as specified in clause 5.5.3 of TS 36.331 , based on the transmission resource pool(s) and the measurement object(s) concerning V2X sidelink communication configured by NR.
NOTE 4: For V2X sidelink communication, each of the CBR measurement results is associated with a resource pool, as indicated by the poolReportId (see TS 36.331 ), that refers to a pool as included in sl- ConfigDedicatedEUTRA-Info or SIB13.
Editors Note: FFS to specify that the UE ignores measId(s) that were not indicated in the condExecutionCond/triggerCondition.
5.5.3.2 Layer 3 filtering
The UE shall:
1&gt; for each cell measurement quantity, each beam measurement quantity, each sidelink measurement quantity as needed in clause 5.8.10, for each CLI measurement quantity that the UE performs measurements according to
5.5.3.1, and for each candidate L2 U2N Relay UE measurement quantity according to 5.5.3.4:
2&gt; filter the measured result, before using for evaluation of reporting criteria or for measurement reporting, by the following formula:
n n-1 n
where
M is the latest received measurement result from the physical layer;
n
F is the updated filtered measurement result, that is used for evaluation of reporting criteria or for
n measurement reporting; F is the old filtered measurement result, where F is set to M when the first measurement result from n-1 0 1 the physical layer is received; and for MeasObjectNR, a = 1/2(ki/4), where k is the filterCoefficient for
i the corresponding measurement quantity of the i:th QuantityConfigNR in quantityConfigNR-List, and i is indicated by quantityConfigIndex in MeasObjectNR; for other measurements, a = 1/2(k/4), where k is the filterCoefficient for the corresponding measurement quantity received by the quantityConfig; for UTRA-FDD, a = 1/2(k/4), where k is the filterCoefficient for the corresponding measurement quantity received by quantityConfigUTRA-FDD in the QuantityConfig;
2&gt; adapt the filter such that the time characteristics of the filter are preserved at different input rates, observing that the filterCoefficient k assumes a sample rate equal to X ms; The value of X is equivalent to one intra- frequency L1 measurement period as defined in TS 38.133 assuming non-DRX operation, and depends on frequency range.
NOTE 1: If k is set to 0, no layer 3 filtering is applicable.
NOTE 2: The filtering is performed in the same domain as used for evaluation of reporting criteria or for measurement reporting, i.e., logarithmic filtering for logarithmic measurements.
NOTE 3: The filter input rate is implementation dependent, to fulfil the performance requirements set in TS 38.133
. For further details about the physical layer measurements, see TS 38.133 .
NOTE 4: For CLI-RSSI measurement, it is up to UE implementation whether to reset filtering upon BWP switch.
5.5.3.3 Derivation of cell measurement results
The network may configure the UE in RRC_CONNECTED to derive RSRP, RSRQ and SINR measurement results per cell associated to NR measurement objects based on parameters configured in the measObject (e.g. maximum number of beams to be averaged and beam consolidation thresholds) and in the reportConfig (rsType to be measured, SS/PBCH block or CSI-RS).
The network may configure the UE in RRC_IDLE or in RRC_INACTIVE to derive RSRP and RSRQ measurement results per cell associated to NR carriers based on parameters configured in measIdleCarrierListNR within VarMeasIdleConfig for measurements performed according to 5.7.8.2a.
The UE shall:
1&gt; for each cell measurement quantity to be derived based on SS/PBCH block:
2&gt; if nrofSS-BlocksToAverage is not configured in the associated measObject in RRC_CONNECTED or in the associated entry in measIdleCarrierListNR within VarMeasIdleConfig in RRC_IDLE/RRC_INACTIVE; or
2&gt; if absThreshSS-BlocksConsolidation is not configured in the associated measObject in RRC_CONNECTED or in the associated entry in measIdleCarrierListNR within VarMeasIdleConfig in RRC_IDLE/RRC_INACTIVE; or
2&gt; if the highest beam measurement quantity value is below or equal to absThreshSS-BlocksConsolidation:
3&gt; derive each cell measurement quantity based on SS/PBCH block as the highest beam measurement quantity value, where each beam measurement quantity is described in TS 38.215 ;
3&gt; derive each cell measurement quantity based on SS/PBCH block as the linear power scale average of the highest beam measurement quantity values above absThreshSS-BlocksConsolidation where the total number of averaged beams shall not exceed nrofSS-BlocksToAverage, and where each beam measurement quantity is described in TS 38.215 ;
2&gt; if in RRC_CONNECTED, apply layer 3 cell filtering as described in 5.5.3.2;
1&gt; for each cell measurement quantity to be derived based on CSI-RS:
2&gt; consider a CSI-RS resource to be applicable for deriving cell measurements when the concerned CSI-RS resource is included in the csi-rs-CellMobility including the physCellId of the cell in theCSI-RS- ResourceConfigMobility in the associated measObject;
2&gt; if nrofCSI-RS-ResourcesToAverage in the associated measObject is not configured; or
2&gt; if absThreshCSI-RS-Consolidation in the associated measObject is not configured; or
2&gt; if the highest beam measurement quantity value is below or equal to absThreshCSI-RS-Consolidation:
3&gt; derive each cell measurement quantity based on applicable CSI-RS resources for the cell as the highest beam measurement quantity value, where each beam measurement quantity is described in TS 38.215 ;
3&gt; derive each cell measurement quantity based on CSI-RS as the linear power scale average of the highest beam measurement quantity values above absThreshCSI-RS-Consolidation where the total number of averaged beams shall not exceed nrofCSI-RS-ResourcesToAverage;
2&gt; apply layer 3 cell filtering as described in 5.5.3.2.
5.5.3.3a Derivation of layer 3 beam filtered measurement
The UE shall:
1&gt; for each layer 3 beam filtered measurement quantity to be derived based on SS/PBCH block;
2&gt; derive each configured beam measurement quantity based on SS/PBCH block as described in TS 38.215, and apply layer 3 beam filtering as described in 5.5.3.2;
1&gt; for each layer 3 beam filtered measurement quantity to be derived based on CSI-RS;
2&gt; derive each configured beam measurement quantity based on CSI-RS as described in TS 38.215 , and apply layer 3 beam filtering as described in 5.5.3.2.
5.5.3.4 Derivation of L2 U2N Relay UE measurement results
A UE may be configured by network to derive NR sidelink measurement results of serving L2 Relay UE or candidate L2 U2N Relay UEs associated to the measurement objects configured in the measObjectRelay.
The UE shall:
1&gt; for each L2 U2N Relay UE measurement quantity to be derived:
2&gt; derive the corresponding measurement quantity based on DMRS as described in TS 38.215 of the L2 U2N Relay UE associated to the NR sidelink frequency indicated in the concerned measObjectRelay;
2&gt; apply layer 3 filtering as described in 5.5.3.2;
5.5.4 Measurement report triggering
5.5.4.1 General
If AS security has been activated successfully, the UE shall:
1&gt; for each measId included in the measIdList within VarMeasConfig:
2&gt; if the corresponding reportConfig includes a reportType set to eventTriggered or periodical:
3&gt; if the corresponding measObject concerns NR:
4&gt; if the corresponding reportConfig includes measRSSI-ReportConfig:
5&gt; consider the resource indicated by the rmtc-Config on the associated frequency to be applicable;
4&gt; if the eventA1 or eventA2 is configured in the corresponding reportConfig:
5&gt; consider only the serving cell to be applicable;
4&gt; if the eventA3 or eventA5 is configured in the corresponding reportConfig:
5&gt; if a serving cell is associated with a measObjectNR and neighbours are associated with another measObjectNR, consider any serving cell associated with the other measObjectNR to be a neighbouring cell as well;
4&gt; if corresponding reportConfig includes reportType set to periodical; or
4&gt; for measurement events other than eventA1 or eventA2:
5&gt; if useAllowedCellList is set to true:
6&gt; consider any neighbouring cell detected based on parameters in the associated measObjectNR to be applicable when the concerned cell is included in the allowedCellsToAddModList defined within the VarMeasConfig for this measId;
6&gt; consider any neighbouring cell detected based on parameters in the associated measObjectNR to be applicable when the concerned cell is not included in the excludedCellsToAddModList defined within the VarMeasConfig for this measId;
3&gt; else if the corresponding measObject concerns E-UTRA:
4&gt; if eventB1 or eventB2 is configured in the corresponding reportConfig:
5&gt; consider a serving cell, if any, on the associated E-UTRA frequency as neighbour cell;
4&gt; consider any neighbouring cell detected on the associated frequency to be applicable when the concerned cell is not included in the excludedCellsToAddModListEUTRAN defined within the VarMeasConfig for this measId;
3&gt; else if the corresponding measObject concerns UTRA-FDD:
4&gt; if eventB1-UTRA-FDD or eventB2-UTRA-FDD is configured in the corresponding reportConfig; or
4&gt; if corresponding reportConfig includes reportType set to periodical:
5&gt; consider a neighbouring cell on the associated frequency to be applicable when the concerned cell is included in the cellsToAddModList defined within the VarMeasConfig for this measId;
3&gt; else if the corresponding measObject concerns L2 U2N Relay UE:
4&gt; if eventY1-Relay is configured in the corresponding reportConfig; or
4&gt; if corresponding reportConfig includes reportType set to periodical:
5&gt; consider any L2 U2N Relay UE detected on the associated frequency to be applicable for this measId;
2&gt; else if the corresponding reportConfig includes a reportType set to reportCGI:
3&gt; consider the cell detected on the associated measObject which has a physical cell identity matching the value of the cellForWhichToReportCGI included in the corresponding reportConfig within the VarMeasConfig to be applicable;
2&gt; else if the corresponding reportConfig includes a reportType set to reportSFTD:
3&gt; if the corresponding measObject concerns NR:
4&gt; if the reportSFTD-Meas is set to true:
5&gt; consider the NR PSCell to be applicable;
4&gt; else if the reportSFTD-NeighMeas is included:
5&gt; if cellsForWhichToReportSFTD is configured in the corresponding reportConfig:
6&gt; consider any NR neighbouring cell detected on the associated measObjectNR which has a physical cell identity that is included in the cellsForWhichToReportSFTD to be applicable;
6&gt; consider up to 3 strongest NR neighbouring cells detected based on parameters in the associated measObjectNR to be applicable when the concerned cells are not included in the excludedCellsToAddModList defined within the VarMeasConfig for this measId;
3&gt; else if the corresponding measObject concerns E-UTRA:
4&gt; if the reportSFTD-Meas is set to true:
5&gt; consider the E-UTRA PSCell to be applicable;
2&gt; else if the corresponding reportConfig includes a reportType set to cli-Periodical or cli-EventTriggered:
3&gt; consider all CLI measurement resources included in the corresponding measObject to be applicable;
2&gt; else if the corresponding reportConfig includes a reportType set to rxTxPeriodical:
3&gt; consider all Rx-Tx time difference measurement resources included in the corresponding measObject to be applicable;
2&gt; if the corresponding reportConfig concerns the reporting for NR sidelink communication (i.e.
3&gt; consider the transmission resource pools indicated by the tx-PoolMeasToAddModList defined within the VarMeasConfig for this measId to be applicable;
2&gt; if the reportType is set to eventTriggered and if the entry condition applicable for this event, i.e. the event corresponding with the eventId of the corresponding reportConfig within VarMeasConfig, is fulfilled for one or more applicable cells for all measurements after layer 3 filtering taken during timeToTrigger defined for this event within the VarMeasConfig, while the VarMeasReportList does not include a measurement reporting entry for this measId (a first cell triggers the event):
3&gt; include a measurement reporting entry within the VarMeasReportList for this measId;
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; include the concerned cell(s) in the cellsTriggeredList defined within the VarMeasReportList for this measId;
3&gt; if useT312 is set to true in reportConfig for this event:
4&gt; if T310 for the corresponding SpCell is running; and
4&gt; if T312 is not running for corresponding SpCell:
5&gt; start timer T312 for the corresponding SpCell with the value of T312 configured in the corresponding measObjectNR;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
2&gt; else if the reportType is set to eventTriggered and if the entry condition applicable for this event, i.e. the event corresponding with the eventId of the corresponding reportConfig within VarMeasConfig, is fulfilled for one or more applicable cells not included in the cellsTriggeredList for all measurements after layer 3 filtering taken during timeToTrigger defined for this event within the VarMeasConfig (a subsequent cell triggers the event):
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; include the concerned cell(s) in the cellsTriggeredList defined within the VarMeasReportList for this measId;
3&gt; if useT312 is set to true in reportConfig for this event:
4&gt; if T310 for the corresponding SpCell is running; and
4&gt; if T312 is not running for corresponding SpCell:
5&gt; start timer T312 for the corresponding SpCell with the value of T312 configured in the corresponding measObjectNR;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
2&gt; else if the reportType is set to eventTriggered and if the leaving condition applicable for this event is fulfilled for one or more of the cells included in the cellsTriggeredList defined within the VarMeasReportList for this measId for all measurements after layer 3 filtering taken during timeToTrigger defined within the VarMeasConfig for this event:
3&gt; remove the concerned cell(s) in the cellsTriggeredList defined within the VarMeasReportList for this measId;
3&gt; if reportOnLeave is set to true for the corresponding reporting configuration:
4&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
3&gt; if the cellsTriggeredList defined within the VarMeasReportList for this measId is empty:
4&gt; remove the measurement reporting entry within the VarMeasReportList for this measId;
4&gt; stop the periodical reporting timer for this measId, if running;
2&gt; if the reportType is set to eventTriggered and if the entry condition applicable for this event, i.e. the event corresponding with the eventId of the corresponding reportConfig within VarMeasConfig, is fulfilled for one or more applicable L2 U2N Relay UEs for all measurements after layer 3 filtering taken during timeToTrigger defined for this event within the VarMeasConfig, while the VarMeasReportList does not include a measurement reporting entry for this measId (a first L2 U2N Relay UE triggers the event):
3&gt; include a measurement reporting entry within the VarMeasReportList for this measId;
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; include the concerned L2 U2N Relay UE(s) in the relaysTriggeredList defined within the VarMeasReportList for this measId;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
2&gt; else if the reportType is set to eventTriggered and if the entry condition applicable for this event, i.e. the event corresponding with the eventId of the corresponding reportConfig within VarMeasConfig, is fulfilled for one or more applicable L2 U2N Relay UEs not included in the relaysTriggeredList for all measurements after layer 3 filtering taken during timeToTrigger defined for this event within the VarMeasConfig (a subsequent L2 U2N Relay UE triggers the event):
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; include the concerned L2 U2N Relay UE(s) in the relaysTriggeredList defined within the VarMeasReportList for this measId;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
2&gt; else if the reportType is set to eventTriggered and if the leaving condition applicable for this event is fulfilled for one or more of the L2 U2N Relay UEs included in the relaysTriggeredList defined within the VarMeasReportList for this measId for all measurements after layer 3 filtering taken during timeToTrigger defined within the VarMeasConfig for this event:
3&gt; remove the concerned L2 U2N Relay UE(s) in the relaysTriggeredList defined within the VarMeasReportList for this measId;
3&gt; if reportOnLeave is set to true for the corresponding reporting configuration:
4&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
3&gt; if the relaysTriggeredList defined within the VarMeasReportList for this measId is empty:
4&gt; remove the measurement reporting entry within the VarMeasReportList for this measId;
4&gt; stop the periodical reporting timer for this measId, if running;
2&gt; else if the reportType is set to eventTriggered and if the entry condition applicable for this event, i.e. the event corresponding with the eventId of the corresponding reportConfig within VarMeasConfig, is fulfilled for one or more applicable transmission resource pools for all measurements taken during timeToTrigger defined for this event within the VarMeasConfig, while the VarMeasReportList does not include an measurement reporting entry for this measId (a first transmission resource pool triggers the event):
3&gt; include a measurement reporting entry within the VarMeasReportList for this measId;
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; include the concerned transmission resource pool(s) in the poolsTriggeredList defined within the VarMeasReportList for this measId;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
2&gt; else if the reportType is set to eventTriggered and if the entry condition applicable for this event, i.e. the event corresponding with the eventId of the corresponding reportConfig within VarMeasConfig, is fulfilled for one or more applicable transmission resource pools not included in the poolsTriggeredList for all measurements taken during timeToTrigger defined for this event within the VarMeasConfig (a subsequent transmission resource pool triggers the event):
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; include the concerned transmission resource pool(s) in the poolsTriggeredList defined within the VarMeasReportList for this measId;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
2&gt; else if the reportType is set to eventTriggered and if the leaving condition applicable for this event is fulfilled for one or more applicable transmission resource pools included in the poolsTriggeredList defined within the VarMeasReportList for this measId for all measurements taken during timeToTrigger defined within the VarMeasConfig for this event:
3&gt; remove the concerned transmission resource pool(s) in the poolsTriggeredList defined within the VarMeasReportList for this measId;
3&gt; if the poolsTriggeredList defined within the VarMeasReportList for this measId is empty:
4&gt; remove the measurement reporting entry within the VarMeasReportList for this measId;
4&gt; stop the periodical reporting timer for this measId, if running
2&gt; else if the reportType is set to eventTriggered and if the eventId is set to eventD1 and if the entering condition applicable for this event, i.e. the event corresponding with the eventId of the corresponding reportConfig within VarMeasConfig, is fulfilled during timeToTrigger defined within the VarMeasConfig for this event:
3&gt; include a measurement reporting entry within the VarMeasReportList for this measId;
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5; NOTE 1: Void.
2&gt; if reportType is set to periodical and if a (first) measurement result is available:
3&gt; include a measurement reporting entry within the VarMeasReportList for this measId;
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; if the corresponding reportConfig includes measRSSI-ReportConfig:
4&gt; initiate the measurement reporting procedure as specified in 5.5.5 immediately when RSSI sample values are reported by the physical layer after the first L1 measurement duration;
3&gt; else if the corresponding reportConfig includes the ul-DelayValueConfig:
4&gt; initiate the measurement reporting procedure, as specified in 5.5.5, immediately after a first measurement result is provided from lower layers of the associated DRB identity;
3&gt; else if the corresponding reportConfig includes the ul-ExcessDelayConfig:
4&gt; initiate the measurement reporting procedure, as specified in 5.5.5, immediately after a first measurement result is provided from lower layers of the associated DRB identity(ies) according to the configured threshold per DRB identity(ies);
3&gt; else if the reportAmount exceeds 1:
4&gt; initiate the measurement reporting procedure, as specified in 5.5.5, immediately after the quantity to be reported becomes available for the NR SpCell or for the serving L2 U2N Relay UE (if the UE is a L2 U2N Remote UE);
3&gt; else (i.e. the reportAmount is equal to 1):
4&gt; initiate the measurement reporting procedure, as specified in 5.5.5, immediately after the quantity to be reported becomes available for the NR SpCell and for the strongest cell among the applicable cells, or for the NR SpCell and for the strongest L2 U2N Relay UEs among the applicable L2 U2N Relay UEs; or initiate the measurement reporting procedure, as specified in 5.5.5, immediately after the quantity to be reported becomes available for the serving L2 U2N Relay UE and for the strongest cell among the applicable cells (if the UE is a L2 U2N Remote UE);
2&gt; if, in case the corresponding reportConfig concerns the reporting for NR sidelink communication, reportType is set to periodical and if a (first) measurement result is available:
3&gt; include a measurement reporting entry within the VarMeasReportList for this measId;
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5, immediately after the quantity to be reported becomes available for the NR SpCell and CBR measurement results become available;
2&gt; if the reportType is set to cli-EventTriggered and if the entry condition applicable for this event, i.e. the event corresponding with the eventId of the corresponding reportConfig within VarMeasConfig, is fulfilled for one or more applicable CLI measurement resources for all measurements after layer 3 filtering taken during timeToTrigger defined for this event within the VarMeasConfig, while the VarMeasReportList does not include a measurement reporting entry for this measId (a first CLI measurement resource triggers the event):
3&gt; include a measurement reporting entry within the VarMeasReportList for this measId;
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; include the concerned CLI measurement resource(s) in the cli-TriggeredList defined within the VarMeasReportList for this measId;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
2&gt; else if the reportType is set to cli-EventTriggered and if the entry condition applicable for this event, i.e. the event corresponding with the eventId of the corresponding reportConfig within VarMeasConfig, is fulfilled for one or more CLI measurement resources not included in the cli-TriggeredList for all measurements after layer 3 filtering taken during timeToTrigger defined for this event within the VarMeasConfig (a subsequent CLI measurement resource triggers the event):
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; include the concerned CLI measurement resource(s) in the cli-TriggeredList defined within the VarMeasReportList for this measId;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
2&gt; else if the reportType is set to cli-EventTriggered and if the leaving condition applicable for this event is fulfilled for one or more of the CLI measurement resources included in the cli-TriggeredList defined within the VarMeasReportList for this measId for all measurements after layer 3 filtering taken during timeToTrigger defined within the VarMeasConfig for this event:
3&gt; remove the concerned CLI measurement resource(s) in the cli-TriggeredList defined within the VarMeasReportList for this measId;
3&gt; if reportOnLeave is set to true for the corresponding reporting configuration:
4&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
3&gt; if the cli-TriggeredList defined within the VarMeasReportList for this measId is empty:
4&gt; remove the measurement reporting entry within the VarMeasReportList for this measId;
4&gt; stop the periodical reporting timer for this measId, if running;
2&gt; if reportType is set to cli-Periodical and if a (first) measurement result is available:
3&gt; include a measurement reporting entry within the VarMeasReportList for this measId;
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5, immediately after the quantity to be reported becomes available for at least one CLI measurement resource;
2&gt; if reportType is set to rxTxPeriodical and if a (first) measurement result is available:
3&gt; include a measurement reporting entry within the VarMeasReportList for this measId;
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
2&gt; upon expiry of the periodical reporting timer for this measId:
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5.
2&gt; if the corresponding reportConfig includes a reportType is set to reportSFTD:
3&gt; if the corresponding measObject concerns NR:
4&gt; if the drx-SFTD-NeighMeas is included:
5&gt; if the quantity to be reported becomes available for each requested pair of PCell and NR cell:
6&gt; stop timer T322;
6&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
4&gt; else
5&gt; initiate the measurement reporting procedure, as specified in 5.5.5, immediately after the quantity to be reported becomes available for each requested pair of PCell and NR cell or the maximal measurement reporting delay as specified in TS 38.133 ;
3&gt; else if the corresponding measObject concerns E-UTRA:
4&gt; initiate the measurement reporting procedure, as specified in 5.5.5, immediately after the quantity to be reported becomes available for the pair of PCell and E-UTRA PSCell or the maximal measurement reporting delay as specified in TS 38.133 ;
2&gt; if reportType is set to reportCGI:
3&gt; if the UE acquired the SIB1 or SystemInformationBlockType1 for the requested cell; or
3&gt; if the UE detects that the requested NR cell is not transmitting SIB1 (see TS 38.213 , clause 13):
4&gt; stop timer T321;
4&gt; include a measurement reporting entry within the VarMeasReportList for this measId;
4&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
4&gt; initiate the measurement reporting procedure, as specified in 5.5.5;
2&gt; upon the expiry of T321 for this measId:
3&gt; include a measurement reporting entry within the VarMeasReportList for this measId;
3&gt; set the numberOfReportsSent defined within the VarMeasReportList for this measId to 0;
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5.
2&gt; upon the expiry of T322 for this measId:
3&gt; initiate the measurement reporting procedure, as specified in 5.5.5.
5.5.4.2 Event A1 (Serving becomes better than threshold)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition A1-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition A1-2, as specified below, is fulfilled;
1&gt; for this measurement, consider the NR serving cell corresponding to the associated measObjectNR associated with this event.
Ms Hys &gt; Thresh
Ms + Hys &lt; Thresh
The variables in the formula are defined as follows:
Ms is the measurement result of the serving cell, not taking into account any offsets.
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigNR for this event).
Thresh is the threshold parameter for this event (i.e. a1-Threshold as defined within reportConfigNR for this event).
Ms is expressed in dBm in case of RSRP, or in dB in case of RSRQ and RS-SINR.
Hys is expressed in dB.
Thresh is expressed in the same unit as Ms.
5.5.4.3 Event A2 (Serving becomes worse than threshold)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition A2-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition A2-2, as specified below, is fulfilled;
1&gt; for this measurement, consider the serving cell indicated by the measObjectNR associated to this event.
Ms + Hys &lt; Thresh
Ms Hys &gt; Thresh
The variables in the formula are defined as follows:
Ms is the measurement result of the serving cell, not taking into account any offsets.
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigNR for this event).
Thresh is the threshold parameter for this event (i.e. a2-Threshold as defined within reportConfigNR for this event).
Ms is expressed in dBm in case of RSRP, or in dB in case of RSRQ and RS-SINR.
Hys is expressed in dB.
Thresh is expressed in the same unit as Ms.
5.5.4.4 Event A3 (Neighbour becomes offset better than SpCell)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition A3-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition A3-2, as specified below, is fulfilled;
1&gt; use the SpCell for Mp, Ofp and Ocp.
NOTE 1: The cell(s) that triggers the event has reference signals indicated in the measObjectNR associated to this event which may be different from the NR SpCell measObjectNR.
Mn + Ofn + Ocn Hys &gt; Mp + Ofp + Ocp + Off
Mn + Ofn + Ocn + Hys &lt; Mp + Ofp + Ocp + Off
The variables in the formula are defined as follows:
Mn is the measurement result of the neighbouring cell, not taking into account any offsets.
Ofn is the measurement object specific offset of the reference signal of the neighbour cell (i.e. offsetMO as defined within measObjectNR corresponding to the neighbour cell).
Ocn is the cell specific offset of the neighbour cell (i.e. cellIndividualOffset as defined within measObjectNR corresponding to the frequency of the neighbour cell), and set to zero if not configured for the neighbour cell.
Mp is the measurement result of the SpCell, not taking into account any offsets.
Ofp is the measurement object specific offset of the SpCell (i.e. offsetMO as defined within measObjectNR corresponding to the SpCell).
Ocp is the cell specific offset of the SpCell (i.e. cellIndividualOffset as defined within measObjectNR corresponding to the SpCell), and is set to zero if not configured for the SpCell.
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigNR for this event).
Off is the offset parameter for this event (i.e. a3-Offset as defined within reportConfigNR for this event).
Mn, Mp are expressed in dBm in case of RSRP, or in dB in case of RSRQ and RS-SINR.
NOTE 2: The definition of Event A3 also applies to CondEvent A3.
5.5.4.5 Event A4 (Neighbour becomes better than threshold)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition A4-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition A4-2, as specified below, is fulfilled.
Mn + Ofn + Ocn Hys &gt; Thresh
Mn + Ofn + Ocn + Hys &lt; Thresh
The variables in the formula are defined as follows:
Mn is the measurement result of the neighbouring cell, not taking into account any offsets.
Ofn is the measurement object specific offset of the neighbour cell (i.e. offsetMO as defined within measObjectNR corresponding to the neighbour cell).
Ocn is the measurement object specific offset of the neighbour cell (i.e. cellIndividualOffset as defined within measObjectNR corresponding to the neighbour cell), and set to zero if not configured for the neighbour cell.
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigNR for this event).
Thresh is the threshold parameter for this event (i.e. a4-Threshold as defined within reportConfigNR for this event).
Mn is expressed in dBm in case of RSRP, or in dB in case of RSRQ and RS-SINR.
Ofn, Ocn, Hys are expressed in dB.
Thresh is expressed in the same unit as Mn.
NOTE: The definition of Event A4 also applies to CondEvent A4.
5.5.4.6 Event A5 (SpCell becomes worse than threshold1 and neighbour becomes better than threshold2)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when both condition A5-1 and condition A5-2, as specified below, are fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition A5-3 or condition A5-4, i.e. at least one of the two, as specified below, is fulfilled;
1&gt; use the SpCell for Mp.
NOTE 1: The parameters of the reference signal(s) of the cell(s) that triggers the event are indicated in the measObjectNR associated to the event which may be different from the measObjectNR of the NR SpCell.
Mn + Ofn + Ocn Hys &gt; Thresh2
Mp Hys &gt; Thresh1
The variables in the formula are defined as follows:
Mp is the measurement result of the NR SpCell, not taking into account any offsets.
Mn is the measurement result of the neighbouring cell, not taking into account any offsets.
Ofn is the measurement object specific offset of the neighbour cell (i.e. offsetMO as defined within measObjectNR corresponding to the neighbour cell).
Ocn is the cell specific offset of the neighbour cell (i.e. cellIndividualOffset as defined within measObjectNR corresponding to the neighbour cell), and set to zero if not configured for the neighbour cell.
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigNR for this event).
Thresh1 is the threshold parameter for this event (i.e. a5-Threshold1 as defined within reportConfigNR for this event).
Thresh2 is the threshold parameter for this event (i.e. a5-Threshold2 as defined within reportConfigNR for this event).
Mn, Mp are expressed in dBm in case of RSRP, or in dB in case of RSRQ and RS-SINR.
Ofn, Ocn, Hys are expressed in dB.
Thresh1is expressed in the same unit as Mp.
Thresh2 is expressed in the same unit as Mn.
NOTE 2: The definition of Event A5 also applies to CondEvent A5.
5.5.4.7 Event A6 (Neighbour becomes offset better than SCell)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition A6-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition A6-2, as specified below, is fulfilled;
1&gt; for this measurement, consider the (secondary) cell corresponding to the measObjectNR associated to this event to be the serving cell.
NOTE: The reference signal(s) of the neighbour(s) and the reference signal(s) of the SCell are both indicated in the associated measObjectNR.
Mn + Ocn Hys &gt; Ms + Ocs + Off
Mn + Ocn + Hys &lt; Ms + Ocs + Off
The variables in the formula are defined as follows:
Mn is the measurement result of the neighbouring cell, not taking into account any offsets.
Ocn is the cell specific offset of the neighbour cell (i.e. cellIndividualOffset as defined within the associated measObjectNR), and set to zero if not configured for the neighbour cell.
Ms is the measurement result of the serving cell, not taking into account any offsets.
Ocs is the cell specific offset of the serving cell (i.e. cellIndividualOffset as defined within the associated measObjectNR), and is set to zero if not configured for the serving cell.
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigNR for this event).
Off is the offset parameter for this event (i.e. a6-Offset as defined within reportConfigNR for this event).
Mn, Ms are expressed in dBm in case of RSRP, or in dB in case of RSRQ and RS-SINR.
Ocn, Ocs, Hys, Off are expressed in dB.
5.5.4.8 Event B1 (Inter RAT neighbour becomes better than threshold)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition B1-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition B1-2, as specified below, is fulfilled.
Mn + Ofn + Ocn Hys &gt; Thresh
Mn + Ofn + Ocn + Hys &lt; Thresh
The variables in the formula are defined as follows:
Mn is the measurement result of the inter-RAT neighbour cell, not taking into account any offsets.
Ofn is the measurement object specific offset of the frequency of the inter-RAT neighbour cell (i.e. eutra-Q- OffsetRange as defined within the measObjectEUTRA corresponding to the frequency of the neighbour inter- RAT cell, utra-FDD-Q-OffsetRange as defined within the measObjectUTRA-FDD corresponding to the frequency of the neighbour inter-RAT cell).
Ocn is the cell specific offset of the inter-RAT neighbour cell (i.e. cellIndividualOffset as defined within the measObjectEUTRA corresponding to the neighbour inter-RAT cell), and set to zero if not configured for the neighbour cell.
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigInterRAT for this event).
Thresh is the threshold parameter for this event (i.e. b1-ThresholdEUTRA as defined within reportConfigInterRAT for this event, b1-ThresholdUTRA-FDD as defined for UTRA-FDD within reportConfigInterRAT for this event).
Mn is expressed in dBm or in dB, depending on the measurement quantity of the inter-RAT neighbour cell.
Ofn, Ocn, Hys are expressed in dB.
Thresh is expressed in the same unit as Mn.
5.5.4.9 Event B2 (PCell becomes worse than threshold1 and inter RAT neighbour becomes better than threshold2)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when both condition B2-1 and condition B2-2, as specified below, are fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition B2-3 or condition B2-4, i.e. at least one of the two, as specified below, is fulfilled; Inequality B2-1 (Entering condition 1)
Mn + Ofn + Ocn Hys &gt; Thresh2
Mp Hys &gt; Thresh1
The variables in the formula are defined as follows:
Mp is the measurement result of the PCell, not taking into account any offsets.
Mn is the measurement result of the inter-RAT neighbour cell, not taking into account any offsets.
Ofn is the measurement object specific offset of the frequency of the inter-RAT neighbour cell (i.e. eutra-Q- OffsetRange as defined within the measObjectEUTRA corresponding to the frequency of the inter-RAT neighbour cell, utra-FDD-Q-OffsetRange as defined within the measObjectUTRA-FDD corresponding to the frequency of the neighbour inter-RAT cell).
Ocn is the cell specific offset of the inter-RAT neighbour cell (i.e. cellIndividualOffset as defined within the measObjectEUTRA corresponding to the neighbour inter-RAT cell), and set to zero if not configured for the neighbour cell.
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigInterRAT for this event).
Thresh1 is the threshold parameter for this event (i.e. b2-Threshold1 as defined within reportConfigInterRAT for this event).
Thresh2 is the threshold parameter for this event (i.e. b2-Threshold2EUTRA as defined within reportConfigInterRAT for this event, b2-Threshold2UTRA-FDD as defined for UTRA-FDD within reportConfigInterRAT for this event).
Mp is expressed in dBm in case of RSRP, or in dB in case of RSRQ and SINR.
Mn is expressed in dBm or dB, depending on the measurement quantity of the inter-RAT neighbour cell.
Ofn, Ocn, Hys are expressed in dB.
Thresh1 is expressed in the same unit as Mp.
Thresh2 is expressed in the same unit as Mn.
5.5.4.10 Event I1 (Interference becomes higher than threshold)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition I1-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition I1-2, as specified below, is fulfilled.
Mi Hys &gt; Thresh
Mi+ Hys &lt; Thresh
The variables in the formula are defined as follows:
Mi is the measurement result of the interference, not taking into account any offsets.
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigNR for this event).
Thresh is the threshold parameter for this event (i.e. i1-Threshold as defined within reportConfigNR for this event).
Mi, Thresh are expressed in dBm.
Hys is expressed in dB.
5.5.4.11 Event C1 (The NR sidelink channel busy ratio is above a threshold)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition C1-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition C1-2, as specified below, is fulfilled; Inequality C1-1 (Entering condition) MsHys&gt;Thresh
The variables in the formula are defined as follows:
Ms is the measurement result of channel busy ratio of the transmission resource pool, not taking into account any
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigNR-SL for this event).
Thresh is the threshold parameter for this event (i.e. c1-Threshold as defined within reportConfigNR-SL for this event).
Ms is expressed in decimal from 0 to 1 in steps of 0.01.
Hys is expressed is in the same unit as Ms.
Thresh is expressed in the same unit as Ms.
5.5.4.12 Event C2 (The NR sidelink channel busy ratio is below a threshold)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition C2-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition C2-2, as specified below, is fulfilled; Inequality C2-1 (Entering condition) Ms+Hys&lt;Thresh
The variables in the formula are defined as follows:
Ms is the measurement result of channel busy ratio of the transmission resource pool, not taking into account any
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigNR-SL for this event).
Thresh is the threshold parameter for this event (i.e. c2-Threshold as defined within reportConfigNR-SL for this event).
Ms is expressed in decimal from 0 to 1 in steps of 0.01.
Hys is expressed is in the same unit as Ms.
Thresh is expressed in the same unit as Ms.
5.5.4.13 Void
5.5.4.14 Void
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when both condition D1-1 and conditionD1-2, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition D1-3 or conditionD1-4, as specified below, is fulfilled; Inequality D1-1 (Entering condition 1) (cid:0)(cid:2)1(cid:3)(cid:4)(cid:5) &gt;(cid:6)(cid:7)(cid:8)(cid:5)1
The variables in the formula are defined as follows:
Ml1 is the UE location, represented by the distance between UE and a reference location parameter for this event (i.e. referenceLocation1 as defined within reportConfigNR for this event), not taking into account any offsets.
Ml2 is the UE location, represented by the distance between UE and a reference location parameter for this event (i.e. referenceLocation2 as defined within reportConfigNR for this event), not taking into account any offsets
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigNR for this event).
Thresh1 is the threshold for this event defined as a distance, configured with parameter distanceFromReference1, from a reference location configured with parameter referenceLocation1 within reportConfigNR for this event.
Thresh2 is the threshold for this event defined as a distance, configured with parameter distanceFromReference2, from a reference location configured with parameter referenceLocation2 within reportConfigNR for this event.
Ml1 is expressed in meters.
Ml2 is expressed in meters.
Hys is expressed in the same unit as Ml1.
Thresh is expressed in the same unit as Ml1.
NOTE: The definition of Event D1 also applies to CondEvent D1.
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition T1-1, as specified below, is fulfilled;
The variables in the formula are defined as follows:
Mt is the time measured at UE.
Thresh1 is the threshold parameter for this event (i.e. t1-Threshold as defined within reportConfigNR for this event).
Duration is the duration parameter for this event (i.e. duration as defined within reportConfigNR for this event).
Mt is expressed in ms.
Thresh is expressed in the same unit as Mt.
5.5.4.17 Event X1 (Serving L2 U2N Relay UE becomes worse than threshold1 and NR Cell becomes better than threshold2)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when both condition X1-1 and condition X1-2, as specified below, are fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition X1-3 or condition X1-4, i.e. at least one of the two, as specified below, is fulfilled; Inequality X1-1 (Entering condition 1)
Mn + Ofn + Ocn Hys &gt; Thresh2
Mr Hys &gt; Thresh1
The variables in the formula are defined as follows:
Mr is the measurement result of the serving L2 U2N Relay UE, not taking into account any offsets.
Mn is the measurement result of the NR cell, not taking into account any offsets.
Ofn is the measurement object specific offset of the frequency of the NR cell.
Ocn is the cell specific offset of the NR cell, and set to zero if not configured for the cell.
Hys is the hysteresis parameter for this event.
Thresh1 is the threshold parameter for this event (i.e. x1-Threshold1-Relay as defined within reportConfigNR for this event).
Thresh2 is the threshold parameter for this event (i.e. x1-Threshold2 as defined within reportConfigNR for this event).
Mr is expressed in dBm.
Mn is expressed in dBm in case of RSRP, or in dB in case of RSRQ and RS-SINR.
Ofn, Ocn, Hys are expressed in dB.
Thresh1 is expressed in the same unit as Mr.
Thresh2 is expressed in the same unit as Mn.
5.5.4.18 Event X2 (Serving L2 U2N Relay UE becomes worse than threshold)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition X2-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition X2-2, as specified below, is fulfilled; Inequality X2-1 (Entering condition)
Mr + Hys &lt; Thresh
Mr Hys &gt; Thresh
The variables in the formula are defined as follows:
Mr is the measurement result of the serving L2 U2N Relay UE, not taking into account any offsets.
Hys is the hysteresis parameter for this event.
Thresh is the threshold parameter for this event (i.e. x2-Threshold-Relay as defined within reportConfigNR for this event).
Mr is expressed in dBm.
Hys are expressed in dB.
Thresh is expressed in the same unit as Mr.
5.5.4.19 Event Y1 (PCell becomes worse than threshold1 and candidate L2 U2N
Relay UE becomes better than threshold2)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when both condition Y1-1 and condition Y1-2, as specified below, are fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition Y1-3 or condition Y1-4, i.e. at least one of the two, as specified below, is fulfilled; Inequality Y1-1 (Entering condition 1)
Mr Hys &gt; Thresh2
Mp Hys &gt; Thresh1
The variables in the formula are defined as follows:
Mp is the measurement result of the PCell, not taking into account any offsets.
Mr is the measurement result of the candidate L2 U2N Relay UE, not taking into account any offsets.
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigInterRAT for this event).
Thresh1 is the threshold parameter for this event (i.e. y1-Threshold1 as defined within reportConfigInterRAT for this event).
Thresh2 is the threshold parameter for this event (i.e. y1-Threshold2-Relay as defined within reportConfigInterRAT for this even).
Mp is expressed in dBm in case of RSRP, or in dB in case of RSRQ and SINR.
Mr is expressed in dBm or dB, depending on the measurement quantity of candidate L2 U2N Relay UE.
Hys are expressed in dB.
Thresh1 is expressed in the same unit as Mp.
Thresh2 is expressed in the same unit as Mr.
5.5.4.20 Event Y2 (Candidate L2 U2N Relay UE becomes better than threshold)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition Y2-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition Y2-2, as specified below, is fulfilled; Inequality Y2-1 (Entering condition)
Mr Hys &gt; Thresh2
The variables in the formula are defined as follows:
Mr is the measurement result of the candidate L2 U2N Relay UE, not taking into account any offsets.
Hys is the hysteresis parameter for this event (i.e. hysteresis as defined within reportConfigInterRAT for this event).
Thresh is the threshold parameter for this event (i.e. y2-Threshold-Relay as defined within reportConfigInterRAT for this event).
Mr is expressed in dBm or dB, depending on the measurement quantity of candidate L2 U2N Relay UE.
Hys are expressed in dB.
Thresh is expressed in the same unit as Mr.
5.5.5 Measurement reporting
5.5.5.1 General MeasurementReport
The purpose of this procedure is to transfer measurement results from the UE to the network. The UE shall initiate this procedure only after successful AS security activation.
For the measId for which the measurement reporting procedure was triggered, the UE shall set the measResults within the MeasurementReport message as follows:
1&gt; set the measId to the measurement identity that triggered the measurement reporting;
1&gt; for each serving cell configured with servingCellMO:
2&gt; if the reportConfig associated with the measId that triggered the measurement reporting includes rsType:
3&gt; if the serving cell measurements based on the rsType included in the reportConfig that triggered the measurement report are available:
4&gt; set the measResultServingCell within measResultServingMOList to include RSRP, RSRQ and the available SINR of the serving cell, derived based on the rsType included in the reportConfig that triggered the measurement report;
3&gt; if SSB based serving cell measurements are available:
4&gt; set the measResultServingCell within measResultServingMOList to include RSRP, RSRQ and the available SINR of the serving cell, derived based on SSB;
3&gt; else if CSI-RS based serving cell measurements are available:
4&gt; set the measResultServingCell within measResultServingMOList to include RSRP, RSRQ and the available SINR of the serving cell, derived based on CSI-RS;
1&gt; set the servCellId within measResultServingMOList to include each NR serving cell that is configured with servingCellMO, if any;
1&gt; if the reportConfig associated with the measId that triggered the measurement reporting includes reportQuantityRS-Indexes and maxNrofRS-IndexesToReport:
2&gt; for each serving cell configured with servingCellMO, include beam measurement information according to the associated reportConfig as described in 5.5.5.2;
1&gt; if the reportConfig associated with the measId that triggered the measurement reporting includes reportAddNeighMeas:
2&gt; for each measObjectId referenced in the measIdList which is also referenced with servingCellMO, other than the measObjectId corresponding with the measId that triggered the measurement reporting:
3&gt; if the measObjectNR indicated by the servingCellMO includes the RS resource configuration corresponding to the rsType indicated in the reportConfig:
4&gt; set the measResultBestNeighCell within measResultServingMOList to include the physCellId and the available measurement quantities based on the reportQuantityCell and rsType indicated in reportConfig of the non-serving cell corresponding to the concerned measObjectNR with the highest measured RSRP if RSRP measurement results are available for cells corresponding to this measObjectNR, otherwise with the highest measured RSRQ if RSRQ measurement results are available for cells corresponding to this measObjectNR, otherwise with the highest measured SINR;
4&gt; if the reportConfig associated with the measId that triggered the measurement reporting includes reportQuantityRS-Indexes and maxNrofRS-IndexesToReport:
5&gt; for each best non-serving cell included in the measurement report:
6&gt; include beam measurement information according to the associated reportConfig as described in 5.5.5.2;
1&gt; if the reportConfig associated with the measId that triggered the measurement reporting is set to eventTriggered and eventID is set to eventA3, or eventA4, or eventA5, or eventB1, or eventB2:
2&gt; if the UE is in NE-DC and the measurement configuration that triggered this measurement report is associated with the MCG:
3&gt; set the measResultServFreqListEUTRA-SCG to include an entry for each E-UTRA SCG serving frequency with the following:
4&gt; include carrierFreq of the E-UTRA serving frequency;
4&gt; set the measResultServingCell to include the available measurement quantities that the UE is configured to measure by the measurement configuration associated with the SCG;
4&gt; if reportConfig associated with the measId that triggered the measurement reporting includes reportAddNeighMeas:
5&gt; set the measResultServFreqListEUTRA-SCG to include within measResultBestNeighCell the quantities of the best non-serving cell, based on RSRP, on the concerned serving frequency;
1&gt; if reportConfig associated with the measId that triggered the measurement reporting is set to eventTriggered and eventID is set to eventA3, or eventA4, or eventA5:
2&gt; if the UE is in NR-DC and the measurement configuration that triggered this measurement report is associated with the MCG:
3&gt; set the measResultServFreqListNR-SCG to include for each NR SCG serving cell that is configured with servingCellMO, if any, the following:
4&gt; if the reportConfig associated with the measId that triggered the measurement reporting includes rsType:
5&gt; if the serving cell measurements based on the rsType included in the reportConfig that triggered the measurement report are available according to the measurement configuration associated with the SCG:
6&gt; set the measResultServingCell within measResultServFreqListNR-SCG to include RSRP, RSRQ and the available SINR of the serving cell, derived based on the rsType included in the reportConfig that triggered the measurement report;
5&gt; if SSB based serving cell measurements are available according to the measurement configuration associated with the SCG:
6&gt; set the measResultServingCell within measResultServFreqListNR-SCG to include RSRP, RSRQ and the available SINR of the serving cell, derived based on SSB;
5&gt; else if CSI-RS based serving cell measurements are available according to the measurement configuration associated with the SCG:
6&gt; set the measResultServingCell within measResultServFreqListNR-SCG to include RSRP, RSRQ and the available SINR of the serving cell, derived based on CSI-RS;
4&gt; if results for the serving cell derived based on SSB are included:
5&gt; include the ssbFrequency to the value indicated by ssbFrequency as included in the MeasObjectNR of the serving cell;
4&gt; if results for the serving cell derived based on CSI-RS are included:
5&gt; include the refFreqCSI-RS to the value indicated by refFreqCSI-RS as included in the MeasObjectNR of the serving cell;
4&gt; if the reportConfig associated with the measId that triggered the measurement reporting includes reportQuantityRS-Indexes and maxNrofRS-IndexesToReport:
5&gt; for each serving cell configured with servingCellMO, include beam measurement information according to the associated reportConfig as described in 5.5.5.2, where availability is considered according to the measurement configuration associated with the SCG;
4&gt; if reportConfig associated with the measId that triggered the measurement reporting includes reportAddNeighMeas:
5&gt; if the measObjectNR indicated by the servingCellMO includes the RS resource configuration corresponding to the rsType indicated in the reportConfig:
6&gt; set the measResultBestNeighCellListNR within measResultServFreqListNR-SCG to include one entry with the physCellId and the available measurement quantities based on the reportQuantityCell and rsType indicated in reportConfig of the non-serving cell corresponding to the concerned measObjectNR with the highest measured RSRP if RSRP measurement results are available for cells corresponding to this measObjectNR, otherwise with the highest measured RSRQ if RSRQ measurement results are available for cells corresponding to this measObjectNR, otherwise with the highest measured SINR, where availability is considered according to the measurement configuration associated with the SCG;
7&gt; if the reportConfig associated with the measId that triggered the measurement reporting includes reportQuantityRS-Indexes and maxNrofRS-IndexesToReport:
8&gt; for each best non-serving cell included in the measurement report:
9&gt; include beam measurement information according to the associated reportConfig as described in 5.5.5.2, where availability is considered according to the measurement configuration associated with the SCG;
1&gt; if the measRSSI-ReportConfig is configured within the corresponding reportConfig for this measId:
2&gt; set the rssi-Result to the linear average of sample value(s) provided by lower layers in the reportInterval;
2&gt; set the channelOccupancy to the rounded percentage of sample values which are beyond the channelOccupancyThreshold within all the sample values in the reportInterval;
1&gt; if the UE is connected with a L2 U2N Relay UE via PC5-RRC connection (i.e. the UE is a L2 U2N Remote UE):
2&gt; set the sl-MeasResultServingRelay to include the SL-RSRP of the serving L2 U2N Relay UE; NOTE 1: In case of no data transmission from L2 U2N Relay UE to L2 U2N Remote UE, it is left to UE implementation whether to use SL-RSRP or SD-RSRP when setting the sl-MeasResultServingRelay of the serving L2 U2N Relay UE.
1&gt; if there is at least one applicable neighbouring cell to report:
2&gt; if the reportType is set to eventTriggered or periodical:
3&gt; if the measurement report concerns the candidate L2 U2N Relay UE:
4&gt; set the sl-MeasResultCandRelay to include the best candidate L2 U2N Relay UEs up to maxReportCells in accordance with the following:
5&gt; if the reportType is set to eventTriggered:
6&gt; include the L2 U2N Relay UEs included in the relaysTriggeredList as defined within the VarMeasReportList for this measId;
6&gt; include the applicable L2 U2N Relay UEs for which the new measurement results became available since the last periodical reporting or since the measurement was initiated or reset;
4&gt; set the measResultNeighCells to include the best neighbouring cells up to maxReportCells in accordance with the following:
5&gt; if the reportType is set to eventTriggered:
6&gt; include the cells included in the cellsTriggeredList as defined within the VarMeasReportList for this measId;
6&gt; include the applicable cells for which the new measurement results became available since the last periodical reporting or since the measurement was initiated or reset;
3&gt; for each cell that is included in the measResultNeighCells, include the physCellId;
3&gt; for each L2 U2N Relay UE that is included in the sl-MeasResultsCandRelay, include the sl- RelayUEIdentity;
3&gt; if the reportType is set to eventTriggered or periodical:
4&gt; for each included cell/L2 U2N Relay UE, include the layer 3 filtered measured results in accordance with the reportConfig for this measId, ordered as follows:
5&gt; if the measObject associated with this measId concerns NR:
6&gt; if rsType in the associated reportConfig is set to ssb:
7&gt; set resultsSSB-Cell within the measResult to include the SS/PBCH block based quantity(ies) indicated in the reportQuantityCell within the concerned reportConfig, in decreasing order of the sorting quantity, determined as specified in 5.5.5.3, i.e. the best cell is included first;
7&gt; if reportQuantityRS-Indexes and maxNrofRS-IndexesToReport are configured, include beam measurement information as described in 5.5.5.2;
6&gt; else if rsType in the associated reportConfig is set to csi-rs:
7&gt; set resultsCSI-RS-Cell within the measResult to include the CSI-RS based quantity(ies) indicated in the reportQuantityCell within the concerned reportConfig, in decreasing order of the sorting quantity, determined as specified in 5.5.5.3, i.e. the best cell is included first;
7&gt; if reportQuantityRS-Indexes and maxNrofRS-IndexesToReport are configured, include beam measurement information as described in 5.5.5.2;
5&gt; if the measObject associated with this measId concerns E-UTRA:
6&gt; set the measResult to include the quantity(ies) indicated in the reportQuantity within the concerned reportConfigInterRAT in decreasing order of the sorting quantity, determined as specified in 5.5.5.3, i.e. the best cell is included first;
5&gt; if the measObject associated with this measId concerns UTRA-FDD and if ReportConfigInterRAT includes the reportQuantityUTRA-FDD:
6&gt; set the measResult to include the quantity(ies) indicated in the reportQuantityUTRA-FDD within the concerned reportConfigInterRAT in decreasing order of the sorting quantity, determined as specified in 5.5.5.3, i.e. the best cell is included first;
5&gt; if the measObject associated with this measId concerns L2 U2N Relay UE:
6&gt; set the measResult to include the quantity(ies) indicated in the reportQuantityRelay within the concerned reportConfigRelay in decreasing order of the sorting quantity, determined as specified in 5.5.5.3, i.e. the best L2 U2N Relay UE is included first;
3&gt; if the cell indicated by cellForWhichToReportCGI is an NR cell:
4&gt; if plmn-IdentityInfoList of the cgi-Info for the concerned cell has been obtained:
5&gt; include the plmn-IdentityInfoList including plmn-IdentityList, trackingAreaCode (if available), ranac (if available), cellIdentity and cellReservedForOperatorUse for each entry of the plmn- IdentityInfoList;
5&gt; include frequencyBandList if available;
4&gt; if nr-CGI-Reporting-NPN is supported by the UE and npn-IdentityInfoList of the cgi-Info for the concerned cell has been obtained:
5&gt; include the npn-IdentityInfoList including npn-IdentityList, trackingAreaCode, ranac (if available), cellIdentity and cellReservedForOperatorUse for each entry of the npn-IdentityInfoList;
5&gt; include cellReservedForOtherUse if available;
4&gt; else if MIB indicates the SIB1 is not broadcast:
5&gt; include the noSIB1 including the ssb-SubcarrierOffset and pdcch-ConfigSIB1 obtained from MIB of the concerned cell;
3&gt; if the cell indicated by cellForWhichToReportCGI is an E-UTRA cell:
4&gt; if all mandatory fields of the cgi-Info-EPC for the concerned cell have been obtained:
5&gt; include in the cgi-Info-EPC the fields broadcasted in E-UTRA SystemInformationBlockType1 associated to EPC;
4&gt; if the UE is E-UTRA/5GC capable and all mandatory fields of the cgi-Info-5GC for the concerned cell have been obtained:
5&gt; include in the cgi-Info-5GC the fields broadcasted in E-UTRA SystemInformationBlockType1 associated to 5GC;
4&gt; if the mandatory present fields of the cgi-Info for the cell indicated by the cellForWhichToReportCGI in the associated measObject have been obtained:
5&gt; include the freqBandIndicator;
5&gt; if the cell broadcasts the multiBandInfoList, include the multiBandInfoList;
5&gt; if the cell broadcasts the freqBandIndicatorPriority, include the freqBandIndicatorPriority;
1&gt; if the corresponding measObject concerns NR:
2&gt; if the reportSFTD-Meas is set to true within the corresponding reportConfigNR for this measId:
3&gt; set the measResultSFTD-NR in accordance with the following:
4&gt; set sfn-OffsetResult and frameBoundaryOffsetResult to the measurement results provided by lower layers;
4&gt; if the reportRSRP is set to true;
5&gt; set rsrp-Result to the RSRP of the NR PSCell derived based on SSB;
2&gt; else if the reportSFTD-NeighMeas is included within the corresponding reportConfigNR for this measId:
3&gt; for each applicable cell which measurement results are available, include an entry in the measResultCellListSFTD-NR and set the contents as follows:
4&gt; set physCellId to the physical cell identity of the concerned NR neighbour cell.
4&gt; set sfn-OffsetResult and frameBoundaryOffsetResult to the measurement results provided by lower layers;
4&gt; if the reportRSRP is set to true:
5&gt; set rsrp-Result to the RSRP of the concerned cell derived based on SSB;
1&gt; else if the corresponding measObject concerns E-UTRA:
2&gt; if the reportSFTD-Meas is set to true within the corresponding reportConfigInterRAT for this measId:
3&gt; set the measResultSFTD-EUTRA in accordance with the following:
4&gt; set sfn-OffsetResult and frameBoundaryOffsetResult to the measurement results provided by lower layers;
4&gt; if the reportRSRP is set to true;
5&gt; set rsrpResult-EUTRA to the RSRP of the EUTRA PSCell;
1&gt; if average uplink PDCP delay values are available:
2&gt; set the ul-PDCP-DelayValueResultList to include the corresponding average uplink PDCP delay values;
1&gt; if PDCP excess delay measurements are available:
2&gt; set the ul-PDCP-ExcessDelayResultList to include the corresponding PDCP excess delay measurements;
1&gt; if the includeCommonLocationInfo is configured in the corresponding reportConfig for this measId and detailed location information that has not been reported is available, set the content of commonLocationInfo of the locationInfo as follows:
2&gt; include the locationTimestamp;
2&gt; include the locationCoordinate, if available;
2&gt; include the velocityEstimate, if available;
2&gt; include the locationError, if available;
2&gt; include the locationSource, if available;
2&gt; if available, include the gnss-TOD-msec,
1&gt; if the includeWLAN-Meas is configured in the corresponding reportConfig for this measId, set the wlan- LocationInfo of the locationInfo in the measResults as follows:
2&gt; if available, include the LogMeasResultWLAN, in order of decreasing RSSI for WLAN APs;
1&gt; if the includeBT-Meas is configured in the corresponding reportConfig for this measId, set the BT-LocationInfo of the locationInfo in the measResults as follows:
2&gt; if available, include the LogMeasResultBT, in order of decreasing RSSI for Bluetooth beacons;
1&gt; if the includeSensor-Meas is configured in the corresponding reportConfig for this measId, set the sensor- LocationInfo of the locationInfo in the measResults as follows:
2&gt; if available, include the sensor-MeasurementInformation;
2&gt; if available, include the sensor-MotionInformation;
1&gt; if there is at least one applicable transmission resource pool for NR sidelink communication (for measResultsSL):
2&gt; set the measResultsListSL to include the CBR measurement results in accordance with the following:
3&gt; if the reportType is set to eventTriggered:
4&gt; include the transmission resource pools included in the poolsTriggeredList as defined within the VarMeasReportList for this measId;
4&gt; include the applicable transmission resource pools for which the new measurement results became available since the last periodical reporting or since the measurement was initiated or reset;
3&gt; if the corresponding measObject concerns NR sidelink communication, then for each transmission resource pool to be reported:
4&gt; set the sl-poolReportIdentity to the identity of this transmission resource pool;
4&gt; set the sl-CBR-ResultsNR to the CBR measurement results on PSSCH and PSCCH of this transmission resource pool provided by lower layers, if available; NOTE 1: Void.
1&gt; if there is at least one applicable CLI measurement resource to report:
2&gt; if the reportType is set to cli-EventTriggered or cli-Periodical:
3&gt; set the measResultCLI to include the most interfering SRS resources or most interfering CLI-RSSI resources up to maxReportCLI in accordance with the following:
4&gt; if the reportType is set to cli-EventTriggered:
5&gt; if trigger quantity is set to srs-RSRP i.e. i1-Threshold is set to srs-RSRP:
6&gt; include the SRS resource included in the cli-TriggeredList as defined within the VarMeasReportList for this measId;
5&gt; if trigger quantity is set to cli-RSSI i.e. i1-Threshold is set to cli-RSSI:
6&gt; include the CLI-RSSI resource included in the cli-TriggeredList as defined within the VarMeasReportList for this measId;
5&gt; if reportQuantityCLI is set to srs-rsrp:
6&gt; include the applicable SRS resources for which the new measurement results became available since the last periodical reporting or since the measurement was initiated or reset;
6&gt; include the applicable CLI-RSSI resources for which the new measurement results became available since the last periodical reporting or since the measurement was initiated or reset;
4&gt; for each SRS resource that is included in the measResultCLI:
5&gt; include the srs-ResourceId;
5&gt; set srs-RSRP-Result to include the layer 3 filtered measured results in decreasing order, i.e. the most interfering SRS resource is included first;
4&gt; for each CLI-RSSI resource that is included in the measResultCLI:
5&gt; include the rssi-ResourceId;
5&gt; set cli-RSSI-Result to include the layer 3 filtered measured results in decreasing order, i.e. the most interfering CLI-RSSI resource is included first;
1&gt; if there is at least one applicable UE Rx-Tx time difference measurement to report:
2&gt; set measResultRxTxTimeDiff to the latest measurement result; Editor's note (IIoT): It is assumed (without explicit RAN2 agreements) that only the latest measurement is included in the report, e.g., no filtered measurement, no multiple measurement reports. Proponent companies for other measurement reporting can bring discussion paper in the maintenance phase.
1&gt; increment the numberOfReportsSent as defined within the VarMeasReportList for this measId by 1;
1&gt; stop the periodical reporting timer, if running;
1&gt; if the numberOfReportsSent as defined within the VarMeasReportList for this measId is less than the reportAmount as defined within the corresponding reportConfig for this measId:
2&gt; start the periodical reporting timer with the value of reportInterval as defined within the corresponding reportConfig for this measId;
2&gt; if the reportType is set to periodical or cli-Periodical or rxTxPeriodical:
3&gt; remove the entry within the VarMeasReportList for this measId;
3&gt; remove this measId from the measIdList within VarMeasConfig;
1&gt; if the measurement reporting was configured by a sl-ConfigDedicatedNR received within the RRCConnectionReconfiguration:
2&gt; submit the MeasurementReport message to lower layers for transmission via SRB1, embedded in E-UTRA RRC message ULInformationTransferIRAT as specified TS 36.331 , clause 5.6.28;
1&gt; else if the UE is in (NG)EN-DC:
2&gt; if SRB3 is configured and the SCG is not deactivated:
3&gt; submit the MeasurementReport message via SRB3 to lower layers for transmission, upon which the procedure ends;
3&gt; submit the MeasurementReport message via E-UTRA embedded in E-UTRA RRC message ULInformationTransferMRDC as specified in TS 36.331 .
1&gt; else if the UE is in NR-DC:
2&gt; if the measurement configuration that triggered this measurement report is associated with the SCG:
3&gt; if SRB3 is configured and the SCG is not deactivated:
4&gt; submit the MeasurementReport message via SRB3 to lower layers for transmission, upon which the procedure ends;
4&gt; submit the MeasurementReport message via SRB1 embedded in NR RRC message ULInformationTransferMRDC as specified in 5.7.2a.3;
3&gt; submit the MeasurementReport message via SRB1 to lower layers for transmission, upon which the procedure ends;
2&gt; submit the MeasurementReport message to lower layers for transmission, upon which the procedure ends.
5.5.5.2 Reporting of beam measurement information
For beam measurement information to be included in a measurement report the UE shall:
1&gt; if reportType is set to eventTriggered:
2&gt; consider the trigger quantity as the sorting quantity if available, otherwise RSRP as sorting quantity if available, otherwise RSRQ as sorting quantity if available, otherwise SINR as sorting quantity;
1&gt; if reportType is set to periodical:
2&gt; if a single reporting quantity is set to true in reportQuantityRS-Indexes;
3&gt; consider the configured single quantity as the sorting quantity;
3&gt; if rsrp is set to true;
4&gt; consider RSRP as the sorting quantity;
4&gt; consider RSRQ as the sorting quantity;
1&gt; set rsIndexResults to include up to maxNrofRS-IndexesToReport SS/PBCH block indexes or CSI-RS indexes in order of decreasing sorting quantity as follows:
2&gt; if the measurement information to be included is based on SS/PBCH block:
3&gt; include within resultsSSB-Indexes the index associated to the best beam for that SS/PBCH block sorting quantity and if absThreshSS-BlocksConsolidation is included in the VarMeasConfig for the measObject associated to the cell for which beams are to be reported, the remaining beams whose sorting quantity is above absThreshSS-BlocksConsolidation;
3&gt; if includeBeamMeasurements is set to true, include the SS/PBCH based measurement results for the quantities in reportQuantityRS-Indexes for each SS/PBCH block index;
2&gt; else if the beam measurement information to be included is based on CSI-RS:
3&gt; include within resultsCSI-RS-Indexes the index associated to the best beam for that CSI-RS sorting quantity and, if absThreshCSI-RS-Consolidation is included in the VarMeasConfig for the measObject associated to the cell for which beams are to be reported, the remaining beams whose sorting quantity is above absThreshCSI-RS-Consolidation;
3&gt; if includeBeamMeasurements is set to true, include the CSI-RS based measurement results for the quantities in reportQuantityRS-Indexes for each CSI-RS index.
5.5.5.3 Sorting of cell measurement results
The UE shall determine the sorting quantity according to parameters of the reportConfig associated with the measId that triggered the reporting:
1&gt; if the reportType is set to eventTriggered:
2&gt; for an NR cell, consider the quantity used in the aN-Threshold (for eventA1, eventA2 and eventA4) or in the a5-Threshold2 (for eventA5) or in the aN-Offset (for eventA3 and eventA6) as the sorting quantity;
2&gt; for an E-UTRA cell, consider the quantity used in the bN-ThresholdEUTRA as the sorting quantity;
2&gt; for an UTRA-FDD cell, consider the quantity used in the bN-ThresholdUTRA-FDD as the sorting quantity;
2&gt; for a candidate L2 U2N Relay UE, consider the yN-Threshold2-Relay as the sorting quantity;
1&gt; if the reportType is set to periodical:
2&gt; determine the sorting quantity according to reportQuantityCell for an NR cell, and according to reportQuantity for an E-UTRA cell, as below:
3&gt; if a single quantity is set to true:
4&gt; consider this quantity as the sorting quantity;
4&gt; if rsrp is set to true;
5&gt; consider RSRP as the sorting quantity;
5&gt; consider RSRQ as the sorting quantity;
2&gt; determine the sorting quantity according to reportQuantityUTRA-FDD for UTRA-FDD cell, as below:
3&gt; if a single quantity is set to true:
4&gt; consider this quantity as the sorting quantity;
4&gt; consider RSCP as the sorting quantity.
2&gt; for a candidate L2 U2N Relay UE, consider the reportQuantityRelay as the sorting quantity;
5.5.6 Location measurement indication
5.5.6.1 General LocationMeasurementIndication
The purpose of this procedure is to indicate to the network that the UE is going to start/stop location related measurements towards E-UTRA or NR (eutra-RSTD, nr-RSTD, nr-UE-RxTxTimeDiff, nr-PRS-RSRP) which require measurement gaps or start/stop detection of subframe and slot timing towards E-UTRA (eutra-FineTimingDetection) which requires measurement gaps. UE shall initiate this procedure only after successful AS security activation.
NOTE: It is a network decision to configure the measurement gap.
5.5.6.2 Initiation
The UE shall:
1&gt; if and only if upper layers indicate to start performing location measurements towards E-UTRA or NR or start subframe and slot timing detection towards E-UTRA, and the UE requires measurement gaps for these operations while measurement gaps are either not configured or not sufficient:
2&gt; if preconfigured measurement gaps are configured and the UE considers that at least one of the preconfigured gaps meets the measurement gap requirements:
Editor's Note: check if Reference for TS 38.133 on measurement gap requirements is needed.
3&gt; trigger the lower layers to initiate the measurement gap activation request using UL MAC CE as specified in TS 38.321 ;
3&gt; initiate the procedure to indicate start; NOTE 1: The UE verifies the measurement gap situation only upon receiving the indication from upper layers. If at this point in time sufficient gaps are available, the UE does not initiate the procedure. Unless it receives a new indication from upper layers, the UE is only allowed to further repeat the procedure in the same PCell once per frequency of the target RAT if the provided measurement gaps are insufficient.
1&gt; if and only if upper layers indicate to stop performing location measurements towards E-UTRA or NR or stop subframe and slot timing detection towards E-UTRA and preConfigGapID is not activated:
2&gt; initiate the procedure to indicate stop.
NOTE 2: The UE may initiate the procedure to indicate stop even if it did not previously initiate the procedure to indicate start.
1&gt; if preConfigGapID is activated:
2&gt; if a request from upper layers to transmit either a new preConfigGapID or to modify the current measGapConfig is received; or
2&gt; if a request from upper layers indicate that the current gap is not needed:
3&gt; trigger the lower layers to deactivate the current active measurement gap as specified in TS 38.321 ;
5.5.6.3 Actions related to transmission of LocationMeasurementIndication message
The UE shall set the contents of LocationMeasurementIndication message as follows:
1&gt; if the procedure is initiated to indicate start of location related measurements:
2&gt; if the procedure is initiated for RSTD measurements towards E-UTRA:
3&gt; set the measurementIndication to the eutra-RSTD according to the information received from upper layers;
2&gt; else if the procedure is initiated for positioning measurement towards NR:
3&gt; set the measurementIndication to the nr-PRS-Measurement according to the information received from upper layers;
1&gt; else if the procedure is initiated to indicate stop of location related measurements:
2&gt; set the measurementIndication to the value release;
1&gt; if the procedure is initiated to indicate start of subframe and slot timing detection towards E-UTRA:
2&gt; set the measurementIndication to the value eutra-FineTimingDetection;
1&gt; else if the procedure is initiated to indicate stop of subframe and slot timing detection towards E-UTRA:
2&gt; set the measurementIndication to the value release;
1&gt; submit the LocationMeasurementIndication message to lower layers for transmission, upon which the procedure
5.5a Logged Measurements
5.5a.1 Logged Measurement Configuration
5.5a.1.1 General UE Network LoggedMeasurementConfiguration
The purpose of this procedure is to configure the UE to perform logging of measurement results while in RRC_IDLE and RRC_INACTIVE. The procedure applies to logged measurements capable UEs that are in RRC_CONNECTED.
NOTE: NG-RAN may retrieve stored logged measurement information by means of the UE information
5.5a.1.2 Initiation NG-RAN initiates the logged measurement configuration procedure to UE in RRC_CONNECTED by sending the LoggedMeasurementConfiguration message.
5.5a.1.3 Reception of the LoggedMeasurementConfiguration by the UE
Upon receiving the LoggedMeasurementConfiguration message the UE shall:
1&gt; discard the logged measurement configuration as well as the logged measurement information as specified in
1&gt; store the received loggingDuration, reportType and areaConfiguration, if included, in VarLogMeasConfig;
1&gt; if the LoggedMeasurementConfiguration message includes plmn-IdentityList:
2&gt; set plmn-IdentityList in VarLogMeasReport to include the RPLMN as well as the PLMNs included in plmn- IdentityList;
2&gt; set plmn-IdentityList in VarLogMeasReport to include the RPLMN;
1&gt; store the received absoluteTimeInfo, traceReference, traceRecordingSessionRef, and tce-Id, and sigLoggedMeasType in VarLogMeasReport;
1&gt; store the received bt-NameList, if included, in VarLogMeasConfig;
1&gt; store the received wlan-NameList, if included, in VarLogMeasConfig;
1&gt; store the received sensor-NameList, if included, in VarLogMeasConfig;
1&gt; start timer T330 with the timer value set to the loggingDuration;
1&gt; store the received earlyMeasIndication, if included, in VarLogMeasConfig; 5.5a.1.4 T330 expiry
Upon expiry of T330 the UE shall:
1&gt; release VarLogMeasConfig; The UE is allowed to discard stored logged measurements, i.e. to release VarLogMeasReport, 48 hours after T330
5.5a.2 Release of Logged Measurement Configuration
5.5a.2.1 General
The purpose of this procedure is to release the logged measurement configuration as well as the logged measurement
5.5a.2.2 Initiation
The UE shall initiate the procedure upon receiving a logged measurement configuration in another RAT. The UE shall also initiate the procedure upon power off or upon deregistration.
The UE shall:
1&gt; stop timer T330, if running;
1&gt; if stored, discard the logged measurement configuration as well as the logged measurement information, i.e.
release the UE variables VarLogMeasConfig and VarLogMeasReport.
5.5a.3 Measurements logging
5.5a.3.1 General
This procedure specifies the logging of available measurements by a UE in RRC_IDLE and RRC_INACTIVE that has
a logged measurement configuration. The actual process of logging within the UE, takes place in RRC IDLE state could continue in RRC INACTIVE state or vice versa.
5.5a.3.2 Initiation
While T330 is running and T319a is not running, the UE shall:
1&gt; if measurement logging is suspended:
2&gt; if during the last logging interval the IDC problems detected by the UE is resolved, resume measurement logging;
1&gt; if not suspended, perform the logging in accordance with the following:
2&gt; if the reportType is set to periodical in the VarLogMeasConfig:
3&gt; if the UE is in any cell selection state (as specified in TS 38.304 ):
4&gt; perform the logging at regular time intervals, as defined by the loggingInterval in the VarLogMeasConfig;
3&gt; if the UE is in camped normally state on an NR cell and if the RPLMN is included in plmn-IdentityList stored in VarLogMeasReport:
4&gt; if areaConfiguration is not included in VarLogMeasConfig; or
4&gt; if the serving cell is part of the area indicated by areaConfig in areaConfiguration in VarLogMeasConfig:
5&gt; perform the logging at regular time intervals, as defined by the loggingInterval in the VarLogMeasConfig;
2&gt; else if the reportType is set to eventTriggered, and eventType is set to outOfCoverage:
3&gt; perform the logging at regular time intervals as defined by the loggingInterval in VarLogMeasConfig only when the UE is in any cell selection state;
3&gt; upon transition from any cell selection state to camped normally state in NR:
4&gt; if the RPLMN is included in plmn-IdentityList stored in VarLogMeasReport; and
4&gt; if areaConfiguration is not included in VarLogMeasConfig or if the current camping cell is part of the area indicated by areaConfig of areaConfiguration in VarLogMeasConfig:
5&gt; perform the logging;
2&gt; else if the reportType is set to eventTriggered and eventType is set to eventL1:
3&gt; if the UE is in camped normally state on an NR cell and if the RPLMN is included in plmn-IdentityList stored in VarLogMeasReport:
4&gt; if areaConfiguration is not included in VarLogMeasConfig; or
4&gt; if the serving cell is part of the area indicated by areaConfig in areaConfiguration in VarLogMeasConfig;
5&gt; perform the logging at regular time intervals as defined by the loggingInterval in VarLogMeasConfig only when the conditions indicated by the eventL1 are met;
2&gt; when performing the logging:
3&gt; if the UE detected IDC problems during the last logging interval:
4&gt; if measResultServCell in VarLogMeasReport is not empty:
5&gt; suspend measurement logging from the next logging interval;
5&gt; suspend measurement logging;
3&gt; set the relativeTimeStamp to indicate the elapsed time since the moment at which the logged measurement configuration was received;
3&gt; if location information became available during the last logging interval, set the content of the locationInfo as in 5.3.3.7:
3&gt; if the UE is in any cell selection state (as specified in TS 38.304 ):
4&gt; set anyCellSelectionDetected to indicate the detection of no suitable or no acceptable cell found;
4&gt; if the reportType is set to eventTriggered in the VarLogMeasConfig; and
4&gt; if the RPLMN at the time of entering the any cell selection state is included in plmn-IdentityList stored in VarLogMeasReport; and
4&gt; if areaConfiguration is not included in VarLogMeasConfig or if the last suitable cell that the UE was camping on is part of the area indicated by areaConfig of areaConfiguration in VarLogMeasConfig:
5&gt; set the servCellIdentity to indicate global cell identity of the last suitable cell that the UE was camping on;
5&gt; set the measResultServingCell to include the quantities of the last suitable cell the UE was camping on;
4&gt; else if the reportType is set to periodical in the VarLogMeasConfig:
5&gt; set the servCellIdentity to indicate global cell identity of the last logged cell that the UE was camping on;
5&gt; set the measResultServingCell to include the quantities of the last logged cell the UE was camping on;
4&gt; set the servCellIdentity to indicate global cell identity of the cell the UE is camping on;
4&gt; set the measResultServingCell to include the quantities of the cell the UE is camping on;
3&gt; if available, set the measResultNeighCells, in order of decreasing ranking-criterion as used for cell re- selection, to include measurements of neighbouring cell that became available during the last logging interval and according to the following:
4&gt; include measurement results for at most 6 neighbouring cells on the NR serving frequency and for at most 3 cells per NR neighbouring frequency and for the NR neighbouring frequencies in accordance with the following:
5&gt; if interFreqTargetInfo is included in VarLogMeasConfig:
6&gt; if earlyMeasIndication is included in VarLogMeasConfig;
7&gt; include measurement results for NR neighbouring frequencies that are included in both interFreqTargetInfo and either in measIdleCarrierListNR or SIB4;
7&gt; include measurement results for NR neighbouring frequencies that are included in both interFreqTargetInfo and SIB4;
6&gt; if earlyMeasIndication is included in VarLogMeasConfig;
7&gt; include measurement results for NR neighbouring frequencies that are included in measIdleCarrierListNR or SIB4;
7&gt; include measurement results for NR neighbouring frequencies that are included in SIB4;
4&gt; include measurement results for at most 3 neighbours per inter-RAT frequency in accordance with the following:
5&gt; if earlyMeasIndication is included in VarLogMeasConfig:
6&gt; include measurement results for inter-RAT neighbouring frequencies that are included in measIdleCarrierListEUTRA or SIB5;
6&gt; include measurement results for inter-RAT frequencies that are included in SIB5;
4&gt; for each neighbour cell included, include the optional fields that are available; NOTE 1: The UE includes the latest results of the available measurements as used for cell reselection evaluation in RRC_IDLE or RRC_INACTIVE, which are performed in accordance with the performance requirements as specified in TS 38.133 .
NOTE 2: For logging the measurements on frequencies (indicated in measIdleCarrierListNR/ measIdleCarrierListEUTRA) in the logged measurement, the qualityThreshold in measIdleConfig should not be applied, and how the UE logs the measurements on the frequencies is left to the UE
2&gt; when the memory reserved for the logged measurement information becomes full, stop timer T330 and perform the same actions as performed upon expiry of T330, as specified in 5.5a.1.4.
5.6 UE capabilities
5.6.1 UE capability transfer
5.6.1.1 General
This clause describes how the UE compiles and transfers its UE capability information upon receiving a UECapabilityEnquiry from the network.
UECapabilityEnquiry UECapabilityInformation
5.6.1.2 Initiation
The network initiates the procedure to a UE in RRC_CONNECTED when it needs (additional) UE radio access capability information. The network should retrieve UE capabilities only after AS security activation. Network does not forward UE capabilities that were retrieved before AS security activation to the CN.
5.6.1.3 Reception of the UECapabilityEnquiry by the UE
The UE shall set the contents of UECapabilityInformation message as follows:
1&gt; if the ue-CapabilityRAT-RequestList contains a UE-CapabilityRAT-Request with rat-Type set to nr:
2&gt; include in the ue-CapabilityRAT-ContainerList a UE-CapabilityRAT-Container of the type UE-NR- Capability and with the rat-Type set to nr;
2&gt; include the supportedBandCombinationList, featureSets and featureSetCombinations as specified in clause
1&gt; if the ue-CapabilityRAT-RequestList contains a UE-CapabilityRAT-Request with rat-Type set to eutra-nr:
2&gt; if the UE supports (NG)EN-DC or NE-DC:
3&gt; include in the ue-CapabilityRAT-ContainerList a UE-CapabilityRAT-Container of the type UE-MRDC- Capability and with the rat-Type set to eutra-nr;
3&gt; include the supportedBandCombinationList and featureSetCombinations as specified in clause 5.6.1.4;
1&gt; if the ue-CapabilityRAT-RequestList contains a UE-CapabilityRAT-Request with rat-Type set to eutra:
2&gt; if the UE supports E-UTRA:
3&gt; include in the ue-CapabilityRAT-ContainerList a ue-CapabilityRAT-Container of the type UE-EUTRA- Capability and with the rat-Type set to eutra as specified in TS 36.331 , clause 5.6.3.3, according to the capabilityRequestFilter, if received;
1&gt; if the ue-CapabilityRAT-RequestList contains a UE-CapabilityRAT-Request with rat-Type set to utra-fdd:
2&gt; if the UE supports UTRA-FDD:
3&gt; include the UE radio access capabilities for UTRA-FDD within a ue-CapabilityRAT-Container and with the rat-Type set to utra-fdd;
1&gt; if the RRC message segmentation is enabled based on the field rrc-SegAllowed received, and the encoded RRC message is larger than the maximum supported size of a PDCP SDU specified in TS 38.323 :
2&gt; initiate the UL message segment transfer procedure as specified in clause 5.7.7;
2&gt; submit the UECapabilityInformation message to lower layers for transmission, upon which the procedure
5.6.1.4 Setting band combinations, feature set combinations and feature sets supported by the UE
The UE invokes the procedures in this clause if the NR or E-UTRA network requests UE capabilities for nr, eutra-nr or
NOTE 1: Capability enquiry without frequencyBandListFilter is not supported.
NOTE 2: In EN-DC, the gNB needs the capabilities for RAT types nr and eutra-nr and it uses the featureSets in the UE-NR-Capability together with the featureSetCombinations in the UE-MRDC-Capability to determine the NR UE capabilities for the supported MRDC band combinations. Similarly, the eNB needs the capabilities for RAT types eutra and eutra-nr and it uses the featureSetsEUTRA in the UE-EUTRA- Capability together with the featureSetCombinations in the UE-MRDC-Capability to determine the E- UTRA UE capabilities for the supported MRDC band combinations. Hence, the IDs used in the featureSets must match the IDs referred to in featureSetCombinations across all three containers. The requirement on consistency implies that there are no undefined feature sets and feature set combinations.
NOTE 3: If the UE cannot include all feature sets and feature set combinations due to message size or list size constraints, it is up to UE implementation which feature sets and feature set combinations it prioritizes.
The UE shall:
1&gt; for each band combination included in the list of "candidate band combinations":
2&gt; if the network (E-UTRA) included the eutra-nr-only field, or
2&gt; if the requested rat-Type is eutra:
3&gt; remove the NR-only band combination from the list of "candidate band combinations"; NOTE 4: The (E-UTRA) network may request capabilities for nr but indicate with the eutra-nr-only flag that the UE shall not include any NR band combinations in the UE-NR-Capability. In this case the procedural text above removes all NR-only band combinations from the candidate list and thereby also avoids inclusion of corresponding feature set combinations and feature sets below.
2&gt; if it is regarded as a fallback band combination with the same capabilities of another band combination included in the list of "candidate band combinations", and
2&gt; if this fallback band combination is generated by releasing at least one SCell or uplink configuration of SCell or SUL according to TS 38.306 :
3&gt; remove the band combination from the list of "candidate band combinations"; NOTE 5: Even if the network requests (only) capabilities for nr, it may include E-UTRA band numbers in the frequencyBandListFilter to ensure that the UE includes all necessary feature sets needed for subsequently requested eutra-nr capabilities. At this point of the procedure the list of "candidate band combinations" contains all NR- and/or E-UTRA-NR band combinations that match the filter (frequencyBandListFilter) provided by the NW and that match the eutra-nr-only flag (if RAT-Type nr is requested by E-UTRA). In the following, this candidate list is used to derive the band combinations, feature set combinations and feature sets to be reported in the requested capability container.
1&gt; if the requested rat-Type is nr:
2&gt; include into supportedBandCombinationList as many NR-only band combinations as possible from the list of "candidate band combinations", starting from the first entry;
4&gt; if SRS carrier switching is supported;
5&gt; include srs-SwitchingTimesListNR for each band combination;
2&gt; include, into featureSetCombinations, the feature set combinations referenced from the supported band combinations as included in supportedBandCombinationList according to the previous;
2&gt; compile a list of "candidate feature set combinations" referenced from the list of "candidate band combinations" excluding entries (rows in feature set combinations) with same or lower capabilities;
2&gt; if uplinkTxSwitchRequest is received:
3&gt; include into supportedBandCombinationList-UplinkTxSwitch as many NR-only band combinations that supported UL TX switching as possible from the list of "candidate band combinations", starting from the first entry;
5&gt; if SRS carrier switching is supported;
6&gt; include srs-SwitchingTimesListNR for each band combination;
3&gt; include, into featureSetCombinations, the feature set combinations referenced from the supported band combinations as included in supportedBandCombinationList-UplinkTxSwitch according to the previous; NOTE 6: This list of "candidate feature set combinations" contains the feature set combinations used for NR-only as well as E-UTRA-NR band combinations. It is used to derive a list of NR feature sets referred to from the feature set combinations in the UE-NR-Capability and from the feature set combinations in a UE- MRDC-Capability container.
2&gt; include into featureSets the feature sets referenced from the "candidate feature set combinations" and may exclude the feature sets with the parameters that exceed any of maxBandwidthRequestedDL, maxBandwidthRequestedUL, maxCarriersRequestedDL or maxCarriersRequestedUL, whichever are received;
1&gt; else, if the requested rat-Type is eutra-nr:
2&gt; include into supportedBandCombinationList and/or supportedBandCombinationListNEDC-Only as many E- UTRA-NR band combinations as possible from the list of "candidate band combinations", starting from the first entry;
4&gt; if SRS carrier switching is supported;
5&gt; include srs-SwitchingTimesListNR and srs-SwitchingTimesListEUTRA for each band combination;
2&gt; include, into featureSetCombinations, the feature set combinations referenced from the supported band combinations as included in supportedBandCombinationList according to the previous;
2&gt; if uplinkTxSwitchRequest is received:
3&gt; include into supportedBandCombinationList-UplinkTxSwitch as many E-UTRA-NR band combinations that supported UL TX switching as possible from the list of "candidate band combinations", starting from the first entry;
5&gt; if SRS carrier switching is supported;
6&gt; include srs-SwitchingTimesListNR and srs-SwitchingTimesListEUTRA for each band combination;
3&gt; include, into featureSetCombinations, the feature set combinations referenced from the supported band combinations as included in supportedBandCombinationList-UplinkTxSwitch according to the previous;
1&gt; else (if the requested rat-Type is eutra):
2&gt; compile a list of "candidate feature set combinations" referenced from the list of "candidate band combinations" excluding entries (rows in feature set combinations) with same or lower capabilities; NOTE 7: This list of "candidate feature set combinations" contains the feature set combinations used for E-UTRA- NR band combinations. It is used to derive a list of E-UTRA feature sets referred to from the feature set combinations in a UE-MRDC-Capability container.
2&gt; include into featureSetsEUTRA (in the UE-EUTRA-Capability) the feature sets referenced from the "candidate feature set combinations" and may exclude the feature sets with the parameters that exceed ca- BandwidthClassDL-EUTRA or ca-BandwidthClassUL-EUTRA, whichever are received;
1&gt; include the received frequencyBandListFilter in the field appliedFreqBandListFilter of the requested UE capability, except if the requested rat-Type is nr and the network included the eutra-nr-only field;
1&gt; if the network included ue-CapabilityEnquiryExt:
2&gt; include the received ue-CapabilityEnquiryExt in the field receivedFilters;
5.6.1.5 Void
5.7 Other
5.7.1 DL information transfer
5.7.1.1 General DLInformationTransfer
The purpose of this procedure is to transfer NAS dedicated information from NG-RAN to a UE in RRC_CONNECTED or to a UE in RRC_INACTIVE during SDT, or to transfer F1-C related information from IAB Donor-CU to IAB-DU via IAB-MT in RRC_CONNECTED.
5.7.1.2 Initiation
The network initiates the DL information transfer procedure whenever there is a need to transfer NAS dedicated information, or F1-C related information. The network initiates the DL information transfer procedure by sending the DLInformationTransfer message.
5.7.1.3 Reception of the DLInformationTransfer by the UE
Upon receiving DLInformationTransfer message, the UE shall:
2&gt; forward dedicatedNAS-Message to upper layers.
1&gt; if referenceTimeInfo is included:
2&gt; calculate the reference time based on the time, referenceSFN and timeInfoType if it is included;
2&gt; calculate the uncertainty of the reference time based on the uncertainty, if uncertainty is included;
2&gt; inform upper layers of the reference time and, if uncertainty is included, of the uncertainty;
2&gt; ignore all further referenceTimeInfo received in SIB9, if any.
2&gt; fallback to receive referenceTimeInfo in SIB9.
2&gt; calculate the propagation delay based on the UE Rx-Tx time difference measurement and the received Rx-Tx time difference measurement at the gNB;
2&gt; inform upper layers of the propagation delay.
Upon receiving DLInformationTransfer message, the IAB-MT shall:
2&gt; forward dedicatedInfoF1c to the IAB-DU.
5.7.1a DL information transfer for MR-DC
5.7.1a.1 General DLInformationTransferMRDC
The purpose of this procedure is to transfer RRC messages from the network to the UE over SRB3 (e.g. an NR RRC reconfiguration message including reconfigurationWithSync, an E-UTRA RRC connection reconfiguration message including mobilityControlInfo, an RRC connection release message, a MobilityFromNRCommand message, or a MobilityFromEUTRACommand message) during fast MCG link recovery.
5.7.1a.2 Initiation
The network initiates this procedure whenever there is a need to transfer an RRC message during fast MCG link
5.7.1a.3 Actions related to reception of DLInformationTransferMRDC message
Upon receiving the DLInformationTransferMRDC, the UE shall:
1&gt; if the RRCReconfiguration message is included in dl-DCCH-MessageNR:
2&gt; perform the RRC reconfiguration procedure according to 5.3.5.3;
1&gt; else if the RRCRelease message is included in dl-DCCH-MessageNR:
2&gt; perform the RRC release procedure according to 5.3.8;
1&gt; else if the MobilityFromNRCommand message is included in the dl-DCCH-MessageNR:
2&gt; perform the mobility from NR procedure according to 5.4.3.3;
1&gt; else if the E-UTRA RRCConnectionReconfiguration message is included in dl-DCCH-MessageEUTRA:
2&gt; perform the RRC connection reconfiguration procedure as specified in TS 36.331 , clause 5.3.5.4;
1&gt; else if the E-UTRA RRCConnectionRelease message is included in dl-DCCH-MessageEUTRA:
2&gt; perform the RRC connection release as specified in TS 36.331 , clause 5.3.8;
1&gt; else if the MobilityFromEUTRACommand message is included in the dl-DCCH-MessageEUTRA:
2&gt; perform the mobility from E-UTRA procedure as specified in TS 36.331 , clause 5.4.3.3;
5.7.2 UL information transfer
5.7.2.1 General ULInformationTransfer
The purpose of this procedure is to transfer NAS dedicated information from the UE to the network, or to transfer F1-C related information from IAB-DU to IAB Donor-CU via IAB-MT in RRC CONNECTED.
5.7.2.2 Initiation
A UE in RRC_CONNECTED or a UE in RRC_INACTIVE during SDT initiates the UL information transfer procedure whenever there is a need to transfer NAS dedicated information. The UE initiates the UL information transfer procedure by sending the ULInformationTransfer message. In addition, an IAB-MT in RRC CONNECTED initiates the UL information transfer procedure whenever there is a need to transfer F1-C related information. When F1-C related information has to be transferred, the IAB-MT shall initiate the procedure only if SBR2 or split SRB2 is established.
5.7.2.3 Actions related to transmission of ULInformationTransfer message
The UE shall set the contents of the ULInformationTransfer message as follows:
1&gt; if the upper layer provides NAS PDU:
2&gt; set the dedicatedNAS-Message to include the information received from upper layers;
1&gt; for the IAB-MT, if there is a need to transfer F1-C related information:
2&gt; include the dedicatedInfoF1c;
1&gt; submit the ULInformationTransfer message to lower layers for transmission, upon which the procedure ends.
5.7.2.4 Failure to deliver ULInformationTransfer message
The UE shall:
1&gt; if AS security is not started and radio link failure occurs before the successful delivery of ULInformationTransfer messages has been confirmed by lower layers; or
1&gt; if PDCP re-establishment or release/addition (e.g due to key refresh upon PCell or PSCell change, or RRC connection re-establishment, or failure of resume procedure initiated for SDT) occurs on an SRB on which ULInformationTransfer messages were submitted for transmission but successful delivery of these messages was not confirmed by lower layers:
2&gt; inform upper layers about the possible failure to deliver the information contained in the concerned ULInformationTransfer messages, unless the messages only include dedicatedInfoF1c.
5.7.2a UL information transfer for MR-DC
5.7.2a.1 General ULInformationTransferMRDC
The purpose of this procedure is to transfer MR-DC dedicated information from the UE to the network e.g. the NR or E- UTRA RRC MeasurementReport, FailureInformation, UEAssistanceInformation, RRCReconfigurationComplete or MCGFailureInformation message.
5.7.2a.2 Initiation
A UE in RRC_CONNECTED initiates the UL information transfer for MR-DC procedure whenever there is a need to transfer MR-DC dedicated information. I.e. the procedure is not used during an RRC connection reconfiguration involving NR or E-UTRA connection reconfiguration, in which case the MR DC information is piggybacked to the RRCReconfigurationComplete message, except in the case the UE executes an intra-SN CPC.
5.7.2a.3 Actions related to transmission of ULInformationTransferMRDC message
The UE shall set the contents of the ULInformationTransferMRDC message as follows:
1&gt; if there is a need to transfer MR-DC dedicated information related to NR:
2&gt; set the ul-DCCH-MessageNR to include the NR MR-DC dedicated information to be transferred (e.g., NR RRC MeasurementReport, UEAssistanceInformation, FailureInformation, RRCReconfigurationComplete or MCGFailureInformation message);
1&gt; else if there is a need to transfer MR-DC dedicated information related to E-UTRA:
2&gt; set the ul-DCCH-MessageEUTRA to include the E-UTRA MR-DC dedicated information to be transferred (e.g., E-UTRA RRC MeasurementReport, or MCGFailureInformation message);
1&gt; submit the ULInformationTransferMRDC message to lower layers for transmission, upon which the procedure
5.7.2b UL transfer of IRAT information
5.7.2b.1 General UE NR ULInformationTransferIRAT
The purpose of this procedure is to transfer from the UE to NR MCG dedicated information terminated at the NR MCG but specified by another RAT e.g. the E-UTRA MeasurementReport message, the E-UTRA SidelinkUEInformation message or the E-UTRA UEAssistanceInformation message. The specific information transferred in this message is set in accordance with: a) the procedure specified in 5.6.10 of TS 36.331 for E-UTRA UEAssistanceInformation message; b) the procedure specified in 5.10.2 of TS 36.331 for E-UTRA SidelinkUEInformation message; c) the procedure specified in 5.5.5 of TS 36.331 for E-UTRA MeasurementReport Message.
5.7.2b.2 Initiation
A UE in RRC_CONNECTED initiates the UL information transfer procedure whenever there is a need to transfer dedicated inter-RAT information as specified in TS 36.331 .
5.7.2b.3 Actions related to transmission of ULInformationTransferIRAT message
The UE shall set the contents of the ULInformationTransferIRAT message as follows:
1&gt; if there is a need to transfer dedicated LTE information related to V2X sidelink communications:
2&gt; set the ul-DCCH-MessageEUTRA to include the V2X sidelink communication information to be transferred (e.g. the E-UTRA RRC MeasurementReport message, the E-UTRA RRC SidelinkUEInformation message, or the E-UTRA RRC UEAssistanceInformation message);
1&gt; submit the ULInformationTransferIRAT message to lower layers for transmission, upon which the procedure ends;
5.7.3 SCG failure information
5.7.3.1 General RRC reconfiguration SCGFailureInformation
The purpose of this procedure is to inform E-UTRAN or NR MN about an SCG failure the UE has experienced i.e.
SCG radio link failure, failure of SCG reconfiguration with sync, SCG configuration failure for RRC message on SRB3, SCG integrity check failure, and consistent uplink LBT failures on PSCell for operation with shared spectrum channel access.
5.7.3.2 Initiation
A UE initiates the procedure to report SCG failures when neither MCG nor SCG transmission is suspended and when one of the following conditions is met:
1&gt; upon detecting radio link failure for the SCG, in accordance with clause 5.3.10.3;
1&gt; upon detecting beam failure of the PSCell while the SCG is deactivated, in accordance with TS 38.321;
1&gt; upon reconfiguration with sync failure of the SCG, in accordance with clause 5.3.5.8.3;
1&gt; upon SCG configuration failure, in accordance with clause 5.3.5.8.2;
1&gt; upon integrity check failure indication from SCG lower layers concerning SRB3.
Upon initiating the procedure, the UE shall:
1&gt; if the procedure was not initiated due to beam failure of the PSCell while the SCG is deactivated:
2&gt; suspend SCG transmission for all SRBs, DRBs and, if any, BH RLC channels;
2&gt; reset SCG MAC;
1&gt; stop T304 for the SCG, if running;
1&gt; stop conditional reconfiguration evaluation for CPC, if configured;
1&gt; if the UE is in (NG)EN-DC:
2&gt; initiate transmission of the SCGFailureInformationNR message as specified in TS 36.331 , clause
2&gt; initiate transmission of the SCGFailureInformation message in accordance with 5.7.3.5.
5.7.3.3 Failure type determination for (NG)EN-DC
The UE shall set the SCG failure type as follows:
1&gt; if the UE initiates transmission of the SCGFailureInformationNR message due to T310 expiry:
2&gt; set the failureType as t310-Expiry;
1&gt; else if the UE initiates transmission of the SCGFailureInformationNR message due to T312 expiry:
2&gt; set the failureType as any value and set the failureType-v1610 as t312-Expiry;
1&gt; else if the UE initiates transmission of the SCGFailureInformationNR message to provide reconfiguration with sync failure information for an SCG:
2&gt; set the failureType as synchReconfigFailureSCG;
1&gt; else if the UE initiates transmission of the SCGFailureInformationNR message to provide random access problem indication from SCG MAC:
2&gt; if the random access procedure was initiated for beam failure recovery:
3&gt; set the failureType as randomAccessProblem and set the failureType-v1610 as beamFailureRecoveryFailure;
3&gt; set the failureType as randomAccessProblem;
1&gt; else if the UE initiates transmission of the SCGFailureInformationNR message to provide indication from SCG RLC that the maximum number of retransmissions has been reached:
2&gt; set the failureType as rlc-MaxNumRetx;
1&gt; else if the UE initiates transmission of the SCGFailureInformationNR message due to SRB3 integrity check failure:
2&gt; set the failureType as srb3-IntegrityFailure;
1&gt; else if the UE initiates transmission of the SCGFailureInformationNR message due to Reconfiguration failure of NR RRC reconfiguration message:
2&gt; set the failureType as scg-reconfigFailure;
1&gt; else if the UE initiates transmission of the SCGFailureInformationNR message due to consistent uplink LBT failures:
2&gt; set the failureType as any value and set the failureType-v1610 as scg-lbtFailure;
1&gt; else if connected as an IAB-node and the SCGFailureInformationNR is initiated due to the reception of a BH RLF indication on BAP entity from the SCG:
2&gt; set the failureType as any value and set failureType-v1610 as bh-RLF.
1&gt; else if the UE initiates transmission of the SCGFailureInformationNR message due to beam failure of the PSCell while the SCG is deactivated:
2&gt; set the failureType as any value and set failureType-v1610 as beamFailure.
5.7.3.4 Setting the contents of MeasResultSCG-Failure
The UE shall set the contents of the MeasResultSCG-Failure as follows:
1&gt; for each MeasObjectNR configured on NR SCG for which a measId is configured and measurement results are available:
2&gt; include an entry in measResultPerMOList;
2&gt; if there is a measId configured with the MeasObjectNR and a reportConfig which has rsType set to ssb:
3&gt; set ssbFrequency to the value indicated by ssbFrequency as included in the MeasObjectNR;
2&gt; if there is a measId configured with the MeasObjectNR and a reportConfig which has rsType set to csi-rs:
3&gt; set refFreqCSI-RS to the value indicated by refFreqCSI-RS as included in the associated measurement object;
2&gt; if a serving cell is associated with the MeasObjectNR:
3&gt; set measResultServingCell to include the available quantities of the concerned cell and in accordance with the performance requirements in TS 38.133 ;
2&gt; set the measResultNeighCellList to include the best measured cells, ordered such that the best cell is listed first, and based on measurements collected up to the moment the UE detected the failure, and set its fields as follows;
3&gt; ordering the cells with sorting as follows:
4&gt; based on SS/PBCH block if SS/PBCH block measurement results are available and otherwise based on CSI-RS;
4&gt; using RSRP if RSRP measurement results are available, otherwise using RSRQ if RSRQ measurement results are available, otherwise using SINR;
3&gt; for each neighbour cell included:
4&gt; include the optional fields that are available.
NOTE: The measured quantities are filtered by the L3 filter as configured in the mobility measurement
configuration. The measurements are based on the time domain measurement resource restriction, if
configured. Exclude-listed cells are not required to be reported.
2&gt; if available, set the locationInfo as in 5.3.3.7.:
5.7.3.5 Actions related to transmission of SCGFailureInformation message
The UE shall set the contents of the SCGFailureInformation message as follows:
1&gt; if the UE initiates transmission of the SCGFailureInformation message due to T310 expiry:
2&gt; set the failureType as t310-Expiry;
1&gt; else if the UE initiates transmission of the SCGFailureInformation message due to T312 expiry:
2&gt; set the failureType as other and set the failureType-v1610 as t312-Expiry;
1&gt; else if the UE initiates transmission of the SCGFailureInformation message to provide reconfiguration with sync failure information for an SCG:
2&gt; set the failureType as synchReconfigFailureSCG;
1&gt; else if the UE initiates transmission of the SCGFailureInformation message to provide random access problem indication from SCG MAC:
2&gt; if the random access procedure was initiated for beam failure recovery:
3&gt; set the failureType as other and set the failureType-v1610 as beamFailureRecoveryFailure;
3&gt; set the failureType as randomAccessProblem;
1&gt; else if the UE initiates transmission of the SCGFailureInformation message to provide indication from SCG RLC that the maximum number of retransmissions has been reached:
2&gt; set the failureType as rlc-MaxNumRetx;
1&gt; else if the UE initiates transmission of the SCGFailureInformation message due to SRB3 IP check failure:
2&gt; set the failureType as srb3-IntegrityFailure;
1&gt; else if the UE initiates transmission of the SCGFailureInformation message due to Reconfiguration failure of NR RRC reconfiguration message:
2&gt; set the failureType as scg-reconfigFailure;
1&gt; else if the UE initiates transmission of the SCGFailureInformation message due to consistent uplink LBT failures:
2&gt; set the failureType as other and set the failureType-v1610 as scg-lbtFailure;
1&gt; else if connected as an IAB-node and the SCGFailureInformation is initiated due to the reception of a BH RLF indication on BAP entity from the SCG:
2&gt; set the failureType as other and set failureType-v1610 as bh-RLF;
1&gt; include and set MeasResultSCG-Failure in accordance with 5.7.3.4;
1&gt; for each MeasObjectNR configured by a MeasConfig associated with the MCG, and for which measurement results are available:
2&gt; include an entry in measResultFreqList;
2&gt; if there is a measId configured with the MeasObjectNR and a reportConfig which has rsType set to ssb:
3&gt; set ssbFrequency in measResultFreqList to the value indicated by ssbFrequency as included in the MeasObjectNR;
2&gt; if there is a measId configured with the MeasObjectNR and a reportConfig which has rsType set to csi-rs:
3&gt; set refFreqCSI-RS in measResultFreqList to the value indicated by refFreqCSI-RS as included in the associated measurement object;
2&gt; if a serving cell is associated with the MeasObjectNR:
3&gt; set measResultServingCell in measResultFreqList to include the available quantities of the concerned cell and in accordance with the performance requirements in TS 38.133 ;
2&gt; set the measResultNeighCellList in measResultFreqList to include the best measured cells, ordered such that the best cell is listed first, and based on measurements collected up to the moment the UE detected the failure, and set its fields as follows;
3&gt; ordering the cells with sorting as follows:
4&gt; based on SS/PBCH block if SS/PBCH block measurement results are available and otherwise based on CSI-RS;
4&gt; using RSRP if RSRP measurement results are available, otherwise using RSRQ if RSRQ measurement results are available, otherwise using SINR;
3&gt; for each neighbour cell included:
4&gt; include the optional fields that are available.
NOTE 1: The measured quantities are filtered by the L3 filter as configured in the mobility measurement
configuration. The measurements are based on the time domain measurement resource restriction, if
configured. Exclude-listed cells are not required to be reported.
NOTE 2: Field measResultSCG-Failure is used to report available results for NR frequencies the UE is configured to measure by SCG RRC signalling.
1&gt; if available, set the locationInfo as in 5.3.3.7.
1&gt; if the UE supports SCG failure for mobility robustness optimization:
2&gt; if the failureType is set to synchReconfigFailureSCG; or
2&gt; if the failureType is set to randomAccessProblem and the SCG failure was declared while T304 was running:
3&gt; set perRAInfoList to indicate the performed random access procedure related information as specified in
3&gt; set the failedPSCellId to the physical cell identity and carrier frequency of the target PSCell of the failed PSCell change;
3&gt; set the previousPSCellId to the physical cell identity and carrier frequency of the source PSCell where the last RRCReconfiguration message including reconfigurationWithSync for the SCG was received;
3&gt; set the timeSCGFailure to the elapsed time since reception of the last RRCReconfiguration message including the reconfigurationWithSync for the SCG;
3&gt; set the failedPSCellId to the physical cell identity and carrier frequency of the PSCell in which the SCG failure was declared;
3&gt; if the last RRCReconfiguration message including the reconfigurationWithSync for the SCG was received to enter the PSCell in which the SCG failure was declared:
4&gt; set the timeSCGFailure to the elapsed time since reception of the last RRCReconfiguration message including the reconfigurationWithSync for the SCG;
4&gt; set the previousPSCellId to the physical cell identity and carrier frequency of the PSCell where the last RRCReconfiguration message including reconfigurationWithSync for the SCG was received; The UE shall submit the SCGFailureInformation message to lower layers for transmission.
5.7.3a EUTRA SCG failure information
5.7.3a.1 General RRC reconfiguration SCGFailureInformationEUTRA
The purpose of this procedure is to inform NR MN about an SCG failure on E-UTRA SN the UE has experienced (e.g.
SCG radio link failure, SCG change failure), as specified in TS 36.331 clause 5.6.13.2.
5.7.3a.2 Initiation
A UE initiates the procedure to report EUTRA SCG failures when neither NR MCG nor EUTRA SCG transmission is suspended and in accordance with TS 36.331 clause 5.6.13.2. Actions the UE shall perform upon initiating the procedure, other than related to the transmission of the SCGFailureInformationEUTRA message are specified in TS
5.7.3a.3 Actions related to transmission of SCGFailureInformationEUTRA message
The UE shall set the contents of the SCGFailureInformationEUTRA message as follows:
1&gt; include failureType within failureReportSCG-EUTRA and set it to indicate the SCG failure in accordance with TS 36.331 clause 5.6.13.4;
1&gt; include and set measResultSCG-FailureMRDC in accordance with TS 36.331 clause 5.6.13.5;
1&gt; for each EUTRA frequency the UE is configured to measure by measConfig for which measurement results are available:
2&gt; set the measResultFreqListMRDC to include the best measured cells, ordered such that the best cell is listed first using RSRP to order if RSRP measurement results are available for cells on this frequency, otherwise using RSRQ to order if RSRQ measurement results are available for cells on this frequency, otherwise using SINR to order, and based on measurements collected up to the moment the UE detected the failure, and for each cell that is included, include the optional fields that are available; NOTE: Field measResultSCG-FailureMRDC is used to report available results for E-UTRAN frequencies the UE is configured to measure by E-UTRA RRC signalling.
1&gt; if available, set the locationInfo as in 5.3.3.7.:
The UE shall submit the SCGFailureInformationEUTRA message to lower layers for transmission.
5.7.3b MCG failure information
5.7.3b.1 General UE Network RRC reconfiguration MCGFailureInformation
The purpose of this procedure is to inform the network about an MCG failure the UE has experienced i.e. MCG radio link
failure. A UE in RRC_CONNECTED, for which AS security has been activated with SRB2 and at least one DRB or multicast MRB setup or, for IAB, SRB2, may initiate the fast MCG link recovery procedure in order to continue the RRC connection without re-establishment.
5.7.3b.2 Initiation
A UE configured with split SRB1 or SRB3 initiates the procedure to report MCG failures when neither MCG nor SCG transmission is suspended, the SCG is not deactivated, t316 is configured, and when the following condition is met:
1&gt; upon detecting radio link failure of the MCG, in accordance with 5.3.10.3, while T316 is not running.
Upon initiating the procedure, the UE shall:
1&gt; stop timer T310 for the PCell, if running;
1&gt; stop timer T312 for the PCell, if running;
1&gt; suspend MCG transmission for all SRBs, DRBs, multicast MRBs, except SRB0, and, if any, BH RLC channels;
1&gt; reset MCG MAC;
1&gt; stop conditional reconfiguration evaluation for CHO, if configured;
1&gt; stop conditional reconfiguration evaluation for CPC, if configured;
1&gt; initiate transmission of the MCGFailureInformation message in accordance with 5.7.3b.4.
NOTE: The handling of any outstanding UL RRC messages during the initiation of the fast MCG link recovery is left to UE implementation.
5.7.3b.3 Failure type determination
The UE shall set the MCG failure type as follows:
1&gt; if the UE initiates transmission of the MCGFailureInformation message due to T310 expiry:
2&gt; set the failureType as t310-Expiry;
1&gt; else if the UE initiates transmission of the MCGFailureInformation message due to T312 expiry:
2&gt; set the failureType as t312-Expiry;
1&gt; else if the UE initiates transmission of the MCGFailureInformation message to provide random access problem indication from MCG MAC:
2&gt; if the random access procedure was initiated for beam failure recovery:
3&gt; set the failureType as beamFailureRecoveryFailure;
3&gt; set the failureType as randomAccessProblem;
1&gt; else if the UE initiates transmission of the MCGFailureInformation message to provide indication from MCG RLC that the maximum number of retransmissions has been reached:
2&gt; set the failureType as rlc-MaxNumRetx:
1&gt; else if the UE initiates transmission of the MCGFailureInformation message due to consistent uplink LBT failures on the MCG:
2&gt; set the failureType as lbt-Failure;
1&gt; else if connected as an IAB-node and the MCGFailureInformation message is initiated due to the reception of a BH RLF indication on BAP entity from the MCG:
2&gt; set the failureType as bh-RLF.
5.7.3b.4 Actions related to transmission of MCGFailureInformation message
The UE shall set the contents of the MCGFailureInformation message as follows:
1&gt; include and set failureType in accordance with 5.7.3b.3;
1&gt; for each MeasObjectNR configured by a measConfig associated with the MCG, and for which measurement results are available:
2&gt; include an entry in measResultFreqList;
2&gt; if there is a measId configured with the MeasObjectNR and a reportConfig which has rsType set to ssb:
3&gt; set ssbFrequency in measResultFreqList to the value indicated by ssbFrequency as included in the MeasObjectNR;
2&gt; if there is a measId configured with the MeasObjectNR and a reportConfig which has rsType set to csi-rs:
3&gt; set refFreqCSI-RS in measResultFreqList to the value indicated by refFreqCSI-RS as included in the associated measurement object;
2&gt; if a serving cell is associated with the MeasObjectNR:
3&gt; set measResultServingCell in measResultFreqList to include the available quantities of the concerned cell and in accordance with the performance requirements in TS 38.133 ;
2&gt; set the measResultNeighCellList in measResultFreqList to include the best measured cells, ordered such that the best cell is listed first, and based on measurements collected up to the moment the UE detected the failure, and set its fields as follows;
3&gt; ordering the cells with sorting as follows:
4&gt; based on SS/PBCH block if SS/PBCH block measurement results are available and otherwise based on CSI-RS;
4&gt; using RSRP if RSRP measurement results are available, otherwise using RSRQ if RSRQ measurement results are available, otherwise using SINR;
3&gt; for each neighbour cell included:
4&gt; include the optional fields that are available.
1&gt; for each EUTRA frequency the UE is configured to measure by measConfig for which measurement results are available:
2&gt; set the measResultFreqListEUTRA to include the best measured cells, ordered such that the best cell is listed first using RSRP to order the cells if RSRP measurement results are available for cells on this frequency, otherwise using RSRQ to order the cells if RSRQ measurement results are available for cells on this frequency, otherwise using SINR to order the cells, based on measurements collected up to the moment the UE detected the failure, and for each cell that is included, include the optional fields that are available;
1&gt; for each UTRA-FDD frequency the UE is configured to measure by measConfig for which measurement results are available:
2&gt; set the measResultFreqListUTRA-FDD to include the best measured cells, ordered such that the best cell is listed first using RSCP to order the cells if RSCP measurement results are available for cells on this frequency, otherwise using EcN0 to order the cells, based on measurements collected up to the moment the UE detected the failure, and for each cell that is included, include the optional fields that are available;
1&gt; if the UE is in NR-DC:
2&gt; include and set measResultSCG in accordance with 5.7.3.4;
1&gt; if the UE is in NE-DC:
2&gt; include and set measResultSCG-EUTRA in accordance with TS 36.331 clause 5.6.13.5; NOTE 1: The measured quantities are filtered by the L3 filter as configured in the mobility measurement
configuration. The measurements are based on the time domain measurement resource restriction, if
configured. Exclude-listed cells are not required to be reported.
NOTE 2: Field measResultSCG-Failure is used to report available results for NR frequencies the UE is configured to measure by SCG RRC signalling.
NOTE 3: Field measResultSCG-EUTRA is used to report available results for E-UTRAN frequencies the UE is configured to measure by E-UTRA RRC signalling.
1&gt; if SRB1 is configured as split SRB and pdcp-Duplication is not configured:
2&gt; if the primaryPath for the PDCP entity of SRB1 refers to the MCG:
3&gt; set the primaryPath to refer to the SCG.
The UE shall:
1&gt; start timer T316;
1&gt; if SRB1 is configured as split SRB:
2&gt; submit the MCGFailureInformation message to lower layers for transmission via SRB1, upon which the procedure ends;
2&gt; submit the MCGFailureInformation message to lower layers for transmission embedded in NR RRC message ULInformationTransferMRDC via SRB3 as specified in 5.7.2a.3.
The UE shall:
2&gt; initiate the connection re-establishment procedure as specified in 5.3.7.
5.7.4 UE Assistance Information
5.7.4.1 General RRCReconfiguration UEAssistanceInformation
The purpose of this procedure is for the UE to inform the network of: a) its delay budget report carrying desired increment/decrement in the connected mode DRX cycle length, or; b) its overheating assistance information, or; c) its IDC assistance information, or; d) its preference on DRX parameters for power saving, or; e) its preference on the maximum aggregated bandwidth for power saving, or; f) its preference on the maximum number of secondary component carriers for power saving, or; g) its preference on the maximum number of MIMO layers for power saving, or; h) its preference on the minimum scheduling offset for cross-slot scheduling for power saving, or; i) its preference on the RRC state, or; j) configured grant assistance information for NR sidelink communication, or; k) its preference in being provisioned with reference time information, or; l) its preference for FR2 UL gap, or; m) its preference to transition out of RRC_CONNECTED state for MUSIM operation, or; n) its preference on the MUSIM gaps, or; o) its relaxation state for RLM measurements, or; p) its relaxation state for BFD measurements, or; q) availability of data mapped to radio bearers which are not configured for SDT, or; r) its preference for the SCG to be deactivated, or; s) indicate that the UE has uplink data to transmit for a DRB for which there is no MCG RLC bearer while the SCG is deactivated, or; t) change of its fulfilment status for RRM measurement relaxation criterion.
5.7.4.2 Initiation
A UE capable of providing delay budget report in RRC_CONNECTED may initiate the procedure in several cases, including upon being configured to provide delay budget report and upon change of delay budget preference.
A UE capable of providing overheating assistance information in RRC_CONNECTED may initiate the procedure if it was configured to do so, upon detecting internal overheating, or upon detecting that it is no longer experiencing an overheating condition.
A UE capable of providing IDC assistance information in RRC_CONNECTED may initiate the procedure if it was configured to do so, upon detecting IDC problem if the UE did not transmit an IDC assistance information since it was configured to provide IDC indications, or upon change of IDC problem information.
A UE capable of providing its preference on DRX parameters of a cell group for power saving in RRC_CONNECTED may initiate the procedure in several cases, if it was configured to do so, including upon having a preference on DRX parameters and upon change of its preference on DRX parameters.
A UE capable of providing its preference on the maximum aggregated bandwidth of a cell group for power saving in RRC_CONNECTED may initiate the procedure in several cases, if it was configured to do so, including upon having a maximum aggregated bandwidth preference and upon change of its maximum aggregated bandwidth preference.
A UE capable of providing its preference on the maximum number of secondary component carriers of a cell group for power saving in RRC_CONNECTED may initiate the procedure in several cases, if it was configured to do so, including upon having a maximum number of secondary component carriers preference and upon change of its maximum number of secondary component carriers preference.
A UE capable of providing its preference on the maximum number of MIMO layers of a cell group for power saving in RRC_CONNECTED may initiate the procedure in several cases, if it was configured to do so, including upon having a maximum number of MIMO layers preference and upon change of its maximum number of MIMO layers preference.
A UE capable of providing its preference on the minimum scheduling offset for cross-slot scheduling of a cell group for power saving in RRC_CONNECTED may initiate the procedure in several cases, if it was configured to do so, including upon having a minimum scheduling offset preference and upon change of its minimum scheduling offset
A UE capable of providing assistance information to transition out of RRC_CONNECTED state may initiate the procedure if it was configured to do so, upon determining that it prefers to transition out of RRC_CONNECTED state, or upon change of its preferred RRC state.
A UE capable of providing configured grant assistance information for NR sidelink communication in RRC_CONNECTED may initiate the procedure in several cases, including upon being configured to provide traffic pattern information and upon change of traffic patterns.
A UE capable of providing an indication of its preference in being provisioned with reference time information may initiate the procedure upon being configured to provide this indication, or if it was configured to provide this indication and upon change of its preference.
A UE capable of providing an indication of its preference in FR2 UL gap may initiate the procedure if it was configured to do so, upon detecting the need of FR2 UL gap activation/deactivation.
A UE capable of providing MUSIM assistance information may initiate the procedure if it was configured to do so, upon determining that it needs to leave RRC_CONNECTED state, or upon determining it needs the gaps, or upon change of the gap information without leaving RRC_CONNECTED state.
A UE capable of relaxing its RLM measurements of a cell group in RRC_CONNECTED state shall initiate the procedure for providing an indication of its relaxation state for RLM measurements upon being configured to do so, and upon change of its relaxation state for RLM measurements in RRC_CONNECTED state.
A UE capable of relaxing its BFD measurements in serving cells of a cell group in RRC_CONNECTED shall initiate the procedure for providing an indication of its relaxation state for BFD measurements upon being configured to do so, and upon change of its relaxation state for BFD measurements in RRC_CONNECTED state.
Editor's NOTE: How to / whether to limit or remove impact of prohibit timer w.r.t. consistency between UE relaxation state and the corresponding knowledge at gNB.
A UE capable of SDT initiates this procedure when data and/or signalling mapped to radio bearers that are not configured for SDT becomes available during SDT (i.e. while T319a is running).
A UE capable of providing its preference for SCG deactivation may initiate the procedure if it was configured to do so, upon determining that it prefers or does no more prefer the SCG to be deactivated.
A UE capable of providing an indication of fulfilment of the RRM measurement relaxation criterion in connected mode may initiate the procedure upon change of its fulfilment status for RRM measurement relaxation criterion for connected
Upon initiating the procedure, the UE shall:
1&gt; if configured to provide delay budget report:
2&gt; if the UE did not transmit a UEAssistanceInformation message with delayBudgetReport since it was configured to provide delay budget report; or
2&gt; if the current delay budget is different from the one indicated in the last transmission of the UEAssistanceInformation message including delayBudgetReport and timer T342 is not running:
3&gt; start or restart timer T342 with the timer value set to the delayBudgetReportingProhibitTimer;
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide a delay budget report;
1&gt; if configured to provide overheating assistance information:
2&gt; if the overheating condition has been detected and T345 is not running; or
2&gt; if the current overheating assistance information is different from the one indicated in the last transmission of the UEAssistanceInformation message including overheatingAssistance and timer T345 is not running:
3&gt; start timer T345 with the timer value set to the overheatingIndicationProhibitTimer;
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide overheating assistance information;
1&gt; if configured to provide IDC assistance information:
2&gt; if the UE did not transmit a UEAssistanceInformation message with idc-Assistance since it was configured to provide IDC assistance information:
3&gt; if on one or more frequencies included in candidateServingFreqListNR, the UE is experiencing IDC problems that it cannot solve by itself; or
3&gt; if on one or more supported UL CA combination comprising of carrier frequencies included in candidateServingFreqListNR, the UE is experiencing IDC problems that it cannot solve by itself:
4&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide IDC assistance information;
2&gt; else if the current IDC assistance information is different from the one indicated in the last transmission of the UEAssistanceInformation message:
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide IDC assistance information; NOTE 1: The term "IDC problems" refers to interference issues applicable across several subframes/slots where not necessarily all the subframes/slots are affected.
NOTE 2: For the frequencies on which a serving cell or serving cells is configured that is activated, IDC problems consist of interference issues that the UE cannot solve by itself, during either active data exchange or upcoming data activity which is expected in up to a few hundred milliseconds.
For frequencies on which a SCell or SCells is configured that is deactivated, reporting IDC problems indicates an anticipation that the activation of the SCell or SCells would result in interference issues that the UE would not be able to solve by itself.
For a non-serving frequency, reporting IDC problems indicates an anticipation that if the non-serving frequency or frequencies became a serving frequency or serving frequencies then this would result in interference issues that the UE would not be able to solve by itself.
1&gt; if configured to provide its preference on DRX parameters of a cell group for power saving:
2&gt; if the UE has a preference on DRX parameters of the cell group and the UE did not transmit a UEAssistanceInformation message with drx-Preference for the cell group since it was configured to provide its preference on DRX parameters of the cell group for power saving; or
2&gt; if the current drx-Preference information for the cell group is different from the one indicated in the last transmission of the UEAssistanceInformation message including drx-Preference for the cell group and timer
T346a associated with the cell group is not running:
3&gt; start the timer T346a with the timer value set to the drx-PreferenceProhibitTimer of the cell group;
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide the current drx-Preference;
1&gt; if configured to provide its preference on the maximum aggregated bandwidth of a cell group for power saving:
2&gt; if the UE has a preference on the maximum aggregated bandwidth of the cell group and the UE did not transmit a UEAssistanceInformation message with maxBW-Preference and/or maxBW-PreferenceFR2-2 for the cell group since it was configured to provide its preference on the maximum aggregated bandwidth of the cell group for power saving; or
2&gt; if the current maxBW-Preference information for the cell group is different from the one indicated in the last transmission of the UEAssistanceInformation message including maxBW-Preference and/or maxBW- PreferenceFR2-2for the cell group and timer T346b associated with the cell group is not running:
3&gt; start the timer T346b with the timer value set to the maxBW-PreferenceProhibitTimer of the cell group;
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide the current maxBW-Preference and/or maxBW-PreferenceFR2-2;
1&gt; if configured to provide its preference on the maximum number of secondary component carriers of a cell group for power saving:
2&gt; if the UE has a preference on the maximum number of secondary component carriers of the cell group and the UE did not transmit a UEAssistanceInformation message with maxCC-Preference for the cell group since it was configured to provide its preference on the maximum number of secondary component carriers of the cell group for power saving; or
2&gt; if the current maxCC-Preference information for the cell group is different from the one indicated in the last transmission of the UEAssistanceInformation message including maxCC-Preference for the cell group and timer T346c associated with the cell group is not running:
3&gt; start the timer T346c with the timer value set to the maxCC-PreferenceProhibitTimer of the cell group;
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide the current maxCC-Preference;
1&gt; if configured to provide its preference on the maximum number of MIMO layers of a cell group for power saving:
2&gt; if the UE has a preference on the maximum number of MIMO layers of the cell group and the UE did not transmit a UEAssistanceInformation message with maxMIMO-LayerPreference and/or maxMIMO- LayerPreferenceFR2-2 for the cell group since it was configured to provide its preference on the maximum number of MIMO layers of the cell group for power saving; or
2&gt; if the current maxMIMO-LayerPreference information for the cell group is different from the one indicated in the last transmission of the UEAssistanceInformation message including maxMIMO-LayerPreference and/or maxMIMO-LayerPreferenceFR2-2 for the cell group and timer T346d associated with the cell group is not running:
3&gt; start the timer T346d with the timer value set to the maxMIMO-LayerPreferenceProhibitTimer of the cell group;
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide the current maxMIMO-LayerPreference and/or maxMIMO-LayerPreferenceFR2-2;
1&gt; if configured to provide its preference on the minimum scheduling offset for cross-slot scheduling of a cell group for power saving:
2&gt; if the UE has a preference on the minimum scheduling offset for cross-slot scheduling of the cell group and the UE did not transmit a UEAssistanceInformation message with minSchedulingOffsetPreference and/or minSchedulingOffsetPreferenceExt for the cell group since it was configured to provide its preference on the minimum scheduling offset for cross-slot scheduling of the cell group for power saving; or
2&gt; if the current minSchedulingOffsetPreference and/or minSchedulingOffsetPreferenceExt information for the cell group is different from the one indicated in the last transmission of the UEAssistanceInformation message including minSchedulingOffsetPreference and/or minSchedulingOffsetPreferenceExt for the cell group and timer T346e associated with the cell group is not running:
3&gt; start the timer T346e with the timer value set to the minSchedulingOffsetPreferenceProhibitTimer of the cell group;
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide the current minSchedulingOffsetPreference and/or minSchedulingOffsetPreferenceExt;
1&gt; if configured to provide its release preference and timer T346f is not running:
2&gt; if the UE determines that it would prefer to transition out of RRC_CONNECTED state; or
2&gt; if the UE is configured with connectedReporting and the UE determines that it would prefer to revert an earlier indication to transition out of RRC_CONNECTED state:
3&gt; start timer T346f with the timer value set to the releasePreferenceProhibitTimer;
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide the release preference;
1&gt; if configured to provide configured grant assistance information for NR sidelink communication:
2&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide configured grant assistance information for NR sidelink communication;
1&gt; if configured to provide preference in being provisioned with reference time information:
2&gt; if the UE did not transmit a UEAssistanceInformation message with referenceTimeInfoPreference since it was configured to provide preference; or
2&gt; if the UE's preference changed from the last time UE initiated transmission of the UEAssistanceInformation message including referenceTimeInfoPreference:
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide preference in being provisioned with reference time information.
1&gt; if configured to provide its preference on FR2 UL gap:
2&gt; if the UE did not transmit a UEAssistanceInformation message with ul-GapFR2-Preference since it was configured to provide its preference on FR2 UL gap information:
3&gt; if the UE has a preference on FR2 UL gap activation/deactivation:
4&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide FR2 UL gap preference;
2&gt; else if the current FR2 UL gap preference is different from the one indicated in the last transmission of the UEAssistanceInformation message:
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide FR2 UL gap preference.
1&gt; if configured to provide MUSIM assistance information for leaving RRC_CONNECTED:
2&gt; if the UE needs to leave RRC_CONNECTED state and the timer T346g is not running:
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide MUSIM assistance information for leaving RRC_CONNECTED;
3&gt; start the timer T346g with the timer value set to the musim-LeaveWithoutResponseTimer;
1&gt; if configured to provide MUSIM assistance information without leaving RRC_CONNECTED:
2&gt; if the UE has a preference on the MUSIM gap(s) and the UE did not transmit a UEAssistanceInformation message with musim-GapPreferenceList since it was configured to provide MUSIM assistance information without leaving RRC_CONNECTED; or
2&gt; if the current musim-GapPreferenceList is different from the one indicated in the last transmission of the UEAssistanceInformation message including musim-GapPreferenceList and the timer T346h is not running:
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide the current musim-GapPreferenceList;
3&gt; start the timer T346h with the timer value set to the musim-GapProhibitTimer.
1&gt; if configured to provide the relaxation state of RLM measurements of a cell group:
2&gt; if the UE did not transmit a UEAssistanceInformation message with rlm-MeasRelaxationState since it was configured to provide the relaxation state of RLM measurements for the cell group; or
2&gt; if the relaxation state of RLM measurements for the cell group has changed since the last transmission of the UEAssistanceInformation message including rlm-MeasRelaxationState of the cell group and timer T346j associated with the cell group is not running:
3&gt; start timer T346j with the timer value set to the rlm-RelaxtionReportingProhibitTimer;
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide the relaxation state of RLM measurements of the cell group;
1&gt; if configured to provide the relaxation state of BFD measurements of serving cells of a cell group:
2&gt; if the UE did not transmit a UEAssistanceInformation message with bfd-MeasRelaxationState since it was configured to provide the relaxation state of BFD measurements for the cell group; or
2&gt; if the relaxation state of BFD measurements in any serving cell of the cell group has changed since the last transmission of the UEAssistanceInformation message including bfd-MeasRelaxationState of the cell group and timer T346k associated with the cell group is not running:
3&gt; start timer T346k with the timer value set to the bfd-RelaxtionReportingProhibitTimer;
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide the relaxation state of BFD measurements of serving cells of the cell group.
1&gt; if data and/or signalling mapped to radio bearers not configured for SDT becomes available during SDT (i.e.
while T319a is running):
2&gt; if the UE did not transmit a UEAssistanceInformation message with nonSDT-DataIndication since the initiation of the current resume procedure for SDT:
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide nonSDT-DataIndication.
1&gt; if configured to provide its preference for SCG deactivation and timer T346i is not running;
2&gt; if the UE prefers the SCG to be deactivated and did not transmit a UEAssistanceInformation message with scg-DeactivationPreference since it was configured to provide its SCG deactivation preference; or
2&gt; if the UE preference for SCG deactivation is different from the last indicated scg-DeactivationPreference since the UE was configured to provide its SCG deactivation preference:
3&gt; start timer T346i with the timer value set to the scg-DeactivationPreferenceProhibitTimer;
3&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to provide the UE preference for SCG deactivation;
1&gt; if the SCG is deactivated, and,
1&gt; the UE has uplink data to send for an SCG RLC entity while the UE previously did not have any uplink data to send for any SCG RLC entity:
2&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to indicate that the UE has uplink data to send for a DRB whose DRB-Identity is not included in any RLC-BearerConfig in the CellGroupConfig associated with the MCG.
1&gt; if configured to send indications of RRM measurement relaxation criterion fulfilment:
2&gt; if the criterion in 5.7.4.4 is met for a period of T :
3&gt; if the UE did not transmit a UEAssistanceInformation message with rrm-MeasRelaxationFulfilment as true since it was configured to provide indications of RRM measurement relaxation criterion fulfilment; or
3&gt; the last UEAssistanceInformation message indicated the criterion in 5.7.4.4 is not fulfilled with rrm- MeasRelaxationFulfilment as false:
4&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to indicate that the criterion for RRM measurement relaxation for connected mode is fulfilled;
3&gt; if the last UEAssistanceInformation message indicated fulfilment of the criterion in 5.7.4.4 with rrm- MeasRelaxationFulfilment as true:
4&gt; initiate transmission of the UEAssistanceInformation message in accordance with 5.7.4.3 to indicate that the criterion for RRM measurement relaxation for connected mode is not fulfilled.
5.7.4.3 Actions related to transmission of UEAssistanceInformation message
The UE shall set the contents of the UEAssistanceInformation message as follows:
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide a delay budget report according to 5.7.4.2 or 5.3.5.3;
2&gt; set delayBudgetReport to type1 according to a desired value;
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide overheating assistance information according to 5.7.4.2 or 5.3.5.3;
2&gt; if the UE experiences internal overheating:
3&gt; if the UE prefers to temporarily reduce the number of maximum secondary component carriers:
4&gt; include reducedMaxCCs in the OverheatingAssistance IE;
4&gt; set reducedCCsDL to the number of maximum SCells the UE prefers to be temporarily configured in downlink;
4&gt; set reducedCCsUL to the number of maximum SCells the UE prefers to be temporarily configured in uplink;
3&gt; if the UE prefers to temporarily reduce maximum aggregated bandwidth of FR1:
4&gt; include reducedMaxBW-FR1 in the OverheatingAssistance IE;
4&gt; set reducedBW-DL to the maximum aggregated bandwidth the UE prefers to be temporarily configured across all downlink carriers of FR1;
4&gt; set reducedBW-UL to the maximum aggregated bandwidth the UE prefers to be temporarily configured across all uplink carriers of FR1;
3&gt; if the UE prefers to temporarily reduce maximum aggregated bandwidth of FR2-1:
4&gt; include reducedMaxBW-FR2 in the OverheatingAssistance IE;
4&gt; set reducedBW-DL to the maximum aggregated bandwidth the UE prefers to be temporarily configured across all downlink carriers of FR2-1;
4&gt; set reducedBW-UL to the maximum aggregated bandwidth the UE prefers to be temporarily configured across all uplink carriers of FR2-1;
3&gt; if the UE prefers to temporarily reduce maximum aggregated bandwidth of FR2-2:
4&gt; include reducedMaxBW-FR2-2 in the OverheatingAssistance IE;
4&gt; set reducedBW-DL-FR2-2 to the maximum aggregated bandwidth the UE prefers to be temporarily configured across all downlink carriers of FR2-2;
4&gt; set reducedBW-UL-FR2-2 to the maximum aggregated bandwidth the UE prefers to be temporarily configured across all uplink carriers of FR2-2;
3&gt; if the UE prefers to temporarily reduce the number of maximum MIMO layers of each serving cell operating on FR1:
4&gt; include reducedMaxMIMO-LayersFR1 in the OverheatingAssistance IE;
4&gt; set reducedMIMO-LayersFR1-DL to the number of maximum MIMO layers of each serving cell operating on FR1 the UE prefers to be temporarily configured in downlink;
4&gt; set reducedMIMO-LayersFR1-UL to the number of maximum MIMO layers of each serving cell operating on FR1 the UE prefers to be temporarily configured in uplink;
3&gt; if the UE prefers to temporarily reduce the number of maximum MIMO layers of each serving cell operating on FR2-1:
4&gt; include reducedMaxMIMO-LayersFR2 in the OverheatingAssistance IE;
4&gt; set reducedMIMO-LayersFR2-DL to the number of maximum MIMO layers of each serving cell operating on FR2-1 the UE prefers to be temporarily configured in downlink;
4&gt; set reducedMIMO-LayersFR2-UL to the number of maximum MIMO layers of each serving cell operating on FR2-1 the UE prefers to be temporarily configured in uplink;
3&gt; if the UE prefers to temporarily reduce the number of maximum MIMO layers of each serving cell operating on FR2-2:
4&gt; include reducedMaxMIMO-LayersFR2-2 in the OverheatingAssistance IE;
4&gt; set reducedMIMO-LayersFR2-2-DL to the number of maximum MIMO layers of each serving cell operating on FR2 the UE prefers to be temporarily configured in downlink;
4&gt; set reducedMIMO-LayersFR2-2-UL to the number of maximum MIMO layers of each serving cell operating on FR2 the UE prefers to be temporarily configured in uplink;
2&gt; else (if the UE no longer experiences an overheating condition):
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide IDC assistance information according to 5.7.4.2 or 5.3.5.3:
2&gt; if there is at least one carrier frequency included in candidateServingFreqListNR, the UE is experiencing IDC problems that it cannot solve by itself:
3&gt; include the field affectedCarrierFreqList with an entry for each affected carrier frequency included in candidateServingFreqListNR;
3&gt; for each carrier frequency included in the field affectedCarrierFreqList, include interferenceDirection and set it accordingly;
2&gt; if there is at least one supported UL CA combination comprising of carrier frequencies included in candidateServingFreqListNR, the UE is experiencing IDC problems that it cannot solve by itself:
3&gt; include victimSystemType for each UL CA combination included in affectedCarrierFreqCombList;
3&gt; if the UE sets victimSystemType to wlan or bluetooth:
4&gt; include affectedCarrierFreqCombList with an entry for each supported UL CA combination comprising of carrier frequencies included in candidateServingFreqListNR, that is affected by IDC problems;
4&gt; optionally include affectedCarrierFreqCombList with an entry for each supported UL CA combination comprising of carrier frequencies included in candidateServingFreqListNR, that is affected by IDC problems; NOTE 1: When sending an UEAssistanceInformation message to inform the IDC problems, the UE includes all IDC assistance information (rather than providing e.g. the changed part(s) of the IDC assistance information).
NOTE 2: Upon not anymore experiencing a particular IDC problem that the UE previously reported, the UE provides an IDC indication with the modified contents of the UEAssistanceInformation message (e.g. by not including the IDC assistance information in the idc-Assistance field).
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide drx-Preference of a cell group for power saving according to 5.7.4.2 or 5.3.5.3:
2&gt; include drx-Preference in the UEAssistanceInformation message;
2&gt; if the UE has a preference on DRX parameters for the cell group:
3&gt; if the UE has a preference for the long DRX cycle:
4&gt; include preferredDRX-LongCycle in the DRX-Preference IE and set it to the preferred value;
3&gt; if the UE has a preference for the DRX inactivity timer:
4&gt; include preferredDRX-InactivityTimer in the DRX-Preference IE and set it to the preferred value;
3&gt; if the UE has a preference for the short DRX cycle:
4&gt; include preferredDRX-ShortCycle in the DRX-Preference IE and set it to the preferred value;
3&gt; if the UE has a preference for the short DRX timer:
4&gt; include preferredDRX-ShortCycleTimer in the DRX-Preference IE and set it to the preferred value;
2&gt; else (if the UE has no preference on DRX parameters for the cell group):
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide maxBW-Preference of a cell group for power saving according to 5.7.4.2 or 5.3.5.3:
2&gt; include maxBW-Preference in the UEAssistanceInformation message;
2&gt; if the UE has a preference on the maximum aggregated bandwidth for the cell group:
3&gt; if the UE prefers to reduce the maximum aggregated bandwidth of FR1:
4&gt; set reducedBW-DL to the maximum aggregated bandwidth the UE desires to have configured across all downlink carriers of FR1 in the cell group;
4&gt; set reducedBW-UL to the maximum aggregated bandwidth the UE desires to have configured across all uplink carriers of FR1 in the cell group;
3&gt; if the UE prefers to reduce the maximum aggregated bandwidth of FR2-1:
4&gt; set reducedBW-DL to the maximum aggregated bandwidth the UE desires to have configured across all downlink carriers of FR2-1 in the cell group;
4&gt; set reducedBW-UL to the maximum aggregated bandwidth the UE desires to have configured across all uplink carriers of FR2-1 in the cell group;
2&gt; else (if the UE has no preference on the maximum aggregated bandwidth for the cell group):
3&gt; do not include reducedMaxBW-FR1 and reducedMaxBW-FR2 in the MaxBW-Preference IE;
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide maxBW-PreferenceFR2-2 of a cell group for power saving according to 5.7.4.2 or 5.3.5.3:
2&gt; include maxBW-PreferenceFR2-2 in the UEAssistanceInformation message;
3&gt; if the UE prefers to reduce the maximum aggregated bandwidth of FR2-2:
4&gt; set reducedBW-FR2-2-DL to the maximum aggregated bandwidth the UE desires to have configured across all downlink carriers of FR2-2 in the cell group;
4&gt; set reducedBW-FR2-2-UL to the maximum aggregated bandwidth the UE desires to have configured across all uplink carriers of FR2-2 in the cell group;
2&gt; else (if the UE has no preference on the maximum aggregated bandwidth for the cell group):
3&gt; do not include reducedMaxBW-FR2-2 in the MaxBW-PreferenceFR2-2 IE;
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide maxCC-Preference of a cell group for power saving according to 5.7.4.2 or 5.3.5.3:
2&gt; include maxCC-Preference in the UEAssistanceInformation message;
2&gt; if the UE has a preference on the maximum number of secondary component carriers for the cell group:
3&gt; include reducedMaxCCs in the MaxCC-Preference IE;
3&gt; set reducedCCsDL to the number of maximum SCells the UE desires to have configured in downlink in the cell group;
3&gt; set reducedCCsUL to the number of maximum SCells the UE desires to have configured in uplink in the cell group;
2&gt; else (if the UE has no preference on the maximum number of secondary component carriers for the cell group):
3&gt; do not include reducedMaxCCs in the MaxCC-Preference IE; NOTE 3: The UE can implicitly indicate a preference for NR SCG release by reporting the maximum aggregated bandwidth preference for power saving of the cell group, if configured, as zero for both FR1 and FR2, and by reporting the maximum number of secondary component carriers for power saving of the cell group, if configured, as zero for both uplink and downlink.
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide maxMIMO-LayerPreference of a cell group for power saving according to 5.7.4.2 or 5.3.5.3:
2&gt; include maxMIMO-LayerPreference in the UEAssistanceInformation message;
2&gt; if the UE has a preference on the maximum number of MIMO layers for the cell group:
3&gt; if the UE prefers to reduce the number of maximum MIMO layers of each serving cell operating on FR1:
4&gt; set reducedMIMO-LayersFR1-DL to the preferred maximum number of downlink MIMO layers of each BWP of each FR1 serving cell that the UE operates on in the cell group;
4&gt; set reducedMIMO-LayersFR1-UL to the preferred maximum number of uplink MIMO layers of each FR1 serving cell that the UE operates on in the cell group;
3&gt; if the UE prefers to reduce the number of maximum MIMO layers of each serving cell operating on FR2-
4&gt; set reducedMIMO-LayersFR2-DL to the preferred maximum number of downlink MIMO layers of each BWP of each FR2-1 serving cell that the UE operates on in the cell group;
4&gt; set reducedMIMO-LayersFR2-UL to the preferred maximum number of uplink MIMO layers of each FR2-1 serving cell that the UE operates on in the cell group;
2&gt; else (if the UE has no preference on the maximum number of MIMO layers for the cell group):
3&gt; do not include reducedMaxMIMO-LayersFR1 and reducedMaxMIMO-LayersFR2 in the MaxMIMO- LayerPreference IE;
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide maxMIMO LayerPreferenceFR2
2 of a cell group for power saving according to 5.7.4.2 or 5.3.5.3:
2&gt; include maxMIMO-LayerPreferenceFR2-2 in the UEAssistanceInformation message;
2&gt; if the UE has a preference on the maximum number of MIMO layers for the cell group for FR2-2:
3&gt; if the UE prefers to reduce the number of maximum MIMO layers of each serving cell operating on FR2
4&gt; set reducedMIMO-LayersFR2-2-DL to the preferred maximum number of downlink MIMO layers of each BWP of each FR2-2 serving cell that the UE operates on in the cell group;
4&gt; set reducedMIMO-LayersFR2-2-UL to the preferred maximum number of uplink MIMO layers of each FR2-2 serving cell that the UE operates on in the cell group;
2&gt; else (if the UE has no preference on the maximum number of MIMO layers for the cell group):
3&gt; do not include reducedMaxMIMO-LayersFR2-2 in the MaxMIMO-LayerPreferenceFR2-2 IE;
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide minSchedulingOffsetPreference of a cell group for power saving according to 5.7.4.2 or 5.3.5.3:
2&gt; include minSchedulingOffsetPreference in the UEAssistanceInformation message;
2&gt; if the UE has a preference on the minimum scheduling offset for cross-slot scheduling for the cell group:
3&gt; if the UE has a preference for the value of K (TS 38.214 , clause 5.1.2.1) for cross-slot scheduling
4&gt; include preferredK0-SCS-15kHz in the MinSchedulingOffsetPreference IE and set it to the desired value of K ;
3&gt; if the UE has a preference for the value of K for cross-slot scheduling with 30 kHz SCS:
4&gt; include preferredK0-SCS-30kHz in the MinSchedulingOffsetPreference IE and set it to the desired value of K ;
3&gt; if the UE has a preference for the value of K for cross-slot scheduling with 60 kHz SCS:
4&gt; include preferredK0-SCS-60kHz in the MinSchedulingOffsetPreference IE and set it to the desired value of K ;
3&gt; if the UE has a preference for the value of K for cross-slot scheduling with 120 kHz SCS:
4&gt; include preferredK0-SCS-120kHz in the MinSchedulingOffsetPreference IE and set it to the desired value of K ;
3&gt; if the UE has a preference for the value of K (TS 38.214 , clause 6.1.2.1) for cross-slot scheduling
4&gt; include preferredK2-SCS-15kHz in the MinSchedulingOffsetPreference IE and set it to the desired value of K ;
3&gt; if the UE has a preference for the value of K for cross-slot scheduling with 30 kHz SCS:
4&gt; include preferredK2-SCS-30kHz in the MinSchedulingOffsetPreference IE and set it to the desired value of K ;
3&gt; if the UE has a preference for the value of K for cross-slot scheduling with 60 kHz SCS:
4&gt; include preferredK2-SCS-60kHz in the MinSchedulingOffsetPreference IE and set it to the desired value of K ;
3&gt; if the UE has a preference for the value of K for cross-slot scheduling with 120 kHz SCS:
4&gt; include preferredK2-SCS-120kHz in the MinSchedulingOffsetPreference IE and set it to the desired value of K ;
2&gt; else (if the UE has no preference on the minimum scheduling offset for cross-slot scheduling for the cell group):
3&gt; do not include preferredK0 and preferredK2 in the MinSchedulingOffsetPreference IE;
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide minSchedulingOffsetPreferenceExt of a cell group for power saving according to 5.7.4.2 or 5.3.5.3:
2&gt; include minSchedulingOffsetPreferenceExt in the UEAssistanceInformation message;
2&gt; if the UE has a preference on the minimum scheduling offset for cross-slot scheduling for the cell group for FR2-2:
3&gt; include minSchedulingOffsetPreferenceExt in the UEAssistanceInformation message;
4&gt; if the UE has a preference for the value of K (TS 38.214 , clause 5.1.2.1) for cross-slot
0 scheduling with 480 kHz SCS:
5&gt; include preferredK0-SCS-480kHz in the minSchedulingOffsetPreferenceExt IE and set it to the desired value of K ;
4&gt; if the UE has a preference for the value of K for cross-slot scheduling with 960 kHz SCS:
5&gt; include preferredK0-SCS-960kHz in the minSchedulingOffsetPreferenceExt IE and set it to the desired value of K ;
4&gt; if the UE has a preference for the value of K for cross-slot scheduling with 480 kHz SCS:
5&gt; include preferredK2-SCS-480kHz in the minSchedulingOffsetPreferenceExt IE and set it to the desired value of K ;
4&gt; if the UE has a preference for the value of K for cross-slot scheduling with 960 kHz SCS:
5&gt; include preferredK2-SCS-960kHz in the minSchedulingOffsetPreferenceExt IE and set it to the desired value of K ;
3&gt; else (if the UE has no preference on the minimum scheduling offset for cross-slot scheduling for the cell group):
4&gt; do not include preferredK0 and preferredK2 in the minSchedulingOffsetPreferenceExt IE;
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide a release preference according to
2&gt; include releasePreference in the UEAssistanceInformation message;
2&gt; set preferredRRC-State to the desired RRC state on transmission of the UEAssistanceInformation message;
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide an indication of preference in being provisioned with reference time information according to 5.7.4.2 or 5.3.5.3:
2&gt; if the UE has a preference in being provisioned with reference time information:
3&gt; set referenceTimeInfoPreference to true;
3&gt; set referenceTimeInfoPreference to false.
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide preference on FR2 UL gap according to 5.7.4.2 or 5.3.5.3:
2&gt; if the UE has a preference for FR2 UL gap configuration:
3&gt; set ul-GapFR2-PatternPreference to the preferred FR2 UL gap pattern;
2&gt; else (if the UE has no preference for the FR2 UL gap configuration):
3&gt; do not include ul-GapFR2-PatternPreference in the UL-GapFR2-Preference IE.
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide MUSIM assistance information according to 5.7.4.2 or 5.3.5.3:
2&gt; if the UE has a preference for MUSIM periodic gap(s):
3&gt; include musim-GapPreferenceList with an entry for each periodic gap the UE prefers to be configured;
4&gt; set musim-Gaplength and musim-GapRepetitionAndOffset in the musim-GapInfo IE to the values of the length and the repetition/offset of the gap(s), respectively, the UE prefers to be configured with;
2&gt; if the UE has a preference for MUSIM aperiodic gap:
3&gt; include the field musim-GapPreferenceList, with one entry for the aperiodic gap the UE prefers to be configured;
4&gt; set musim-Gaplength and musim-Starting-SFN-AndSubframe in the musim-GapInfo IE to the values of respectively the length and the starting SFN/subframe of the gap, respectively, the UE prefers to be configured with;
2&gt; else (if the UE has no longer preference for the periodic/aperiodic gaps):
3&gt; do not include musim-GapPreferenceList in the musim-Assistance IE;
2&gt; if UE has a preference to leave RRC_CONNECTED state:
3&gt; set musim-PreferredRRC-State to the preferred RRC state.
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide the relaxation state of RLM measurements of a cell group according to 5.7.4.2:
2&gt; if the UE performs RLM measurement relaxation on the cell group according to TS 38.133 :
3&gt; set the rlm-MeasRelaxationState to true;
3&gt; set the rlm-MeasRelaxationState to false;
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide the relaxation state of BFD measurements of a cell group:
2&gt; for each serving cell of the cell group:
3&gt; if the UE performs BFD measurement relaxation on this serving cell according to TS 38.133 :
4&gt; set the n-th bit of bfd-MeasRelaxationState to '1', where n is equal to the servCellIndex value + 1 of the serving cell;
4&gt; set the n-th bit of bfd-MeasRelaxationState to '0', where n is equal to the servCellIndex value + 1 of the serving cell.
1&gt; if transmission of the UEAssistanceInformation message is initiated to indicate availability of data mapped to radio bearers not configured for SDT according to 5.7.4.2:
2&gt; include and set the resumeCause according to the information received from the upper layers, if provided.
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide an indication of preference for SCG deactivation according to 5.7.4.2:
2&gt; include scg-DeactivationPreference in the UEAssistanceInformation message;
2&gt; set the scg-DeactivationPreference to scgDeactivationPreferred if the UE prefers the SCG to be deactivated, otherwise set it to noPreference;
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide an indication that the UE has uplink data related to a deactivated SCG according to 5.7.4.2:
2&gt; include uplinkData in the UEAssistanceInformation message.
1&gt; if transmission of the UEAssistanceInformation message is initiated to provide an indication about whether the criterion for RRM relaxation for connected mode is fulfilled or not fulfilled:
2&gt; if the criterion for RRM measurement relaxation for connected mode is fulfilled:
3&gt; set the rrm-MeasRelaxationFulfilment to true;
3&gt; set the rrm-MeasRelaxationFulfilment to false.
The UE shall set the contents of the UEAssistanceInformation message for configured grant assistance information for NR sidelink communication:
1&gt; if configured to provide configured grant assistance information for NR sidelink communication:
2&gt; include the sl-UE-AssistanceInformationNR; NOTE 4: It is up to UE implementation when and how to trigger configured grant assistance information for NR sidelink communication.
The UE shall:
1&gt; if the procedure was triggered to provide configured grant assistance information for NR sidelink communication by an NR RRCReconfiguration message that was embedded within an E-UTRA RRCConnectionReconfiguration:
2&gt; submit the UEAssistanceInformation to lower layers via SRB1, embedded in E-UTRA RRC message ULInformationTransferIRAT as specified in TS 36.331 , clause 5.6.28;
1&gt; else if the UE is in (NG)EN-DC:
3&gt; submit the UEAssistanceInformation message via SRB3 to lower layers for transmission;
3&gt; submit the UEAssistanceInformation message via the E-UTRA MCG embedded in E-UTRA RRC message ULInformationTransferMRDC as specified in TS 36.331 .
1&gt; else if the UE is in NR-DC:
2&gt; if the UE assistance configuration that triggered this UE assistance information is associated with the SCG:
4&gt; submit the UEAssistanceInformation message via SRB3 to lower layers for transmission;
4&gt; submit the UEAssistanceInformation message via the NR MCG embedded in NR RRC message ULInformationTransferMRDC as specified in 5.7.2a.3;
3&gt; submit the UEAssistanceInformation message via SRB1 to lower layers for transmission;
2&gt; submit the UEAssistanceInformation message to lower layers for transmission.
5.7.4.3a Setting the contents of OverheatingAssistance IE
The UE shall set the contents of OverheatingAssistance IE if initiated to provide overheating assistance indication for SCG in (NG)EN-DC according to clause 5.6.10.3 as specified in TS 36.331 :
1&gt; if the UE prefers to temporarily reduce the number of maximum secondary component carriers for SCG:
2&gt; include reducedMaxCCs in the OverheatingAssistance IE;
2&gt; set reducedCCsDL to the number of maximum SCells of the SCG the UE prefers to be temporarily configured in downlink;
2&gt; set reducedCCsUL to the number of maximum SCells of the SCG the UE prefers to be temporarily configured in uplink;
1&gt; if the UE prefers to temporarily reduce maximum aggregated bandwidth of FR1 for SCG:
2&gt; include reducedMaxBW-FR1 in the OverheatingAssistance IE;
2&gt; set reducedBW-FR1-DL to the maximum aggregated bandwidth the UE prefers to be temporarily configured across all downlink carriers of FR1 of the SCG;
2&gt; set reducedBW-FR1-UL to the maximum aggregated bandwidth the UE prefers to be temporarily configured across all uplink carriers of FR1 of the SCG;
1&gt; if the UE prefers to temporarily reduce maximum aggregated bandwidth of FR2-1 for SCG:
2&gt; include reducedMaxBW-FR2 in the OverheatingAssistance IE;
2&gt; set reducedBW-FR2-DL to the maximum aggregated bandwidth the UE prefers to be temporarily configured across all downlink carriers of FR2-1 of the SCG;
2&gt; set reducedBW-FR2-UL to the maximum aggregated bandwidth the UE prefers to be temporarily configured across all uplink carriers of FR2-1 of the SCG;
1&gt; if the UE prefers to temporarily reduce the number of maximum MIMO layers of each serving cell operating on FR1 for SCG:
2&gt; include reducedMaxMIMO-LayersFR1 in the OverheatingAssistance IE;
2&gt; set reducedMIMO-LayersFR1-DL to the number of maximum MIMO layers of each serving cell operating on FR1 of the SCG the UE prefers to be temporarily configured in downlink;
2&gt; set reducedMIMO-LayersFR1-UL to the number of maximum MIMO layers of each serving cell operating on FR1 of the SCG the UE prefers to be temporarily configured in uplink;
1&gt; if the UE prefers to temporarily reduce the number of maximum MIMO layers of each serving cell operating on FR2-1 for SCG:
2&gt; include reducedMaxMIMO-LayersFR2 in the OverheatingAssistance IE;
2&gt; set reducedMIMO-LayersFR2-DL to the number of maximum MIMO layers of each serving cell operating on FR2-1 of the SCG the UE prefers to be temporarily configured in downlink;
2&gt; set reducedMIMO-LayersFR2-UL to the number of maximum MIMO layers of each serving cell operating on FR2-1 of the SCG the UE prefers to be temporarily configured in uplink;
5.7.4.4 Relaxed measurement criterion for a stationary UE
Where: a) Srxlev = current Srxlev value of the PCell cell (dB). b) Srxlev = reference Srxlev value of the PCell cell (dB), set as follows:
RefStationaryConnected a) At the end of RRC reconfiguration procedure as specified in 5.3.5.3, when rrm- MeasRelaxationReportingConfig is included in the RRCReconfiguration message; or b) If (Srxlev Srxlev ) &gt; 0; or RefStationaryConnected c) If the relaxed measurement criterion has not been met for T :
SearchDeltaP-StationaryConnected a) The UE shall set the value of Srxlev to the current Srxlev value of the serving cell.
RefStationaryConnected
5.7.4a Void
5.7.5 Failure information
5.7.5.1 General FailureInformation
The purpose of this procedure is to inform the network about a failure detected by the UE.
5.7.5.2 Initiation
A UE initiates the procedure when there is a need inform the network about a failure detected by the UE. In particular, the UE initiates the procedure when the following condition is met:
1&gt; upon detecting failure for an RLC bearer, in accordance with 5.3.10.3;
1&gt; upon detecting DAPS handover failure, in accordance with 5.3.5.8.3; Upon initiating the procedure, the UE shall:
1&gt; initiate transmission of the FailureInformation message as specified in 5.7.5.3;
5.7.5.3 Actions related to transmission of FailureInformation message
The UE shall:
1&gt; if initiated to provide RLC failure information, set FailureInfoRLC-Bearer as follows:
2&gt; set logicalChannelIdentity to the logical channel identity of the failing RLC bearer;
2&gt; set cellGroupId to the cell group identity of the failing RLC bearer;
2&gt; set the failureType as rlc-failure;
1&gt; if initiated to provide DAPS failure information, set FailureInfoDAPS as follows:
2&gt; set the failureType as daps-failure;
1&gt; if used to inform the network about a failure for an MCG RLC bearer or DAPS failure information:
2&gt; submit the FailureInformation message to lower layers for transmission via SRB1;
1&gt; else if used to inform the network about a failure for an SCG RLC bearer:
3&gt; submit the FailureInformation message to lower layers for transmission via SRB3;
3&gt; if the UE is in (NG)EN-DC:
4&gt; submit the FailureInformation message via E-UTRA SRB1 embedded in E-UTRA RRC message ULInformationTransferMRDC as specified in TS 36.331 .
3&gt; else if the UE is in NR-DC:
4&gt; submit the FailureInformation message via SRB1 embedded in NR RRC message ULInformationTransferMRDC as specified in clause 5.7.2a.3.
5.7.6 DL message segment transfer
5.7.6.1 General DLDedicatedMessageSegment
The purpose of this procedure is to transfer segments of DL DCCH messages from the network to the UE.
NOTE: The segmentation of DL DCCH message is only applicable to RRCReconfiguration and RRCResume messages in this release.
5.7.6.2 Initiation
The network initiates the DL Dedicated Message Segment transfer procedure whenever the encoded RRC message PDU exceeds the maximum PDCP SDU size. The network initiates the DL Dedicated Message Segment transfer procedure by sending the DLDedicatedMessageSegment message.
5.7.6.3 Reception of DLDedicatedMessageSegment by the UE
Upon receiving DLDedicatedMessageSegment message, the UE shall:
1&gt; store the segment included in rrc-MessageSegmentContainer;
1&gt; if all segments of the message have been received:
2&gt; assemble the message from the received segments and process the message according to 5.3.5.3 for the RRCReconfiguration message or 5.3.13.4 for the RRCResume message;
2&gt; discard all segments.
5.7.7 UL message segment transfer
5.7.7.1 General ULDedicatedMessageSegment
The purpose of this procedure is to transfer segments of UL DCCH messages from UE to a NG-RAN in RRC_CONNECTED.
NOTE: The segmentation of UL DCCH message is only applicable to UECapabilityInformation and MeasurementReportAppLayer in this release.
5.7.7.2 Initiation
A UE capable of UL RRC message segmentation in RRC_CONNECTED will initiate the procedure when the following conditions are met:
1&gt; if the RRC message segmentation is enabled based on the field rrc-SegAllowed received, and
1&gt; if the encoded RRC message is larger than the maximum supported size of a PDCP SDU specified in TS 38.323
; Upon initiating the procedure, the UE shall:
1&gt; initiate transmission of the ULDedicatedMessageSegment message as specified in 5.7.7.3;
5.7.7.3 Actions related to transmission of ULDedicatedMessageSegment message
The UE shall segment the encoded RRC PDU based on the maximum supported size of a PDCP SDU specified in TS
38.323 . UE shall minimize the number of segments and set the contents of the ULDedicatedMessageSegment messages as follows:
1&gt; F or each new UL DCCH message, set the segmentNumber to 0 for the first message segment and increment the segmentNumber for each subsequent RRC message segment;
1&gt; set rrc-MessageSegmentContainer to include the segment of the UL DCCH message corresponding to the segmentNumber;
1&gt; if the segment included in the rrc-MessageSegmentContainer is the last segment of the UL DCCH message:
2&gt; set the rrc-MessageSegmentType to lastSegment;
2&gt; set the rrc-MessageSegmentType to notLastSegment;
1&gt; submit all the ULDedicatedMessageSegment messages generated for the segmented RRC message to lower layers for transmission in ascending order based on the segmentNumber, upon which the procedure ends.
5.7.8.1 General
This procedure specifies the measurements to be performed and stored by a UE in RRC_IDLE and RRC_INACTIVE when it has an idle/inactive measurement configuration.
5.7.8.1a Measurement configuration
The purpose of this procedure is to update the idle/inactive measurement configuration.
The UE initiates this procedure while T331 is running and T319a is not running and one of the following conditions is met:
1&gt; upon selecting a cell when entering RRC_IDLE or RRC-INACTIVE from RRC_CONNECTED or RRC_INACTIVE; or
1&gt; upon update of system information (SIB4, or SIB11), e.g. due to intra-RAT cell (re)selection; While in RRC_IDLE or RRC_INACTIVE, and T331 is running, the UE shall:
1&gt; if VarMeasIdleConfig includes neither a measIdleCarrierListEUTRA nor a measIdleCarrierListNR received from the RRCRelease message:
2&gt; if the UE supports idleInactiveEUTRA-MeasReport:
3&gt; if the SIB11 includes the measIdleConfigSIB and contains measIdleCarrierListEUTRA:
4&gt; store or replace the measIdleCarrierListEUTRA of measIdleConfigSIB of SIB11 within VarMeasIdleConfig;
4&gt; remove the measIdleCarrierListEUTRA in VarMeasIdleConfig, if stored;
2&gt; if the UE supports idleInactiveNR-MeasReport:
3&gt; if SIB11 includes the measIdleConfigSIB and contains measIdleCarrierListNR:
4&gt; store or replace the measIdleCarrierListNR of measIdleConfigSIB of SIB11 within VarMeasIdleConfig;
4&gt; remove the measIdleCarrierListNR in VarMeasIdleConfig, if stored;
1&gt; for each entry in the measIdleCarrierListNR within VarMeasIdleConfig that does not contain an ssb-MeasConfig received from the RRCRelease message:
2&gt; if there is an entry in measIdleCarrierListNR in measIdleConfigSIB of SIB11 that has the same carrier frequency and subcarrier spacing as the entry in the measIdleCarrierListNR within VarMeasIdleConfig and that contains ssb-MeasConfig:
3&gt; delete the ssb-MeasConfig of the corresponding entry in the measIdleCarrierListNR within VarMeasIdleConfig;
2&gt; else if there is an entry in interFreqCarrierFreqList of SIB4 with the same carrier frequency and subcarrier spacing as the entry in measIdleCarrierListNR within VarMeasIdleConfig:
3&gt; delete the ssb-MeasConfig of the corresponding entry in the measIdleCarrierListNR within VarMeasIdleConfig;
3&gt; remove the ssb-MeasConfig of the corresponding entry in the measIdleCarrierListNR within VarMeasIdleConfig, if stored;
1&gt; perform measurements according to 5.7.8.2a.
5.7.8.2 Void
5.7.8.2a Performing measurements
When performing measurements on NR carriers according to this clause, the UE shall derive the cell quality as specified in 5.5.3.3 and consider the beam quality to be the value of the measurement results of the concerned beam, where each result is averaged as described in TS 38.215 .
While in RRC_IDLE or RRC_INACTIVE, and T331 is running and and T319a is not running, the UE shall:
1&gt; perform the measurements in accordance with the following:
2&gt; if the VarMeasIdleConfig includes the measIdleCarrierListEUTRA and the SIB1 contains idleModeMeasurementsEUTRA:
3&gt; for each entry in measIdleCarrierListEUTRA within VarMeasIdleConfig:
4&gt; if UE supports NE-DC between the serving carrier and the carrier frequency indicated by carrierFreqEUTRA within the corresponding entry:
5&gt; perform measurements in the carrier frequency and bandwidth indicated by carrierFreqEUTRA and allowedMeasBandwidth within the corresponding entry;
5&gt; if the reportQuantitiesEUTRA is set to rsrq:
6&gt; consider RSRQ as the sorting quantity;
6&gt; consider RSRP as the sorting quantity;
5&gt; if the measCellListEUTRA is included:
6&gt; consider cells identified by each entry within the measCellListEUTRA to be applicable for idle/inactive mode measurement reporting;
6&gt; consider up to maxCellMeasIdle strongest identified cells, according to the sorting quantity, to be applicable for idle/inactive measurement reporting;
5&gt; for all cells applicable for idle/inactive measurement reporting, derive measurement results for the measurement quantities indicated by reportQuantitiesEUTRA;
5&gt; store the derived measurement results as indicated by reportQuantitiesEUTRA within the measReportIdleEUTRA in VarMeasIdleReport in decreasing order of the sorting quantity, i.e. the best cell is included first, as follows:
6&gt; if qualityThresholdEUTRA is configured:
7&gt; include the measurement results from the cells applicable for idle/inactive measurement reporting whose RSRP/RSRQ measurement results are above the value(s) provided in qualityThresholdEUTRA;
7&gt; include the measurement results from all cells applicable for idle/inactive measurement reporting;
2&gt; if the VarMeasIdleConfig includes the measIdleCarrierListNR and the SIB1 contains idleModeMeasurementsNR:
3&gt; for each entry in measIdleCarrierListNR within VarMeasIdleConfig that contains ssb-MeasConfig:
4&gt; if UE supports carrier aggregation or NR-DC between serving carrier and the carrier frequency and subcarrier spacing indicated by carrierFreq and ssbSubCarrierSpacing within the corresponding entry:
5&gt; perform measurements in the carrier frequency and subcarrier spacing indicated by carrierFreq and ssbSubCarrierSpacing within the corresponding entry;
5&gt; if the reportQuantities is set to rsrq:
6&gt; consider RSRQ as the cell sorting quantity;
6&gt; consider RSRP as the cell sorting quantity;
5&gt; if the measCellListNR is included:
6&gt; consider cells identified by each entry within the measCellListNR to be applicable for idle/inactive measurement reporting;
6&gt; consider up to maxCellMeasIdle strongest identified cells, according to the sorting quantity, to be applicable for idle/inactive measurement reporting;
5&gt; for all cells applicable for idle/inactive measurement reporting, derive cell measurement results for the measurement quantities indicated by reportQuantities;
5&gt; store the derived cell measurement results as indicated by reportQuantities for cells applicable for idle/inactive measurement reporting within measResultsPerCarrierListIdleNR in the measReportIdleNR in VarMeasIdleReport in decreasing order of the cell sorting quantity, i.e. the best cell is included first, as follows:
6&gt; if qualityThreshold is configured:
7&gt; include the measurement results from the cells applicable for idle/inactive measurement reporting whose RSRP/RSRQ measurement results are above the value(s) provided in qualityThreshold;
7&gt; include the measurement results from all cells applicable for idle/inactive measurement reporting;
5&gt; if beamMeasConfigIdle is included in the associated entry in measIdleCarrierListNR and if UE supports idleInactiveNR-MeasBeamReport for the FR of the carrier frequency indicated by carrierFreq within the associated entry, for each cell in the measurement results:
6&gt; derive beam measurements based on SS/PBCH block for each measurement quantity indicated in reportQuantityRS-Indexes, as described in TS 38.215 ;
6&gt; if the reportQuantityRS-Indexes is set to rsrq:
7&gt; consider RSRQ as the beam sorting quantity;
7&gt; consider RSRP as the beam sorting quantity;
6&gt; set resultsSSB-Indexes to include up to maxNrofRS-IndexesToReport SS/PBCH block indexes in order of decreasing beam sorting quantity as follows:
7&gt; include the index associated to the best beam for the sorting quantity and if absThreshSS- BlocksConsolidation is included, the remaining beams whose sorting quantity is above absThreshSS-BlocksConsolidation;
6&gt; if the includeBeamMeasurements is set to true:
7&gt; include the beam measurement results as indicated by reportQuantityRS-Indexes;
2&gt; if, as a result of the procedure in this clause, the UE performs measurements in one or more carrier frequency indicated by measIdleCarrierListNR or measIdleCarrierListEUTRA:
3&gt; store the cell measurement results for RSRP and RSRQ for the serving cell within measResultServingCell in the measReportIdleNR in VarMeasIdleReport.
3&gt; if the VarMeasIdleConfig includes the measIdleCarrierListNR and it contains an entry with carrierFreq set to the value of the serving frequency:
4&gt; if beamMeasConfigIdle is included in that entry, and if the UE supports idleInactiveNR- MeasBeamReport for the FR of the serving cell:
5&gt; derive beam measurements based on SS/PBCH block for each measurement quantity indicated in reportQuantityRS-Indexes, as described in TS 38.215 ;
5&gt; if the reportQuantityRS-Indexes is set to rsrq:
6&gt; consider RSRQ as the beam sorting quantity;
6&gt; consider RSRP as the beam sorting quantity;
5&gt; set resultsSSB-Indexes to include up to maxNrofRS-IndexesToReport SS/PBCH block indexes in order of decreasing beam sorting quantity as follows:
6&gt; include the index associated to the best beam for the sorting quantity and if absThreshSS- BlocksConsolidation is included in SIB2 of serving cell, the remaining beams whose sorting quantity is above absThreshSS-BlocksConsolidation;
5&gt; if the includeBeamMeasurements is set to true:
6&gt; include the beam measurement results as indicated by reportQuantityRS-Indexes; NOTE 1: How the UE performs idle/inactive measurements is up to UE implementation as long as the requirements in TS 38.133 are met for measurement reporting.
NOTE 2: The UE is not required to perform idle/inactive measurements on a given carrier if the SSB configuration of that carrier provided via dedicated signaling is different from the SSB configuration broadcasted in the serving cell, if any.
NOTE 3: How the UE prioritizes which frequencies to measure or report (in case it is configured with more frequencies than it can measure or report) is left to UE implementation.
5.7.8.3 T331 expiry or stop
The UE shall:
1&gt; if T331 expires or is stopped:
2&gt; release the VarMeasIdleConfig.
NOTE: It is up to UE implementation whether to continue idle/inactive measurements according to SIB11 and SIB4 configurations or according to E-UTRA SIB5 and E-UTRA SIB24 configurations as specified in TS
36.331 upon inter-RAT cell reselection to E-UTRA, after T331 has expired or stopped.
5.7.8.4 Cell re-selection or cell selection while T331 is running
The UE shall:
1&gt; if intra-RAT cell selection or reselection occurs while T331 is running:
2&gt; if validityAreaList is configured in VarMeasIdleConfig:
3&gt; if the serving frequency does not match with the carrierFreq of an entry in the validityAreaList; or
3&gt; if the serving frequency matches with the carrierFreq of an entry in the validityAreaList, the validityCellList is included in that entry, and the physical cell identity of the serving cell does not match with any entry in validityCellList:
4&gt; stop timer T331;
4&gt; perform the actions as specified in 5.7.8.3, upon which the procedure ends.
1&gt; else if inter-RAT cell selection or reselection occurs while T331 is running:
2&gt; stop timer T331;
2&gt; perform the actions as specified in 5.7.8.3;
5.7.9 Mobility history information
5.7.9.1 General
This procedure specifies how the mobility history information is stored by the UE, covering RRC_IDLE, RRC_INACTIVE and RRC_CONNECTED.
5.7.9.2 Initiation
If the UE supports storage of mobility history information, the UE shall:
1&gt; Upon addition of a PSCell:
2&gt; include an entry in visitedPSCellInfoList in variable VarMobilityHistoryReport possibly after removing the oldest entry, if necessary, according to following:
3&gt; set the field timeSpent of the entry according to following:
4&gt; if this is the first PSCell entry for the current PCell since entering the current PCell in RRC_CONNECTED:
5&gt; include the entry as the time spent with no PSCell since entering the current PCell in RRC_CONNECTED;
5&gt; include the time spent with no PSCell since last PSCell release or SCG failure since entering the current PCell in RRC_CONNECTED;
1&gt; Upon change, or release of a PSCell or upon declaring failure in a PSCell (SCG RLF or SCG HOF) while being connected to the current PCell:
2&gt; include an entry in visitedPSCellInfoList of the variable VarMobilityHistoryReport possibly after removing the oldest entry, if necessary, according to following:
3&gt; if the global cell identity of the previous PSCell is available:
4&gt; include the global cell identity of that cell in the field visitedCellId of the entry;
4&gt; include the physical cell identity and carrier frequency of that cell in the field visitedCellId of the entry;
3&gt; set the field timeSpent of the entry as the time spent in the previous PSCell while being connected to the current PCell;
1&gt; Upon change of suitable cell, consisting of PCell in RRC_CONNECTED (for NR or E-UTRA cell) or serving cell in RRC_INACTIVE (for NR cell) or in RRC_IDLE (for NR or E-UTRA cell), to another NR or E-UTRA cell, or when entering any cell selection' state from 'camped normally' state in NR or LTE or when entering 'any cell selection' state from a suitable cell in RRC_CONNECTED state in NR or LTE:
2&gt; include an entry in visitedCellInfoList of the variable VarMobilityHistoryReport possibly after removing the oldest entry, if necessary, according to following:
3&gt; if the global cell identity of the previous PCell/serving cell is available:
4&gt; include the global cell identity of that cell in the field visitedCellId of the entry;
4&gt; include the physical cell identity and carrier frequency of that cell in the field visitedCellId of the entry;
3&gt; set the field timeSpent of the entry as the time spent in the previous PCell/serving cell;
3&gt; if the UE continues to be connected to the same PSCell during the change of the PCell in RRC_CONNECTED:
4&gt; include an entry in visitedPSCellInfoList of the variable VarMobilityHistoryReport possibly after removing the oldest entry, if necessary, according to following:
5&gt; if the global cell identity of the PSCell is available:
6&gt; include the global cell identity of that cell in the field visitedCellId of the entry;
6&gt; include the physical cell identity and carrier frequency of that cell in the field visitedCellId of the entry;
5&gt; set the field timeSpent of the entry as the time spent in the PSCell, while being connected to previous PCell;
3&gt; else if the UE changes PSCell, or attempts to change PSCell but fails, at the same time as the change of the PCell in RRC_CONNECTED:
4&gt; include an entry in visitedPSCellInfoList in variable VarMobilityHistoryReport possibly after removing the oldest entry, if necessary, according to following:
5&gt; if the global cell identity of the previous PSCell is available:
6&gt; include the global cell identity of that cell in the field visitedCellId of the entry;
6&gt; include the physical cell identity and carrier frequency of that cell in the field visitedCellId of the entry;
5&gt; set the field timeSpent of the entry as the time spent in the PSCell, while being connected to previous PCell;
3&gt; if the UE was not configured with a PSCell at the time of change of PCell in RRC_CONNECTED:
4&gt; include an entry in visitedPSCellInfoList after removing the oldest entry, if necessary, according to the following;
5&gt; set the field timeSpent of the entry as the time without PSCell according to the following:
6&gt; if the UE experienced a PSCell release or secondary cell radio link failure since entering the previous PCell in RRC_CONNECTED:
7&gt; include the time spent with no PSCell since last PSCell release or secondary cell radio link failure since entering the previous PCell in RRC_CONNECTED;
3&gt; if visitedPSCellInfoList exists in VarMobilityHistoryReport:
4&gt; include visitedPSCellInfoList in the visitedCellInfoList of the variable VarMobilityHistoryReport associating it with the latest PCell entry;
4&gt; remove visitedPSCellInfoList from the variable VarMobilityHistoryReport;
1&gt; upon entering 'camped normally' state in NR (in RRC_IDLE or RRC_INACTIVE) or E-UTRA (in RRC_IDLE) while previously in RRC_CONNECTED state NR or LTE while not connected to a PSCell:
2&gt; include an entry in visitedPSCellInfoList after removing the oldest entry, if necessary, according to the following;
3&gt; set the field timeSpent of the entry as the time without PSCell according to the following:
4&gt; if the UE experienced a PSCell release or secondary cell radio link failure since entering the current PCell in RRC_CONNECTED:
5&gt; include the time spent with no PSCell since last PSCell release or SCG radio link failure after entering the current PCell in RRC_CONNECTED.
1&gt; upon entering 'camped normally' state in NR (in RRC_IDLE or RRC_INACTIVE) or E-UTRA (in RRC_IDLE) while previously in 'any cell selection' state or 'camped on any cell' state in NR or LTE:
2&gt; include an entry in variable VarMobilityHistoryReport possibly after removing the oldest entry, if necessary, according to following:
3&gt; set the field timeSpent of the entry as the time spent in 'any cell selection' state and/or 'camped on any cell' state in NR or LTE.
5.7.10 UE Information
5.7.10.1 General UE Network
The UE information procedure is used by the network to request the UE to report information.
5.7.10.2 Initiation
The network initiates the procedure by sending the UEInformationRequest message. The network should initiate this procedure only after successful security activation.
5.7.10.3 Reception of the UEInformationRequest message
Upon receiving the UEInformationRequest message, the UE shall, only after successful security activation:
1&gt; if the idleModeMeasurementReq is included in the UEInformationRequest and the UE has stored VarMeasIdleReport that contains measurement information concerning cells other than the PCell:
2&gt; set the measResultIdleEUTRA in the UEInformationResponse message to the value of measReportIdleEUTRA in the VarMeasIdleReport, if available;
2&gt; set the measResultIdleNR in the UEInformationResponse message to the value of measReportIdleNR in the VarMeasIdleReport, if available;
2&gt; discard the VarMeasIdleReport upon successful delivery of the UEInformationResponse message confirmed by lower layers;
1&gt; if the logMeasReportReq is present and if the RPLMN is included in plmn-IdentityList stored in VarLogMeasReport:
2&gt; if VarLogMeasReport includes one or more logged measurement entries, set the contents of the logMeasReport in the UEInformationResponse message as follows:
3&gt; include the absoluteTimeStamp and set it to the value of absoluteTimeInfo in the VarLogMeasReport;
3&gt; include the traceReference and set it to the value of traceReference in the VarLogMeasReport;
3&gt; include the traceRecordingSessionRef and set it to the value of traceRecordingSessionRef in the VarLogMeasReport;
3&gt; include the tce-Id and set it to the value of tce-Id in the VarLogMeasReport;
3&gt; include the logMeasInfoList and set it to include one or more entries from the VarLogMeasReport starting from the entries logged first, and for each entry of the logMeasInfoList that is included, include all information stored in the corresponding logMeasInfoList entry in VarLogMeasReport;
3&gt; if the VarLogMeasReport includes one or more additional logged measurement entries that are not included in the logMeasInfoList within the UEInformationResponse message:
4&gt; include the logMeasAvailable;
4&gt; if bt-LocationInfo is included in locationInfo of one or more of the additional logged measurement entries in VarLogMeasReport that are not included in the logMeasInfoList within the UEInformationResponse message:
5&gt; include the logMeasAvailableBT;
4&gt; if wlan-LocationInfo is included in locationInfo of one or more of the additional logged measurement entries in VarLogMeasReport that are not included in the logMeasInfoList within the UEInformationResponse message:
5&gt; include the logMeasAvailableWLAN;
1&gt; if ra-ReportReq is set to true and the UE has random access related information available in VarRA-Report and if the RPLMN is included in plmn-IdentityList stored in VarRA-Report:
2&gt; set the ra-ReportList in the UEInformationResponse message to the value of ra-ReportList in VarRA-Report;
2&gt; discard the ra-ReportList from VarRA-Report upon successful delivery of the UEInformationResponse message confirmed by lower layers;
1&gt; if rlf-ReportReq is set to true:
2&gt; if the UE has radio link failure information or handover failure information available in VarRLF-Report and if the RPLMN is included in plmn-IdentityList stored in VarRLF-Report:
3&gt; set timeSinceFailure in VarRLF-Report to the time that elapsed since the last radio link failure or handover failure in NR;
3&gt; set the rlf-Report in the UEInformationResponse message to the value of rlf-Report in VarRLF-Report;
3&gt; discard the rlf-Report from VarRLF-Report upon successful delivery of the UEInformationResponse message confirmed by lower layers;
2&gt; else if the UE is capable of cross-RAT RLF reporting as defined in TS 38.306 and has radio link failure information or handover failure information available in VarRLF-Report of TS 36.331 and if the RPLMN is included in plmn-IdentityList stored in VarRLF-Report of TS 36.331 :
3&gt; set timeSinceFailure in VarRLF-Report of TS 36.331 to the time that elapsed since the last radio link failure or handover failure in EUTRA;
3&gt; set failedPCellId-EUTRA in the rlf-Report in the UEInformationResponse message to indicate the PCell in which RLF was detected or the source PCell of the failed handover in the VarRLF-Report of TS 36.331
3&gt; set the measResult-RLF-Report-EUTRA in the rlf-Report in the UEInformationResponse message to the value of rlf-Report in VarRLF-Report of TS 36.331 ;
3&gt; discard the rlf-Report from VarRLF-Report of TS 36.331 upon successful delivery of the UEInformationResponse message confirmed by lower layers;
1&gt; if connEstFailReportReq is set to true and the UE has connection establishment failure or connection resume failure information in VarConnEstFailReport or VarConnEstFailReportList and if the RPLMN is equal to plmn- Identity stored in VarConnEstFailReport:
2&gt; set timeSinceFailure in VarConnEstFailReport to the time that elapsed since the last connection establishment failure or connection resume failure in NR;
2&gt; set the connEstFailReport in the UEInformationResponse message to the value of connEstFailReport in VarConnEstFailReport;
2&gt; for each connEstFailReport in the connEstFailReportList in the UEInformationResponse message, set the value to the value of connEstFailReport in VarConnEstFailReport in VarConnEstFailReportList;
2&gt; discard the connEstFailReport from VarConnEstFailReport and VarConnEstFailReportList upon successful delivery of the UEInformationResponse message confirmed by lower layers;
1&gt; if the mobilityHistoryReportReq is set to true:
2&gt; include the mobilityHistoryReport and set it to include visitedCellInfoList from VarMobilityHistoryReport;
2&gt; include in the mobilityHistoryReport an entry for the current PCell, possibly after removing the oldest entry if required, and set its fields as follows:
3&gt; set visitedCellId to the global cell identity or the physical cell identity and carrier frequency of the current PCell:
3&gt; set field timeSpent to the time spent in the current PCell;
3&gt; if visitedPSCellInfoList is present in VarMobilityHistoryReport:
4&gt; for the newest entry of the PCell in the mobiliyHistoryReport, include visitedPSCellInfoList from VarMobilityHistoryReport;
4&gt; if the UE is configured with a PSCell:
5&gt; for the newest entry of the PCell in the mobiliyHistoryReport, include the current PSCell information in the visitedPSCellInfoList, possibly after removing the oldest entry, if required, and set its fields as follows:
6&gt; set visitedCellId to the global cell identity or the physical cell identity and carrier frequency of the current PSCell:
6&gt; set field timeSpent to the time spent in the current PSCell while being connected to the current PCell;
5&gt; for the newest entry of the PCell in the mobiliyHistoryReport, include a new entry in the visitedPSCellInfoList, possibly after removing the oldest entry, if required, and set its fields as follows:
6&gt; set field timeSpent to the time spent without PSCell in the current PCell since last PSCell release or secondary cell radio link failure since connected to the current PCell in RRC_CONNECTED;
4&gt; if the UE is configured with a PSCell:
5&gt; for the newest entry of the PCell in the mobiliyHistoryReport, include the current PSCell information in the visitedPSCellInfoList, possibly after removing the oldest entry, if required, and set its fields as follows:
6&gt; set visitedCellId to the global cell identity or the physical cell identity and carrier frequency of the current PSCell:
6&gt; set field timeSpent to the time spent in the current PSCell while being connected to the current PCell;
5&gt; for the newest entry of the PCell in the mobiliyHistoryReport, include a new entry in the visitedPSCellInfoList, possibly after removing the oldest entry, if required, and set its fields as follows:
6&gt; set field timeSpent to the time spent without PSCell in the current PCell since connected to the current PCell in RRC_CONNECTED;
1&gt; if the successHO-ReportReq is set to true and if the RPLMN is included in the plmn-IdentityList stored in VarSuccessHO-Report:
2&gt; if the successHO-Report in the VarSuccessHO-Report concerns a DAPS handover:
3&gt; set upInterruptionTimeAtHO in VarSuccessHO-Report to include the time elapsed between the time of arrival of the last PDCP PDU received from the source cell of the concerned handover and the time of arrival of the first non-duplicate PDCP PDU received from the target cell of the concerned handover, as measured at the time of arrival of the first non-duplicate PDCP PDU received from the target cell
2&gt; set the successHO-Report in the UEInformationResponse message to the value of successHO-Report in the VarSuccessHO-Report, if available;
2&gt; discard the VarSuccessHO-Report upon successful delivery of the UEInformationResponse message confirmed by lower layers;
1&gt; if the logMeasReport is included in the UEInformationResponse:
2&gt; submit the UEInformationResponse message to lower layers for transmission via SRB2;
2&gt; discard the logged measurement entries included in the logMeasInfoList from VarLogMeasReport upon successful delivery of the UEInformationResponse message confirmed by lower layers;
2&gt; submit the UEInformationResponse message to lower layers for transmission via SRB1.
5.7.10.4 Actions upon successful completion of a random-access procedure or on successful or unsuccessful completion of a procedure for request of on- demand system information
Upon successfully performing random-access procedure initialized with 4-step or 2-step RA type, or upon failed or successfully completed on-demand system information acquisition procedure, the UE shall:
1&gt; if the RPLMN or the PLMN selected by upper layers (see TS24.501 ) from the PLMN(s) included in the plmn-IdentityList in SIB1 is not included in plmn-IdentityList stored in a non-empty VarRA-Report:
2&gt; clear the information included in VarRA-Report;
1&gt; if the number of RA-Report entries stored in the ra-ReportList in VarRA-Report is less than maxRAReport:
2&gt; if the number of PLMN entries in plmn-IdentityList stored in VarRA-Report is less than maxPLMN; or
2&gt; if the number of PLMN entries in plmn-IdentityList stored in VarRA-Report is equal to maxPLMN and the list of EPLMNs is subset of or equal to the plmn-IdentityList stored in VarRA-Report:
3&gt; append the following contents associated to the successfully completed random-access procedure as a new entry in the VarRA-Report:
4&gt; if the list of EPLMNs has been stored by the UE:
5&gt; set the plmn-IdentityList to include the list of EPLMNs stored by the UE (i.e. includes the RPLMN) without exceeding the limit of maxPLMN;
5&gt; set the plmn-Identity, in plmn-IdentityList, to the PLMN selected by upper layers (see TS 24.501
) from the PLMN(s) included in the plmn-IdentityInfoList in SIB1;
4&gt; set the cellId to the global cell identity and the tracking area code, if available, otherwise to the physical cell identity and carrier frequency of the cell in which the corresponding random-access preamble was transmitted;
4&gt; if the corresponding random-access procedure was performed on an SCell of MCG:
5&gt; set the spCellId to the global cell identity of the PCell;
4&gt; if the corresponding random-access procedure was performed on an SCell of SCG:
5&gt; set the spCellId to the global cell identity of the PSCell;
4&gt; set the raPurpose to include the purpose of triggering the random-access procedure;
4&gt; set the ra-InformationCommon as specified in clause 5.7.10.5.
The UE may discard the random access report information, i.e. release the UE variable VarRA-Report, 48 hours after the last successful random access procedure related information is added to the VarRA-Report.
NOTE 1: The UE does not log the RA information in the RA report if the triggering event of the random access is consistent UL LBT on SpCell as specified in TS 38.321 .
5.7.10.5 RA information determination for RA report and RLF report
The UE shall set the content in ra-InformationCommon as follows:
1&gt; set the absoluteFrequencyPointA to indicate the absolute frequency of the reference resource block associated to the random-access resources used in the random-access procedure;
1&gt; set the locationAndBandwidth and subcarrierSpacing associated to the UL BWP of the random-access resources used in the random-access procedure;
1&gt; if contention based random-access resources are used in the random-access procedure:
2&gt; set the msg1-FrequencyStart associated to the 4 step random-access resources if used in the random-access procedure, and if its value is different from the value of msgA-RO-FrequencyStart if it is included in the ra- InformationCommon;
2&gt; set the msg1-FDM associated to the 4 step random-access resources if used in the random-access procedure, and if its value is different from the value of msgA-RO-FDMCFRA if it is included in the ra- InformationCommon;
2&gt; if msg1-SubcarrierSpacing associated to the 4 step random-access resources used in the random-access procedure is available, and if its value is different from the value of msgA-SubcarrierSpacing if it is included in the ra-InformationCommon:
3&gt; set the msg1-SubcarrierSpacing associated to the 4 step random-access resources used in the random- access procedure;
3&gt; set the msg1-SCS-From-prach-ConfigurationIndex to the subcarrier spacing as derived from the prach- ConfigurationIndex used in the 4-step random-access procedure, and if its value is different from the value of msgA-SCS-From-prach-ConfigurationIndex if it is included in the ra-InformationCommon;
2&gt; set the msgA_RO-FrequencyStart and msgA-RO-FDM and msgA-SubcarrierSpacing associated to the 2 step random- access resources if used in the random-access procedure;
2&gt; if msgA-SubcarrierSpacing associated to the 2 step random-access resources used in the random-access procedure is available:
3&gt; set the msgA-SubcarrierSpacing associated to the 2 step random-access resources used in the random- access procedure;
3&gt; set the msgA-SCS-From-prach-ConfigurationIndex to the subcarrier spacing as derived from the msgA- PRACH-ConfigurationIndex used in the 2-step random-access procedure;
1&gt; if contention free random-access resources are used in the random-access procedure:
2&gt; set the msg1-FrequencyStartCFRA and msg1-FDMCFRA associated to the 4 step random-access resources if used in the random-access procedure;
2&gt; if msg1-SubcarrierSpacing associated to the 4 step random-access resources used in the random-access procedure is available:
3&gt; set the msg1-SubcarrierSpacingCFRA associated to the 4 step random-access resources used in the random-access procedure;
3&gt; set the msg1-SCS-From-prach-ConfigurationIndex to the subcarrier spacing as derived from the prach- ConfigurationIndex used in the 4 step random-access procedure;
2&gt; set the msgA-RO-FrequencyStartCFRA and msgA-RO-FDMCFRA associated to the 2 step contention free randomaccess resources if used in the random-access procedure;
2&gt; set the msgA-MCS, the nrofPRBs-PerMsgA-PO, the msgA-PUSCH-TimeDomainAllocation, the frequencyStartMsgA-PUSCH, the nrofMsgA-PO-FDM associated to the 2 step random-access resources if used in the random-access procedure;
2&gt; if msgA-SubcarrierSpacing associated to the 2 step random-access resources used in the random-access procedure is available:
3&gt; set the msgA-SubcarrierSpacing associated to the 2 step random-access resources used in the random- access procedure;
3&gt; set the msgA-SCS-From-prach-ConfigurationIndex to the subcarrier spacing as derived from the msgA- PRACH-ConfigurationIndex used in the 2-step random-access procedure;
1&gt; if the random access procedure is initialized with RA_TYPE set to 2-stepRA as described in TS 38.321 :
2&gt; set the dlPathlossRSRP to the measeured RSRP of the DL pathloss reference obtained at the time of RA_Type selection stage of the initialization of the RA procedure as captured in TS 38.321 ;
2&gt; if the configuration for the random access msgA-TransMax was configured in RACH-ConfigDedicated for this random access procedure:
3&gt; set msgA-TransMax to the value of msgA-TransMax in RACH-ConfigDedicated;
2&gt; else if msgA-TransMax was configured in RACH-ConfigCommonTwoStepRA:
3&gt; set msgA-TransMax to the value of msgA-TransMax in RACH-ConfigCommonTwoStepRA;
2&gt; set the msgA-PUSCH-PayloadSize to the size of the overall payload available in the UE buffer at the time of initiating the 2 step RA procedure;
1&gt; if the purpose of the random access procedure is to request on-demand system information (i.e., if the raPurpose is set to requestForOtherSI or msg3RequestForOtherSI):
2&gt; set the intendedSIBs to indicate the SIB(s) the UE wanted to receive as a result of the SI request;
2&gt; set the ssbsForSI-Acquisition to indicate the SSB(s) used to receive the SI message;
2&gt; if the on-demand system information acquisition was successful:
3&gt; set the onDemandSISuccess to true;
3&gt; set the onDemandSISuccess to false;
1&gt; set the parameters associated to individual random-access attempt in the chronological order of attempts in the perRAInfoList as follows:
2&gt; if the random-access resource used is associated to a SS/PBCH block, set the associated random-access parameters for the successive random-access attempts associated to the same SS/PBCH block for one or more random-access attempts as follows:
3&gt; set the ssb-Index to include the SS/PBCH block index associated to the used random-access resource;
3&gt; set the numberOfPreamblesSentOnSSB to indicate the number of successive random-access attempts associated to the SS/PBCH block;
3&gt; for each random-access attempt performed on the random-access resource, include the following parameters in the chronological order of the random-access attempt:
4&gt; if the random-access attempt is performed on the contention based random-access resource and if raPurpose is not equal to 'requestForOtherSI', include contentionDetected as follows:
5&gt; if contention resolution was not successful as specified in TS 38.321 for the transmitted preamble:
6&gt; set the contentionDetected to true;
6&gt; set the contentionDetected to false;
4&gt; if the random access attempt is a 2-step random access attempt:
5&gt; if fallback from 2-step random access to 4-step random access occurred during the random access attempt:
6&gt; set fallbackToFourStepRA to true;
6&gt; set fallbackToFourStepRA to false;
4&gt; if the random-access attempt is performed on the contention based random-access resource; or
4&gt; if the random-access attempt is performed on the contention free random-access resource and if the random-access procedure was initiated due to the PDCCH ordering:
5&gt; if the random access attempt is a 4-step random access attempt and the SS/PBCH block RSRP of the SS/PBCH block corresponding to the random-access resource used in the random-access attempt is above rsrp-ThresholdSSB; or
5&gt; if the random access attempt is a 2-step random access attempt and the SS/PBCH block RSRP of the SS/PBCH block corresponding to the random-access resource used in the random-access attempt is above msgA-RSRP-ThresholdSSB:
6&gt; set the dlRSRPAboveThreshold to true;
6&gt; set the dlRSRPAboveThreshold to false;
2&gt; else if the random-access resource used is associated to a CSI-RS, set the associated random-access parameters for the successive random-access attempts associated to the same CSI-RS for one or more random-access attempts as follows:
3&gt; set the csi-RS-Index to include the CSI-RS index associated to the used random-access resource;
3&gt; set the numberOfPreamblesSentOnCSI-RS to indicate the number of successive random-access attempts associated to the CSI-RS.
5.7.10.6 Actions for the successful handover report determination
The UE shall:
1&gt; if the ratio between the value of the elapsed time of the timer T304 and the configured value of the timer T304, included in the last applied RRCReconfiguration message including the reconfigurationWithSync, is greater than thresholdPercentageT304 included in the successHO-Config received before executing the last reconfiguration with sync; or
1&gt; if the ratio between the value of the elapsed time of the timer T310 and the configured value of the timer T310, configured while the UE was connected to the source PCell before executing the last reconfiguration with sync, is greater than thresholdPercentageT310 included in the successHO-Config configured by the source PCell before executing the last reconfiguration with sync; or
1&gt; if the T312 associated to the measurement identity of the target cell was running at the time of initiating the execution of the reconfiguration with sync procedure and if the ratio between the value of the elapsed time of the timer T312 and the configured value of the timer T312, configured while the UE was connected to the source PCell before executing the last reconfiguration with sync, is greater than thresholdPercentageT312 included in the successHO-Config configured by the source PCell before executing the last reconfiguration with sync; or
1&gt; if sourceDAPS-FailureReporting included in the successHO-Config before executing the last reconfiguration with sync is set to true and if the last executed handover was a DAPS handover and if an RLF occurred at the source PCell during the DAPS handover while T304 was running:
2&gt; store the successful handover information in VarSuccessHO-Report and determine the content in VarSuccessHO-Report as follows:
3&gt; clear the information included in VarSuccessHO-Report, if any;
3&gt; set the plmn-IdentityList to include the list of EPLMNs stored by the UE (i.e., includes the RPLMN);
3&gt; set the c-RNTI to the C-RNTI assigned by the target PCell of the handover;
3&gt; for the source PCell in which the last RRCReconfiguration message including reconfigurationWithSync was applied:
4&gt; set the sourceCellID in sourceCellInfo to the global cell identity and tracking area code of the source PCell;
4&gt; set the sourceCellMeas in sourceCellInfo to include the cell level RSRP, RSRQ and the available SINR, of the source PCell based on the available SSB and CSI-RS measurements collected up to the moment the UE sends RRCReconfigurationComplete message;
4&gt; set the rsIndexResults in sourceCellMeas to include all the available SSB and CSI-RS measurement quantities of the source PCell collected up to the moment the UE sends RRCReconfigurationComplete message;
4&gt; if the last executed handover was a DAPS handover and if an RLF occurred at the source PCell during the DAPS handover while T304 was running:
5&gt; set the rlf-InSourceDAPS in sourceCellInfo to true;
3&gt; for the target PCell indicated in the last applied RRCReconfiguration message including reconfigurationWithSync:
4&gt; set the targetCellID in targetCellInfo to the global cell identity and tracking area code of the target PCell;
4&gt; set the targetCellMeas in targetCellInfo to include the cell level RSRP, RSRQ and the available SINR, of the target PCell based on the available SSB and CSI-RS measurements collected up to the moment the UE sends RRCReconfigurationComplete message;
4&gt; set the rsIndexResults in targetCellMeas to include all the available SSB and CSI-RS measurement quantities of the target PCell collected up to the moment the UE sends RRCReconfigurationComplete message;
4&gt; if the last applied RRCReconfiguration message including reconfigurationWithSync was included in the stored condRRCReconfig:
5&gt; set the timeSinceCHO-Reconfig to the time elapsed between the initiation of the execution of conditional reconfiguration for the target PCell and the reception of the last conditionalReconfiguration including the condRRCReconfig of the target PCell in the source PCell;
3&gt; if the ratio between the value of the elapsed time of the timer T304 and the configured value of the T304 timer, included in the last applied RRCReconfiguration message including the reconfigurationWithSync, is greater than thresholdPercentageT304 included in the successHO-Config received before executing the last reconfiguration with sync:
4&gt; set the ra-InformationCommon as specified in clause 5.7.10.5;
3&gt; if the ratio between the value of the elapsed time of the timer T310 and the configured value of the T310 timer, configured while the UE was connected to the source PCell before executing the last reconfiguration with sync, is greater than thresholdPercentageT310 included in the successHO-Config configured by the source PCell before executing the last reconfiguration with sync:
3&gt; if the ratio between the value of the elapsed time of the timer T312 and the configured value of the T312 timer, configured while the UE was connected to the source PCell before executing the last reconfiguration with sync, is greater than thresholdPercentageT312 included in the successHO-Config configured by the source PCell before executing the last reconfiguration with sync:
3&gt; if sourceDAPS-FailureReporting included in the successHO-Config configured by the source PCell before executing the last reconfiguration with sync is set to true, and if the last executed handover was a DAPS handover and if an RLF occurred at the source PCell during the DAPS handover while T304 was running:
3&gt; for each of the measObjectNR, configured by the source PCell, in which the last RRCReconfiguration message including reconfigurationWithSync was applied:
4&gt; if measurements are available for the measObjectNR:
5&gt; if the SS/PBCH block-based measurement quantities are available:
6&gt; set the measResultListNR in measResultNeighCells to include all the available measurement quantities of the best measured cells, other than the source PCell or target PCell, ordered such that the cell with highest SS/PBCH block RSRP is listed first if SS/PBCH block RSRP measurement results are available, otherwise the cell with highest SS/PBCH block RSRQ is listed first if SS/PBCH block RSRQ measurement results are available, otherwise the cell with highest SS/PBCH block SINR is listed first, based on the available SS/PBCH block based measurements collected up to the moment the UE sends the RRCReconfigurationComplete message;
6&gt; for each neighbour cell included, include the optional fields that are available;
5&gt; if the CSI-RS measurement quantities are available:
6&gt; set the measResultListNR in measResultNeighCells to include all the available measurement quantities of the best measured cells, other than the source PCell and target PCell, ordered such that the cell with highest CSI-RS RSRP is listed first if CSI-RS RSRP measurement results are available, otherwise the cell with highest CSI-RS RSRQ is listed first if CSI-RS RSRQ measurement results are available, otherwise the cell with highest CSI-RS SINR is listed first, based on the available CSI-RS based measurements collected up to the moment the UE sends the RRCReconfigurationComplete message;
6&gt; for each neighbour cell included, include the optional fields that are available;
3&gt; for each of the measObjectEUTRA, configured by the source PCell in which the last RRCReconfiguration message including reconfigurationWithSync was applied:
4&gt; if measurements are available for the measObjectEUTRA:
5&gt; set the measResultListEUTRA in measResultNeighCells to include the best measured cells ordered such that the cell with highest RSRP is listed first if RSRP measurement results are available, otherwise the cell with highest RSRQ is listed first, based on measurements collected up to the moment the UE sends the RRCReconfigurationComplete message;
5&gt; for each neighbour cell included, include the optional fields that are available;
3&gt; for each of the neighbour cells included in measResultNeighCells:
4&gt; if the cell was a candidate target cell included in the condRRCReconfig within the conditionalReconfiguration configured by the source PCell, in which the last RRCReconfiguration message including reconfigurationWithSync was applied:
5&gt; set the choCandidate to true in measResultNR;
3&gt; if available, set the locationInfo as in 5.3.3.7;
1&gt; release successHO-Config configured by the source PCell before executing the last reconfiguration with sync.
The UE may discard the successful handover information, i.e., release the UE variable VarSuccessHO-Report, 48 hours after the last successful handover information is added to the VarSuccessHO-Report.
5.7.12 IAB Other Information
5.7.12.1 General IAB-MT Network IABOtherInformation
The IAB Other Information procedure is used by IAB-MT to request the IAB-donor-CU to allocate IP address or inform the IAB-donor-CU of the IP address for the collocated IAB-DU.
5.7.12.2 Initiation
Upon initiation of the procedure, the IAB-MT shall:
1&gt; initiate transmission of the IABOtherInformation message in accordance with 5.7.12.3;
5.7.12.3 Actions related to transmission of IABOtherInformation message
The IAB-MT shall set the contents of IABOtherInformation message as follows:
1&gt; if the procedure is used to request IP addresses:
2&gt; if IPv4 addresses are requested:
3&gt; set the iab-IPv4-AddressNumReq to the number of IPv4 addresses requested per specific usage;
2&gt; if IPv6 addresses or IPv6 address prefixes are requested:
3&gt; if IPv6 addresses are requested:
4&gt; set the iab-IPv6-AddressNumReq to the number of IPv6 addresses requested per specific usage;
3&gt; else if IPv6 address prefixes are requested:
4&gt; set the iab-IPv6-AddressPrefixReq to true per specific usage;
1&gt; if the procedure is used to report IP addresses:
2&gt; if IPv4 addresses are reported:
3&gt; include iPv4-Address in iab-IPv4-AddressReport, and for each IP address included:
4&gt; if IPv4 addresses are used for F1-C traffic:
5&gt; include these addresses in f1-C-Traffic-IP-Address.
4&gt; if IPv4 addresses are used for F1-U traffic:
5&gt; include these addresses in f1-U-Traffic-IP-Address.
4&gt; if IPv4 address are used for non-F1 traffic:
5&gt; include these addresses in non-f1-Traffic-IP-Address.
4&gt; if IPv4 addresses are used for all traffic:
5&gt; include these addresses in all-Traffic-IAB-IP-Address.
2&gt; if IPv6 addresses or IPv6 address prefixes are reported:
3&gt; if IPv6 addresses are reported:
4&gt; include iPv6-Address in iab-IPv6-AddressReport, and for each IP address included;
5&gt; if IPv6 addresses are used for F1-C traffic:
6&gt; include these addresses in f1-C-Traffic-IP-Address.
5&gt; if IPv6 addresses are used for F1-U traffic:
6&gt; include these addresses in f1-U-Traffic-IP-Address.
5&gt; if IPv6 addresses are used for non-F1 traffic:
6&gt; include these addresses in non-f1-Traffic-IP-Address.
5&gt; if IPv6 addresses are used for all traffic:
6&gt; include these addresses in all-Traffic-IAB-IP-Address.
3&gt; else if IPv6 address prefixes are reported:
4&gt; include these iPv6-Prefix in iab-IPv6-PrefixReport, and for each IP address prefix included;
5&gt; if this IPv6 address prefix is used for F1-C traffic:
6&gt; include this prefix in f1-C-Traffic-IP-Address.
5&gt; if this IPv6 address prefix is used for F1-U traffic:
6&gt; include this prefix in f1-U-Traffic-IP-Address.
5&gt; if this IPv6 address prefix is used for non-F1 traffic:
6&gt; include this prefix in non-f1-Traffic-IP-Address.
5&gt; if this IPv6 address prefix is used for all traffic:
6&gt; include this prefix in all-Traffic-IAB-IP-Address.
1&gt; if the IAB-MT is in (NG)EN-DC:
3&gt; submit the IABOtherInformation message via SRB3 to lower layers for transmission;
3&gt; submit the IABOtherInformation message via the E-UTRA MCG embedded in E-UTRA RRC message ULInformationTransferMRDC as specified in TS 36.331 .
2&gt; submit the IABOtherInformation message to lower layers for transmission.
The UE is only allowed to perform RLM and/or BFD relaxation according to requirements specified in TS 38.133 when relaxed measurement criterion for low mobility and/or for good serving cell quality is met.
5.7.13.1 Relaxed measurement criterion for low mobility
Where: a) SS-RSRP = current L3 RSRP measurement of the SpCell based on SSB (dB). b) SS-RSRP = reference L3 RSRP measurement of the SpCell based on SSB (dB), set as follows:
Ref a) If the relaxed measurement criterion has not been met for T :
SearchDeltaP-Connected a) The UE shall set the value of SS-RSRP to the current SS-RSRP value of the SpCell.
Ref
5.7.13.2 Relaxed measurement criterion for good serving cell quality
The relaxed measurement criterion of good serving cell quality for RLM starts to be evaluated after receiving the good serving cell quality criterion configuration and is fulfilled when the downlink radio link quality on the configured RLM- RS resource is evaluated to be better than the threshold Q +XdB, wherein in , a) Q is specified in clause 8.1 of TS 38.133 .
in a) X is the parameter offset in goodServingCellEvaluationRLM.
The relaxed measurement criterion of good serving cell quality for BFD starts to be evaluated after receiving the good serving cell quality criterion configuration and is fulfilled when the downlink radio link quality on the configured BFD- RS resource is evaluated to be better than the threshold Q +XdB, wherein in , a) Q is specified in clause 8.1 of TS 38.133 .
in
X is the parameter offset in goodServingCellEvaluationBFD.
5.7.14 UE Positioning Assistance Information
5.7.14.1 General UE Network RRCReconfiguration UEPositioningAssistanceInfo
The UE Positioning Assistance Information procedure is used by UE to report the UE Positioning Assistance
Information. The UE reports the association between UL-SRS resources for positioning and the UE Tx TEG ID.
5.7.14.2 Initiation
A UE capable of providing the association between UL SRS Resource for positioning and UE Tx TEG ID in RRC_CONNECTED may initiate the procedure upon being configured to provide this association information.
Upon initiation of the procedure, the UE shall:
1&gt; if ue-TxTEG-RequestUL-TDOA-Config in SRS-Config IE is configured to request the association between UL SRS Resource for positioning and Tx TEG:
2&gt; initiate transmission of the UEPositioningAssistanceInfo message in accordance with 5.7.14.3 to provide the
5.7.14.3 Actions related to transmission of UEPositioningAssistanceInfo message
The UE shall set the contents of the UEPositioningAssistanceInfo message as follows:
1&gt; if transmission of the UEPositioningAssistanceInfo message is initiated to provide the association between UL SRS Resource for positioning and Tx TEG according to 5.7.14.2;
2&gt; include ue-TxTEG-AssociationList in the UEPositioningAssistanceInfo message;
5.7.15 SRS for Positioning in RRC_INACTIVE
5.7.15.1 General SRS for Positioning can be configured to be transmitted in RRC_INACTIVE mode.
UE Network RRCRelease(SuspendConfig)
5.7.15.2 Actions Related to SRS for Positioning at Cell Re-selection in RRC_INACTIVE
The UE shall:
1&gt; if cell reselection occurs when srs-PosRRC-InactiveConfig is configured:
2&gt; consider the Timing Advance value for SRS for Positioning transmission to be invalid;
2&gt; release the srs-PosRRC-InactiveConfig.
Editor's Note: To check further if clause 5.7.14 and 5.7.15 can be consolidated under new clause 5.X NR Positioning similar to clause 5.8 Sidelink.
5.7.16 Application layer measurement reporting
5.7.16.1 General UE Network RRC reconfiguration MeasurementReportAppLayer
The purpose of this procedure is to send application layer measurement reports to the network.
5.7.16.2 Initiation
A UE capable of application layer measurement reporting in RRC_CONNECTED may initiate the procedure when configured with application layer measurement, i.e. when appLayerMeasConfig and SRB4 have been configured by the
Upon initiating the procedure, the UE shall:
1&gt; for each measConfigAppLayerId:
2&gt; if the UE AS has received, but not sent, application layer measurement report from upper layers; and
2&gt; if the application layer measurement reporting has not been suspended for the measConfigAppLayerId associated with the application layer measurement report according to clause 5.3.5.13d:
3&gt; set the measReportAppLayerContainer in the MeasurementReportAppLayer message to the received value of the application layer measurement report;
2&gt; set the measConfigAppLayerId in the MeasurementReportAppLayer message to the value of the measConfigAppLayerId received together with application layer measurement report information;
2&gt; if session start or stop information has been received from upper layers for the measConfigAppLayerId:
3&gt; set the appLayerSessionStatus to the received value of the application layer measurement information;
2&gt; if RAN visible application layer measurement report has been received from upper layers:
3&gt; for each appLayerBufferLevel value in the received RAN visible application layer measurement report:
4&gt; set the appLayerBufferLevel values in the appLayerBufferLevelLIst to the buffer level values received from the upper layer in the order with the first appLayerBufferLevel value set to the newest received buffer level value, the second appLayerBufferLevel value set to the second newest received buffer level value, and so on until all the buffer level values received from the upper layer have been assigned or the configured maximum number of appLayerBufferLevel values have been set, if any;
3&gt; set the initialPlayoutDelay to the received value in the RAN visible application layer measurement report, if any;
3&gt; for each PDU session ID value indicated in the received RAN visible application layer measurement report, if any:
4&gt; set the PDU-SessionID field in the pdu-SessionIdList to the indicated PDU session ID value;
2&gt; if the RRC message segmentation is enabled based on the field rrc-SegAllowed received in appLayerMeasConfig, and the encoded RRC message is larger than the maximum supported size of a PDCP SDU specified in TS 38.323 :
3&gt; initiate the UL message segment transfer procedure as specified in clause 5.7.7;
3&gt; submit the MeasurementReportAppLayer message to lower layers for transmission upon which the procedure ends.
5.8 Sidelink
5.8.1 General NR sidelink communication consists of unicast, groupcast and broadcast. For unicast, the PC5-RRC connection is a logical connection between a pair of a Source Layer-2 ID and a Destination Layer-2 ID in the AS. The PC5-RRC signalling, as specified in clause 5.8.9, can be initiated after its corresponding PC5 unicast link establishment (TS
23.287 ). The PC5-RRC connection and the corresponding sidelink SRBs and sidelink DRB(s) are released when the PC5 unicast link is released as indicated by upper layers.
For each PC5-RRC connection of unicast, one sidelink SRB (i.e. SL-SRB0) is used to transmit the PC5-S message(s) before the PC5-S security has been established. One sidelink SRB (i.e. SL-SRB1) is used to transmit the PC5-S messages to establish the PC5-S security. One sidelink SRB (i.e. SL-SRB2) is used to transmit the PC5-S messages after the PC5-S security has been established, which is protected. One sidelink SRB (i.e. SL-SRB3) is used to transmit the PC5-RRC signalling, which is protected and only sent after the PC5-S security has been established. For U2N Relay operation, one sidelink SRB (i.e. SL-SRB4) is used to transmit/receive the NR sidelink discovery messages.
For unicast of NR sidelink communication, AS security comprises of integrity protection of PC5 signalling (SL-SRB1, SL-SRB2 and SL-SRB3) and user data (SL-DRBs), and it further comprises of ciphering of PC5 signaling (SL-SRB1 only for the Direct Link Security Mode Complete message as specified in TS 24.587, SL-SRB2 and SL-SRB3) and user data (SL-DRBs). The ciphering and integrity protection algorithms and parameters for a PC5 unicast link are exchanged by PC5-S messages in the upper layers as specified in TS 33.536 , and apply to the corresponding PC5- RRC connection in the AS. Once AS security is activated for a PC5 unicast link in the upper layers as specified in TS
33.536 , all messages on SL-SRB2 and SL-SRB3 and/or user data on SL-DRBs of the corresponding PC5-RRC connection are integrity protected and/or ciphered by the PDCP.
For unicast of NR sidelink communication, if the change of the key is indicated by the upper layers as specified in TS
24.587 , UE re-establishes the PDCP entity of the SL-SRB1, SL-SRB2, SL-SRB3 and SL-DRBs on the corresponding PC5-RRC connection.
NOTE 1: In case the configurations for NR sidelink communication are acquired via the E-UTRA, the configurations for NR sidelink communication in SIB12 and sl-ConfigDedicatedNR within RRCReconfiguration used in clause 5.8 are provided by the configurations in SystemInformationBlockType28 and sl-ConfigDedicatedForNR within RRCConnectionReconfiguration as specified in TS 36.331 , respectively.
NOTE 2: In this release, there is one-to-one correspondence between the PC5-RRC connection and the PC5 unicast link as specified in TS 38.300.
NOTE 3: All SL-DRBs related to the same PC5-RRC connection have the same activation/deactivation setting for ciphering and the same activation/deactivation setting for integrity protection as in TS 33.536 .
NOTE 4: When integrity check failure concerning SL-SRB1 for a specific destination is detected, the UE sends an indication to the upper layers .
5.8.2 Conditions for NR sidelink communication operation
The UE shall perform NR sidelink communication operation only if the conditions defined in this clause are met:
1&gt; if the UE's serving cell is suitable (RRC_IDLE or RRC_INACTIVE or RRC_CONNECTED); and if either the selected cell on the frequency used for NR sidelink communication operation belongs to the registered or equivalent PLMN as specified in TS 24.587 or the UE is out of coverage on the frequency used for NR sidelink communication operation as defined in TS 38.304 and TS 36.304 ; or
1&gt; if the UE's serving cell (RRC_IDLE or RRC_CONNECTED) fulfils the conditions to support NR sidelink communication in limited service state as specified in TS 23.287 ; and if either the serving cell is on the frequency used for NR sidelink communication operation or the UE is out of coverage on the frequency used for NR sidelink communication operation as defined in TS 38.304 and TS 36.304 ; or
1&gt; if the UE has no serving cell (RRC_IDLE);
5.8.3 Sidelink UE information for NR sidelink communication
5.8.3.1 General SIB12 acquisition SidelinkUEInformationNR
The purpose of this procedure is to inform the network that the UE: a) is interested or no longer interested to receive or transmit NR sidelink communication, b) is requesting assignment or release of transmission resource for NR sidelink communication, c) is reporting QoS parameters and QoS profile(s) related to NR sidelink communication, d) is reporting that a sidelink radio link failure or sidelink RRC reconfiguration failure has been detected, e) is reporting the sidelink UE capability information of the associated peer UE for unicast communication, f) is reporting the RLC mode information of the sidelink data radio bearer(s) received from the associated peer UE for unicast communication, g) is reporting the sidelink DRX configuration received from the associated peer UE for NR sidelink unicast communication, h) is reporting the sidelink DRX assistance information received from the associated peer UE for NR sidelink unicast communication, i) is reporting, for NR sidelink groupcast or broadcast communication, [FFS on additional information], j) is reporting, for NR sidelink groupcast or broadcast communication, the Destination Layer-2 ID and QoS profile associated with its interested services that sidelink DRX is applied, k) is reporting DRX configuration reject information from its associated peer RX UE, when the UE is a TX UE and is performing sidelink operation with resource allocation mode 1, l) is reporting parameters related to U2N relay operation.
Editor's Note: FFS on the additional information/Tx profile, pending on reply from SA2 relate to WA "no additional RAN2 work if SA2 confirms it is feasible (whether the mapping from L2 id to TX profile is feasible in the gNB (like what we did in LTE)".
5.8.3.2 Initiation
A UE capable of NR sidelink communication or NR sidelink discovery or NR sidelink U2N relay operation that is in RRC_CONNECTED may initiate the procedure to indicate it is (interested in) receiving or transmitting NR sidelink communication or NR sidelink discovery or NR sidelink U2N relay operation in several cases including upon successful connection establishment or resuming, upon change of interest, upon changing QoS profiles, upon receiving UECapabilityInformationSidelink from the associated peer UE, upon RLC mode information updated from the associated peer UE or upon change to a PCell providing SIB12 including sl-ConfigCommonNR. A UE capable of NR sidelink communication may initiate the procedure to request assignment of dedicated sidelink DRB configuration and transmission resources for NR sidelink communication transmission. A UE capable of NR sidelink communication may initiate the procedure to report to the network that a sidelink radio link failure or sidelink RRC reconfiguration failure has been declared. A UE capable of NR sidelink discovery may initiate the procedure to request assignment of dedicated resources for sidelink discovery transmission or sidelink discovery reception. A UE capable of U2N relay operation may initiate the procedure to report/update parameters for acting as U2N Relay UE or U2N Remote UE (including L2 Remote UE's source L2 ID).
A UE capable of NR sidelink communication that is in RRC_CONNECTED may initiate the procedure to report the sidelink DRX configuration received from the associated peer UE for NR sidelink unicast communication, upon accepting the sidelink DRX configuration from the associated peer UE. A UE capable of NR sidelink communication that is in RRC_CONNECTED and is performing sidelink operation with resource allocation mode 1 may initiate the procedure to report the sidelink DRX assistance information received from the associated peer UE for NR sidelink unicast communication, upon receiving sidelink DRX assistance information from the associated peer UE.
An RX UE capable of NR sidelink communication that is in RRC_CONNECTED may initiate the procedure to report the Destination Layer-2 ID and QoS profile associated with its interested services that sidelink DRX is applied, for NR sidelink groupcast or broadcast communication.
Upon initiating this procedure, the UE shall:
1&gt; if SIB12 including sl-ConfigCommonNR is provided by the PCell:
2&gt; ensure having a valid version of SIB12 for the PCell;
2&gt; if configured by upper layers to receive NR sidelink communication on the frequency included in sl- FreqInfoList in SIB12 of the PCell:
3&gt; if the UE did not transmit a SidelinkUEInformationNR message since last entering RRC_CONNECTED state; or
3&gt; if since the last time the UE transmitted a SidelinkUEInformationNR message the UE connected to a PCell not providing SIB12 including sl-ConfigCommonNR; or
3&gt; if the last transmission of the SidelinkUEInformationNR message did not include sl-RxInterestedFreqList; or if the frequency configured by upper layers to receive NR sidelink communication on has changed since the last transmission of the SidelinkUEInformationNR message:
4&gt; initiate transmission of the SidelinkUEInformationNR message to indicate the NR sidelink communication reception frequency of interest in accordance with 5.8.3.3;
3&gt; if the UE received a sidelink DRX configuration for NR sidelink unicast communication from the associated peer UE and the UE accepted the sidelink DRX configuration:
4&gt; initiate transmission of the SidelinkUEInformationNR message to report the sidelink DRX configuration in accordance with 5.8.3.3;
3&gt; if the UE is an RX UE for NR sidelink groupcast or broadcast communication and is interested in a service that sidelink DRX is applied:
4&gt; initiate transmission of the SidelinkUEInformationNR message to report the Destination Layer-2 ID and QoS profile associated with the service in accordance with 5.8.3.3;
3&gt; if the last transmission of the SidelinkUEInformationNR message included sl-RxInterestedFreqList:
4&gt; initiate transmission of the SidelinkUEInformationNR message to indicate it is no longer interested in NR sidelink communication reception in accordance with 5.8.3.3;
2&gt; if configured by upper layers to transmit NR sidelink communication on the frequency included in sl- FreqInfoList in SIB12 of the PCell:
3&gt; if the UE did not transmit a SidelinkUEInformationNR message since last entering RRC_CONNECTED state; or
3&gt; if since the last time the UE transmitted a SidelinkUEInformationNR message the UE connected to a PCell not providing SIB12 including sl-ConfigCommonNR; or
3&gt; if the last transmission of the SidelinkUEInformationNR message did not include sl-TxResourceReqList; or if the information carried by the sl-TxResourceReqList has changed since the last transmission of the SidelinkUEInformationNR message:
4&gt; initiate transmission of the SidelinkUEInformationNR message to indicate the NR sidelink communication transmission resources required by the UE in accordance with 5.8.3.3;
3&gt; if the UE received a sidelink DRX assistance information for NR sidelink unicast communication from the associated peer UE:
4&gt; initiate transmission of the SidelinkUEInformationNR message to report the sidelink DRX assistance information in accordance with 5.8.3.3;
3&gt; if the last transmission of the SidelinkUEInformationNR message included sl-TxResourceReqList:
4&gt; initiate transmission of the SidelinkUEInformationNR message to indicate it no longer requires NR sidelink communication transmission resources in accordance with 5.8.3.3.
2&gt; if configured by upper layer to receive NR sidelink non-relay discovery announcements on the frequency included in sl-FreqInfoList in SIB12 of the PCell including sl-NonRelayDiscovery:
3&gt; if the UE did not transmit a SidelinkUEInformationNR message since last entering RRC_CONNECTED state; or
3&gt; if since the last time the UE transmitted a SidelinkUEInformationNR message the UE connected to a PCell not providing SIB12 including sl-ConfigCommonNR or connected to a PCell providing SIB12 but not including sl-NonRelayDiscovery; or
3&gt; if the last transmission of the SidelinkUEInformationNR message did not include sl- RxInterestedFreqListDisc; or if the frequency configured by upper layers to receive NR sidelink discovery announcements on has changed since the last transmission of the SidelinkUEInformationNR message:
4&gt; initiate transmission of the SidelinkUEInformationNR message to indicate the NR sidelink discovery reception frequency of interest in accordance with 5.8.3.3;
3&gt; if the last transmission of the SidelinkUEInformationNR message included sl-RxInterestedFreqListDisc:
4&gt; initiate transmission of the SidelinkUEInformationNR message to indicate it is no longer interested in NR sidelink discovery announcements reception in accordance with 5.8.3.3;
2&gt; if configured by upper layer to receive NR sidelink L2 U2N relay discovery announcements on the frequency included in sl-FreqInfoList in SIB12 of the PCell including sl-L2U2N-Relay; or if configured by upper layer to receive NR sidelink L3 U2N relay discovery announcements on the frequency included in sl-FreqInfoList in SIB12 of the PCell including sl-L3U2N-RelayDiscovery:
3&gt; if the UE did not transmit a SidelinkUEInformationNR message since last entering RRC_CONNECTED state; or
3&gt; if since the last time the UE transmitted a SidelinkUEInformationNR message the UE connected to a PCell not providing SIB12 including sl-ConfigCommonNR or connected to a PCell providing SIB12 but not including sl-L2U2N-Relay in case of L2 U2N relay operation or connected to a PCell providing SIB12 but not including sl-L3U2N-RelayDiscovery in case of L3 U2N relay operation; or
3&gt; if the last transmission of the SidelinkUEInformationNR message did not include sl- RxInterestedFreqListDisc; or if the frequency configured by upper layers to receive NR sidelink discovery announcements on has changed since the last transmission of the SidelinkUEInformationNR message:
4&gt; if the UE is (capable of) acting as U2N Relay UE, and if SIB12 includes sl-RelayUE-ConfigCommon, and if the U2N Relay UE threshold conditions as specified in 5.8.14.2 are met; or
4&gt; if the UE is selecting a U2N Relay UE / has a selected U2N Relay UE, and if SIB12 includes sl- RemoteUE-ConfigCommon, and if the U2N Remote UE threshold conditions as specified in 5.8.15.2 are met:
5&gt; initiate transmission of the SidelinkUEInformationNR message to indicate the NR sidelink discovery reception frequency of interest in accordance with 5.8.3.3;
3&gt; if the last transmission of the SidelinkUEInformationNR message included sl-RxInterestedFreqListDisc:
4&gt; initiate transmission of the SidelinkUEInformationNR message to indicate it is no longer interested in NR sidelink discovery announcements reception in accordance with 5.8.3.3;
2&gt; if configured by upper layer to transmit NR sidelink non-relay discovery announcements on the frequency included in sl-FreqInfoList in SIB12 of the PCell including sl-NonRelayDiscovery:
3&gt; if the UE did not transmit a SidelinkUEInformationNR message since last entering RRC_CONNECTED state; or
3&gt; if since the last time the UE transmitted a SidelinkUEInformationNR message the UE connected to a PCell not providing SIB12 including sl-ConfigCommonNR or connected to a PCell providing SIB12 but not including sl-NonRelayDiscovery; or
3&gt; if the last transmission of the SidelinkUEInformationNR message did not include sl- TxResourceReqListDisc; or if the information carried by the sl-TxResourceReqListDisc has changed since the last transmission of the SidelinkUEInformationNR message:
4&gt; initiate transmission of the SidelinkUEInformationNR message to indicate the NR sidelink non-relay discovery announcements resources required by the UE in accordance with 5.8.3.3;
3&gt; if the last transmission of the SidelinkUEInformationNR message included sl-TxResourceReqListDisc:
4&gt; initiate transmission of the SidelinkUEInformationNR message to indicate it no longer requires NR sidelink non-relay discovery announcements resources in accordance with 5.8.3.3;
2&gt; if configured by upper layer to transmit NR sidelink L2 U2N relay discovery announcements on the frequency included in sl-FreqInfoList in SIB12 of the PCell including sl-L2U2N-Relay; or if configured by upper layer to transmit NR sidelink L3 U2N relay discovery announcements on the frequency included in sl- FreqInfoList in SIB12 of the PCell including sl-L3U2N-RelayDiscovery:
3&gt; if the UE did not transmit a SidelinkUEInformationNR message since last entering RRC_CONNECTED state; or
3&gt; if since the last time the UE transmitted a SidelinkUEInformationNR message the UE connected to a PCell not providing SIB12 including sl-ConfigCommonNR or connected to a PCell providing SIB12 but not including sl-L2U2N-Relay in case L2 U2N relay operation or connected to a PCell providing SIB12 but not including sl-L3U2N-RelayDiscovery in case of L3 U2N relay operation; or
3&gt; if the last transmission of the SidelinkUEInformationNR message did not include sl- TxResourceReqListDisc; or if the information carried by the sl-TxResourceReqListDisc has changed since the last transmission of the SidelinkUEInformationNR message:
4&gt; if the UE is (capable of) acting as U2N Relay UE, and if SIB12 includes sl-RelayUE-ConfigCommon, and if the U2N Relay UE threshold conditions as specified in 5.8.14.2 are met; or
4&gt; if the UE is selecting a U2N Relay UE / has a selected U2N Relay UE, and if SIB12 includes sl- RemoteUE-ConfigCommon, and if the U2N Remote UE threshold conditions as specified in 5.8.15.2 are met:
5&gt; initiate transmission of the SidelinkUEInformationNR message to indicate the NR sidelink relay discovery announcements resources required by the UE in accordance with 5.8.3.3;
3&gt; if the last transmission of the SidelinkUEInformationNR message included sl-TxResourceReqListDisc:
4&gt; initiate transmission of the SidelinkUEInformationNR message to indicate it no longer requires NR sidelink relay discovery announcements resources in accordance with 5.8.3.3;
2&gt; if configured by upper layer to transmit NR sidelink L2 U2N relay communication on the frequency included in sl-FreqInfoList in SIB12 of the PCell including sl-L2U2N-Relay or if configured by upper layer to transmit NR sidelink L3 U2N relay communication on the frequency included in sl-FreqInfoList in SIB12 of the PCell including sl-L3U2N-RelayDiscovery:
3&gt; if the UE did not transmit a SidelinkUEInformationNR message since last entering RRC_CONNECTED state; or
3&gt; if since the last time the UE transmitted a SidelinkUEInformationNR message the UE connected to a PCell not providing SIB12 including sl-ConfigCommonNR or connected to a PCell providing SIB12 but not including sl-L2U2N-Relay in case L2 U2N relay operation or connected to a PCell providing SIB12 but not including sl-L3U2N-RelayDiscovery in case of L3 U2N relay operation; or
3&gt; if the last transmission of the SidelinkUEInformationNR message did not include sl- TxResourceReqListDisc; or if the information carried by the sl-TxResourceReqListDisc has changed since the last transmission of the SidelinkUEInformationNR message:
4&gt; if the UE is (capable of) acting as U2N Relay UE, and if SIB12 includes sl-RelayUE-ConfigCommon, and if the U2N Relay UE threshold conditions as specified in 5.8.14.2 are met; or
4&gt; if the UE is selecting a U2N Relay UE / has a selected U2N Relay UE, and if SIB12 includes sl- RemoteUE-ConfigCommon, and if the U2N Remote UE threshold conditions as specified in 5.8.15.2 are met:
5&gt; initiate transmission of the SidelinkUEInformationNR message to indicate the NR sidelink relay discovery announcements resources required by the UE in accordance with 5.8.3.3;
3&gt; if the last transmission of the SidelinkUEInformationNR message included sl-TxResourceReqListDisc:
4&gt; initiate transmission of the SidelinkUEInformationNR message to indicate it no longer requires NR sidelink relay discovery announcements resources in accordance with 5.8.3.3;
5.8.3.3 Actions related to transmission of SidelinkUEInformationNR message
The UE shall set the contents of the SidelinkUEInformationNR message as follows:
1&gt; if the UE initiates the procedure to indicate it is (no more) interested to receive NR sidelink communication or to request (configuration/ release) of NR sidelink communication transmission resources or to report to the network that a sidelink radio link failure or sidelink RRC reconfiguration failure has been declared or to report to the network the sidelink DRX configuration for NR sidelink unicast communication or to report to the network the sidelink DRX assistance information for NR sidelink unicast communication or to report the Destination Layer-2 ID and QoS profile associated with its interested services that sidelink DRX is applied for NR sidelink groupcast or broadcast communication or to indicate it is (no more) interested to receive NR sidelink discovery announcements or to request (configuration/ release) of NR sidelink discovery announcements transmission resources or to request (configuration/ release) of NR sidelink U2N relay communication transmission resources (i.e. UE includes all concerned information, irrespective of what triggered the procedure):
2&gt; if SIB12 including sl-ConfigCommonNR is provided by the PCell:
3&gt; if configured by upper layers to receive NR sidelink communication:
4&gt; include sl-RxInterestedFreqList and set it to the frequency for NR sidelink communication reception;
4&gt; include sl-RxDRX-ReportList and set its fields (if needed) as follows for each destination for which it reports to network:
5&gt; if sl-DRX-ConfigCommon-GC-BC is included in SIB12-IEs:
6&gt; set sl-DRX-ConfigFromTx to include the accepted sidelink DRX configuration of the associated destination, if received from the associated peer UE;
6&gt; set sl-RxInterestedQoS-InfoList to include the QoS profile of its interested service for the associated destination for NR sidelink groupcast or broadcast communication;
3&gt; if configured by upper layers to transmit NR sidelink communication:
4&gt; include sl-TxResourceReqList and set its fields (if needed) as follows for each destination for which it requests network to assign NR sidelink communication resource:
5&gt; set sl-DestinationIdentity to the destination identity configured by upper layer for NR sidelink communication transmission;
5&gt; set sl-CastType to the cast type of the associated destination identity configured by the upper layer for the NR sidelink communication transmission;
5&gt; set sl-RLC-ModeIndication to include the RLC mode(s) and optionally QoS profile(s) of the sidelink QoS flow(s) of the associated RLC mode(s), if the associated bi-directional sidelink DRB has been established due to the configuration by RRCReconfigurationSidelink;
5&gt; set sl-QoS-InfoList to include QoS profile(s) of the sidelink QoS flow(s) of the associated destination configured by the upper layer for the NR sidelink communication transmission;
5&gt; set sl-InterestedFreqList to indicate the frequency of the associated destination for NR sidelink communication transmission;
5&gt; set sl-TypeTxSyncList to the current synchronization reference type used on the associated sl- InterestedFreqList for NR sidelink communication transmission.
5&gt; set sl-CapabilityInformationSidelink to include UECapabilityInformationSidelink message, if any, received from the associated peer UE.
5&gt; if sl-DRX-ConfigCommon-GC-BC is included in SIB12-IEs and UE is configured with sl- ScheduledConfig:
6&gt; set sl-DRX-InfoFromRx to include the sidelink DRX assistance information of the associated destination, if any, received from the associated peer UE; Editor's Note: FFS on the message used for Tx UE to report DRX configuration reject information.
4&gt; if a sidelink radio link failure or a sidelink RRC reconfiguration failure has been declared, according to clauses 5.8.9.3 and 5.8.9.1.8, respectively;
5&gt; include sl-FailureList and set its fields as follows for each destination for which it reports the NR sidelink communication failure:
6&gt; set sl-DestinationIdentity to the destination identity configured by upper layer for NR sidelink communication transmission;
6&gt; if the sidelink RLF is detected as specified in clause 5.8.9.3:
7&gt; set sl-Failure as rlf for the associated destination for the NR sidelink communication transmission;
6&gt; else if RRCReconfigurationFailureSidelink is received:
7&gt; set sl-Failure as configFailure for the associated destination for the NR sidelink communication transmission;
3&gt; if SIB12 including sl-NonRelayDiscovery and if configured by upper layers to receive NR sidelink non- relay discovery announcements, or if SIB12 including sl-L2U2N-Relay and if configured by upper layers to receive NR sidelink L2 U2N relay discovery announcements, or if SIB12 including sl-L3U2N- RelayDiscovery and if configured by upper layers to receive NR sidelink L3 U2N relay discovery announcements:
4&gt; include sl-RxInterestedFreqListDisc and set it to the frequency for NR sidelink discovery announcements reception;
4&gt; if the UE is capable of L2 U2N remote UE:
5&gt; include sl-SourceIdentity-RemoteUE and set it to the source identity configured by upper layer for NR sidelink L2 U2N relay communication transmission;
3&gt; if SIB12 including sl-NonRelayDiscovery and if configured by upper layers to transmit NR sidelink non- relay discovery announcements, or if SIB12 including sl-L2U2N-Relay and if configured by upper layers to transmit NR sidelink L2 U2N relay discovery announcements, or if SIB12 including sl-L3U2N- RelayDiscovery and if configured by upper layers to transmit NR sidelink L3 U2N relay discovery announcements:
4&gt; include sl-TxResourceReqListDis and set its fields (if needed) as follows for each destination for which it requests network to assign NR sidelink discovery announcements resource:
5&gt; set sl-DestinationIdentityDisc to the destination identity configured by upper layer for NR sidelink discovery announcements transmission;
5&gt; if the UE is acting as L2 U2N Relay UE
6&gt; set sl-SourceIdentity-RelayUE to the source identity configured by upper layer for NR sidelink L2 U2N relay discovery announcements transmission;
5&gt; set sl-CastTypeDisc to the cast type of the associated destination identity configured by the upper layer for the NR sidelink discovery announcements transmission;
5&gt; set sl-InterestedFreqListDisc to indicate the frequency of the associated destination for NR sidelink discovery announcements transmission;
5&gt; set sl-TypeTxSyncListDisc to the current synchronization reference type used on the associated sl- InterestedFreqList for NR sidelink discovery announcements transmission;
5&gt; set sl-DiscoveryType to the current discovery type of the associated destination identity configured by the upper layer for NR sidelink discovery announcements transmission;
3&gt; if configured by upper layers to transmit NR sidelink L2 U2N relay communication and the UE is acting as L2 U2N Relay UE:
4&gt; include sl-TxResourceReqL2U2N-Relay in sl-TxResourceReqListCommRelay and set its fields (if
needed) as follows for each destination for which it requests network to assign NR sidelink L2 U2N relay communication resource:
5&gt; set sl-DestinationIdentityL2U2N to the destination identity configured by upper layer for NR sidelink L2 U2N relay communication transmission;
5&gt; set sl-TxInterestedFreqListL2U2N to indicate the frequency of the associated destination for NR sidelink L2 U2N relay communication transmission;
5&gt; set sl-TypeTxSyncListL2U2N to the current synchronization reference type used on the associated sl-InterestedFreqListL2U2N for NR sidelink L2 U2N relay communication transmission;
5&gt; set sl-LocalID-Request to request local ID for L2 U2N Remote UE;
5&gt; set sl-PagingIdentity-RemoteUE to the paging UE ID received from peer L2 U2N Remote UE;
5&gt; set sl-CapabilityInformationSidelink to include UECapabilityInformationSidelink message, if any, received from peer UE.
4&gt; include ue-Type and set it to relayUE;
3&gt; if configured by upper layers to transmit NR sidelink L2 U2N relay communication and the UE has a selected L2 U2N Relay UE:
4&gt; include sl-TxResourceReqL2U2N-Relay in sl-TxResourceReqListCommRelay and set its fields (if
needed) as follows to request network to assign NR sidelink L2 U2N relay communication resource:
5&gt; set sl-TxInterestedFreqListL2U2N to indicate the frequency of the associated destination for NR sidelink L2 U2N relay communication transmission;
5&gt; set sl-TypeTxSyncListL2U2N to the current synchronization reference type used on the associated sl-InterestedFreqListL2U2N for NR sidelink L2 U2N relay communication transmission;
5&gt; set sl-CapabilityInformationSidelink to include UECapabilityInformationSidelink message, if any, received from peer UE.
4&gt; include ue-Type and set it to remoteUE;
3&gt; if configured by upper layers to transmit NR sidelink L3 U2N relay communication:
4&gt; include sl-TxResourceReqL3U2N-Relay in sl-TxResourceReqListCommRelay and set its fields (if
needed) as follows for each destination for which it requests network to assign NR sidelink L3 U2N relay communication resource:
5&gt; set sl-DestinationIdentity to the destination identity configured by upper layer for NR sidelink L3 U2N relay communication transmission;
5&gt; set sl-CastType to the cast type of the associated destination identity configured by the upper layer for the NR sidelink L3 U2N relay communication transmission;
5&gt; set sl-RLC-ModeIndication to include the RLC mode(s) and optionally QoS profile(s) of the sidelink QoS flow(s) of the associated RLC mode(s), if the associated bi-directional sidelink DRB has been established due to the configuration by RRCReconfigurationSidelink;
5&gt; set sl-QoS-InfoList to include QoS profile(s) of the sidelink QoS flow(s) of the associated destination configured by the upper layer for the NR sidelink L3 U2N relay communication transmission;
5&gt; set sl-TxInterestedFreqList to indicate the frequency of the associated destination for NR sidelink L3 U2N relay communication transmission;
5&gt; set sl-TypeTxSyncList to the current synchronization reference type used on the associated sl- InterestedFreqList for NR sidelink L3 U2N relay communication transmission.
5&gt; set sl-CapabilityInformationSidelink to include UECapabilityInformationSidelink message, if any, received from peer UE.
4&gt; include ue-Type and set it to relayUE if the UE is acting as NR sidelink L3 U2N Relay UE and to remoteUE otherwise;
1&gt; if the UE initiates the procedure while connected to an E-UTRA PCell:
2&gt; submit the SidelinkUEInformationNR to lower layers via SRB1, embedded in E-UTRA RRC message ULInformationTransferIRAT as specified in TS 36.331 , clause 5.6.28;
2&gt; submit the SidelinkUEInformationNR message to lower layers for transmission.
5.8.4 Void
5.8.5 Sidelink synchronisation information transmission for NR sidelink communication
5.8.5.1 General SIB12 acquisition RRCReconfiguration SLSS&amp; MasterInformationBlockSidelink (partial) coverage SLSS&amp; MasterInformationBlockSidelink SLSS&amp; MasterInformationBlockSidelink coverage
The purpose of this procedure is to provide synchronisation information to a UE. This procedure also applies to sidelink
5.8.5.2 Initiation
A UE capable of NR sidelink communication and SLSS/PSBCH transmission shall, when transmitting NR sidelink communication, and if the conditions for NR sidelink communication operation are met and when the following conditions are met:
1&gt; if in coverage on the frequency used for NR sidelink communication, as defined in TS 38.304 ; and has selected GNSS or the cell as synchronization reference as defined in 5.8.6.3; or
1&gt; if out of coverage on the frequency used for NR sidelink communication, and the frequency used to transmit NR sidelink communication is included in sl-FreqInfoToAddModList in sl-ConfigDedicatedNR within RRCReconfiguration message or included in sl-FreqInfoList within SIB12; and has selected GNSS or the cell as synchronization reference as defined in 5.8.6.3:
2&gt; if in RRC_CONNECTED; and if networkControlledSyncTx is configured and set to on; or
2&gt; if networkControlledSyncTx is not configured; and for the concerned frequency syncTxThreshIC is configured; and the RSRP measurement of the reference cell, selected as defined in 5.8.6.3, for NR sidelink communication transmission is below the value of syncTxThreshIC:
3&gt; transmit sidelink SSB on the frequency used for NR sidelink communication in accordance with 5.8.5.3 and TS 38.211 , including the transmission of SLSS as specified in 5.8.5.3 and transmission of MasterInformationBlockSidelink as specified in 5.8.9.4.3;
2&gt; for the frequency used for NR sidelink communication, if syncTxThreshOoC is included in SidelinkPreconfigNR; and the UE is not directly synchronized to GNSS, and the UE has no selected SyncRef UE or the PSBCH-RSRP measurement result of the selected SyncRef UE is below the value of syncTxThreshOoC; or
2&gt; for the frequency used for NR sidelink communication, if the UE selects GNSS as the synchronization reference source:
3&gt; transmit sidelink SSB on the frequency used for NR sidelink communication in accordance with TS
38.211 , including the transmission of SLSS as specified in 5.8.5.3 and transmission of MasterInformationBlockSidelink as specified in 5.8.9.4.3;
5.8.5.3 Transmission of SLSS
The UE shall select the SLSSID and the slot in which to transmit SLSS as follows:
1&gt; if triggered by NR sidelink communication and in coverage on the frequency used for NR sidelink communication, as defined in TS 38.304 ; or
1&gt; if triggered by NR sidelink communication, and out of coverage on the frequency used for NR sidelink communication, and the concerned frequency is included in sl-FreqInfoToAddModList in sl-ConfigDedicatedNR within RRCReconfiguration message or included in sl-FreqInfoList within SIB12:
2&gt; if the UE has selected GNSS as synchronization reference in accordance with 5.8.6.2:
3&gt; select SLSSID 0;
3&gt; use sl-SSB-TimeAllocation1 included in the entry of configured sl-SyncConfigList corresponding to the concerned frequency, that includes txParameters and gnss-Sync;
3&gt; select the slot(s) indicated by sl-SSB-TimeAllocation1;
2&gt; if the UE has selected a cell as synchronization reference in accordance with 5.8.6.2:
3&gt; select the SLSSID included in the entry of configured sl-SyncConfigList corresponding to the concerned frequency, that includes txParameters and does not include gnss-Sync;
3&gt; select the slot(s) indicated by sl-SSB-TimeAllocation1;
1&gt; else if triggered by NR sidelink communication and the UE has GNSS as the synchronization reference:
2&gt; select SLSSID 0;
2&gt; if sl-SSB-TimeAllocation3 is configured for the frequency used in SidelinkPreconfigNR:
3&gt; select the slot(s) indicated by sl-SSB-TimeAllocation3;
3&gt; select the slot(s) indicated by sl-SSB-TimeAllocation1;
2&gt; select the synchronisation reference UE (i.e. SyncRef UE) as defined in 5.8.6;
2&gt; if the UE has a selected SyncRef UE and inCoverage in the MasterInformationBlockSidelink message received from this UE is set to true; or
2&gt; if the UE has a selected SyncRef UE and inCoverage in the MasterInformationBlockSidelink message received from this UE is set to false while the SLSS from this UE is part of the set defined for out of coverage, see TS 38.211 :
3&gt; select the same SLSSID as the SLSSID of the selected SyncRef UE;
3&gt; select the slot in which to transmit the SLSS according to the sl-SSB-TimeAllocation1 or sl-SSB- TimeAllocation2 included in the preconfigured sidelink parameters corresponding to the concerned frequency, such that the timing is different from the SLSS of the selected SyncRef UE;
2&gt; else if the UE has a selected SyncRef UE and the SLSS from this UE was transmitted on the slot(s) indicated sl-SSB-TimeAllocation3, which is configured for the frequency used in SidelinkPreconfigNR:
3&gt; select SLSSID 337;
3&gt; select the slot(s) indicated by sl-SSB-TimeAllocation2;
2&gt; else if the UE has a selected SyncRef UE:
3&gt; select the SLSSID from the set defined for out of coverage having an index that is 336 more than the index of the SLSSID of the selected SyncRef UE, see TS 38.211 ;
3&gt; select the slot in which to transmit the SLSS according to sl-SSB-TimeAllocation1 or sl-SSB- TimeAllocation2 included in the preconfigured sidelink parameters corresponding to the concerned frequency, such that the timing is different from the SLSS of the selected SyncRef UE;
2&gt; else (i.e. no SyncRef UE selected):
3&gt; if the UE has not randomly selected an SLSSID:
4&gt; randomly select, using a uniform distribution, an SLSSID from the set of sequences defined for out of coverage except SLSSID 336 and 337, see TS 38.211 ;
4&gt; select the slot in which to transmit the SLSS according to the sl-SSB-TimeAllocation1 or sl-SSB- TimeAllocation2 (arbitrary selection between these) included in the preconfigured sidelink parameters in SidelinkPreconfigNR corresponding to the concerned frequency;
5.8.5a Sidelink synchronisation information transmission for V2X sidelink communication
5.8.5a.1 General SIB13/SIB14 acquisition RRCReconfiguration SLSS&amp; MasterInformationBlockSidelink (partial) coverage SLSS&amp; MasterInformationBlockSidelink SLSS&amp; MasterInformationBlockSidelink coverage
The purpose of this procedure is to provide synchronisation information to a UE.
5.8.5a.2 Initiation
A UE capable of V2X sidelink communication initiates the transmission of SLSS and MasterInformationBlock-SL-V2X according to the conditions and the procedures specified for V2X sidelink communication in clause 5.10.7 of TS 36.331
NOTE 1: When applying the procedure in this clause, SIB13 and SIB14 correspond to SystemInformationBlockType21 and SystemInformationBlockType26 specified in TS 36.331 respectively
5.8.6 Sidelink synchronisation reference
5.8.6.1 General
The purpose of this procedure is to select a synchronisation reference and used when transmitting NR sidelink
communication. This procedure also applies to sidelink discovery.
5.8.6.2 Selection and reselection of synchronisation reference
The UE shall:
1&gt; if the frequency used for NR sidelink communication is included in sl-FreqInfoToAddModList in sl- ConfigDedicatedNR within RRCReconfiguration message or included in sl-ConfigCommonNR within SIB12, and sl-SyncPriority is configured for the concerned frequency and set to gnbEnb:
2&gt; select a cell as the synchronization reference source as defined in 5.8.6.3:
1&gt; else if the frequency used for NR sidelink communication is included in sl-FreqInfoToAddModList in sl- ConfigDedicatedNR within RRCReconfiguration message or included in sl-ConfigCommonNR within SIB12, and sl-SyncPriority for the concerned frequency is not configured or is set to gnss, and GNSS is reliable in accordance with TS 38.101-1 and TS 38.133 :
2&gt; select GNSS as the synchronization reference source;
1&gt; else if the frequency used for NR sidelink communication is included in SL-PreconfigurationNR, and sl- SyncPriority in SidelinkPreconfigNR is set to gnss and GNSS is reliable in accordance with TS 38.101-1 and TS 38.133 :
2&gt; select GNSS as the synchronization reference source;
2&gt; perform a full search (i.e. covering all subframes and all possible SLSSIDs) to detect candidate SLSS, in accordance with TS 38.133
2&gt; when evaluating the one or more detected SLSSIDs, apply layer 3 filtering as specified in 5.5.3.2 using the preconfigured sl-filterCoefficient, before using the PSBCH-RSRP measurement results;
2&gt; if the UE has selected a SyncRef UE:
3&gt; if the PSBCH-RSRP of the strongest candidate SyncRef UE exceeds the minimum requirement TS
38.133 by sl-SyncRefMinHyst and the strongest candidate SyncRef UE belongs to the same priority group as the current SyncRef UE and the PSBCH-RSRP of the strongest candidate SyncRef UE exceeds the PSBCH-RSRP of the current SyncRef UE by syncRefDiffHyst; or
3&gt; if the PSBCH-RSRP of the candidate SyncRef UE exceeds the minimum requirement TS 38.133 by sl-SyncRefMinHyst and the candidate SyncRef UE belongs to a higher priority group than the current SyncRef UE; or
3&gt; if GNSS becomes reliable in accordance with TS 38.101-1 and TS 38.133 , and GNSS belongs to a higher priority group than the current SyncRef UE; or
3&gt; if a cell is detected and gNB/eNB (if sl-NbAsSync is set to true) belongs to a higher priority group than the current SyncRef UE; or
3&gt; if the PSBCH-RSRP of the current SyncRef UE is less than the minimum requirement defined in TS
4&gt; consider no SyncRef UE to be selected;
2&gt; if the UE has selected GNSS as the synchronization reference for NR sidelink communication:
3&gt; if the PSBCH-RSRP of the candidate SyncRef UE exceeds the minimum requirement defined in TS
38.133 by sl-SyncRefMinHyst and the candidate SyncRef UE belongs to a higher priority group than GNSS; or
3&gt; if GNSS becomes not reliable in accordance with TS 38.101-1 and TS 38.133 :
4&gt; consider GNSS not to be selected;
2&gt; if the UE has selected cell as the synchronization reference for NR sidelink communication:
3&gt; if the PSBCH-RSRP of the candidate SyncRef UE exceeds the minimum requirement defined in TS
38.133 by sl-SyncRefMinHyst and the candidate SyncRef UE belongs to a higher priority group than gNB/eNB; or
3&gt; if the selected cell is not detected:
4&gt; consider the cell not to be selected;
2&gt; if the UE has not selected any synchronization reference:
3&gt; if the UE detects one or more SLSSIDs for which the PSBCH-RSRP exceeds the minimum requirement defined in TS 38.133 by sl-SyncRefMinHyst and for which the UE received the corresponding MasterInformationBlockSidelink message (candidate SyncRef UEs), or if the UE detects GNSS that is reliable in accordance with TS 38.101-1 and TS 38.133 , or if the UE detects a cell, select a synchronization reference according to the following priority group order:
4&gt; if sl-SyncPriority corresponding to the concerned frequency is set to gnbEnb:
5&gt; UEs of which SLSSID is part of the set defined for in coverage, and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to true, starting with the UE with the highest PSBCH-RSRP result (priority group 1);
5&gt; UE of which SLSSID is part of the set defined for in coverage, and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to false, starting with the UE with the highest PSBCH-RSRP result (priority group 2);
5&gt; GNSS that is reliable in accordance with TS 38.101-1 and TS 38.133 (priority group 3);
5&gt; UEs of which SLSSID is 0, and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to true, or of which SLSSID is 0 and SLSS is transmitted on slot(s) indicated by sl-SSB-TimeAllocation3, starting with the UE with the highest PSBCH-RSRP result (priority group 4);
5&gt; UEs of which SLSSID is 0 and SLSS is not transmitted on slot(s) indicated by sl-SSB- TimeAllocation3, and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to false, starting with the UE with the highest PSBCH-RSRP result (priority group 5);
5&gt; UEs of which SLSSID is 337 and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to false, starting with the UE with the highest PSBCH-RSRP result (priority group 5);
5&gt; Other UEs, starting with the UE with the highest PSBCH-RSRP result (priority group 6);
4&gt; if sl-SyncPriority corresponding to the concerned frequency is set to gnss, and sl-NbAsSync is set to true:
5&gt; UEs of which SLSSID is 0, and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to true, or of which SLSSID is 0 and SLSS is transmitted on slot(s) indicated by sl-SSB-TimeAllocation3, starting with the UE with the highest PSBCH-RSRP result (priority group 1);
5&gt; UEs of which SLSSID is 0 and SLSS is not transmitted on slot(s) indicated by sl-SSB- TimeAllocation3, and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to false, starting with the UE with the highest PSBCHS-RSRP result (priority group 2);
5&gt; UEs of which SLSSID is 337 and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to false, starting with the UE with the highest PSBCH-RSRP result (priority group 2);
5&gt; the cell detected by the UE as defined in 5.8.6.3 (priority group 3);
5&gt; UEs of which SLSSID is part of the set defined for in coverage, and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to true, starting with the UE with the highest PSBCH-RSRP result (priority group 4);
5&gt; UE of which SLSSID is part of the set defined for in coverage, and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to false, starting with the UE with the highest PSBCH-RSRP result (priority group 5);
5&gt; Other UEs, starting with the UE with the highest S-RSRP result (priority group 6);
4&gt; if sl-SyncPriority corresponding to the concerned frequency is set to gnss, and sl-NbAsSync is set to false:
5&gt; UEs of which SLSSID is 0, and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to true, or of which SLSSID is 0 and SLSS is transmitted on slot(s) indicated by sl-SSB-TimeAllocation3, starting with the UE with the highest PSBCH-RSRP result (priority group 1);
5&gt; UEs of which SLSSID is 0 and SLSS is not transmitted on slot(s) indicated by sl-SSB- TimeAllocation3, and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to false, starting with the UE with the highest PSBCHS-RSRP result (priority group 2);
5&gt; UEs of which SLSSID is 337 and inCoverage, included in the MasterInformationBlockSidelink message received from this UE, is set to false, starting with the UE with the highest PSBCH-RSRP result (priority group 2);
5&gt; Other UEs, starting with the UE with the highest PSBCH-RSRP result (priority group 3); NOTE: How the UE achieves subframe boundary alignment between V2X sidelink communication and NR sidelink communication (if both are performed by the UE) is as specified in TS 38.213, clause 16.7.
5.8.6.3 Sidelink communication transmission reference cell selection
A UE capable of NR sidelink communication that is configured by upper layers to transmit NR sidelink communication shall:
1&gt; for the frequency used to transmit NR sidelink communication, select a cell to be used as reference for synchronization in accordance with the following:
2&gt; if the frequency concerns the primary frequency:
3&gt; use the PCell or the serving cell as reference;
2&gt; else if the frequency concerns a secondary frequency:
3&gt; use the concerned SCell as reference;
2&gt; else if the UE is in coverage of the concerned frequency:
3&gt; use the DL frequency paired with the one used to transmit NR sidelink communication as reference;
2&gt; else (i.e., out of coverage on the concerned frequency):
3&gt; use the PCell or the serving cell as reference, if needed;
5.8.7 Sidelink communication reception
A UE capable of NR sidelink communication that is configured by upper layers to receive NR sidelink communication shall:
1&gt; if the conditions for NR sidelink communication operation as defined in 5.8.2 are met:
2&gt; if the frequency used for NR sidelink communication is included in sl-FreqInfoToAddModList in RRCReconfiguration message or sl-FreqInfoList included in SIB12:
3&gt; if the UE is configured with sl-RxPool included in RRCReconfiguration message with reconfigurationWithSync (i.e. handover):
4&gt; configure lower layers to monitor sidelink control information and the corresponding data using the pool of resources indicated by sl-RxPool;
3&gt; else if the cell chosen for NR sidelink communication provides SIB12:
4&gt; configure lower layers to monitor sidelink control information and the corresponding data using the pool of resources indicated by sl-RxPool in SIB12;
3&gt; configure lower layers to monitor sidelink control information and the corresponding data using the pool of resources that were preconfigured by sl-RxPool in SL-PreconfigurationNR, as defined in clause 9.3;
5.8.8 Sidelink communication transmission
A UE capable of NR sidelink communication that is configured by upper layers to transmit NR sidelink communication and has related data to be transmitted shall:
1&gt; if the conditions for NR sidelink communication operation as defined in 5.8.2 are met:
2&gt; if the frequency used for NR sidelink communication is included in sl-FreqInfoToAddModList in sl- ConfigDedicatedNR within RRCReconfiguration message or included in sl-ConfigCommonNR within SIB12:
3&gt; if the UE is in RRC_CONNECTED and uses the frequency included in sl-ConfigDedicatedNR within RRCReconfiguration message:
4&gt; if the UE is configured with sl-ScheduledConfig:
5&gt; if T310 for MCG or T311 is running; and if sl-TxPoolExceptional is included in sl-FreqInfoList for the concerned frequency in SIB12 or included in sl-ConfigDedicatedNR in RRCReconfiguration; or
5&gt; if T301 is running and the cell on which the UE initiated RRC connection re-establishment provides SIB12 including sl-TxPoolExceptional for the concerned frequency; or
5&gt; if T304 for MCG is running and the UE is configured with sl-TxPoolExceptional included in sl- ConfigDedicatedNR for the concerned frequency in RRCReconfiguration:
6&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on random selection using the pool of resources indicated by sl-TxPoolExceptional as defined in TS
6&gt; configure lower layers to perform the sidelink resource allocation mode 1 for NR sidelink communication;
5&gt; if T311 is running, configure the lower layers to release the resources indicated by rrc- ConfiguredSidelinkGrant (if any);
4&gt; if the UE is configured with sl-UE-SelectedConfig:
5&gt; if a result of sensing on the resources configured in sl-TxPoolSelectedNormal for the concerned frequency included in sl-ConfigDedicatedNR within RRCReconfiguration is not available in accordance with TS 38.214 ;
6&gt; if sl-TxPoolExceptional for the concerned frequency is included in RRCReconfiguration; or
6&gt; if the PCell provides SIB12 including sl-TxPoolExceptional in sl-FreqInfoList for the concerned frequency:
7&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on random selection using the pool of resources indicated by sl-TxPoolExceptional as defined in TS
5&gt; else, if the sl-TxPoolSelectedNormal and/or sl-TxPoolSelectedNormalPS for the concerned frequency is included in the sl-ConfigDedicatedNR within RRCReconfiguration:
6&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on sensing (as defined in TS 38.321 and TS 38.214 ) using the pools of resources indicated by sl- TxPoolSelectedNormal for the concerned frequency; or
6&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on resource selection operation according to sl-AllowedResourceSelectionConfig (as defined in TS 38.321 for the concerned frequency;
4&gt; if the cell chosen for NR sidelink communication transmission provides SIB12:
5&gt; if SIB12 includes sl-TxPoolSelectedNormal and/or sl-TxPoolSelectedNormalPS for the concerned frequency, and a result of sensing on the resources configured in the sl-TxPoolSelectedNormal is available in accordance with TS 38.214 :
6&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on sensing using the pools of resources indicated by sl-TxPoolSelectedNormal for the concerned frequency as defined in TS 38.321 ; or
6&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on resource selection operation according to sl-AllowedResourceSelectionConfig using the pools of resources indicated by sl-TxPoolSe lectedNormalPS for the concerned frequency as defined in TS 38.321 ;
5&gt; else if SIB12 includes sl-TxPoolExceptional for the concerned frequency:
6&gt; from the moment the UE initiates RRC connection establishment or RRC connection resume, until receiving an RRCReconfiguration including sl-ConfigDedicatedNR, or receiving an RRCRelease or an RRCReject; or
6&gt; if a result of sensing on the resources configured in sl-TxPoolSelectedNormal for the concerned frequency in SIB12 is not available in accordance with TS 38.214 :
7&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on random selection (as defined in TS 38.321 ) using one of the pools of resources indicated by sl- TxPoolExceptional for the concerned frequency;
3&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on sensing (as defined in TS 38.321 and TS 38.213 ) using the pools of resources indicated by sl-TxPoolSelectedNormal in SidelinkPreconfigNR for the concerned frequency.
NOTE 1: The UE continues to use resources configured in rrc-ConfiguredSidelinkGrant (while T310 is running) until it is released (i.e. until T310 has expired). The UE does not use sidelink configured grant type 2 resources while T310 is running.
NOTE 2: In case of RRC reconfiguration with sync, the UE uses resources configured in rrc- ConfiguredSidelinkGrant (while T304 on the MCG is running) if provided by the target cell.
NOTE 3: It is up to UE implementation to determines which one resource allocation scheme is used in the AS based on UE capability (for a UE in RRC_IDLE/RRC_INACTIVE) and the allowed resource schemes sl- allowedResourceSelectionConfig in the resource pool configuration.
If configured to perform sidelink resource allocation mode 2, the UE capable of NR sidelink communication that is configured by upper layers to transmit NR sidelink communication shall perform sensing or resource selection operation according to sl-AllowedResourceSelectionConfig on all pools of resources which may be used for transmission of the sidelink control information and the corresponding data. The pools of resources are indicated by SidelinkPreconfigNR, sl-TxPoolSelectedNormal/sl-TxPoolSelectedNormalPS in sl-ConfigDedicatedNR, or sl- TxPoolSelectedNormal/sl-TxPoolSelectedNormalPS in SIB12 for the concerned frequency, as configured above.
5.8.9 Sidelink RRC procedure
5.8.9.1 Sidelink RRC reconfiguration
5.8.9.1.1 General RRCReconfigurationSidelink RRCReconfigurationCompleteSidelink RRCReconfigurationSidelink RRCReconfigurationFailureSidelink
The purpose of this procedure is to modify a PC5-RRC connection, e.g. to establish/modify/release sidelink DRBs, to (re-)configure NR sidelink measurement and reporting, to (re-)configure sidelink CSI reference signal resources and CSI reporting latency bound.
The UE may initiate the sidelink RRC reconfiguration procedure and perform the operation in clause 5.8.9.1.2 on the corresponding PC5-RRC connection in following cases: a) the release of sidelink DRBs associated with the peer UE, as specified in clause 5.8.9.1a.1; b) the establishment of sidelink DRBs associated with the peer UE, as specified in clause 5.8.9.1a.2; c) the modification for the parameters included in SLRB-Config of sidelink DRBs associated with the peer UE, as specified in clause 5.8.9.1a.2; d) the release of PC5 Relay RLC channels for L2 U2N Relay UE and Remote UE, as specified in clause 5.8.9.7.1; e) the establishment of PC5 Relay RLC channels for L2 U2N Relay UE and Remote UE, as specified in clause
5.8.9.7.2; a) the modification for the parameters included in SL-RLC-ChannelConfig-PC5 of PC5 Relay RLC channels for L2 U2N Relay UE and Remote UE, as specified in clause 5.8.9.7.2; b) the (re-)configuration of the peer UE to perform NR sidelink measurement and report. c) the (re-)configuration of the sidelink CSI reference signal resources and CSI reporting latency bound; d) the (re-)configuration of the peer UE to perform sidelink DRX.
In RRC_CONNECTED, the UE applies the NR sidelink communications parameters provided in RRCReconfiguration (if any). In RRC_IDLE or RRC_INACTIVE, the UE applies the NR sidelink communications parameters provided in system information (if any). For other cases, UEs apply the NR sidelink communications parameters provided in SidelinkPreconfigNR (if any). When UE performs state transition between above three cases, the UE applies the NR sidelink communications parameters provided in the new state, after acquisition of the new configurations. Before acquisition of the new configurations, UE continues applying the NR sidelink communications parameters provided in the old state.
5.8.9.1.2 Actions related to transmission of RRCReconfigurationSidelink message
The UE shall set the contents of RRCReconfigurationSidelink message as follows:
1&gt; for each sidelink DRB that is to be released, according to clause 5.8.9.1a.1.1, due to configuration by sl- ConfigDedicatedNR, SIB12, SidelinkPreconfigNR or by upper layers:
2&gt; set the SLRB-PC5-ConfigIndex included in the slrb-ConfigToReleaseList corresponding to the sidelink DRB;
1&gt; for each sidelink DRB that is to be established or modified, according to clause 5.8.9.1a.2.1, due to receiving sl- ConfigDedicatedNR, SIB12 or SidelinkPreconfigNR:
2&gt; set the SLRB-Config included in the slrb-ConfigToAddModList, according to the received sl- RadioBearerConfig and sl-RLC-BearerConfig corresponding to the sidelink DRB;
1&gt; set the sl-MeasConfig as follows:
2&gt; If the frequency used for NR sidelink communication is included in sl-FreqInfoToAddModList in sl- ConfigDedicatedNR within RRCReconfiguration message or included in sl-ConfigCommonNR within SIB12:
3&gt; if UE is in RRC_CONNECTED:
4&gt; set the sl-MeasConfig according to stored NR sidelink measurement configuration information for this destination;
3&gt; if UE is in RRC_IDLE or RRC_INACTIVE:
4&gt; set the sl-MeasConfig according to stored NR sidelink measurement configuration received from SIB12;
3&gt; set the sl-MeasConfig according to the sl-MeasPreconfig in SidelinkPreconfigNR;
1&gt; start timer T400 for the destination associated with the sidelink DRB;
1&gt; set the sl-CSI-RS-Config;
1&gt; set the sl-LatencyBoundCSI-Report, NOTE 1: How to set the parameters included in sl-CSI-RS-Config and sl-LatencyBoundCSI-Report is up to UE
1&gt; set the sl-DRX-ConfigUC-PC5 as follows:
2&gt; If the frequency used for NR sidelink communication is included in sl-FreqInfoToAddModList in sl- ConfigDedicatedNR within RRCReconfiguration message or included in sl-ConfigCommonNR within SIB12:
3&gt; if UE is in RRC_CONNECTED and is performing sidelink operation with resource allocation mode 1:
4&gt; set the sl-DRX-ConfigUC-PC5 according to stored NR sidelink DRX configuration information for this destination.
3&gt; else if UE is in RRC_CONNECTED and is performing sidelink operation with resource allocation mode
4&gt; UE determines the sidelink DRX configuration for unicast for the associated peer UE; NOTE 2: If UE is in RRC_IDLE or in RRC_INACTIVE or out of coverage, it is up to UE implementation to set the sl-DRX-ConfigUC-PC5.
1&gt; for each PC5 Relay RLC channel that is to be released due to configuration by sl-ConfigDedicatedNR:
2&gt; set the SL-RLC-ChannelConfig-PC5 included in the sl-RLC-ChannelToReleaseList-PC5 corresponding to the PC5 Relay RLC channel;
1&gt; for each PC5 Relay RLC channel that is to be established or modified due to receiving sl-ConfigDedicatedNR:
2&gt; set the SL-RLC-ChannelConfig-PC5 included in the sl-RLC-ChannelToAddModList-PC5, according to the received sl-RLC-ChannelConfig corresponding to the PC5 Relay RLC channel; The UE shall submit the RRCReconfigurationSidelink message to lower layers for transmission.
5.8.9.1.3 Reception of an RRCReconfigurationSidelink by the UE
The UE shall perform the following actions upon reception of the RRCReconfigurationSidelink:
1&gt; if the RRCReconfigurationSidelink includes the sl-ResetConfig:
2&gt; perform the sidelink reset configuration procedure as specified in 5.8.9.1.10;
1&gt; if the RRCReconfigurationSidelink includes the slrb-ConfigToReleaseList:
2&gt; for each SLRB-PC5-ConfigIndex value included in the slrb-ConfigToReleaseList that is part of the current UE sidelink configuration;
3&gt; perform the sidelink DRB release procedure, according to clause 5.8.9.1a.1;
1&gt; if the RRCReconfigurationSidelink includes the slrb-ConfigToAddModList:
2&gt; for each slrb-PC5-ConfigIndex value included in the slrb-ConfigToAddModList that is not part of the current UE sidelink configuration:
4&gt; apply the SL-PQFI included in sl-MappedQoS-FlowsToAddList;
3&gt; perform the sidelink DRB addition procedure, according to clause 5.8.9.1a.2;
2&gt; for each slrb-PC5-ConfigIndex value included in the slrb-ConfigToAddModList that is part of the current UE sidelink configuration:
4&gt; add the SL-PQFI included in sl-MappedQoS-FlowsToAddList to the corresponding sidelink DRB;
4&gt; remove the SL-PQFI included in sl-MappedQoS-FlowsToReleaseList from the corresponding sidelink DRB;
3&gt; if the sidelink DRB release conditions as described in clause 5.8.9.1a.1.1 are met:
4&gt; perform the sidelink DRB release procedure according to clause 5.8.9.1a.1.2;
3&gt; else if the sidelink DRB modification conditions as described in clause 5.8.9.1a.2.1 are met:
4&gt; perform the sidelink DRB modification procedure according to clause 5.8.9.1a.2.2;
1&gt; if the RRCReconfigurationSidelink message includes the sl-MeasConfig:
2&gt; perform the sidelink measurement configuration procedure as specified in 5.8.10;
1&gt; if the RRCReconfigurationSidelink message includes the sl-CSI-RS-Config:
2&gt; apply the sidelink CSI-RS configuration;
1&gt; if the RRCReconfigurationSidelink message includes the sl-LatencyBoundCSI-Report:
2&gt; apply the configured sidelink CSI report latency bound;
1&gt; if the UE is unable to comply with (part of) the configuration included in the RRCReconfigurationSidelink (i.e.
sidelink RRC reconfiguration failure):
2&gt; continue using the configuration used prior to the reception of the RRCReconfigurationSidelink message;
2&gt; set the content of the RRCReconfigurationFailureSidelink message;
3&gt; submit the RRCReconfigurationFailureSidelink message to lower layers for transmission;
2&gt; set the content of the RRCReconfigurationCompleteSidelink message;
3&gt; submit the RRCReconfigurationCompleteSidelink message to lower layers for transmission; NOTE 1: When the same logical channel is configured with different RLC mode by another UE, the UE handles the case as sidelink RRC reconfiguration failure.
1&gt; if the RRCReconfigurationSidelink includes the sl-RLC-ChannelToReleaseList-PC5:
2&gt; for each SL-RLC-ChannelID value included in the sl-RLC-ChannelToReleaseList-PC5 that is part of the current UE sidelink configuration;
3&gt; perform the PC5 Relay RLC channel release procedure, according to clause 5.8.9.7.1;
1&gt; if the RRCReconfigurationSidelink includes the sl-RLC-ChannelToAddModList-PC5:
2&gt; for each sl-RLC-ChannelID-PC5 value included in the sl-RLC-ChannelToAddModList-PC5 that is not part of the current UE sidelink configuration:
3&gt; perform the sidelink RLC channle addition procedure, according to clause 5.8.9.7.2;
2&gt; for each sl-RLC-ChannelID-PC5 value included in the sl-RLC-ChannelToAddModList-PC5 that is part of the current UE sidelink configuration:
3&gt; perform the PC5 Relay RLC channel modification procedure according to clause 5.8.9.7.2;
5.8.9.1.4 Void
5.8.9.1.5 Void
5.8.9.1.6 Void
5.8.9.1.7 Void
5.8.9.1.8 Reception of an RRCReconfigurationFailureSidelink by the UE
The UE shall perform the following actions upon reception of the RRCReconfigurationFailureSidelink:
1&gt; stop timer T400 for the destination, if running;
1&gt; continue using the configuration used prior to corresponding RRCReconfigurationSidelink message;
1&gt; if UE is in RRC_CONNECTED:
2&gt; perform the sidelink UE information for NR sidelink communication procedure, as specified in 5.8.3.3 or clause 5.10.15 in TS 36.331 ;
5.8.9.1.9 Reception of an RRCReconfigurationCompleteSidelink by the UE
The UE shall perform the following actions upon reception of the RRCReconfigurationCompleteSidelink:
1&gt; stop timer T400 for the destination, if running;
1&gt; consider the configurations in the corresponding RRCReconfigurationSidelink message to be applied.
Editor's Note: to be captured on behaviour after rejection, based on which message used. Related agreement "Keep RX UE's reject option for SL DRX configuration sent by TX UE. If reject happens for initial SL DRX configuration, default SL DRX configuration is no UC SL DRX. FFS on the default SL DRX configuration for non-initial SL DRX configuration. No enhancement to resolve any deadlock issue in
5.8.9.1.10 Sidelink reset configuration
The UE shall:
1&gt; release/clear current sidelink radio configuration of this destination received in the RRCReconfigurationSidelink;
1&gt; release the sidelink DRBs of this destination, in according to clause 5.8.9.1a.1;
1&gt; reset the sidelink specific MAC of this destination.
NOTE 1: Sidelink radio configuration is not just the resource configuration but may include other configurations included in the RRCReconfigurationSidelink message except the sidelink DRBs of this destination.
NOTE 2: After the sidelink DRB release procedure, UE may perform the sidelink DRB addition according to the current sidelink configuration of this destination, received in sl-ConfigDedicatedNR, SIB12 and SidelinkPreconfigNR, according to clause 5.8.9.1a.2.
5.8.9.1a Sidelink radio bearer management
5.8.9.1a.1 Sidelink DRB release
5.8.9.1a.1.1 Sidelink DRB release conditions
For NR sidelink communication, a sidelink DRB release is initiated in the following cases:
1&gt; for groupcast, broadcast and unicast, if slrb-Uu-ConfigIndex (if any) of the sidelink DRB is included in sl- RadioBearerToReleaseList in sl-ConfigDedicatedNR; or
1&gt; for groupcast and broadcast, if no sidelink QoS flow with data indicated by upper layers is mapped to the sidelink DRB for transmission, which is (re)configured by receiving SIB12 or SidelinkPreconfigNR; or
1&gt; for groupcast, broadcast and unicast, if SL-RLC-BearerConfigIndex (if any) of the sidelink DRB is included in sl-RLC-BearerToReleaseList in sl-ConfigDedicatedNR; or
1&gt; for unicast, if no sidelink QoS flow with data indicated by upper layers is mapped to the sidelink DRB for transmission, which is (re)configured by receiving SIB12 or SidelinkPreconfigNR, and if no sidelink QoS flow mapped to the sidelink DRB, which is (re)configured by receiving RRCReconfigurationSidelink, has data; or
1&gt; for unicast, if SLRB-PC5-ConfigIndex (if any) of the sidelink DRB is included in slrb-ConfigToReleaseList in RRCReconfigurationSidelink or if sl-ResetConfig is included in RRCReconfigurationSidelink; or
1&gt; for unicast, when the corresponding PC5-RRC connection is released due to sidelink RLF being detected, according to clause 5.8.9.3; or
1&gt; for unicast, when the corresponding PC5-RRC connection is released due to upper layer request according to clause 5.8.9.5.
5.8.9.1a.1.2 Sidelink DRB release operations
For each sidelink DRB, whose sidelink DRB release conditions are met as in clause 5.8.9.1a.1.1, the UE capable of NR sidelink communication that is configured by upper layers to perform NR sidelink communication shall:
1&gt; for groupcast and broadcast; or
1&gt; for unicast, if the sidelink DRB release was triggered after the reception of the RRCReconfigurationSidelink message; or
1&gt; for unicast, after receiving the RRCReconfigurationCompleteSidelink message, if the sidelink DRB release was triggered due to the configuration received within the sl-ConfigDedicatedNR, SIB12, SidelinkPreconfigNR or indicated by upper layers:
2&gt; release the PDCP entity for NR sidelink communication associated with the sidelink DRB;
2&gt; if SDAP entity for NR sidelink communication associated with this sidelink DRB is configured:
3&gt; indicate the release of the sidelink DRB to the SDAP entity associated with this sidelink DRB (TS 37.324
2&gt; release SDAP entities for NR sidelink communication, if any, that have no associated sidelink DRB as specified in TS 37.324 clause 5.1.2;
1&gt; for groupcast and broadcast; or
1&gt; for unicast, after receiving the RRCReconfigurationCompleteSidelink message, if the sidelink DRB release was triggered due to the configuration received within the sl-ConfigDedicatedNR:
2&gt; for each sl-RLC-BearerConfigIndex included in the received sl-RLC-BearerToReleaseList that is part of the current UE sidelink configuration:
3&gt; release the RLC entity and the corresponding logical channel for NR sidelink communication, associated with the sl-RLC-BearerConfigIndex.
1&gt; for unicast, if the sidelink DRB release was triggered due to the reception of the RRCReconfigurationSidelink message; or
1&gt; for unicast, after receiving the RRCReconfigurationCompleteSidelink message, if the sidelink DRB release was triggered due to the configuration received within the SIB12, SidelinkPreconfigNR or indicated by upper layers:
2&gt; release the RLC entity and the corresponding logical channel for NR sidelink communication associated with the sidelink DRB;
2&gt; perform the sidelink UE information procedure in clause 5.8.3 for unicast if needed.
1&gt; if the sidelink radio link failure is detected for a specific destination:
2&gt; release the PDCP entity, RLC entity and the logical channel of the sidelink DRB for the specific destination.
5.8.9.1a.2 Sidelink DRB addition/modification
5.8.9.1a.2.1 Sidelink DRB addition/modification conditions
For NR sidelink communication, a sidelink DRB addition is initiated only in the following cases:
1&gt; if any sidelink QoS flow is (re)configured by sl-ConfigDedicatedNR, SIB12, SidelinkPreconfigNR and is to be mapped to one sidelink DRB, which is not established; or
1&gt; if any sidelink QoS flow is (re)configured by RRCReconfigurationSidelink and is to be mapped to a sidelink DRB, which is not established; For NR sidelink communication, a sidelink DRB modification is initiated only in the following cases:
1&gt; if any of the sidelink DRB related parameters is changed by sl-ConfigDedicatedNR, SIB12, SidelinkPreconfigNR or RRCReconfigurationSidelink for one sidelink DRB, which is established; 5.8.9.1a.2.2 Sidelink DRB addition/modification operations
For the sidelink DRB, whose sidelink DRB addition conditions are met as in clause 5.8.9.1a.2.1, the UE capable of NR sidelink communication that is configured by upper layers to perform NR sidelink communication shall:
1&gt; for groupcast and broadcast; or
1&gt; for unicast, if the sidelink DRB addition was trigggered due to the reception of the RRCReconfigurationSidelink message; or
1&gt; for unicast, after receiving the RRCReconfigurationCompleteSidelink message, if the sidelink DRB addition was triggered due to the configuration received within the sl-ConfigDedicatedNR, SIB12, SidelinkPreconfigNR or indicated by upper layers:
2&gt; if an SDAP entity for NR sidelink communication associated with the destination and the cast type of the sidelink DRB does not exist:
3&gt; establish an SDAP entity for NR sidelink communication as specified in TS 37.324 clause 5.1.1;
2&gt; (re)configure the SDAP entity in accordance with the sl-SDAP-ConfigPC5 received in the RRCReconfigurationSidelink or sl-SDAP-Config received in sl-ConfigDedicatedNR, SIB12, SidelinkPreconfigNR, associated with the sidelink DRB;
2&gt; establish a PDCP entity for NR sidelink communication and configure it in accordance with the sl-PDCP- ConfigPC5 received in the RRCReconfigurationSidelink or sl-PDCP-Config received in sl- ConfigDedicatedNR, SIB12, SidelinkPreconfigNR, associated with the sidelink DRB;
2&gt; establish a RLC entity for NR sidelink communication and configure it in accordance with the sl-RLC- ConfigPC5 received in the RRCReconfigurationSidelink or sl-RLC-Config received in sl- ConfigDedicatedNR, SIB12, SidelinkPreconfigNR, associated with sidelink DRB;
2&gt; if this procedure was due to the reception of a RRCReconfigurationSidelink message:
3&gt; configure the MAC entity with a logical channel in accordance with the sl-MAC- LogicalChannelConfigPC5 received in the RRCReconfigurationSidelink associated with the sidelink DRB, and perform the sidelink UE information procedure in clause 5.8.3 for unicast if need;
3&gt; configure the MAC entity with a logical channel associated with the sidelink DRB, by assigning a new logical channel identity, in accordance with the sl-MAC-LogicalChannelConfig received in the sl- ConfigDedicatedNR, SIB12, SidelinkPreconfigNR.
NOTE 1: When a sidelink DRB addition is due to the configuration by RRCReconfigurationSidelink, it is up to UE implementation to select the sidelink DRB configuration as necessary transmitting parameters for the sidelink DRB, from the received sl-ConfigDedicatedNR (if in RRC_CONNECTED), SIB12 (if in RRC_IDLE/INACTIVE), SidelinkPreconfigNR (if out of coverage) with the same RLC mode as the one configured in RRCReconfigurationSidelink.
For the sidelink DRB, whose sidelink DRB modification conditions are met as in clause 5.8.9.1a.2.1, the UE capable of NR sidelink communication that is configured by upper layers to perform NR sidelink communication shall:
1&gt; for groupcast and broadcast; or
1&gt; for unicast, if the sidelink DRB modification was triggered due to the reception of the RRCReconfigurationSidelink message; or
1&gt; for unicast, after receiving the RRCReconfigurationCompleteSidelink message, if the sidelink DRB modification was triggered due to the configuration received within the sl-ConfigDedicatedNR, SIB12 or SidelinkPreconfigNR:
2&gt; reconfigure the SDAP entity of the sidelink DRB, in accordance with the sl-SDAP-ConfigPC5 received in the RRCReconfigurationSidelink or sl-SDAP-Config received in sl-ConfigDedicatedNR, SIB12, SidelinkPreconfigNR, if included;
2&gt; reconfigure the PDCP entity of the sidelink DRB, in accordance with the sl-PDCP-ConfigPC5 received in the RRCReconfigurationSidelink or sl-PDCP-Config received in sl-ConfigDedicatedNR, SIB12, SidelinkPreconfigNR, if included;
2&gt; reconfigure the RLC entity of the sidelink DRB, in accordance with the sl-RLC-ConfigPC5 received in the RRCReconfigurationSidelink or sl-RLC-Config received in sl-ConfigDedicatedNR, SIB12, SidelinkPreconfigNR, if included;
2&gt; reconfigure the logical channel of the sidelink DRB, in accordance with the sl-MAC- LogicalChannelConfigPC5 received in the RRCReconfigurationSidelink or sl-MAC-LogicalChannelConfig received in sl-ConfigDedicatedNR, SIB12, SidelinkPreconfigNR, if included.
5.8.9.1a.3 Sidelink SRB release
The UE shall:
1&gt; if a PC5-RRC connection release for a specific destination is requested by upper layers or AS layer; or
1&gt; if the sidelink radio link failure is detected for a specific destination:
2&gt; release the PDCP entity, RLC entity and the logical channel of the sidelink SRB for PC5-RRC message of the specific destination;
2&gt; consider the PC5-RRC connection is released for the destination.
1&gt; if PC5-S transmission for a specific destination is terminated in upper layers:
2&gt; release the PDCP entity, RLC entity and the logical channel of the sidelink SRB(s) for PC5-S message of the specific destination;
1&gt; if discovery transmission for a specific destination is terminated in upper layers:
2&gt; release the PDCP entity, RLC entity and the logical channel of the sidelink SRB4 for discovery message of the specific destination; 5.8.9.1a.4 Sidelink SRB addition
The UE shall:
1&gt; if transmission of PC5-S message for a specific destination is requested by upper layers for sidelink SRB:
2&gt; establish PDCP entity, RLC entity and the logical channel of a sidelink SRB for PC5-S message, as specified in clause 9.1.1.4;
1&gt; if transmission of discovery message for a specific destination is requested by upper layers for sidelink SRB:
2&gt; establish PDCP entity, RLC entity and the logical channel of a sidelink SRB4 for discovery message, as specified in clause 9.1.1.4;
1&gt; if a PC5-RRC connection establishment for a specific destination is indicated by upper layers:
2&gt; establish PDCP entity, RLC entity and the logical channel of a sidelink SRB for PC5-RRC message of the specific destination, as specified in clause 9.1.1.4;
2&gt; consider the PC5-RRC connection is established for the destination.
5.8.9.2 Sidelink UE capability transfer
5.8.9.2.1 General
This clause describes how the UE compiles and transfers its sidelink UE capability information for unicast to the initiating UE.
UECapabilityEnquirySidelink UECapabilityInformationSidelink
5.8.9.2.2 Initiation
The UE may initiate the sidelink UE capability transfer procedure upon indication from upper layer when it needs (additional) UE radio access capability information.
5.8.9.2.3 Actions related to transmission of the UECapabilityEnquirySidelink by the UE
The initiating UE shall set the contents of UECapabilityEnquirySidelink message as follows:
1&gt; include in UE radio access capabilities for sidelink within ue-CapabilityInformationSidelink, if needed; NOTE 1: It is up to initiating UE to decide whether ue-CapabilityInformationSidelink should be included.
1&gt; set frequencyBandListFilterSidelink to include frequency bands for which the peer UE is requested to provide supported bands and band combinations; NOTE 2: The initiating UE is not allowed to send the UECapabilityEnquirySidelink message without including the field frequencyBandListFilterSidelink.
1&gt; submit the UECapabilityEnquirySidelink message to lower layers for transmission.
5.8.9.2.4 Actions related to reception of the UECapabilityEnquirySidelink by the UE
The peer UE shall set the contents of UECapabilityInformationSidelink message as follows:
1&gt; include UE radio access capabilities for sidelink within ue-CapabilityInformationSidelink;
1&gt; compile a list of "candidate band combinations" only consisting of bands included in frequencyBandListFilterSidelink, and prioritized in the order of frequencyBandListFilterSidelink (i.e. first include band combinations containing the first-listed band, then include remaining band combinations containing the second-listed band, and so on).
1&gt; include into supportedBandCombinationListSidelinkNR as many band combinations as possible from the list of "candidate band combinations", starting from the first entry;
1&gt; include the received frequencyBandListFilterSidelink in the field appliedFreqBandListFilter of the requested UE capability;
1&gt; submit the UECapabilityInformationSidelink message to lower layers for transmission.
NOTE: If the UE cannot include all band combinations due to message size or list size constraints, it is up to UE implementation which band combinations it prioritizes.
5.8.9.3 Sidelink radio link failure related actions
The UE shall:
1&gt; upon indication from sidelink RLC entity that the maximum number of retransmissions for a specific destination has been reached; or
1&gt; upon T400 expiry for a specific destination; or
1&gt; upon indication from MAC entity that the maximum number of consecutive HARQ DTX for a specific destination has been reached; or
1&gt; upon integrity check failure indication from sidelink PDCP entity concerning SL-SRB2 or SL-SRB3 for a specific destination:
2&gt; consider sidelink radio link failure to be detected for this destination;
2&gt; release the DRBs of this destination if configured, in according to clause 5.8.9.1a.1;
2&gt; release the SRBs of this destination, in according to clause 5.8.9.1a.3;
2&gt; release the PC5 Relay RLC channels of this destination if configured, in according to clause 5.8.9.7.1;
2&gt; discard the NR sidelink communication related configuration of this destination;
2&gt; reset the sidelink specific MAC of this destination;
2&gt; consider the PC5-RRC connection is released for the destination;
2&gt; indicate the release of the PC5-RRC connection to the upper layers for this destination (i.e. PC5 is unavailable);
2&gt; if UE is in RRC_CONNECTED:
3&gt; if the UE is connected with a L2 U2N Relay UE via the PC5-RRC connection (i.e. the UE is a L2 U2N
Remote UE):
4&gt; initiate the RRC connection re-establishment procedure as specified in 5.3.7.
4&gt; perform the sidelink UE information for NR sidelink communication procedure, as specified in
5.8.3.3; NOTE: It is up to UE implementation on whether and how to indicate to upper layers to maintain the keep-alive procedure .
5.8.9.4 Sidelink common control information
5.8.9.4.1 General
The sidelink common control information is carried by MasterInformationBlockSidelink. The sidelink common control information may change at any transmission, i.e. neither a modification period nor a change notification mechanism is
used. This procedure also applies to sidelink discovery.
A UE configured to receive or transmit NR sidelink communication/discovery shall:
1&gt; if the UE has a selected SyncRef UE, as specified in 5.8.6:
2&gt; ensure having a valid version of the MasterInformationBlockSidelink message of that SyncRef UE;
5.8.9.4.2 Actions related to reception of MasterInformationBlockSidelink message
Upon receiving MasterInformationBlockSidelink, the UE shall:
1&gt; apply the values included in the received MasterInformationBlockSidelink message.
5.8.9.4.3 Transmission of MasterInformationBlockSidelink message
The UE shall set the contents of the MasterInformationBlockSidelink message as follows:
1&gt; if in coverage on the frequency used for the NR sidelink communication as defined in TS 38.304 .
2&gt; set inCoverage to true;
2&gt; if tdd-UL-DL-ConfigurationCommon is included in the received SIB1:
3&gt; set sl-TDD-Config to the value representing the same meaning as that is included in tdd-UL-DL- ConfigurationCommon, as described in TS 38.213, clause 16.1 ;
3&gt; set sl-TDD-Config to the value as specified in TS 38.213 , clause 16.1;
2&gt; if syncInfoReserved is included in an entry of configured sl-SyncConfigList corresponding to the concerned frequency from the received SIB12:
3&gt; set reservedBits to the value of syncInfoReserved in the received SIB12;
3&gt; set all bits in reservedBits to 0;
1&gt; else if out of coverage on the frequency used for NR sidelink communication as defined in TS 38.304 ; and the concerned frequency is included in sl-FreqInfoToAddModList in RRCReconfiguration or in sl-FreqInfoList within SIB12:
2&gt; set inCoverage to true;
2&gt; set reservedBits to the value of the corresponding field included in the preconfigured sidelink parameters (i.e.
sl-PreconfigGeneral in SidelinkPreconfigNR defined in 9.3);
2&gt; set sl-TDD-Config to the value representing the same meaning as that is included in the corresponding field included in the preconfigured sidelink parameters (i.e. sl-PreconfigGeneral in SL-PreconfigurationNR defined in 9.3) as described in TS 38.213, clause 16.1 ;
1&gt; else if out of coverage on the frequency used for NR sidelink communication as defined in TS 38.304 ; and the UE selects GNSS as the synchronization reference and sl-SSB-TimeAllocation3 is not configured for the frequency used in SidelinkPreconfigNR:
2&gt; set inCoverage to true;
2&gt; set reservedBits to the value of the corresponding field included in the preconfigured sidelink parameters (i.e.
sl-PreconfigGeneral in SidelinkPreconfigNR defined in 9.3);
2&gt; set sl-TDD-Config to the value representing the same meaning as that is included in the corresponding field included in the preconfigured sidelink parameters (i.e. sl-PreconfigGeneral in SL-PreconfigurationNR defined in 9.3) as described in TS 38.213, clause 16.1 ;
1&gt; else if the UE has a selected SyncRef UE (as defined in 5.8.6):
2&gt; set inCoverage to false;
2&gt; set sl-TDD-Config and reservedBits to the value of the corresponding field included in the received MasterInformationBlockSidelink;
2&gt; set inCoverage to false;
2&gt; set reservedBits to the value of the corresponding field included in the preconfigured sidelink parameters (i.e.
sl-PreconfigGeneral in SidelinkPreconfigNR defined in 9.3);
2&gt; set sl-TDD-Config to the value representing the same meaning as that is included in the corresponding field included in the preconfigured sidelink parameters (i.e. sl-PreconfigGeneral in SL-PreconfigurationNR defined in 9.3) as described in TS 38.213, clause 16.1 ;
1&gt; set directFrameNumber and slotIndex according to the slot used to transmit the SLSS, as specified in 5.8.5.3;
1&gt; submit the MasterInformationBlockSidelink to lower layers for transmission upon which the procedure ends;
5.8.9.5 Actions related to PC5-RRC connection release requested by upper layers or AS layer
The UE initiates the procedure when upper layers request the release of the PC5-RRC connection as specified in TS
24.587 or when AS layer releases the the PC5-RRC connection. The UE shall not initiate the procedure for power saving purposes.
The UE shall:
1&gt; if the PC5-RRC connection release for the specific destination is requested by upper layers, or initiated at the AS:
2&gt; discard the NR sidelink communication related configuration of this destination;
2&gt; release the DRBs of this destination if configured, in according to clause 5.8.9.1a.1;
2&gt; release the SRBs of this destination, in according to clause 5.8.9.1a.3;
2&gt; release the PC5 Relay RLC channels if configured, in according to clause 5.8.9.7.1;
2&gt; reset the sidelink specific MAC of this destination.
2&gt; consider the PC5-RRC connection is released for the destination;
1&gt; if the PC5-RRC connection release is initiated at the AS:
2&gt; indicate the upper layers the PC5-RRC connection is released for the destination;
5.8.9.6 UE assistance information Sidelink
5.8.9.6.1 General
The purpose of this procedure is for a UE to inform its peer UE of the sidelink DRX assistance information used to determine the sidelink DRX configuration for unicast communication.
For sidelink unicast, a UE may include its desired sidelink DRX configuration in the UEAssistanceInformationSidelink as the sidelink DRX assistance information which is transmitted to its peer UE.
NOTE: It is up to UE implementation to determine its desired sidelink DRX configuration for unicast
5.8.9.6.2 Initiation
For sidelink unicast, if both a RX UE and its peer TX UE for a direction of sidelink communication are capable of sidelink DRX, the RX UE that is interested in sending the sidelink DRX assistance information may send the UEAssistanceInformationSidelink as the sidelink DRX assistance information to its peer UE when the sidelink DRX assistance information has not been sent previously or when the previously transmitted sidelink DRX assistance information has changed.
5.8.9.6.3 Actions related to reception of UEAssistanceInformationSidelink message
For sidelink unicast, when a UE is in RRC_CONNECTED and is performing sidelink operation with resource allocation mode 1, it may report the sidelink DRX assistance information received within the UEAssistanceInformationSidelink from its peer UE to the network. For sidelink unicast, when a UE is in RRC_CONNECTED and is performing sidelink operation with resource allocation mode 2 or is in RRC_IDLE or RRC_INACTIVE or out of coverage, and has obtained the sidelink DRX assistance information from the UEAssistanceInformationSidelink transmitted from its peer UE, it may determine the sidelink DRX configuration SL- DRX-ConfigUC for its peer UE based on UE implementation.
NOTE: When UE determines the sidelink DRX configuration for its peer UE, it may take the sidelink DRX assistance information that is received from its peer UE into account.
5.8.9.7 PC5 Relay RLC channel management for L2 U2N relay
5.8.9.7.1 PC5 Relay RLC channel release
The UE shall:
1&gt; for each sl-RLC-ChannelID-PC5 included in the received sl-RLC-ChannelToReleaseList-PC5 that is part of the current UE sidelink configuration:
2&gt; release the RLC entity and the corresponding logical channel associated with the sl-RLC-ChannelID-PC5;
5.8.9.7.2 PC5 Relay RLC channel addition/modification
Upon PC5-RRC connection is established between the L2 U2N Relay UE and L2 U2N Relay UE, the L2 U2N Relay UE shall:
1&gt; apply RLC specified configuration of SL-RLC0 as specified in clause 9.1.1.4 and RLC default configuration of SL-RLC1 as specified in clause 9.2.4; Upon reception of any message from a L2 U2N Remote UE via SL-RLC0, the L2 U2N Relay UE shall:
1&gt; apply RLC default configuration of SL-RLC1 as specified in clause 9.2.4; For each sl-RLC-ChannelID-PC5 received in the sl-RLC-ChannelToAddModList-PC5 IE the UE shall:
1&gt; if the current configuration contains a sidelink RLC bearer with the received sl-RLC-ChannelID-PC5:
2&gt; reconfigure the sidelink RLC entity or entities in accordance with the received sl-RLC-ConfigPC5;
2&gt; reconfigure the sidelink logical channel in accordance with the received sl-MAC-LogicalChannelConfigPC5;
1&gt; else (a PC5 Relay RLC channel with the received sl-RLC-ChannelID-PC5 was not configured before):
2&gt; establish an sidelink RLC entity in accordance with the received sl-RLC-ConfigPC5;
2&gt; configure the sidelink MAC entity with a logical channel in accordance with the received sl-MAC- LogicalChannelConfigPC5.
5.8.9.8 Remote UE information
5.8.9.8.1 General RemoteUEInformationSidelink
This procedure is used by the L2 U2N Remote UE in RRC_IDLE/RRC_INACTIVE to inform about the required SIB(s) and provide Paging related information to the connected L2 U2N Relay UE.
5.8.9.8.2 Actions related to transmission of RemoteUEInformationSidelink message
The L2 U2N Remote UE in RRC_IDLE or RRC_INACTIVE shall:
1&gt; if the UE has not stored a valid version of a SIB, in accordance with clause 5.2.2.2.1, of one or several required SIB(s) in accordance with clause 5.2.2.1:
2&gt; include sl-Requested-SI-List in the RemoteUEInformationSidelink to indicate the requested SIB(s);
2&gt; if the L2 U2N Remote UE is in RRC_IDLE:
3&gt; include ng-5G-S-TMSI in the sl-PagingIdentity-RemoteUE;
3&gt; set UE specific DRX cycle to the value of UE specific Uu DRX cycle configured by upper layer in the sl- PagingCycle-RemoteUE;
2&gt; else if the L2 U2N Remote UE is in RRC_INACTIVE:
3&gt; include ng-5G-S-TMSI and fullI-RNTI in the sl-PagingIdentity-RemoteUE;
3&gt; set UE specific DRX cycle to the minimum value of UE specific Uu DRX cycles (configured by upper layer and configured by RAN) in the sl-PagingCycle-RemoteUE;
1&gt; submit the RemoteUEInformationSidelink message to lower layers for transmission; When entering RRC_CONNECTED, if L2 U2N remote UE had send sl-Requested-SI-List and sl-PagingInfo- RemoteUE, the L2 U2N Remote UE shall:
1&gt; set the sl-Requested-SI-List to the value release;
1&gt; set the sl-PagingInfo-RemoteUE to the value release;
1&gt; submit the RemoteUEInformationSidelink message to lower layers for transmission;
5.8.9.8.3 Reception of RemoteUEInformationSidelink message by the L2 U2N Relay UE
The L2 U2N Relay UE shall:
1&gt; if the RemoteUEInformationSidelink includes the sl-PagingInfo-RemoteUE:
2&gt; if the UE is in RRC_CONNECTED on an active BWP with common search space configured including pagingSearchSpace; or
2&gt; if the UE is in RRC_IDLE or RRC_INACITIVE:
3&gt; if the sl-PagingInfo-RemoteUE is set to setup:
4&gt; monitor the Paging message at the L2 U2N Remote UE's paging occasion calculated according to sl- PagingCycle-RemoteUE included in sl-PagingInfo-RemoteUE;
3&gt; else (the sl-PagingInfo-RemoteUE is set to release):
4&gt; stop monitoring the Paging message at the L2 U2N Remote UE's paging occasion;
4&gt; release the received paging information in sl-PagingInfo-RemoteUE;
2&gt; else (the UE is in RRC_CONNECTED on an active BWP without pagingSearchSpace configured):
3&gt; if the sl-PagingInfo-RemoteUE is set to setup:
4&gt; include the received sl-PagingIdentity-RemoteUE in SidelinkUEInformationNR message and perform
Sidelink UE information transmission in accordance with 5.8.3;
3&gt; else (the sl-PagingInfo-RemoteUE is set to release):
4&gt; initiate transmission of the SidelinkUEInformationNR message to release the sl-PagingIdentity- RemoteUE in SidelinkUEInformationNR message in accordance with 5.8.3;
4&gt; release the received paging information in sl-PagingInfo-RemoteUE;
1&gt; if the RemoteUEInformationSidelink includes the sl-Requested-SI-List:
2&gt; if the sl-Requested-SI-List is set to setup:
3&gt; perform acquisition of the system information indicated in sl-Requested-SI-List in accordance with 5.2.2;
2&gt; if the sl-Requested-SI-List is set to release:
3&gt; release received SIB request in sl-Requested-SI-List.
5.8.9.9 Uu message transfer in sidelink
5.8.9.9.1 General UuMessageTransferSidelink
The purpose of this procedure is to transfer Paging message and System Information from the L2 U2N Relay UE to the L2 U2N Remote UE in RRC_IDLE/RRC_INACTIVE.
5.8.9.9.2 Actions related to transmission of UuMessageTransferSidelink message
The L2 U2N Relay UE initiates the Uu message transfer procedure when one of the following conditions is met:
1&gt; upon receiving Paging message related to the connected L2 U2N Remote UE from network;
1&gt; upon acquisition of the SIBs requested by the connected L2 U2N Remote UE (as indicated in sl-Requested-SI- List in the RemoteUEInformationSidelink);
1&gt; upon receiving the updated SIB1 and the SIBs have been requested by the connected L2 U2N Remote UE from network; The L2 U2N Relay UE shall set the contents of UuMessageTransferSidelink message as follows:
1&gt; include sl-PagingDelivery if the Paging message received from network containing the associated ue-Identity of the L2 U2N Remote UE;
1&gt; include sl-SystemInformationDelivery if any of the conditions for initiating Uu message transfer procedure related to System Information are met;
1&gt; submit the UuMessageTransferSidelink message to lower layers for transmission.
NOTE: The L2 U2N Relay UE always forwards SIB1 to the L2 U2N Remote UE.
5.8.9.9.3 Reception of the UuMessageTransferSidelink
Upon receiving the UuMessageTransferSidelink message, the L2 U2N Remote UE shall:
2&gt; perform the procedure as defined in clause 5.3.2.3;
2&gt; perform the actions specified in clause 5.2.2.4;
5.8.9.10 Notification Message
5.8.9.10.1 General NotificationMessageSidelink
This procedure is used by a U2N Relay UE to send notification to the connected U2N Remote UE.
5.8.9.10.2 Initiation
The U2N Relay UE can initiate the procedure when one of the following conditions is met:
1&gt; upon Uu RLF as specified in 5.3.10;
1&gt; upon reception of an RRCReconfiguration including the reconfigurationWithSync;
1&gt; upon cell reselection;
1&gt; upon L2 U2N Relay UE's RRC connection failure including RRC connection reject as specified in 5.3.3.5 and
5.3.13.10, and T300 expiry as specified in 5.3.3.7, and RRC resume failure as specified in 5.3.13.5;
5.8.9.10.3 Actions related to transmission of NotificationMessageSidelink message
The U2N Relay UE shall set the indication type as follows:
1&gt; if the UE initiates transmission of the NotificationMessageSidelink message due to Uu RLF:
2&gt; set the indicationType as relayUE-UuRLF;
1&gt; else if the UE initiates transmission of the NotificationMessageSidelink message due to reconfiguration with sync:
2&gt; set the indicationType as relayUE-HO;
1&gt; else if the UE initiates transmission of the NotificationMessageSidelink message due to cell reselection:
2&gt; set the indicationType as relayUE-CellReselection;
1&gt; if the UE initiates transmission of the NotificationMessageSidelink message due to Uu RRC connection establishment failure:
2&gt; set the indicationType as relayUE-UuRRCFailure;
5.8.9.10.4 Actions related to reception of NotificationMessageSidelink message
Upon receiving the NotificationMessageSidelink, the U2N Remote UE shall:
1&gt; if the indicationType is included:
2&gt; if the UE is L2 U2N Remote UE in RRC_CONNECTED:
3&gt; initiate the RRC connection re-establishment procedure as specified in 5.3.7;2&gt; else if the UE is L3 U2N
Remote UE, or L2 U2N Remote UE in RRC_IDLE or RRC_INACTIVE:
3&gt; if the PC5-RRC connection with the U2N Relay UE is determined to be released:
4&gt; perform the PC5-RRC connection release as specified in 5.8.9.5.
3&gt; else maintain the PC5-RRC connection; NOTE: For L3 U2N Remote UE, or L2 U2N Remote UE in RRC_IDLE or RRC_INACTIVE, it is up to Remote UE implementation whether to release or keep the unicast PC5 link.
5.8.10 Sidelink measurement
5.8.10.1 Introduction
The UE may configure the associated peer UE to perform NR sidelink measurement and report on the corresponding PC5-RRC connection in accordance with the NR sidelink measurement configuration for unicast by RRCReconfigurationSidelink message.
The NR sidelink measurement configuration includes the following parameters for a PC5-RRC connection:
1. NR sidelink measurement objects: Object(s) on which the associated peer UE shall perform the NR sidelink
measurements. a) For NR sidelink measurement, a NR sidelink measurement object indicates the NR sidelink frequency of reference signals to be measured.
2. NR sidelink reporting configurations: NR sidelink measurement reporting configuration(s) where there can be one or multiple NR sidelink reporting configurations per NR sidelink measurement object. Each NR sidelink reporting configuration consists of the following: a) Reporting criterion: The criterion that triggers the UE to send a NR sidelink measurement report. This can either be periodical or a single event description. b) RS type: The RS that the UE uses for NR sidelink measurement results. In this release, only DMRS is supported for NR sidelink measurement. c) Reporting format: The quantities that the UE includes in the measurement report. In this release, only RSRP measurement is supported.
3. NR sidelink measurement identities: A list of NR sidelink measurement identities where each NR sidelink measurement identity links one NR sidelink measurement object with one NR sidelink reporting configuration.
By configuring multiple NR sidelink measurement identities, it is possible to link more than one NR sidelink measurement object to the same NR sidelink reporting configuration, as well as to link more than one NR sidelink reporting configuration to the same NR sidelink measurement object. The NR sidelink measurement identity is also included in the NR sidelink measurement report that triggered the reporting, serving as a reference to the network.
4. NR sidelink quantity configurations: The NR sidelink quantity configuration defines the NR sidelink measurement filtering configuration used for all event evaluation and related reporting, and for periodical reporting of that NR sidelink measurement. In each configuration, different filter coefficients can be configured for different NR sidelink measurement quantities.
Both UEs of the PC5-RRC connection maintains a NR sidelink measurement object list, a NR sidelink reporting configuration list, and a NR sidelink measurement identities list according to signalling and procedures in this
5.8.10.2 Sidelink measurement configuration
5.8.10.2.1 General
The UE shall:
1&gt; if the received sl-MeasConfig includes the sl-MeasObjectToRemoveList in the RRCReconfigurationSidelink:
2&gt; perform the sidelink measurement object removal procedure as specified in 5.8.10.2.4;
1&gt; if the received sl-MeasConfig includes the sl-MeasObjectToAddModList in the RRCReconfigurationSidelink:
2&gt; perform the sidelink measurement object addition/modification procedure as specified in 5.8.10.2.5;
1&gt; if the received sl-MeasConfig includes the sl-ReportConfigToRemoveList in the RRCReconfigurationSidelink:
2&gt; perform the sidelink reporting configuration removal procedure as specified in 5.8.10.2.6;
1&gt; if the received sl-MeasConfig includes the sl-ReportConfigToAddModList in the RRCReconfigurationSidelink:
2&gt; perform the sidelink reporting configuration addition/modification procedure as specified in 5.8.10.2.7;
1&gt; if the received sl-MeasConfig includes the sl-QuantityConfig in the RRCReconfigurationSidelink:
2&gt; perform the sidelink quantity configuration procedure as specified in 5.8.10.2.8;
1&gt; if the received sl-MeasConfig includes the sl-MeasIdToRemoveList in the RRCReconfigurationSidelink:
2&gt; perform the sidelink measurement identity removal procedure as specified in 5.8.10.2.2;
1&gt; if the received sl-MeasConfig includes the sl-MeasIdToAddModList in the RRCReconfigurationSidelink:
2&gt; perform the sidelink measurement identity addition/modification procedure as specified in 5.8.10.2.3;
5.8.10.2.2 Sidelink measurement identity removal
The UE shall:
1&gt; for each sl-MeasId included in the received sl-MeasIdToRemoveList that is part of the current UE configuration in VarMeasConfigSL:
2&gt; remove the entry with the matching sl-MeasId from the sl-MeasIdList within the VarMeasConfigSL;
2&gt; remove the NR sidelink measurement reporting entry for this sl-MeasId from the VarMeasReportListSL, if included;
2&gt; stop the periodical reporting timer and reset the associated information (e.g. sl-TimeToTrigger) for this sl- MeasId.
NOTE: The UE does not consider the message as erroneous if the sl-MeasIdToRemoveList includes any sl- MeasId value that is not part of the current UE configuration.
5.8.10.2.3 Sidelink measurement identity addition/modification
The UE shall:
1&gt; for each sl-MeasId included in the received sl-MeasIdToAddModList:
2&gt; if an entry with the matching sl-MeasId exists in the sl-MeasIdList within the VarMeasConfigSL:
3&gt; replace the entry with the value received for this sl-MeasId;
3&gt; add a new entry for this sl-MeasId within the VarMeasConfigSL;
2&gt; remove the measurement reporting entry for this sl-MeasId from the VarMeasReportListSL, if included;
2&gt; stop the periodical reporting timer and reset the associated information (e.g. sl-TimeToTrigger) for this sl- MeasId;
5.8.10.2.4 Sidelink measurement object removal
The UE shall:
1&gt; for each sl-MeasObjectId included in the received sl-MeasObjectToRemoveList that is part of sl-MeasObjectList in VarMeasConfigSL:
2&gt; remove the entry with the matching sl-MeasObjectId from the sl-MeasObjectList within the VarMeasConfigSL;
2&gt; remove all sl-MeasId associated with this sl-MeasObjectId from the sl-MeasIdList within the VarMeasConfigSL, if any;
2&gt; if a sl-MeasId is removed from the sl-MeasIdList:
3&gt; remove the measurement reporting entry for this sl-MeasId from the VarMeasReportListSL, if included;
3&gt; stop the periodical reporting timer and reset the associated information (e.g. sl-TimeToTrigger) for this sl- MeasId.
NOTE: The UE does not consider the message as erroneous if the sl-MeasObjectToRemoveList includes any sl- MeasObjectId value that is not part of the current UE configuration.
5.8.10.2.5 Sidelink measurement object addition/modification
The UE shall:
1&gt; for each sl-MeasObjectId included in the received sl-MeasObjectToAddModList:
2&gt; if an entry with the matching sl-MeasObjectId exists in the sl-MeasObjectList within the VarMeasConfigSL, for this entry:
3&gt; for each sl-MeasId associated with this sl-MeasObjectId included in the sl-MeasIdList within the VarMeasConfigSL, if any:
4&gt; remove the measurement reporting entry for this sl-MeasId from the VarMeasReportListSL, if included;
4&gt; stop the periodical reporting timer and reset the associated information (e.g. sl-TimeToTrigger) for this sl-MeasId;
3&gt; reconfigure the entry with the value received for this sl-MeasObject;
3&gt; add a new entry for the received sl-MeasObject to the sl-MeasObjectList within VarMeasConfigSL.
5.8.10.2.6 Sidelink reporting configuration removal
The UE shall:
1&gt; for each sl-ReportConfigId included in the received sl-ReportConfigToRemoveList that is part of the current UE configuration in VarMeasConfigSL:
2&gt; remove the entry with the matching sl-ReportConfigId from the sl-ReportConfigList within the VarMeasConfigSL;
2&gt; remove all sl-MeasId associated with the sl-ReportConfigId from the sl-MeasIdList within the VarMeasConfigSL, if any;
2&gt; if a sl-MeasId is removed from the sl-MeasIdList:
3&gt; remove the measurement reporting entry for this sl-MeasId from the VarMeasReportListSL, if included;
3&gt; stop the periodical reporting timer and reset the associated information (e.g. sl-TimeToTrigger) for this sl- MeasId.
NOTE: The UE does not consider the message as erroneous if the sl-ReportConfigToRemoveList includes any sl- ReportConfigId value that is not part of the current UE configuration.
5.8.10.2.7 Sidelink reporting configuration addition/modification
The UE shall:
1&gt; for each sl-ReportConfigId included in the received sl-ReportConfigToAddModList:
2&gt; if an entry with the matching sl-ReportConfigId exists in the sl-ReportConfigList within the VarMeasConfigSL, for this entry:
3&gt; reconfigure the entry with the value received for this sl-ReportConfig;
3&gt; for each sl-MeasId associated with this sl-ReportConfigId included in the sl-MeasIdList within the VarMeasConfigSL, if any:
4&gt; remove the measurement reporting entry for this sl-MeasId from the VarMeasReportListSL, if included;
4&gt; stop the periodical reporting timer and reset the associated information (e.g. sl-TimeToTrigger) for this sl-MeasId;
3&gt; add a new entry for the received sl-ReportConfig to the sl-ReportConfigList within the VarMeasConfigSL.
5.8.10.2.8 Sidelink quantity configuration
The UE shall:
1&gt; for each received sl-QuantityConfig:
2&gt; set the corresponding parameter(s) in sl-QuantityConfig within VarMeasConfigSL to the value of the received sl-QuantityConfig parameter(s);
1&gt; for each sl-MeasId included in the sl-MeasIdList within VarMeasConfigSL:
2&gt; remove the measurement reporting entry for this sl-MeasId from the VarMeasReportListSL, if included;
2&gt; stop the periodical reporting timer and reset the associated information (e.g. sl-TimeToTrigger) for this sl- MeasId.
5.8.10.3 Performing NR sidelink measurements
5.8.10.3.1 General
A UE shall derive NR sidelink measurement results by measuring one or multiple DMRS associated per PC5-RRC connection as configured by the peer UE associated, as described in 5.8.10.3.2. For all NR sidelink measurement results the UE applies the layer 3 filtering as specified in clause 5.5.3.2, before using the measured results for evaluation of reporting criteria and measurement reporting. In this release, only NR sidelink RSRP can be configured as trigger quantity and reporting quantity.
The UE shall:
1&gt; for each sl-MeasId included in the sl-MeasIdList within VarMeasConfigSL:
2&gt; if the sl-MeasObject is associated to NR sidelink and the sl-RS-Type is set to dmrs:
3&gt; derive the layer 3 filtered NR sidelink measurement result based on DMRS for the trigger quantity and each measurement quantity indicated in sl-ReportQuantity using parameters from the associated sl- MeasObject, as described in 5.8.10.3.2.
2&gt; perform the evaluation of reporting criteria as specified in 5.8.10.4.
5.8.10.3.2 Derivation of NR sidelink measurement results
The UE may be configured by the peer UE associated to derive NR sidelink RSRP measurement results per PC5-RRC connection associated to the NR sidelink measurement objects based on parameters configured in the sl-MeasObject and in the sl-ReportConfig.
The UE shall:
1&gt; for each NR sidelink measurement quantity to be derived based on NR sidelink DMRS:
2&gt; derive the corresponding measurement of NR sidelink frequency indicated quantity based on DMRS as described in TS 38.215 in the concerned sl-MeasObject;
2&gt; apply layer 3 filtering as described in 5.5.3.2;
5.8.10.4 Sidelink measurement report triggering
5.8.10.4.1 General
The UE shall:
1&gt; for each sl-MeasId included in the sl-MeasIdList within VarMeasConfigSL:
2&gt; if the sl-ReportType is set to sl-EventTriggered and if the entry condition applicable for this event, i.e. the event corresponding with the sl-EventId of the corresponding sl-ReportConfig within VarMeasConfigSL, is fulfilled for NR sidelink frequency for all NR sidelink measurements after layer 3 filtering taken during sl- TimeToTrigger defined for this event within the VarMeasConfigSL, while the VarMeasReportListSL does not include a NR sidelink measurement reporting entry for this sl-MeasId (a first NR sidelink frequency triggers the event):
3&gt; include a NR sidelink measurement reporting entry within the VarMeasReportListSL for this sl-MeasId;
3&gt; set the sl-NumberOfReportsSent defined within the VarMeasReportListSL for this sl-MeasId to 0;
3&gt; include the concerned NR sidelink frequency in the sl-FrequencyTriggeredList defined within the VarMeasReportListSL for this sl-MeasId;
3&gt; initiate the NR sidelink measurement reporting procedure, as specified in 5.8.10.5;
2&gt; else if the sl-ReportType is set to sl-EventTriggered and if the entry condition applicable for this event, i.e.
the event corresponding with the sl-EventId of the corresponding sl-ReportConfig within VarMeasConfigSL, is fulfilled for NR sidelink frequency not included in the sl-FrequencyTriggeredList for all NR sidelink measurements after layer 3 filtering taken during sl-TimeToTrigger defined for this event within the VarMeasConfigSL (a subsequent NR sidelink frequency triggers the event):
3&gt; set the sl-NumberOfReportsSent defined within the VarMeasReportListSL for this sl-MeasId to 0;
3&gt; include the concerned NR sidelink frequency in the sl-FrequencyTriggeredList defined within the VarMeasReportListSL for this sl-MeasId;
3&gt; initiate the NR sidelink measurement reporting procedure, as specified in 5.8.10.5;
2&gt; else if the sl-ReportType is set to sl-EventTriggered and if the leaving condition applicable for this event is fulfilled for NR sidelink frequency included in the sl-FrequencyTriggeredList defined within the VarMeasReportListSL for this sl-MeasId for all NR sidelink measurements after layer 3 filtering taken during sl-TimeToTrigger defined within the VarMeasConfigSL for this event:
3&gt; remove the concerned NR sidelink frequency in the sl-FrequencyTriggeredList defined within the VarMeasReportListSL for this sl-MeasId;
3&gt; if sl-ReportOnLeave is set to true for the corresponding reporting configuration:
4&gt; initiate the NR sidelink measurement reporting procedure, as specified in 5.8.10.5;
3&gt; if the sl-FrequencyTriggeredList defined within the VarMeasReportListSL for this sl-MeasId is empty:
4&gt; remove the NR sidelink measurement reporting entry within the VarMeasReportListSL for this sl- MeasId;
4&gt; stop the periodical reporting timer for this sl-MeasId, if running;
2&gt; if sl-ReportType is set to sl-Periodical and if a (first) NR sidelink measurement result is available:
3&gt; include a NR sidelink measurement reporting entry within the VarMeasReportListSL for this sl-MeasId;
3&gt; set the sl-NumberOfReportsSent defined within the VarMeasReportListSL for this sl-MeasId to 0;
3&gt; initiate the NR sidelink measurement reporting procedure, as specified in 5.8.10.5, immediately after the quantity to be reported becomes available for the NR sidelink frequency:
2&gt; upon expiry of the periodical reporting timer for this sl-MeasId:
3&gt; initiate the NR sidelink measurement reporting procedure, as specified in 5.8.10.5.
5.8.10.4.2 Event S1 (Serving becomes better than threshold)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition S1-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition S1-2, as specified below, is fulfilled;
1&gt; for this NR sidelink measurement, consider the NR sidelink frequency corresponding to the associated sl- MeasObject associated with this event.
Ms Hys &gt; Thresh
Ms + Hys &lt; Thresh
The variables in the formula are defined as follows:
Ms is the NR sidelink measurement result of the NR sidelink frequency, not taking into account any offsets.
Hys is the hysteresis parameter for this event (i.e. sl-Hysteresis as defined within sl-ReportConfig for this event).
Thresh is the threshold parameter for this event (i.e. s1-Threshold as defined within sl-ReportConfig for this event).
Ms is expressed in dBm in case of RSRP.
Hys is expressed in dB.
Thresh is expressed in the same unit as Ms.
5.8.10.4.3 Event S2 (Serving becomes worse than threshold)
The UE shall:
1&gt; consider the entering condition for this event to be satisfied when condition S2-1, as specified below, is fulfilled;
1&gt; consider the leaving condition for this event to be satisfied when condition S2-2, as specified below, is fulfilled;
1&gt; for this NR sidelink measurement, consider the NR sidelink frequency indicated by the sl-MeasObject associated to this event.
Ms + Hys &lt; Thresh
Ms Hys &gt; Thresh
The variables in the formula are defined as follows:
Ms is the NR sidelink measurement result of the NR sidelink frequency, not taking into account any offsets.
Hys is the hysteresis parameter for this event (i.e. sl-Hysteresis as defined within sl-ReportConfig for this event).
Thresh is the threshold parameter for this event (i.e. s2-Threshold as defined within sl-ReportConfig for this event).
Ms is expressed in dBm in case of RSRP.
Hys is expressed in dB.
Thresh is expressed in the same unit as Ms.
5.8.10.5 Sidelink measurement reporting
5.8.10.5.1 General MeasurementReportSidelink
The purpose of this procedure is to transfer measurement results from the UE to the peer UE associated.
For the sl-MeasId for which the NR sidelink measurement reporting procedure was triggered, the UE shall set the sl- MeasResults within the MeasurementReportSidelink message as follows:
1&gt; set the sl-MeasId to the measurement identity that triggered the NR sidelink measurement reporting;
1&gt; if the sl-ReportConfig associated with the sl-MeasId that triggered the NR sidelink measurement reporting is set to sl-EventTriggered or sl-Periodical:
2&gt; set sl-ResultDMRS within sl-MeasResult to include the NR sidelink DMRS based quantity indicated in the sl- ReportQuantity within the concerned sl-ReportConfig;
1&gt; increment the sl-NumberOfReportsSent as defined within the VarMeasReportListSSL for this sl-MeasId by 1;
1&gt; stop the periodical reporting timer, if running;
1&gt; if the sl-NumberOfReportsSent as defined within the VarMeasReportListSL for this sl-MeasId is less than the sl- ReportAmount as defined within the corresponding sl-ReportConfig for this sl-MeasId:
2&gt; start the periodical reporting timer with the value of sl-ReportInterval as defined within the corresponding sl- ReportConfig for this sl-MeasId;
2&gt; if the sl-ReportType is set to sl-Periodical:
3&gt; remove the entry within the VarMeasReportListSL for this sl-MeasId;
3&gt; remove this sl-MeasId from the sl-MeasIdList within VarMeasConfigSL;
1&gt; submit the MeasurementReportSidelink message to lower layers for transmission, upon which the procedure
5.8.11 Zone identity calculation
The UE shall determine an identity of the zone (i.e. Zone_id) in which it is located using the following formulae, if sl- ZoneConfig is configured:
The parameters in the formulae are defined as follows:
L is the value of sl-ZoneLength included in sl-ZoneConfig;
x is the geodesic distance in longitude between UE's current location and geographical coordinates (0, 0) according to WGS84 model and it is expressed in meters;
y is the geodesic distance in latitude between UE's current location and geographical coordinates (0, 0) according to WGS84 model and it is expressed in meters.
NOTE: How the calculated zone_id is used is specified in TS 38.321 .
5.8.12 DFN derivation from GNSS
When the UE selects GNSS as the synchronization reference source, the DFN, the subframe number within a frame and slot number within a frame used for NR sidelink communication/discovery are derived from the current UTC time, by the following formulae:
Tcurrent is the current UTC time obtained from GNSS. This value is expressed in milliseconds; Tref is the reference UTC time 00:00:00 on Gregorian calendar date 1 January, 1900 (midnight between Thursday,
; December 31, 1899 and Friday, January 1, 1900). This value is expressed in milliseconds OffsetDFN is the value sl-OffsetDFN if configured, otherwise it is zero. This value is expressed in milliseconds.
=0/1/2/3 corresponding to the 15/30/60/120 kHz of SCS for SL, respectively.
NOTE 1: In case of leap second change event, how UE obtains the scheduled time of leap second change to adjust
Tcurrent correspondingly is left to UE implementation. How UE handles to avoid the sudden discontinuity of DFN is left to UE implementation.
5.8.13 NR sidelink discovery
5.8.13.1 General
The purpose of this procedure is to perform sidelink discovery as specified in TS 23.304 .
5.8.13.2 Sidelink discovery monitoring
A UE capable of sidelink discovery that is configured by upper layers to monitor NR sidelink discovery messages shall:
1&gt; if the frequency used for NR sidelink discovery is included in sl-FreqInfoToAddModList in RRCReconfiguration message and sl-DiscConfig is included in RRCReconfiguration; or if the frequency used for NR sidelink discovery is included in sl-FreqInfoList included in SIB12 and sl-DiscConfigCommon is included in SIB12:
2&gt; if the UE is configured with sl-DiscRxPool for NR sidelink discovery reception included in RRCReconfiguration message with reconfigurationWithSync (i.e. handover):
3&gt; configure lower layers to monitor sidelink control information and the corresponding data using the resource pool indicated by sl-DiscRxPool for NR sidelink discovery reception in RRCReconfiguration;
2&gt; else if the UE is configured with sl-RxPool for NR sidelink discovery reception included in RRCReconfiguration message with reconfigurationWithSync (i.e. handover):
3&gt; configure lower layers to monitor sidelink control information and the corresponding data using the resource pool indicated by sl-RxPool for NR sidelink discovery reception in RRCReconfiguration;
2&gt; else if the cell chosen for NR sidelink discovery reception provides SIB12:
3&gt; if sl-DiscRxPool for NR sidelink is included in SIB12:
4&gt; configure lower layers to monitor sidelink control information and the corresponding data using the resource pool indicated by sl-DiscRxPoo for NR sidelink discovery reception in SIB12;
3&gt; else if sl-RxPool for NR sidelink is included in SIB12:
4&gt; configure lower layers to monitor sidelink control information and the corresponding data using the resource pool indicated by sl-RxPool for NR sidelink discovery reception in SIB12;
2&gt; if out of coverage on the concerned frequency for NR sidelink discovery:
3&gt; configure lower layers to monitor sidelink control information and the corresponding data using the resource pool that were preconfigured by sl-DiscRxPool or sl-RxPool for NR sidelink discovery reception in SL-PreconfigurationNR, as defined in clause 9.3;
5.8.13.3 Sidelink discovery transmission
A UE capable of sidelink discovery that is configured by upper layer to transmit NR sidelink discovery message shall:
1&gt; if the frequency used for NR sidelink discovery is included in sl-FreqInfoToAddModList in sl- ConfigDedicatedNR within RRCReconfiguration message and sl-DiscConfig is included in RRCReconfiguration; or if the frequency used for NR sidelink discovery is included in sl-FreqInfoList within SIB12 and sl- DiscConfigCommon is included in SIB12:
2&gt; if the UE is in RRC_CONNECTED and uses the frequency included in sl-ConfigDedicatedNR within RRCReconfiguration message:
3&gt; if the UE is acting as NR sidelink U2N Relay UE, and if the NR sidelink U2N Relay UE threshold conditions as specified in 5.8.14.2 are met based on sl-RelayUE-Config; or
3&gt; if the UE is selecting NR sidelink U2N Relay UE / has a selected NR sidelink U2N Relay UE, and if the NR sidelink U2N Remote UE threshold conditions as specified in 5.8.15.2 are met based on sl- RemoteUE-Config; or
3&gt; if the UE is performing NR sidelink non-relay discovery:
4&gt; if the UE is configured with sl-ScheduledConfig:
5&gt; if T310 for MCG or T311 is running; and if sl-TxPoolExceptional is included in sl-FreqInfoList for the concerned frequency in SIB12 or included in sl-ConfigDedicatedNR in RRCReconfiguration; or
5&gt; if T301 is running and the cell on which the UE initiated RRC connection re-establishment provides SIB12 including sl-TxPoolExceptional for the concerned frequency; or
5&gt; if T304 for MCG is running and the UE is configured with sl-TxPoolExceptional included in sl- ConfigDedicatedNR for the concerned frequency in RRCReconfiguration:
6&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on random selection using the resource pool indicated by sl-TxPoolExceptional as defined in TS 38.321
6&gt; configure lower layers to perform the sidelink resource allocation mode 1 using the resource pool indicated by sl-DiscTxPoolScheduling or sl-TxPoolScheduling for NR sidelink discovery transmission on the concerned frequency in RRCReconfiguration;
5&gt; if T311 is running, configure the lower layers to release the resources indicated by rrc- ConfiguredSidelinkGrant (if any);
4&gt; if the UE is configured with sl-UE-SelectedConfig:
5&gt; if a result of sensing on the resources configured in sl-DiscTxPoolSelected or sl- TxPoolSelectedNormal for NR sidelink discovery transmission on the concerned frequency included in sl-ConfigDedicatedNR within RRCReconfiguration is not available in accordance with TS 38.214 ;
6&gt; if sl-TxPoolExceptional for the concerned frequency is included in RRCReconfiguration; or
6&gt; if the PCell provides SIB12 including sl-TxPoolExceptional in sl-FreqInfoList for the concerned frequency:
7&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on random selection using the resource pool indicated by sl-TxPoolExceptional as defined in TS
5&gt; else, if the sl-DiscTxPoolSelected for NR sidelink discovery transmission on the concerned frequency is included in the sl-ConfigDedicatedNR within RRCReconfiguration:
6&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on sensing (as defined in TS 38.321 and TS 38.214 ) using the pools of resources indicated by sl- DiscTxPoolSelected for NR sidelink discovery transmission on the concerned frequency in RRCReconfiguration;
5&gt; else, if the sl-TxPoolSelectedNormal for NR sidelink discovery transmission on the concerned frequency is included in the sl-ConfigDedicatedNR within RRCReconfiguration:
6&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on sensing (as defined in TS 38.321 and TS 38.214 ) using the pools of resources indicated by sl- TxPoolSelectedNormal for NR sidelink discovery transmission on the concerned frequency in RRCReconfiguration;
2&gt; else if the cell chosen for NR sidelink discovery transmission provides SIB12:
3&gt; if the UE is acting as NR sidelink U2N Relay UE and if the NR sidelink U2N Relay UE threshold conditions as specified in 5.8.14.2 are met based on sl-RelayUE-ConfigCommon in SIB12; or
3&gt; if the UE is selecting NR sidelink U2N Relay UE / has a selected NR sidelink U2N Relay UE and if the NR sidelink U2N Remote UE threshold conditions as specified in 5.8.15.2 are met based on sl- RemoteUE-ConfigCommon in SIB12; or
3&gt; if the UE is performing NR sidelink non-relay discovery:
4&gt; if SIB12 includes sl-DiscTxPoolSelected or sl-TxPoolSelectedNormal for NR sidelink discovery transmission on the concerned frequency, and a result of sensing on the resources configured in the sl- DiscTxPoolSelected or sl-TxPoolSelectedNormal for NR sidelink discovery transmission is available in accordance with TS 38.214 :
5&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on sensing using the pools of resources indicated by sl-DiscTxPoolSelected or sl-TxPoolSelectedNormal for NR sidelink discovery transmission on the concerned frequency in SIB12 as defined in TS 38.321 ;
4&gt; else if SIB12 includes sl-TxPoolExceptional for the concerned frequency:
5&gt; from the moment the UE initiates RRC connection establishment or RRC connection resume, until receiving an RRCReconfiguration including sl-ConfigDedicatedNR, or receiving an RRCRelease or an RRCReject; or
5&gt; if a result of sensing on the resources configured in sl-DiscTxPoolSelected or sl- TxPoolSelectedNormal for NR sidelink discovery transmission on the concerned frequency in SIB12 is not available in accordance with TS 38.214 :
6&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on random selection (as defined in TS 38.321 ) using one of the pools of resources indicated by sl- TxPoolExceptional for the concerned frequency;
1&gt; else if out of coverage on the concerned frequency for NR sidelink discovery:
2&gt; if the UE is acting as L3 U2N Relay UE and if the NR sidelink U2N Relay UE threshold conditions as specified in 5.8.14.2 are met based on sl-RelayUE-ConfigCommon in SidelinkPreconfigNR; or
2&gt; if the UE is selecting NR sidelink U2N Relay UE / has a selected NR sidelink U2N Relay UE and if the NR sidelink U2N Remote UE threshold conditions as specified in 5.8.15.2 are met based on sl-RemoteUE- ConfigCommon in SidelinkPreconfigNR; or
2&gt; if the UE is performing NR sidelink non-relay discovery:
3&gt; configure lower layers to perform the sidelink resource allocation mode 2 based on sensing (as defined in TS 38.321 and TS 38.213 ) using the pools of resources indicated in sl-DiscTxPoolSelected or sl- TxPoolSelectedNormal for NR sidelink discovery transmission on the concerned frequency in SidelinkPreconfigNR.
5.8.14 NR sidelink U2N Relay UE operation
5.8.14.1 General
This procedure is used by a UE supporting NR sidelink U2N Relay UE operation configured by upper layers to receive/ transmit NR sidelink discovery messages to evaluate AS layer conditions.
5.8.14.2 NR sidelink U2N Relay UE threshold conditions
A UE capable of NR sidelink U2N Relay UE operation shall:
1&gt; if the threshold conditions specified in this clause were not met:
2&gt; if threshHighRelay is not configured; or the RSRP measurement of the PCell, or the cell on which the UE camps, is below threshHighRelay by hystMaxRelay if configured; and
2&gt; if threshLowRelay is not configured; or the RSRP measurement of the PCell, or the cell on which the UE camps, is above threshLowRelay by hystMinRelay if configured:
3&gt; consider the threshold conditions to be met (entry);
2&gt; if the RSRP measurement of the PCell, or the cell on which the UE camps, is above threshHighRelay if configured; or
2&gt; if the RSRP measurement of the PCell, or the cell on which the UE camps, is below threshLowRelay if configured;
3&gt; consider the threshold conditions not to be met (leave);
5.8.15 NR sidelinkU2N Remote UE operation
5.8.15.1 General
This procedure is used by a UE supporting NR sidelink U2N Remote UE operationconfigured by upper layers to receive/ transmit NR sidelink discovery message to evaluate AS layer conditions.
5.8.15.2 NR Sidelink U2N Remote UE threshold conditions
A UE capable of NR sidelink U2N Remote UE operation shall:
1&gt; if the threshold conditions specified in this clause were not met:
2&gt; if threshHighRemote is not configured; or the RSRP measurement of the PCell, or the cell on which the UE camps, is below threshHighRemote by hystMaxRemote if configured, or
2&gt; if the UE has no suitable cell:
3&gt; consider the threshold conditions to be met (entry);
2&gt; if the RSRP measurement of the PCell, or the cell on which the UE camps, is above threshHighRemote if configured:
3&gt; consider the threshold conditions not to be met (leave);
5.8.15.3 Selection and reselection of NR sidelink U2N Relay UE
A UE capable of NR sidelink U2N Remote UE operation that is configured by upper layers to search for a NR sidelink U2N Relay UE shall:
1&gt; if the UE has no suitable cell; or
1&gt; if the RSRP measurement of the cell on which the UE camps (for L2 and L3 U2N Remote UE in RRC_IDLE or RRC_INACTIVE)/ the PCell (for L3 U2N Remote UE in RRC_CONNECTED) is below threshHighRemote within sl-remoteUE-Config:
2&gt; if the UE does not have a selected NR sidelink U2N Relay UE; or
2&gt; if the UE has a selected NR sidelink U2N Relay UE, and SL-RSRP of the currently selected NR sidelink U2N Relay UE is available and is below sl-RSRP-Thresh; or
2&gt; if the UE has a selected NR sidelink U2N Relay UE, and SL-RSRP of the currently selected NR sidelink U2N Relay UE is not available, and SD-RSRP of the currently selected U2N Relay UE is below sl-RSRP- Thresh; or NOTE 1: U2N Remote UE uses SL-RSRP measurements for relay reselection trigger evaluation when there is data transmission from U2N Relay UE to U2N Remote UE, and it is left to UE implementation whether to use SL-RSRP or SD-RSRP for relay reselection trigger evaluation in case of no data transmission from U2N
Relay UE to U2N Remote UE. If SD-RSRP is used, the discovery procedure will be preformed between the U2N Remote UE and the selected U2N Relay UE.
2&gt; if the UE has a selected NR sidelink U2N Relay UE, and upper layers indicate not to use the currently selected NR sidelink U2N Relay UE; or
2&gt; if the UE has a selected NR sidelink U2N Relay UE, and upper layers request the release of the PC5-RRC connection or when AS layer releases the the PC5-RRC connection with the currently selected U2N Relay UE as specified in clause 5.8.9.5; or
2&gt; if the UE has a selected NR sidelink U2N Relay UE, and sidelink radio link failure is detected on the PC5- RRC connection with the current U2N Relay UE as specified in clause 5.8.9.3:
3&gt; perform NR sidelink discovery procedure as specified in clause 5.8.13 in order to search for candidate NR sidelink U2N Relay UEs;
4&gt; when evaluating the one or more detected NR sidelink U2N Relay UEs, apply layer 3 filtering as specified in 5.5.3.2 across measurements that concern the same U2N Relay UE ID and using the sl- FilterCoefficient-RSRP in SystemInformationBlockType12 (in coverage) or the preconfigured sl- FilterCoefficient-RSRP as defined in 9.3 (out of coverage), before using the SD-RSRP measurement results;
4&gt; select a candidate NR sidelink U2N Relay UE for which SD-RSRP exceeds sl-RSRP-Thresh by sl- HystMin; NOTE 2: If multiple suitable candidate Relay UEs which meet all AS-layer &amp; higher layer criteria are available, it is up to Remote UE implementation to choose one Relay UE. The details of the interaction with upper layers are up to UE implementation.
3&gt; if the UE did not detect any candidate NR sidelink U2N Relay UE which SD-RSRP exceeds sl-RSRP- Thresh by sl-HystMin:
4&gt; consider no NR sidelink U2N Relay UE to be selected; NOTE 3: For L2 U2N Remote UEs in RRC_IDLE/INACTIVE and L3 U2N Remote UEs, the cell (re)selection procedure and relay (re)selection procedure run independently. If both suitable cells and suitable U2N
Relay UEs are available, it is up to U2N Remote UE implementation to select either a cell or a U2N
Relay UE. Furthermore, L3 U2N Remote UE's selection on both cell and U2N Relay UE is also based on UE implementation.
5.9 MBS Broadcast
5.9.1 Introdcution
5.9.1.1 General UE receiving or interested to receive MBS broadcast service(s) applies MBS broadcast procedures described in this clause as well as the MBS Interest Indication procedure as specified in clause 5.9.4.
MBS broadcast configuration information is provided on MCCH logical channel. MCCH carries the MBSBroadcastConfiguration message which indicates the MBS broadcast sessions that are provided in the cell as well as the corresponding scheduling related information for these sessions. Optionally, the MBSBroadcastConfiguration message may also contain a list of neighbour cells providing the same broadcast MBS service(s) as provided in the current cell. The configuration information required by the UE to receive MCCH is provided in SIB20. Additionally, System Information provides also an information related to service continuity of MBS broadcast in SIB21.
5.9.1.2 MCCH scheduling
The MCCH information (i.e. information transmitted in messages sent over MCCH) is transmitted periodically, using a configurable repetition period and within a configured transmission window. MCCH transmissions (and the associated radio resources and MCS) are indicated via the PDCCH addressed to MCCH-RNTI. PDCCH monitoring occasion(s) for MCCH transmission are determined according to the common search space indicated by searchspaceMCCH. If searchspaceMCCH is set to zero, PDCCH monitoring occasions for MCCH message reception in the MCCH transmission window are the same as PDCCH monitoring occasions for SIB1 where the mapping between PDCCH monitoring occasions and SSBs is specified in TS 38.213. If searchspaceMCCH is not set to zero, PDCCH monitoring occasions for MCCH message are determined based on search space indicated by searchspaceMCCH.
PDCCH monitoring occasions for MCCH message which are not overlapping with UL symbols (determined according to tdd-UL-DL-ConfigurationCommon) are sequentially numbered from one in the MCCH transmission window. The [xN+K]th PDCCH monitoring occasion for MCCH message in MCCH transmission window corresponds to the Kth transmitted SSB, where x = 0, 1, ...X-1, K = 1, 2, N, N is the number of actual transmitted SSBs determined according to ssb-PositionsInBurst in SIB1 and X is equal to CEIL(number of PDCCH monitoring occasions in MCCH transmission window/N). The actual transmitted SSBs are sequentially numbered from one in ascending order of their SSB indexes. The UE assumes that, in the MCCH transmisson window, PDCCH for an MCCH message is transmitted in at least one PDCCH monitoring occasion corresponding to each transmitted SSB and thus the selection of SSB for the reception MCCH messages is up to UE implementation.
5.9.1.3 MCCH information validity and notification of changes
Change of MCCH information only occurs at specific radio frames, i.e. the concept of a modification period is used.
Within a modification period, the same MCCH information may be transmitted a number of times, as defined by its scheduling (which is based on a repetition period).
When the network changes (some of) the MCCH information, it notifies the UEs about the change via PDCCH which schedules the MCCH in every repetition period in the current modification period.
Upon receiving a change notification, a UE receiving or interested to receive MBS services transmitted using MBS broadcast acquires the new MCCH information starting from the same slot. The UE applies the previously acquired MCCH information until the UE acquires the new MCCH information. The notification is transmitted with a 2-bit bitmap, see TS 38.212 clause 7.3.1.2.1. The MSB in the 2-bit bitmap, when set to '1', indicates the start of MBS service(s). The LSB in the 2-bit bitmap, when set to '1', indicates modification of MCCH information other than the change caused by start of new MBS service(s), e.g. modification of a configuration of an on-going MBS session(s), MBS session(s) stop or neighbouring cell information modification.
5.9.2 MCCH information acquisition
5.9.2.1 General UE Network MBSBroadcastConfiguration
The UE applies the MCCH information acquisition procedure to acquire the MBS broadcast configuration information broadcasted by the network. The procedure applies to MBS capable UEs interested to receive MBS broadcast services that are in RRC_IDLE, RRC_INACTIVE or RRC_CONNECTED with an active BWP with common search space configured by searchSpaceMCCH.
5.9.2.2 Initiation
A UE shall apply the MCCH information acquisition procedure upon becoming interested to receive MBS broadcast
services. A UE interested to receive MBS broadcast services shall apply the MCCH information acquisition procedure upon entering the cell providing SIB20 (e.g. upon power on, following UE mobility) and upon receiving a notification that the MCCH information has changed due to the start of new MBS service(s). A UE that is receiving data via broadcast MRB shall apply the MCCH information acquisition procedure upon receiving a notification that the MCCH information has changed due to MCCH information modification other than the change caused by the start of new MBS session(s).
Unless explicitly stated otherwise in the procedural specification, the MCCH information acquisition procedure overwrites any stored MCCH information, i.e. delta configuration is not applicable for MCCH information and the UE discontinues using a field if it is absent in MCCH information.
5.9.2.3 MCCH information acquisition by the UE
An MBS capable UE interested to or receiving an MBS broadcast service shall:
1&gt; if the procedure is triggered by an MCCH information change notification:
2&gt; start acquiring the MBSBroadcastConfiguration message on MCCH from the slot in which the change notification was received;
1&gt; if the UE enters a cell broadcasting SIB20:
2&gt; acquire the MBSBroadcastConfiguration message on MCCH at the next repetition period;
5.9.2.4 Actions upon reception of the MBSBroadcastConfiguration message
No UE requirements related to the contents of the MBSBroadcastConfiguration message apply other than those specified elsewhere e.g. within the corresponding field descriptions.
5.9.3 Broadcast MRB configuration
5.9.3.1 General
The broadcast MRB configuration procedure is used by the UE to configure PDCP, RLC, MAC and the physical layer upon starting and/or stopping to receive an broadcast MRB transmitted on MTCH, or upon modification of a configuration of a broadcast MRB received by the UE. The procedure applies to MBS capable UEs interested to or receiving an MBS broadcast service that are in RRC_IDLE, RRC_INACTIVE or RRC_CONNECTED with an active BWP with common search space configured by searchSpaceMTCH.
5.9.3.2 Initiation
The UE applies the broadcast MRB establishment procedure to start receiving an MBS session of a MBS broadcast service it is interested in. The procedure may be initiated e.g. upon start of the MBS session, upon entering a cell providing a MBS broadcast service UE is interested in, upon becoming interested in the MBS broadcast service, upon removal of UE capability limitations inhibiting reception of the MBS broadcast service UE is interested in.
The UE applies the broadcast MRB release procedure to stop receiving a session of a MBS broadcast service. The procedure may be initiated e.g. upon stop of the MBS session, upon leaving the cell broadcasting the MBS service UE is interested in, upon losing interest in the MBS service, when capability limitations start inhibiting reception of the concerned service.
5.9.3.3 Broadcast MRB establishment
Upon a broadcast MRB establishment, the UE shall:
1&gt; establish a PDCP entity and an RLC entity in accordance with MRB-InfoBroadcast for this broadcast MRB included in the MBSBroadcastConfiguration message and the configuration specified in 9.1.1.7;
1&gt; receive DL-SCH on the cell where the MBSBroadcastConfiguration message was received for the MBS broadcast service for which the broadcast MRB is established and using g-RNTI and mtch-SchedulingInfo (if
included) in this message for this MBS broadcast service;
1&gt; configure the physical layer in accordance with the mbs-SessionInfoList, searchSpaceMTCH, pdsch- ConfigMTCH, applicable for the broadcast MRB, as included in the MBSBroadcastConfiguration message;
1&gt; inform upper layers about the establishment of the broadcast MRB by indicating the corresponding tmgi;
1&gt; if an SDAP entity with the received tmgi does not exist:
2&gt; establish an SDAP entity as specified in TS 37.324 clause 5.1.1.
5.9.3.4 Broadcast MRB release
Upon broadcast MRB release for MBS broadcast service, the UE shall:
1&gt; release the PDCP entity, RLC entity as well as the related MAC and physical layer configuration;
1&gt; inform upper layers about the release of the broadcast MRB by indicating the corresponding tmgi;
1&gt; if the SDAP entity associated with the corresponding tmgi has no associated MRB:
2&gt; release the SDAP entity, as specified in TS 37.324 clause 5.1.2.
5.9.4 MBS Interest Indication
5.9.4.1 General SIBx1 acquisition MBSInterestIndication
The purpose of this procedure is to inform the network that the UE in RRC_CONNECTED state is receiving or is interested to receive MBS broadcast service(s) and to inform the network about the priority of MBS broadcast versus unicast reception. MBS Interest Indication can only be sent after AS security activation.
5.9.4.2 Initiation
An MBS capable UE in RRC_CONNECTED may initiate the procedure in several cases including upon successful connection establishment, upon entering or leaving the broadcast service area, upon MBS broadcast session start or stop, upon change of interest, upon change of priority between MBS broadcast reception and unicast reception, upon change to a PCell broadcasting SIB21.
Upon initiating the procedure, the UE shall:
1&gt; if SIB21 is provided by the PCell:
2&gt; ensure having a valid version of SIB21 for the PCell;
2&gt; if the UE did not transmit MBS Interest Indication since last entering RRC_CONNECTED state; or
2&gt; if since the last time the UE transmitted an MBS Interest Indication, the UE connected to a PCell not broadcasting SIB21:
3&gt; if the set of MBS broadcast frequencies of interest, determined in accordance with 5.9.4.3, is not empty:
4&gt; set the contents of MBS Interest Indication according to 5.9.4.5 and initiate transmission of the MBSInterestIndication message;
3&gt; if the set of MBS broadcast frequencies of interest, determined in accordance with 5.9.4.3, is different from mbs-FreqList included in the last transmission of the MBS Interest Indication; or
3&gt; if the prioritisation of reception of all indicated MBS broadcast frequencies compared to reception of any of the established unicast bearers has changed since the last transmission of the MBS Interest Indication:
4&gt; set the contents of MBS Interest Indication according to 5.9.4.5 and initiate transmission of the MBSInterestIndication message; NOTE: The UE may send MBS Interest Indication even when it is able to receive the MBS services it is interested in i.e. to avoid that the network allocates a configuration inhibiting MBS broadcast reception.
3&gt; else if SIB20 is provided by the PCell:
4&gt; if since the last time the UE transmitted the MBS Interest Indication, the UE connected to a PCell not broadcasting SIB20; or
4&gt; if the set of MBS broadcast services of interest determined in accordance with 5.9.4.4 is different from mbs-ServiceList included in the last transmission of the MBS Interest Indication:
5&gt; set the contents of MBS Interest Indication according to 5.9.4.5 and initiate the transmission of MBSInterestIndication message.
5.9.4.3 MBS frequencies of interest determination
The UE shall:
1&gt; consider a frequency to be part of the MBS frequencies of interest if the following conditions are met:
2&gt; at least one MBS session the UE is receiving or interested to receive via a broadcast MRB is ongoing or about to start; and NOTE 1: The UE may determine whether the session is ongoing from the start and stop time indicated in the User
Service Description (USD), see TS 38.300 or TS 23.247 .
2&gt; for at least one of these MBS sessions SIB21 acquired from the PCell includes for the concerned frequency one or more MBS FSAIs as indicated in the USD for this session; and NOTE 2: The UE considers a frequency to be part of the MBS frequencies of interest even though NG-RAN may (temporarily) not employ a broadcast MRB for the concerned session, i.e. the UE does not verify if the session is indicated on MCCH.
2&gt; the supportedBandCombination the UE included in UE-NR-Capability contains at least one band combination including the set of MBS frequencies of interest (i.e. the UE is capable of simultaneously receiving broadcast MRBs on the set of MBS frequencies of interest); NOTE 3: When evaluating whether the UE is capable of simultaneously receiving broadcast MRBs on the set of MBS frequencies of interest, the UE does not take into account the serving frequencies that it is currently configured with i.e. the UE only considers MBS frequencies it is interested to receive regardless of whether these can be received together with the current serving cells or not.
5.9.4.4 MBS services of interest determination
The UE shall:
1&gt; consider an MBS service to be part of the MBS services of interest if the following conditions are met:
2&gt; the UE is receiving or interested to receive this service via a broadcast MRB; and
2&gt; the session of this service is ongoing or about to start; and
2&gt; one or more MBS FSAIs in the USD for this service is included in SIB21 acquired from the PCell for a frequency belonging to the set of MBS frequencies of interest, determined according to 5.9.4.3.
NOTE: The UE may determine whether the session is ongoing from the start and stop time indicated in the User
Service Description (USD), see TS 38.300 or TS 23.247 .
5.9.4.5 Setting of the contents of MBS Interest Indication
The UE shall set the contents of the MBS Interest Indication as follows:
1&gt; if the set of MBS frequencies of interest, determined in accordance with 5.9.4.3, is not empty:
2&gt; include mbs-FreqList and set it to include the MBS frequencies of interest sorted by decreasing order of interest, using the absoluteFrequencySSB for serving frequency, if applicable, and the ARFCN-ValueNR(s) as included in SIB21 (for neighbouring frequencies);
2&gt; include mbs-Priority if the UE prioritises reception of all indicated MBS frequencies above reception of any of the unicast bearers and multicast MRBs; NOTE: If the UE prioritises MBS reception and unicast data cannot be supported because of congestion on the MBS carrier(s), NG-RAN may for example initiate release of unicast bearers.
2&gt; if SIB20 is scheduled by the PCell:
3&gt; include mbs-ServiceList and set it to indicate the set of MBS services of interest sorted by decreasing order of interest determined in accordance with 5.9.4.4.
