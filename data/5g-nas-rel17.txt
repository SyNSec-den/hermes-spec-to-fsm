5 Elementary procedures for 5GS mobility management
5.1 Overview
5.1.1 General
The main function of the 5GS mobility management (5GMM) sublayer is to support the identification, security, mobility of a UE as well as generic message transport.
A further function of the 5GMM sublayer is to provide connection management services to the other sublayer(s).
NOTE: In a satellite NG-RAN access, a GNSS fix time in lower layers can delay transmission of an initial UL NAS message by up to 100 seconds (GNSS cold state).
5.1.2 Types of 5GMM procedures
Depending on how they can be initiated, three types of 5GMM procedures can be distinguished:
<control> <action> 5GMM common procedure can always be initiated </action> <condition> when the UE is in 5GMM-CONNECTED mode. </condition> </control> The procedures belonging to this type are: 1) Initiated by the network: ii) primary authentication and key agreement; iii) security mode control; iv) generic UE configuration update; vi) network slice-specific authentication and authorization;
2) Initiated by the UE: 3) Initiated by the UE or the network and used to report certain error conditions detected upon receipt of 5GMM protocol data:
At any time only one UE initiated 5GMM specific procedure can be running for each of the access network(s) that the UE is camping in. The procedures belonging to this type are: 1) Initiated by the UE and used e.g. to register to the network for 5GS services and establish a 5GMM context, to update the location/parameter(s) of the UE: 2) Initiated by the UE or the network and used to deregister from the network for 5GS services and to release a 5GMM context: 3) Initiated by the UE and used to deregister from the network for 5GS services and to release a 5GMM context: eCall inactivity procedure.
1) Initiated by the UE and used to establish a secure connection to the network or to request the resource reservation for sending data, or both: service request.
<control> <action> The service request procedure can only be initiated </action> <condition> if no UE initiated 5GMM specific procedure is ongoing for each of the access network(s) that the UE is camping in. </condition> </control>
2) Initiated by the network and used to request the establishment of an N1 NAS signalling connection or to request re-establishment of user-plane resources for the PDU session(s) associated with 3GPP access or to request re-establishment of user-plane resources of the PDU session(s) associated with non-3GPP access over 3GPP access; not applicable for the non-3GPP access network:
3) Initiated by the network and used to request re-establishment of user-plane resources of the PDU session(s) associated with non-3GPP access over 3GPP access or to deliver 5GSM downlink signalling messages associated with non-3GPP access over 3GPP access, when the UE is in 5GMM-CONNECTED mode over 3GPP access and in 5GMM-IDLE mode over non-3GPP access or
Initiated by the network and used to request re-establishment of user-plane resources of the PDU session(s) associated with 3GPP access over 3GPP access or to deliver downlink signalling associated with 3GPP access over 3GPP access, when the UE is in 5GMM-CONNECTED mode over non-3GPP access, and when the UE is in 5GMM-IDLE mode over 3GPP access and not in MICO mode:
NOTE 1: <control> <condition> In NB-N1 mode </condition> , <condition> the UE NAS using 5GS services with control plane CIoT 5GS optimization </condition> <action> can wait for the lower layers to complete the transmission of the previous UL NAS TRANSPORT messages carrying control plane user data </action> <condition> before providing subsequent NAS messages. </condition> </control> Other implementations are possible.
NOTE 2: <control> <condition> When providing NAS messages to the lower layers for transmission </condition> , <condition> the UE NAS using 5GS services with control plane CIoT 5GS optimization </condition> <action> can prioritize sending NAS signalling messages over the UL NAS TRANSPORT messages carrying control plane user data. </action> </control> How the UE performs this prioritization is implementation specific.
5.1.3 5GMM sublayer states
5.1.3.1 General
In the following subclauses, the 5GS mobility management (5GMM) sublayer of the UE and the network is described by means of different state machines. The 5GMM sublayer states is managed per access type independently, i.e. 3GPP access or non-3GPP access. In subclause 5.1.3.2, the states of the 5GMM sublayer are introduced.
5.1.3.2 5GMM sublayer states
5.1.3.2.1 5GMM sublayer states in the UE
5.1.3.2.1.1 General
In the following subclauses, the possible 5GMM sublayer states of the UE are described and shown in Figure 5.1.3.2.1.1.1.
NOTE: Not all possible transitions are shown in this figure.
5.1.3.2.1.2 Main states
5.1.3.2.1.2.1 5GMM-NULL
5GS services are disabled in the UE. No 5GS mobility management function shall be performed in this state.
5.1.3.2.1.2.2 5GMM-DEREGISTERED
<control> <start_state> In the state 5GMM-DEREGISTERED </start_state> , <action> no 5GMM context has been established </action> and <action> the UE location is unknown to the network </action> and <action> hence it is unreachable by a network. </action> </control> <control> <condition> In order to establish a 5GMM context </condition> , <action> the UE shall start the initial registration procedure </action> </control> .
5.1.3.2.1.2.3 5GMM-REGISTERED-INITIATED
<control> <end_state> A UE enters the state 5GMM-REGISTERED-INITIATED </end_state> <condition> <condition> after it has started the initial registration procedure </condition> or <condition> the non-initial registration procedure </condition> , and <condition> is waiting for a response from the network. </condition> </condition> </control>
5.1.3.2.1.2.4 5GMM-REGISTERED
<control> <start_state> In the state 5GMM-REGISTERED </start_state> , <condition> a 5GMM context has been established. </condition> Additionally, <condition> one or more PDU session(s) may be established at the UE. </condition> <action> The UE may initiate the non-initial registration procedure (including the normal registration update and periodic registration update) </action> and <action> the service request procedure. </action> </control> <control> <start_state> The UE in the state 5GMM- REGISTERED over non-3GPP access </start_state> <action> shall not initiate the periodic registration update procedure. </action> </control>
5.1.3.2.1.2.5 5GMM-DEREGISTERED-INITIATED
<control> <end_state> A UE enters the state 5GMM-DEREGISTERED-INITIATED </end_state> after <action> it has requested release of the 5GMM context </action> by <condition> <condition> starting the de-registration procedure </condition> and <condition> is waiting for a response from the network. </condition> </condition> </control>
5.1.3.2.1.2.6 5GMM-SERVICE-REQUEST-INITIATED
<control> <start_state> A UE enters the state 5GMM-SERVICE-REQUEST-INITIATED </start_state> after <condition> <condition> it has started the service request procedure </condition> and <condition> is waiting for a response from the network. </condition> </condition> </control>
5.1.3.2.1.3 Substates of state 5GMM-DEREGISTERED
5.1.3.2.1.3.1 General
The state 5GMM-DEREGISTERED is subdivided into a number of substates as described in this subclause. The following substates are not applicable to non-3GPP access:
Valid subscriber data are available for the UE before it enters the substates, except for the substate 5GMM- DEREGISTERED.NO-SUPI.
5.1.3.2.1.3.2 5GMM-DEREGISTERED.NORMAL-SERVICE
<control> <end_state> The substate 5GMM-DEREGISTERED.NORMAL-SERVICE is chosen in the UE </end_state> <condition> <condition> when a suitable cell has been found </condition> and <condition> the PLMN, SNPN, or tracking area is not in the forbidden list. </condition> </condition> </control>
5.1.3.2.1.3.3 5GMM-DEREGISTERED.LIMITED-SERVICE
<control> <end_state> The substate 5GMM-DEREGISTERED.LIMITED-SERVICE is chosen in the UE </end_state> , <condition> <condition> when it is known that a selected cell for 3GPP access or TA for non-3GPP access is unable to provide normal service (e.g. the selected cell over 3GPP access is in a forbidden PLMN or SNPN or is in a forbidden tracking area or TA for non-3GPP access is forbidden) </condition> or <condition> the selected cell is a CAG cell whose CAG ID is not included in the "Allowed CAG list" in the entry of the "CAG information list" for the PLMN </condition> , or <condition> the selected cell is a non-CAG cell in a PLMN for which there exists an "indication that the UE is only allowed to access 5GS via CAG cells" in the entry of the "CAG information list" for the PLMN. </condition> </condition> </control>
5.1.3.2.1.3.4 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION
<control> <end_state> The substate 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION is chosen in the UE </end_state> <condition> <condition> if the initial registration procedure failed </condition> <condition> <condition> due to a missing response from the network </condition> or <condition> due to the circumstances described in subclauses 5.5.1.2.4, 5.5.1.2.5, 5.5.1.2.7 and 5.5.1.3.4. </condition> </condition> </condition> </control>
5.1.3.2.1.3.5 5GMM-DEREGISTERED.PLMN-SEARCH
<control> <end_state> The substate 5GMM-DEREGISTERED.PLMN-SEARCH is chosen in the UE </end_state> , <condition> if the UE is searching for PLMNs or SNPNs. </condition> <action> This substate is left </action> either <condition> <condition> when a cell has been selected (the new substate is NORMAL-SERVICE or LIMITED-SERVICE) </condition> or <condition> when it has been concluded that no cell is available at the moment (the new substate is NO- CELL-AVAILABLE). </condition> </condition> </control>
This substate is not applicable to non-3GPP access.
5.1.3.2.1.3.6 5GMM-DEREGISTERED.NO-SUPI
<control> <end_state> The substate 5GMM-DEREGISTERED.NO-SUPI is chosen in the UE </end_state> , <condition> <condition> if the N1 mode is enabled </condition> and <condition> the UE has no valid subscriber data available (USIM not available, the USIM is considered invalid by the UE or an entry of the "list of subscriber data" with the SNPN identity of the SNPN is considered invalid by the UE). </condition> </condition> </control>
5.1.3.2.1.3.7 5GMM-DEREGISTERED.NO-CELL-AVAILABLE
No 5G cell can be selected. <control> <action> This substate is entered </action> <condition> <condition> after a first intensive search failed </condition> </condition> <condition> when in substate 5GMM- DEREGISTERED.PLMN-SEARCH. </condition> </control> Cells are searched for at a low rhythm. No 5GS services are offered.
This substate is not applicable to non-3GPP access.
5.1.3.2.1.3.8 5GMM-DEREGISTERED.eCALL-INACTIVE
<control> <end_state> The substate 5GMM-DEREGISTERED.eCALL-INACTIVE is chosen in the UE </end_state> <condition> <condition> a) the UE is configured for eCall only mode as specified in 3GPP TS 31.102; </condition> <condition> b) timer T3444 and timer T3445 have expired or are not running; </condition> <condition> c)a PLMN has been selected as specified in 3GPP TS 23.122; </condition> <condition> d)the UE does not need to perform an eCall over IMS; </condition> and <condition> e) the UE does not need to perform a call to a non-emergency MSISDN or URI for test or terminal reconfiguration </condition> </condition> </control>
<control> <condition> In this substate </condition> , <action> the UE shall not initiate any signalling towards the network </action> , except to <action> originate an eCall over IMS </action> , or <action> a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service. </action> </control>
This substate is not applicable to non-3GPP access.
5.1.3.2.1.3.9 5GMM-DEREGISTERED.INITIAL-REGISTRATION-NEEDED
Valid subscriber data are available for the UE and for some reason a registration procedure for initial registration has to be performed as soon as possible. <control> <action> This substate can be entered </action> <condition> <condition> <condition> if the access is barred </condition> <condition> due to unified access control </condition> </condition> , (see subclause 4.5.4) or <condition> if the network rejects the N1 NAS signalling connection establishment. </condition> </condition> </control>
5.1.3.2.1.4 Substates of state 5GMM-REGISTERED
5.1.3.2.1.4.1 General
The state 5GMM-REGISTERED is subdivided into a number of substates as described in this subclause. The following substates are not applicable to non-3GPP access:
5.1.3.2.1.4.2 5GMM-REGISTERED.NORMAL-SERVICE
<control> <end_state> The substate 5GMM-REGISTERED.NORMAL-SERVICE is chosen by the UE </end_state> as the primary substate <condition> <condition> when the UE enters the state 5GMM-REGISTERED </condition> , and: <condition> <condition> a) <condition> for 3GPP access, </condition> <condition> the cell the UE selected is known to be in an allowed area (see subclause 5.3.5.2); </condition> </condition> or <condition> b) <condition> for wireline access, </condition> the wireline access service area restrictions are not enforced. </condition> </condition> </condition> </control>
5.1.3.2.1.4.3 5GMM-REGISTERED.NON-ALLOWED-SERVICE
<control> <end_state> The substate 5GMM-REGISTERED.NON-ALLOWED-SERVICE </end_state> is chosen in the UE, <condition> if: <condition> a) <condition> for 3GPP access, </condition> <condition> the cell the UE selected is known to be in a non-allowed area (see subclause 5.3.5.2); </condition> </condition> or <condition> b) <condition> for wireline access, <condition> </condition> the wireline access service area restrictions are enforced. </condition> </condition> </condition> </control>
This substate is applicable only to 3GPP access and to wireline access.
5.1.3.2.1.4.4 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE
<control> <end_state> The substate 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE is chosen by the UE </end_state> <condition> <condition> <condition> if the registration procedure for mobility and periodic registration update failed </condition> <condition> <condition> due to a missing response from the network </condition> , or <condition> due to the circumstances described in subclauses 5.3.9, 5.5.1.3.5 and 5.5.1.3.7. </condition> </condition> </condition> </condition> </control> No 5GMM procedure except registration procedure for mobility and periodic registration update (i.e. the 5GS registration type IE set to "mobility registration updating" or "periodic registration updating" in the REGISTRATION REQUEST message) and deregistration procedure, shall be initiated by the UE in this substate. No data shall be sent or received.
NOTE 1: The registration procedure for mobility and periodic registration update over non-3GPP access can be triggered by, e.g. the change of S1 UE network capability or renegotiating some parameters.
NOTE 2: This substate is entered irrespective whether: a) the UE is camped on a cell which is in the registered PLMN or a PLMN from the list of equivalent PLMNs and the current TAI is not in the list of "allowed tracking areas"; or b) the current TAI is in the list of "non-allowed tracking areas".
5.1.3.2.1.4.5 5GMM-REGISTERED.LIMITED-SERVICE
<control> <end_state> The substate 5GMM-REGISTERED.LIMITED-SERVICE is chosen in the UE </end_state> , <condition> if the cell the UE selected is known not to be able to provide normal service. </condition> </control>
5.1.3.2.1.4.6 5GMM-REGISTERED.PLMN-SEARCH
<control> <end_state> The substate 5GMM-REGISTERED.PLMN-SEARCH is chosen in the UE </end_state> , <condition> while the UE is searching for PLMNs or SNPNs. </condition> </control>
This substate is not applicable to non-3GPP access.
5.1.3.2.1.4.7 5GMM-REGISTERED.NO-CELL-AVAILABLE
<control> <condition> <condition> 5G coverage has been lost </condition> or <condition> MICO mode is active in the UE. </condition> </condition> <control> <condition> If MICO mode is active </condition> , <action> the UE can deactivate MICO mode at any time by activating the AS layer </action> </control> <control> <condition> when the UE needs to send mobile originated signalling or user data. </condition> </control> </control>
<control> <condition> Otherwise, </condition> <action> the UE shall not initiate any 5GMM procedure <condition> except for cell and PLMN reselection. </condition> </action> </control>
This substate is not applicable to non-3GPP access.
5.1.3.2.1.4.8 5GMM-REGISTERED.UPDATE-NEEDED
<control> <action> This state can be entered </action> <condition> <condition> if the UE has to perform a registration procedure for mobility and periodic registration update </condition> <condition> but: <condition> a) <condition> the access is barred </condition> <condition> due to unified access control <condition> </condition> when in 3GPP access; </condition> </condition> <condition> b) <condition> the network rejects the N1 NAS signalling connection establishment </condition> <condition> when in 3GPP access or in non-3GPP access; </condition> </condition> or <condition> c) <condition> the UE in 5GMM-CONNECTED mode </condition> <condition> with RRC inactive indication </condition> <condition> receives an indication from the lower layers that the resumption of the RRC connection has failed </condition> and <condition> for access is barred for all categories except categories '0' and '2' as specified in subclause 5.3.1.4. </condition> </condition> </condition> </condition> </control>
No 5GMM procedure except: a) registration procedure for mobility and periodic registration update; b) service request procedure as a response to paging or notification; and c) deregistration procedure shall be initiated by the UE in this substate.
NOTE: This substate is entered irrespective whether: a) the UE is camped on a cell which is in the registered PLMN or a PLMN from the list of equivalent PLMNs and the current TAI is not in the list of "allowed tracking areas"; or b) the current TAI is in the list of "non-allowed tracking areas".
5.1.3.2.2 5GS update status in the UE
In order to describe the detailed UE behaviour, the 5GS update (5U) status pertaining to a specific subscriber is defined.
<control> <condition> If the UE is not operating in SNPN access operation mode (see 3GPP TS 23.501 ) </condition> , <action> the 5GS update status is stored in a non-volatile memory in the USIM as described in annex C. </action> </control>
<control> <condition> If the UE is operating in SNPN access operation mode </condition> , <action> the 5GS update status for each SNPN whose SNPN identity is included in the "list of subscriber data" configured in the ME (see 3GPP TS 23.122 ) is stored in the non-volatile memory in the ME </action> </control> as described in annex C.
<control> <action> 5GS update status value is changed </action> <condition> <condition> only after the execution of a registration, network-initiated de-registration , 5GS based primary authentication and key agreement, service request, paging procedure </condition> or <condition> <condition> due to change in the current TAI which does not belong to the current registration area </condition> <condition> while T3346 is running. </condition> </condition> </condition> </control>
5U1: UPDATED
The last registration attempt was successful.
5U2: NOT UPDATED
The last registration or service request attempt failed procedurally, e.g. no response or reject message was received from the AMF.
5U3: ROAMING NOT ALLOWED
The last registration, service request, or registration for mobility or periodic registration update attempt was correctly performed, but the answer from the AMF was negative (because of roaming or subscription restrictions).
5.1.3.2.3 5GMM sublayer states in the network side
5.1.3.2.3.1 General
In the following subclauses, the possible 5GMM sublayer states of the network are described and shown in 5GMM- DEREGISTERED- INITIATED a) Deregistration accepted b) NW-initiated deregistration requested 5GMM-DEREGISTERED 5GMM-REGISTERED c) Common procedure failed d) Lower layer failure e) Common procedure successful f) Initial registration successful 5GMM- COMMON-PROCEDURE- INITIATED NOTE: Not all possible transitions are shown in this figure.
5.1.3.2.3.2 5GMM-DEREGISTERED
<control> <start_state> In the state 5GMM-DEREGISTERED, </start_state> <action> no 5GMM context has been established </action> or <action> the 5GMM context is marked as deregistered. </action> <action> The UE is deregistered. </action> <action> The network may answer to an initial registration procedure initiated by the UE. </action> </control>
The network may also answer to a de-registration procedure initiated by the UE.
5.1.3.2.3.3 5GMM-COMMON-PROCEDURE-INITIATED
<control> <end_state> network enters the state 5GMM-COMMON-PROCEDURE-INITIATED </end_state> , <condition> <condition> after it has started a common 5GMM procedure </condition> and <condition> is waiting for a response from the UE. </condition> </condition> </control>
5.1.3.2.3.4 5GMM-REGISTERED
<control> <start_state> In the state 5GMM-REGISTERED, </start_state> <action> a 5GMM context has been established. </action> Additionally, <action> one or more PDU session(s) may be established at the network. </action> </control>
5.1.3.2.3.5 5GMM-DEREGISTERED-INITIATED
<control> <end_state> The network enters the state 5GMM-DEREGISTERED-INITIATED </end_state> <condition> <condition> after it has started a de-registration procedure </condition> and <condition> is waiting for a response from the UE. </condition> </condition> </control>
5.1.4 Coordination between 5GMM and EMM
5.1.4.1 General
<control> <condition> <condition> If both 5GMM and EMM are enabled, </condition> <condition> a UE, operating in single-registration mode, </condition> </condition> <action> shall maintain one common registration for 5GMM for 3GPP access and EMM. </action> </control>
Coordination between 5GMM for 3GPP access and EMM for a UE, which is capable of N1 mode and S1 mode and operates in dual-registration mode, is not needed, except as specified in subclause 4.8.3.
The coordination between 5GMM for 3GPP access and EMM in subclauses 5.1.4.2 and 5.1.4.3 only applies to the UEs operating in single-registration mode.
Regarding the coordination of "SIM/USIM considered invalid" and "USIM considered invalid for 5GS services" between the various mobility management entities see subclause 5.1.5.
5.1.4.2 Coordination between 5GMM for 3GPP access and EMM with N26 interface
A UE that is not registered shall be in state EMM-DEREGISTERED and state 5GMM-DEREGISTERED for 3GPP access.
<control> <condition> <condition> In N1 mode, </condition> <condition> upon successful completion of a registration procedure over 3GPP access, </condition> <condition> the UE operating in single- registration mode </condition> </condition> <end_state> shall enter substates 5GMM-REGISTERED.NORMAL-SERVICE </end_state> or <end_state> 5GMM-REGISTERED.NON- ALLOWED-SERVICE as describedin subclause 5.3.5.2 for 3GPP access and EMM-REGISTERED.NO-CELL- AVAILABLE. </end_state> <action> The UE shall reset the registration attempt counter for 3GPP access and the attach attempt counter (see 3GPP TS 24.301 ). </action> </control>
<control> <condition> At inter-system change from S1 mode to N1 mode, </condition> <end_state> the UE shall enter substates 5GMM-REGISTERED.NORMAL- SERVICE </end_state> or <end_state> 5GMM-REGISTERED.NON-ALLOWED-SERVICE </end_state> as described in subclause 5.3.5.2 </control> <control> <condition> for 3GPP access and EMM-REGISTERED.NO-CELL-AVAILABLE </condition> <action> initiate a registration procedure for mobility and periodic registration update over 3GPP access </action> <action> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message (see subclause 5.5.1.3). </action> </control>
<control> <condition> <condition> In S1 mode, </condition> <condition> upon successful completion of an attach or tracking area updating procedure, </condition> <condition> the UE operating in single- registration mode </condition> </condition> <end_state> shall enter substates 5GMM-REGISTERED.NO-CELL-AVAILABLE for 3GPP access </end_state> and <end_state> EMM- REGISTERED.NORMAL-SERVICE. </end_state> <action> The UE shall reset the registration attempt counter for 3GPP access and the attach attempt counter or tracking area updating attempt counter (see 3GPP TS 24.301 ). </action> </control>
<control> <condition> <condition> At inter-system change from N1 mode to S1 mode </condition> <condition> when there is no active PDU session for which interworking with EPS is supported </condition> as specified in subclause 6.1.4.1, and <condition> EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> </condition> the UE <end_state> shall enter state 5GMM-DEREGISTERED </end_state> for 3GPP access and <end_state> state EMM- DEREGISTERED </end_state> and <action> then initiate the EPS attach procedure. </action> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> the UE <end_state> shall enter substates EMM-REGISTERED.NORMAL-SERVICE </end_state> and <end_state> 5GMM-REGISTERED.NO-CELL-AVAILABLE for 3GPP access </end_state> and <action> initiate a tracking area updating procedure. </action> </control>
<control> <condition> <condition> At inter-system change from N1 mode to S1 mode </condition> <condition> when there is no active PDU session for which interworking with EPS is supported </condition> as specified in subclause 6.1.4.1, and <condition> EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED for 3GPP access </end_state> and <end_state> state EMM- DEREGISTERED </end_state> and <action> theninitiate the EPS attach procedure. </action> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> <end_state> the UE shall enter substates EMM-REGISTERED.NORMAL-SERVICE </end_state> and <end_state> 5GMM-REGISTERED NO-CELL-AVAILABLE </end_state> for 3GPP access and <action> initiate a tracking area updating procedure. </action> </control>
<control> <condition> <condition> At inter-system change from N1 mode to S1 mode </condition> <condition> when there is at least one active PDU session for which interworking with EPS is supported </condition> </condition> as specified in subclause 6.1.4.1, <end_state> the UE shall enter substates EMM-REGISTERED.NORMAL- SERVICE </end_state> and <end_state> 5GMM-REGISTERED.NO-CELL-AVAILABLE </end_state> for 3GPP access and <action> initiate a tracking area updating procedure (see 3GPP TS 24.301 ). </action> </control>
5.1.4.3 Coordination between 5GMM for 3GPP access and EMM without N26 interface
<control> <condition> <condition> A UE operating in the single-registration mode </condition> <condition> that is not registered over 3GPP access </condition> </condition> <end_state> shall be in state EMM- DEREGISTERED </end_state> and <end_state> in state 5GMM-DEREGISTERED for 3GPP access. </end_state> </control>
<control> <condition> <condition> In N1 mode, </condition> <condition> upon successful completion of a registration procedure over 3GPP access, </condition> <condition> the UE operating in the single- registration mode </condition> </condition> <end_state> shall enter substates 5GMM-REGISTERED.NORMAL-SERVICE </end_state> or <end_state> 5GMM-REGISTERED.NON- ALLOWED-SERVICE </end_state> as described in subclause 5.3.5.2 for 3GPP access and <end_state> EMM-REGISTERED.NO-CELL- AVAILABLE. </end_state> </control>
At inter-system change from N1 mode to S1 mode in 5GMM-IDLE mode, the UE shall behave as specified in subclause 4.8.2.3.
<control> <condition> <condition> In S1 mode, </condition> <condition> upon successful completion of an attach or tracking area updating procedure, </condition> <condition> the UE operating in the single-registration mode </condition> </condition> <end_state> shall enter substates 5GMM-REGISTERED.NO-CELL-AVAILABLE </end_state> 3GPP access and <end_state> EMM-REGISTERED.NORMAL-SERVICE. </end_state> </control>
<control> <condition> <condition> At inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, </condition> <condition> the UE operating in the single-registration mode </condition> </condition> <end_state> shall enter substates EMM-REGISTERED.NO-CELL-AVAILABLE </end_state> and <end_state> 5GMM- REGISTERED. NORMAL- SERVICE </end_state> for 3GPP access and <action> theninitiate the registration procedure for mobility and periodic registration update over 3GPP access </action> <action> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message (see subclause 5.5.1.3). </action> </control>
5.1.5 Coordination between 5GMM and GMM
Coordination between 5GMM and GMM states is not required.
Regardless whether the UE is operating in single-registration mode or dual-registration mode,
5.2 Behaviour of the UE in state 5GMM-DEREGISTERED and state 5GMM-REGISTERED
5.2.1 General
In this subclause, the detailed behaviour of the UE in the states 5GMM-DEREGISTERED and 5GMM-REGISTERED is described.
5.2.2 UE behaviour in state 5GMM-DEREGISTERED
5.2.2.1 General
<control> <end_state> The state 5GMM-DEREGISTERED is entered in the UE, </end_state> <condition> a) the de-registration is performed either by the UE or by the network </condition> (see subclause 5.5.2); <condition> b) the registration request is rejected by the AMF </condition> (see subclause 5.5.1.2.5 and 5.5.1.3.5); <condition> c) the service request is rejected by the AMF </condition> (see subclause 5.6.1); <condition> d) the UE is switched on ; </condition> or <condition> e) <condition> the UE registered for emergency services is in 5GMM-IDLE mode </condition> and <condition> its periodic registration update timer expires </condition> </condition> (see subclause 5.3.7). </control>
In state 5GMM-DEREGISTERED, the UE shall behave according to the substate as explained in subclause 5.2.2.3.
5.2.2.2 Primary substate selection
5.2.2.2.1 Selection of the substate after power on
For a UE configured for eCall only mode as specified in 3GPP TS 31.102 , timers T3444 and T3445 are considered to have expired at power on. <control> <condition> When the UE is switched on, </condition> <start_state> the substate shall be PLMN-SEARCH </start_state> <condition> <condition> <condition> if the USIM is available </condition> and <condition> valid </condition> </condition> or <condition> there are valid entries in the "list of subscriber data". </condition> </condition> </control> See 3GPP TS 23.122 for further details.
The substate chosen after PLMN-SEARCH, following power on is:
<control> <condition> a) if no cell can be selected, </condition> <end_state> the substate shall be NO-CELL-AVAILABLE; </end_state> </control>
<control> <condition> b) <condition> if the UE is not operating in SNPN access operation mode, </condition> and <condition> <condition> no USIM is present </condition> , or <condition> the USIM is considered invalid by the UE, </condition> </condition> </condition> <end_state> the substate shall be NO-SUPI; </end_state> </control>
<control> <condition> c) if the UE is operating in SNPN access operation mode, </condition> and: <condition> <condition> 1) <condition> the selected entry in the "list of subscriber data" does not contain subscription identifier, </condition> and <condition> <condition> no USIM is present, </condition> or <condition> the USIM is considered invalid by the UE; </condition> </condition> </condition> or <condition> 2) no valid entry in the "list of subscriber data" exists; </condition> </condition> <end_state> the substate shall be NO-SUPI; </end_state> </control>
<control> <condition> d) <condition> if a suitable cell has been found, </condition> <condition> the PLMN or SNPN identity of the cell is not in one of the forbidden PLMN lists, "permanently forbidden SNPNs" list or the "temporarily forbidden SNPNs" list </condition> <condition> which are, <condition> if the MS supports access to an SNPN using credentials from a credentials holder, </condition> associated with the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> and <condition> the tracking area is not in one of the lists of 5GS forbidden tracking areas, </condition> </condition> <end_state> then the substate shall be NORMAL-SERVICE; </end_state> </control>
<control> <condition> e) if the selected cell is known not to be able to provide normal service, </condition> then <end_state> the UE shall enter the substate LIMITED-SERVICE; </end_state> </control>
<control> <condition> f) <condition> if the UE is in manual network selection mode </condition> and <condition> no cell of the selected PLMN or SNPN has been found, </condition> </condition> <end_state> the UE shall enter the substate NO-CELL-AVAILABLE; </end_state> </control> and
<control> <condition> g) if the UE is configured for eCall only mode </condition> as specified in 3GPP TS 31.102 , <end_state> the substate shall be eCALL- INACTIVE. </end_state> </control>
5.2.2.3 Detailed description of UE behaviour in state 5GMM-DEREGISTERED
<control> <action> The UE shall initiate an initial registration procedure </action> <condition> <condition> if the timer T3346 is not running. </condition> <condition> timer T3346 is running, </condition> </condition> <action> the UE shall initiate an initial registration procedure on the expiry of timer T3346. </action> </control>
<control> <action> UE may initiate an initial registration procedure for emergency services </action> or <action> for a UE configured for high priority access in the selected PLMN, </action> <condition> even if timer T3346 is running. </condition> </control>
<control> <action> The UE shall initiate an initial registration procedure </action> <condition> when entering a cell which provides normal service. </condition> </control>
The UE may initiate initial registration for emergency services.
<control> <condition> UE in 3GPP access: </condition> </control>
<control> a) <action> shall initiate an initial registration procedure </action> <condition> on the expiry of timers T3502, T3511 or T3346; </condition> </control>
<control> b) <action> may initiate an initial registration procedure for emergency services </action> <condition> even if timers T3502, T3511 or T3346 are running; </condition> </control>
<control> b1) <action> may initiate an initial registration procedure </action> <condition> even if timer T3502, T3346 or T3447 is running, </condition> <condition> if the UE is a UE configured for high priority access in selected PLMN; </condition> </control>
<control> c) <action> shall initiate an initial registration procedure when entering a new PLMN or SNPN, </action> <condition> <condition> <condition> except i) if timer T3346 is running </condition> and <condition> the new PLMN is equivalent to the PLMN where the UE started timer T3346; </condition> </condition> </condition> <condition> ii) <condition> <condition> if the PLMN identity of the new cell is in the forbidden PLMN lists </condition> or <condition> the SNPN identity of the new cell is in the "permanently forbidden SNPNs" list </condition> or <condition> the "temporarily forbidden SNPNs" list which are, if the MS supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the "list of subscriber data" or the selected PLMN subscription; </condition> </condition> or iii) <condition> if the current TAI is in one of the lists of 5GS forbidden tracking areas; </condition> </condition> </control>
<control> d) <action> shall initiate an initial registration procedure </action> <condition> <condition> when the current TAI has changed, </condition> <condition> if timer T3346 is not running, </condition> <condition> PLMN identity of the new cell is not in one of the forbidden PLMN lists </condition> </condition> </control> or <control> <condition> <condition> the SNPN identity of the new cell is in neither the "permanently forbidden SNPNs" list nor the "temporarily forbidden SNPNs" list </condition> which are, <condition> <condition> if the MS supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> and <condition> the current TAI is not in one of the lists of 5GS forbidden tracking areas; </condition> </condition> </condition> </control>
<control> e) <action> shall initiate an initial registration procedure </action> <condition> <condition> if the 5GS update status is set to 5U2 NOT UPDATED, </condition> and <condition> timers T3511, T3502 and T3346 are not running; </condition> </condition> </control>
<control> f) <action> may initiate an initial registration procedure for UE </action> <condition> <condition> in NB-N1 mode </condition> <condition> upon receiving a request from upper layers to transmit user data related to an exceptional event </condition> </condition> </control> <control> <action> the UE is allowed to use exception data reporting </action> (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 ) <condition> if timer T3346 is not already running for "MO exception data" </condition> and <condition> even if timer T3502 or timer T3511 is running; </condition> </control> and
<control> g) <action> may initiate an initial registration procedure </action> <action> with 5GS registration type IE set to "initial registration" initiating of an emergency PDU session, </action> <condition> upon request of the upper layers to establish the emergency PDU </condition> </control>
<control> <condition> The UE in non-3GPP access: </condition> </control>
<control> a) <action> shall initiate an initial registration procedure </action> <condition> on the expiry of timers T3502, T3511 or T3346; </condition> </control>
<control> b) <action> may initiate an initial registration procedure for emergency services </action> <condition> even if timers T3502, T3511 or T3346 are running; </condition> </control>
<control> b1) <action> may initiate an initial registration procedure </action> <condition> even if timer T3502 or T3346 is running </condition> <condition> if the UE is a UE configured for high priority access in selected PLMN; </condition> </control>
<control> c) <action> shall initiate an initial registration procedure when entering a new PLMN, </action> <condition> except <condition> if timer T3346 is running </condition> and <condition> the new PLMN is equivalent to the PLMN where the UE started timer T3346; </condition> </condition> </control>
<control> d) <action> shall initiate an initial registration procedure </action> <condition> <condition> if the 5GS update status is set to 5U2 NOT UPDATED, </condition> and <condition> timers T3511, T3502 and T3346 are not running; </condition> </condition> </control> and
<control> e) <action> may initiate an initial registration procedure with 5GS registration type IE set to "initial registration" for initiating of an emergency PDU session, upon request of the upper layers to establish the emergency PDU. </action> </control>
<control> <action> The UE shall perform PLMN selection or SNPN selection. </action> <condition> If a new PLMN or SNPN is selected, </condition> <action> UE shall reset the registration attempt counter </action> and <action> initiate the registration procedure for initial registration </action> </control> (see subclause 5.5.1.2.2).
<control> <condition> If the selected cell in the new PLMN is known not to be able to provide normal service, </condition> <action> the UE may initiate the registration procedure for initial registration for emergency services. </action> </control>
<control> <action> The UE may initiate the registration procedure for initial registration for emergency services. </action> </control>
<control> <action> The UE shall perform cell selection </action> and <action> choose an appropriate substate </action> <condition> when a cell is found. </condition> </control>
<control> <action> The UE camps on a suitable cell or an acceptable cell in a PLMN selected as specified in 3GPP TS 23.122 </action> but <action> initiates no 5GMM signalling with the network </action> and <action> ignores any paging requests. </action> </control>
<control> <end_state> The UE shall leave substate 5GMM-DEREGISTERED.eCALL-INACTIVE state </end_state> </control> only when one of the following events occur:
<control> <condition> a) if the USIM is removed, </condition> <end_state> UE enters substate 5GMM-DEREGISTERED.NO-SUPI; </end_state> </control>
<control> b) <condition> if coverage is lost, </condition> <end_state> the UE enters substate 5GMM-DEREGISTERED.PLMN-SEARCH; </end_state> </control>
<control> <condition> c) if the UE is deactivated (e.g. powered off) by the user, </condition> <end_state> the UE enters state 5GMM-NULL; </end_state> </control>
<control> <condition> d) if the UE receives a request from upper layers to establish an eCall over IMS, </condition> <end_state> the UE enters state 5GMM- DEREGISTERED. ATTEMPTING-REGISTRATION. </end_state> <action> The UE then uses the relevant 5GMM and 5GSM procedures to establish the eCall over IMS at the earliest opportunity; </action> </control> or
<control> <condition> e) if the UE receives a request from upper layers to establish a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service, </condition> <end_state> the UE enters state 5GMM- DEREGISTERED.ATTEMPTING-REGISTRATION. </end_state> <condition> Once the registration procedure is completed, </condition> <action> the UE uses the relevant 5GMM and 5GSM procedures to establish the non-emergency call. </action> </control>
<control> <action> The UE shall initiate the initial registration procedure, </action> <condition> if still needed, </condition> <condition> as soon as the access is allowed in the selected cell for the UE. </condition> </control>
<control> <action> The UE may initiate registration procedure for emergency services. </action> </control>
5.2.2.4 Substate when back to state 5GMM-DEREGISTERED from another 5GMM state
<control> <condition> When returning to state 5GMM-DEREGISTERED, </condition> <action> the UE shall select a cell as specified in 3GPP TS 38.304 or 3GPP TS 36.304 . </action> </control>
The substate depends on the result of the cell selection procedure, the outcome of the previously performed 5GMM specific procedures, on the 5GS update status of the UE, on the tracking area data stored in the UE, on the presence of the USIM, on the UE configuration and on the reason for moving to 5GMM-DEREGISTERED:
<control> <condition> a) <condition> If no cell has been found, </condition> <end_state> the substate is NO-CELL-AVAILABLE, </end_state> <condition> until a cell is found; </condition> </condition> </control>
<control> <condition> b) <condition> If no USIM is present </condition> or <condition> if the inserted USIM is considered invalid by the UE, </condition> </condition> <end_state> the substate shall be NO-SUPI; </end_state> </control>
<control> <condition> c) <condition> If a suitable cell has been found </condition> and <condition> the PLMN or tracking area is not in one of the forbidden lists, </condition> </condition> <end_state> the substate shall be NORMAL-SERVICE; </end_state> </control>
<control> <condition> d) If an initial registration shall be performed </condition> (e.g. network-requested re-registration), <end_state> the substate shall be ATTEMPTING-REGISTRATION; </end_state> </control>
<control> <condition> e) If a PLMN reselection or SNPN reselection (according to 3GPP TS 23.122 ) is needed, </condition> <end_state> the substate shall be PLMN-SEARCH; </end_state> </control>
<control> <condition> f) If the selected cell is known not to be able to provide normal service, </condition> <end_state> the substate shall be LIMITED-SERVICE; </end_state> </control> and
<control> <condition> g) <condition> If the UE is configured for eCall only mode </condition> as specified in 3GPP TS 31.102 , <condition> T3444 and T3445 have expired or are not running, </condition> and <condition> substate PLMN-SEARCH is not required, </condition> </condition> <end_state> the substate shall be eCALL- INACTIVE. </end_state> </control>
5.2.3 UE behaviour in state 5GMM-REGISTERED
5.2.3.1 General
The state 5GMM-REGISTERED is entered at the UE, when the initial registration procedure is performed by the UE (see subclause 5.5.1.2.2).
In state 5GMM-REGISTERED, the UE shall behave according to the substate as explained in subclause 5.2.3.2.
5.2.3.2 Detailed description of UE behaviour in state 5GMM-REGISTERED
The UE:
<control> a) <action> shall initiate the mobility or the periodic registration update procedure </action> (according to conditions given in subclause 5.5.1.3.2), <condition> except that the periodic registration update procedure shall not be initiated over non-3GPP access; </condition> </control>
<control> b) <action> shall initiate the service request procedure </action> (according to conditions given in subclause 5.6.1); </control>
<control> c) <action> shall respond to paging; </action> </control>
<control> <condition> d) if configured for eCall only mode as specified in 3GPP TS 31.102, </condition> <action> shall perform the eCall inactivity procedure at expiry of timer T3444 or timer T3445 </action> (see subclause 5.5.3); </control> and
<control> e) <action> shall initiate a registration procedure for mobility and periodic registration update </action> <condition> on the expiry of timer T3511. </condition> </control>
NOTE 1: Paging is not supported over non-3GPP access.
NOTE 2: As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.
The UE shall behave as specified in subclause 5.3.5.
<control> <end_state> The UE in 5GMM-REGISTERED.NON-ALLOWED-SERVICE substate, </end_state> <condition> if configured for eCall only mode </condition> as specified in 3GPP TS 31.102 , <action> shall perform the eCall inactivity procedure at expiry of timer T3444 or timer T3445 </action> (see subclause 5.5.3). </control>
<control> <condition> The UE in 3GPP access: </condition> </control>
<control> a) <action> shall not send any user data; </action> </control>
<control> b) <action> shall initiate a registration procedure for mobility and periodic registration update </action> <condition> on the expiry of timers T3502, T3511 or T3346; </condition> </control>
<control> c) <action> shall initiate a registration procedure for mobility and periodic registration update </action> <condition> <condition> when entering a new PLMN, </condition> <condition> <condition> timer T3346 is running </condition> and <condition> the new PLMN is not equivalent to the PLMN where the UE started timer T3346, </condition> </condition> <condition> the PLMN identity of the new cell is not in the forbidden PLMN lists, </condition> and <condition> the current TAI is not in one of the lists of 5GS forbidden tracking areas; </condition> </condition> </control>
<control> d) <action> shall initiate a registration procedure for mobility and periodic registration update </action> <condition> <condition> when the current TAI has changed, </condition> <condition> if timer T3346 is not running, </condition> <condition> PLMN identity of the new cell is not in one of the forbidden PLMN lists </condition> or <condition> the SNPN identity of the new cell is in neither the "permanently forbidden SNPNs" list nor the "temporarily forbidden SNPNs" list which are, </condition> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, </condition> <condition> associated with the selected entry of the "list of subscriber data" orthe selected PLMN subscription, </condition> and <condition> the current TAI is not in one of the lists of 5GS forbidden tracking areas; </condition> </condition> </control>
<control> e) <action> may initiate a registration procedure for mobility and periodic registration update </action> <condition> upon request of the upper layers to establish an emergency PDU session; </condition> </control>
<control> e1) <action> may initiate a registration procedure for mobility and periodic registration update </action> <condition> upon request of the upper layers to establish a PDU session, </condition> <condition> even if timer T3502, T3346 or T3447 is running, </condition> <condition> if the UE is a UE configured for high priority access in the selected PLMN; </condition> </control>
<control> f) <action> may perform de-registration locally </action> and <action> initiate a registration procedure for initial registration for emergency services </action> <condition> even if timer T3346 is running; </condition> </control>
<control> g) <action> shall initiate registration procedure for mobility and periodic registration update </action> <condition> upon reception of paging, </condition> or <condition> <condition> upon reception of NOTIFICATION message </condition> <condition> with access type indicating 3GPP access; </condition> </condition> NOTE: As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication. </control>
<control> g) <action> shall initiate registration procedure for mobility and periodic registration update </action> <condition> upon reception of paging, </condition> or <condition> <condition> upon reception of NOTIFICATION message </condition> <condition> with access type indicating 3GPP access; </condition> </condition> </control> As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.
<control> g) <action> shall initiate registration procedure for mobility and periodic registration update </action> <condition> upon reception of paging, </condition> or <condition> <condition> upon reception of NOTIFICATION message </condition> <condition> with access type indicating 3GPP access; </condition> </condition> NOTE: As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication. </control>
<control> h) <action> may initiate a registration procedure for mobility and periodic registration update </action> <condition> <condition> upon request for an MMTEL voice call, MMTEL video call, </condition> or <condition> an MO IMS registration related signalling from the upper layers, </condition> and <condition> <condition> none of the following conditions is met: </condition> <condition> 2) <condition> the UE has stored a list of "non-allowed tracking areas" </condition> and <condition> the current TAI is in the list of "non-allowed tracking areas"; </condition> </condition> or <condition> 3) <condition> the UE has stored a list of "allowed tracking areas", </condition> <condition> the UE is camped on a cell which is in the registered PLMN or a PLMN from the list of equivalent PLMNs, </condition> and <condition> the current TAI is not in the list of "allowed tracking areas"; </condition> </condition> </condition> </condition> </control>
<control> i) <action> shall initiate a registration procedure for mobility and periodic registration update </action> <condition> if the 5GS update status is set to 5U2 NOT UPDATED, </condition> and <condition> timers T3511, T3502 and T3346 are not running; </condition> </control>
<control> <condition> j) if configured for eCall only mode </condition> as specified in 3GPP TS 31.102 , <action> shall perform the eCall inactivity procedure at expiry of timer T3444 or timer T3445 </action> (see subclause 5.5.3); </control>
<control> k) <action> may initiate a registration procedure for mobility and periodic registration update </action> <condition> <condition> for UE in NB-N1 mode </condition> <condition> upon receiving a request from upper layers to transmit user data related to an exceptional event </condition> and <condition> the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 ) </condition> <condition> if timer T3346 is not already running for "MO exception data" </condition> and <condition> even if timer T3502 or timer T3511 is running; </condition> </condition> </control> and
<control> l) <action> shall not initiate the de-registration signalling procedure </action> <condition> unless the current TAI is part of the TAI list. </condition> </control>
<control> <condition> The UE in non-3GPP access: </condition> </control>
<control> a) <action> shall not send any user data; </action> </control>
<control> b) <action> shall initiate the registration procedure for mobility and periodic registration update </action> <condition> on the expiry of timers T3502, T3511 or T3346; </condition> </control>
<control> c) <action> may initiate a registration procedure for mobility registration update </action> <condition> upon request of the upper layers to establish an emergency PDU session; </condition> </control>
<control> c1) <action> may initiate a registration procedure for mobility and periodic registration update </action> <condition> upon request of the upper layers to establish a PDU session, </condition> <condition> if the UE is a UE configured for high priority access in the selected PLMN </condition> <condition> even if timer T3346 or T3502 is running; </condition> </control>
<control> d) <action> may perform de-registration locally </action> and <action> initiate a registration procedure for initial registration for emergency services </action> <condition> even if timer T3346 is running; </condition> </control>
<control> e) <action> may initiate a registration procedure for mobility and periodic registration update </action> <condition> <condition> upon request for an MMTEL voice call, MMTEL video call, or an MO IMS registration related signalling from the upper layers, </condition> <condition> if timer T3346 is not running; </condition> </condition> </control>
<control> f) <action> shall initiate a registration procedure for mobility and periodic registration update </action> <condition> if the 5GS update status is set to 5U2 NOT UPDATED, </condition> and <condition> timers T3511, T3502 and T3346 are not running; </condition> </control> and
<control> g) <action> shall not initiate the de-registration signalling procedure </action> <condition> unless timer T3346 is running. </condition> </control>
The UE:
<control> a) <action> shall perform cell selection/reselection; </action> </control>
<control> b) <action> may perform de-registration locally </action> and <action> initiate an initial registration for emergency services; </action> </control> and
<control> <condition> c) if configured for eCall only mode </condition> as specified in 3GPP TS 31.102 , <action> shall perform the eCall inactivity procedure at expiry of timer T3444 or timer T3445 (see subclause 5.5.3). </action> </control>
<control> <action> The UE shall perform PLMN selection or SNPN selection. </action> <condition> If a new PLMN is selected, </condition> <action> the UE shall reset the registration attempt counter </action> and <action> initiate a registration procedure for mobility </action> and <action> periodic registration update </action> (see subclause 5.5.1.3). <condition> If a new SNPN is selected, </condition> <action> the UE shall reset the registration attempt counter, </action> <action> may perform de-registration locally </action> and <action> shall initiate a registration procedure for initial registration (see subclause 5.5.1.2.2). </action> </control>
<control> <condition> If the selected cell in the new PLMN is known not to be able to provide normal service, </condition> <action> the UE may perform de-registration locally </action> and <action> initiate an initial registration for emergency services. </action> </control>
<control> <action> The UE shall perform cell selection </action> and <action> choose an appropriate substate when a cell is found. </action> </control>
The UE:
a) shall not send any user data;
b) shall not send signalling information, unless it is a service request as a response to paging or to initiate signalling for emergency services or emergency services fallback;
c) shall perform cell selection/reselection;
d) shall enter the appropriate new substate as soon as the lower layers indicate that the barring is alleviated for the access category with which the access attempt for the registration procedure for mobility and periodic registration update was associated; and
<control> <condition> e) if configured for eCall only mode </condition> as specified in 3GPP TS 31.102 , <action> shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 </action> (see subclause 5.5.3). </control>
5.3 General on elementary 5GMM procedures
5.3.1 5GMM modes and N1 NAS signalling connection
5.3.1.1 Establishment of the N1 NAS signalling connection
<control> <condition> <condition> When the UE is in 5GMM-IDLE mode over 3GPP access </condition> and <condition> needs to transmit an initial NAS message, </condition> </condition> <action> the UE shall request the lower layer to establish an RRC connection. </action> </control> <control> <condition> Upon indication from the lower layers that the RRC connection has been established, </condition> <action> the UE shall consider that the N1 NAS signalling connection over 3GPP access is established </action> and <action> enter 5GMM-CONNECTED mode over 3GPP access. </action> </control>
<control> <condition> <condition> When the UE is in 5GMM-IDLE mode over non-3GPP access, </condition> and <condition> the UE receives an indication from the lower layers of non-3GPP access, that the access stratum connection is established between the UE and the network, </condition> </condition> <action> the UE shall send an initial NAS message, </action> <action> consider the N1 NAS signalling connection is established </action> and <action> enter 5GMM- CONNECTED mode over non-3GPP access. </action> </control>
Initial NAS messages are: a) REGISTRATION REQUEST message; b) DEREGISTRATION REQUEST message; c) SERVICE REQUEST message; and d) CONTROL PLANE SERVICE REQUEST.
<control> <condition> <condition> If the UE is capable of both N1 mode and S1 mode </condition> and <condition> lower layers provide an indication that the current E-UTRA cell is connected to both EPC and 5GCN, </condition> </condition> for the routing of the REGISTRATION REQUEST message during the initial registration procedure to the appropriate core network (EPC or 5GCN), <action> the UE NAS provides the lower layers with the selected core network type information. </action> </control>
<control> <condition> <condition> For the routing of the initial NAS message to the appropriate AMF, </condition> <condition> if the UE holds a 5G-GUTI or 4G-GUTI, </condition> </condition> </control> the UE NAS provides the lower layers with the UE identity according to the following rules:
<control> a) <condition> <condition> if the registration procedure for mobility and periodic update was triggered </condition> <condition> due to the last CONFIGURATION UPDATE COMMAND message </condition> <condition> containing the Configuration update indication IE with the Registration bit set to "registration requested" </condition> and <condition> including: 1) no other parameters; 2) one or both of the Allowed NSSAI IE and the Configured NSSAI IE; or 3) the Network slicing indication IE </condition> <condition> with the Network slicing subscription change indication set to "Network slicing subscription changed"; </condition> </condition> <action> the UE NAS shall not provide the lower layers with the 5G-S-TMSI or the registered GUAMI; </action> </control>
<control> <condition> b) if the service request procedure was initiated over non-3GPP access, </condition> <action> the UE NAS shall provide the lower layers with the registered GUAMI, </action> but <action> shall not provide the lower layers with the 5G-S-TMSI; </action> </control>
<control> <condition> c) if the initial NAS message other than the SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message was initiated over untrusted non-3GPP access, </condition> <action> the UE NAS shall provide the lower layers with the GUAMI of the 5G-GUTI that the UE NAS has selected as specified in the subclause 5.5.1.2.2 and 5.5.1.3.2, </action> but <action> shall not provide the lower layers with the 5G-S-TMSI; </action> </control>
<control> <condition> if the initial NAS message other than the SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message was initiated over trusted non-3GPP access, </condition> <action> the UE NAS shall provide the lower layers with the 5G- GUTI, if available, </action> </control> <control> <condition> otherwise </condition> <action> shall provide the lower layers with the SUCI; </action> </control>
<control> <condition> <condition> if the UE is the 5G-RG </condition> and <condition> the initial NAS message other than the SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message was initiated over wireline access, </condition> </condition> <action> the UE NAS shall provide the lower layers with the GUAMI of the 5G-GUTI that the UE NAS has selected as specified in the subclause 5.5.1.2.2 and 5.5.1.3.2, if available, </action> </control> <control> <condition> otherwise </condition> <action> shall not provide the lower layers with any UE identity; </action> </control>
<control> <condition> d) if the UE does not hold a 5G-GUTI that was previously assigned by the same PLMN with which the UE is performing the registration procedure </condition> and <condition> if: <condition> 1) <condition> the UE operating in the single-registration mode <condition> <condition> performs a registration procedure for mobility and periodic update </condition> <condition> indicating "mobility registration updating" following an inter-system change from S1 mode to N1 mode; </condition> </condition> or <condition> 2) the UE which was previously registered in S1 mode before entering state EMM-DEREGISTERED, </condition> </condition> </condition> </condition> <action> performs an initial registration procedure, </action> </control> <control> <condition> <condition> the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network, </condition> and <condition> the UE holds a 4G-GUTI; </condition> </condition> <action> then the UE NAS provides the lower layers with a GUAMI part of the 5G-GUTI mapped from 4G-GUTI as specified in 3GPP TS 23.003 with an indication that the GUAMI is mapped from EPS; </action> </control> or
<control> <condition> e) otherwise: </condition> </control>
<control> 1) <condition> if the tracking area of the current cell is in the registration area, </condition> <action> the UE NAS shall provide the lower layers with the 5G-S-TMSI, </action> but shall not provide the registered GUAMI to the lower layers; </control> or
<control> 2) <condition> if the tracking area of the current cell is not in the registration area, </condition> <action> the UE NAS shall provide the lower layers with the GUAMI of the 5G-GUTI that the UE NAS has selected as specified in the subclauses 5.5.1.2.2 and 5.5.1.3.2, </action> but <action> shall not provide the lower layers with the 5G-S-TMSI. </action> </control>
<control> <condition> For 3GPP access and untrusted non-3GPP access, <condition> <condition> if the UE does not hold a 5G-GUTI </condition> and <condition> the UE does not hold a 4G- GUTI, </condition> </condition> </condition> <action> the UE NAS does not provide the lower layers with the 5G-S-TMSI or the registered GUAMI. </action> </control> <control> <condition> For trusted non- 3GPP access, <condition> <condition> if the UE does not hold a 5G-GUTI </condition> and <condition> the UE does not hold a 4G-GUTI, </condition> </condition> </condition> <action> the UE NAS provides the lower layers with the SUCI. </action> </control>
<control> <action> The UE NAS also provides the lower layers with the identity of the selected PLMN (see 3GPP TS 38.331 ) </action> <condition> if the UE is not operating in SNPN access operation mode. </condition> </control> <control> <condition> If the UE is operating in SNPN access operation mode, </condition> <action> the UE NAS provides the lower layers with the SNPN identity of the selected SNPN. </action> </control> <control> <condition> In a shared network, </condition> <action> the UE shall choose one of the PLMN identity(ies) or SNPN identity(ies) as specified in 3GPP TS 23.122. </action> </control>
he UE NAS layer may provide the lower layers with an NSSAI as specified in subclause 4.6.2.3. T
<control> <condition> <condition> If the UE performs initial registration for onboarding services in SNPN </condition> or <condition> is registered for onboarding services in SNPN, </condition> </condition> <action> the UE NAS layer shall provide the lower layers with an indication that the connection is for onboarding. </action> </control>
5.3.1.2 Re-establishment of the N1 NAS signalling connection
<control> <condition> <condition> When the UE <condition> in 5GMM-CONNECTED mode over 3GPP access </condition> <condition> receives a fallback indication from lower layers, </condition> </condition> and <condition> the UE has no pending NAS procedure </condition> and <condition> no pending uplink user data for PDU session(s) with user-plane resources already established, </condition> </condition> </control> the UE shall:
<control> a) <action> enter 5GMM-IDLE mode; </action> </control> and
<control> b) <action> initiate the registration procedure for mobility and periodic registration update </action> and <action> include the Uplink data status IE in the REGISTRATION REQUEST message </action> <action> indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclause 5.5.1.3 for further details). </action> </control>
<control> <condition> When the UE <condition> in 5GMM-CONNECTED mode over 3GPP access </condition> <condition> receives a fallback indication from lower layers, </condition> and <condition> <condition> the UE has pending uplink user data for PDU session(s) with user-plane resources already established </condition> but <condition> no pending NAS procedure, </condition> </condition> </condition> </control> UE shall:
<control> a) <action> enter 5GMM-IDLE mode; </action> </control> and
<control> b) <action> initiate the service request procedure </action> and <action> include the Uplink data status IE in the SERVICE REQUEST message indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication (see subclause 5.6.1 for further details). </action> </control>
<control> <condition> <condition> When the UE <condition> in 5GMM-CONNECTED mode over 3GPP access </condition> <condition> receives a fallback indication from lower layers, </condition> </condition> and <condition> the UE has a pending registration procedure, a service request procedure, or a de-registration procedure, </condition> </condition> </control> the UE shall:
<control> a) <action> enter 5GMM-IDLE mode; </action> </control> and
<control> <action> b) proceed with the pending procedure; </action> </control> and
<control> <condition> c) <condition> if the pending procedure is a service request or registration procedure </condition> and <condition> the SERVICE REQUEST message, the CONTROL PLANE SERVICE REQUEST message or the REGISTRATION REQUEST message does not include UE request type IE with Request type value set to "NAS signalling connection release", </condition> </condition> <action> the UE shall include the Uplink data status IE in the SERVICE REQUEST message, or in the REGISTRATION REQUEST message, </action> <action> indicating the PDU session(s) for which user-plane resources were not active prior to receiving a fallback indication from the lower layers </action> and <action> the UE has pending user data to be sent over 3GPP access, if any, </action> and <action> the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclauses 5.5.1.3 and 5.6.1 for further details). </action> </control>
<control> <condition> <condition> When the UE <condition> in 5GMM-CONNECTED mode over 3GPP access </condition> <condition> receives a fallback indication from lower layers, </condition> </condition> and <condition> the UE has a pending NAS procedure other than a registration procedure, a service request procedure, or a de-registration procedure, </condition> </condition> </control> the UE shall:
<control> a) <action> enter 5GMM-IDLE mode; </action> </control> and
<control> b) <action> initiate the service request procedure </action> and <action> include the Uplink data status IE in the SERVICE REQUEST message </action> <action> indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclause 5.6.1 for further details); </action> </control> and
<control> <condition> c) upon successful service request procedure completion, </condition> <action> proceed with any pending procedure. </action> </control>
<control> <condition> When the UE <condition> in 5GMM-CONNECTED mode over 3GPP access </condition> <condition> receives a fallback indication from lower layers, </condition> and <condition> the UE has no pending NAS procedure and no pending uplink user data for PDU session(s) with user-plane resources already established, </condition> and <condition> the UE was using network resources for 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5 (see 3GPP TS 23.304 ), </condition> </condition> </control> the UE shall:
<control> a) <action> enter 5GMM-IDLE mode; </action> </control> and
<control> b) <action> initiate the service request procedure </action> and <action> include the Uplink data status IE in the SERVICE REQUEST message </action> <action> indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclause 5.6.1 for further details). </action> </control>
The cases above apply when the UE is in an allowed area or when the UE is not in a non-allowed area.
<control> <condition> When the UE: <condition> a) is in a non-allowed area or is not in an allowed area; </condition> <condition> b) is in 5GMM-CONNECTED mode over 3GPP access; </condition> <condition> c) receives a fallback indication from lower layers; </condition> and <condition> d) does not have signalling pending, </condition> </condition> the UE shall: <action> a) enter 5GMM-IDLE mode; </action> and <action> b) initiate the registration procedure for mobility and periodic registration update. </action> <control> <action> The UE shall not include the Uplink data status IE in the REGISTRATION REQUEST message </action> <condition> except <condition> if the PDU session for which user- plane resources were active is an emergency PDU session, </condition> or <condition> if the UE is configured for high priority access in the selected PLMN. </condition> </condition> </control> </control>
<control> <condition> <condition> In the above cases when the UE receives a fallback indication from lower layers, </condition> <condition> if the UE is in non-allowed area or not in allowed area, </condition> </condition> <action> the UE shall behave as specified in subclause 5.3.5. </action> </control>
5.3.1.3 Release of the N1 NAS signalling connection
The signalling procedure for the release of the N1 NAS signalling connection is initiated by the network.
<control> <condition> <condition> In N1 mode, </condition> <condition> upon indication from lower layers that the access stratum connection has been released, </condition> </condition> <action> the UE shall enter 5GMM-IDLE mode </action> and <action> consider the N1 NAS signalling connection released. </action> </control>
<control> <condition> <condition> If the UE in 3GPP access </condition> <condition> is configured for eCall only mode </condition> as specified in 3GPP TS 31.102 </condition> </control> then: <control> <condition> a) if the N1 NAS signalling connection that was released had been established for eCall over IMS, </condition> <action> the UE shall start timer T3444; </action> </control> and <control> <condition> b) <condition> if the N1 NAS signalling connection that was released had been established for a call to an HPLMN designated non-emergency MSISDN </condition> or <condition> URI for test or terminal reconfiguration service, </condition> </condition> <action> the UE shall start timer T3445. </action> </control>
<control> <action> The UE shall start the timer T3447 </action> <condition> if not already running when the N1 NAS signalling connection is released as specified in subclause 5.3.17. </condition> </control>
<control> <condition> To allow the network to release the N1 NAS signalling connection, </condition> </control> the UE:
<control> a) <action> shall start the timer T3540 </action> <condition> <condition> if the UE receives any of the 5GMM cause value #62, #72, #73, #74, #75, #76 </condition> and <condition> the UE does not consider the received 5GMM cause value as abnormal case as specified in subclauses 5.5.1.2.7, 5.5.1.3.7 and 5.5.2.3.4; </condition> </condition> </control>
<control> b) <action> shall start the timer T3540 for a UE in 3GPP access </action> </control> if:
<control> 1) <condition> <condition> the UE receives a REGISTRATION ACCEPT message </condition> <condition> which does not include a Pending NSSAI IE or UE radio capability ID deletion indication IE; </condition> </condition> </control>
<control> 2) <condition> the UE has set the Follow-on request indicator to "No follow-on request pending" in the REGISTRATION REQUEST message; </condition> </control>
<control> 3) <condition> <condition> the UE has not included the Uplink data status IE in the REGISTRATION REQUEST message, </condition> or <condition> <condition> the UE has included the Uplink data status IE in the REGISTRATION REQUEST message </condition> but <condition> the REGISTRATION ACCEPT message indicates that no user-plane resources of any PDU sessions are to be re- established; </condition> </condition> </condition> </control>
<control> 4) <condition> <condition> the UE has not included the Allowed PDU session status IE </condition> or <condition> <condition> has included the Allowed PDU session status IE </condition> <condition> indicating there is no PDU session(s) for which the UE allowed the user-plane resource to be re- established over 3GPP access in the REGISTRATION REQUEST message, </condition> </condition> or <condition> <condition> the UE has included the Allowed PDU session status IE in the REGISTRATION REQUEST message </condition> but <condition> the REGISTRATION ACCEPT message does not indicate that any user-plane resources of any PDU sessions are to be re- established; </condition> </condition> </condition> </control>
<control> 5) <condition> <condition> the registration procedure has been initiated in 5GMM-IDLE mode, </condition> or <condition> the UE has set Request type to "NAS signalling connection release" in the UE request type IE in the REGISTRATION REQUEST message </condition> and <condition> the N1 NAS signalling connection release bit is set to "N1 NAS signalling connection release supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message; </condition> </condition> </control>
<control> 6) <condition> <condition> <condition> the user-plane resources for PDU sessions have not been set up, </condition> <condition> except for the case the UE has set Request type to "NAS signalling connection release" in the UE request type IE in the REGISTRATION REQUEST message </condition> </condition> and <condition> the N1 NAS signalling connection release bit is set to "N1 NAS signalling connection release supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message; </condition> </condition> </control>
<control> 7) <condition> the UE need not request resources for V2X communication over PC5 reference point (see 3GPP TS 23.287 ); </condition> </control> and
<control> 8) <condition> the UE need not request resources for 5G ProSe direct discovery over PC5 </condition> or <condition> 5G ProSe direct communication over PC5 (see 3GPP TS 23.304 ); </condition> </control> NOTE 1: The lower layers indicate when the user-plane resources for PDU sessions are successfully established or
<control> c) <action> shall start the timer T3540 </action> <condition> <condition> if the UE receives a REGISTRATION REJECT message </condition> <condition> indicating: the 5GMM cause value #9 or #10; </condition> </condition> </control>
<control> d) <action> shall start the timer T3540 </action> <condition> <condition> <condition> if the UE receives a SERVICE REJECT message </condition> <condition> indicating: the 5GMM cause value #9, #10;or the 5GMM cause value #28 </condition> and <condition> with no emergency PDU session has been established; </condition> </condition> </condition> </control>
<control> e) <action> shall start the timer T3540 </action> </control> if:
<control> 1) <condition> <condition> <condition> the UE receives a CONFIGURATION UPDATE COMMAND message </condition> <condition> containing the Configuration update indication IE with the Registration bit set to "registration requested" </condition> and <condition> with: i) either new allowed NSSAI information or new configured NSSAI information or both included; ii) the network slicing subscription change indication; or iii) no other parameters; </condition> </condition> </condition> </control>
<control> 2) <condition> the user-plane resources for PDU sessions have not been set up; </condition> </control> and
<control> f) <action> shall start the timer T3540 for a UE in 3GPP access </action> </control> if:
<control> 1) <action> the UE receives a SERVICE ACCEPT message; </action> </control>
<control> 2) <condition> for the case that the UE sent the: <condition> <condition> i) <condition> SERVICE REQUEST message, </condition> <condition> <condition> the UE did not set the Service type IE to "signalling" or "high priority access", </condition> <condition> the UE has not included the Uplink data status IE in the SERVICE REQUEST message, </condition> or <condition> <condition> the UE has included the Uplink data status IE in the SERVICE REQUEST message </condition> but <condition> the SERVICE ACCEPT message indicates that no user-plane resources of any PDU sessions are to be re-established; </condition> </condition> </condition> </condition> or <condition> <condition> ii) <condition> CONTROL PLANE SERVICE REQUEST message, </condition> <condition> the UE did not set the Control plane service type IE to "emergency services fallback", </condition> <condition> the UE has not included the Uplink data status IE in the CONTROL PLANE SERVICE REQUEST message, </condition> or </condition> <condition> the UE has included the Uplink data status IE in the CONTROL PLANE SERVICE REQUEST message </condition> but <condition> the SERVICE ACCEPT message indicates that no user-plane resources of any PDU sessions are to be re-established; </condition> </condition> </condition> </condition> </control>
<control> 3) <condition> <condition> the UE has not included the Allowed PDU session status IE </condition> or <condition> has included the Allowed PDU session status IE indicating there is no PDU session(s) for which the UE allowed the user-plane resource to be re- established over 3GPP access in the SERVICE REQUEST message </condition> or <condition> the CONTROL PLANE SERVICE REQUEST message, </condition> or <condition> the UE has included the Allowed PDU session status IE in the SERVICE REQUEST message </condition> or <condition> the CONTROL PLANE SERVICE REQUEST message </condition> </condition> </control> but the SERVICE ACCEPT message does not indicate that any user-plane resources of any PDU sessions are to be re-established;
<control> 4) <condition> the service request procedure has been initiated in 5GMM-IDLE mode; </condition> </control>
<control> 5) <condition> the user-plane resources for PDU sessions have not been set up; </condition> </control>
<control> 6) <condition> the UE need not request resources for V2X communication over PC5 reference point (see 3GPP TS 23.287 ); </condition> </control> and
<control> 7) <condition> the UE need not request resources for 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5 (see 3GPP TS 23.304 ); </condition> NOTE 2: The lower layers indicate when the user-plane resources for PDU sessions are successfully established </control> or
<control> g) <action> may start the timer T3540 </action> <condition> <condition> if the UE receives any of the 5GMM cause values #3 or #6 </condition> or <condition> if it receives an AUTHENTICATION REJECT message; </condition> </condition> </control>
<control> h) <action> shall start the timer T3540 </action> <condition> <condition> upon completion of the configuration update procedure or the registration procedure </condition> <condition> if the UE does not have an emergency PDU session </condition> </condition> </control> and:
<control> 1) <condition> <condition> <condition> the UE received a CONFIGURATION UPDATE COMMAND message ora REGISTRATION ACCEPT message </condition> <condition> while camping on a CAG cell </condition> </condition> and <condition> the entry for the current PLMN in the received "CAG information list" does not include any of the CAG-ID(s) supported by the current CAG cell; </condition> </condition> </control>
<control> 2) <condition> <condition> <condition> the UE received a CONFIGURATION UPDATE COMMAND message or a REGISTRATION ACCEPT message </condition> <condition> while camping on a non-CAG cell </condition> </condition> and <condition> the entry for the current PLMN in the received "CAG information list" includes an "indication that the UE is only allowed to access 5GS via CAG cells"; </condition> </condition> </control> or
<control> 3) <condition> <condition> <condition> the UE received a CONFIGURATION UPDATE COMMAND message </condition> <condition> while camping on a CAG cell </condition> </condition> and <condition> the entry for the current PLMN in not included in the received "CAG information list"; </condition> </condition> </control> or
<control> i) <action> shall start the timer T3540 for a UE in 3GPP access </action> if: <condition> <condition> 1) the UE receives a SERVICE ACCEPT message; </condition> <condition> 2) the UE: <condition> a) has set Request type to "NAS signalling connection release" in the UE request type IE in the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message; </condition> or b) <condition> has set Request type to "Rejection of paging" in the UE request type IE in the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message </condition> and <condition> the UE receives a CONFIGURATION UPDATE COMMAND message; </condition> </condition> </condition> </control>
<control> j) <action> shall start the timer T3540 </action> <condition> <condition> if the UE receives the 5GMM cause value #22 along with a T3346 value, </condition> and <condition> the value indicates that the timer T3346 is neither zero nor deactivated </condition> and <condition> the NAS procedure has been initiated in 5GMM-IDLE mode; </condition> </condition> </control>
<control> k) <action> shall start the timer T3540 </action> <condition> if the UE receives a DEREGISTRATION ACCEPT message. </condition> </control>
<control> <condition> In case a), </condition> <control> <condition> a) upon receiving a request from the upper layers to perform emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, </condition> <action> the UE shall stop timer T3540 </action> and <action> shall locally release the N1 NAS signalling connection, before proceeding as specified in subclause 5.5.1. </action> </control> </control>
<control> <condition> In case b) and f), </condition> <control> <condition> a) upon an indication from the lower layers that the user-plane resources for PDU sessions are set up, </condition> <action> the UE shall stop timer T3540 </action> and <action> may send uplink signalling via the existing N1 NAS signalling connection or user data via user plane. </action> </control> <control> <condition> If the uplink signalling is associated with emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, </condition> <action> the UE shall stop timer T3540 </action> and <action> send the uplink signalling via the existing N1 NAS signalling connection; </action> </control> </control>
<control> <condition> In case b), f) and i), </condition> <control> <condition> a) upon receipt of a DEREGISTRATION REQUEST message, </condition> <action> the UE shall stop timer T3540 </action> and <action> respond to the network-initiated de-registration request via the existing N1 NAS signalling connection as specified in subclause 5. 5.2.3; </action> </control> <control> <condition> b) upon receipt of a message of a network-initiated 5GMM common procedure, </condition> <action> the UE shall stop timer T3540 </action> and <action> respond to the network-initiated 5GMM common procedure via the existing N1 NAS signalling connection as specified in subclause 5.4; </action> </control> <control> <condition> c) <condition> if there is no user-plane resources established for PDU sessions, </condition> <condition> upon receiving a request from the upper layers to perform emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, </condition> </condition> <action> the UE shall stop timer T3540 </action> and <action> shall locally release the N1 NAS signalling connection, before proceeding as specified in subclause 5.6.1; </action> </control> <control> <condition> d) <condition> if there is no user-plane resources established for PDU sessions, </condition> <condition> upon receiving a request from the upper layers to perform services other than emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, </condition> </condition> <action> the UE shall wait for the local release of the established N1 NAS signalling connection upon expiry of timer T3540 </action> or <action> wait for timer T3540 being stopped, <condition> before initiating NAS signalling; </condition> </action> </control> <control> <condition> e) upon receipt of a DL NAS TRANSPORT message, </condition> <action> the UE shall stop timer T3540 </action> and <action> may send uplink signalling via the existing N1 NAS signalling connection; </action> </control> <control> <condition> f) upon initiation of registration procedure for mobility and periodic registration update as specified in subclause 5.5.1.2.7 </condition> <condition> for cases h), i), j), subclause 5.5.1.3.7 for cases j), k) or subclause 5.5.1.3.2 for case a), </condition> <action> the UE shall stop timer T3540. </action> </control> </control>
<control> <condition> In case c) and d), </condition> <control> <condition> a) upon an indication from the lower layers that the access stratum connection has been released, </condition> <action> the UE shall stop timer T3540 </action> and <action> perform a new registration procedure as specified in subclause 5.5.1.3.5 or 5.6.1.5. </action> </control> <control> <condition> b) upon receiving a request from the upper layers to perform emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, </condition> <action> the UE shall stop timer T3540 </action> and <action> shall locally release the N1 NAS signalling connection, before proceeding as specified in subclause 5.5.1. </action> </control> </control>
<control> <condition> In case e), </condition> <control> <condition> a) upon an indication from the lower layers that the access stratum connection has been released, </condition> <action> the UE shall stop timer T3540 </action> and <action> perform a new registration procedure as specified in subclause 5.5.1.3.2. </action> </control> <control> <condition> b) upon an indication from the lower layers that the user-plane resources for PDU sessions are set up, </condition> <action> the UE shall stop timer T3540 </action> and <action> may send user data via user plane. </action> <control> NOTE 3: <condition> In this case, </condition> <action> the new registration procedure is performed </action> <condition> when the UE moves to the 5GMM-IDLE mode. </condition> </control> </control> <control> <condition> c) upon receiving a request from the upper layers to perform emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, </condition> <action> the UE shall stop timer T3540 </action> and <action> shall locally release the N1 NAS signalling connection, before proceeding as specified in subclause 5.5.1. </action> </control> </control>
<control> <condition> <condition> <condition> <condition> If the UE had set the Follow-on request indicator to "Follow-on request pending" in the REGISTRATION REQUEST message </condition> <condition> due to pending uplink signalling </condition> </condition> but <condition> <condition> cannot send the pending signalling </condition> <condition> <condition> due to new service area restrictions received </condition> or <condition> due to network not supporting the feature as indicated in the REGISTRATION ACCEPT message (for example UE set the "Follow-on request pending" to send SMS over NAS but AMF notified "SMS over NAS not allowed") </condition> </condition> </condition> </condition> and <condition> if there is no further pending data or signalling </condition> and <condition> user plane resources have not been set up, </condition> </condition> <action> the UE may locally release the established N1 NAS signalling connection upon completion of the registration procedure. </action> </control>
NOTE 4: the UE is allowed to inform the lower layers that there is no 5GMM or 5GSM messages need to be sent over non-3GPP access if the UE receives a REGISTRATION REJECT message over non-3GPP access or a SERVICE REJECT message over non-3GPP access.
<control> <condition> <condition> If the timer T3540 is not running </condition> <condition> when the UE enters state 5GMM-DEREGISTERED.PLMN-SEARCH or 5GMM- REGISTERED.PLMN-SEARCH, </condition> </condition> <action> the UE may locally release the N1 NAS signalling connection. </action> </control>
5.3.1.4 5GMM-CONNECTED mode with RRC inactive indication
This subclause is only applicable for UE's 5GMM mode over 3GPP access. <control> <action> The 5GMM-CONNECTED mode with RRC inactive indication is not supported </action> <condition> when the UE is in NB-N1 mode. </condition> </control>
<control> <action> The UE is in 5GMM-CONNECTED mode with RRC inactive indication </action> <condition> when the UE is in: a) 5GMM-CONNECTED mode over 3GPP access at the NAS layer; and b) RRC_INACTIVE state at the AS layer (see 3GPP TS 38.300 ). </condition> </control>
<control> Unless stated otherwise, the UE behaviour in 5GMM-CONNECTED mode with RRC inactive indication follows the UE behaviour in 5GMM-CONNECTED over 3GPP access, except that: <condition> a) the UE shall apply the mobility restrictions; </condition> and <condition> b) the UE shall perform the PLMN selection procedures as in 5GMM-IDLE mode over 3GPP access. </condition> </control>
<control> <action> The UE shall transition from 5GMM-CONNECTED mode over 3GPP access to 5GMM-CONNECTED mode with RRC inactive indication </action> <condition> upon receiving an indication from the lower layers that the RRC connection has been suspended. </condition> </control>
NOTE 1: Any pending procedure or uplink data packet when receiving an indication from the lower layers that the RRC connection has been suspended, triggers a request to the lower layers to transition to RRC_CONNECTED state. This is also the case when the pending procedure or uplink data packet triggered a previous request to the lower layers to transition to RRC_CONNECTED state.
<control> <condition> Upon: <condition> a) a trigger of a procedure which requires sending of a NAS message different from a REGISTRATION REQUEST message with the NG-RAN-RCU bit of the 5GS update type IE set to "UE radio capability update needed"; </condition> <condition> b) an uplink user data packet to be sent for a PDU session with suspended user-plane resources; </condition> <condition> c)a trigger to request resources for 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5; </condition> <condition> d) <condition> a trigger to request resources for V2X communication over PC5 (see 3GPP TS 23.287 ); </condition> <condition> the UE in 5GMM-CONNECTED mode </condition> <condition> with RRC inactive indication over 3GPP access </condition> </condition> </condition> <action> shall request the lower layers to transition to RRC_CONNECTED state (see 3GPP TS 38.300 ). </action> </control>
NOTE 2: <control> <condition> If the UE supports Small Data Transmission (SDT) (see 3GPP TS 38.300 ), </condition> </control> the following applies:
<control> <condition> a) <condition> if the UE due to pending uplink NAS messages </condition> or <condition> user data packets is requesting the lower layers to transition to RRC_CONNECTED state, </condition> <condition> but has not received a response from the lower layers, </condition> </condition> <action> the UE can send the pending NAS messages or user data packets to the lower layers, </action> and <action> can receive multiple downlink NAS messages or multiple downlink user data packets from the lower layers </action> </control> <control> <condition> <condition> while the UE remains in 5GMM-CONNECTED mode </condition> <condition> with RRC inactive indication over 3GPP access (i.e., without transitioning to 5GMM-CONNECTED mode). </condition> <condition> When the NAS layer triggers the transmission of pending uplink NAS messages </condition> or <condition> user data packets, </condition> and <condition> if the SDT is ongoing, </condition> </condition> <action> the NAS layer will receive the response from the lower layers </action> </control> <control> <condition> only after the SDT session has completed or failed; </condition> </control>
<control> <condition> b) <condition> the NAS layer is not aware of the classification of NAS messages </condition> or <condition> <condition> the user data packets as belonging to the SDT session at the lower layers; </condition> and <condition> completed or failed; </condition> </condition> </condition> </control>
<control> <condition> c) <condition> the setting of access category and the RRC establishment cause indicated to the lower layers </condition> <condition> when sending the pending uplink user data packets </condition> <condition> while the UE remains in 5GMM-CONNECTED mode with RRC inactive indication, </condition> </condition> <action> is left to implementation. </action> </control>
<control> <condition> <condition> Upon a trigger to send a REGISTRATION REQUEST message with the NG-RAN-RCU bit of the 5GS update type IE set to "UE radio capability update needed", </condition> <condition> the UE in 5GMM-CONNECTED mode with RRC inactive indication </condition> </condition> <action> shall move to 5GMM-IDLE mode over 3GPP access </action> and <action> proceed with the registration procedure for mobility and periodic registration as specified in subclause 5.5.1.3.2. </action> </control>
<control> <action> The UE shall transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-CONNECTED mode over 3GPP access </action> <condition> upon receiving an indication from the lower layers that the UE has transitioned to RRC_CONNECTED state (see 3GPP TS 38.300 ). </condition> </control>
NOTE 3: The AMF can be aware of the transition between 5GMM-CONNECTED mode and 5GMM- CONNECTED mode with RRC inactive indication for a UE (see 3GPP TS 23.502 ).
<control> <action> The UE shall trigger a transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode </action> <condition> upon selection of a PLMN that is not an equivalent PLMN to the registered PLMN. </condition> </control> <control> <action> The UE shall not trigger a transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode </action> <condition> upon entering a new PLMN which is in the list of equivalent PLMNs. </condition> </control>
<control> <action> The UE shall trigger a transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode </action> <condition> upon receiving REFRESH command from the UICC as specified in subclause 5.4.5.3.3. </condition> </control>
<control> <condition> If the UE <condition> in 5GMM-CONNECTED mode with RRC inactive indication </condition> receives an indication from the lower layers that the RRC connection has been suspended, </condition> <action> the UE shall stay in 5GMM-CONNECTED mode with RRC inactive indication. </action> <action> The UE shall re-initiate any pending procedure that had triggered the request to the lower layers to transition to RRC_CONNECTED state, </action> </control>
<control> <condition> <condition> When the UE <condition> in 5GMM-CONNECTED mode with RRC inactive indication </condition> receives a fallback indication from lower layers, </condition> and <condition> the UE has no pending NAS procedure and no pending uplink user data for PDU session(s) with user-plane resources already established, </condition> </condition> </control> the UE shall:
<control> a) <action> enter 5GMM-IDLE mode; </action> </control> and
<control> b) <action> initiate the registration procedure for mobility and periodic registration update as specified for case o) in subclause 5.5.1.3.2. </action> </control>
<control> <condition> If the UE requests the lower layers to transition to RRC_CONNECTED state at initiation of a registration procedure, a service request procedure or a de-registration procedure, upon fallback indication from lower layers, </condition> </control> the UE shall: <control> <action> a) enter 5GMM-IDLE mode; </action> </control>
<control> b) <action> proceed with the pending procedure; </action> </control> and <control> <condition> c) <condition> if the pending procedure is a service request or registration request procedure </condition> and <condition> the SERVICE REQUEST message, the CONTROL PLANE SERVICE REQUEST message or the REGISTRATION REQUEST message does not include UE request type IE with Request type value set to "NAS signalling connection release", </condition> </condition> <action> the UE shall include the Uplink data status IE in the SERVICE REQUEST message, the CONTROL PLANE SERVICE REQUEST message or in the REGISTRATION REQUEST message, indicating the PDU session(s) without active user-plane resources for which the UE has pending user data to be sent, if any, </action> and <action> the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclauses 5.5.1.3 and 5.6.1 for further details). </action> </control>
<control> <condition> <condition> If the UE requests the lower layers to transition to RRC_CONNECTED state for other reason than initiation of a registration procedure, </condition> or <condition> for other reason than a service request procedure, </condition> or <condition> for other reason than a de-registration procedure, upon fallback indication from lower layers, </condition> </condition> </control> UE shall:
<control> 2) <action> initiate the service request procedure </action> and <action> include the Uplink data status IE in the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message </action> <action> indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclause 5.6.1 for further details). </action> <condition> <condition> If the procedure that triggered the request to the lower layers to transition to RRC_CONNECTED state is the UE- initiated NAS transport procedure </condition> and <condition> the UE had SMS, location services message, or CIoT user data to send, </condition> </condition> <action> the UE shall also include the SMS, location services message, or CIoT user data in the CONTROL PLANE SERVICE REQUEST message as described in subclause 5.6.1.2.2; </action> </control> and
<control> 3) <condition> upon successful service request procedure completion, </condition> <action> proceed with any pending procedure. </action> </control>
<control> <condition> <condition> If the UE <condition> in 5GMM-CONNECTED mode with RRC inactive indication </condition> receives a fallback indication from lower layers, </condition> and <condition> the UE has pending uplink user data for PDU session(s) with user-plane resources already established but no pending NAS procedure, </condition> </condition> the UE shall: <control> 2) <action> initiate the service request procedure </action> and <action> include the Uplink data status IE in the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message </action> <action> indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication (see subclause 5.6.1 for further details). </action> </control> </control>
<control> <condition> <condition> In the above cases </condition> <condition> when the UE receives a fallback indication from lower layers, </condition> <condition> if the UE is in non-allowed area or not in allowed area, </condition> </condition> <action> the UE shall behave as specified in subclause 5.3.5. </action> </control>
<control> <condition> If the UE <condition> in 5GMM-CONNECTED mode with RRC inactive indication </condition> receives an indication from the lower layers that the resumption of the RRC connection has failed, </condition> </control> and:
<control> <condition> a) if the lower layers indicate that access barring is applicable for all access categories except categories 0 and 2, </condition> or <condition> access barring is applicable for all access categories except category 0, </condition> </control> the UE shall:
<control> <action> 1) stay in 5GMM-CONNECTED mode with RRC inactive indication; </action> </control>
<control> 2) <action> initiate the registration procedure for mobility and periodic registration update used for mobility (i.e. the 5GS registration type IE set to "mobility registration updating" in the REGISTRATION REQUEST message) for N1 NAS signalling connection recovery as specified for case f) in subclause 5.5.1.3.2. </action> </control>
NOTE 4: An indication from the lower layer that the RRC connection has been released with cause "RRC resume failure" can be considered as an indication that the resumption of the RRC connection has failed.
<control> <action> The UE shall transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode over 3GPP access </action> <condition> upon receiving from the lower layers: a) indication of transition from RRC_INACTIVE state to RRC_IDLE state; </condition> </control> or <control> <condition> b) indication of cell selection to E-UTRAN or another RAT that the UE supports. </condition> </control>
<control> <condition> If the UE <condition> in 5GMM-CONNECTED mode with RRC inactive indication </condition> receives an indication from the lower layers about the cell (re-)selection to different RAT that the UE supports, </condition> <action> the UE shall initiate the registration procedure for mobility or periodic registration update used for mobility (i.e. the 5GS registration type IE set to "mobility registration updating" in the REGISTRATION REQUEST message) as specified in subclause 5.5.1.3.2. </action> </control>
<control> <condition> <condition> If the UE <condition> in 5GMM-CONNECTED mode with RRC inactive indication </condition> receives an indication from the lower layers of a transition from RRC_INACTIVE state to RRC_IDLE state </condition> and <condition> 5GMM-REGISTERED.LIMITED-SERVICE is entered, </condition> </condition> <condition> <condition> the UE shall subsequently upon entering state 5GMM-REGISTERED. NORMAL-SERVICE </condition> and <condition> if there is no uplink user data or signalling pending, </condition> </condition> <action> initiate the registration procedure for mobility and periodic registration update used for mobility (i.e. the 5GS registration type IE set to "mobility registration updating" in the REGISTRATION REQUEST message) for N1 NAS signalling connection recovery as specified in subclause 5.5.1.3.2. </action> </control>
<control> <condition> <condition> If the UE <condition> in 5GMM-CONNECTED mode with RRC inactive indication </condition> receives an indication from the lower layers about RAN paging </condition> and <condition> the MUSIM UE decides not to initiate the service request procedure with service type set to mobile terminated services to respond to the RAN paging, </condition> </condition> <action> the UE may initiate the service request procedure </action> and <action> set request type to "NAS signalling connection release" in the UE request type IE </action> and <action> service type to "signalling" in the SERVICE REQUEST message <condition> to reject the RAN paging as specified in subclause 5.6.1.2 for case o of subclause 5.6.1.1. </condition> </action> <action> The UE may include its paging restriction preferences in the Paging restriction IE in the SERVICE REQUEST message as specified in subclause 5.6.1.2 for case o of subclause 5.6.1.1. </action> </control>
NOTE 5: The interworking between the NAS layer and the AS layer triggered by RAN paging is up to UE
NOTE 6: As an implementation option, the MUSIM UE is allowed to not respond to RAN paging based on the information available in the paging message, e.g. voice service indication.
<control> <condition> Upon receiving AMF paging indication from the lower layers, </condition> <action> the UE shall transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode over 3GPP access </action> and <action> handle the AMF paging same as the paging request received in the 5GMM-IDLE mode over 3GPP access as specified in subclause 5.6.1. </action> </control>
5.3.1.5 Suspend and resume of the N1 NAS signalling connection
<control> <action> Suspend of the N1 NAS signalling connection can be initiated by the network <condition> in 5GMM-CONNECTED mode </condition> </action> <condition> when user plane CIoT 5GS optimization is used. </condition> Resume of the suspended N1 NAS signalling connection is initiated by the UE. </control>
<control> <condition> In the UE, when user plane CIoT 5GS optimization is used: </condition> <control> <condition> a) Upon idle suspend indication from the lower layers, </condition> <action> the UE shall enter 5GMM-IDLE mode with suspend indication, </action> <action> shall not consider the N1 NAS signalling connection released </action> and <action> shall not consider the secure exchange of NAS messages terminated (see subclause 4.4.2.5 and 4.4.5). </action> </control> <control> <condition> b) Upon trigger of a procedure using an initial NAS message when in 5GMM-IDLE mode with suspend indication, </condition> the UE shall: <control> <condition> i) if the initial NAS message is a REGISTRATION REQUEST message with the NG-RAN-RCU bit of the 5GS update type IE set to "UE radio capability update needed", </condition> <action> enter 5GMM-IDLE mode without suspend indication <action> and </action> proceed with the registration procedure; </action> </control> or <control> ii) <condition> otherwise, </condition> <action> request the lower layer to resume the RRC connection. </action> </control> </control> </control>
NOTE 1: In NB-N1 mode, in the request to the lower layer the data volume information of the initial NAS message is provided to the lower layers. Interactions between the NAS and the lower layers in order to obtain the data volume information of the initial NAS message (see 3GPP TS 36.321 , 3GPP TS 36.331 ) is left to implementations.
<control> <condition> a) Upon indication from the lower layers that the RRC connection has been resumed </condition> <condition> when in 5GMM-IDLE mode with suspend indication, </condition> <action> the UE shall enter 5GMM-CONNECTED mode. </action> If the pending NAS message is: <condition> i) <condition> a SERVICE REQUEST message, </condition> <condition> the service type IE is not set to "emergency services fallback", </condition> and <condition> the UE did not include the NAS message container IE in the SERVICE REQUEST message; </condition> </condition> or <condition> ii) <condition> a CONTROL PLANE SERVICE REQUEST message, </condition> and <condition> the UE did not include the CIoT small data container IE or the NAS message container IE in the CONTROL PLANE SERVICE REQUEST message, </condition> </condition> <action> the message shall not be sent. </action> </control> <control> <condition> Otherwise </condition> <action> the UE shall cipher the message as specified in subclause 4.4.5 </action> and <action> send the pending initial NAS message </action> <condition> upon entering 5GMM-CONNECTED mode; </condition> </control>
NOTE 2: <control> <condition> If a NAS message is discarded and not sent to the network, </condition> the uplink NAS COUNT value corresponding to that message is reused for the next uplink NAS message to be sent. </control>
<control> <condition> a) <condition> Upon fallback indication from the lower layers at RRC connection resume </condition> <condition> when in 5GMM-IDLE mode with suspend indication, </condition> </condition> <action> the UE shall enter 5GMM-IDLE mode without suspend indication, </action> <action> send any pending initial NAS message </action> and <action> proceed as if RRC connection establishment had been requested; </action> </control> <control> <condition> b) <condition> Upon indication from the lower layers that the RRC connection resume has failed </condition> and <condition> indication from the lower layers that the RRC connection is suspended, </condition> </condition> <action> the UE shall enter 5GMM-IDLE mode with suspend indication </action> and <action> restart the ongoing NAS procedure if required; </action> </control> and <control> <condition> c) <condition> Upon indication from the lower layers that the RRC connection resume has failed </condition> and <condition> indication from the lower layers that the RRC connection is not idle suspended, </condition> </condition> <action> the UE shall enter 5GMM-IDLE mode without suspend indication </action> and <action> restart the ongoing NAS procedure if required. </action> </control>
<control> In the network, <condition> when user plane CIoT 5GS optimization is used: </condition> </control> <control> <condition> a) Upon idle suspend indication from the lower layers, </condition> <action> the network shall enter 5GMM-IDLE mode with suspend indication, </action> <action> shall not consider the N1 NAS signalling connection released </action> and <action> shall not consider the secure exchange of NAS messages terminated; </action> </control> and <control> <condition> b) <condition> Upon indication from the lower layers that it has received the NGAP UE context resume request message as specified in 3GPP TS 38.413 </condition> <condition> when in 5GMM-IDLE mode with suspend indication, </condition> </condition> <action> the network shall enter 5GMM-CONNECTED mode. </action> </control>
5.3.2 Permanent identifiers
A globally unique permanent identity, the 5G subscription permanent identifier (SUPI), is allocated to each subscriber for 5GS-based services. The IMSI, the network specific identifier, the GCI and the GLI are valid SUPI types. <control> <condition> When the SUPI contains a network specific identifier, a GCI or a GLI, </condition> <action> it shall take the form of a network access identifier (NAI). </action> </control>
<control> <condition> <condition> When the UE performs initial registration for onboarding services in SNPN </condition> or <condition> is registered for onboarding services in SNPN, </condition> </condition> <action> the SUPI contains the onboarding SUPI derived from the default UE credentials for primary authentication. </action> </control> <control> <action> The UE derives the onboarding SUPI </action> <condition> before or during the initial registration for onboarding services in SNPN </condition> </control> and <control> <action> uses the derived onboarding SUPI </action> <condition> <condition> in the initial registration for onboarding services in SNPN </condition> and <condition> while registered for onboarding services in SNPN. </condition> </condition> </control>
The structure of the SUPI and its derivatives are specified in 3GPP TS 23.003.
The UE provides the SUPI to the network in concealed form. The SUCI is a privacy preserving identifier containing the concealed SUPI. <control> <condition> When the SUPI contains a network specific identifier, a GCI or a GLI, </condition> <action> the SUCI shall take the form of a NAI as specified in 3GPP TS 23.003 . </action> </control>
<control> <condition> A UE supporting N1 mode </condition> <action> includes a SUCI: </action> </control>
<control> <condition> <condition> a) in the REGISTRATION REQUEST message </condition> <condition> <condition> when the UE is attempting initial registration procedure </condition> and <condition> a valid 5G-GUTI is not available; </condition> </condition> </condition> </control>
<control> <condition> b) <condition> in the IDENTITY RESPONSE message, </condition> <condition> if the SUCI is requested by the network during the identification procedure; </condition> </condition> </control> and
<control> <condition> c) <condition> in the DEREGISTRATION REQUEST message </condition> <condition> </condition> when the UE initiates a de-registration procedure </condition> and <action> a valid 5G-GUTI is not available. </action> </control>
<control> <condition> If the UE uses the "null-scheme" as specified in 3GPP TS 33.501 to generate a SUCI, </condition> <action> the SUCI contains the unconcealed SUPI. </action> </control>
<control> <condition> When: a) <condition> not operating in SNPN access operation mode; </condition> or <condition> b) <condition> operating in SNPN access operation mode but not performing initial registration for onboarding services </condition> and <condition> not registered for onboarding services; </condition> </condition> </condition> <action> the UE shall use the "null-scheme" </action> </control> if:
<control> <condition> a) the home network has not provisioned the public key needed to generate a SUCI; </condition> </control>
<control> <condition> b) the home network has configured "null-scheme" to be used for the UE; </condition> </control>
<control> <condition> c) <condition> the UE needs to perform a registration procedure for emergency services </condition> <condition> <condition> after the failure of authentication procedure </condition> or <condition> after reception of a REGISTRATION REJECT message with the 5GMM cause #3 "Illegal UE", </condition> or <condition> to initiate a de-registration procedure before the registration procedure for emergency services was completed successfully, </condition> </condition> and <condition> the UE does not have a valid 5G-GUTI for the selected PLMN; </condition> </condition> </control> or
<control> <condition> d) the UE receives an identity request for SUCI </condition> <condition> <condition> during a registration procedure for emergency services </condition> or <condition> during a de-registration procedure that was initiated before the registration procedure for emergency services was completed successfully. </condition> </condition> </control>
<control> <condition> <condition> When operating in SNPN access operation mode </condition> and: <condition> <condition> a) performing initial registration for onboarding services; </condition> or <condition> b) registered for onboarding services; </condition> </condition> </condition> <action> the UE shall use the "null-scheme" </action> </control> if:
<control> <condition> a) the public key needed to generate a SUCI is not configured as part of the default UE credentials for primary authentication; </condition> </control> or
<control> <condition> b) "null-scheme" usage is configured as part of the default UE credentials for primary authentication. </condition> </control>
If:
<control> <condition> a) the UE uses the "null-scheme" as specified in 3GPP TS 33.501 to generate a SUCI; </condition> </control>
<control> <condition> b) the UE operates in SNPN access operation mode </condition> </control> and:
<control> 1) <condition> <condition> an indication to use anonymous SUCI which is associated with the selected entry of the "list of subscriber data" is configured in the ME, </condition> <condition> if the UE is not registering or registered for onboarding services in SNPN; </condition> </condition> </control> or
<control> 2) <condition> <condition> an indication to use anonymous SUCI which is associated with the default UE credentials for primary authentication, is configured in the ME, </condition> <condition> if the UE is registering or registered for onboarding services in SNPN; </condition> </condition> </control>
NOTE 1: The ME can be configured with an indication to use anonymous SUCI associated with an entry of "list of subscriber data" when the EAP method associated with the credentials of the entry supports SUPI privacy at the EAP layer, or can be configured with an indication to use anonymous SUCI associated with the default UE credentials for primary authentication when the EAP method associated with the default UE credentials for primary authentication supports SUPI privacy at the EAP layer, or both.
Editor's note: (WI eNPN, CR 4139) it is FFS whether another UE-level configuration for usage of anonymous SUCI is needed.
<control> <condition> c) <condition> the UE does not need <condition> to perform a registration procedure for emergency services, </condition> or <condition> to initiate a de-registration procedure </condition> </condition> <condition> before the registration procedure for emergency services was completed successfully; </condition> </condition> </control> and
<control> <condition> d) <condition> the UE does not receive an identity request for SUCI </condition> <condition> <condition> during a registration procedure for emergency services </condition> or <condition> during a de-registration procedure that was initiated before the registration procedure for emergency services was completed successfully; </condition> </condition> </condition> <action> then the UE shall use anonymous SUCI as specified in 3GPP TS 23.003. </action> </control>
A W-AGF acting on behalf of an FN-RG shall use the "null-scheme" as specified in 3GPP TS 33.501 to generate a SUCI.
A W-AGF acting on behalf of an N5GC device shall use the "null-scheme" as specified in 3GPP TS 33.501 to generate a SUCI.
<control> <condition> If a UE is a MUSIM UE, </condition> <action> the UE shall use a separate permanent equipment identifier (PEI) for each USIM, if any, </action> </control> and <control> <condition> each entry of "list of subscriber data", if any, </condition> <action> the UE operates for accessing 5GS-based services; </action> </control> <control> <condition> otherwise, </condition> <action> a UE contains and uses a permanent equipment identifier (PEI) for accessing 5GS-based services. </action> </control> <control> <condition> When the UE is registered with a network by using a PEI, </condition> <action> the UE shall not use that PEI to register with another network until the UE is de- registered from the network. </action> </control>
In this release of the specification, the IMEI, the IMEISV, the MAC address together with the MAC address usage restriction indication and the EUI-64 are the only PEI formats supported by 5GS. The structure of the PEI and its formats are specified in 3GPP TS 23.003.
<control> <condition> Each UE supporting at least one 3GPP access technology (i.e. satellite NG-RAN, NG-RAN, satellite E-UTRAN, E- UTRAN, UTRAN or GERAN) </condition> <action> contains a PEI in the IMEI format </action> and <action> shall be able to provide an IMEI and an IMEISV upon request from the network. </action> </control>
<control> <condition> <condition> Each UE not supporting any 3GPP access technologies </condition> and <condition> supporting NAS over untrusted or trusted non-3GPP access </condition> </condition> <action> shall have a PEI in the form of the Extended Unique Identifier EUI-64 of the access technology the UE uses to connect to the 5GC. </action> </control>
<control> <action> A UE supporting N1 mode includes a PEI: </action> </control>
<control> <condition> a) <condition> when neither SUPI nor valid 5G-GUTI is available to use for emergency services </condition> <condition> in the REGISTRATION REQUEST message </condition> <condition> with 5GS registration type IE set to "emergency registration"; </condition> </condition> </control>
<control> <condition> b) <condition> when the network requests the PEI by using the identification procedure, </condition> <condition> in the IDENTITY RESPONSE message; </condition> </condition> </control> and
<control> <condition> c) <condition> when the network requests the IMEISV by using the security mode control procedure, <condition> </condition> in the SECURITY MODE COMPLETE message. </condition> </condition> </control>
Each 5G-RG supporting only wireline access and each FN-RG shall have a permanent MAC address configured by the manufacturer. For 5G-CRG, the permanent MAC address configured by the manufacturer shall be a cable modem MAC When the 5G-RG contains neither an IMEI nor an IMEISV, the 5G-RG shall use as a PEI the 5G-RG's permanent MAC address configured by the manufacturer and the MAC address usage restriction indication set to "no restrictions".
<control> <action> The W-AGF acting on behalf of the FN-RG shall use as a PEI the MAC address provided by the FN-RG </action> <condition> if the MAC address provided by the FN-RG is not unique </condition> or <condition> does not correspond to the FN-RG's permanent MAC address according to W-AGF's configuration, </condition> </control> the MAC address usage restriction indication set to "MAC address is not usable as an equipment identifier" otherwise the MAC address usage restriction indication set to "no restrictions".
<control> <condition> The 5G-RG containing neither an IMEI nor an IMEISV </condition> <action> shall include the PEI containing the MAC address together with the MAC address usage restriction indication: </action> </control>
<control> <condition> a) <condition> when neither SUPI nor valid 5G-GUTI is available to use for emergency services </condition> <condition> in the REGISTRATION REQUEST message </condition> <condition> with 5GS registration type IE set to "emergency registration"; </condition> </condition> </control>
<control> <condition> b) <condition> when the network requests the PEI by using the identification procedure, </condition> <condition> in the IDENTIFICATION RESPONSE message; </condition> </condition> </control> and
<control> <condition> c) <condition> when the network requests the IMEISV by using the security mode control procedure, </condition> <condition> in the SECURITY MODE COMPLETE message. </condition> </condition> </control>
NOTE 2: In case c) above, the MAC address is provided even though AMF requests the IMEISV.
<control> <action> The W-AGF acting on behalf of the FN-RG shall include the PEI containing the MAC address together with the MAC address usage restriction indication: </action> </control>
<control> <condition> a) <condition> when the network requests the PEI by using the identification procedure, </condition> <condition> in the IDENTIFICATION RESPONSE message; </condition> </condition> </control> and
<control> <condition> b) <condition> when the network requests the IMEISV by using the security mode control procedure, </condition> <condition> in the SECURITY MODE COMPLETE message. </condition> </condition> </control>
NOTE 3: In case b) above, the MAC address is provided even though AMF requests the IMEISV.
<control> <condition> The W-AGF acting on behalf of the N5GC device </condition> <action> shall use as a PEI the MAC address provided by the N5GC device and the MAC address usage restriction indication set to "no restrictions". </action> </control> Based on operator policy, the W-AGF acting on behalf of the N5GC device may encode the MAC address of the N5GC device using the EUI-64 format as specified in and use as a PEI the derived EUI-64.
NOTE 4: The MAC address of an N5GC device is universally/globally unique.
The AMF can request the PEI at any time by using the identification procedure.
5.3.3 Temporary identities
A temporary user identity for 5GS-based services, the 5G globally unique temporary identity (5G-GUTI), is used for identification within the signalling procedures. In case of PLMN the 5G-GUTI is globally unique and in case of SNPN the 5G-GUTI is unique within an SNPN. <control> <condition> When the UE is registered to the same PLMN or SNPN over 3GPP and non- 3GPP access, </condition> <action> the UE and the AMF maintain one 5G-GUTI that is common to both 3GPP and non-3GPP access. </action> </control> <control> <condition> When the UE is required to delete the 5G-GUTI according to a NAS procedure, </condition> <action> the UE shall delete the 5G-GUTI </action> <condition> only if it is not registered to the same PLMN or SNPN through other access. </condition> </control> <control> <condition> When the UE is registered to different PLMNs or SNPNs over 3GPP access and non-3GPP access, </condition> <action> the UE maintains two 5G-GUTIs, a 5G-GUTI for the registration with a PLMN or SNPN over the 3GPP access and another 5G-GUTI for the registration with another PLMN or SNPN over the non-3GPP access. </action> </control> <control> <condition> In the paging and service request procedures, </condition> <action> a shortened form of the 5G-GUTI, the 5G S-temporary mobile subscriber identity (5G-S-TMSI), is used to enable more efficient radio signalling. </action> </control> The purpose of the 5G-GUTI and 5G-S-TMSI is to provide identity confidentiality, i.e., to protect a user from being identified and located by an intruder. The structure of the 5G-GUTI and its derivatives are specified in 3GPP TS 23.003.
The 5G-GUTI has two main components (see 3GPP TS 23.501 ): (two many facts here, can use two big one) a) the GUAMI; and b) the 5G-TMSI that provides an unambiguous identity of the UE within the AMF(s) identified by the GUAMI.
NOTE: The UE registered with an SNPN over non-3GPP access refers to the UE accessing SNPN services via a PLMN.
The 5G-S-TMSI has three main components: a) the AMF set ID that uniquely identifies the AMF set within the AMF region; b) the AMF pointer that identifies one or more AMFs within the AMF set; and c) the 5G-TMSI.
<control> <condition> A UE supporting N1 mode </condition> <action> includes a valid 5G-GUTI, <condition> if any is available, </condition> in the REGISTRATION REQUEST and DEREGISTRATION REQUEST messages. </action> </control> <control> <action> In the SERVICE REQUEST message, the UE includes a valid 5G-S-TMSI as user identity. </action> </control>
<control> <action> The AMF shall assign a new 5G-GUTI for a particular UE: </action> <condition> <condition> a) during a successful initial registration procedure; </condition> <condition> b) during a successful registration procedure for mobility registration update; </condition> <condition> c) <condition> after a successful service request procedure invoked as a response to a paging request from the network </condition> and <condition> <condition> before the: 1) release of the N1 NAS signalling connection; </condition> or <condition> 2) suspension of the N1 NAS signalling connection due to user plane CIoT 5GS optimization </condition> </condition> <condition> i.e. before the UE and the AMF enter 5GMM-IDLE mode with suspend indication; as specified in subclause 5.4.4.1; </condition> </condition> and <condition> d) <condition> <condition> after the AMF receives an indication from the lower layers that it has received the NGAP UE context resume request message as specified in 3GPP TS 38.413 for a UE <condition> in 5GMM-IDLE mode with suspend indication </condition> </condition> and <condition> this resumption is a response to a paging request from the network, </condition> </condition> and <condition> before the: <condition> 1) release of the N1 NAS signalling connection; </condition> or <condition> 2) suspension of the N1 NAS signalling connection due to user plane CIoT 5GS optimization </condition> </condition> <condition> i.e. before the UE and the AMF enter 5GMM-IDLE mode with suspend indication; as specified in subclause 5.4.4.1. </condition> </condition> </condition> </control>
<control> <action> The AMF should assign a new 5G-GUTI for a particular UE </action> <condition> during a successful registration procedure for periodic registration update. </condition> <action> The AMF may assign a new 5G-GUTI at any time for a particular UE by performing the generic UE configuration update procedure. </action> </control>
<control> <condition> If a new 5G-GUTI is assigned by the AMF, </condition> <action> the UE and the AMF handle the 5G-GUTI as follows: </action> <control> <condition> a) Upon receipt of a 5GMM message containing a new 5G-GUTI, </condition> <action> the UE considers the new 5G-GUTI as valid and the old 5G-GUTI as invalid, </action> <action> stops timer T3519 if running, </action> and <action> deletes any stored SUCI. </action> <control> <action> The new 5G-GUTI is stored in a non-volatile memory in the USIM </action> <condition> if the corresponding file is present in the USIM, </condition> in the non- volatile memory in the ME, as described in annex C. </control> </control> <control> <action> b) The AMF considers the old 5G-GUTI as invalid </action> <condition> as soon as an acknowledgement for a registration or generic UE configuration update procedure is received </condition> </control> </control>
5.3.4 Registration areas
Within the 5GS, the registration area is managed independently per access type, i.e., 3GPP access or non-3GPP access.
<control> <action> The AMF assigns a registration area to the UE </action> <condition> during the registration procedure. </condition> </control> A registration area is defined as a set of tracking areas and each of these tracking areas consists of one or more cells that cover a geographical area.
Within the 5GS, the concept of "registration to multiple tracking areas" applies:
a) A tracking area is identified by a TAI which is broadcast in the cells of the tracking area. The TAI is constructed from a TAC and a PLMN identity. In case of a shared network: 1) one or more TACs; and 2) any of the following: i) multiple PLMN identities; ii) multiple SNPN identities; or iii) one or more PLMN identities and one or more SNPN identities are broadcast.
<control> <condition> b) In order to reduce the tracking area update signalling within the 5GS </condition> , <action> the AMF can assign several tracking areas to the UE. </action> </control> These tracking areas construct a list of tracking areas which is identified by a TAI list. <control> <condition> When generating the TAI list, </condition> <action> the AMF shall include only TAIs that are applicable on the access </action> <condition> where the TAI list is sent. </condition> </control> <control> <action> The AMF shall be able to allocate a TAI list over different NG-RAN access technologies. </action> <action> The AMF shall not allocate a TAI list containing both tracking areas in NB-N1 mode and tracking areas not in NB-N1 mode. </action> </control>
<control> c) <action> The UE considers itself registered to a list of tracking areas </action> and <action> does not need to trigger the registration procedure for mobility and periodic registration update used for mobility (i.e. the 5GS registration type IE set to "mobility registration updating" in the REGISTRATION REQUEST message) </action> <condition> as long as the UE stays in one of the tracking areas of the list of tracking areas received from the AMF. </condition> </control>
<control> d) <action> The UE will consider the TAI list as valid, </action> <condition> <condition> until it receives a new TAI list in the next registration procedure for mobility and periodic registration update </condition> or <condition> generic UE configuration update procedure </condition> , or <condition> the UE is commanded by the network to delete the TAI list by a reject message </condition> or <condition> it is deregistered from the 5GS. </condition> </condition> <control> <condition> If the registration request is accepted or the TAI list is reallocated by the AMF, </condition> <action> the AMF shall provide at least one entry in the TAI list. </action> </control> <control> <condition> If the new and the old TAI list are identical, </condition> <action> the AMF does not need to provide the new TAI list to the UE during mobility registration update or periodic registration update. </action> </control> </control>
<control> e) <action> The TAI list can be reallocated by the AMF. </action> </control>
<control> <condition> f) When the UE is deregistered from the 5GS, </condition> <action> the TAI list in the UE is invalid. </action> </control>
<control> g) <action> The UE includes the last visited registered TAI, </action> <condition> if available, </condition> to the AMF. <control> <action> The last visited registered TAI is stored in a non-volatile memory in the USIM </action> <condition> if the corresponding file is present in the USIM, </condition> else <action> in the non-volatile memory in the ME, as described in annex C. </action> </control> </control>
5.3.5 Service area restrictions
5.3.5.1 General
Service area restrictions are applicable only to 3GPP access and to wireline access.
Subclause 5.3.5.2 applies when the UE accesses 5GCN over 3GPP access.
Subclause 5.3.5.3 applies when the 5G-RG or the W-AGF acting on behalf of an FN-CRG (or on behalf of the N5GC device) access 5GCN over wireline access.
NOTE: Service area restrictions are not applicable for the W-AGF acting on behalf of the FN-BRG.
5.3.5.2 3GPP access service area restrictions
The service area restrictions consist of tracking areas forming either an allowed area, or a non-allowed area. The tracking areas belong to either the registered PLMN or its equivalent PLMNs in the registration area. The allowed area can contain up to 16 tracking areas or include all tracking areas in the registered PLMN and its equivalent PLMN(s) in the registration area. The non-allowed area can contain up to 16 tracking areas. The network conveys the service area restrictions to the UE by including either an allowed area, or a non-allowed area, but not both, in the Service area list IE of a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message.
<control> <condition> If the network does not convey the service area restrictions to the UE in the Service area list IE of a REGISTRATION ACCEPT message, </condition> <action> the UE shall treat all tracking areas in the registered PLMN and its equivalent PLMN(s) in the registration area as allowed area </action> and <action> delete the stored list of "allowed tracking areas" or the stored list of "non-allowed tracking areas". </action> </control>
<control> <condition> <condition> When the UE receives a Service area list IE with an allowed area indication </condition> <condition> during a registration procedure or a generic UE configuration update procedure: </condition> </condition> <control> <condition> a) if the "Type of list" included in the Service area list IE does not indicate "all TAIs belonging to the PLMNs in the registration area are allowed area", </condition> <action> the UE shall delete the old list of "allowed tracking areas" </action> and <action> store the tracking areas in the allowed area as the list of "allowed tracking areas". </action> </control> <control> <condition> If the UE has a stored list of "non- allowed tracking areas", </condition> <action> the UE shall delete that list; </action> </control> or <control> <condition> b) if the "Type of list" included in the Service area list IE indicates "all TAIs belonging to the PLMNs in the registration area are allowed area", </condition> <action> the UE shall treat all tracking areas in the registered PLMN and its equivalent PLMN(s) as allowed area </action> and <action> delete the stored list of "allowed tracking areas" or the stored list of "non-allowed tracking areas". </action> </control> </control>
<control> <condition> <condition> When the UE receives a Service area list IE with a non-allowed area indication </condition> <condition> during a registration procedure or a generic UE configuration update procedure, </condition> </condition> <action> the UE shall delete the old list of "non-allowed tracking areas" </action> and <action> store the tracking areas in the non-allowed area as the list of "non-allowed tracking areas". </action> <control> <condition> If the UE has a stored list of "allowed tracking areas", </condition> <action> the UE shall delete that list. </action> </control> </control>
<control> <condition> <condition> If the UE is successfully registered to a PLMN </condition> and <condition> has a stored list of "allowed tracking areas": </condition> </condition> </control>
<control> <condition> a) while the current TAI is in the list of "allowed tracking areas", </condition> <end_state> the UE shall stay in, or enter, the state 5GMM- REGISTERED.NORMAL-SERVICE </end_state> and <action> is allowed to initiate any 5GMM and 5GSM procedures; </action> </control> and
<control> <condition> b) <condition> while the UE is camped on a cell which is in the registered PLMN or a PLMN from the list of equivalent PLMNs </condition> and <condition> the current TAI is not in the list of "allowed tracking areas", </condition> </condition> <end_state> the UE shall enter the state 5GMM- REGISTERED.NON-ALLOWED-SERVICE, </end_state> </control> and:
1) <control> <condition> if the UE is in 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication over 3GPP access, </condition> </control> the UE:
<control> i) <action> shall not include the Uplink data status IE in the registration procedure for mobility and periodic registration update </action> <condition> except for emergency services or for high priority access </condition> </control> ;
<control> ii) <action> shall not perform the registration procedure for mobility and periodic registration update </action> <condition> with Follow-on request indicator set to "Follow-on request pending" </condition> , <condition> except for: <condition> a) emergency services; </condition> <condition> b) high priority access; </condition> <condition> c) indicating a change of 3GPP PS data off UE status; </condition> <condition> d) sending an SOR transparent container; </condition> <condition> e) sending a UE policy container; </condition> or <condition> f) sending a UE parameters update transparent container; </condition> </condition> </control>
<control> iii) <action> shall not initiate a service request procedure </action> or <action> request the lower layers to resume a suspended connection </action> , <condition> except for: <condition> a) emergency services; </condition> <condition> b) emergency services fallback; </condition> <condition> c) high priority access; </condition> <condition> d) responding to paging; </condition> <condition> e) responding to notification received over non-3GPP access; </condition> <condition> f) indicating a change of 3GPP PS data off UE status; </condition> <condition> g) sending an SOR transparent container; </condition> <condition> h) sending a UE policy container; </condition> or <condition> i) sending a UE parameters update transparent container; </condition> </condition> </control> and
2) <control> <condition> if the UE is in 5GMM-CONNECTED mode or 5GMM-CONNECTED mode with RRC inactive indication over 3GPP access, </condition> </control> the UE:
<control> i) <action> not perform the registration procedure for mobility and periodic registration update with Uplink data status IE </action> <condition> except for emergency services or for high priority access </condition> </control> ;
ii) <control> <action> shall not initiate a service request procedure </action> <condition> except for: <condition> a) emergency services; </condition> <condition> b) emergency services fallback; </condition> <condition> c) high priority access; </condition> <condition> d) responding to paging or responding to notification received over non-3GPP access; </condition> </condition> </control>
<control> iii) <action> shall not initiate a 5GSM procedure </action> <condition> except for: <condition> a)emergency services; </condition> <condition> b) high priority access; </condition> or <condition> c) indicating a change of 3GPP PS data off UE status; </condition> </condition> </control> and
<control> iv) <action> shall not perform the NAS transport procedure </action> <condition> except for the sending: a) SMS; b) an LPP message; c) a location services message; d) an SOR transparent container; e) a UE policy container; f)a UE parameters update transparent container; or g) a CIoT user data container. </condition> </control>
NOTE 1: <control> The contents of CIoT user data container can be data that is not for exception reports, or data that is for exception reports <condition> if allowed for the UE </condition> </control> (see subclause 6.2.13).
<control> <condition> <condition> If the UE is successfully registered to a PLMN </condition> and <condition> has a stored list of "non-allowed tracking areas" </condition> </condition> </control>
<control> <condition> a) <condition> while the UE is camped on a cell which is in the registered PLMN or a PLMN from the list of equivalent PLMNs </condition> and <condition> the current TAI is not in the list of "non-allowed tracking areas" </condition> </condition> , <end_state> the UE shall stay in, or enter, the state 5GMM-REGISTERED.NORMAL-SERVICE </end_state> and <action> is allowed to initiate any 5GMM and 5GSM procedures </action> </control> ; and
<control> <condition> b) while the current TAI is in the list of "non-allowed tracking areas", </condition> <end_state> the UE shall 5GMM- REGISTERED.NON-ALLOWED-SERVICE, </end_state> </control> and:
1) <control> <condition> if the UE is in 5GMM-IDLE mode or 5GMM-IDLE mode <condition> with suspend indication over 3GPP access, </condition> </condition> the UE: </control>
<control> i) <action> shall not include the Uplink data status IE in the registration procedure for mobility and periodic registration update </action> <condition> except for emergency services or for high priority access </condition> </control> ;
ii) <control> <action> shall not perform the registration procedure for mobility and periodic registration update </action> <condition> with Follow-on request indicator set to "Follow-on request pending", </condition> except for: </control> <control> <condition> a) emergency services; </condition> </control> <control> <condition> b) high priority access; </condition> </control> <control> <condition> c) indicating a change of 3GPP PS data off UE status; </condition> </control> <control> <condition> d) sending an SOR transparent container; </condition> </control> <control> <condition> e) sending a UE policy container; </condition> </control> or <control> <condition> f) sending a UE parameters update transparent container; </condition> </control> and
<control> iii) <action> shall not initiate a service request procedure </action> or <action> request the lower layers to resume a suspended connection </action> , <condition> except for: <condition> a) emergency services; </condition> <condition> b) emergency services fallback; </condition> <condition> c) high priority access; </condition> <condition> d) responding to paging; </condition> <condition> e) responding to notification received over non-3GPP access; </condition> <condition> f) indicating a change of 3GPP PS data off UE status; </condition> <condition> g) sending an SOR transparent container; </condition> <condition> h) sending a UE policy container; </condition> or <condition> i) sending a UE parameters update transparent container; </condition> </condition> </control> and
2) <control> <condition> if the UE is in 5GMM-CONNECTED mode or 5GMM-CONNECTED mode with RRC inactive indication over 3GPP access </condition> the UE: </control>
<control> i) <action> shall not perform the registration procedure for mobility </action> and <action> registration update with the Uplink data status IE </action> <condition> except for emergency services or for high priority access; </condition> </control>
<control> ii) <action> shall not initiate a service request procedure </action> or <action> request the lower layers to resume a suspended connection , </action> <condition> except for: <condition> a) emergency services; </condition> <condition> b) emergency services fallback; </condition> <condition> c) high priority access; </condition> or <condition> d) responding to paging or responding to notification received over non-3GPP access; </condition> </condition> </control>
<control> iii) <action> shall not initiate a 5GSM procedure </action> <condition> except for: <condition> a) emergency services; </condition> <condition> b) high priority access; </condition> <condition> c) indicating a change of 3GPP PS data off UE status; </condition> </condition> </control> and
<control> iv) <action> shall not perform the NAS transport procedure </action> <condition> except for the sending: a)SMS; b) an LPP message; c) a location services message; d) an SOR transparent container; e) a UE policy container; f) a UE parameters update transparent container; or g) a CIoT user data container. </condition> </control>
NOTE 2: The contents of CIoT user data container can be data that is not for exception reports, or data that is for exception reports if allowed for the UE (see subclause 6.2.13).
<control> <action> The list of "allowed tracking areas", as well as the list of "non-allowed tracking areas" shall be erased </action> <condition> when: <condition> a) the UE is switched off; </condition> and <condition> b)the UICC containing the USIM is removed or an entry of the "list of subscriber data" with the SNPN identity of the SNPN is updated. </condition> </condition> </control>
<control> <condition> When a tracking area is added to the list of "5GS forbidden tracking areas for roaming" or to the list of "5GS forbidden tracking areas for regional provision of service" as specified in the subclauses 5.5.1.2.5 or 5.5.1.3.5, </condition> <action> the tracking area shall be removed from the list of "allowed tracking areas" </action> <condition> if the tracking area is already present in the list of "allowed tracking areas" </condition> and <action> from the list of "non-allowed tracking areas" </action> <condition> if the tracking area is already present in the list of "non-allowed tracking areas". </condition> </control>
5.3.5.3 Wireline access service area restrictions
<control> <condition> If <condition> a) a SERVICE REJECT message with the 5GMM cause #28 "Restricted service area"; </condition> b) <condition> <condition> a DL NAS TRANSPORT message with the Payload container type IE set to "N1 SM information" </condition> and <condition> the 5GMM cause #28 "Restricted service area"; </condition> </condition> or c) <condition> a REGISTRATION ACCEPT message includes the PDU session reactivation result error cause IE <condition> with the 5GMM cause #28 "Restricted service area"; </condition> is received over wireline access </condition> </condition> then <action> the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) shall start enforcing the wireline access service area restrictions </action> and <end_state> shall enter the state 5GMM- REGISTERED.NON-ALLOWED-SERVICE. </end_state> </control>
<control> <start_state> While in the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE, </start_state> the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) shall: </control>
<control> <condition> a) if in 5GMM-IDLE mode over wireline access: </condition> </control>
1) <control> <action> shall not perform the registration procedure for mobility </action> and <action> periodic registration update with Uplink data status IE </action> <condition> except for emergency services or for high priority access; </condition> </control> and
2) <control> <action> shall not initiate a service request procedure </action> <condition> except for: <condition> a) emergency services, </condition> b) <condition> emergency services fallback; </condition> or c) <condition> high priority access; </condition> </condition> </control> and
<control> <condition> b) if in 5GMM-CONNECTED mode over wireline access: </condition> </control>
1) <control> <action> shall not perform the registration procedure for mobility </action> and <action> periodic registration update with Uplink data status IE </action> except for </control> : <control> <condition> a) emergency services; </condition> </control> <control> <condition> b) emergency services fallback; </condition> </control> or <control> <condition> c) high priority access; </condition> </control>
2) <control> <action> shall not initiate a service request procedure </action> <condition> except for emergency services, or high priority access </condition> </control> ; and
3) <control> <action> shall not initiate a 5GSM procedure </action> <condition> except for emergency services or high priority access over the wireline access </condition> </control>
<control> <condition> When the 5G-RG is switched off, the UICC containing the USIM is removed or the 5G-RG starts using another wireline access network, </condition> <action> the 5G-RG shall stop enforcing the wireline access service area restrictions, </action> <condition> if enforced. </condition> </control>
<control> <condition> When the W-AGF acting on behalf of the FN-CRG determines that the FN-CRG is switched off, </condition> <action> the W-AGF acting on behalf of the FN-CRG stops enforcing the wireline access service area restrictions, </action> <condition> if enforced. </condition> </control>
<control> <condition> When the W-AGF acting on behalf of the N5GC device determines that the FN-CRG serving the N5GC device is switched off, </condition> <action> the W-AGF acting on behalf of the N5GC device stops enforcing the wireline access service area restrictions, </action> <condition> if enforced. </condition> </control>
5.3.6 Mobile initiated connection only mode
<control> <action> The UE can request the use of mobile initiated connection only (MICO) mode </action> <condition> during the registration procedure (see 3GPP TS 23.501 and 3GPP TS 23.502 ). </condition> <action> The UE shall not request use of MICO mode over non-3GPP access. </action> </control>
<control> Furthermore, <action> the UE in 3GPP access shall not request the use of MICO mode </action> during: </control>
<control> <condition> a) a registration procedure for initial registration for emergency services </condition> </control> (see subclause 5.5.1.2);
<control> <condition> b) a registration procedure for initial registration for initiating an emergency PDU session </condition> </control> (see subclause 5.5.1.2);
<control> <condition> c) a registration procedure for mobility and periodic registration update (see subclause 5.5.1.3) for initiating an emergency PDU session <start_state> if the UE is in the state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION- UPDATE; </start_state> </condition> </control> or
<control> <condition> d) a registration procedure for mobility and periodic registration update (see subclause 5.5.1.3) <condition> when the UE has an emergency PDU session established. </condition> </condition> </control>
<control> <condition> If the UE requests the use of MICO mode, </condition> <action> the network can accept the use of MICO mode by providing a MICO indication </action> <condition> when accepting the registration procedure. </condition> <control> <action> The UE may use MICO mode </action> <condition> only if the network has provided the MICO indication IE <condition> during the last registration procedure. </condition> </condition> </control> <control> <action> The UE may also request an active time value together with the MICO mode indication </action> <condition> during the registration procedure. </condition> </control> </control>
<control> <condition> If the network accepts the use of MICO mode and does not include an active time value in T3324 IE to the UE, </condition> <action> the AMF may include an "all PLMN registration area allocated" indication in the MICO indication IE to the UE. </action> <condition> If the UE indicated the support for strictly periodic registration timer in the MICO indication IE to the network, </condition> <action> the network may include a "strictly periodic registration timer supported" indication in the MICO indication IE to the UE. </action> </control>
<control> <condition> <condition> If the UE requested the use of active time by including an active time value </condition> and <condition> the network accepts the use of MICO mode and the use of active time, </condition> </condition> <action> the AMF shall include an active time value in the T3324 IE to the UE. </action> </control> <control> <condition> If the AMF indicates active time value to the UE, </condition> <action> AMF should not indicate "all PLMN registration area allocated" indication in the MICO indication IE to the UE. </action> </control> <control> <condition> Upon entering 5GMM-IDLE mode, </condition> <action> AMF shall start the active timer with the active time value indicated to the UE </action> and <action> shall consider the UE is reachable for paging </action> <condition> as long as the timer is running. </condition> </control> <control> <condition> If the UE enters 5GMM-CONNECTED mode over 3GPP access when the active timer is running, </condition> <action> the AMF shall stop the active </action> </control>
NOTE 1: The active time value assigned by AMF can be different from the active time value requested by the UE.
AMF assigns the active time value based on several factors, e.g. local configuration, expected UE behaviour, UE requested active time value, UE subscription information, network policies etc.
<control> <condition> If the network accepts the use of MICO mode, </condition> <action> the UE may deactivate the AS layer </action> and <action> activate MICO mode </action> by <end_state> entering the state 5GMM-REGISTERED.NO-CELL-AVAILABLE </end_state> <condition> if: <condition> a) the UE is in 5GMM-IDLE mode over3GPP access; </condition> b) <condition> <start_state> the UE is in the 5GMM-REGISTERED.NORMAL-SERVICE </start_state> or <start_state> 5GMM-REGISTERED.NON-ALLOWED- SERVICE </start_state> (as described in subclause 5.3.5.2) state for 3GPP access; </condition> and c) <condition> no T3324 value is received from the network. </condition> </condition> </control>
<control> <condition> <condition> If the network accepts the use of MICO mode </condition> and <condition> indicates an active time value to the UE in a successful registration procedure, </condition> </condition> <action> the UE shall start the timer T3324 with the value received from the network </action> <condition> after entering 5GMM-IDLE mode over 3GPP access. </condition> </control> <control> <condition> At the expiry of the timer T3324, </condition> <action> the UE may activate MICO mode </action> <end_state> by entering the state 5GMM-REGISTERED.NO-CELL-AVAILABLE </end_state> <condition> if <start_state> the UE is in the 5GMM-REGISTERED.NORMAL-SERVICE </start_state> or <start_state> 5GMM-REGISTERED.NON-ALLOWED-SERVICE </start_state> (as described in subclause 5.3.5.2) state for 3GPP access. </condition> </control> <control> <condition> If the UE enters 5GMM-CONNECTED mode over 3GPP access <condition> when the timer T3324 is running, </condition> </condition> <action> the UE shall stop the timer T3324. </action> </control>
NOTE 2: <control> <condition> When MICO mode is activated and if the UE is also registered over the non-3GPP access, </condition> <action> the AMF will not send a NOTIFICATION message with access type indicating 3GPP access over the non-3GPP access for PDU sessions associated with 3GPP access. </action> </control>
<control> <action> The UE may deactivate MICO mode </action> and <action> activate the AS layer at any time. </action> <control> <condition> Upon deactivating MICO mode, </condition> <action> the UE may initiate 5GMM procedures </action> (e.g. for the transfer of mobile originated signalling or user data). </control> </control>
<control> <condition> When an emergency PDU session is successfully established after the MICO mode was enabled, </condition> <action> The UE and the AMF shall locally disable MICO mode. </action> <control> <action> The UE and the AMF shall not enable MICO mode </action> <condition> until the AMF accepts the use of MICO mode in the next registration procedure. </condition> </control> </control> <control> <condition> To enable an emergency call back </condition> , <action> the UE should wait for a UE implementation-specific duration of time </action> <condition> before requesting the use of MICO mode <condition> after the completion of the emergency services. </condition> s </condition> </control>
<control> <condition> If the AMF accepts the use of MICO mode and does not indicate "strictly periodic registration timer supported" in the MICO indication IE to the UE, </condition> <action> the AMF starts the implicit de-registration timer for 3GPP access </action> <condition> when entering 5GMM-IDLE mode for 3GPP access. </condition> </control> <control> <condition> If AMF accepts the use of MICO mode and indicates "strictly periodic registration timer supported" in the MICO indication IE to the UE, </condition> <action> the AMF shall start the strictly periodic monitoring timer with T3512 value indicated in the T3512 value IE </action> <condition> after the registration procedure is completed. </condition> </control> <control> <action> The AMF shall neither stop nor reset the strictly periodic monitoring timer </action> <condition> when the NAS signalling connection is established or released for the UE. </condition> </control> <control> <condition> If the strictly periodic monitoring timer expires <condition> when NAS signalling connection is established for the UE, </condition> </condition> <action> AMF shall restart the strictly periodic monitoring timer with the T3512 value, </action> <control> <condition> otherwise </condition> <action> AMF shall start the implicit de-registration timer. </action> </control> </control>
<control> <condition> When an emergency PDU session is successfully established and the MICO mode is disabled, </condition> <action> the UE shall stop timer T3512 </action> <condition> if running </condition> and <action> the AMF shall stop strictly periodic monitoring timer </action> <condition> if running. </condition> <action> The UE and the AMF shall behave as if no "strictly periodic registration timer supported" indication was given to the UE in the last registration </action> </control>
<control> <condition> Upon successful completion of an attach procedure or tracking area updating procedure <condition> after inter-system change from N1 mode to S1 mode (see 3GPP TS 24.301 ), </condition> </condition> <action> the UE operating in single-registration mode shall locally disable MICO mode. </action> </control> <control> <condition> After inter-system change from S1 mode to N1 mode, </condition> <action> the UE operating in single-registration mode may re-negotiate MICO mode with the network </action> <condition> during the registration procedure for mobility and periodic registration </condition> </control>
5.3.7 Handling of the periodic registration update timer and mobile reachable timer
The periodic registration update procedure is used over 3GPP access to periodically notify the availability of the UE to the network. The procedure is controlled in the UE by the periodic registration update timer, T3512.
<control> <condition> If the UE is registered over the 3GPP access, </condition> <action> the AMF maintains an implicit de-registration timer to control </action> <condition> when the UE is considered implicitly de-registered over the 3GPP access. </condition> </control> <control> <condition> If the UE is registered over the non-3GPP access, </condition> <action> the AMF also maintains a non-3GPP implicit de-registration timer to control </action> <condition> when the UE is considered implicitly de- registered over the non-3GPP access. </condition> </control> <control> <condition> The UE registered over the non-3GPP access </condition> <action> maintains a non-3GPP de-registration timer to control </action> <condition> when the UE is considered implicitly de-registered for the non-3GPP access. </condition> </control>
<control> <action> The AMF shall start a non-3GPP implicit de-registration timer for the UE registered over non-3GPP access </action> <condition> when the N1 NAS signalling connection over non-3GPP access is released. </condition> </control>
<control> <condition> The UE registered over non-3GPP access </condition> <action> shall reset and start a non-3GPP de-registration timer </action> <condition> when the N1 NAS signalling connection over non-3GPP access is released. </condition> </control> <control> <action> The non-3GPP de-registration timer is stopped </action> <condition> when the UE enters 5GMM-CONNECTED mode over non-3GPP access or the 5GMM-DEREGISTERED state over non-3GPP access. </condition> </control>
<control> <action> The non-3GPP implicit de-registration timer shall be longer than the non-3GPP de-registration timer. </action> </control>
The value of timer T3512 is sent by the network to the UE in the REGISTRATION ACCEPT message. <control> <action> The UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE </action> <condition> until a new value is received. </condition> </control> <control> <action> The periodic registration update timer only applies to the UE </action> <condition> registered to the 5GS services over 3GPP access. </condition> </control>
<control> <condition> If timer T3512 <condition> received by the UE in a REGISTRATION ACCEPT message </condition> <condition> contains an indication that the timer is deactivated or the timer value is zero, </condition> </condition> then <action> timer T3512 is deactivated </action> and <action> the UE shall not perform the periodic registration update procedure. </action> </control>
NOTE 1: The UE does not perform the periodic registration update procedure for non-3GPP access.
<control> <condition> <condition> If during the registration procedure, </condition> the AMF does not indicate "strictly periodic registration timer supported" in the MICO indication IE to the UE, </condition> <control> <action> timer T3512 is reset </action> and <action> started with its initial value, </action> <condition> when the UE changes from 5GMM-CONNECTED over 3GPP access to 5GMM-IDLE mode over 3GPP access. </condition> </control> <control> <action> Timer T3512 is stopped </action> when <condition> the UE enters 5GMM-CONNECTED mode over 3GPP access or the 5GMM-DEREGISTERED state over 3GPP access. </condition> </control> </control>
<control> <condition> If during the registration procedure, </condition> <action> the AMF indicates "strictly periodic registration timer supported" in the MICO indication IE to the UE, </action> <control> <action> timer T3512 is started with its initial value </action> <condition> after the completion of the registration procedure. </condition> </control> </control>
<control> <action> The UE shall neither stop nor reset the timer T3512 </action> <condition> when the UE enters 5GMM-CONNECTED or when changing from 5GMM-CONNECTED mode to 5GMM-IDLE mode. </condition> <control> <condition> If the timer T3512 expires, </condition> <control> <condition> a) the UE in 5GMM-CONNECTED mode over 3GPP access </condition> <action> shall reset and start the timer T3512 with its initial value; </action> </control> <control> <condition> b) the UE in 5GMM-IDLE mode over 3GPP access </condition> <action> shall perform the periodic registration procedure. </action> </control> </control> </control>
<control> <condition> If the UE is registered for emergency services, and timer T3512 expires, </condition> <action> the UE shall not initiate a periodic registration update procedure, </action> <action> but shall locally de-register from the network. </action> <control> <condition> When the UE is camping on a suitable cell, </condition> <action> it may re-register to regain normal service. </action> </control> </control>
<control> <condition> <condition> When a UE is not registered for emergency services, </condition> and <condition> timer T3512 expires <condition> when the UE is in 5GMM-IDLE mode, </condition> </condition> </condition> <action> the periodic registration update procedure shall be started. </action> </control>
<control> <condition> If the UE is not registered for emergency services, and is <start_state> in a state other than 5GMM-REGISTERED.NORMAL- SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE over 3GPP access </start_state> <condition> when timer T3512 expires, </condition> </condition> <action> the periodic registration update procedure is delayed </action> <condition> until the UE returns to 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE over 3GPP access. </condition> </control>
NOTE 2: <control> <condition> <condition> When the UE returns to 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON- ALLOWED-SERVICE </condition> and <condition> it needs to initiate other 5GMM procedure than the periodic registration update procedure then, </condition> </condition> based on UE implementation, <action> the 5GMM procedure can take precedence. </action> </control>
<control> <action> The network supervises the periodic registration update procedure of the UE by means of the mobile reachable timer. </action> </control>
<control> <condition> If the UE is not registered for emergency services, </condition> <action> the mobile reachable timer shall be longer than the value of timer T3512. </action> <control> <condition> In this case, by default, </condition> <action> the mobile reachable timer is 4 minutes greater than the value of timer T3512. </action> </control> </control>
The network behaviour upon expiry of the mobile reachable timer is network dependent, <control> but typically <action> the network stops sending paging messages to the UE </action> <condition> on the first expiry, </condition> and <action> may take other appropriate actions. </action> </control>
<control> <condition> If the UE is registered for emergency services, </condition> <action> the AMF shall set the mobile reachable timer with a value equal to timer T3512. </action> <control> <condition> When the mobile reachable timer expires, </condition> <action> the AMF shall locally de-register the UE. </action> </control> </control>
<control> <action> The mobile reachable timer shall be reset and started with the value as indicated above, </action> <condition> when the AMF releases the NAS signalling connection for the UE. </condition> </control> <control> <action> The mobile reachable timer shall be stopped </action> <condition> when a NAS signalling connection is established for the UE. </condition> </control>
<control> <condition> Upon expiry of the mobile reachable timer </condition> <action> the network shall start the implicit de-registration timer over 3GPP access. </action> </control>
The value of the implicit de-registration timer over 3GPP access is network dependent. <control> <condition> If MICO mode is activated, </condition> <action> the network shall start the implicit de-registration timer over 3GPP access </action> <condition> when the UE enters 5GMM-IDLE mode at the AMF over 3GPP access. </condition> </control> <control> <action> The default value of the implicit de-registration timer over 3GPP access is 4 minutes greater than the value of timer T3512. </action> </control>
<control> <condition> If the implicit de-registration timer expires <condition> before the UE contacts the network, </condition> </condition> <action> the network shall implicitly de-register the UE. </action> </control> <control> <action> The implicit de-registration timer shall be stopped </action> <condition> when a NAS signalling connection is established for the UE. </condition> </control>
<control> <condition> If the non-3GPP implicit de-registration timer expires <condition> before the UE contacts the network over the non-3GPP access, </condition> </condition> <action> the network shall implicitly de-register the UE and </action> <end_state> enter the state 5GMM-DEREGISTERED over non-3GPP access for the UE. </end_state> </control> <control> <action> The non-3GPP implicit de-registration timer shall be stopped </action> <condition> when a NAS signalling connection over non- 3GPP access is established for the UE. </condition> </control>
<control> <condition> If the non-3GPP de-registration timer expires <condition> before the UE contacts the network over the non-3GPP access, </condition> </condition> <end_state> the UE shall enter the state 5GMM-DEREGISTERED over non-3GPP access. </end_state> </control> <control> <action> non-3GPP de-registration timer shall be stopped </action> <condition> when a NAS signalling connection over non-3GPP access is established for the UE. </condition> </control>
<control> <condition> <condition> If the AMF provides T3346 value IE in the DEREGISTRATION REQUEST message <condition> with Access type set to "Non- 3GPP access" in Deregistration type IE, </condition> </condition> <condition> REGISTRATION REJECT message <condition> during a registration procedure for mobility and periodic registration update </condition> </condition> or <condition> SERVICE REJECT message and the value of timer T3346 is greater than the value of timer T3512, </condition> </condition> <action> the AMF sets the mobile reachable timer and the implicit de-registration timer </action> <condition> such that the sum of the timer values is greater than the value of timer T3346. </condition> </control>
<control> <condition> <condition> If the AMF provides T3346 value IE in the DEREGISTRATION REQUEST message <condition> with Access type set to "3GPP access" in Deregistration type IE, </condition> </condition> <condition> REGISTRATION REJECT message <condition> during a registration procedure for mobility and periodic registration update </condition> </condition> or <condition> SERVICE REJECT message and the value of timer T3346 is greater than the value of the non-3GPP de-registration timer, </condition> </condition> <action> the AMF sets the non-3GPP implicit de-registration timer value to be 8 minutes greater than the value of timer T3346. </action> </control>
<control> <condition> <condition> If the UE receives T3346 value IE in the DEREGISTRATION REQUEST message <condition> with Access type set to "3GPP access" in Deregistration type IE, </condition> </condition> <condition> REJECT message <condition> during a registration procedure for mobility and periodic registration update </condition> </condition> or <condition> SERVICE REJECT message and the value of timer T3346 is greater than the value of the non-3GPP de-registration timer, </condition> </condition> <action> the UE sets the non-3GPP de-registration timer value to be 4 minutes greater than the value of timer T3346. </action> </control>
5.3.8 Handling of timer T3502
The value of timer T3502 can be sent by the network to the UE in the REGISTRATION ACCEPT message. <control> <action> The UE shall apply this value in all tracking areas of the registration area assigned to the UE, </action> <condition> until a new value is received. </condition> </control>
<control> The value of timer T3502 can be sent by the network to the UE in the REGISTRATION REJECT message <condition> during the initial registration. </condition> </control> <control> <condition> If a REGISTRATION REJECT message including timer T3502 value was received integrity protected, </condition> <action> the UE shall apply this value </action> <condition> until a new value is received with integrity protection or a new PLMN is selected. </condition> </control> <control> <condition> Otherwise, </condition> <action> the default value of this timer is used. </action> </control>
<control> <action> The default value of this timer is also used by the UE </action> in the following cases: </control>
<control> <condition> a) REGISTRATION ACCEPT message is received without a value specified; </condition> </control>
<control> <condition> b) the UE does not have a stored value for this timer; </condition> </control>
<control> <condition> c) <condition> a new PLMN which is not in the list of equivalent PLMNs has been entered, </condition> <condition> the initial registration procedure fails, </condition> <condition> the registration attempt counter is equal to 5 and no REGISTRATION REJECT message was received from the new PLMN; </condition> </condition> </control>
<control> <condition> d)the network indicates that the timer is "deactivated"; </condition> </control> or
<control> <condition> e) a new PLMN which is not in the list of equivalent PLMNs has been entered, the mobility and periodic update registration procedure fails and the registration attempt counter is equal to 5. </condition> </control>
5.3.9 Handling of NAS level mobility management congestion control
<control> <action> The AMF may detect 5GMM signalling congestion </action> and <action> perform general NAS level congestion control. </action> <condition> Under the 5GMM signalling congestion conditions </condition> <action> the AMF may reject 5GMM signalling requests from UEs as specified in 3GPP TS 23.501 . </action> <control> <action> The AMF should not reject the following: a) requests for emergency services; b) requests for emergency services fallback; c) requests from UEs configured for high priority access in selected PLMN; d) DEREGISTRATION REQUEST message; e) requests for mobile terminated services, triggered by paging or a notification procedure; and f) requests for initial registration or mobility and periodic registration update, when emergency is indicated by lower layers. </action> </control> </control>
<control> <condition> When general NAS level congestion control is active, </condition> <action> the AMF may include a value for the mobility management back- off timer T3346 in the reject messages. </action> <action> the UE starts the timer T3346 with the value received in the 5GMM reject messages. </action> </control>
<control> <condition> To avoid that large numbers of UEs simultaneously initiate deferred requests, </condition> <action > the AMF should select the value for the timer T3346 for the rejected UEs so that timeouts are not synchronised. </action> </control>
<control> <condition> <condition> If the UE is registered in the same PLMN over the 3GPP access and non-3GPP access, </condition> and <condition> the UE receives the timer T3346 from the AMF, </condition> </condition> <action> timer T3346 shall apply to both 3GPP access and non-3GPP access. </action> </control>
<control> <condition> If the UE receives the paging message or NOTIFICATION message <condition> when timer T3346 is running and the UE is registered to the same PLMN over 3GPP access and non-3GPP access, </condition> </condition> <action> the UE shall stop the timer T3346 for both accesses </action> and <action> respond to the paging message or NOTIFICATION message as specified in subclause 5.6.2 and subclause 5.6.3. </action> </control>
NOTE 1: <control> As an implementation option, <action> MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication. </action> </control>
<control> <condition> If the timer T3346 is running <condition> when the UE enters state 5GMM-DEREGISTERED, </condition> </condition> <action> the UE remains switched on, </action> and <action> the USIM in the UE remains the same </action> , then <action> the timer T3346 is kept running </action> until it expires or it is stopped. </control>
<control> <condition> If the UE is switched off <condition> when the timer T3346 is running, </condition> </condition> <control> <action> the UE shall behave as follows </action> <condition> when the UE is switched on and the USIM in the UE remains the same: </condition> let t1 be the time remaining for T3346 timeout at switch off and let t be the time elapsed between switch off and switch on. <control> <condition> If t1 is greater than t, </condition> <action> the timer shall be restarted with the value t1 t. </action> </control> <control> <condition> If t1 is equal to or less than t, </condition> <action> then the timer need not be restarted. </action> </control> <control> <condition> If the UE is not capable of determining t, </condition> <action> then the UE shall restart the timer with the value t1. </action> </control> </control> </control>
<control> <condition> <condition> If the UE enters a new PLMN <condition> while timer T3346 is running, </condition> </condition> and <condition> the new PLMN is not equivalent to the PLMN <condition> where the UE started timer T3346, </condition> </condition> </condition> <action> the UE shall stop timer T3346 when initiating 5GMM procedures in the new PLMN. </action> </control>
<control> <condition> After a change in registration area, <condition> if the timer T3346 is running and 5GS update status is 5U1 UPDATED </condition> </condition> <action> the UE shall set the 5GS update status to 5U2 NOT UPDATED </action> and <end_state> enter state 5GMM-REGISTERED.ATTEMPTING- REGISTRATION-UPDATE. </end_state> </control>
<control> <condition> <condition> If timer T3346 is running or is deactivated, and the UE is a UE configured for high priority access in selected PLMN, </condition> or <condition> the UE needs to initiate signalling for emergency services or emergency services fallback, </condition> </condition> then <action> the UE is allowed to initiate 5GMM procedures. </action> </control>
NOTE 2: <control> UE can, based on implementation, <action> restrict lower layers of non-3GPP access from establishing access stratum connection on a registered PLMN </action> <condition> when timer T3346 is running for the same PLMN. </condition> </control>
5.3.10 Handling of DNN based congestion control
<control> <action> The AMF may detect and start performing DNN based congestion control </action> <condition> when one or more DNN congestion criteria as specified in 3GPP TS 23.501 are met. </condition> </control> <control> <condition> If the UE does not provide a DNN for a non-emergency PDU session, </condition> <action> then the AMF uses the selected DNN or the DNN associated with the PDU session corresponding to the 5GSM procedure. </action> </control>
<control> <condition> When DNN based congestion control is activated at the AMF, </condition> <action> the AMF performs the congestion control as specified in subclause 5.4.5 </action> and <action> the UE performs the congestion control as specified in subclause 5.4.5 and subclause 6.2.7. </action> </control>
5.3.11 Handling of S-NSSAI based congestion control
<control> <action> The AMF may detect and start performing S-NSSAI based congestion control </action> <condition> when one or more S-NSSAI congestion criteria as specified in 3GPP TS 23.501 are met. </condition> </control> <control> <condition> If the UE does not provide a DNN for a non-emergency PDU session, </condition> <action> then the AMF uses the selected DNN or the DNN associated with the PDU session corresponding to the 5GSM procedure. </action> </control>
<control> <condition> If the UE does not provide an S-NSSAI for a non-emergency PDU session, </condition> then <action> the AMF uses the selected S-NSSAI or the S-NSSAI associated with the PDU session corresponding to the 5GSM procedure. </action> </control>
<control> <condition> When S-NSSAI based congestion control is activated at the AMF, </condition> <action> the AMF performs the congestion control as specified in subclause 5.4.5 </action> and <action> the UE performs the congestion control as specified in subclause 5.4.5 and subclause 6.2.8. </action> </control>
5.3.12 Handling of local emergency numbers
The additional requirements in subclause 5.3.12A apply to a UE supporting registration or attach procedures via 3GPP access and registration procedures via non-3GPP access.
<control> <condition> In case of PLMN, </condition> <action> the network may send a local emergency numbers list or an extended local emergency numbers list or both, </action> <condition> in the REGISTRATION ACCEPT message, by including the Emergency number list IE and the Extended emergency number list IE, respectively. </condition> </control> <control> <action> The Local emergency numbers list can be updated as described in 3GPP TS 24.301 , subclause 5.3.7. </action> </control>
<control> <condition> In case of SNPN, </condition> <action> the network may send an extended local emergency numbers list, </action> <condition> in the REGISTRATION ACCEPT message, by including the Extended emergency number list IE. </condition> </control> <control> <action> The network shall set the Extended Emergency Number List Validity (EENLV) field </action> <condition> within the Extended emergency number list IE to "Extended Local Emergency Numbers </condition> </control>
<control> <action> List is valid </action> only <condition> in the PLMN from which this IE is received". </condition> </control> <control> <action> The UE shall consider the emergency number(s) received in the Extended emergency number list IE valid </action> <condition> only in the SNPN <condition> from which this IE is received regardless of the received value of the EENLV field <condition> within the Extended emergency number list IE. </condition> </condition> </condition> </control>
<control> <action> The UE shall store the local emergency numbers list and the extended local emergency numbers list, as provided by the network. </action> </control> <control> <action> The local emergency numbers list stored in the UE shall be replaced </action> <condition> on each receipt of the Emergency number list IE. </condition> </control> <control> <action> The extended local emergency numbers list stored in the UE shall be replaced </action> <condition> on each receipt of the Extended emergency number list IE. </condition> </control> <control> <action> The received local emergency numbers list or the received extended local emergency numbers list or both shall be provided to the upper layers. </action> </control>
<control> <condition> If a REGISTRATION ACCEPT message is received via non-3GPP access <condition> from a PLMN in a country different from the current country of the UE, </condition> </condition> <action> the UE shall keep the stored local emergency numbers list and the extended local emergency numbers list, </action> <condition> if available. </condition> </control>
<control> <action> The emergency number(s) received in the Emergency number list IE are valid </action> <condition> only in PLMNs <condition> in the same country as the PLMN from which this IE is received. </condition> </condition> </control> <control> <condition> If no Emergency number list IE is contained in the REGISTRATION ACCEPT message, </condition> then <action> the stored local emergency numbers list in the UE shall be kept, </action> <condition> except if the UE has successfully registered to a PLMN <condition> in a country different from that of the PLMN that sent the list. </condition> </condition> </control>
<control> <action> The emergency number(s) received in the Extended emergency number list IE are valid </action> only in </control> : <control> <condition> a) PLMNs in the same country as the PLMN from which this IE is received, <condition> if the Extended Emergency Number List Validity (EENLV) field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid <condition> in the country of the PLMN from which this IE is received"; </condition> </condition> </condition> </control> and <control> <condition> b) the PLMN from which this IE is received, <condition> if the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid <condition> only in the PLMN from which this IE is received"; </condition> </condition> </condition> </control> and <control> <condition> c) the SNPN from which this IE is received, regardless of the value of the EENLV field within the Extended emergency number list IE. </condition> </control>
<control> <condition> <condition> If no Extended Local Emergency Numbers List is contained in the REGISTRATION ACCEPT message, </condition> and <condition> the registered PLMN or the registered SNPN has not changed, </condition> </condition> then <action> the stored Extended Local Emergency Numbers List in the UE shall be kept. </action> </control> <control> <condition> If no Extended Local Emergency Numbers List is contained in the REGISTRATION ACCEPT message, but the registered PLMN or the registered SNPN has changed, </condition> then: <control> <condition> a) if the last received indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid <condition> only in the PLMN from which this IE is received", </condition> </condition> <action> the stored Extended Local Emergency Numbers List in the UE shall be deleted; </action> </control> and <control> <condition> b) if the last received indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid <condition> in the country of the PLMN from which this IE is received" </condition> </condition> <action> the list shall be kept </action> <condition> except if the UE has successfully registered to a PLMN <condition> in a country different from that of the PLMN that sent the stored list. </condition> </condition> </control> </control>
NOTE: <control> <condition> To prevent the misrouting of emergency calls, </condition> <control> <action> all operators within a country need to follow the regulation </action> or <action> agree on the setting of the Extended emergency number list IE </action> <condition> in accordance to national agreement either to indicate validity within a country or to indicate validity only within the PLMN. </condition> </control> </control>
<control> <action> The local emergency numbers list and the extended local emergency numbers list shall be deleted </action> <condition> at switch off or removal of the USIM. </condition> </control> <control> <action> The UE shall be able to store up to ten entries in the local emergency numbers list and up to twenty entries in the Extended local emergency numbers list, </action> <condition> received from the network. </condition> </control>
For the use of the local emergency numbers list and the extended local emergency numbers list by the UE see 3GPP TS 24.301 , subclause 5.3.7.
5.3.12A Handling of local emergency numbers received via 3GPP access and non-3GPP access
5.3.12A.1 General
<control> The requirements in subclause 5.3.12 <condition> with the clarifications and additional conditions in subclause 5.3.12A </condition> <control> <action> apply to a UE supporting: </action> <condition> <condition> a) attach procedures (see 3GPP TS 24.301 ) or registration procedures via 3GPP access; </condition> and b) <condition> registration procedures via non-3GPP access. </condition> </condition> </control> </control>
<control> <action> The UE shall ignore the presence or absence of local emergency numbers list, extended local emergency numbers list or both, </action> <condition> in a REGISTRATION ACCEPT message received via non-3GPP access, <condition> unless conditions in subclause 5.3.12A.2 are met. </condition> </condition> </control>
<control> For the purposes of subclause 5.3.12A, <action> the UE is considered neither registered nor attached over 3GPP access </action> </control> if
<control> 1) <condition> the UE supports 3GPP access to EPC, the UE does not support 3GPP access to 5GC, </condition> and: </control>
<control> a) <start_state> the EMM sublayer is in the EMM-NULL state, </start_state> <start_state> EMM-DEREGISTERED state </start_state> or <start_state> EMM-DEREGISTERED- INITIATED state; </start_state> </control> or
<control> 2) <condition> the UE supports 3GPP access to 5GC, the UE does not support 3GPP access to EPC, </condition> </control> and:
<control> a) <start_state> the 5GMM sublayer is in the 5GMM-NULL state, </start_state> <start_state> 5GMM-DEREGISTERED state </start_state> or <start_state> 5GMM- DEREGISTERED-INITIATED state; </start_state> </control> or
<control> 3) <condition> support both 3GPP access to EPC and 3GPP access to 5GC, </condition> and: </control>
<control> a) <start_state> the EMM sublayer is in the EMM-NULL state, </start_state> <start_state> EMM-DEREGISTERED state </start_state> <start_state> EMM-DEREGISTERED- INITIATED state; </start_state> </control> and
<control> b) <start_state> the 5GMM sublayer is in the 5GMM-NULL state, </start_state> <start_state> 5GMM-DEREGISTERED state </start_state> or <start_state> 5GMM-DEREGISTERED-INITIATED state. </start_state> </control>
5.3.12A.2 Receiving a REGISTRATION ACCEPT message via non-3GPP access
<control> <condition> <condition> If the UE can determine the current country </condition> and <condition> after switch on or after removal of the USIM, has not been registered or has not been attached via 3GPP access in the current country, </condition> </condition> then <action> the UE shall store the local emergency numbers list or the extended local emergency numbers list or both, as provided by the network with an MCC matching the current country via non-3GPP access. </action> </control>
NOTE: The UE determines, as the current country, the country in which it is located in accordance with 3GPP TS 24.502 .
<control> <control> <action> The UE shall replace a previously stored local emergency numbers list or a previously stored extended local emergency numbers list or both with a local emergency numbers list or an extended local emergency numbers list or both </action> <condition> received in a REGISTRATION ACCEPT message via non-3GPP access, </condition> </control> <condition> if the previously stored local emergency numbers list was also received via non-3GPP access or the previously stored extended local emergency numbers list was also received via non-3GPP access. </condition> </control>
<control> <action> The UE shall replace a previously stored extended local emergency numbers list with an extended local emergency numbers list </action> <condition> received in a REGISTRATION ACCEPT message via non-3GPP access, </condition> <condition> if : <condition> a) the UE is neither registered nor attached over 3GPP access; </condition> b) <condition> the REGISTRATION ACCEPT message is received from a PLMN different from which the stored list was received; </condition> and c) <condition> the stored indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received". </condition> </condition> </control>
<control> <condition> <condition> If no extended local emergency numbers list is contained in a REGISTRATION ACCEPT message received via non- 3GPP access </condition> and <condition> the UE is neither registered nor attached over 3GPP access, </condition> </condition> <action> the stored extended local emergency numbers list in the UE shall be discarded </action> <condition> if: <condition> a) <condition> the UE can determine the current country </condition> and <condition> the UE has successfully registered to a PLMN in the country and <condition> that country is different from that of the PLMN that sent the stored list; </condition> </condition> </condition> or b) <condition> <condition> the REGISTRATION ACCEPT message is received from a PLMN different from which the stored list was received, </condition> and <condition> the stored indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received". </condition> </condition> </condition> </control>
5.3.13 Lists of 5GS forbidden tracking areas
<control> <condition> If the UE is not operating in SNPN access operation mode, </condition> <action> the UE shall store a list of "5GS forbidden tracking areas for roaming", as well as a list of "5GS forbidden tracking areas for regional provision of service". </action> </control> <control> <condition> Otherwise </condition> <action> the UE shall store a list of "5GS forbidden tracking areas for roaming": a) per SNPN; </action> <control> <condition> b) if the UE supports access to an SNPN using credentials from a credentials holder, </condition> <action> per entry of the "list of subscriber data" or PLMN subscription; </action> </control> and <action> store a list of "5GS forbidden tracking areas for regional provision of service": c) per SNPN; </action> and <control> <condition> d) if the UE supports access to an SNPN using credentials from a credentials holder, </condition> <action> per entry of the "list of subscriber data" or PLMN subscription. </action> </control> </control>
<control> <action> Within the 5GS, these lists are managed independently per access type, i.e., 3GPP access or wireline access. </action> <control> <action> These lists shall be erased </action> <condition> when: <condition> <condition> a) the UE is switched off, the UICC containing the USIM is removed, an entry of the "list of subscriber data" with the subscribed SNPN identity identifying the current SNPN is updated or, </condition> </condition> <condition> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, </condition> the entry of the "list of subscriber data" associated with the lists is updated; </condition> </condition> and b) <condition> periodically </condition> (with a period in the range 12 to 24 hours). </control> </control>
<control> <condition> Over 3GPP access, when the lists are erased, </condition> <action> the UE performs cell selection according to 3GPP TS 38.304 or 3GPP TS 36.304 . </action> </control> <control> <action> A tracking area shall be removed from the list of "5GS forbidden tracking areas for roaming", as well as the list of "5GS forbidden tracking areas for regional provision of service", </action> <condition> if the UE receives the tracking area in the TAI list or the Service area list of "allowed tracking areas" <condition> in REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message. </condition> </condition> </control> <control> <action> The UE shall not remove the tracking area from "5GS forbidden tracking areas for roaming" or "5GS forbidden tracking areas for regional provision of service" </action> <condition> if the UE is registered for emergency services. </condition> </control>
<control> <condition> In N1 mode over 3GPP access, </condition> <action> the UE shall update the suitable list </action> <condition> <condition> whenever a REGISTRATION REJECT, SERVICE REJECT or DEREGISTRATION REQUEST message is received <condition> with the 5GMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking area", </condition> </condition> or <condition> a REGISTRATION ACCEPT or SERVICE ACCEPT message is received with the forbidden TAI(s). </condition> </condition> </control>
<control> <condition> Over wireline access, </condition> the 5G-RG, the W-AGF acting on behalf of an FN-RG or the W-AGF acting on behalf of an N5GC device <action> shall update the suitable list </action> <condition> whenever a REGISTRATION REJECT, SERVICE REJECT or DEREGISTRATION REQUEST message is received <condition> with the 5GMM cause #12 "tracking area not allowed" or #13 "roaming not allowed in this tracking area" </condition> </condition> . </control>
NOTE: <control> In this release of the specification, <condition> for untrusted non-3GPP access and trusted non-3GPP access, </condition> neither the list of "5GS forbidden tracking areas for roaming" nor the list of "5GS forbidden tracking areas for regional provision of service" is maintained by the UE since the UE is not able to determine the corresponding TAI. </control>
<control> <action> Each list shall accommodate 40 or more TAIs. </action> <condition> When the list is full and a new entry has to be inserted, </condition> <action> the oldest entry shall be deleted. </action> </control>
5.3.13A Forbidden PLMN lists
<control> <condition> In N1 mode, </condition> <action> two lists of forbidden PLMN are managed independently per access type, i.e., 3GPP access or non-3GPP access: </action> <control> a) <action> the list of "forbidden PLMNs" as defined in 3GPP TS 23.122 is applicable for 3GPP access </action> <condition> in N1 mode. </condition> <action> The same list is used by 5GMM for 3GPP access, EMM, GMM and MM (see 3GPP TS 24.301 and 3GPP TS 24.008 ), regardless whether the UE is operating in single-registration mode or dual-registrationmode. </action> </control> b) <action> the list of "forbidden PLMNs for non-3GPP access to 5GCN" as defined in 3GPP TS 24.502 is applicable for 5GMM for non-3GPP access. </action> </control>
<control> <action> The list of "forbidden PLMNs for GPRS service" as defined in 3GPP TS 23.122 and 3GPP TS 24.008 is applicable for 3GPP access </action> <condition> in N1 mode. </condition> <action> The same list is used by 5GMM for 3GPP access, EMM and GMM (see 3GPP TS 24.301 and 3GPP TS 24.008 ), regardless whether the UE is operating in single-registration mode or dual-registration mode. </action> </control>
5.3.14 List of equivalent PLMNs
<control> <action> The UE shall store a list of equivalent PLMNs. </action> <action> These PLMNs shall be regarded by the UE as equivalent to each other for PLMN selection and cell selection/re-selection. </action> <action> The same list is used by 5GMM, EMM, GMM and MM (see 3GPP TS 24.301 and 3GPP TS 24.008 ) <condition> except for the case when the UE operates in dual-registration mode (see subclause 4.8.3). </condition> </action> </control>
<control> <action> The UE shall update or delete this list </action> <condition> at the end of each registration procedure. </condition> <action> The stored list consists of a list of equivalent PLMNs as downloaded by the network plus the PLMN code of the registered PLMN that downloaded the list. </action> <control> <condition> When the UE is switched off, </condition> <action> the UE shall keep the stored list so that it can be used for PLMN selection after switch on. </action> </control> <control> <action> The UE shall delete the stored list </action> <condition> if the USIM is removed or when the UE registered for emergency services <end_state> enters the state 5GMM-DEREGISTERED. </end_state> </condition> The maximum number of possible entries in the stored list is 16. </control> </control>
5.3.15 Transmission failure abnormal case in the UE
The abnormal case 5GMM uplink message transmission failure indication by lower layers can be identified for 5GMM procedures:
<control> <condition> When it is specified in the relevant procedure that <condition> it is up to the UE implementation to re-run the ongoing procedure that triggered that procedure, </condition> </condition> <action> the procedure can typically be re-initiated using a retransmission mechanism of the uplink message (i.e. the one that has previously failed to be transmitted) </action> <condition> with new sequence number and message authentication code information thus avoiding to re-start the whole procedure. </condition> </control>
NOTE: <control> The transmission failure can happen due to TAI change. The lower layer might take some time to read the system information and determine <condition> if the current TAI is changed. </condition> Therefore, the information of TAI change can be sent to the NAS layer a little <condition> after receiving the transmission failure indication from the lower layer. </condition> How to handle the retransmission procedure caused by the possible delayed TAI change information is up to UE implementation. </control>
5.3.16 Extended DRX cycle for UEs in 5GMM-IDLE and 5GMM- CONNECTED mode with RRC inactive indication
Extended DRX (eDRX) cycle is supported for a UE in N1 mode. <control> <condition> When eDRX is requested by the UE and accepted by the network: </condition> <control> <condition> a) if the UE is not in NB-N1 mode, </condition> <action> eDRX is used </action> <condition> when the UE is in 5GMM-IDLE mode or in 5GMM- CONNECTED mode with RRC inactive indication; </condition> </control> or <control> <condition> b) if the UE is in NB-N1 mode, </condition> <action> eDRX is used </action> <condition> when the UE is in 5GMM-IDLE mode. </condition> </control> </control>
<control> <action> The UE may request the use of eDRX cycle </action> <condition> during a registration procedure by including the Requested extended DRX parameters IE (see 3GPP TS 23.501 and 3GPP TS 23.502 ). </condition> </control> <control> <action> The UE shall not request the use of eDRX </action> <condition> during a registration procedure for emergency services. </condition> </control> <control> <action> The UE may use the extended idle mode DRX cycle length stored in the USIM (see 3GPP TS 31.102 ) </action> <condition> when requesting the use of eDRX. </condition> </control>
<control> <action> The UE and the network may negotiate eDRX parameters </action> <condition> during a registration procedure when the UE has an emergency PDU session. </condition> </control>
<control> <action> The network accepts the request to use the eDRX by providing the Negotiated extended DRX parameters IE </action> <condition> when accepting the registration procedure. </condition> </control> <control> The UE shall use eDRX <condition> only if it received the Negotiated extended DRX parameters IE <condition> during the last registration procedure </condition> and the UE does not have an emergency PDU session. </condition> </control>
NOTE: <control> <condition> If the UE wants to keep using eDRX, </condition> <action> the UE includes the Extended DRX parameters IE in each registration procedure. </action> </control>
<control> <condition> If the UE received the Negotiated extended DRX parameters IE during the last registration procedure, <condition> upon successful completion of the PDU session release procedure of the emergency PDU session, </condition> </condition> <action> the UE shall resume eDRX. </action> </control>
<control> <condition> If the network has provided the Negotiated extended DRX parameters IE during the last registration procedure, <condition> upon successful completion of the PDU session release procedure of the emergency PDU session, </condition> </condition> <action> the network shall resume eDRX. </action> </control>
<control> <condition> If the UE or the network locally releases an emergency PDU session, </condition> <action> the UE or the network shall not use eDRX </action> <condition> <condition> until the UE receives eDRX parameters <condition> during a registration procedure with PDU session context synchronization </condition> </condition> or <condition> upon successful completion of a service request procedure with PDU session context synchronization. </condition> </condition> </control>
<control> <condition> If the UE did not receive the Negotiated extended DRX parameters IE, or if the UE has an emergency PDU session, </condition> <action> the UE shall use the stored UE specific DRX parameter, </action> <condition> if available. </condition> </control>
<control> <condition> If the network did not accept the request to use eDRX, or if the UE has an emergency PDU session, </condition> <action> the network shall use the stored UE specific DRX parameter, </action> <condition> if available. </condition> </control>
<control> <condition> If the network provided the Negotiated extended DRX parameters IE and also assigned a new 5G-GUTI for the UE as described in subclause 5.5.1.3.4 <condition> during the last registration procedure, </condition> </condition> <control> <action> the network shall use the stored UE specific DRX parameter, </action> <condition> <condition> if available, </condition> <condition> with the old 5G-GUTI and use the eDRX provided by the network with the new 5G-GUTI </condition> <condition> until the old 5G-GUTI can be considered as invalid by the network </condition> </condition> (see subclauses 5.4.4.4 and 5.5.1.3.4). </control> </control>
5.3.17 Service Gap Control
Service gap control (SGC) only applies to 3GPP access.
<control> <action> The network may control the frequency </action> <condition> with which </condition> <action> UEs can transition from 5GMM-IDLE mode to 5GMM- CONNECTED mode via the SGC as specified in 3GPP TS 23.501 and 3GPP TS 23.502 . </action> </control> <control> <condition> If the network supports SGC and the service gap time value i.e. T3447 value is available in the 5GMM context of the UE, </condition> <action> the AMF shall consider SGC as active for the UE. </action> </control>
<control> <action> The UE and the network negotiate usage of SGC </action> <condition> during the registration procedure for initial registration and registration procedure for mobility and periodic registration update: </condition> <control> a) <action> <condition> the UE supporting SGC </condition> indicates its support in the REGISTRATION REQUEST message. </action> <condition> If the UE supports SGC and the SGC is active for the UE, </condition> <action> the AMF includes T3447 value IE in the REGISTRATION ACCEPT message (see subclause 5.5.1.2 and subclause 5.5.1.3). </action> <action> The UE stores the T3447 value; </action> </control> and <control> <condition> b) for UEs that do not support SGC <condition> when the network rejects mobility management signalling requests because SGC is active in the network, </condition> </condition> <action> the mechanism for general NAS level mobility management congestion control as specified in subclause 5.3.9 applies. </action> </control> </control>
<control> <action> The network can provide a new T3447 value to the UE to be used next time it is started or stop timer T3447 in the UE </action> <condition> if running with the Generic UE configuration update procedure as specified in subclause 5.4.4. </condition> </control>
<control> <action> The UE shall start timer T3447 </action> <condition> when the N1 NAS signalling connection is released </condition> and if: </control> <control> <condition> a) the UE supports SGC, and the T3447 value is available in the UE and does not indicate zero; </condition> </control> and <control> <condition> b) the N1 NAS signalling connection released was not established for: </condition> </control> <control> c) <condition> paging; </condition> </control> <control> <condition> d) registration procedure for initial registration with Follow-on request indicator set to "No follow-on request pending"; </condition> </control> <control> <condition> e)registration procedure for mobility and periodic registration update with Follow-on request indicator set to "No follow-on request pending" and without Uplink data status IE included; </condition> </control> <control> <condition> f) requests for emergency services; </condition> </control> or <control> <condition> g) requests for exception data reporting. </condition> </control>
<control> <condition> If the SGC is active in the network, <condition> after the UE transitions from 5GMM-CONNECTED mode to 5GMM-IDLE mode </condition> </condition> except when the UE was in 5GMM-CONNECTED mode due to: </control> <control> <condition> a) paging; </condition> </control> <control> <condition> b) registration procedure for initial registration <condition> with Follow-on request indicator set to "No follow-on request pending"; </condition> </condition> </control> <control> <condition> c) registration procedure for mobility and periodic registration update <condition> with Follow-on request indicator set to "No follow-on request pending" and without Uplink data status IE included, </condition> </condition> </control> <control> <condition> d) requests for emergency services; </condition> </control> or <control> <condition> e) requests for exception data reporting, </condition> </control> <control> <action> the network shall start timer T3447 </action> <condition> if not already running: f) <condition> with the T3447 value available in the 5GMM context minus 4 minutes, <condition> if the UE supports SGC and the T3447 value has been sent to the UE with a non-zero value; </condition> </condition> or g) <condition> with the T3447 value available in the 5GMM context if the UE does not support SGC. </condition> </condition> </control>
<control> <condition> When timer T3447 is running, </condition> <action> the network allows: a) requests for emergency service; b) requests for emergency services fallback; c) requests for high priority access; d) requests for exception data reporting; e) registration procedure for initial registration with Follow-on request indicator set to "No follow-on request pending"; f) registration procedure for mobility and periodic registration update without Uplink data status IE included and with Follow-on request indicator set to "No follow-on request pending"; or g) service request procedure or registration procedure for mobility and periodic registration update triggered by paging and subsequent MO signalling or MO data, if any, until the UE enters 5GMM-IDLE mode. </action> </control>
<control> <action> The UE or the network with a running T3447 timer keeps the timer running </action> <condition> when the UE transits from 5GMM-IDLE mode to 5GMM-CONNECTED mode. </condition> </control>
NOTE: <control> <condition> If the UE transitions from 5GMM-IDLE mode to 5GMM-CONNECTED mode <condition> due to registration procedure for initial registration <condition> with Follow-on request indicator set to "No follow-on request pending" mobility </condition> and periodic registration update request <condition> without Uplink data status IE and with Follow-on request indicator set to "No follow-on request pending", </condition> </condition> </condition> <action> the UE initiates no further MO signalling </action> <condition> <condition> except for mobility and periodic registration update requests <condition> without Uplink data status and with Follow-on request indicator set to "No follow-on request pending" </condition> <condition> until the UE receives mobile terminated signalling (e.g. DL NAS TRANSPORT message for MT SMS) or MT data over user plane, </condition> </condition> or <condition> after the UE has moved to 5GMM-IDLE state and the service gap timer is not running. </condition> </condition> </control>
<control> <condition> If timer T3447 is running <condition> when the UE changes PLMN or enters state 5GMM-DEREGISTERED, </condition> </condition> <action> the UE remains switched on, </action> and <action> the USIM in the UE remains the same, </action> <action> then timer T3447 is kept running </action> <condition> until it expires. </condition> </control>
<control> <condition> <condition> If the AMF determines that the UE operating in single-registration mode has performed an inter-system change from N1 mode to S1 mode </condition> and <condition> the timer T3447 is running in the AMF, </condition> </condition> <action> the AMF stops the T3447. </action> </control>
<control> <condition> <condition> Upon inter-system change from S1 mode to N1 mode, </condition> if the UE supports service gap control, T3447 is running in the UE, and the T3447 value IE is included in the REGISTRATION ACCEPT message received from the AMF (see subclause 5.5.1.2 and subclause 5.5.1.3), </condition> <action> the UE shall keep T3447 running. </action> Additionally, <action> the UE shall store and replace the currently stored service gap time value with the received T3447 value. </action> <control> <condition> Upon expiry of the running T3447 timer, </condition> <action> the UE shall use the new value when starting T3447 again. </action> </control> </control>
<control> <condition> If the UE is switched off <condition> when the timer T3447 is running, </condition> </condition> <control> <action> the UE shall behave as follows </action> <condition> when the UE is switched on and the USIM in the UE remains the same: </condition> a) <action> let t1 be the time remaining for timer T3447 timeout at switch off and let t be the time elapsed between switch off and switch on. </action> <control> <condition> If t1 is greater than t, </condition> then <action> the timer shall be restarted with the value t1 t. </action> </control> <control> <condition> If t1 is equal to or less than t, </condition> <action> then the timer need not be restarted. </action> </control> <control> <condition> It the UE is not capable of determining t, </condition> <action> then the UE shall restart the timer with the value t1. </action> </control> </control> </control>
5.3.18 Restriction on use of enhanced coverage
<control> <condition> In order to deal with use of extensive resources from the network, </condition> <action> the operator may prevent specific subscribers from using enhanced coverage (see 3GPP TS 23.501 ). </action> </control> <control> <condition> When in NB-N1 mode, </condition> <action> the UE shall indicate support for restriction on use of enhanced coverage. </action> </control> <control> <condition> When in WB-N1 mode, </condition> <condition> the UE supporting either CE mode A or CE mode B </condition> <action> shall indicate support for restriction on use of enhanced coverage. </action> </control> <control> <condition> The UE supporting restriction on use of enhanced coverage </condition> <action> indicates its support for restriction on use of enhanced coverage in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports restriction on use of enhanced coverage, </condition> <action> the AMF indicates in the REGISTRATION ACCEPT message </action> (see subclause 5.5.1.2 and subclause 5.5.1.3) that: <condition> <condition> a) when in WB-N1 mode, whether CE mode B is restricted for the UE, or both CE mode A and CE mode B are restricted for the UE, or both CE mode A and CE mode B are not restricted for the UE; or </condition> b) <condition> when in NB-N1 mode, whether the use of enhanced coverage is restricted or not for the UE. </condition> </condition> </control>
<control> <condition> If <condition> a) the use of enhanced coverage is restricted; </condition> b) <condition> the use of CE mode B is restricted; or </condition> c) <condition> the use of CE mode A and CE mode B is restricted, </condition> </condition> <action> the UE shall not use enhanced coverage in the registered PLMN and in any PLMN which is in the list of equivalent PLMNs. </action> </control>
<control> <condition> If the UE supports CE mode B and the network determines that <condition> <condition> a) the use of enhanced coverage is not restricted for the UE; </condition> or b) <condition> CE mode B is not restricted for the UE, </condition> </condition> </condition> <action> the applicable NAS timer values shall be calculated by the network as described in subclause 4.19 and subclause 4.20. </action> </control>
<control> <condition> For a UE that supports restriction on use of enhanced coverage or CE mode B, <condition> if: <condition> a) the AMF determines to enforce a change in restriction on the use of enhanced coverage or a change in the restriction on the use of CE mode B as described in 3GPP TS 23.501 ; </condition> and b) <condition> the UE is in 5GMM-CONNECTED mode and there is no ongoing registration procedure, </condition> </condition> </condition> <action> the AMF shall initiate the generic UE configuration update procedure to indicate registration requested and release of the N1 NAS signalling connection not requested as described in subclause 5.4.4. </action> <control> <condition> <condition> After the successful completion of the registration procedure for mobility registration update including change of the restriction on the use of enhanced coverage, </condition> for any SMF with which the UE has an established PDU session, </condition> <action> the AMF updates the SMF with the indication on the use of extended NAS timer setting as described in 3GPP TS 23.501 and 3GPP TS 23.502. </action> </control> </control>
5.3.19 Handling of congestion control for transport of user data via the control plane
<control> <action> The network may activate congestion control for transport of user data via the control plane, as specified in 3GPP TS 23.501 . </action> </control>
<control> <condition> <condition> If the UE has indicated support for the control plane CIoT 5GS optimizations </condition> and <condition> the network decides to activate the congestion control for transport of user data via the control plane, </condition> </condition> <action> the network may include a value for the control plane data back-off timer T3448 in REGISTRATION ACCEPT, SERVICE ACCEPT or SERVICE REJECT message, </action> and <action> shall store an control plane data back-off time on a per UE basis. </action> <action> The UE starts the timer T3448 with the value informed in the message. </action> <control> <condition> To avoid that large numbers of UEs simultaneously initiate deferred requests, </condition> <action> the network should select the value for the timer T3448 for the informed UEs so that timeouts are not synchronised. </action> </control> </control>
<control> <action> The network sends REGISTRATION ACCEPT message or SERVICE ACCEPT message </action> <condition> without T3448 value IE to stop the timer T3448 running in the UE as specified in subclause 5.5.1.3.4 and subclause 5.6.1.4. </condition> </control>
<control> <condition> Based on the stored control plane data back-off time for the UE, </condition> <action> the network may reject the transfer of user data via the control plane initiated by the UE. </action> </control>
<control> <condition> While the timer T3448 is running, </condition> <action> the UE in 5GMM-IDLE mode does not initiate the transport of user data via the control plane procedure, </action> <condition> except if the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ) and the user data is related to an exceptional event. </condition> </control>
<control> <action> The UE is allowed: a) to respond to paging with CONTROL PLANE SERVICE REQUEST message without uplink data; </action> or b) <action> to send a CONTROL PLANE SERVICE REQUEST message for emergency services or for emergency services fallback; </action> <condition> even if the timer T3448 is running. </condition> </control>
<control> <condition> Upon entering the state 5GMM-DEREGISTERED or a new PLMN <condition> which is not equivalent to the PLMN where the UE started the timer T3448 </condition> , or upon being switched off while the timer T3448 is running, </condition> <action> the UE stops the timer T3448. </action> </control>
5.3.19a Specific requirements for UE configured to use timer T3245
5.3.19a.1 UE not operating in SNPN access operation mode
The following requirements apply for a UE that is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ).
<control> <condition> <condition> When the UE adds a PLMN identity to the "forbidden PLMN list" or sets the USIM as invalid for 5GS services for 3GPP access or non-3GPP access, </condition> and <condition> timer T3245 (see 3GPP TS 24.008 ) is not running, </condition> </condition> <action> the UE shall start timer T3245 as specified in 3GPP TS 24.008 , subclause 4.1.1.6. </action> </control>
<control> <condition> Upon expiry of the timer T3245, </condition> <action> the UE shall erase the "forbidden PLMN list" and "forbidden PLMNs for GPRS service" list </action> and <action> set the USIM to valid for 5GS services for 3GPP access and non-3GPP access. </action> <control> <condition> When the lists are erased, </condition> <action> the UE performs cell selection according to 3GPP TS 38.304 or 3GPP TS 36.304. </action> </control> </control>
<control> <condition> If the UE is switched off when the timer T3245 is running, </condition> <control> <action> the UE shall behave as follows </action> <condition> when the UE is switched on and the USIM in the UE remains the same: </condition> a) <action> let t1 be the time remaining for T3245 timeout at switch off and let t be the time elapsed between switch off and switch on. </action> <control> <condition> If t1 is greater than t, </condition> then <action> the timer shall be restarted with the value t1 t. </action> </control> <control> <condition> If t1 is equal to or less than t, </condition> then <action> the UE will follow the behaviour as defined in the paragraph above upon expiry of the timer T3245. </action> </control> <control> <condition> If the UE is not capable of determining t, </condition> <action> then the UE shall restart the timer with the value t1. </action> </control> </control> </control>
5.3.19a.2 UE operating in SNPN access operation mode
The following requirements apply for a UE that is configured to use timer T3245 (see 3GPP TS 24.368 ).
<control> <condition> When the UE adds an SNPN to the "permanently forbidden SNPNs" list or "temporarily forbidden SNPNs" list which are, <condition> <condition> if the MS supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> or <condition> sets the selected entry of the "list of subscriber data" or the selected PLMN subscription as invalid for 3GPP access or non-3GPP access, </condition> </condition> and <condition> timer T3245 (see 3GPP TS 24.008 ) is not running, </condition> </condition> <action> the UE shall start timer T3245 with a random value, uniformly drawn from the range between 12h and 24h. </action> </control>
<control> <condition> Upon expiry of the timer T3245, </condition> <action> the UE shall erase the "permanently forbidden SNPNs" list(s) and "temporarily forbidden SNPNs" list(s) </action> and <action> set the selected entry of the "list of subscriber data" or the selected PLMN subscription to valid for 3GPP access and non-3GPP access. </action> <control> <condition> When the lists are erased, </condition> <action> the UE performs cell selection according to 3GPP TS 38.304. </action> </control> </control>
<control> <condition> If the UE is switched off when the timer T3245 is running, </condition> <control> <action> the UE shall behave as follows </action> <condition> when the UE is switched on and the selected entry of the "list of subscriber data" or the selected PLMN subscription remain the same: </condition> a) <action> let t1 be the time remaining for T3245 timeout at switch off and let t be the time elapsed between switch off and switch on. </action> <control> <condition> If t1 is greater than t, </condition> then <action> the timer shall be restarted with the value t1 t. </action> </control> . <control> <condition> If t1 is equal to or less than t, </condition> then <action> the UE will follow the behaviour as defined in the paragraph above upon expiry of the timer T3245. </action> </control> <control> <condition> If the UE is not capable of determining t, </condition> <action> then the UE shall restart the timer with the value t1. </action> </control> </control> </control>
5.3.20 Specific requirements for UE when receiving non-integrity protected reject messages
5.3.20.1 General
This subclause specifies the requirements for a UE that is not configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) and receives a REGISTRATION REJECT or SERVICE REJECT message without integrity protection with specific 5GMM causes.
NOTE: Additional UE requirements for this case, requirements for other 5GMM causes, and requirements for the case when the UE receives an integrity protected reject message are specified in subclauses 5.5.1 and 5.3.20.2 Requirements for UE in a PLMN
5.3.20.2 Requirements for UE in a PLMN
<control> <action> The UE shall maintain: a) a list of PLMN-specific attempt counters (see 3GPP TS 24.301 ). <control> The maximum number of possible entries in the list is implementation dependent. This list is applicable to access attempts via 3GPP access only; </control> b) a list of PLMN-specific attempt counters for non-3GPP access, <condition> if the UE supports non-3GPP access. </condition> <control> The maximum number of possible entries in the list is implementation dependent. This list is applicable to access attempts via non-3GPP access only; </control> c) <action> a list of PLMN-specific N1 mode attempt counters for 3GPP access. </action> <control> The maximum number of possible entries in the list is implementation dependent. This list is applicable to access attempts via 3GPP access only; </control> d) a list of PLMN-specific N1 mode attempt counters for non-3GPP access, <condition> if the UE supports non-3GPP access. </condition> <control> The maximum number of possible entries in the list is implementation dependent. This list is applicable to access attempts via non-3GPP access only; </control> e) one counter for "SIM/USIM considered invalid for GPRS services" events (see 3GPP TS 24. 008 ); and f) one counter for "USIM considered invalid for 5GS services over non-3GPP access" events, <condition> if the UE supports non-3GPP access. </condition> </action> </control>
<control> A UE <condition> supporting non-EPS services </condition> <action> shall maintain one counter for "SIM/USIM considered invalid for non-GPRS services" events </action> </control> (see 3GPP TS 24.008 ).
<control> <action> The UE shall store the above lists of attempt counters and the event counters in its non-volatile memory. </action> </control> <control> <control> <action> The UE shall erase the lists and reset the event counters to zero </action> <condition> when the UICC containing the USIM is removed. </condition> </control> <action> The counter values shall not be affected by the activation or deactivation of MICO mode or power saving mode </action> </control> (see 3GPP TS 24.301 ).
<control> <action> The UE implementation-specific maximum value for any of the above counters shall not be greater than 10. </action> </control>
NOTE 1: Different counters can use different UE implementation-specific maximum values.
<control> <condition> If the UE receives a REGISTRATION REJECT or SERVICE REJECT message without integrity protection with 5GMM cause value #3, #6, #7, #11, #12, #13, #15, #27, #31, #62, #72 or #73 <condition> before the network has established secure exchange of NAS messages for the N1 NAS signalling connection, </condition> </condition> <action> the UE shall stop timer T3510 or T3517 </action> <condition> if running, </condition> and <action> start timer T3247 (see 3GPP TS 24.008 [12]) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, </action> <condition> if the timer is not running, </condition> and take the following actions: </control>
<control> 1) <condition> if the 5GMM cause value received is #3, #6 or #7, </condition> </control> and
<control> <condition> a) if the 5GMM cause value is received over 3GPP access, </condition> </control> the UE shall:
<control> <condition> i) if the UE is already registered over another access: </condition> a) <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming", </action> <action> memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for non-integrity protected NAS reject message </action> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; </end_state> and b) <action> search for a suitable cell in another tracking area according to 3GPP TS 38.304 or 3GPP TS 36.304 ; </action> </control> or
<control> ii) <condition> otherwise, <condition> if the counter <condition> for "SIM/USIM considered invalid for GPRS services" events </condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> </control> <control> a) <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI for 3GPP access; </action> </control> <control> b) <condition> if the 5GMM cause value received is #3 or #6, </condition> <action> delete the list of equivalent PLMNs </action> <condition> if any; </condition> </control> <control> c) <action> increment the counter for "SIM/USIM considered invalid for GPRS services" events; </action> </control> <control> <condition> d) <condition> if the 5GMM cause value received is #3 or #6, </condition> and <condition> if the counter for "SIM/USIM considered invalid for non-GPRS services" events <condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> </condition> <action> increment the counter; </action> </control> <control> <condition> e) <condition> if a registration procedure was performed, reset the registration attempt counter </condition> and <condition> if a service request procedure was performed, </condition> </condition> <action> reset the service request attempt counter; </action> </control> <control> <condition> f) if the UE is operating in single-registration mode, </condition> <action> handle the EMM parameters EMM state, EPS update status, EPS attach attempt counter, tracking area updating attempt counter or service request attempt counter, 4G-GUTI, TAI list, eKSI as specified in 3GPP TS 24.301 for the case </action> <condition> when the EPS attach, tracking area updating procedure or service request procedure is rejected with the EMM cause of the same value in a NAS message without integrity protection; </condition> </control> <control> g) <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming", </action> <action> memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for non-integrity protected NAS reject message </action> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; </end_state> </control> and <control> h) <action> search for a suitable cell in another tracking area according to 3GPP TS 38.304 or 3GPP TS 36.304 ; </action> and as a UE implementation option, <action> the UE may perform registration attempt over the non-3GPP access, </action> <condition> if non-3GPP access is available, </condition> and <action> the USIM is not considered invalid for 5GS services over non-3GPP access; </action> </control> and
<control> iii) <condition> otherwise </condition> <action> proceed as specified in subclauses 5.5.1 and 5.6.1; </action> </control>
<control> <condition> b) if the 5GMM cause value is received over non-3GPP access, </condition> the UE shall </control> :
<control> <condition> i) if the UE is already registered over another access: </condition> a) <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; </end_state> and b) <action> may perform registration attempt over the non-3GPP access </action> <condition> if another access point for non-3GPP access is available; </condition> </control> or
<control> ii) <condition> otherwise, <condition> if the counter <condition> for "USIM considered invalid for 5GS services over non-3GPP access" events </condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> </control> <control> a) <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete the 5G-GUTI, last visited registered TAI, TAI list and ngKSI for non-3GPP access; </action> </control> <control> b) <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; </end_state> </control> <control> c) <action> increment the counter for "USIM considered invalid for 5GS services over non-3GPP access" events; </action> and <action> as a UE implementation option, the UE may either perform registration attempt over the non- 3GPP access </action> <condition> if another access point for non-3GPP access is available, </condition> </control> or <control> <condition> <condition> if 3GPP access is available, </condition> and <condition> the SIM/USIM is not considered invalid for 5GS services over 3GPP access, </condition> </condition> <action> perform registration attempt over the 3GPP access; </action> </control> and NOTE 2: How to select another access point for non-3GPP access is implementation specific.
<control> iii) <condition> otherwise </condition> <action> proceed as specified in subclauses 5.5.1 and 5.6.1; </action> </control>
<control> 2) <condition> if the 5GMM cause value received is #12, #13 or #15, </condition> <action> the UE shall proceed as specified in subclauses 5.5.1 </action> and </control>
<control> <condition> a) <condition> if the 5GMM cause value is received over 3GPP access, non-3GPP access is available, </condition> <condition> the UE is not registered over non-3GPP access yet, </condition> and <condition> the USIM is not considered invalid for 5GS services over non- 3GPP access, </condition> </condition> <action> perform registration attempt over the non-3GPP access; </action> </control> or
<control> <condition> b) <condition> if the 5GMM cause value is received over non-3GPP access, 3GPP access is available, </condition> <condition> the UE is not registered over 3GPP access yet, </condition> and <condition> the USIM is not considered invalid for 5GS services over 3GPP access, </condition> </condition> <action> perform registration attempt over the 3GPP access; </action> </control>
3) <control> <condition> if the 5GMM cause value received is #11 or #73 and the UE is in its HPLMN or EHPLMN: </condition> </control>
<control> <condition> a) if the 5GMM cause value is received over 3GPP access, </condition> the UE shall: </control> <control> a) <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete, the 5G-GUTI, last visited registered TAI, TAI list, ngKSI for 3GPP access and the list of equivalent PLMNs. </action> </control> <control> Additionally, <condition> if a registration procedure was performed, </condition> <action> the UE shall reset the registration attempt counter </action> </control> and <control> <condition> if a service request procedure was performed, </condition> <action> reset the service request attempt counter; </action> </control> <control> <condition> b) <condition> if the 5GMM cause value received is #11 </condition> and <condition> the UE is operating in single-registration mode, handle the EMM parameters EMM state, EPS update status, EPS attach attempt counter, tracking area updating attempt counter or service request attempt counter, 4G-GUTI, TAI list, eKSI as specified in 3GPP TS 24.301 for the case <condition> when the EPS attach, </condition> </condition> </condition> <action> tracking area updating procedure or service request procedure is rejected with the EMM cause of the same value in a NAS message without integrity protection; </action> </control> <control> <condition> c) if the 5GMM cause value received is #73 and the UE is operating in single-registration mode, </condition> <action> the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED </action> and <action> ] shall delete any 4G- GUTI, last visited registered TAI, TAI list and eKSI. </action> Additionally, <action> the UE shall reset the attach attempt counter or tracking area updating attempt counter, </action> and <end_state> enter the state EMM-DEREGISTERED; </end_state> </control> <control> d) <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming", </action> <action> memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for non-integrity protected NAS reject message </action> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; </end_state> </control> and <control> e) <action> search for a suitable cell in another tracking area according to 3GPP TS 38.304 or 3GPP TS 36.304 ; </action> and as a UE implementation option, <action> the UE may perform registration attempt over the non-3GPP access, </action> <condition> <condition> if non-3GPP access is available, </condition> and <condition> the USIM is not considered invalid for 5GS services over non-3GPP access; </condition> </condition> </control>
<control> <condition> b) if the 5GMM cause value is received over non-3GPP access, </condition> the UE shall: </control> <control> a) <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete the 5G-GUTI, last visited registered TAI, TAI list and ngKSI for non-3GPP access. </action> </control> <control> Additionally, <condition> if a registration procedure was performed, </condition> <action> the UE shall reset the registration attempt counter </action> </control> and <control> <condition> if a service request procedure was performed, </condition> <action> reset the service request attempt counter; </action> </control> and <control> b) <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. </end_state> As a UE implementation option, <action> the UE may perform registration attempt over the non-3GPP access </action> <condition> if another access point for non-3GPP access is available, </condition> </control> or <control> <condition> if 3GPP access is available, the UE is not registered over 3GPP access yet, and the USIM is not considered invalid for 5GS services over 3GPP access, </condition> <action> perform registration attempt over the 3GPP access; </action> </control>
<control> 4) <condition> if the 5GMM cause value received is #11 or #73 and the UE is not in its HPLMN or EHPLMN, in addition to the UE requirements specified in subclause 5.5.1 and 5.6.1: </condition> </control> <control> <condition> a) <condition> if the message was received via 3GPP access </condition> and <condition> if the PLMN-specific attempt counter for the PLMN sending the reject message <condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> </condition> <action> the UE shall increment the PLMN-specific attempt counter for the PLMN; </action> </control> or <control> <condition> b) <condition> if the message was received via non-3GPP access </condition> and <condition> if the PLMN-specific attempt counter for non-3GPP access for the PLMN sending the reject message <condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> </condition> <action> the UE shall increment the PLMN-specific attempt counter for non-3GPP access for the PLMN; </action> </control>
<control> 5) <condition> if the 5GMM cause value received is #27, </condition> <action> the UE shall proceed as specified in subclauses 5.5.1 and 5.6.1. </action> </control> <control> Additionally, <condition> if the PLMN-specific N1 mode attempt counter for the respective access type and for the PLMN sending the reject message <condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> <action> the UE shall increment this counter for the PLMN; </action> </control>
<control> 6) <condition> if the 5GMM cause value received is #72, </condition> <action> the UE shall proceed as specified in subclauses 5.5.1 and 5.6.1. </action> </control> <control> Additionally, <condition> if the PLMN-specific N1 mode attempt counter for non-3GPP access for the PLMN sending the reject message <condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> <action> the UE shall increment this counter for the PLMN; </action> </control>
<control> 7) <condition> if the 5GMM cause value received is #31 for a UE that has indicated support for CIoT optimizations, </condition> <action> the UE may discard the message </action> or <control> <condition> alternatively </condition> the UE should: a) <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2); </action> b) <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming", </action> <action> memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for non-integrity protected NAS reject message; </action> and c) <action> search for a suitable cell in another tracking area according to 3GPP TS 38.304 or 3GPP TS 36.304 ; </action> </control> </control> and
<control> 8) <condition> if the 5GMM cause value received is #62, </condition> <action> the UE may discard the message </action> or <control> <condition> alternatively </condition> the UE should: a) <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2); </action> b) <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming", </action> <action> memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for non-integrity protected NAS reject message; </action> and c) <action> search for a suitable cell in another tracking area according to 3GPP TS 38.304 or 3GPP TS 36.304 . </action> </control> </control>
<control> <condition> Upon expiry of timer T3247, </condition> the UE shall: </control> <control> a) <action> remove all tracking areas from the list of "5GS forbidden tracking areas for regional provision of service" and the list of "5GS forbidden tracking areas for roaming", which were stored in these lists for non-integrity protected NAS reject message; </action> </control> <control> b) <action> set the USIM to valid for 5GS services for 3GPP access, </action> if: c) <condition> the counter for "SIM/USIM considered invalid for GPRS services" events <condition> has a value less than a UE implementation-specific maximum value; </condition> </condition> </control> <control> d) <action> set the USIM to valid for 5GS services for non-3GPP access, </action> <condition> if: e) the counter for "USIM considered invalid for 5GS services over non-3GPP access" events <condition> has a value less than a UE implementation-specific maximum value; </condition> </condition> </control> <control> f) <action> set the USIM to valid for non-EPS services, </action> if: g) <condition> the counter for "SIM/USIM considered invalid for non-GPRS services" events <condition> has a value less than a UE implementation-specific maximum value; </condition> </condition> </control> <control> <condition> h) for each PLMN-specific attempt counter that <condition> has a value greater than zero and less than a UE implementation- specific maximum value, </condition> </condition> <action> remove the respective PLMN from the extension of the "forbidden PLMNs" list; </action> </control> <control> <condition> i) for each PLMN-specific attempt counter for non-3GPP access that <condition> has a value greater than zero and less than a UE implementation-specific maximum value, </condition> </condition> <action> remove the respective PLMN from the list of "forbidden PLMNs for non-3GPP access to 5GCN"; </action> </control> <control> j) <action> re-enable the N1 mode capability for 3GPP access and, </action> <condition> for each PLMN-specific N1 mode attempt counter for 3GPP access that <condition> has a value greater than zero and less than a UE implementation-specific maximum value, </condition> </condition> <action> remove the respective PLMN from the list of PLMNs </action> <condition> where N1 mode is not allowed for 3GPP access </condition> </control> (see 3GPP TS 23.122 ); <control> k) <action> re-enable the N1 mode capability for non-3GPP access and, </action> <condition> for each PLMN-specific N1 mode attempt counter for non-3GPP access that <condition> has a value greater than zero and less than a UE implementation-specific maximum value, </condition> </condition> <action> remove the respective PLMN from the list of PLMNs </action> <condition> where N1 mode is not allowed for non-3GPP access; </condition> </control> <control> <condition> l) if the UE is supporting A/Gb mode or Iu mode, </condition> <action> perform the actions as specified in 3GPP TS 24.008 for the case when timer T3247 expires; </action> </control> <control> m) <condition> if the UE is supporting S1 mode, </condition> <action> perform the actions as specified in 3GPP TS 24.301 for the case </action> <condition> when timer T3247 expires; </condition> </control> and <control> n) <action> initiate a registration procedure, </action> <condition> if still needed, dependent on 5GMM state and 5GS update status, </condition> or <action> perform PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> When the UE is switched off, </condition> <control> the UE shall, <condition> for each PLMN-specific attempt counter that <condition> has a value greater than zero and less than the UE implementation-specific maximum value, </condition> </condition> <action> remove the respective PLMN from the list of "forbidden PLMNs". </action> </control> <control> <condition> When the USIM is removed, </condition> <action> the UE should perform this action. </action> </control> </control>
<control> <condition> When the UE is switched off, </condition> <action> the UE shall, for each PLMN-specific attempt counter for non-3GPP access that <condition> has a value greater than zero and less than the UE implementation-specific maximum value, </condition> </action> <action> remove the respective PLMN from the list of "forbidden PLMNs for non-3GPP access to 5GCN". </action> <control> <condition> > When the USIM is removed, the UE should perform this action. </condition> </control> </control>
NOTE 3: <control> <condition> If the respective PLMN was stored in the extension of the "forbidden PLMNs" list, </condition> then according to 3GPP TS 23.122 <action> the UE will delete the contents of this extension </action> <condition> when the UE is switched off or the USIM is removed. </condition> </control>
5.3.20.3 Requirements for UE in an SNPN
<control> <condition> If the UE is operating in SNPN access operation mode, </condition> <action> the UE shall maintain, for each of the entries in the "list of subscriber data": a) one SNPN-specific attempt counter for 3GPP access. </action> <control> <action> The counter is applicable </action> <condition> to access attempts via 3GPP access only; </condition> </control> b) <action> one SNPN-specific attempt counter for non-3GPP access, </action> <condition> if the UE supports accessing SNPN services via a PLMN. </condition> <control> <action> The counter is applicable </action> <condition> in case of accessing SNPN services via a PLMN only; </condition> </control> c) <action> one counter for "the entry for the current SNPN considered invalid for 3GPP access" events; </action> and <control> d) <action> one counter for "the entry for the current SNPN considered invalid for non-3GPP access" events, </action> <condition> if the UE supports accessing SNPN services via a PLMN. </condition> <control> <action> The counter is applicable </action> <condition> in case of accessing SNPN services via a PLMN only. </condition> </control> </control> </control>
NOTE 1: The term "non-3GPP access" used in the counter for "SNPN-specific attempt counter for non-3GPP access" events and the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events, is used to express access to SNPN services via a PLMN.
<control> <action> The UE shall store the above counters in its non-volatile memory. </action> </control> <control> <action> The UE shall erase the attempt counters and reset the event counters to zero </action> <condition> when the selected entry of the "list of subscriber data" is updated or USIM is removed for the selected PLMN subscription </condition> . <action> The counter values shall not be affected by the activation or deactivation of MICO mode or power saving mode (see 3GPP TS 24.301 ) </action> </control> .
<control> <action> The UE implementation-specific maximum value for any of the above counters shall not be greater than 10. </action> </control>
NOTE 2: Different counters can use different UE implementation-specific maximum values.
<control> <condition> <condition> If the UE receives a REGISTRATION REJECT or SERVICE REJECT message </condition> <condition> without integrity protection </condition> <condition> with 5GMM cause value #3, #6, #7, #12, #13, #15, #27, #72, #74, or #75 </condition> <condition> before the network has established secure exchange of NAS messages for the N1 NAS signalling connection, </condition> </condition> <action> the UE shall stop timer T3510 or T3517, </action> if running, and <action> start timer T3247 (see 3GPP TS 24.008 [12]) with a random value uniformly drawn from the range between: a) 15 minutes and 30 minutes for 5GMM cause value #74; </action> or b) <action> 30 minutes and 60 minutes for other 5GMM cause values; </action> <condition> if the timer is not running, </condition> and take the following actions: </control>
<control> <condition> a) <condition> if the 5GMM cause value received is #3, #6, or #7 </condition> and <condition> the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN </condition> </condition> </control> :
<control> 1) <condition> if the 5GMM cause value is received over 3GPP access: </condition> </control>
<control> <condition> i) if the UE is already registered over another access, </condition> the UE shall </control> :
<control> A) <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN and, </action> <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> <action> memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> </control> and, <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> <action> for non-integrity protected NAS reject message </action> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; </end_state> </control> </control> and <control> B) <action> search for a suitable cell in another tracking area according to 3GPP TS 38.304 ; </action> </control> or
<control> ii) <condition> otherwise if the counter <condition> for "the entry for the current SNPN considered invalid for 3GPP access" events </condition> has a value less than a UE implementation-specific maximum value, </condition> the UE shall: </control>
<control> A) <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete 5G-GUTI, last visited registered TAI, TAI list, and ngKSI for 3GPP access; </action> </control> <control> B) <action> increment the counter for "the entry for the current SNPN considered invalid for 3GPP access" events; </action> </control> <control> C) <action> reset the registration attempt counter </action> <condition> in case of a REGISTRATION REJECT message </condition> </control> or <control> <action> reset the service request attempt counter </action> <condition> in case of a SERVICE REJECT message; </condition> </control> <control> D) <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> </control> and, <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> <action> memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> </control> and, <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> <action> for non-integrity protected NAS reject message, </action> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; </end_state> </control> and <control> E) <action> search for a suitable cell in another tracking area according to 3GPP TS 38.304 . </action> <control> As a UE implementation option, <condition> if accessing SNPN services via a PLMN is available and the selected entry of the "list of subscriber data" or the selected PLMN subscription is not considered invalid for non-3GPP access, </condition> then <action> the UE may attempt to access SNPN services via a PLMN; </action> </control> </control> or
<control> iii) <condition> otherwise, </condition> <action> the UE shall proceed as specified in subclauses 5.5.1 and 5.6.1; </action> </control>
<control> 2) <condition> if the 5GMM cause value is received over non-3GPP access </condition> </control> :
NOTE 3: <control> A 5GMM cause value "received over non-3GPP access" in this subclause refers to a 5GMM cause value received via a PLMN <condition> when the UE attempts to access SNPN services via a PLMN. </condition> </control>
<control> <condition> i) if the UE is already registered over another access, </condition> <end_state> the UE shall enter the state 5GMM- DEREGISTERED.LIMITED-SERVICE; </end_state> </control> or
<control> ii) <condition> otherwise if the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events <condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> the UE shall </control> :
<control> A) <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete the 5G-GUTI, last visited registered TAI, TAI list, and ngKSI for non-3GPP access; </action> </control> <control> B) <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; </end_state> and </control> <control> C) <action> increment the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events. </action> <control> As a UE implementation option, <condition> if 3GPP access is available and the selected entry of the "list of subscriber data" or the selected PLMN subscription is not considered invalid for 3GPP access, </condition> <action> then the UE may make a registration attempt over 3GPP access; </action> </control> </control> or
<control> iii) <condition> otherwise, </condition> <action> the UE shall proceed as specified in subclauses 5.5.1 and 5.6.1; </action> </control>
<control> <condition> b) if the 5GMM cause value received is #12, #13, or #15, </condition> <action> the UE shall proceed as specified in subclauses 5.5.1 </action> </control> and
<control> 1) <condition> if the 5GMM cause value is received over 3GPP access, accessing SNPN services via a PLMN is available, the UE has not accessed SNPN services via a PLMN yet, and the selected entry of the "list of subscriber data" or the selected PLMN subscription is not considered invalid for non-3GPP access, </condition> <action> the UE may attempt to access SNPN services via a PLMN; </action> </control> or
<control> 2) <condition> if the 5GMM cause value is received over non-3GPP access, 3GPP access is available, the UE is not registered to the current SNPN over 3GPP access yet, and the selected entry of the "list of subscriber data" or the selected PLMN subscription is not considered invalid for 3GPP access, </condition> <action> the UE may make a registration attempt over 3GPP access; </action> </control> NOTE 4: The network does not send 5GMM cause value #13 to the UE operating in SNPN access operation mode in this release of specification.
<control> <condition> c) if the 5GMM cause value received is #27, </condition> <action> the UE shall proceed as specified in subclauses 5.5.1 and 5.6.1. </action> </control>
<control> Additionally, <condition> if the SNPN-specific attempt counter for the respective access type and for the current SNPN <condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> <action> the UE shall increment this counter for the SNPN; </action> </control>
<control> c1) <condition> if the 5GMM cause value received is #72, </condition> <action> the UE shall proceed as specified in subclauses 5.5.1 and 5.6.1. </action> </control>
<control> Additionally, <condition> if the SNPN-specific attempt counter for non-3GPP access for the current SNPN <condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> <action> the UE shall increment this counter for the SNPN; </action> </control> and
<control> <condition> d) if 1) <condition> the 5GMM cause value received is #74 or #75; </condition> or 2) <condition> > the 5GMM cause value received is #3, #6, or #7 and the UE is registered for onboarding services in SNPN or performing initial registration for onboarding services in SNPN; </condition> </condition> in addition to the UE requirements specified in subclauses 5.5.1 and 5.6.1: </control>
<control> 1) <condition> if the message was received via 3GPP access and if the SNPN-specific attempt counter for 3GPP access for the SNPN sending the reject message <condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> <action> the UE shall increment the SNPN-specific attempt counter for 3GPP access for the SNPN; </action> </control> or
<control> 2) <condition> if the message was received via non-3GPP access and if the SNPN-specific attempt counter for non-3GPP access for the SNPN sending the reject message <condition> has a value less than a UE implementation-specific maximum value, </condition> </condition> <action> the UE shall increment the SNPN-specific attempt counter for non-3GPP access for the SNPN. </action> </control>
NOTE 5: The message "received via non-3GPP access" in this subclause refers to a message received via a PLMN when the UE attempts to access SNPN services via a PLMN.
<control> <condition> Upon expiry of timer T3247, </condition> the UE shall: </control> <control> a) <action> remove, for each SNPN, all tracking areas from the list of "5GS forbidden tracking areas for regional provision of service" and the list of "5GS forbidden tracking areas for roaming" for the SNPN and, </action> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, <condition> which were stored in these lists for non-integrity protected NAS reject message; </condition> </condition> </control> <control> b) <action> set each entry of the "list of subscriber data" or the PLMN subscription to valid for 3GPP access, </action> <condition> if the corresponding counter for "the entry for the current SNPN considered invalid for 3GPP access" events <condition> has a value less than a UE implementation-specific maximum value; </condition> </condition> </control> <control> c) <action> set each entry of the "list of subscriber data" or the PLMN subscription to valid for non-3GPP access, </action> <condition> if the corresponding counter for "the entry for the current SNPN considered invalid for non-3GPP access" events <condition> has a value less than a UE implementation-specific maximum value; </condition> </condition> </control> <control> d) <action> remove each SNPN identity from the "permanently forbidden SNPNs" list for 3GPP access or "temporarily forbidden SNPNs" list for 3GPP access which are, </action> <condition> <condition> if the MS supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> <condition> if the corresponding SNPN-specific attempt counter for 3GPP access <condition> has a value greater than zero and less than a UE implementation-specific maximum value </condition> and <condition> the SNPN identity is included in any of the "permanently forbidden SNPNs" list for 3GPP access or "temporarily forbidden SNPNs" list for 3GPP access; </condition> </condition> </condition> </control> <control> e) <action> remove each SNPN identity from the "permanently forbidden SNPNs" list for non-3GPP access or "temporarily forbidden SNPNs" list for non-3GPP access which are, </action> <condition> <condition> if the MS supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> <condition> if the corresponding SNPN-specific attempt counter for non-3GPP access <condition> has a value greater than zero and less than a UE implementation-specific maximum value </condition> and <condition> the SNPN identity is included in any of the "permanently forbidden SNPNs" list for non-3GPP access or "temporarily forbidden SNPNs" list for non-3GPP access; </condition> </condition> </condition> </control> <control> f) <action> re-enable the N1 mode capability for 3GPP access and, </action> <condition> for each SNPN-specific attempt counter for 3GPP access that has a value greater than zero and less than a UE implementation-specific maximum value, </condition> <control> <action> remove the respective SNPN from the list of SNPNs </action> <condition> for which the N1 mode capability was disabled <condition> due to receipt of a reject from the network with 5GMM cause #27 "N1 mode not allowed" (see 3GPP TS 23.122 ); </condition> </condition> </control> </control> <control> g) <action> re-enable the N1 mode capability for non-3GPP access and, </action> <condition> for each SNPN-specific attempt counter for non- 3GPP access that <condition> has a value greater than zero and less than a UE implementation-specific maximum value, </condition> </condition> <control> <action> remove the respective SNPN from the list of SNPNs </action> <condition> for which N1 mode capability was disabled for non-3GPP access <condition> due to receipt of a reject from the network with 5GMM cause #27 "N1 mode not allowed" or 5GMM cause #72 "non-3GPP access to 5GCN not allowed"; </condition> </condition> </control> </control> <control> h) <action> initiate a registration procedure, </action> <condition> if still needed, dependent on 5GMM state and 5GS update status, </condition> or <action> perform SNPN selection according to 3GPP TS 23.122. </action> </control>
<control> <condition> When the UE is switched off or a UICC containing the USIM is removed: </condition> <control> <condition> a) for each SNPN-specific attempt counter for 3GPP access <condition> having a value greater than zero and less than the UE implementation-specific maximum value, </condition> </condition> <action> the UE shall remove the respective SNPN identity from the "permanently forbidden SNPNs" list(s) for 3GPP access or "temporarily forbidden SNPNs" list(s) for 3GPP access, </action> <condition> if available; </condition> </control> and <control> <condition> b) for each SNPN-specific attempt counter for non-3GPP access <condition> having a value greater than zero and less than the UE implementation-specific maximum value, </condition> </condition> <action> the UE shall remove the respective SNPN identity from the "permanently forbidden SNPNs" list(s) for non-3GPP access or "temporarily forbidden SNPNs" list(s) for non- 3GPP access, </action> <condition> if available. </condition> </control> </control>
<control> <condition> When an entry of the "list of subscriber data" is updated: </condition> <control> <condition> a) <condition> if the UE does not support access to an SNPN using credentials from a credentials holder </condition> and <condition> the SNPN-specific attempt counter for 3GPP access for the SNPN corresponding to the entry <condition> has a value greater than zero and less than the UE implementation-specific maximum value, </condition> </condition> </condition> <action> the UE shall remove the SNPN identity corresponding to the entry from the "permanently forbidden SNPNs" list for 3GPP access or "temporarily forbidden SNPNs" list for 3GPP access, </action> <condition> if available; </condition> </control> <control> <condition> b) <condition> if the UE does not support access to an SNPN using credentials from a credentials holder </condition> and <condition> the SNPN-specific attempt counter for non-3GPP access for the SNPN corresponding to the entry <condition> has a value greater than zero and less than the UE implementation-specific maximum value, </condition> </condition> </condition> <action> the UE shall remove the SNPN identity corresponding to the entry from the "permanently forbidden SNPNs" list for non-3GPP access or "temporarily forbidden SNPNs" list for non-3GPP access, </action> <condition> if available; </condition> </control> <control> <condition> c) <condition> if the UE supports access to an SNPN using credentials from a credentials holder </condition> and <condition> the SNPN-specific attempt counter for 3GPP access for an SNPN in the "permanently forbidden SNPNs" list for 3GPP access or "temporarily forbidden SNPNs" list for 3GPP access, associated with the entry, <condition> has a value greater than zero and less than the UE implementation-specific maximum value, </condition> </condition> </condition> <action> the UE shall remove the SNPN identity corresponding to the SNPN from the "permanently forbidden SNPNs" list for 3GPP access or "temporarily forbidden SNPNs" list for 3GPP access, associated with the entry; </action> </control> and <control> <condition> d) <condition> if the UE supports access to an SNPN using credentials from a credentials holder </condition> and <condition> the SNPN-specific attempt counter for non-3GPP access for an SNPN in the "permanently forbidden SNPNs" list for non-3GPP access or "temporarily forbidden SNPNs" list for non-3GPP access associated with the entry, <condition> has a value greater than zero and less than the UE implementation-specific maximum value, </condition> </condition> </condition> <action> the UE shall remove the SNPN identity corresponding to the SNPN from the "permanently forbidden SNPNs" list for non-3GPP access or "temporarily forbidden SNPNs" list for non-3GPP access, associated with the entry. </action> </control> </control>
5.3.21 CIoT 5GS optimizations CIoT 5GS optimizations provide improved support of small data and SMS transfer. <control> <condition> A UE supporting CIoT 5GS optimizations </condition> <control> <action> can indicate the 5GS CIoT network behaviour the UE can support and prefers to use </action> <control> during the registration procedure (see 3GPP TS 23.502 ). </control> </control> </control> <control> <action> The UE may indicate the support for control plane CIoT 5GS optimization, user plane CIoT 5GS optimization, N3 data transfer and header compression </action> (see subclause 9.11.3.1). </control>
<control> Furthermore, <action> the UE may, separately from the indication of support, indicate preference for control plane CIoT 5GS optimization or user plane CIoT 5GS optimization (see subclause 9.11.3.9A). </action> </control> <control> <action> The indication of preference is also considered as the request to use. </action> </control> <control> <condition> A UE supporting CIoT EPS optimizations </condition> <control> <action> can also indicate the EPS CIoT network behaviour the UE can support </action> <condition> during the registration procedure. </condition> </control> </control> <control> Furthermore, <action> the UE may, separately from the indication of support, indicate preference for control plane CIoT EPS optimization or user plane CIoT EPS </action> </control>
NOTE 1: CIoT 5GS optimizations are not supported by NR connected to 5GCN.
NOTE 2: <control> <condition> If the UE does not support user plane CIoT 5GS optimization, </condition> <action> it does not indicate preference for user plane CIoT 5GS optimization. </action> </control>
<control> <action> The UE can be in NB-N1 mode or WB-N1 mode </action> <condition> when requesting the use of CIoT 5GS optimizations <condition> during the registration procedure. </condition> </condition> </control> <control> <action> A UE in NB-N1 mode always indicates support for control plane CIoT 5GS optimization. </action> </control>
<control> <condition> In NB-N1 mode, the UE, when requesting the use of CIoT 5GS optimizations, </condition> does not: a) <action> request an initial registration for emergency services; </action> b) <action> request a PDU session establishment for emergency PDU session; </action> or <control> c) <action> indicate UE's usage setting </action> <condition> during the registration procedure. </condition> </control> </control>
<control> <action> The network does not indicate to the UE support of emergency services </action> <condition> when the UE is in NB-N1 mode (see subclause 5.5.1.2.4 and 5.5.1.3.4). </condition> </control>
<control> <action> The control plane CIoT 5GS optimization enables support of efficient transport of user data (IP, Ethernet and Unstructured) or SMS messages over control plane via the AMF </action> <condition> without triggering user-plane resources establishment. </condition> </control>
The support of control plane CIoT 5GS optimization is mandatory for the network in NB-N1 mode and optional in WB- N1 mode. <control> <action> Optional header compression of IP data and Ethernet data can be applied to PDU sessions </action> <condition> with IP PDU session type and Ethernet PDU session type that are configured to support header compression. </condition> </control> For IP header compression, Robust Header Compression (ROHC) protocol specified in IETF RFC 5795 is used. For Ethernet header compression, Ethernet Header Compression (EHC) protocol specified in 3GPP TS 38.323 is used.
<control> <condition> For a UE that supports Location Services (LCS) notification mechanisms in N1 mode, </condition> <control> <action> the control plane CIoT 5GS optimization also enables the transport of location services messages from 5GMM-IDLE mode using the CONTROL PLANE SERVICE REQUEST message </action> <condition> when location services are requested (see subclause 6.7.1 in 3GPP TS 23.273 ). </condition> </control> </control>
<control> <action> The user plane CIoT 5GS optimization enables support for change from 5GMM-IDLE mode over 3GPP access to 5GMM-CONNECTED mode over 3GPP access </action> <condition> without the need for using the service request procedure (see subclause 5.3.1.5). </condition> </control>
<control> <condition> If the UE supports user plane CIoT 5GS optimization, </condition> <action> it shall also support N3 data transfer. </action> </control>
<control> <condition> <condition> If the UE indicates support of one or more CIoT 5GS optimizations </condition> <condition> the network supports one or more CIoT 5GS optimizations and decides to accept the registration request, </condition> </condition> <control> <action> the network indicates the supported CIoT 5GS optimizations to the UE per registration area </action> <condition> when accepting the UE request. </condition> </control> </control> <control> <action> Network indication of support is interpreted by the UE as the acceptance to use the respective feature. </action> </control> <control> <condition> > After completion of the registration procedure, </condition> <action> the UE and the network can then use the accepted CIoT 5GS optimizations for the transfer of user data (IP, Ethernet, Unstructured and SMS). </action> </control>
<control> <condition> A UE in NB-N1 mode or WB-N1 mode </condition> <control> <action> > can request the use of SMS over NAS </action> <condition> by setting the SMS requested bit of the 5GS update type IE in the REGISTRATION REQUEST message as specified in subclauses 5.5.1.2.2 and 5.5.1.3.2. </condition> </control> </control>
<control> <control> <action> The AMF indicates whether it allows the use of SMS over NAS for a UE <condition> in NB-N1 mode or WB-N1 mode </condition> </action> </control> <condition> by setting the SMS allowed bit of the 5GS registration result IE in the REGISTRATION ACCEPT message as specified in subclauses 5.5.1.2.4 and 5.5.1.3.4. </condition> </control>
<control> <condition> If the UE and the network support both the control plane CIoT 5GS optimization and N3 data transfer, </condition> then <control> <condition> when receiving the UE's request for a PDU session establishment, </condition> <action> the AMF decides whether the PDU session should be NEF PDU session or N6 PDU session as specified in 3GPP TS 23.501 </action> and then </control> </control> : <control> <condition> a) if NEF PDU session is to be established for unstructured data type, </condition> <action> the AMF includes control plane only indication for the requested PDU session to the SMF; </action> </control> <control> <condition> b) <condition> if N6 PDU session is to be established </condition> and the <condition> DNN or S-NSSAI of the newly requested N6 PDU session supports interworking with EPS as specified in TS 23.502 : </condition> </condition> </control> <control> 1) <condition> if there are existing N6 PDU sessions supporting interworking with EPS for this UE <condition> that were established with the control plane only indication, </condition> </condition> <action> the AMF includes the control plane only indication for the newly requested N6 PDU session to the SMF; </action> </control> <control> 2) <condition> if there are existing N6 PDU sessions supporting interworking with EPS for this UE <condition> that were established without the control plane only indication, </condition> </condition> <action> the AMF does not include the control plane only indication for the newly requested N6 PDU session to the SMF; </action> </control> <control> 3) <condition> if there is no existing N6 PDU session supporting interworking with EPS for this UE, </condition> <action> the AMF determines whether to include the control plane only indication for the newly requested N6 PDU session to the SMF based on local policies, the UE's preferred CIoT network behaviour and the supported CIoT network behaviour; </action> </control> and <control> <condition> c) <condition> if N6 PDU session is to be established </condition> and <condition> the DNN or S-NSSAI of the N6 PDU session does not support interworking with EPS as specified in TS 23.502 , </condition> </condition> <action> the AMF determines whether to include the control plane only indication for the newly requested N6 PDU session to the SMF based on local policies, the UE's preferred CIoT network behaviour and the supported CIoT network behaviour. </action> </control>
<control> <condition> In NB-N1 mode, </condition> <action> the UE or the network does not support N3 data transfer, </action> then <control> </control> <condition> when receiving the UE's request for a PDU session establishment, </condition> <action> the AMF decides whether the PDU session should be NEF PDU session or N6 PDU session as specified in 3GPP TS 23.501 </action> and then <action> includes the control plane only indication for the requested PDU session to the SMF. </action> </control>
<control> <condition> If the network supports user plane CIoT 5GS optimization, </condition> <action> it shall also support N3 data transfer. </action> </control>
Broadcast system information may provide information about support of CIoT 5GS optimizations (see 3GPP TS 36.331 ). <control> <condition> At reception of new broadcast system information, </condition> <action> the lower layers deliver it to the 5GMM layer in the UE. </action> <action> The information provided by lower layers is per PLMN and used by the UE to determine whether certain CIoT 5GS optimizations are supported in the cell. </action> </control>
<control> <action> The UE shall not attempt to use CIoT 5GS optimizations </action> <condition> which are indicated as not supported. </condition> </control>
<control> <condition> In NB-N1 mode, </condition> at any given time, <action> there cannot be user-plane resources established for a number of PDU sessions that exceeds the UE' s maximum number of supported user-plane resources. </action> <action> The UE in NB-N1 mode shall not: a) request the establishment of user-plane resources for a number of PDU sessions that exceeds the UE' s maximum number of supported user-plane resources; </action> or <control> b) <action> initiate the establishment of a new PDU session, or request the transfer of a PDU session from the non-3GPP access to the 3GPP access, </action> if: <condition> 1) <condition> the UE has indicated preference for user plane CIoT 5GS optimization; </condition> 2) <condition> the network accepted the use of user plane CIoT 5GS optimization; and </condition> 3) <condition> the UE currently has user-plane resources established fora number of PDU sessions that is equal to the UE' s maximum number of supported user-plane resources. </condition> </condition> </control> </control>
<control> <action> The AMF enforces a limit on the number of PDU sessions with active user-plane resources for a UE in NB-N1 mode </action> <condition> based on the UE's maximum number of supported user-plane resources as follows: <condition> a) there can be a maximum of one PDU session with active user-plane resources <condition> when the Multiple user-plane resources support bit is set to "Multiple user-plane resources not supported", </condition> </condition> or b) <condition> there can be a maximum of two PDU sessions with active user-plane resources <condition> when the Multiple user-plane resources support bit is set to "Multiple user-plane resources supported". </condition> </condition> </condition> </control>
<control> <condition> A PDU session for a UE in NB-N1 mode </condition> <action> shall only have one QoS rule and that is the default QoS rule. </action> </control> Reflective QoS is not supported in NB-N1 mode. Reflective QoS is not applicable for a PDU session with control plane only indication.
<control> <condition> In NB-N1 mode, </condition> <control> <condition> <condition> when the UE requests the lower layer to establish a RRC connection </condition> and <condition> the UE requests the use of user plane CIoT 5GS optimization, </condition> </condition> <action> the UE shall pass an indication of the requested CIoT 5GS optimizations to the lower layers. </action> </control> <control> <condition> If the UE requests the use of N3 data transfer without user plane CIoT 5GS optimization, </condition> <action> then the UE shall also pass an indication of user plane CIoT 5GS optimization to lower layers. </action> </control> </control>
<control> <condition> In WB-N1 mode, </condition> , <control> <condition> <condition> when the UE requests the lower layer to establish a RRC connection </condition> and the UE <condition> requests the use of control plane CIoT 5GS optimization or user plane CIoT 5GS optimization, </condition> </condition> <action> the UE shall pass an indication of the requested CIoT 5GS optimizations to the lower layers. </action> </control> </control>
5.3.22 Interaction between MICO mode with active time and extended idle mode DRX cycle
<control> <action> The UE can request the use of both MICO mode with active time and eDRX </action> <condition> during a registration procedure </condition> but it is up to the network to decide to enable none, one of them or both (see 3GPP TS 23.501 ). </control>
<control> <condition> If the network accepts the use of both MICO mode with active time (see subclause 5.3.6) and eDRX (see subclause 5.3.16), </condition> <control> <action> the extended DRX parameters provided to the UE should allow for multiple paging occasions </action> <condition> before the active timer expires. </condition> </control> </control>
5.3.23 Forbidden wireline access area
<control> <action> The AMF shall send a REGISTRATION REJECT, SERVICE REJECT or DEREGISTRATION REQUEST message over a wireline access network with the 5GMM cause #77 "wireline access area not allowed", </action> <condition> if conditions specified in 3GPP TS 23.316 for AMF's enforcement of forbidden area are fulfilled. </condition> </control>
<control> <condition> If a REGISTRATION REJECT, SERVICE REJECT or DEREGISTRATION REQUEST message is received over a wireline access network with the 5GMM cause #77 "wireline access area not allowed": </condition> </control>
<control> a) <action> the 5G-RG shall not access 5GCN over the wireline access network </action> <condition> until the 5G-RG is switched off, the UICC containing the USIM is removed, or the 5G-RG starts using another wireline access network; </condition> </control>
<control> b) <action> the W-AGF acting on behalf of the FN-CRG shall not access 5GCN </action> <condition> until the W-AGF acting on behalf of the FN-CRG determines that the FN-CRG is switched off; </condition> </control>
<control> c) <action> the W-AGF acting on behalf of the N5GC device shall not access 5GCN </action> <condition> until the W-AGF acting on behalf of the FN-CRG determines that the FN-CRG serving the N5GC device is switched off. </condition> </control>
5.3.24 WUS assistance
<control> <condition> A UE supporting reception of WUS assistance information </condition> <control> <action> indicates its capability for reception of WUS assistance information </action> <condition> during registration procedure (see 3GPP TS 23.501 ). </condition> </control> </control> <control> <condition> The UE supporting WUS assistance information </condition> <action> may include its UE paging probability information in the Requested WUS assistance information IE in the REGISTRATION REQUEST message (see 3GPP TS 23.501 ). </action> </control> <control> <action> The UE shall not include its UE paging probability information during a registration procedure </action> <condition> when the UE has an active emergency PDU session. </condition> </control>
<control> <action> The UE and the network may negotiate the UE paging probability information during a registration procedure </action> <condition> when the UE does not have an emergency PDU session. </condition> </control> The UE paging probability information is an assistance information used to determine the WUS group for paging UE (see 3GPP TS 23.501 , 3GPP TS 36.300 ).
NOTE: The determination of UE paging probability information is up to UE implementation.
<control> <condition> If a UE supporting WUS assistance information did not receive the Negotiated WUS assistance information IE <condition> during the last registration procedure <condition> due to an active emergency PDU session over 3GPP access, </condition> </condition> </condition> <control> <action> the UE shall initiate a registration procedure for mobility and periodic registration update to request WUS assistance information </action> <condition> after the emergency PDU session is released over 3GPP access. </condition> </control> </control>
<control> <condition> <condition> If the UE does not have an emergency PDU session </condition> and <condition> the network accepts the use of the WUS assistance information for the UE, </condition> </condition> <control> <action> the network determines the negotiated UE paging probability information for the UE </action> <condition> based on the requested UE paging probability information, <condition> if any, </condition> local configuration or previous statistical information for the UE, </condition> , and then <action> indicates the negotiated UE paging probability information in the Negotiated WUS assistance information IE to the UE in the REGISTRATION ACCEPT message. </action> </control> <action> The network shall store the negotiated UE paging probability information in the 5GMM context of the UE for paging. </action> </control>
<control> <action> The UE shall use WUS assistance information </action> <condition> > only if the UE received the Negotiated WUS assistance information IE <condition> during the last registration procedure. </condition> </condition> </control> <control> <condition> If the UE did not receive the Negotiated WUS assistance information IE <condition> during the last registration procedure, </condition> </condition> <action> the UE shall not use WUS assistance. </action> </control>
<control> <condition> If the network did not accept the request to use WUS assistance information, </condition> <control> <action> the network shall delete the stored negotiated UE paging probability information for the UE, </action> <condition> if available. </condition> </control> </control>
<control> <condition> When an emergency PDU session is successfully established <condition> after the UE received the Negotiated WUS assistance information IE <condition> during the last registration procedure, </condition> </condition> </condition> <control> <action> the UE and the AMF shall not use WUS assistance information </action> until <condition> <condition> a) the successful completion of the PDU session release procedure of the emergency PDU session; </condition> b) <condition> the UE receives WUS assistance information during a registration procedure with PDU session status IE or upon successful completion of a service request procedure, <condition> if the UE or the network locally releases the emergency PDU session; </condition> </condition> or c) <condition> the successful completion of the handover of the emergency PDU session to non-3GPP access. </condition> </condition> </control> </control>
5.3.25 Paging Early Indication with Paging Subgrouping Assistance
<control> <action> A UE may indicate its capability to support NR paging subgrouping during registration procedure </action> <condition> when the UE: <condition> a) initiates a registration procedure with 5GS registration type IE not set to "emergency registration"; </condition> and b) <condition> does not have an active emergency PDU session. </condition> </condition> </control>
<control> <condition> If a UE supporting NR paging subgrouping did not indicate its capability to support NR paging subgrouping <condition> during the last registration procedure </condition> <condition> due to an active emergency PDU session over 3GPP access, </condition> </condition> </control> <control> <action> the UE shall initiate a registration procedure for mobility and periodic registration update procedure to indicate its capability to support NR paging subgrouping </action> <condition> after the emergency PDU session is released over 3GPP access. </condition> </control>
<control> <condition> If the UE indicates support of NR paging subgrouping </condition> <action> the UE may include its paging probability information in the Requested PEIPS assistance information IE in the REGISTRATION REQUEST message. </action> </control> <control> <condition> <condition> If the UE indicates support of NR paging subgrouping </condition> and <condition> the network supports and accepts the use of the PEIPS assistance information for the UE, </condition> </condition> <action> the network provides to the UE the Negotiated PEIPS assistance information, including the Paging subgroup ID, in the REGISTRATION ACCEPT message or the CONFIGURATION UPDATE COMMAND message. </action> </control> The Paging subgroup ID is used to determine the NR paging subgroup for paging the UE. <control> <action> The network shall store the Paging subgroup ID in the 5GMM context of the UE. </action> </control>
<control> <action> The UE shall use PEIPS assistance information </action> <condition> only if the UE received the Negotiated PEIPS assistance information IE <condition> during the last registration procedure. </condition> </condition> </control> <control> <condition> If the UE did not receive the Negotiated PEIPS assistance information IE <condition> during the last registration procedure, </condition> </condition> <action> the UE shall delete any existing PEIPS assistance information received from the network. </action> </control>
<control> <condition> If the network did not accept the request to use PEIPS assistance information <condition> during the registration procedure, </condition> </condition> <control> <action> the network shall delete the stored PEIPS assistance information for the UE, </action> <condition> if available. </condition> </control> </control>
<control> <condition> <condition> If the UE supports the use of the PEIPS assistance information </condition> and <condition> the network supports and accepts the use of the PEIPS assistance information, </condition> </condition> <control> <action> the network may provide the PEIPS assistance information to the UE </action> <condition> by including the Updated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message. </condition> </control> </control>
<control> <condition> When an emergency PDU session is successfully established over 3GPP access <condition> after the UE received the Negotiated PEIPS assistance information IE <condition> during the last registration procedure, </condition> </condition> </condition> <control> <action> the UE and the AMF shall not use PEIPS assistance information </action> until <condition> : <condition> a) the successful completion of the PDU session release procedure of the emergency PDU; </condition> b) <condition> <condition> the UE receives PEIPS assistance information during a registration procedure with PDU session status IE </condition> or <condition> upon successful completion of a service request procedure, </condition> <condition> if the UE or the network locally releases the emergency PDU session; </condition> </condition> c) <condition> the successful completion of handover of emergency PDU session to non-3GPP access; </condition> or d) <condition> the successful transfer of the emergency PDU session in 5GS to the EPS or ePDG connected to EPC. </condition> </condition> </control> </control>
5.4 5GMM common procedures
5.4.1 Primary authentication and key agreement procedure
5.4.1.1 General
The purpose of the primary authentication and key agreement procedure is to enable mutual authentication between the UE and the network and to provide keying material that can be used between the UE and network in subsequent security procedures, as specified in 3GPP TS 33.501 .
Two methods are defined:
a) EAP based primary authentication and key agreement procedure.
b) 5G AKA based primary authentication and key agreement procedure.
The UE and the AMF shall support the EAP based primary authentication and key agreement procedure and the 5G AKA based primary authentication and key agreement procedure.
5.4.1.2 EAP based primary authentication and key agreement procedure
5.4.1.2.1 General
The purpose of the EAP based primary authentication and key agreement procedure is to provide mutual authentication between the UE and the network and to agree on the keys K_AUSF, K_SEAF and K_AMF (see 3GPP TS 33.501 ).
Extensible authentication protocol (EAP) as specified in IETF RFC 3748 enables authentication using various EAP
EAP defines four types of EAP messages:
Several rounds of exchanges of an EAP-request message and a related EAP-response message can be required to achieve the authentication (see example in figure 5.4.1.2.1.1).
The EAP based primary authentication and key agreement procedure is always initiated and controlled by the network.
The EAP-request message, the ngKSI and the ABBA are transported from the network to the UE using the AUTHENTICATION REQUEST message of the EAP message reliable transport procedure.
The EAP-response message is transported from the UE to the network using the AUTHENTICATION RESPONSE message of the EAP message reliable transport procedure.
<control> <condition> If the authentication of the UE completes successfully, </condition> <action> the serving AMF intends to initiate a security mode control procedure </action> <condition> <condition> after the EAP based primary authentication </condition> and <condition> key agreement procedure </condition> and <condition> the security mode control procedure intends to bring into use the partial native 5G NAS security context created by the EAP based primary authentication </condition> and <condition> key agreement procedure, </condition> </condition> <control> <action> then the EAP-success message and the ngKSI are transported from the network to the UE using the SECURITY MODE COMMAND message of the security mode control procedure (see subclause 5.4.2). </action> </control> </control>
If the authentication of the UE completes successfully and the serving AMF does not intend to initiate a security mode control procedure bringing into use the partial native 5G NAS security context created by the EAP based primary authentication and key agreement procedure, then the EAP-success message, and the ngKSI are transported from the network to the UE using the AUTHENTICATION RESULT message of the EAP result message transport procedure.
NOTE 1: The serving AMF will not initiate a security mode control procedure after the EAP based primary authentication and key agreement procedure e.g. in case of AMF relocation during registration procedure.
<control> <condition> If the authentication of the UE completes unsuccessfully, </condition> <action> the EAP-failure message is transported from the network to the UE using the AUTHENTICATION RESULT message or the AUTHENTICATION REJECT message of the EAP result message transport procedure or in a response of the initial 5GMM procedure as part of which the EAP based primary authentication and key agreement procedure is performed. </action> </control>
<control> <action> The AMF shall set the authenticator retransmission timer specified in IETF RFC 3748 subclause 4.3 to infinite </action> </control>
NOTE 2: The EAP message reliable transport procedure provides a reliable transport of EAP messages and therefore retransmissions at the EAP layer do not occur.
The AUSF and the AMF support exchange of EAP messages using N12.
<control> <action> The UE shall detect and handle any duplication of EAP message as specified in IETF RFC 3748 . </action> </control>
UE AMF AUTHENTICATION REQUEST Start T3560 &lt;EAP-request message A&gt; AUTHENTICATION RESPONSE
Stop T3560 &lt;EAP-response message to EAP-request message A&gt; AUTHENTICATION REQUEST Start T3560 &lt;EAP-request message B&gt; AUTHENTICATION RESPONSE
Stop T3560 &lt;EAP-response message to EAP-request message B&gt; SECURITY MODE COMMAND &lt;EAP-success message&gt; OR REGISTRATION REJECT &lt;EAP-failure message&gt; OR SERVICE REJECT &lt;EAP-failure message&gt; OR REGISTRATION ACCEPT &lt;EAP-failure message&gt; OR SERVICE ACCEPT &lt;EAP-failure message&gt; OR AUTHENTICATION RESULT &lt;EAP-success message or EAP-failure message&gt; OR AUTHENTICATION REJECT &lt;EAP-failure message&gt;
5.4.1.2.2 EAP-AKA' related procedures
5.4.1.2.2.1 General
The UE shall support acting as EAP-AKA' peer as specified in IETF RFC 5448 . The AUSF may support acting as EAP-AKA' server as specified in IETF RFC 5448 . The AAA server of the Credentials Holder (CH) or the Default
Credentials Server (DCS) may support acting as EAP-AKA' server as specified in IETF RFC 5448 .
<control> <condition> The EAP-AKA' </condition> <action> enables mutual authentication of the UE and the network. </action> </control>
<control> <action> The UE can reject the EAP-request/AKA'-challenge message sent by the network. </action> </control> <control> <action> The UE shall proceed with an EAP- request/AKA'-challenge message </action> <condition> only if a USIM is present. </condition> </control>
<control> <condition> During a successful EAP based primary authentication and key agreement procedure, </condition> <action> the CK and IK are computed by the USIM. </action> <action> CK and IK are then used by the ME as key material to generate an EMSK or MSK. </action> </control>
5.4.1.2.2.2 Initiation
<control> <condition> <condition> In order to initiate the EAP based primary authentication </condition> and <condition> key agreement procedure using EAP-AKA', </condition> </condition> <action> the AUSF or the AAA server of the CH or the DCS shall send an EAP-request/AKA'-challenge message as specified in IETF RFC 5448 . </action> <action> The AUSF or the AAA server of the CH or the DCS shall set the AT_KDF_INPUT attribute of the EAP-request/AKA'-challenge message to the SNN. </action> <action> The SNN is in format described in subclause 9.12.1. The AUSF or the AAA server of the CH or the DCS may include AT_RESULT_IND attribute in the EAP-request/AKA'-challenge </action> </control>
<control> <action> The network shall select an ngKSI value. </action> </control> <control> <condition> If an ngKSI is contained in an initial NAS message during a 5GMM procedure, </condition> <action> the network shall select a different ngKSI value. </action> </control> <control> <action> The network shall send the selected ngKSI value to the UE along with each EAP message. </action> </control> <control> <action> The network shall send the ABBA value as described in subclause 9.11.3.10 to the UE along with the EAP request message and EAP-success message. </action> </control>
<control> <condition> Upon receiving an EAP-request/AKA'-challenge message, </condition> <action> the UE shall check whether the UE has a USIM, </action> <action> shall check the key derivation function indicated in AT_KDF attributes as specified in IETF RFC 5448 , </action> and <condition> if the value of the Key derivation function field within the received AT_KDF attribute, is of value 1, </condition> shall check: </control>
<control> <action> a) whether the network name field of the AT_KDF_INPUT attribute is the SNN constructed according to subclause 9.12.1; </action> and </control>
<control> <action> b) whether the network name field of the AT_KDF_INPUT attribute matches the PLMN identity or the SNPN identity of the selected SNPN saved in the UE. </action> </control>
<control> <condition> When not operating in SNPN access operation mode, </condition> the PLMN identity the UE uses for the above network name check is as follows: </control>
<control> <condition> a) <condition> when the UE moves from 5GMM-IDLE mode to 5GMM-CONNECTED mode </condition> <condition> until the first handover, </condition> </condition> <action> the UE shall use the PLMN identity of the selected PLMN; </action> </control> and
<control> <condition> b) after handover or inter-system change to N1 mode in 5GMM-CONNECTED mode: </condition> </control>
<control> 1) <condition> if the target cell is not a shared network cell, </condition> <action> the UE shall use the PLMN identity received as part of the broadcast system information; </action> </control>
<control> 2) <condition> <condition> if the target cell is a shared network cell </condition> and <condition> the UE has a valid 5G-GUTI, </condition> </condition> <action> the UE shall use the PLMN identity that is part of the 5G-GUTI; </action> </control> and
<control> 3) <condition> <condition> if the target cell is a shared network cell </condition> and <condition> the UE has a valid 4G-GUTI, </condition> <condition> but not a valid 5G-GUTI, </condition> </condition> <action> the UE shall use the PLMN identity that is part of the 4G-GUTI. </action> </control>
<control> <condition> When operating in SNPN access operation mode, </condition> <action> the SNPN identity the UE uses for the above network name check is the SNPN identity of the selected SNPN. </action> </control>
5.4.1.2.2.3 UE successfully authenticates network
<control> <condition> If a USIM is present and the SNN check is successful, </condition> <action> the UE shall handle the EAP-request/AKA'-challenge message as specified in IETF RFC 5448 . </action> <action> The USIM shall derive CK and IK </action> and <action> compute the authentication response (RES) using the 5G authentication challenge data received from the ME, </action> and <action> pass RES to the ME. </action> <action> The ME shall derive CK' and IK' from CK and IK, </action> and <condition> <condition> if the UE operates in SNPN access operation mode </condition> and <condition> <condition> the credentials in the USIM contain an indication to use MSK for derivation of K </condition> <condition> after success of primary authentication </condition> and <condition> key agreement procedure </condition> </condition> </condition> <action> then derive MSK from CK' and IK' otherwise derive EMSK from CK' and IK'. </action> </control>
NOTE 1: <control> <condition> <condition> When the UE is registering </condition> or <condition> registered for onboarding services in SNPN, </condition> </condition> <action> credentials in the USIM do not contain an indication to use MSK for derivation of K </action> <condition> <condition> after success of primary authentication </condition> and <condition> key agreement procedure. </condition> </condition> </control>
<control> Furthermore, <condition> <condition> if the UE operates in SNPN access operation mode </condition> and <condition> <condition> the credentials in the USIM contain an indication to use MSK for derivation of K </condition> <condition> after success of primary authentication </condition> and <condition> key agreement procedure </condition> </condition> </condition> <action> then the ME may generate a new K from the MSK otherwise the ME may generate a new K from the EMSK. </action> </control>
<control> <condition> if the ME generates a new K , </condition> <action> the ME shall generate a new K from the new K , </action> and <action> the K from the AUSF received together with the EAP-request/AKA'-challenge message, </action> and <action> the new K as described in 3GPP TS 33.501 , </action> and <action> create a partial native 5G NAS security context identified by the ngKSI value received together with the EAP-request/AKA'-challenge message in subclause 5.4.1.2.4.2 in the volatile memory of the ME. </action> </control> <control> <condition> If the K and the partial native 5G NAS security context are created, </condition> <action> the ME shall store the K in the created partial AMF AMF native 5G NAS security context and shall send an EAP-response/AKA'-challenge message as specified in IETF RFC 5448 . </action> </control>
NOTE 2: Generation of the new K and the new K does not result into deletion of the valid K and the valid K , if any.
<control> <action> The ME shall not use the new K in the verification of SOR transparent container and UE parameters update transparent container, </action> <condition> <condition> if any are received, </condition> <condition> until receipt of an EAP-success message. </condition> </condition> </control>
<control> <condition> If the EAP-request/AKA'-challenge message contains AT_RESULT_IND attribute, </condition> <action> the UE may include AT_RESULT_IND attribute in the EAP-response/AKA'-challenge message as specified in IETF RFC 5448 . </action> </control>
5.4.1.2.2.4 Errors when handling EAP-request/AKA'-challenge message
<control> <condition> <condition> If a USIM is present, </condition> <condition> the SNN check fails </condition> or <condition> the UE does not accept AUTN during handling of the EAP-request/AKA'- challenge message as specified in IETF RFC 5448 , </condition> </condition> <action> the UE shall send an EAP-response/AKA'-authentication-reject message as specified in IETF RFC 5448 . </action> </control>
<control> <condition> <condition> If a USIM is present, </condition> <condition> the SNN check is successful </condition> <condition> <condition> but the UE detects that the sequence number in AUTN is not correct </condition> <condition> during handling of the EAP-request/AKA'-challenge message as specified in IETF RFC 5448 , </condition> </condition> </condition> <action> the UE shall send an EAP-response/AKA'-synchronization-failure message as specified in IETF RFC 5448 . </action> </control>
<control> <condition> <condition> If a USIM is present, </condition> <condition> the SNN check is successful, </condition> <condition> the sequence number in AUTN is correct </condition> and <condition> <condition> the UE detects another error </condition> <condition> during handling of the EAP-request/AKA'-challenge message as specified in IETF RFC 5448 , </condition> </condition> </condition> <action> the UE shall send an EAP-response/AKA'-client-error message as specified in IETF RFC 5448 . </action> </control>
<control> <condition> If a USIM is not present, </condition> <action> the UE shall send an EAP-response/AKA'-client-error message as specified in IETF RFC 5448 . </action> </control>
<control> <condition> For any of the above, </condition> <action> the UE shall start timer T3520 when the AUTHENTICATION RESPONSE message containing the EAP-response message is sent. </action> Furthermore, <action> the UE shall stop any of the timers T3510, T3517 or T3521 (if they were running). </action> </control> <control> <condition> Upon receiving an AUTHENTICATION REQUEST message with the EAP message IE containing an EAP-request/AKA'-challenge from the network, </condition> <action> the UE shall stop timer T3520, </action> <condition> if running, </condition> and <action> then process the EAP- request/AKA'-challenge information as normal. </action> </control>
5.4.1.2.2.5 Network successfully authenticates UE
<control> <condition> Upon reception of the EAP-response/AKA'-challenge message, </condition> <condition> if procedures for handling an EAP-response/AKA'- challenge message as specified in IETF RFC 5448 are successful </condition> and: </control>
<control> <condition> a) the AUSF acts as the EAP-AKA' server, </condition> <action> the AUSF shall generate EMSK, the K from the EMSK, and the K from the K as described in 3GPP TS 33.501 ; </action> </control> or
<control> <condition> b) the AAA server of the CH or the DCS acts as the EAP-AKA' server, </condition> <action> the AAA server of the CH or the DCS shall generate MSK as described in 3GPP TS 33.501 ; </action> </control> and:
<control> <condition> a) <condition> if the AUSF or the AAA server of the CH or the DCS included the AT_RESULT_IND attribute in the EAP- request/AKA'-challenge message </condition> and <condition> the AT_RESULT_IND attribute is included in the corresponding EAP- response/AKA'-challenge message, </condition> </condition> <action> the AUSF or the AAA server of the CH or the DCS shall send an EAP- request/AKA'-notification message as specified in IETF RFC 5448 ; </action> </control> or
<control> <condition> b) if the AUSF or the AAA server of the CH or the DCS: </condition> </control>
<control> <condition> 1) included the AT_RESULT_IND attribute in the EAP-request/AKA'-challenge message </condition> and <condition> the AT_RESULT_IND attribute is not included in the EAP-response/AKA'-challenge message; </condition> or </control>
<control> <condition> 2) did not include the AT_RESULT_IND attribute in the EAP-request/AKA'-challenge message; </condition> </control>
<control> <action> then the AUSF or the AAA server of the CH or the DCS shall send an EAP-success message as specified in IETF RFC 5448 and shall consider the procedure complete. </action> </control>
NOTE 1: <control> <condition> When the AAA server of the CH or the DCS acts as the EAP-AKA' server, </condition> <action> the AAA server of the CH or the DCS provides (via the NSSAAF) the MSK and the SUPI to the AUSF. </action> </control> <control> <condition> Upon reception of the MSK, </condition> <action> the AUSF generates the K from the MSK, </action> and <action> the K from the K as described in 3GPP TS 33.501 . </action> </control>
NOTE 2: <control> <action> The AUSF provides the K and optionally the SUPI (unless the SEAF provided the AUSF with the SEAF SUPI before) to the SEAF as described in 3GPP TS 33.501 . </action> </control> <control> <condition> Upon reception of the K and SEAF optionally the SUPI, </condition> <action> the SEAF generates the K based on the ABBA, </action> the K and the SUPI as described in 3GPP TS 33.501 and provides ngKSI and the K to the AMF. </control> <control> <condition> Upon reception of the AMF ngKSI and the K , </condition> <action> the AMF creates a partial native 5G NAS security context identified by the ngKSI AMF </action> and <action> stores the K in the created partial native 5G NAS security context. </action> </control>
5.4.1.2.2.6 UE handling EAP-AKA' notification message
<control> <condition> Upon receiving an EAP-request/AKA'-notification message, </condition> <action> the UE shall send an EAP-response/AKA'-notification message as specified in IETF RFC 5448 . </action> </control>
5.4.1.2.2.6A EAP based Identification initiation by the network
<control> <condition> If the AUSF or the AAA server of the CH or the DCS decides to initiate the EAP based identification procedure, </condition> <action> the AUSF or the AAA server of the CH or the DCS shall send an EAP-Request/Identity or EAP-Request/AKA'-Identity message as specified in IETF RFC 5448 . </action> </control>
The AMF shall encapsulate the EAP-Request/Identity or EAP-Request/AKA'-Identity message in the AUTHENTICATION REQUEST message and send it to the UE.
5.4.1.2.2.6B EAP based Identification response by the UE
<control> <condition> Upon receipt of the AUTHENTICATION REQUEST message with EAP-Request/Identity message </condition> <action> the UE shall send an AUTHENTICATION RESPONSE message with EAP-Response/Identity to the network. </action> </control> <control> <condition> In the EAP- Response/Identity message, </condition> <action> the UE shall provide the requested identity according to 3GPP TS 33.501 annex F.2, in the UE identity in the EAP-Response/Identity message as specified in IETF RFC 5448 . </action> </control>
<control> <condition> Upon receipt of the AUTHENTICATION REQUEST message with EAP-Request/AKA'-Identity message </condition> <action> the UE shall send an AUTHENTICATION RESPONSE message with EAP-Response/AKA'-Identity to the network. </action> </control> <control> <condition> Based on the attribute received in the EAP-Request/AKA'-Identity, </condition> <action> the UE shall provide the requested identity according to 3GPP TS 33.501 annex F.2, in the EAP-Response/AKA'-Identity message, as specified in IETF RFC 5448 . </action> </control>
<control> <condition> If the EAP-Request/AKA'-Identity carries the AT_PERMANENT_REQ, </condition> <action> the UE shall respond with EAP- Response/AKA'-Client-Error with the error code "unable to process packet". </action> </control>
5.4.1.2.2.7 Network sending EAP-success message
<control> <condition> <condition> Upon reception of the EAP-response/AKA'-notification message, </condition> <condition> if earlier procedures for handling an EAP- request/AKA'-challenge message as specified in IETF RFC 5448 were successful, </condition> </condition> <action> the AUSF or the AAA server of the CH or the DCS shall send an EAP-success message as specified in IETF RFC 5448 </action> and <action> shall consider the procedure complete. </action> </control>
NOTE: The AUSF provides the K to the SEAF. <control> <condition> Upon reception of the K , </condition> <action> the SEAF generates the K based on the ABBA and the K as described in 3GPP TS 33.501 , </action> and <action> provides ngKSI and the SEAF K to the AMF. </action> </control> <control> <condition> Upon reception of the ngKSI and the K , </condition> <action> the AMF creates a partial native 5G NAS AMF AMF security context identified by the ngKSI, </action> and <action> stores the K in the created partial native 5G NAS AMF security context. </action> </control>
5.4.1.2.2.8 UE handling EAP-success message
<control> <condition> Upon receiving an EAP-success message, </condition> the ME shall: </control>
<control> a) <action> delete the valid K and the valid K , </action> <condition> if any </condition> </control>
<control> <condition> b) <condition> if the ME has not generated a new K </condition> and <condition> a new K and has not created a partial native 5G NAS security context as described in subclause 5.4.1.2.2.3: </condition> </condition> </control>
<control> 1) <condition> <condition> if the UE operates in SNPN access operation mode </condition> and <condition> the credentials in the USIM contain an indication to use MSK for derivation of K </condition> <condition> after success of primary authentication </condition> and <condition> key agreement procedure </condition> </condition> <action> then AUSF generate a new K from the MSK otherwise generate a new K from the EMSK; </action> </control> AUSF NOTE: <control> <condition> <condition> When the UE is registering </condition> or <condition> registered for onboarding services in SNPN, </condition> </condition> credentials in the USIM do not contain an indication to use MSK for derivation of K after success of primary authentication and key agreement procedure. </control>
<control> 2) <action> generate a new K from the new K </action> , and <action> the K from the ABBA that was received with the EAP- success message, </action> and <action> the new K as described in 3GPP TS 33.501 ; </action> </control>
<control> 3) <action> create a partial native 5G NAS security context identified by the ngKSI value in the volatile memory of the ME; </action> </control> and
<control> 4) <action> store the K in the created partial native 5G NAS security context; </action> </control> and AMF
<control> <condition> c) <condition> consider the new K to be the valid K , </condition> and <condition> the new K to be the valid K , </condition> </condition> <action> reset the SOR counter </action> and <action> the UE parameter update counter to zero, </action> and <action> store the valid K the valid K , </action> <action> the SOR counter and the UE parameter update counter as specified in annex C, </action> and <action> use the valid K in the verification of SOR transparent container and UE parameters update transparent container, </action> <condition> if any are received. </condition> </control>
The UE shall consider the procedure complete.
5.4.1.2.2.9 Network not successfully authenticates UE
<control> <condition> <condition> Upon reception of the EAP-response/AKA'-challenge message, </condition> <condition> if procedures for handling an EAP-response/AKA'- challenge message as specified in IETF RFC 5448 are not successful, </condition> </condition> <action> the AUSF or the AAA server of the CH or the DCS shall send an EAP-request/AKA'-notification message that implies failure as specified in IETF RFC 5448 . </action> </control>
5.4.1.2.2.10 Network sending EAP-failure message
<control> <condition> <condition> Upon reception of the EAP-response/AKA'-notification message, </condition> <condition> if earlier procedures for handling an EAP- request/AKA'-challenge message as specified in IETF RFC 5448 were not successful, </condition> </condition> <action> the AUSF or the AAA server of the CH or the DCS shall send an EAP-failure message as specified in IETF RFC 5448 </action> and <action> shall consider the procedure complete. </action> </control>
<control> <condition> If the authentication response (RES) returned by the UE in the AT_RES attribute of the EAP-response/AKA'-challenge message is not valid, </condition> <action> the network handling depends upon the type of identity used by the UE in the initial NAS message, </action> that is: <condition> <condition> a) if the 5G-GUTI was used; </condition> or b) if the SUCI was used. </condition> </control>
<control> <condition> If the 5G-GUTI was used, </condition> <action> the network should transport the EAP-failure message in the AUTHENTICATION RESULT message of the EAP result message transport procedure, </action> <action> initiate an identification procedure to retrieve SUCI from the UE </action> and <action> restart the EAP based primary authentication and key agreement procedure with the received SUCI. </action> </control>
<control> <condition> <condition> If the SUCI was used for identification in the initial NAS message </condition> or <condition> <condition> in a restarted EAP based primary authentication </condition> and <condition> key agreement procedure, </condition> </condition> or <condition> <condition> the network decides not to initiate the identification procedure to retrieve SUCI from the UE </condition> <condition> <condition> after an unsuccessful EAP based primary authentication </condition> and <condition> key agreement procedure, </condition> </condition> </condition> </condition> <action> the network should transport the EAP-failure message in an AUTHENTICATION REJECT message of the EAP result message transport </action> </control>
<control> <condition> <condition> Depending on local requirements or operator preference for emergency services, </condition> <condition> if the UE initiates a registration procedure with 5GS registration type IE set to "emergency registration" </condition> and <condition> the AMF is configured to allow emergency registration without user identity, </condition> </condition> <action> the AMF needs not follow the procedures specified for transporting the EAP-failure message in the AUTHENTICATION REJECT message of the EAP result message transport procedure in the present subclause. </action> </control> <control> <action> The AMF may include the EAP-failure message in a response of the current 5GMM specific procedure </action> or <action> in the AUTHENTICATION RESULT of the EAP result message transport procedure. </action> </control>
5.4.1.2.2.11 UE handling EAP-failure message
<control> <condition> Upon receiving an EAP-failure message, </condition> <action> the UE shall delete the partial native 5G NAS security context </action> and <action> shall delete the new K and the new K , </action> <condition> if any were created as described in subclause 5.4.1.2.2.3. </condition> </control>
<control> <action> The UE shall consider the procedure complete. </action> </control>
<control> <condition> If the EAP-failure message is received in an AUTHENTICATION REJECT message: </condition> </control>
<control> 1) <condition> if the AUTHENTICATION REJECT message has been successfully integrity checked by the NAS: </condition> <control> a) <action> the UE shall set the update status to 5U3 ROAMING NOT ALLOWED </action> , <action> delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI; </action> </control> </control>
<control> <condition> In case of PLMN, </condition> <action> the USIM shall be considered invalid </action> <condition> <condition> until switching off the UE </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> <condition> if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN shall be considered invalid </action> <condition> until the UE is switched off or the entry is updated. </condition> <control> Additionally, <action> the UE shall consider the USIM as invalid for the current SNPN </action> <condition> until switching off or the UICC containing the USIM is removed. </condition> </control> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> <condition> if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN </condition> and <condition> the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid </action> <condition> <condition> until the UE is switched off </condition> or <condition> the entry is updated. </condition> </condition> <control> Additionally, <action> the UE shall consider the USIM as invalid for the entry </action> <condition> until switching off or the UICC containing the USIM is removed. </condition> </control> </control>
<control> <condition> <condition> If the UE is registered for onboarding services in SNPN </condition> or <condition> is performing initial registration for onboarding services in SNPN, </condition> </condition> <action> the UE shall store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 ; </action> </control> <control> <condition> a) if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN, </condition> the UE shall set: </control>
<control> i) <action> the counter for "SIM/USIM considered invalid for GPRS services" events, </action> <action> the counter for "USIM considered invalid for 5GS services over non-3GPP access" events, </action> and <action> the counter for "SIM/USIM considered invalid for non-GPRS services" events </action> <condition> <condition> if maintained by the UE, </condition> <condition> in case of PLMN; </condition> </condition> </control> or
<control> ii) <action> the counter for "the entry for the current SNPN considered invalid for 3GPP access" events </action> and <action> the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events </action> <condition> in case of SNPN; </condition> </control>
<control> <action> to UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the UE is registered for onboarding services in SNPN </condition> or <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> <action> the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value; </action> and <control> <condition> a) if the UE is operating in single-registration mode, </condition> <action> the UE shall handle EMM parameters, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the authentication procedure is not accepted by the network. </condition> <control> <action> The USIM shall be considered as invalid also for non-EPS services </action> <condition> <condition> until switching off </condition> or the UICC containing the USIM is removed; </condition> </control> </control> </control> and
<control> 2) <condition> if the AUTHENTICATION REJECT message is received without integrity protection, </condition> <action> the UE shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, </action> <condition> if the timer is not running </condition> <action> (see subclause 5.3.20). </action> </control>
<control> Additionally, <condition> if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN, </condition> the UE shall: </control>
<control> <condition> a) <condition> if the AUTHENTICATION REJECT message is received over 3GPP access, </condition> and <condition> the counter for "SIM/USIM considered invalid for GPRS services" events in case of PLMN </condition> or <condition> <condition> the counter for "the entry for the current SNPN considered invalid for 3GPP access" events </condition> <condition> in case of SNPN has a value less than a UE implementation-specific maximum value, </condition> </condition> </condition> <action> proceed as specified in subclause 5.3.20, list item 1)-a) of subclause 5.3.20.2 (if the UE is not operating in SNPN access operation mode) or list item a)-1) of subclause 5.3.20.3 (if the UE is operating in SNPN access operation mode) <condition> for the case that the 5GMM cause value received is #3; </condition> </action> </control>
<control> <condition> b) <condition> if the AUTHENTICATION REJECT message is received over non-3GPP access, </condition> and <condition> <condition> the counter for "USIM considered invalid for 5GS services over non-3GPP access" events in case of PLMN </condition> or <condition> the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events </condition> <condition> in case of SNPN has a value less than a UE implementation-specific maximum value, </condition> </condition> </condition> <action> proceed as specified in subclause 5.3.20, list item 1)-b) of subclause 5.3.20.2 (if the UE is not operating in SNPN access operation mode) or list item a)-2) of subclause 5.3.20.3 (if the UE is operating in SNPN access operation mode) <condition> for the case that the 5GMM cause value received is #3; </condition> </action> </control>
<control> <condition> i) if the AUTHENTICATION REJECT message is received over 3GPP access: </condition> <control> a) <action> The UE shall set the update status for 3GPP access to 5U3 ROAMING NOT ALLOWED, </action> <action> delete for 3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. </action> </control> <control> <condition> b) In case of PLMN, </condition> <action> the UE shall consider the USIM as invalid for 5GS services via 3GPP access and invalid for non-EPS service <condition> <condition> until switching off the UE </condition> or the UICC containing the USIM is removed. </condition> </action> </control> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid for 3GPP access <condition> until the UE is switched off or the entry is updated. </condition> </action> </control>
<control> Additionally, <action> the UE shall consider the USIM as invalid for the current SNPN via 3GPP access <condition> until switching off or the UICC containing the USIM is removed. </condition> </action> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid for 3GPP access M <condition> until the UE is switched off or the entry is updated. </condition> </action> <control> Additionally, <action> the UE shall consider the USIM as invalid for the entry via 3GPP access <condition> until switching off or the UICC containing the USIM is removed. </condition> </action> </control> </control> <control> a) The UE shall set: b) <action> the counter for "SIM/USIM considered invalid for GPRS services" events </action> and <action> the counter for "SIM/USIM considered invalid for non-GPRS services" events </action> <condition> <condition> if maintained by the UE, </condition> in case of PLMN; </condition> </control> or <control> c) <action> the counter for "the entry for the current SNPN considered invalid for 3GPP access" events to UE implementation-specific maximum value <condition> in case of SNPN; </condition> </action> </control>
<control> <condition> a) If the UE is operating in single-registration mode, </condition> <action> the UE shall handle 4G-GUTI, TAI list and eKSI as specified in 3GPP TS 24.301 for the case <condition> when the authentication procedure is not accepted by the network. </condition> </action> <control> <action> The USIM shall be considered as invalid also for non-EPS services <condition> until switching off or the UICC containing the USIM is removed; </condition> </action> </control> </control> and
<control> ii) <condition> if the AUTHENTICATION REJECT message is received over non-3GPP access: </condition> <control> a) <action> the UE shall set the update status for non-3GPP access to 5U3 ROAMING NOT ALLOWED, </action> <action> delete for non-3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI; </action> </control> <control> <condition> b) in case of PLMN, </condition> <action> the UE shall consider the USIM as invalid for 5GS services via non-3GPP access </action> <condition> <condition> until switching off the UE </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control> </control>
<control> <condition> In case of SNPN, </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid for non-3GPP access <condition> <condition> until the UE is switched off or the entry is updated.， </condition> </condition> </action> <control> Additionally, <action> the UE shall consider the USIM as invalid for the current SNPN and for non- 3GPP access <condition> <condition> until switching off </condition> or <condition> the UICC containing the USIM is removed; </condition> </condition> </action> </control> </control> and <control> a) <action> the UE shall set: </action> <control> b) the counter for "USIM considered invalid for 5GS services over non-3GPP access" events to UE implementation-specific maximum value <condition> in case of PLMN; </condition> </control> or <control> c) the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events to UE implementation-specific maximum value <condition> in case of SNPN. </condition> </control> </control>
<control> <condition> If the UE is registered for onboarding services in SNPN or performing initial registration for onboarding services in SNPN, </condition> the UE shall: </control>
<control> <condition> a) if the SNPN-specific attempt counter for the SNPN sending the AUTHENTICATION REJECT message has a value less than a UE implementation-specific maximum value, </condition> <action> increment the SNPN-specific attempt counter for the SNPN; </action> or </control>
<control> <condition> b) otherwise, </condition> <action> the UE shall set the update status to 5U3.ROAMING NOT ALLOWED, </action> <action> delete the stored 5G- GUTI, TAI list, last visited registered TAI, and ngKSI, </action> <action> store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If the AUTHENTICATION REJECT message is received by the UE, </condition> <action> the UE shall abort any 5GMM signalling procedure, </action> <action> stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), </action> <end_state> enter state 5GMM- DEREGISTERED </end_state> and <action> delete any stored SUCI. </action> </control>
5.4.1.2.2.12 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) EAP-request/AKA'-challenge message with the key derivation function indicated in AT_KDF attributes </condition> <action> set to a value other than 1. </action> </control>
<control> <action> The UE shall act as specified in IETF RFC 5448 subclause 3.2 </action> <condition> for the case when the AUTN had been incorrect. </condition> </control>
5.4.1.2.3 EAP-TLS related procedures
5.4.1.2.3.1 General
<control> <action> The UE may support acting as EAP-TLS peer as specified in 3GPP TS 33.501 . </action> </control> <control> <action> The AUSF may support acting as EAP-TLS server as specified in 3GPP TS 33.501 . </action> </control> <control> <action> The AAA server of the CH or the DCS may support acting as EAP server of such EAP method as specified in 3GPP TS 23.501 . </action> </control>
<control> <action> The EAP-TLS enables mutual authentication of the UE and the network. </action> </control>
<control> <condition> <condition> When initiating an EAP based primary authentication </condition> and <condition> key agreement procedure using EAP-TLS, </condition> </condition> <action> the network shall select an ngKSI value. </action> <control> <condition> <condition> If an ngKSI is contained in an initial NAS message <condition> during a 5GMM procedure, </condition> </condition> </condition> <action> the network shall select a different ngKSI value. </action> </control> <control> <action> The network shall send the selected ngKSI value to the UE along with each EAP message. </action> </control> <control> <action> The network shall send the ABBA value as described in subclause 9.11.3.10 to the UE along with the EAP- request message and EAP-success message. </action> </control> </control>
<control> <condition> When the EAP based primary authentication and key agreement procedure uses EAP-TLS: </condition> </control>
<control> <condition> a) if the UE operates in SNPN access operation mode </condition> and: </control>
<control> 1) <condition> <condition> the default UE credentials for primary authentication, </condition> <condition> <condition> if the UE is registering </condition> or <condition> registered for onboarding services in SNPN; </condition> </condition> </condition> </control> or
<control> 2) <condition> <condition> credentials in the selected entry of the "list of subscriber data", </condition> <condition> <condition> if the UE is not registering </condition> or <condition> registered for onboarding services in SNPN; </condition> </condition> </condition> </control>
<control> <condition> <condition> contain an indication to use MSK for derivation of K </condition> <condition> after success of primary authentication </condition> and <condition> key agreement procedure </condition> </condition> <action> then the ME shall generate MSK as described in 3GPP TS 33.501 </action> <condition> otherwise </condition> <action> the ME shall generate EMSKas described in 3GPP TS 33.501 ; </action> </control>
<control> <condition> b) if the AUSF acts as the EAP-TLS server, </condition> <action> the AUSF shall generate EMSKas described in 3GPP TS 33.501 ; </action> </control> and
<control> <condition> c) if the AAA server of the CH or the DCS acts as the EAP-TLS server, </condition> <action> the AAA server of the CH or the DCS shall generate MSKas described in 3GPP TS 33.501 . </action> </control>
<control> <condition> <condition> When handling of an EAP-request message results into generation of MSK or EMSK, </condition> <condition> if the UE operates in SNPN access operation mode </condition> </condition> and: </control>
<control> <condition> a) <condition> the default UE credentials for primary authentication, </condition> <condition> <condition> if the UE is registering </condition> or <condition> registered for onboarding services in SNPN; </condition> </condition> </condition> </control> or
<control> <condition> b) <condition> credentials in the selected entry of the "list of subscriber data", </condition> <condition> <condition> if the UE is not registering </condition> or <condition> registered for onboarding services in SNPN; </condition> </condition> </condition> </control> <control> <condition> <condition> contain an indication to use MSK for derivation of K </condition> <condition> <condition> after success of primary authentication </condition> and <condition> key agreement procedure , </condition> </condition> </condition> <action> then the ME may generate a new K from the MSK </action> <condition> otherwise </condition> <action> the ME may generate a new K from AUSF AUSF the EMSK. </action> </control>
<control> <condition> If the ME generates a new K , </condition> <action> the ME shall generate a new K from the new K , and the K from the received together with the EAP-request message, </action> and <action> the new K as described in 3GPP TS 33.501 , </action> and <action> SEAF create a partial native 5G NAS security context identified by the ngKSI value received together with the EAP-request message in subclause 5.4.1.2.4.2, </action> <condition> in the volatile memory of the ME. </condition> <control> <condition> If the K and the partial native 5G NAS security AMF context are created, </condition> <action> the ME shall store the K in the created partial native 5G NAS security context. </action> </control> </control>
NOTE 1: Generation of the new K and the new K does not result into deletion of the valid K and the valid K , if any.
<control> <action> The ME shall not use the new K in the verification of SOR transparent container and UE parameters update AUSF transparent container, </action> <condition> <condition> if any are received, </condition> <condition> until receipt of an EAP-success message. </condition> </condition> </control>
<control> <condition> <condition> When the AUSF acts as the EAP-TLS server </condition> and <condition> handling of an EAP response message results into generation of EMSK, </condition> </condition> <action> the AUSF shall generate the K from the EMSK, and the K from the K as described in 3GPP TS 33.501 . </action> </control>
NOTE 2: <control> <condition> When the AAA server of the CH or the DCS acts as the EAP-TLS server, </condition> <action> the AAA server of the CH or the DCS provides (via the NSSAAF) the MSK and the SUPI to the AUSF. </action> <control> <condition> Upon reception of the MSK, </condition> <action> the AUSF generates the K from the MSK, and the K from the K as described in 3GPP TS 33.501 . </action> </control> </control>
NOTE 3: <control> <action> The AUSF provides the K and optionally the SUPI <condition> (unless the SEAF provided the AUSF with the SEAF SUPI before) </condition> to the SEAF as described in 3GPP TS 33.501 . </action> <control> <condition> Upon reception of the K and SEAF optionally the SUPI, </condition> <action> the SEAF generates the K based on the ABBA, the K and the SUPI as described in 3GPP TS 33.501 , </action> and <action> provides ngKSI and the K to the AMF. </action> </control> <control> <condition> Upon reception of the AMF ngKSI and the K , </condition> <action> the AMF creates a partial native 5G NAS security context identified by the ngKSI, AMF </action> and <action> stores the K in the created partial native 5G NAS security context. </action> </control> </control>
<control> <condition> If the UE does not accept the server certificate of the network, </condition> <action> the UE shall start timer T3520 <condition> when the AUTHENTICATION RESPONSE message containing the EAP-response message is sent. </condition> </action> <control> Furthermore, <action> the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). </action> </control> <control> <condition> Upon receiving an AUTHENTICATION REQUEST message with the EAP message IE containing an EAP-request message from the network, </condition> <action> the UE shall stop timer T3520, <condition> if running, </condition> </action> and <action> then process the EAP-request message as normally. </action> </control> </control>
<control> <condition> If the network does not accept the client certificate of the UE, </condition> <action> the network handling depends upon the type of identity used by the UE in the initial NAS message, </action> that is: <control> <condition> a) if the 5G-GUTI was used; </condition> </control> or <control> <condition> b) if the SUCI was used. </condition> </control> </control>
<control> <condition> If the 5G-GUTI was used, </condition> <action> the network should transport the EAP-failure message in the AUTHENTICATION RESULT message of the EAP result message transport procedure, </action> <action> initiate an identification procedure to retrieve SUCI from the UE </action> and <action> restart the EAP based primary authentication and key agreement procedure with the received SUCI. </action> </control>
<control> <condition> <condition> If the SUCI was used for identification in the initial NAS message </condition> or <condition> <condition> in a restarted EAP based primary authentication </condition> and <condition> key agreement procedure, </condition> </condition> or <condition> <condition> the network decides not to initiate the identification procedure to retrieve SUCI from the UE <condition> after <condition> an unsuccessful the EAP based primary authentication </condition> and <condition> key agreement procedure, </condition> </condition> </condition> </condition> </condition> <action> the network should transport the EAP-failure message in an AUTHENTICATION REJECT message of the EAP result message transport procedure. </action> </control>
<control> <condition> <condition> Depending on <condition> local requirements </condition> or <condition> operator preference </condition> for emergency services, </condition> <condition> <condition> if the UE initiates a registration procedure with 5GS registration type IE set to "emergency registration" </condition> and <condition> the AMF is configured to allow emergency registration without user identity, </condition> </condition> </condition> <action> the AMF needs not follow the procedures specified for transporting the EAP-failure message in the AUTHENTICATION REJECT message of the EAP result message transport procedure in the present subclause. </action> <control> <action> The AMF may include the EAP-failure message in a response of the current 5GMM specific procedure </action> or <action> in the AUTHENTICATION RESULT of the EAP result message transport procedure. </action> </control> </control>
<control> <condition> If the EAP-failure message is received in an AUTHENTICATION REJECT message: </condition> </control>
<control> <condition> a) if the AUTHENTICATION REJECT message has been successfully integrity checked by the NAS: </condition> </control>
<control> 1) <action> the UE shall set the update status to 5U3 ROAMING NOT ALLOWED, </action> <action> delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. </action> </control>
<control> <condition> In case of PLMN, </condition> <action> the USIM shall be considered invalid <condition> <condition> until switching off the UE </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </action> </control>
<control> <condition> <condition> <condition> In case of SNPN, </condition> <condition> if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN </condition> </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN shall be considered invalid </action> <condition> until the UE is switched off or the entry is updated; </condition> </control>
<control> <condition> <condition> <condition> In case of SNPN, </condition> <condition> if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN </condition> </condition> and <condition> the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid </action> <condition> until the UE is switched off or the entry is updated. </condition> </control>
<control> <condition> <condition> If the UE is registered for onboarding services in SNPN </condition> or <condition> is performing initial registration for onboarding services in SNPN, </condition> </condition> <action> the UE shall store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 ; </action> </control>
<control> 2) <condition> <condition> if the UE is neither registered for onboarding services in SNPN </condition> nor <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> the UE shall set: </control>
<control> i) <action> the counter for "SIM/USIM considered invalid for GPRS services" events, </action> <action> the counter for "USIM considered invalid for 5GS services over non-3GPP access" events, </action> and <action> the counter for "SIM/USIM considered invalid for non-GPRS services" events </action> <condition> <condition> if maintained by the UE, </condition> <condition> in case of PLMN; </condition> </condition> </control> or
<control> ii) <action> the counter for "the entry for the current SNPN considered invalid for 3GPP access" events </action> and <action> the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events </action> <condition> in case of SNPN; </condition> </control> NOTE 4: The term "non-3GPP access" used in the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events, is used to express access to SNPN services via a PLMN.
<control> <action> to UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the UE is registered for onboarding services in SNPN </condition> or <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> <action> the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value; </action> </control> and
<control> 3) <condition> if the UE is operating in single-registration mode, </condition> <action> the UE shall handle EMM parameters, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the authentication procedure is not accepted by the network. </condition> <control> <action> The USIM shall be considered as invalid also for non-EPS services </action> <condition> <condition> until switching off </condition> or <condition> the UICC containing the USIM is removed; </condition> </condition> </control> </control> and
<control> <condition> b) if the AUTHENTICATION REJECT message is received without integrity protection, </condition> <action> the UE shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, </action> <condition> if the timer is not running (see subclause 5.3.20). </condition> </control>
<control> Additionally, <condition> <condition> if the UE is neither registered for onboarding services in SNPN </condition> nor <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> </control> the UE shall:
<control> 1) <condition> <condition> if the AUTHENTICATION REJECT message is received over 3GPP access, </condition> and <condition> <condition> the counter for "SIM/USIM considered invalid for GPRS services" events in case of PLMN </condition> or <condition> the counter for "the entry for the current SNPN considered invalid for 3GPP access" events in case of SNPN has a value less than a UE implementation-specific maximum value, </condition> </condition> </condition> <action> proceed as specified in subclause 5.3.20, list item 1)-a) of subclause 5.3.20.2 (if the UE is not SNPN enabled or is not operating in SNPN access operation mode) </action> or <action> list item a) 1) of subclause 5.3.20.3 (if the UE is operating in SNPN access operation mode) </action> <condition> for the case that the 5GMM cause value received is #3; </condition> </control>
<control> 2) <condition> <condition> if the AUTHENTICATION REJECT message is received over non-3GPP access, </condition> and <condition> <condition> the counter for "USIM considered invalid for 5GS services over non-3GPP access" events </condition> <condition> in case of PLMN </condition> or <condition> <condition> the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events </condition> <condition> in case of SNPN has a value less than a UE implementation-specific maximum value, </condition> </condition> </condition> </condition> <action> proceed as specified in subclause 5.3.20, list item 1)-b) of subclause 5.3.20.2 (if the UE is not operating in SNPN access operation mode) </action> or <action> list item a)-2) of subclause 5.3.20.3 (if the UE is operating in SNPN access operation mode) </action> <condition> for the case that the 5GMM cause value received is #3; </condition> </control> or
<control> 3) <condition> otherwise: </condition> </control>
<control> <condition> i) if the AUTHENTICATION REJECT message is received over 3GPP access: </condition> </control>
<control> A) <action> the UE shall set the update status for 3GPP access to 5U3 ROAMING NOT ALLOWED, </action> <action> delete for 3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. </action> </control>
<control> <condition> In case of PLMN, </condition> <action> the UE shall consider the USIM as invalid for 5GS services via 3GPP access </action> and <action> invalid for non-EPS service </action> <condition> until switching off the UE or the UICC containing the USIM is removed. </condition> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid for 3GPP access </action> <condition> until the UE is switched off or the entry is updated; </condition> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid for 3GPP access </action> <condition> until the UE is switched off or the entry is updated; </condition> </control> <control> <control> B) the UE shall set: <control> a) <action> the counter for "SIM/USIM considered invalid for GPRS services" events </action> and <action> the counter for "SIM/USIM considered invalid for non-GPRS services" events </action> <condition> <condition> if maintained by the UE, </condition> <condition> in case of PLMN; </condition> </condition> </control> or <control> b) <action> the counter for "the entry for the current SNPN considered invalid for 3GPP access" events </action> <condition> in case of SNPN; </condition> </control> </control> </control>
<control> <action> to UE implementation-specific maximum value; </action> </control> and <control> <condition> c) If the UE is operating in single-registration mode, </condition> <action> the UE shall handle 4G-GUTI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the authentication procedure is not accepted by the network. </condition> <control> <action> The USIM shall be considered as invalid also for non-EPS services </action> <condition> until switching off or the UICC containing the USIM is removed; </condition> </control> </control> and
<control> ii) <condition> if the AUTHENTICATION REJECT message is received over non-3GPP access: </condition> </control>
<control> A) <action> the UE shall set the update status for non-3GPP access to 5U3 ROAMING NOT ALLOWED, </action> <action> delete for non-3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. </action> <control> <condition> In case of PLMN, </condition> <action> the USIM shall be considered invalid for 5GS services via non-3GPP access </action> <condition> <condition> until switching off the UE </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control> <control> <condition> In case of SNPN, </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN shall be considered invalid for non-3GPP access <condition> until the UE is switched off </condition> or <condition> the entry is updated; </condition> </action> </control> </control> and <control> B) <action> the UE shall set the counter for "USIM considered invalid for 5GS services over non-3GPP access" events </action> <condition> <condition> in case of PLMN </condition> or <condition> <condition> the counter for "the entry for the current SNPN considered invalid for non- 3GPP access" events </condition> <condition> in case of SNPN to UE implementation-specific maximum value. </condition> </condition> </condition> </control>
<control> <condition> <condition> If the UE is registered for onboarding services in SNPN </condition> or <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> the UE shall: </control>
<control> 1) <condition> if the SNPN-specific attempt counter for the SNPN sending the AUTHENTICATION REJECT message has a value less than a UE implementation-specific maximum value, </condition> <action> increment the SNPN-specific attempt counter for the SNPN; </action> </control> or
<control> 2) <condition> otherwise, </condition> <action> the UE shall set the update status to 5U3.ROAMING NOT ALLOWED, </action> <action> delete the stored 5G- GUTI, TAI list, last visited registered TAI, and ngKSI, </action> <action> store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If the AUTHENTICATION REJECT message is received by the UE, </condition> <action> the UE shall abort any 5GMM signalling procedure, </action> <action> stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), </action> <end_state> enter state 5GMM- DEREGISTERED </end_state> and <action> delete any stored SUCI. </action> </control>
<control> <condition> Upon receiving an EAP-success message, </condition> the ME shall: </control>
<control> a) <action> delete the valid K and the valid K , </action> <condition> if any; </condition> </control>
<control> <condition> b) <condition> if the ME has not generated a new K and a new K </condition> and <condition> <condition> has not created a partial native 5G NAS security context </condition> <condition> when handling the EAP-request message <condition> which resulted into generation of EMSK or MSK as described above: </condition> </condition> </condition> </condition> </control>
<control> 1) <condition> if the UE operates in SNPN access operation mode </condition> and: </control>
<control> <condition> i) <condition> the default UE credentials for primary authentication, </condition> <condition> <condition> if the UE is registering </condition> or <condition> registered for onboarding services </condition> in SNPN; </condition> </condition> </control> or
<control> ii) <condition> <condition> credentials in the selected entry of the "list of subscriber data", </condition> <condition> if the UE is not registering </condition> or <condition> registered for onboarding services in SNPN; </condition> </condition> </control>
<control> <action> contain an indication to use MSK for derivation of K </action> <condition> <condition> after success of primary authentication </condition> and <condition> key agreement procedure </condition> </condition> then <action> generate a new K from the MSK </action> <condition> otherwise </condition> <action> generate a new K from the EMSK; </action> </control>
<control> 2) <action> generate a new K from the new K , and the K from the ABBA that was received with the EAP- success message, and the new K as described in 3GPP TS 33.501 ; </action> </control>
<control> 3) <action> create a partial native 5G NAS security context identified by the ngKSI value in the volatile memory of the ME; </action> </control> and
<control> 4) <action> store the K in the created partial native 5G NAS security context; </action> </control> and AMF
<control> c) <action> consider the new K to be the valid K , and the new K to be the valid K , </action> <action> reset the SOR counter and the UE parameter update counter to zero, </action> <action> store the valid K the valid K , </action> <action> the SOR counter and the UE parameter update counter as specified in annex C, </action> and <action> use the valid K in the verification of SOR transparent container and UE parameters update transparent container, </action> <condition> if any are received. </condition> </control>
<control> <action> The UE shall consider the procedure complete. </action> </control>
<control> <condition> Upon receiving an EAP-failure message, </condition> <action> the UE shall delete the partial native 5G NAS security context </action> and <action> shall delete the new K and the new K , </action> <condition> <condition> if any were created </condition> <condition> <condition> when handling the EAP-request message </condition> <condition> which resulted into generation of EMSK or MSK as described above. </condition> </condition> </condition> </control>
<control> <action> The UE shall consider the procedure complete. </action> </control>
5.4.1.2.3A Procedures related to EAP methods other than EAP-AKA' and EAP-TLS 5.4.1.2.3A.1 General
This subclause applies when an EAP method:
a) supporting mutual authentication;
b) supporting EMSK or MSK generation; and
c) other than EAP-AKA' and EAP-TLS; is used for primary authentication and key agreement in an SNPN.
<control> <action> The UE may support acting as EAP peer of such EAP method as specified in 3GPP TS 33.501 . </action> <control> <action> The AUSF may support acting as EAP server of such EAP method as specified in 3GPP TS 33.501 . </action> </control> <control> <action> The AAA server of the CH or the DCS may support acting as EAP server of such EAP method as specified in 3GPP TS 23.501 . </action> </control> </control>
<control> <condition> When initiating an EAP based primary authentication and key agreement procedure using such EAP method, </condition> <action> the network shall select an ngKSI value. </action> <control> <condition> If an ngKSI is contained in an initial NAS message during a 5GMM procedure, </condition> <action> the network shall select a different ngKSI value. </action> </control> <control> <action> The network shall send the selected ngKSI value to the UE along with each EAP message. </action> </control> <control> <action> The network shall send the ABBA value as described in subclause 9.11.3.10 to the UE along with the EAP-request message and EAP-success message. </action> </control> </control>
<control> <condition> When the EAP based primary authentication and key agreement procedure uses such EAP method: </condition> </control>
a) if:
<control> 1) <condition> <condition> the default UE credentials for primary authentication, </condition> <condition> <condition> if the UE is registering </condition> or <condition> registered for onboarding services in SNPN; </condition> </condition> </condition> </control> or
<control> 2) <condition> <condition> credentials in the selected entry of the "list of subscriber data", </condition> <condition> <condition> if the UE is not registering </condition> or <condition> registered for onboarding services in SNPN; </condition> </condition> </condition> </control>
<control> <condition> <condition> contain an indication to use MSK for derivation of K </condition> <condition> <condition> after success of primary authentication </condition> and <condition> key agreement procedure </condition> </condition> </condition> <action> then the ME shall generate MSK as described in 3GPP TS 33.501 </action> <condition> otherwise </condition> <action> the ME shall generate EMSKas described in 3GPP TS 33.501 ; </action> </control>
<control> <condition> b)if the AUSF acts as the EAP server, </condition> <action> the AUSF shall generate EMSK as described in 3GPP TS 33.501 ; </action> </control> and
<control> <condition> c) if the AAA server of the CH or the DCS acts as the EAP server, </condition> <action> the AAA server of the CH or the DCS shall generate MSKas described in 3GPP TS 33.501 . </action> </control>
<control> <condition> When handling of an EAP-request message results into generation of MSK or EMSK, </condition> if: </control>
<control> <condition> a) <condition> the default UE credentials for primary authentication, </condition> <condition> if the UE is registering or registered for onboarding services in SNPN; </condition> </condition> </control> or
<control> <condition> b) <condition> credentials in the selected entry of the "list of subscriber data", </condition> <condition> <condition> if the UE is not registering </condition> or <condition> registered for onboarding services in SNPN; </condition> </condition> </condition> </control> <control> <condition> <condition> contain an indication to use MSK for derivation of K </condition> <condition> after success of primary authentication </condition> and <condition> key agreement procedure </condition> </condition> <action> then the ME may generate a new K from the MSK </action> <condition> otherwise </condition> <action> the ME may generate a new K from the EMSK. </action> </control>
<control> <condition> If the ME generates a new K , </condition> <action> the ME shall generate a new K from the new K , and the K from the received together with the EAP-request message, and the new K as described in 3GPP TS 33.501 , </action> and <action> SEAF create a partial native 5G NAS security context identified by the ngKSI value received together with the EAP-request message in subclause 5.4.1.2.4.2, in the volatile memory of the ME. </action> <condition> If the K and the partial native 5G NAS security AMF context are created, </condition> <action> the ME shall store the K in the created partial native 5G NAS security context. </action> </control>
NOTE 1: Generation of the new K and the new K does not result into deletion of the valid K and the valid K , if any.
<control> <action> The ME shall not use the new K in the verification of SOR transparent container and UE parameters update transparent container, </action> <condition> <condition> if any are received, </condition> until receipt of an EAP-success message. </condition> </control>
<control> <condition> <condition> When the AUSF acts as the EAP server </condition> and <condition> handling of an EAP response message results into generation of EMSK, </condition> </condition> <action> the AUSF shall generate the K from the EMSK, </action> and the K from the K as described in 3GPP TS 33.501 </control>
NOTE 2: <control> , <condition> <condition> When the AAA server of the CH or the DCS acts as the EAP server </condition> and <condition> handling of an EAP response message results into generation of MSK, </condition> </condition> <action> the AAA server of the CH or the DCS provides (via the NSSAAF) the MSK and the SUPI to the AUSF. </action> <control> <condition> Upon reception of the MSK, </condition> <action> the AUSF generates the K from the MSK, and the K from the K as described in 3GPP TS 33.501 . </action> </control> </control>
NOTE 3: <control> <action> The AUSF provides the K and optionally the SUPI (unless the SEAF provided the AUSF with the SEAF SUPI before) to the SEAF as described in 3GPP TS 33.501 . </action> <control> <condition> Upon reception of the K and SEAF optionally the SUPI, </condition> <action> the SEAF generates the K based on the ABBA, the K and the SUPI as described in 3GPP TS 33.501 , </action> and <action> provides ngKSI and the K to the AMF. </action> </control> <control> <condition> Upon reception of the AMF ngKSI and the K , </condition> <action> the AMF creates a partial native 5G NAS security context identified by the ngKSI, AMF </action> and <action> stores the K in the created partial native 5G NAS security context. </action> </control> </control>
<control> <condition> If the UE fails to authenticate the network, </condition> <action> the UE shall start timer T3520 </action> <condition> when the AUTHENTICATION RESPONSE message containing the EAP-response message is sent. </condition> <control> Furthermore, <action> the UE shall stop any of the retransmission timers <condition> that are running (e.g. T3510, T3517 or T3521). </condition> </action> </control> <control> <condition> Upon receiving an AUTHENTICATION REQUEST message with the EAP message IE containing an EAP-request message from the network, </condition> <action> the UE shall stop timer T3520, </action> <condition> if running, </condition> and <action> then process the EAP-request message as normally. </action> </control> </control>
<control> <condition> If the network fails to authenticate the UE, </condition> <action> the network handling depends upon the type of identity used by the UE in the initial NAS message, </action> that is: <control> <condition> a) if the 5G-GUTI was used; </condition> </control> or <control> <condition> b) if the SUCI was used. </condition> </control> </control>
<control> <condition> If the 5G-GUTI was used, </condition> <action> the network should transport the EAP-failure message in the AUTHENTICATION RESULT message of the EAP result message transport procedure, </action> <action> initiate an identification procedure to retrieve SUCI from the UE </action> and <action> restart the EAP based primary authentication and key agreement procedure with the received SUCI. </action> </control>
<control> <condition> <condition> If the SUCI was used for identification <condition> in the initial NAS message </condition> or <condition> in a restarted EAP based primary authentication and key agreement procedure, </condition> </condition> or <condition> the network decides not to initiate the identification procedure to retrieve SUCI from the UE <condition> after an unsuccessful the EAP based primary authentication and key agreement procedure, </condition> </condition> </condition> <action> the network should transport the EAP-failure message in an AUTHENTICATION REJECT message of the EAP result message transport procedure. </action> </control>
<control> <condition> If the EAP-failure message is received in an AUTHENTICATION REJECT message: </condition> </control>
<control> <condition> a) if the AUTHENTICATION REJECT message has been successfully integrity checked by the NAS: </condition> </control>
<control> 1) <action> the UE shall set the update status to 5U3 ROAMING NOT ALLOWED, </action> <action> delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. </action> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> <condition> if the UE is neither registered for onboarding services in SNPN </condition> nor <condition> performing initial registration for onboarding services in SNPN </condition> </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN shall be considered invalid </action> <condition> <condition> until the UE is switched off </condition> or the entry is updated; </condition> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> <condition> if the UE is neither registered for onboarding services in SNPN </condition> nor <condition> performing initial registration for onboarding services in SNPN </condition> </condition> and <condition> the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid </action> <condition> <condition> until the UE is switched off </condition> or <condition> the entry is updated. </condition> </condition> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> <condition> if the UE is registered for onboarding services in SNPN </condition> or <condition> is performing initial registration for onboarding services in SNPN, </condition> </condition> </condition> <action> the UE shall store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 ; </action> </control> and
<control> 2) <condition> <condition> if the UE is neither registered for onboarding services in SNPN </condition> nor <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> <action> the UE shall set the counter for "the entry for the current SNPN considered invalid for 3GPP access" events </action> and <action> the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events <condition> in case of SNPN </condition> UE implementation-specific maximum value. </action> </control>
NOTE 4: The term "non-3GPP access" used in the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events, is used to express access to SNPN services via a PLMN.
<control> <condition> <condition> If the UE is registered for onboarding services in SNPN </condition> or <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> <action> the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value; </action> </control> and
<control> <condition> b) if the AUTHENTICATION REJECT message is received without integrity protection, </condition> <action> the UE shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, </action> <condition> if the timer is not running (see subclause 5.3.20). </condition> </control>
<control> Additionally, <condition> <condition> if the UE is neither registered for onboarding services in SNPN </condition> nor <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> the UE shall: </control>
<control> 1) <condition> <condition> if the AUTHENTICATION REJECT message is received over 3GPP access, </condition> and <condition> the counter for "the entry for the current SNPN considered invalid for 3GPP access" events has a value less than a UE implementation- specific maximum value, </condition> </condition> <action> proceed as specified in list item a) 1) of subclause 5.3.20.3 for the case that the 5GMM cause value received is #3; </action> </control>
<control> 2) <condition> <condition> if the AUTHENTICATION REJECT message is received over non-3GPP access, </condition> and <condition> the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events has a value less than a UE implementation-specific maximum value, </condition> </condition> <action> proceed as specified in list item a)-2) of subclause 5.3.20.3 for the case that the 5GMM cause value received is #3; </action> </control> or
<control> 3) <condition> otherwise: </condition> </control>
<control> <condition> i) if the AUTHENTICATION REJECT message is received over 3GPP access: </condition> <control> a) <action> the UE shall set the update status for 3GPP access to 5U3 ROAMING NOT ALLOWED, </action> <action> delete for 3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI; </action> </control> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN shall be considered invalid for 3GPP access </action> <condition> <condition> until the UE is switched off </condition> or <condition> the entry is updated; </condition> </condition> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid </action> <condition> <condition> until the UE is switched off </condition> or <condition> the entry is updated; </condition> </condition> </control> and <control> a) <action> the UE shall set the counter for "the entry for the current SNPN considered invalid for 3GPP access" events to UE implementation-specific maximum value; </action> </control> and
<control> ii) <condition> if the AUTHENTICATION REJECT message is received over non-3GPP access: </condition> <control> a) <action> the UE shall set the update status for non-3GPP access to 5U3 ROAMING NOT ALLOWED, </action> <action> delete for non-3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. </action> <control> <action> The entry of the "list of subscriber data" with the SNPN identity of the current SNPN shall be considered invalid for non-3GPP access </action> <condition> <condition> until the UE is switched off </condition> or <condition> the entry is updated; </condition> </condition> </control> </control> and <control> b) <action> the UE shall set the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events to UE implementation-specific maximum value. </action> </control> </control>
NOTE 5: <control> The AUTHENTICATION REJECT message "received over non-3GPP access" in this subclause refers to an AUTHENTICATION REJECT message received via a PLMN <condition> when the UE attempts to access SNPN services via a PLMN. </condition> </control>
<control> <condition> <condition> If the UE is registered for onboarding services in SNPN </condition> or <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> the UE shall: </control>
<control> 1) <condition> if the SNPN-specific attempt counter for the SNPN sending the AUTHENTICATION REJECT message has a value less than a UE implementation-specific maximum value, </condition> <action> increment the SNPN-specific attempt counter for the SNPN; </action> </control> or
<control> 2) <condition> otherwise, </condition> <action> the UE shall set the update status to 5U3.ROAMING NOT ALLOWED, </action> <action> delete the stored 5G- GUTI, TAI list, last visited registered TAI, and ngKSI, </action> <action> store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If the AUTHENTICATION REJECT message is received by the UE, </condition> <action> the UE shall abort any 5GMM signalling procedure, </action> <action> stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), </action> <end_state> enter state 5GMM- DEREGISTERED </end_state> and <action> delete any stored SUCI. </action> </control>
<control> <condition> Upon receiving an EAP-success message, </condition> the ME shall: </control>
<control> a) <action> delete the valid K and the valid K , </action> <condition> if any; </condition> </control>
<control> <condition> b) <condition> if the ME has not generated a new K </condition> and <condition> <condition> a new K and has not created a partial native 5G NAS security context </condition> <condition> when handling the EAP-request message <condition> which resulted into generation of EMSK as described above: </condition> </condition> </condition> </condition> </control>
1) if:
<control> <condition> i) <condition> the default UE credentials for primary authentication, </condition> <condition> <condition> if the UE is registering </condition> or <condition> registered for onboarding services in SNPN; </condition> </condition> </condition> </control> or
<control> ii) <condition> <condition> credentials in the selected entry of the "list of subscriber data", </condition> <condition> <condition> if the UE is not registering </condition> or <condition> registered for onboarding services in SNPN; </condition> </condition> </condition> </control>
<control> <condition> <condition> contain an indication to use MSK for derivation of K <condition> <condition> after success of primary authentication </condition> and </condition> key agreement procedure </condition> </condition> <action> then generate a new K from the MSK otherwise generate a new K from the EMSK; </action> </control>
<control> 2) <action> generate a new K from the new K , and the K from the ABBA that was received with the EAP- success message, and the K as described in 3GPP TS 33.501 ; </action> </control>
<control> 3) <action> create a partial native 5G NAS security context identified by the ngKSI value in the volatile memory of the ME; </action> </control> and
<control> 4) <action> store the K in the created partial native 5G NAS security context; </action> </control> and
<control> c) <action> consider the new K to be the valid K_AUSF, and the new K_SEAF to be the valid K_SEAF , </action> <action> reset the SOR counter and the UE parameter update counter to zero, </action> <action> store the valid K the valid K , </action> <action> the SOR counter </action> and <action> the UE parameter update counter as specified in annex C, </action> and <action> use the valid K in the verification of SOR transparent container and UE parameters update transparent container, </action> <condition> if any are received. </condition> </control>
The UE shall consider the procedure complete.
<control> <condition> Upon receiving an EAP-failure message, </condition> <action> the UE shall delete the partial native 5G NAS security context </action> and <action> shall delete the new K and the new K , </action> <condition> <condition> if any were created </condition> <condition> <condition> when handling the EAP-request message </condition> <condition> which resulted into generation of EMSK or MSK as described above. </condition> </condition> </condition> </control>
The UE shall consider the procedure complete.
5.4.1.2.3A.2 EAP-TTLS with two phases of authentication
The UE may support acting as EAP peer of EAP-TTLS with two phases of authentication as specified in 3GPP TS 33.501 and acting as peer of a legacy authentication protocol as specified in 3GPP TS 33.501 . The AUSF may support acting as EAP server of EAP-TTLS with two phases of authentication as specified in 3GPP TS 33.501 . The AAA server of CH may support acting a server of a legacy authentication protocol as specified in 3GPP TS 33.501 .
<control> <condition> When EAP-TTLS with two phases of authentication as specified in 3GPP TS 33.501 is used for primary authentication and key agreement in an SNPN: </condition> </control>
<control> a) <action> requirements in subclause 5.4.1.2.3A.1 shall apply in addition to requirements specified in 3GPP TS 33.501 annex U. </action> </control>
<control> b) <action> indication to use MSK for derivation of K after success of primary authentication and key agreement procedure </action> <condition> is not included in: </condition> </control>
<control> 1) <condition> <condition> the default UE credentials for primary authentication, </condition> <condition> <condition> if the UE is registering </condition> or <condition> registered for onboarding services in SNPN; </condition> </condition> </condition> </control> or
<control> 2) <condition> <condition> credentials in the selected entry of the "list of subscriber data", </condition> <condition> <condition> if the UE is not registering or registered for onboarding services in SNPN. </condition> </condition> </condition> </control>
<control> c) <action> the SUPI of the UE is in the form of a SUPI </action> <condition> with the SUPI format "network specific identifier" </condition> containing a network-specific identifier. </control>
NOTE: Support of EAP-TTLS with two phases of authentication is based on the informative requirements as specified in 3GPP TS 33.501 .
5.4.1.2.3B Procedures related to EAP methods used for primary authentication of an N5GC device 5.4.1.2.3B.1 General
<control> This subclause applies <condition> when an EAP method: </condition> </control>
<control> <condition> a) supporting mutual authentication; </condition> </control> and
<control> <condition> b) other than EAP-AKA', </condition> </control>
<control> <condition> is used for primary authentication of an N5GC device, </condition> <condition> when an W-AGF supports acting on behalf of the N5GC device, </condition> <condition> <condition> the AMF supports serving the W-AGF acting on behalf of the N5GC device </condition> and <condition> the AUSF supports authentication of the N5GC device. </condition> </condition> EAP-TLS is an example of such EAP method. </control>
NOTE 1: <control> <condition> <condition> Neither the N5GC device </condition> nor <condition> the AUSF </condition> </condition> derive any 5G related keys <condition> <condition> during </condition> or <condition> after the primary authentication. </condition> </condition> </control>
<control> <action> The AUSF supporting authentication of the N5GC device shall support acting as EAP server of at least one such EAP method as specified in annex O of 3GPP TS 33.501 . </action> </control>
<control> <action> The N5GC device shall support acting as EAP peer of at least one such EAP method as specified in annex O of 3GPP TS 33.501 , which is also supported by the AUSF. </action> </control>
<control> <action> The W-AGF <condition> acting on behalf of the N5GC device </condition> provides to the N5GC device an EAP-request message, an EAP- success message or an EAP-failure message received from the network according to subclause 5.4.1.2.1 and sends to the network according to subclause 5.4.1.2.1 an EAP-response provided by the N5GC device. </action> <control> <action> The N5GC device can inform the W-AGF acting on behalf of the N5GC device that the N5GC device fails to authenticate the network. </action> </control> </control> Details of communication between the N5GC device and the W-AGF acting on behalf of the N5GC device are out of scope of this specification.
<control> <condition> <condition> When initiating an EAP based primary authentication </condition> and <condition> key agreement procedure </condition> using such EAP method, </condition> <action> the network shall select an ngKSI value. </action> <control> <action> The network shall send the selected ngKSI value to the W-AGF acting on behalf of the N5GC device along with each EAP message. </action> </control> <control> <action> The network shall send the ABBA value as described in subclause 9.11.3.10 to the W-AGF acting on behalf of the N5GC device along with the EAP-request message and EAP- success message. </action> </control> <control> <action> <condition> The W-AGF acting on behalf of the N5GC device </condition> shall not forward the ngKSI value or the ABBA value to the N5GC device. </action> </control> </control>
NOTE 2: The network provides the ngKSI value and the ABBA value since the ngKSI IE and the ABBA IE are mandatory IEs in AUTHENTICATION REQUEST message. The W-AGF acting on behalf of the N5GC device does not use the ngKSI value or the ABBA value provided by the network.
<control> <condition> If the N5GC device fails to authenticate the network, </condition> <action> the W-AGF <condition> acting on behalf of the N5GC device </condition> shall start timer T3520 <condition> when the AUTHENTICATION RESPONSE message containing the EAP-response message is sent. </condition> </action> </control>
<control> Furthermore, <action> the W-AGF <condition> acting on behalf of the N5GC device </condition> shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). </action> <control> <condition> <condition> Upon receiving an AUTHENTICATION REQUEST message </condition> <condition> with the EAP message IE containing an EAP-request message from the network, </condition> </condition> <action> the W-AGF acting on behalf of the N5GC device shall stop timer T3520, <condition> if running, </condition> </action> and <action> then provides the EAP-request message to the N5GC device as normally. </action> </control> </control>
<control> <condition> If the network fails to authenticate the N5GC device, </condition> <action> the network handling depends upon the type of identity used by the W-AGF acting on behalf of the N5GC device in the initial NAS message, </action> that is: </control>
<control> <condition> a) if the 5G-GUTI was used; </condition> </control> or
<control> <condition> b) if the SUCI was used. </condition> </control>
<control> <condition> If the 5G-GUTI was used, </condition> <action> the network should transport the EAP-failure message in the AUTHENTICATION RESULT message of the EAP result message transport procedure, </action> <action> initiate an identification procedure to retrieve SUCI from the W-AGF acting on behalf of the N5GC device </action> and <action> restart the EAP based primary authentication and key agreement procedure with the received SUCI. </action> </control>
<control> <condition> <condition> If the SUCI was used for identification in the initial NAS message </condition> or <condition> <condition> in a restarted EAP based primary authentication </condition> and <condition> key agreement procedure, </condition> </condition> or <condition> <condition> the network decides not to initiate the identification procedure to retrieve SUCI from the W-AGF acting on behalf of the N5GC device </condition> <condition> <condition> after an unsuccessful EAP based primary authentication </condition> and <condition> key agreement procedure, </condition> </condition> </condition> </condition> <action> the network should transport the EAP-failure message in an AUTHENTICATION REJECT message of the EAP result message transport procedure. </action> </control>
<control> <condition> If the EAP-failure message is received in an AUTHENTICATION REJECT message, </condition> <action> the W-AGF acting on behalf of the N5GC device shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, </action> <condition> if the timer is not running (see subclause 5.3.20). </condition> <action> Additionally, the W-AGF acting on behalf of the N5GC device shall: </action> </control>
<control> <condition> a) if the counter for "USIM considered invalid for 5GS services over non-3GPP access" events has a value less than a W-AGF implementation-specific maximum value, </condition> <action> proceed as specified in list item 1)-b) of subclause 5.3.20.2 </action> <condition> for the case that the 5GMM cause value received is #3; </condition> </control> or
<control> <condition> b) otherwise, </condition> <action> set the update status to 5U3 ROAMING NOT ALLOWED, </action> <action> delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. </action> <control> <action> The USIM shall be considered invalid for 5GS services via non-3GPP access <condition> <condition> until switching off </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </action> </control> </control>
<control> <condition> If the AUTHENTICATION REJECT message is received by the W-AGF acting on behalf of the N5GC device, </condition> <action> the W- AGF acting on behalf of the N5GC device shall abort any 5GMM signalling procedure, </action> <action> stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), </action> <end_state> enter state 5GMM-DEREGISTERED </end_state> and <action> delete any stored SUCI. </action> </control>
<control> <condition> Upon receiving an EAP-success message, </condition> <action> the W-AGF acting on behalf of the N5GC device shall consider the procedure complete. </action> </control>
<control> <condition> Upon receiving an EAP-failure message, </condition> <action> the W-AGF acting on behalf of the N5GC device shall consider the procedure complete. </action> </control>
5.4.1.2.4 EAP message reliable transport procedure
5.4.1.2.4.1 General
The purpose of the EAP message reliable transport procedure is to provide a reliable transport of an EAP-request message, the ngKSI and the ABBA from the network to the UE and of an EAP-response message from the UE to the network.
The EAP message reliable transport procedure is initiated by an AUTHENTICATION REQUEST message with the EAP message IE.
5.4.1.2.4.2 EAP message reliable transport procedure initiation by the network
<control> <condition> In order to initiate the EAP message reliable transport procedure, </condition> <action> the AMF shall create an AUTHENTICATION REQUEST message. </action> </control>
<control> <action> The AMF shall set the EAP message IE of the AUTHENTICATION REQUEST message to the EAP-request message to be sent to the UE. </action> </control> <control> <action> The AMF shall set the ngKSI IE of the AUTHENTICATION REQUEST message to the ngKSI value selected in subclause 5.4.1.2.2.2, subclause 5.4.1.2.3.1 or subclause 5.4.1.2.3A.1. </action> </control> <control> <condition> In this release of specification, </condition> <action> the AMF shall set the ABBA IE of the AUTHENTICATION REQUEST message with the length of ABBA IE to 2 and the ABBA contents to be 2 octets in length with value 0000H as described in subclause 9.11.3.10. </action> </control>
<control> <action> The AMF shall send the AUTHENTICATION REQUEST message to the UE, </action> and <action> the AMF shall start timer T3560 (see example in figure 5.4.1.2.4.2.1). </action> </control>
UE AMF AUTHENTICATION REQUEST
Start T3560 AUTHENTICATION RESPONSE
Stop T3560
<control> <condition> Upon receipt of an AUTHENTICATION REQUEST message with the EAP message IE, </condition> <action> the UE handles the EAP message received in the EAP message IE and the ABBA of the AUTHENTICATION REQUEST message. </action> </control>
5.4.1.2.4.3 EAP message reliable transport procedure accepted by the UE
<control> <action> The UE shall create an AUTHENTICATION RESPONSE message. </action> </control>
<control> <condition> If the received EAP message is an EAP-request message, </condition> <action> the UE shall set the EAP message IE of the AUTHENTICATION RESPONSE message to the EAP-response message responding to the received EAP-request </action> </control>
<control> <action> The UE shall send the AUTHENTICATION RESPONSE message to the AMF. </action> </control>
<control> <condition> Upon receipt of an AUTHENTICATION RESPONSE message, </condition> <action> the AMF shall stop timer T3560. </action> <control> <condition> If the EAP message IE is included in the AUTHENTICATION RESPONSE message, </condition> <action> the AMF handles the EAP message received in the EAP message IE of the AUTHENTICATION RESPONSE message. </action> </control> </control>
5.4.1.2.4.4 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) Expiry of timer T3560. </condition> </control>
<control> <action> The AMF shall, on the first expiry of the timer T3560, retransmit the AUTHENTICATION REQUEST message </action> and <action> shall reset and start timer T3560. </action> <action> This retransmission is repeated four times, i.e. on the fifth expiry of timer T3560, </action> <action> the AMF shall abort the EAP based primary authentication and key agreement procedure and any ongoing 5GMM specific procedure, </action> and <action> release the N1 NAS signalling connection. </action> </control>
<control> <condition> b) Lower layers indication of non-delivered NAS PDU due to handover. </condition> </control>
<control> <condition> <condition> If the AUTHENTICATION REQUEST message could not be delivered due to an intra AMF handover </condition> and <condition> the target TA is included in the TAI list, </condition> </condition> <condition> then upon successful completion of the intra AMF handover </condition> <action> the AMF shall retransmit the AUTHENTICATION REQUEST message. </action> <control> <condition> If a failure of handover procedure is reported by the lower layer and the N1 NAS signalling connection exists, </condition> <action> the AMF shall retransmit the AUTHENTICATION REQUEST message. </action> </control> </control>
5.4.1.2.4.5 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) Authentication failure (5GMM cause #71 "ngKSI already in use"). </condition> </control>
<control> <action> The UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #71 "ngKSI already in use", to the network </action> and <action> start the timer T3520 (see example in figure 5.4.1.3.7.1). </action> <action> Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). </action> </control> <control> <condition> Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #71 "ngKSI already in use", </condition> <action> the network performs necessary actions to select a new ngKSI and send the same EAP-request message to the UE. </action> </control>
NOTE 1: <control> <condition> Upon receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #71 "ngKSI already in use", </condition> <action> the network can also re-initiate the EAP based primary authentication and key agreement procedure (see subclause 5.4.1.2.2.2). </action> </control>
<control> <condition> Upon receiving a new AUTHENTICATION REQUEST message with the EAP message IE containing an EAP- request message from the network, </condition> <action> the UE shall stop timer T3520, </action> <condition> if running, </condition> <action> process the EAP-request message as normal. </action> </control>
<control> <condition> If the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid ngKSI and EAP-request message is received), </condition> <action> the UE shall send the AUTHENTICATION RESPONSE message to the network </action> and <action> shall start any retransmission timers (e.g. T3510, T3517 or T3521) </action> <condition> <condition> if they were running </condition> and <condition> stopped when the UE received the first failed AUTHENTICATION REQUEST message. </condition> </condition> </control>
<control> <condition> b) <condition> Transmission failure of AUTHENTICATION RESPONSE message </condition> or <condition> AUTHENTICATION FAILURE message indication from lower layers (if the EAP based primary authentication and key agreement procedure is triggered by a registration procedure). </condition> </condition> </control>
<control> <action> The UE shall stop the timer T3520, </action> <condition> if running, </condition> and <action> re-initiate the registration procedure. </action> </control>
<control> <condition> c) <condition> Transmission failure of AUTHENTICATION RESPONSE message </condition> or <condition> AUTHENTICATION FAILURE message indication with change in the current TAI (if the EAP based primary authentication and key agreement procedure is triggered by a service request procedure). </condition> </condition> </control>
<control> <action> The UE shall stop the timer T3520, if running. </action> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> <action> the EAP based primary authentication and key agreement procedure shall be aborted </action> and <action> a registration procedure for mobility and periodic registration update shall be initiated. </action> </control>
<control> <condition> If the current TAI is still part of the TAI list, </condition> <action> it is up to the UE implementation how to re-run the ongoing procedure that triggered the EAP based primary authentication and key agreement procedure. </action> </control>
<control> d) <action> Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication without change in the current TAI (if the authentication procedure is triggered by a service request procedure). </action> </control>
<control> <action> The UE shall stop the timer T3520, </action> <condition> if running. </condition> <action> It is up to the UE implementation how to re-run the ongoing procedure that triggered the EAP based primary authentication and key agreement procedure. </action> </control>
<control> <condition> e) Network failing the authentication check. </condition> </control>
<control> <condition> If the UE deems that the network has failed the authentication check, </condition> <action> then it shall request RRC to locally release the RRC connection </action> and <action> treat the active cell as barred (see 3GPP TS 38.304 or 3GPP TS 36.304 ). </action> <control> <action> The UE shall start any retransmission timers (e.g. T3510, T3517 or T3521), </action> <condition> <condition> if they were running and stopped </condition> <condition> when the UE received the first AUTHENTICATION REQUEST message containing an ngKSI that was already in use. </condition> </condition> </control> </control>
<control> <condition> f) Change in the current TAI. </condition> </control>
<control> <condition> <condition> If that the current TAI is not in the TAI list </condition> <condition> before the AUTHENTICATION RESPONSE message is sent, </condition> </condition> <action> the UE may discard sending the AUTHENTICATION RESPONSE message to the network and continue with the initiation of the registration procedure for mobility and periodic registration as described in subclause 5.5.1.3.2. </action> </control>
<control> <condition> <condition> For item e, </condition> <condition> <condition> if no emergency service is started </condition> or <condition> is ongoing: </condition> </condition> </condition> </control>
<control> <action> The UE shall stop timer T3520, </action> <condition> <condition> <condition> if the timer is running </condition> and <condition> the UE enters 5GMM-IDLE mode, e.g. upon detection of a lower layer failure, </condition> </condition> <condition> release of the N1 NAS signalling connection, </condition> or <condition> as the result of an inter-system change in 5GMM-CONNECTED mode from N1 mode to S1 mode. </condition> </condition> </control>
<control> <action> The UE shall deem that the network has failed the authentication check or assume that the authentication is not genuine </action> and <action> proceed as described in item e above </action> <condition> if any of the following occurs: <condition> <condition> a) the timer T3520 expires; </condition> <condition> b) the UE detects any combination of the EAP-based authentication failures: <condition> transmission of AUTHENTICATION FAILURE message with 5GMM cause #71 "ngKSI already in use", </condition> <condition> <condition> transmission of AUTHENTICATION RESPONSE message with an EAP-response message <condition> after detecting an error as described in subclause 5.4.1.2.2.4, </condition> </condition> <condition> <condition> with an EAP-response message <condition> after not accepting of the server certificate as described in subclause 5.4.1.2.3.1 </condition> </condition> or <condition> with an EAP-response message after failing to authenticate the network as described in subclause 5.4.1.2.3A.1, </condition> <condition> during three consecutive authentication challenges. </condition> </condition> </condition> <control> <action> The EAP-request/AKA'-challenge challenges shall be considered as consecutive only, </action> <condition> if the EAP-request/AKA'- challenge challenges causing the second and third EAP-based authentication failure are received by the UE, </condition> <condition> <condition> while the timer T3520 started </condition> <condition> after the previous EAP-based authentication failure is running. </condition> </condition> <control> <action> Not accepting of the server certificate shall be considered as consecutive only, </action> <condition> if the EAP-request messages causing the second and third not accepting of the server certificate are received by the UE, </condition> <condition> <condition> while the timer T3520 started </condition> <condition> after the previous EAP request message causing the previous not accepting of the server certificate is running. </condition> </condition> </control> </control> </condition> </condition> </condition> </control>
NOTE 2: <control> Reception of an EAP-failure message is not considered <condition> <condition> when determining the three consecutive authentication challenges </condition> or <condition> three consecutive not accepting of the server certificate. </condition> </condition> </control>
<control> <condition> <condition> For item e </condition> <condition> if there is an emergency service started or is ongoin: </condition> </condition> </control>
<control> <action> The UE shall stop timer T3520, </action> <condition> if the timer is running and the UE enters 5GMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the N1 NAS signalling connection, or as the result of an inter-system change in 5GMM-CONNECTED mode from N1 mode to S1 mode. </condition> </control>
<control> <condition> <condition> <condition> <condition> If a UE has an emergency PDU session established </condition> or <condition> is establishing an emergency PDU session, </condition> </condition> and <condition> <condition> sends an AUTHENTICATION FAILURE message to the AMF with the 5GMM cause appropriate for this cases (i.e. #71) </condition> or <condition> an AUTHENTICATION RESPONSE message containing an EAP-response message as described in subclause 5.4.1.2.2.4, </condition> </condition> </condition> <condition> <condition> containing an EAP-response message </condition> <condition> after not accepting of the server certificate as described in subclause 5.4.1.2.3.1 </condition> </condition> or <condition> containing an EAP-response message after failing to authenticate the network as described in subclause 5.4.1.2.3A.1, </condition> and <condition> receives the SECURITY MODE COMMAND message before the timeout of timer T3520, </condition> </condition> <action> the UE shall deem that the network has passed the authentication check successfully, stop timer T3520, respectively, </action> and <action> execute the security mode control procedure. </action> </control>
<control> <condition> <condition> If a UE has an emergency PDU session established </condition> or <condition> is establishing an emergency PDU session <condition> when timer T3520 expires, </condition> </condition> </condition> <action> the UE shall not deem that the network has failed the authentication check </action> and <action> not behave as described in item e. </action> <control> <action> Instead the UE shall continue using the current security context, </action> <condition> if any, </condition> <action> release all non- emergency PDU sessions, </action> <condition> if any, </condition> <condition> by initiating UE-requested PDU session release procedure. </condition> <control> <condition> If there is an ongoing PDU session establishment procedure, </condition> <action> the UE shall release all non-emergency PDU sessions </action> <condition> upon completion of the PDU session establishment procedure. </condition> </control> </control> </control>
<control> <action> The UE shall start any retransmission timers (e.g. T3510, T3517 or T3521) </action> <condition> if: <condition> <condition> a) they were running </condition> and <condition> <condition> stopped when the UE received the AUTHENTICATION REQUEST message0 </condition> and <condition> detected an authentication failure; </condition> </condition> </condition> and b) <condition> the procedures associated with these timers have not yet been completed. </condition> </condition> </control>
<control> <action> The UE shall consider itself to be registered for emergency services. </action> </control>
5.4.1.2.5 EAP result message transport procedure
5.4.1.2.5.1 General
<control> The purpose of the EAP result message transport procedure is to provide an EAP-success message or an EAP-failure message, and ngKSI from the network to the UE, <condition> when the EAP message cannot be piggybacked by another NAS message. </condition> </control>
<control> <action> The EAP result message transport procedure is initiated: </action> <condition> <condition> a) by an AUTHENTICATION RESULT message with the EAP message IE carrying the EAP-success message or the EAP-failure message; </condition> or b) <condition> by an AUTHENTICATION REJECT message with the EAP message IE carrying the EAP-failure message. </condition> </condition> </control>
5.4.1.2.5.2 EAP result message transport procedure initiation by the network
<control> <condition> In order to initiate the EAP result message transport procedure, </condition> <action> the AMF shall create an AUTHENTICATION RESULT message or an AUTHENTICATION REJECT message. </action> </control>
<control> <action> The AMF shall set the EAP message IE of the AUTHENTICATION RESULT message to an EAP-success message or an EAP-failure message to be sent to the UE. </action> <action> The AMF shall set the EAP message IE of the AUTHENTICATION REJECT message to an EAP-failure message to be sent to the UE. </action> <action> The AMF shall set the ngKSI IE of the AUTHENTICATION RESULT message or the AUTHENTICATION REJECT message to the ngKSI value selected in subclause 5.4.1.2.2.2, subclause 5.4.1.2.3.1 or subclause 5.4.1.2.3A.1 </action> </control>
<control> <action> The AMF shall send the AUTHENTICATION RESULT message or the AUTHENTICATION REJECT message to the UE (see example in figure 5.4.1.2.5.2.1). </action> </control>
UE AMF AUTHENTICATION RESULT OR AUTHENTICATION REJECT
<control> <condition> <condition> Upon receipt of an AUTHENTICATION RESULT message </condition> or <condition> an AUTHENTICATION REJECT message with the EAP message IE, </condition> </condition> <action> the UE handles the EAP message received in the EAP message IE and the ABBA if received of the AUTHENTICATION RESULT message or in the AUTHENTICATION REJECT message. </action> </control>
5.4.1.3 5G AKA based primary authentication and key agreement procedure
5.4.1.3.1 General
The purpose of the 5G AKA based primary authentication and key agreement procedure is to provide mutual authentication between the UE and the network and to agree on the keys K_AUSF , K_SEAF and K_AMF (see 3GPP TS 33.501 ). The cases when the 5G AKA based primary authentication and key agreement procedure is used are defined in 3GPP TS 33.501 .
<control> <condition> <condition> The network initiates the 5G AKA based primary authentication </condition> and <condition> key agreement procedure </condition> </condition> <action> by sending an AUTHENTICATION REQUEST message to the UE without the EAP message IE. </action> <action> The network shall include the ngKSI and the ABBA in AUTHENTICATION REQUEST message. </action> </control>
<control> <action> The 5G AKA based primary authentication and key agreement procedure is always initiated and controlled by the network. </action> <action> However, the UE can reject the 5G authentication challenge sent by the network. </action> </control>
<control> <action> The UE shall proceed with a 5G authentication challenge </action> <condition> only if a USIM is present. </condition> </control>
<control> <action> A partial native 5G NAS security context is established in the UE and the network </action> <condition> when a 5G authentication is successfully performed. </condition> </control> <control> <condition> <condition> During a successful 5G AKA based primary authentication </condition> and <condition> key agreement procedure, </condition> </condition> <action> the CK and IK are computed by the USIM. </action> </control> <control> <action> CK and IK are then used by the ME as key material to compute new keys K_AUSF , K_SEAF and K_AMF . </action> <action> K_AMF is stored in the 5G NAS security contexts (see 3GPP TS 33.501 ) of both the network and in the volatile memory of the ME while registered to the network, </action> and <action> is the root for the 5GS integrity protection and ciphering key hierarchy. </action> </control>
NOTE 1: <control> Generation of the new K_AUSF and the new K_SEAF does not result into deletion of the valid K_AUSF and the valid K_SEAF , <condition> if any. </condition> </control>
The 5G AKA based primary authentication and key agreement procedure is initiated by an AUTHENTICATION REQUEST message without the EAP message IE.
<control> <condition> Upon successful completion of the 5G AKA based primary authentication, </condition> <action> the AMF shall initiate a security mode control procedure (see subclause 5.4.2) to take the new partial native 5G NAS security context into use. </action> </control>
NOTE 2: <control> <action> The AMF shall immediately initiate a security mode control procedure (see subclause 5.4.2) </action> <condition> after 5G AKA primary authentication is successful to avoid K_AUSF key mismatch between the UE and the network. </condition> </control>
5.4.1.3.2 Authentication initiation by the network
<control> <action> The network may initiate a 5G AKA based primary authentication and key agreement procedure for a UE in 5GMM- CONNECTED mode <condition> at any time. </condition> </action> </control> For restrictions applicable after handover or inter-system change to N1 mode in 5GMM-CONNECTED mode, see subclause 5.5.1.3.3.
<control> <condition> The network initiates the 5G AKA based primary authentication and key agreement procedure </condition> <action> by sending an AUTHENTICATION REQUEST message to the UE </action> and <action> starting the timer T3560 (see example in figure 5.4.1.3.2.1). </action> </control>
<control> <action> The AUTHENTICATION REQUEST message shall contain the parameters necessary to calculate the authentication response (see 3GPP TS 33.501 ). </action> <action> This message shall include the ngKSI that will be used by the UE and AMF to identify the K and the partial native security context that is created if the authentication is successful. </action> <action> This message AMF shall also include the ABBA parameter. </action> </control> In this release of specification, the network shall set the length of ABBA IE to 2 and the ABBA contents to be 2 octets in length with value 0000H as described in subclause 9.11.3.10.
<control> <condition> If an ngKSI is contained in an initial NAS message <condition> during a 5GMM procedure, </condition> </condition> <action> the network shall include a different ngKSI value in the AUTHENTICATION REQUEST message </action> <condition> <condition> when it initiates a 5G AKA based primary authentication </condition> and <condition> key agreement procedure. </condition> </condition> </control>
5.4.1.3.3 Authentication response by the UE
<control> <action> The UE shall respond to an AUTHENTICATION REQUEST message. </action> <control> <condition> With the exception of the cases described in subclause 5.4.1.3.6 and 5.4.1.3.7 case l, </condition> <action> the UE shall process the 5G authentication challenge data </action> and <action> respond with an AUTHENTICATION RESPONSE message to the network. </action> </control> </control>
<control> <condition> Upon a successful 5G authentication challenge, </condition> <action> the UE shall determine the PLMN identity to be used for the calculation of the new K_AMF from the 5G authentication challenge data according to the following rules: </action> </control>
<control> <condition> a) <condition> When the UE moves from 5GMM-IDLE mode to 5GMM-CONNECTED mode, </condition> <condition> until the first handover, </condition> </condition> <action> the UE shall use the PLMN identity of the selected PLMN; </action> </control> and
<control> <condition> b) After handover or inter-system change to N1 mode in 5GMM-CONNECTED mode, </condition> </control>
<control> 1) <condition> if the target cell is not a shared network cell, </condition> <action> the UE shall use the PLMN identity received as part of the broadcast system information; </action> </control>
<control> 2) <condition> <condition> if the target cell is a shared network cell </condition> and <condition> the UE has a valid 5G-GUTI, </condition> <action> the UE shall use the PLMN identity that is part of the 5G-GUTI; </action> </condition> </control> and
<control> 3) <condition> <condition> if the target cell is a shared network cell </condition> and <condition> the UE has a valid 4G-GUTI, </condition> <condition> but not a valid 5G-GUTI, </condition> </condition> <action> the UE shall use the PLMN identity that is part of the 4G-GUTI. </action> </control>
<control> <condition> Upon a successful 5G authentication challenge, </condition> <action> the new K calculated from the 5G authentication challenge data AMF shall be stored in a new 5G NAS security context in the volatile memory of the ME. </action> </control>
<control> <action> The USIM will compute the authentication response (RES) using the 5G authentication challenge data received from the ME, </action> and <action> pass RES to the ME. </action> From the RES, <action> RES* is then generated according to Annex A of 3GPP TS 33.501 . </action> </control>
<control> In order to avoid a synchronisation failure, <condition> when the UE receives an AUTHENTICATION REQUEST message, </condition> <action> the UE shall store the received RAND together with the RES*, in the volatile memory of the ME. </action> </control> <control> <condition> <condition> When the UE receives a subsequent AUTHENTICATION REQUEST message, </condition> <condition> if the stored RAND value is equal to the new received value in the AUTHENTICATION REQUEST message, </condition> </condition> <action> then the ME shall not pass the RAND to the USIM, </action> <action> but shall send the AUTHENTICATION RESPONSE message with the stored RES*. </action> </control> <control> <condition> If there is no valid stored RAND in the ME or the stored RAND is different from the new received value in the AUTHENTICATION REQUEST message, </condition> <action> the ME shall pass the RAND to the USIM, </action> <action> shall override any previously stored RAND and RES* with the new ones and start, </action> or <action> reset and restart timer T3516. </action> </control>
<control> <action> The RAND and RES* values stored in the ME shall be deleted </action> and <action> timer T3516, if running, shall be stopped: </action> </control>
<control> <condition> a) upon receipt of a 1) SECURITY MODE COMMAND message, 2) SERVICE REJECT message, 3) REGISTRATION REJECT message, 4) REGISTRATION ACCEPT message, 5) AUTHENTICATION REJECT message, or 6) SERVICE ACCEPT message; </condition> </control>
<control> <condition> b) upon expiry of timer T3516; </condition> </control>
<control> <condition> c) if the UE enters the 5GMM state 5GMM-DEREGISTERED or 5GMM-NULL; </condition> or </control>
<control> <condition> d) if the UE enters 5GMM-IDLE mode. </condition> </control>
5.4.1.3.4 Authentication completion by the network
<control> <condition> Upon receipt of an AUTHENTICATION RESPONSE message, </condition> <action> the network stops the timer T3560 </action> and <action> checks the correctness of RES* (see 3GPP TS 33.501 ). </action> </control>
<control> <condition> <condition> If the 5G AKA based primary authentication </condition> and <condition> key agreement procedure has been completed successfully </condition> and <condition> the related ngKSI is stored in the 5G NAS security context of the network, </condition> </condition> <action> the network shall include a different ngKSI value in the AUTHENTICATION REQUEST message </action> <condition> <condition> when it initiates a new 5G AKA based primary authentication </condition> and <condition> key agreement procedure. </condition> </condition> </control>
<control> <condition> Upon receipt of an AUTHENTICATION FAILURE message, </condition> <action> the network stops the timer T3560. </action> <control> <condition> In the case where the 5GMM cause #21 "synch failure" is received, </condition> <action> the core network may renegotiate with the UDM/AUSF </action> and <action> provide the UE with new authentication parameters. </action> </control> </control>
5.4.1.3.5 Authentication not accepted by the network
<control> <condition> If the authentication response (RES) returned by the UE is not valid, </condition> <action> the network response depends upon the type of identity used by the UE in the initial NAS message, </action> <condition> that is: <condition> a) if the 5G-GUTI was used; </condition> or <condition> b) if the SUCI was used. </condition> </condition> </control>
<control> <condition> If the 5G-GUTI was used, </condition> <action> the network should initiate an identification procedure to retrieve SUCI from the UE </action> and <action> restart the 5G AKA based primary authentication and key agreement procedure with the received SUCI. </action> </control>
<control> <condition> <condition> <condition> If the SUCI was used for identification in the initial NAS message </condition> or <condition> in a restarted 5G AKA based primary authentication and key agreement procedure, </condition> </condition> or <condition> <condition> the network decides not to initiate the identification procedure to retrieve SUCI from the UE </condition> <condition> after an unsuccessful 5G AKA based primary authentication and key agreement procedure, </condition> </condition> </condition> <action> the network should send an AUTHENTICATION REJECT message to the UE. </action> </control>
<control> <condition> Upon receipt of an AUTHENTICATION REJECT message, </condition> </control>
<control> 1) <condition> if the AUTHENTICATION REJECT message has been successfully integrity checked by the NAS: </condition> </control>
<control> <action> the UE shall set the update status to 5U3 ROAMING NOT ALLOWED, </action> <action> delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. </action> </control>
<control> <condition> In case of PLMN, </condition> <action> the USIM shall be considered invalid </action> <condition> <condition> until switching off the UE </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> <condition> <condition> if the UE is neither registered for onboarding services in SNPN </condition> nor <condition> performing initial registration for onboarding services in SNPN </condition> </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN shall be considered invalid </action> <condition> until the UE is switched off </condition> or <condition> the entry is updated. </condition> Additionally, <action> the UE shall consider the USIM as invalid for the current SNPN until switching off or the UICC containing the USIM is removed. </action> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> <condition> <condition> if the UE is neither registered for onboarding services in SNPN </condition> nor <condition> performing initial registration for onboarding services in SNPN </condition> </condition> and <condition> the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid for 3GPP access until the UE is switched off or the entry is updated. Additionally, the UE shall consider the USIM as invalid for the entry </action> <condition> until switching off or the UICC containing the USIM is removed. </condition> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> <condition> if the UE is registered for onboarding services in SNPN </condition> or <condition> is performing initial registration for onboarding services in SNPN, </condition> </condition> </condition> <action> the UE shall store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 ; </action> and <condition> a) <condition> if the UE is neither registered for onboarding services in SNPN </condition> nor <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> the UE shall set: </control>
<control> i) <action> the counter for "SIM/USIM considered invalid for GPRS services" events, </action> <action> the counter for "USIM considered invalid for 5GS services over non-3GPP access" events, </action> and <action> the counter for "SIM/USIM considered invalid for non-GPRS services" events </action> <condition> <condition> if maintained by the UE, </condition> <condition> in case of PLMN; </condition> </condition> </control> or
<control> ii) <action> the counter for "the entry for the current SNPN considered invalid for 3GPP access" events </action> and <action> the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events </action> <condition> in case of SNPN; </condition> </control>
<control> <action> to UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the UE is registered for onboarding services in SNPN </condition> or <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> <action> the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value; </action> and <condition> a) if the UE is operating in single-registration mode, </condition> <action> the UE shall handle EMM parameters, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 for the case </action> <condition> when the authentication procedure is not accepted by the network. </condition> <action> The USIM shall be considered as invalid also for non-EPS services </action> <condition> <condition> until switching off </condition> or <condition> the UICC containing the USIM is removed; </condition> </condition> </control> and
<control> 2) <condition> <condition> if the AUTHENTICATION REJECT message is received without integrity protection </condition> and <condition> if timer T3516 or T3520 is running, </condition> </condition> <action> the UE shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, </action> <condition> if the timer is not running (see subclause 5.3.20). </condition> </control>
<control> Additionally, <condition> <condition> if the UE is neither registered for onboarding services in SNPN </condition> nor <condition> performing initial registration for onboarding services in SNPN, </condition> </condition> the UE shall: </control>
<control> <condition> a) <condition> if the AUTHENTICATION REJECT message is received over 3GPP access, </condition> and <condition> <condition> the counter for "SIM/USIM considered invalid for GPRS services" events in case of PLMN </condition> or <condition> the counter for "the entry for the current SNPN considered invalid for 3GPP access" events in case of SNPN has a value less than a UE implementation-specific maximum value, </condition> </condition> </condition> <action> proceed as specified in subclause 5.3.20, list item 1)-a) of subclause 5.3.20.2 (if the UE is not operating in SNPN access operation mode) or list item a)-1) of subclause 5.3.20.3 (if the UE is operating in SNPN access operation mode) </action> <condition> for the case that the 5GMM cause value received is #3; </condition> </control>
<control> <condition> b) <condition> if the AUTHENTICATION REJECT message is received over non-3GPP access, </condition> and <condition> <condition> the counter for "USIM considered invalid for 5GS services over non-3GPP access" events in case of PLMN </condition> or <condition> the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events in case of SNPN has a value less than a UE implementation-specific maximum value, </condition> </condition> </condition> <action> proceed as specified in subclause 5.3.20, list item 1)-b) of subclause 5.3.20.2 (if the UE is not operating in SNPN access operation mode) or list item a)-2) of subclause 5.3.20.3 (if the UE is operating in SNPN access operation mode) </action> <condition> for the case that the 5GMM cause value received is #3. </condition> </control>
<control> <condition> c) otherwise: </condition> </control>
<control> <condition> i) if the AUTHENTICATION REJECT message is received over 3GPP access: </condition> <control> a) <action> The UE shall set the update status for 3GPP access to 5U3 ROAMING NOT ALLOWED, </action> <action> delete for 3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. </action> </control> <control> <condition> b) In case of PLMN, </condition> <action> the UE shall consider the USIM as invalid for 5GS services via 3GPP access and non-EPS service </action> <condition> until switching off the UE or the UICC containing the USIM is removed. </condition> </control> </control>
<control> <condition> In case of SNPN, </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN shall be considered invalid for 3GPP access </action> <condition> <condition> until the UE is switched off </condition> or <condition> the entry is updated. </condition> </condition> Additionally, <action> the UE shall consider the USIM as invalid for the current SNPN via 3GPP access </action> <condition> <condition> until switching off </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control> a) The UE shall set: <control> b) <action> the counter for "SIM/USIM considered invalid for GPRS services" events </action> and <action> the counter for "SIM/USIM considered invalid for non-GPRS services" events </action> <condition> <condition> if maintained by the UE, </condition> <condition> in case of PLMN; </condition> </condition> </control> or <control> c) <action> the counter for "the entry for the current SNPN considered invalid for 3GPP access" events in case of SNPN; </action> </control>
<control> <action> to UE implementation-specific maximum value. </action> </control> <control> <condition> a) If the UE is operating in single-registration mode, </condition> <action> the UE shall handle 4G-GUTI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the authentication procedure is not accepted by the network. </condition> <action> The USIM shall be considered as invalid also for non-EPS services </action> <condition> <condition> until switching off </condition> or <condition> the UICC containing the USIM is removed; </condition> </condition> </control> and
<control> ii) <condition> if the AUTHENTICATION REJECT message is received over non-3GPP access: </condition> <control> a) <action> the UE shall set the update status for non-3GPP access to 5U3 ROAMING NOT ALLOWED, </action> <action> delete for non-3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI; </action> </control> <control> <condition> b) in case of PLMN, </condition> <action> the UE shall consider the USIM as invalid for 5GS services via non-3GPP access </action> <condition> <condition> until switching off the UE </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control> </control>
<control> <condition> In case of SNPN, </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid for non-3GPP access </action> <condition> <condition> until the UE is switched off </condition> or <condition> the entry is updated. </condition> </condition> Additionally, <action> the UE shall consider the USIM as invalid for the current SNPN and for non- 3GPP access </action> <condition> <condition> until switching off </condition> or <condition> the UICC containing the USIM is removed; </condition> </condition> </control> and <control> a) the UE shall set: <control> b) <action> the counter for "USIM considered invalid for 5GS services over non-3GPP access" events to UE implementation-specific maximum value </action> <condition> in case of PLMN; </condition> </control> or <control> c) <action> the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events to UE implementation-specific maximum value </action> <condition> in case of SNPN. </condition> </control> </control>
<control> <condition> <condition> If the UE is registered for onboarding services in SNPN </condition> or <condition> performing initial registration for onboarding services in SNPN, </condition> the UE shall: </condition> </control>
<control> 1) <condition> if the SNPN-specific attempt counter for the SNPN sending the AUTHENTICATION REJECT message has a value less than a UE implementation-specific maximum value, </condition> <action> increment the SNPN-specific attempt counter for the SNPN; </action> </control> or
<control> 2) <condition> otherwise, </condition> <action> the UE shall set the update status to 5U3.ROAMING NOT ALLOWED, </action> <action> delete the stored 5G- GUTI, TAI list, last visited registered TAI, and ngKSI, </action> <action> store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If the AUTHENTICATION REJECT message is received by the UE, </condition> <action> the UE shall abort any 5GMM signalling procedure, </action> <action> stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), </action> <end_state> enter state 5GMM- DEREGISTERED </end_state> and <action> delete any stored SUCI. </action> </control>
<control> <condition> <condition> Depending on local requirements or operator preference for emergency services, </condition> <condition> <condition> if the UE initiates a registration procedure with 5GS registration type IE set to "emergency registration" </condition> and <condition> the AMF is configured to allow emergency registration without user identity, </condition> </condition> </condition> <action> the AMF needs not follow the procedures specified for the authentication failure in the present subclause. </action> <action> The AMF may continue a current 5GMM specific procedure. </action> </control>
5.4.1.3.6 Authentication not accepted by the UE
<control> <condition> In the 5G authentication challenge, </condition> <action> the UE shall check the 5G authentication challenge data (RAND, AUTN and ngKSI) received in the AUTHENTICATION REQUEST message to verify authenticity of the 5G core network. </action> </control>
<control> <action> The ME shall check that ngKSI received in the AUTHENTICATION REQUEST message is not already in use. </action> <action> The ME shall forward the RAND and AUTN to the USIM to check. </action> </control>
<control> <action> The UE may reject the core network due to an incorrect AUTN or ngKSI parameter. </action> <condition> If the UE has to reject the 5G authentication challenge, </condition> <action> the UE shall return AUTHENTICATION FAILURE message to the network with a cause value indicating the reason for the failure (see 3GPP TS 33.501 ). </action> Incorrect 5G authentication challenge data contains four possible causes for authentication failure: </control>
<control> <condition> a) MAC code failure: </condition> </control>
<control> <condition> If the UE finds the MAC code (supplied by the core network in the AUTN parameter) to be invalid, </condition> <action> the UE shall send an AUTHENTICATION FAILURE message to the network, with the 5GMM cause #20 "MAC failure". </action> </control>
<control> <action> The UE shall then follow the procedure described in subclause 5.4.1.3.7, item c. </action> </control>
<control> <condition> b) Non-5G authentication unacceptable: </condition> </control>
<control> <condition> If the UE finds that the "separation bit" in the AMF field of AUTN supplied by the core network is set to 0, </condition> <action> the UE shall send an AUTHENTICATION FAILURE message to the network, with the 5GMM cause #26 "non-5G authentication unacceptable" (see subclause 6.1.3 in 3GPP TS 33.501 ). </action> <action> The UE shall then follow the procedure described in subclause 5.4.1.3.7, item d. </action> </control>
<control> <condition> c) ngKSI already in use: </condition> </control>
<control> <condition> If the UE detects that ngKSI received in the AUTHENTICATION REQUEST message is already in use in the UE shall send an AUTHENTICATION FAILURE message to the network, with the 5GMM cause #71 "ngKSI already in use". </condition> <action> The UE shall then follow the procedure described in subclause 5.4.1.3.7, item e. </action> </control>
<control> <condition> d) SQN failure: </condition> </control>
<control> <condition> If the UE finds the sequence number SQN (supplied by the core network in the AUTN parameter) to be out of range, </condition> <action> the UE shall send an AUTHENTICATION FAILURE message to the network, with the 5GMM cause #21 "synch failure" and a re-synchronization token AUTS provided by the USIM (see 3GPP TS 33.102 ). </action> <action> The UE shall then follow the procedure described in subclause 5.4.1.3.7, item f. </action> </control>
<control> <condition> If the UE returns an AUTHENTICATION FAILURE message to the network, </condition> <action> the UE shall delete any previously stored RAND and RES* </action> and <control> <action> shall stop timer T3516, </action> <condition> if running. </condition> </control> </control>
<control> <condition> <condition> If the UE has an emergency PDU session established </condition> or <condition> is establishing such a PDU session, </condition> </condition> additional UE requirements are specified in subclause 5.4.1.3.7, under "for items c, d, e and f". </control>
5.4.1.3.7 Abnormal cases
<control> <condition> a) Lower layer failure. </condition> </control>
<control> <condition> <condition> Upon detection of lower layer failure </condition> <condition> before the AUTHENTICATION RESPONSE message is received, </condition> </condition> <action> the network shall abort the procedure. </action> </control>
<control> <condition> b) Expiry of timer T3560. </condition> </control>
<control> <condition> The network shall, on the first expiry of the timer T3560, </condition> <action> retransmit the AUTHENTICATION REQUEST message </action> and <action> shall reset and start timer T3560. </action> <action> This retransmission is repeated four times, </action> <control> <condition> i.e. on the fifth expiry of timer T3560, </condition> <action> the network shall abort the 5G AKA based primary authentication and key agreement procedure and any ongoing 5GMM specific procedure </action> and <action> release the N1 NAS signalling connection. </action> </control> </control>
<control> <condition> c) Authentication failure (5GMM cause #20 "MAC failure"). </condition> </control>
<control> <action> The UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #20 "MAC failure" according to subclause 5.4.1.3.6, to the network </action> and <action> start timer T3520 (see example in figure 5.4.1.3.7.1). </action> <action> Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). </action> </control> <control> <condition> Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #20 "MAC failure", </condition> <action> the network may initiate the identification procedure described in subclause 5.4.3. </action> This is to allow the network to obtain the SUCI from the UE. <action> The network may then check that the 5G-GUTI originally used in the 5G authentication challenge corresponded to the correct SUPI. </action> </control> <control> <condition> Upon receipt of the IDENTITY REQUEST message from the network, </condition> <action> the UE shall proceed as specified in subclause 5.4.3.3. </action> </control>
NOTE 1: <control> <condition> <condition> Upon receipt of an AUTHENTICATION FAILURE message from the UE </condition> <condition> with 5GMM cause #20 "MAC failure", </condition> </condition> <action> the network may also terminate the 5G AKA based primary authentication and key agreement procedure (see subclause 5.4.1.3.5). </action> </control>
<control> <condition> If the mapping of 5G-GUTI to SUPI in the network was incorrect, </condition> <action> the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. </action> </control> <control> <condition> Upon receiving the new AUTHENTICATION REQUEST message from the network, </condition> <action> the UE shall stop the timer T3520, </action> <condition> if running, </condition> and <action> then process the 5G challenge information as normal. </action> </control> <control> <condition> If the mapping of 5G-GUTI to SUPI in the network was correct, </condition> <action> the network should terminate the 5G AKA based primary authentication and key agreement procedure </action> <action> by sending an AUTHENTICATION REJECT message (see subclause 5.4.1.3.5). </action> </control>
<control> <condition> If the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid SQN and MAC is received), </condition> <action> the UE shall send the AUTHENTICATION RESPONSE message to the network </action> and <control> <action> shall start any retransmission timers (e.g. T3510, T3517 or T3521) </action> <condition> if they were running </condition> </control> and <control> <action> stopped </action> <condition> when the UE received the first failed AUTHENTICATION REQUEST message. </condition> </control> </control>
<control> <condition> <condition> If the UE receives the second AUTHENTICATION REQUEST message, </condition> and <condition> the MAC value cannot be resolved, </condition> </condition> <action> the UE shall follow the procedure specified in this subclause, item c, starting again from the beginning, </action> </control> or <control> <condition> if the message contains a UMTS authentication challenge, </condition> <action> the UE shall follow the procedure specified in item d. </action> </control> <control> <condition> If the SQN is invalid, </condition> <action> the UE shall proceed as specified in item f. </action> </control>
UE AMF AUTHENTICATION REQUEST
Start T3520 Stop T3560 AUTHENTICATION REQUEST
Stop T3520 Start T3560 AUTHENTICATION RESPONSE
Stop T3560 agreement procedure
<control> <condition> d) Authentication failure (5GMM cause #26 "non-5G authentication unacceptable"). </condition> </control>
<control> <action> The UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #26 "non-5G authentication unacceptable", to the network </action> and <action> start the timer T3520 (see example in figure 5.4.1.3.7.1). </action> <action> Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). </action> </control> <control> <condition> Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #26 "non-5G authentication unacceptable", </condition> <action> the network may initiate the identification procedure described in subclause 5.4.3. </action> This is to allow the network to obtain the SUCI from the UE. <action> The network may then check that the 5G-GUTI originally used in the 5G authentication challenge corresponded to the correct SUPI. </action> </control> <control> <condition> Upon receipt of the IDENTITY REQUEST message from the network, </condition> <action> the UE shall proceed as specified in subclause 5.4.3.3. </action> </control>
NOTE 2: <control> <condition> <condition> Upon receipt of an AUTHENTICATION FAILURE message from the UE </condition> <condition> with 5GMM cause #26 "non- 5G authentication unacceptable", </condition> </condition> <action> the network may also terminate the 5G AKA based primary authentication and key agreement procedure (see subclause 5.4.1.3.5). </action> </control>
<control> <condition> If the mapping of 5G-GUTI to SUPI in the network was incorrect, </condition> <action> the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. </action> </control> <control> <condition> Upon receiving the new AUTHENTICATION REQUEST message from the network, </condition> <control> <action> the UE shall stop the timer T3520, </action> <condition> if running, </condition> </control> and <action> > then process the 5G challenge information as normal. </action> </control> <control> <condition> If the mapping of 5G-GUTI to SUPI in the network was correct, </condition> <action> the network should terminate the 5G AKA based primary authentication and key agreement authentication procedure by sending an AUTHENTICATION REJECT message (see subclause 5.4.1.3.5). </action> </control>
<control> <condition> If the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid 5G authentication challenge is received), </condition> <action> the UE shall send the AUTHENTICATION RESPONSE message to the network </action> and <action> shall start any retransmission timers (e.g. T3510, T3517 or T3521) </action> <condition> <condition> if they were running and stopped </condition> <condition> when the UE received the first failed AUTHENTICATION REQUEST message. </condition> </condition> </control>
<control> <condition> e) Authentication failure (5GMM cause #71 "ngKSI already in use"). </condition> </control>
<control> <action> The UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #71 "ngKSI already in use", to the network </action> and <action> start the timer T3520 (see example in figure 5.4.1.3.7.1). </action> <action> Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). </action> </control> <control> <condition> <condition> Upon the first receipt of an AUTHENTICATION FAILURE message from the UE </condition> <condition> with 5GMM cause #71 "ngKSI already in use", </condition> </condition> <action> the network performs necessary actions to select a new ngKSI </action> and <action> send the same 5G authentication challenge to the UE. </action> </control>
NOTE 3: <control> <condition> <condition> Upon receipt of an AUTHENTICATION FAILURE message from the UE </condition> <condition> with 5GMM cause #71 "ngKSI already in use", </condition> </condition> <action> the network may also re-initiate the 5G AKA based primary authentication and key agreement procedure (see subclause 5.4.1.3.2). </action> </control>
<control> <condition> Upon receiving the new AUTHENTICATION REQUEST message from the network, </condition> <action> the UE shall stop the timer T3520, </action> <condition> if running, </condition> and <action> then process the 5G challenge information as normal. </action> </control>
<control> <condition> <condition> If the network is validated successfully </condition> ( <condition> an AUTHENTICATION REQUEST message that contains a valid ngKSI, SQN and MAC is received), </condition> </condition> <action> the UE shall send the AUTHENTICATION RESPONSE message to the network </action> and <action> shall start any retransmission timers (e.g. T3510, T3517 or T3521) </action> <condition> if they were running </condition> and <control> <action> stopped </action> <condition> when the UE received the first failed AUTHENTICATION REQUEST message. </condition> </control> </control>
<control> <condition> f) Authentication failure (EMM cause #20 "MAC failure"). </condition> </control>
<control> <action> The UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #21 "synch failure", to the network </action> and <action> start the timer T3520 (see example in figure 5.4.1.3.7.1). </action> <action> Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). </action> </control> <control> <condition> <condition> Upon the first receipt of an AUTHENTICATION FAILURE message from the UE </condition> <condition> with the 5GMM cause #21 "synch failure", </condition> </condition> <action> the network shall use the returned AUTS parameter from the authentication failure parameter IE in the AUTHENTICATION FAILURE message, to re-synchronise. </action> </control> <control> <action> The re-synchronisation procedure requires the AMF to delete all unused authentication vectors for that SUPI </action> and <action> obtain new vectors from the UDM/AUSF. </action> </control> <control> <condition> When re-synchronisation is complete, </condition> <action> the network shall initiate the 5G AKA based primary authentication and key agreement procedure. </action> </control> <control> <condition> Upon receipt of the AUTHENTICATION REQUEST message, </condition> <action> the UE shall stop the timer T3520, </action> <condition> if running. </condition> </control>
NOTE 4: <control> <condition> <condition> Upon receipt of two consecutive AUTHENTICATION FAILURE messages from the UE </condition> <condition> with 5GMM cause #21 "synch failure", </condition> </condition> <action> the network may terminate the 5G AKA based primary authentication and key agreement procedure </action> <action> by sending an AUTHENTICATION REJECT message. </action> </control>
<control> <condition> <condition> <condition> If the network is validated successfully </condition> ( <condition> a new AUTHENTICATION REQUEST message is received which contains a valid SQN and MAC </condition> ) </condition> <condition> while T3520 is running, </condition> </condition> <action> the UE shall send the AUTHENTICATION RESPONSE message to the network </action> and <action> shall start any retransmission timers (e.g. T3510, T3517 or T3521), </action> <condition> if they were running </condition> and <action> stopped </action> <condition> when the UE received the first failed AUTHENTICATION REQUEST message. </condition> </control>
<control> <condition> Upon receipt of an AUTHENTICATION REJECT message, </condition> <action> the UE shall perform the actions as specified in subclause 5.4.1.3.5. </action> </control>
<control> <condition> g) Network failing the authentication check. </condition> </control>
<control> <condition> If the UE deems that the network has failed the authentication check, </condition> <action> then it shall request RRC to locally release the RRC connection </action> and <action> treat the active cell as barred (see 3GPP TS 38.304 or 3GPP TS 36.304 ). </action> <control> <action> The UE shall start any retransmission timers (e.g. T3510, T3517 or T3521), </action> <condition> if they were running </condition> and <action> stopped </action> <condition> when the UE received the first AUTHENTICATION REQUEST message containing an incorrect authentication challenge data causing authentication failure. </condition> </control> </control>
<control> <condition> h) <condition> Transmission failure of AUTHENTICATION RESPONSE message </condition> or <condition> AUTHENTICATION FAILURE message indication from lower layers </condition> <condition> (if the 5G AKA based primary authentication and key agreement procedure is triggered by a registration procedure). </condition> </condition> </control>
<control> <action> The UE shall stop the timer T3520, </action> <condition> if running, </condition> and <action> re-initiate the registration procedure. </action> </control>
<control> <condition> i) <condition> Transmission failure of AUTHENTICATION RESPONSE message </condition> or <condition> <condition> AUTHENTICATION FAILURE message indication </condition> <condition> with change in the current TAI </condition> <condition> (if the 5G AKA based primary authentication and key agreement procedure is triggered by a service request procedure). </condition> </condition> </condition> </control>
<control> <action> The UE shall stop the timer T3520, </action> <condition> if running. </condition> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> <action> the 5G AKA based primary authentication and key agreement procedure shall be aborted </action> and <action> a registration procedure for mobility and periodic registration update shall be initiated. </action> </control>
<control> <condition> If the current TAI is still part of the TAI list, </condition> <action> it is up to the UE implementation how to re-run the ongoing procedure that triggered the 5G AKA based primary authentication and key agreement procedure. </action> </control>
<control> <condition> j) <condition> Transmission failure of AUTHENTICATION RESPONSE message </condition> or <condition> AUTHENTICATION FAILURE message indication without change in the current TAI (if the authentication procedure is triggered by a service request procedure). </condition> </condition> </control>
<control> <action> The UE shall stop the timer T3520, </action> <condition> if running. </condition> <action> It is up to the UE implementation how to re-run the ongoing procedure that triggered the 5G AKA based primary authentication and key agreement procedure. </action> </control>
<control> <condition> k) Lower layers indication of non-delivered NAS PDU due to handover. </condition> </control>
<control> <condition> <condition> <condition> If the AUTHENTICATION REQUEST message could not be delivered due to an intra AMF handover </condition> and <condition> the target TA is included in the TAI list, </condition> </condition> <condition> then upon successful completion of the intra AMF handover </condition> </condition> <action> the AMF shall retransmit the AUTHENTICATION REQUEST message. </action> </control> <control> <condition> <condition> If a failure of handover procedure is reported by the lower layer </condition> and <condition> the N1 NAS signalling connection exists, </condition> </condition> <action> the AMF shall retransmit the AUTHENTICATION REQUEST message. </action> </control>
<control> <condition> l) Change in the current TAI. </condition> </control>
<control> <condition> <condition> If the current TAI is not in the TAI list </condition> <condition> before the AUTHENTICATION RESPONSE message is sent, </condition> </condition> <action> the UE may discard sending the AUTHENTICATION RESPONSE message to the network </action> and <action> continue with the initiation of the registration procedure for mobility and periodic registration as described in subclause 5.5.1.3.2. </action> </control>
<control> <condition> m) AUTHENTICATION REJECT message is received without integrity protection and neither timer T3516 nor T3520 is running. </condition> </control>
<control> <condition> <condition> If an AUTHENTICATION REJECT message is received without integrity protection </condition> and <condition> <condition> if neither timer T3516 </condition> nor <condition> T3520 is running, </condition> </condition> </condition> <action> then the UE shall discard the AUTHENTICATION REJECT message. </action> <action> Additionally, the UE may request RRC to locally release the RRC connection </action> and <action> treat the active cell as barred (see 3GPP TS 38.304 or 3GPP TS 36.304 ). </action> </control>
<control> <condition> <condition> For items c, d, e, and f </condition> <condition> <condition> if no emergency service is started </condition> or <condition> is ongoing: </condition> </condition> </condition> </control>
<control> <action> The UE shall stop timer T3520, </action> <condition> <condition> if the timer is running </condition> and <condition> the UE enters 5GMM-IDLE mode, </condition> </condition> e.g. upon detection of a lower layer failure, release of the N1 NAS signalling connection, or as the result of an inter-system change in 5GMM-CONNECTED mode from N1 mode to S1 mode. </control>
<control> <condition> <condition> For items c, d, e, and f </condition> <condition> <condition> if there is an emergency service started </condition> or <condition> is ongoing: </condition> </condition> </condition> </control>
<control> <action> The UE shall stop timer T3520, </action> <condition> <condition> if the timer is running </condition> and <condition> the UE enters 5GMM-IDLE mode, </condition> </condition> e.g. upon detection of a lower layer failure, release of the N1 NAS signalling connection, or as the result of an inter-system change in 5GMM-CONNECTED mode from N1 mode to S1 mode. </control>
<control> <condition> If there is an ongoing service request procedure for emergency services fallback </condition> <action> the UE shall abort the service request procedure, </action> <action> stop timer T3517 </action> and <action> locally release any resources allocated for the service request procedure </action> and <action> enters state 5GMM-REGISTERED. </action> </control> <control> <action> The UE shall attempt to select an E-UTRA cell connected to EPC or 5GCN according to the domain priority </action> and selection rules specified in 3GPP TS 23.167 . </control> <control> <condition> If the UE finds a suitable E-UTRA cell, </condition> <action> it then proceeds with the appropriate EMM or 5GMM procedures. </action> </control> <control> <condition> If the UE operating in single-registration mode has changed to S1 mode, </condition> <action> it shall disable the N1 mode capability for 3GPP access. </action> </control>
<control> <condition> <condition> Depending on local requirements or operator preference for emergency services, </condition> <condition> <condition> if the UE has an emergency PDU session established </condition> or <condition> is establishing an emergency PDU session, </condition> </condition> </condition> <action> the AMF need not follow the procedures specified for the authentication failure specified in the present subclause. </action> <action> The AMF may respond to the AUTHENTICATION FAILURE message </action> <action> by initiating the security mode control procedure selecting the "null integrity protection algorithm" 5G-IA0, "null ciphering algorithm" 5G-EA0 or may abort the 5G AKA based primary authentication and key agreement procedure </action> and <action> continue using the current security context, </action> <condition> if any. </condition> </control> <control> <action> The AMF shall indicate to the SMF to perform the release of all non-emergency PDU sessions, </action> <condition> if any. </condition> </control> <control> <condition> If there is an ongoing PDU session establishment procedure, </condition> <action> the AMF shall indicate to the SMF to perform the release of all non-emergency PDU sessions </action> <condition> upon completion of the PDU session establishment procedure. </condition> <action> The network shall behave as if the UE is registered for emergency services. </action> </control>
<control> <condition> <condition> If a UE has an emergency PDU session established </condition> or <condition> is establishing an emergency PDU session </condition> and <condition> sends an AUTHENTICATION FAILURE message to the AMF with the 5GMM cause appropriate for these cases (#20, #21, #26, or #71 respectively) </condition> and <condition> <condition> receives the SECURITY MODE COMMAND message </condition> <condition> before the timeout of timer T3520, </condition> </condition> </condition> <action> the UE shall deem that the network has passed the authentication check successfully, </action> <action> stop timer T3520, </action> respectively, and <action> execute the security mode control procedure. </action> </control>
<control> <condition> <condition> If a UE has an emergency PDU session established </condition> or <condition> <condition> is establishing an emergency PDU session </condition> <condition> when timer T3520 expires, </condition> </condition> </condition> <action> the UE shall not deem that the network has failed the authentication check </action> and <action> not behave as described in item g. </action> <action> Instead the UE shall continue using the current security context, </action> <condition> if any, </condition> <action> release all non- emergency PDU sessions, </action> <condition> if any, </condition> <action> by initiating UE-requested PDU session release procedure. </action> </control> <control> <condition> If there is an ongoing PDU session establishment procedure, </condition> <action> the UE shall release all non-emergency PDU sessions </action> <condition> upon completion of the PDU session establishment procedure. </condition> </control>
<control> <action> The UE shall start any retransmission timers (e.g. T3510, T3517 or T3521) </action> <condition> if: <condition> a) <condition> they were running </condition> and <condition> <condition> stopped when the UE received the AUTHENTICATION REQUEST message </condition> and <condition> detected an authentication failure; </condition> </condition> </condition> and <condition> b) the procedures associated with these timers have not yet been completed. </condition> </condition> </control>
<control> <action> The UE shall behave as if the UE is registered for emergency services. </action> </control>
5.4.2 Security mode control procedure
5.4.2.1 General
The purpose of the NAS security mode control procedure is to take a 5G NAS security context into use, and initialise and start NAS signalling security between the UE and the AMF with the corresponding 5G NAS keys and 5G NAS security algorithms.
<control> <action> Furthermore, the network may also initiate the security mode control procedure </action> in the following cases: <condition> <condition> a) - in order to change the 5G NAS security algorithms for a current 5G NAS security context already in use; </condition> b) <condition> in order to change the value of uplink NAS COUNT used in the latest SECURITY MODE COMPLETE message as described in 3GPP TS 33.501 , subclause 6.9.4.4; </condition> and c) <condition> in order to provide the Selected EPS NAS security algorithms to the UE. </condition> </condition> </control>
For restrictions concerning the concurrent running of a security mode control procedure with other security related procedures in the AS or inside the core network see 3GPP TS 33.501 , subclause 6.9.5.
<control> <condition> <condition> If the security mode control procedure is initiated after successful 5G AKA based primary authentication and key agreement procedure </condition> and <condition> the security mode control procedure intends to bring into use the partial native 5G NAS security context created by the 5G AKA based primary authentication and key agreement procedure </condition> and <condition> the UE accept received security mode command (see subclause 5.4.2.3) </condition> </condition> , the ME shall: <control> a) <action> delete the valid KAUSF and the valid KSEAF </action> , <condition> if any; </condition> </control> and <control> b) <action> consider the new KAUSF to be the valid KAUSF </action> , and <action> the new KSEAF to be the valid KSEAF </action> , <action> reset the SOR counter </action> and <action> the UE parameter update counter to zero </action> , and <action> store the valid KAUSF the valid KSEAF </action> , <action> the SOR counter and the, UE parameter update counter as specified in annex C </action> and <action> use the valid KAUSF in the verification of SOR transparent container </action> and <action> UE parameters update transparent container </action> , <condition> if any are received. </condition> </control> </control>
NOTE: <control> <action> The AMF does not perform a security mode control procedure </action> when <condition> the 5G AKA based primary authentication procedure successfully authenticates a 5G ProSe layer-3 remote UE accessing the network via a 5G ProSe layer-3 UE-to-network relay UE served by the AMF. </condition> </control>
5.4.2.2 NAS security mode control initiation by the network
<control> <action> The AMF initiates the NAS security mode control procedure by sending a SECURITY MODE COMMAND message to the UE and starting timer T3560 (see example in figure 5.4.2.2). </action> </control>
<control> <action> The AMF shall reset the downlink NAS COUNT counter </action> and <action> use it to integrity protect the initial SECURITY MODE COMMAND message </action> <condition> <condition> if the security mode control procedure is initiated: a) to take into use the security context created after a successful execution of the 5G AKA based primary authentication and key agreement procedure or the EAP based primary authentication and key agreement procedure; </condition> or b) <condition> upon receipt of REGISTRATION REQUEST message, if the AMF needs to create a mapped 5G NAS security context (i.e. the type of security context flag is set to "mapped security context" in the ngKSI IE included in the SECURITY MODE COMMAND message). </condition> </condition> </control>
<control> <action> The AMF shall send the SECURITY MODE COMMAND message unciphered, but shall integrity protect the message with the 5G NAS integrity key based on K or mapped K' indicated by the ngKSI included in the message. </action> <action> The AMF AMF AMF shall set the security header type of the message to "integrity protected with new 5G NAS security context". </action> </control>
<control> <action> The AMF shall create a locally generated K </action> and <action> send the SECURITY MODE COMMAND message including an AMF ngKSI value in the ngKSI IE set to "000" and 5G-IA0 and 5G-EA0 as the selected NAS security algorithms </action> only when <condition> <condition> the security mode control procedure is initiated: a) during an initial registration procedure for emergency services if no valid 5G NAS security context is available; </condition> b) <condition> during a registration procedure for mobility and periodic registration update for a UE that has an emergency PDU session if no valid 5G NAS security context is available; </condition> c) <condition> during a service request procedure for a UE that has an emergency PDU session if no valid 5G NAS security context is available; </condition> or d) <condition> after a failed primary authentication and key agreement procedure for a UE that has an emergency PDU session or is establishing an emergency PDU session, if continued usage of a valid 5G NAS security context is not possible </condition> </condition> </control>
<control> <condition> <condition> When the AMF sends the SECURITY MODE COMMAND message including an ngKSI value in the ngKSI IE set to "000" and 5G-IA0 and 5G-EA0 as the selected NAS security algorithms, </condition> if: <condition> a) the AMF supports N26 interface; </condition> <condition> b) the UE set the S1 mode bit to "S1 mode supported" in the 5GMM capability IE of the REGISTRATION REQUEST message; </condition> and <condition> c) the security mode control procedure is initiated during an initial registration procedure for emergency services, during a registration procedure for mobility and periodic registration update for a UE that has an emergency PDU session, or during a service request procedure for a UE that has an emergency PDU session, </condition> </condition> <action> the SECURITY MODE COMMAND message shall also include the Selected EPS NAS security algorithms IE. </action> <action> The selected EPS NAS security algorithms shall be set to EIA0 and EEA0. </action> </control>
<control> <action> The UE shall process a SECURITY MODE COMMAND message including an ngKSI value in the ngKSI IE set to "000" and 5G-IA0 and 5G-EA0 as the selected NAS security algorithms and, if accepted, create a locally generated KAMF </action> <condition> when the security mode control procedure is initiated: <condition> a) during an initial registration procedure for emergency services; </condition> <condition> b) during a registration procedure for mobility and periodic registration update for a UE that has an emergency PDU session; </condition> <condition> c) during a service request procedure for a UE that has an emergency PDU session; </condition> or <condition> d) after a primary authentication and key agreement procedure for a UE that has an emergency PDU session or is establishing an emergency PDU session. </condition> </condition> </control>
NOTE 1: The process for creation of the locally generated KAMF by the AMF and the UE is implementation dependent. The KAMF is specified in 3GPP TS 33.501 .
<control> <condition> <condition> Upon receipt of a REGISTRATION REQUEST message, </condition> <condition> if the AMF does not have the valid current 5G NAS security context indicated by the UE, </condition> </condition> the AMF shall either: <action> a) indicate the use of the new mapped 5G NAS security context to the UE by setting the type of security context flag in the ngKSI IE to "mapped security context" and the KSI value related to the security context of the source system; </action> or <action> b) set the ngKSI value to "000" in the ngKSI IE <condition> if the AMF sets 5G-IA0 and 5G-EA0 as the selected NAS security algorithms for a UE that has an emergency PDU session. </condition> </action> </control>
<control> <condition> <condition> Upon receipt of a REGISTRATION REQUEST message, </condition> <condition> if the AMF has the valid current 5G NAS security context indicated by the UE, </condition> <condition> the AMF supports N26 interface and the UE set the S1 mode bit to "S1 mode supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </condition> and <condition> the UE is not registered for disaster roaming, </condition> </condition> <action> the AMF shall check whether the selected EPS NAS security algorithms was successfully provided to the UE. </action> <control> <condition> If not, </condition> <action> the AMF shall initiate the NAS security mode control procedure by sending a SECURITY MODE COMMAND message with the Selected EPS NAS security algorithms IE to the UE. </action> </control> </control>
<control> <condition> <condition> While having a current mapped 5G NAS security context with the UE, </condition> <condition> if the AMF needs to take the native 5G NAS security context into use, </condition> </condition> <action> the AMF shall include the ngKSI that indicates the native 5G NAS security context in the SECURITY MODE COMMAND message. </action> </control>
<control> <action> The AMF shall include the replayed security capabilities of the UE (including the security capabilities with regard to NAS, RRC and UP (user plane) ciphering as well as NAS and RRC integrity, and other possible target network security capabilities, i.e. E-UTRAN if the UE included them in the message to network), the selected 5GS ciphering and integrity algorithms and the ngKSI. </action> </control>
<control> <condition> <condition> If a UE is already registered over one access to a PLMN </condition> and <condition> the AMF decides to skip primary authentication and key agreement procedure when the UE attempts to register over the other access to the same PLMN, </condition> </condition> <action> the AMF shall take into use the UE's current 5G NAS security context over the other access that the UE is registering. </action> <action> In this case, SECURITY MODE COMMAND message is not sent to the UE. </action> </control>
<control> <condition> <condition> If the UE is registered to the same AMF and the same PLMN over both 3GPP access and non-3GPP access, </condition> and <condition> the UE is in 5GMM-CONNECTED mode over both the 3GPP and non-3GPP accesses, </condition> </condition> then at any time the primary authentication and key agreement procedure has successfully completed over: </control>
<control> <condition> a) the 3GPP access, </condition> <action> the AMF includes the ngKSI in the SECURITY MODE COMMAND message over the 3GPP access. </action> <control> <condition> When the AMF sends the SECURITY MODE COMMAND message to UE over the non-3GPP access to take into use the new 5G NAS security context, </condition> <action> the AMF shall include the same ngKSI in the SECURITY MODE COMMAND message to identify the new 5G NAS security context; </action> </control> </control> or
<control> <condition> b) the non-3GPP access, </condition> <action> the AMF includes the ngKSI in the SECURITY MODE COMMAND message over the non-3GPP access. </action> <control> <condition> When the AMF sends the SECURITY MODE COMMAND message to UE over the 3GPP access to take into use the new 5G NAS security context, </condition> <action> the AMF shall include the same ngKSI in the SECURITY MODE COMMAND message to identify the new 5G NAS security context. </action> </control> </control>
<control> <action> The AMF may initiate a SECURITY MODE COMMAND in order to change the 5G security algorithms for a current 5G NAS security context already in use. </action> <action> The AMF re-derives the 5G NAS keys from KAMF with the new 5G algorithm identities as input and provides the new 5GS algorithm identities within the SECURITY MODE COMMAND message. </action> <action> The AMF shall set the security header type of the message to "integrity protected with new 5G NAS security context". </action> </control>
<control> If, <condition> <condition> during an ongoing registration procedure, the AMF is initiating a SECURITY MODE COMMAND (i.e. after receiving the REGISTRATION REQUEST message, but before sending a response to that message) </condition> and: <condition> a) the REGISTRATION REQUEST message does not successfully pass the integrity check at the AMF; </condition> or </condition> </control>
<control> <condition> b) the AMF can not decipher the value part of the NAS message container IE in the REGISTRATION REQUEST message; </condition> <action> the AMF shall include the Additional 5G security information IE with the RINMR bit set to "Retransmission of the initial NAS message requested" in the SECURITY MODE COMMAND message requesting the UE to send the entire REGISTRATION REQUEST message in the SECURITY MODE COMPLETE message as described in 3GPP TS 33.501 . </action> </control>
NOTE 2: The AMF uses the UE security capability which was provided by the UE.
<control> If, <condition> <condition> during an ongoing service request procedure for a UE with an emergency PDU session, </condition> <condition> the AMF is initiating a SECURITY MODE COMMAND (i.e. after receiving the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message, but before sending a response to that message) </condition> and <condition> the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message does not successfully pass the integrity check at the AMF, </condition> </condition> <action> the AMF shall include the Additional 5G security information IE with the RINMR bit set to "Retransmission of the initial NAS message requested" in the SECURITY MODE COMMAND message requesting the UE to send the entire: a) SERVICE REQUEST message; or b) CONTROL PLANE SERVICE REQUEST message excluding non-cleartext IEs, except the Uplink data status IE if needed (see subclause 5.4.2.3); in the SECURITY MODE COMPLETE message as described in 3GPP TS 33.501 . </action> </control>
<control> <action> Additionally, the AMF may request the UE to include its IMEISV in the SECURITY MODE COMPLETE message. </action> </control>
<control> <condition> <condition> If the AMF supports N26 interface </condition> and <condition> the UE set the S1 mode bit to "S1 mode supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </condition> and <condition> the AMF needs to provide the selected EPS NAS security algorithms to the UE </condition> </condition> , <action> the AMF shall select ciphering and integrity algorithms to be used in the EPS and indicate them to the UE via the Selected EPS NAS security algorithms IE in the SECURITY MODE COMMAND message. </action> </control>
NOTE 3: The AS and NAS security capabilities are the same, i.e. if the UE supports one algorithm for NAS, the same algorithm is also supported for AS.
<control> <condition> If the AMF performs horizontal key derivation </condition> e.g. during the mobility and periodic registration update or when the UE is already registered in the PLMN with another access type as described in 3GPP TS 33.501 , <action> the AMF shall include horizontal derivation parameter in the SECURITY MODE COMMAND message. </action> </control>
<control> <condition> If the security mode control procedure is initiated after successful EAP based primary authentication and key agreement procedure and the security mode control procedure intends to bring into use the partial native 5G NAS security context created by the EAP based primary authentication and key agreement procedure, </condition> <action> the AMF shall set the EAP message IE of the SECURITY MODE COMMAND message to an EAP-success message to be sent to the UE. </action> </control>
UE AMF SECURITY MODE COMMAND
Start T3560 SECURITY MODE COMPLETE
Stop T3560 OR SECURITY MODE REJECT
Stop T3560
5.4.2.3 NAS security mode command accepted by the UE
<control> <condition> Upon receipt of the SECURITY MODE COMMAND message, </condition> <action> the UE shall check whether the security mode command can be accepted or not. </action> </control> This is done by performing the integrity check of the message, and by checking that the received Replayed UE security capabilities IE has not been altered compared to the latest values that the UE sent to the network.
When the SECURITY MODE COMMAND message includes an EAP-success message the UE handles the EAP- success message and the ABBA as described in subclause 5.4.1.2.2.8, 5.4.1.2.3.1, 5.4.1.2.3A.1 and 5.4.1.2.3B.1.
<control> If: <condition> <condition> a) the UE is registered for emergency services, performing initial registration for emergency services, establishing an emergency PDU session or has an emergency PDU session established; </condition> <condition> b) the W-AGF acts on behalf of the FN-RG; </condition> or <condition> c) the W-AGF acts on behalf of the N5GC device, and the SECURITY MODE COMMAND message is received with ngKSI value "000" and 5G-IA0 and 5G-EA0 as selected 5G NAS security algorithms, the UE shall locally derive and take in use 5G NAS security context. </condition> </condition> <action> The UE shall delete existing current 5G NAS security context. </action> </control>
<control> <action> The UE shall accept a SECURITY MODE COMMAND message indicating the "null integrity protection algorithm" 5G-IA0 as the selected 5G NAS integrity algorithm </action> <condition> only if the message is received when </condition> </control>
<control> <condition> a) the UE is registered for emergency services, performing initial registration for emergency services, establishing an emergency PDU session or has an emergency PDU session established; </condition> or </control>
<control> <condition> b) the W-AGF acts on behalf of the FN-RG; </condition> or </control>
<control> <condition> c) the W-AGF acts on behalf of the N5GC device. </condition> </control>
<control> <condition> <condition> If the type of security context flag included in the SECURITY MODE COMMAND message is set to "native security context" </condition> and <condition> if the ngKSI matches a valid non-current native 5G NAS security context held in the UE while the UE has a mapped 5G NAS security context as the current 5G NAS security context, </condition> </condition> <action> the UE shall take the non-current native 5G NAS security context into use which then becomes the current native 5G NAS security context </action> and <action> delete the mapped 5G NAS security context. </action> </control>
<control> <action> The UE shall ignore the Replayed S1 UE security capabilities IE </action> <condition> if this IE is included in the SECURITY MODE COMMAND message. </condition> </control>
<control> <condition> If the SECURITY MODE COMMAND message can be accepted, </condition> <action> the UE shall take the 5G NAS security context indicated in the message into use. </action> <control> <action> The UE shall in addition reset the uplink NAS COUNT counter </action> if: </control> </control>
<control> <condition> <condition> a) the SECURITY MODE COMMAND message is received in order to take a 5G NAS security context into use created after a successful execution of the 5G AKA based primary authentication and key agreement procedure or the EAP based primary authentication and key agreement procedure; </condition> or </condition> </control>
<control> <condition> b) the SECURITY MODE COMMAND message received includes the type of security context flag set to "mapped security context" in the NAS key set identifier IE the ngKSI does not match the current 5G NAS security context, if it is a mapped 5G NAS security context. </condition> </control>
<control> <condition> <condition> If the SECURITY MODE COMMAND message can be accepted </condition> and <condition> a new 5G NAS security context is taken into use </condition> and <condition> SECURITY MODE COMMAND message does not indicate the "null integrity protection algorithm" 5G-IA0 as the selected NAS integrity algorithm, </condition> </condition> the UE shall: <control> a) <condition> if the SECURITY MODE COMMAND message has been successfully integrity checked using an estimated downlink NAS COUNT equal to 0, </condition> then <action> the UE shall set the downlink NAS COUNT of this new 5G NAS security context to 0; </action> </control> <control> <condition> b) otherwise </condition> <action> the UE shall set the downlink NAS COUNT of this new 5G NAS security context to the downlink NAS COUNT that has been used for the successful integrity checking of the SECURITY MODE COMMAND message. </action> </control> </control>
<control> <condition> If the SECURITY MODE COMMAND message includes the horizontal derivation parameter indicating "KAMF derivation is required", </condition> <action> the UE shall derive a new K'AMF, </action> as specified in 3GPP TS 33.501 for KAMF to K'AMF derivation in mobility, and <action> set both uplink and downlink NAS COUNTs to zero. </action> </control> <control> <condition> <condition> When the new 5G NAS security context is taken into use for current access </condition> and <condition> the UE is registered with the same PLMN over the 3GPP access and the non-3GPP access: </condition> </condition> </control>
<control> <condition> a) the UE is in 5GMM-IDLE mode over the non-current access, </condition> <action> the AMF and the UE shall activate the new 5G NAS security context over the non-current access as described in 3GPP TS 33.501 . </action> <action> The AMF and the UE shall set the downlink NAS COUNT and uplink NAS COUNT to zero for the non-current access; </action> </control> or
<control> <condition> b) the UE is in 5GMM-CONNECTED mode over the non-current access, </condition> <action> the AMF shall send the SECURITY MODE COMMAND message over the non-current access to activate the new 5G NAS security context that was activated over the current access as described in 3GPP TS 33.501 . </action> <action> The AMF shall include the same ngKSI in the SECURITY MODE COMMAND message to identify the new 5G NAS security context. </action> </control>
<control> <condition> <condition> If the SECURITY MODE COMMAND message includes the horizontal derivation parameter indicating "KAMF derivation is not required" </condition> or <condition> the Additional 5G security information IE is not included in the message, </condition> </condition> the UE is registered with the same PLMN over the 3GPP access and non-3GPP access, then after <action> the completion of a security mode control procedure over the current access: </action> </control>
<control> <condition> a) the UE is in 5GMM-IDLE mode over the non-current access, </condition> <action> the AMF and the UE shall activate the new 5G NAS security context for the non-current access. </action> <control> <condition> If a primary authentication and key agreement procedure was completed before the security mode control procedure, </condition> <action> the AMF and the UE shall set the downlink NAS COUNT and uplink NAS COUNT to zero for the non-current access, </action> </control> <control> <condition> otherwise </condition> <action> the downlink NAS COUNT and uplink NAS COUNT for the non-3GPP access are not changed; </action> </control> </control> or
<control> <condition> b) the UE is in 5GMM-CONNECTED mode over the non-current access, </condition> <action> the AMF shall send the SECURITY MODE COMMAND message over the non-current access to activate the new 5G NAS security context that was activated over the current access as described in 3GPP TS 33.501 . </action> <action> The AMF shall include the same ngKSI in the SECURITY MODE COMMAND message to identify the new 5G NAS security context. </action> </control>
<control> <condition> If the SECURITY MODE COMMAND message can be accepted, </condition> <action> the UE shall send a SECURITY MODE COMPLETE message integrity protected with the selected 5GS integrity algorithm and the 5G NAS integrity key based on the KAMF or mapped K'AMF if the type of security context flag is set to "mapped security context" indicated by the ngKSI. </action> </control> <control> <condition> When the SECURITY MODE COMMAND message includes the type of security context flag set to "mapped security context" in the NAS key set identifier IE, </condition> <control> then <action> the UE shall check whether the SECURITY MODE COMMAND message indicates the ngKSI of the current 5GS security context, </action> <condition> if it is a mapped 5G NAS security context, </condition> in order not to re-generate the K'AMF . </control> </control>
<control> Furthermore, <condition> if the SECURITY MODE COMMAND message can be accepted, </condition> <action> the UE shall cipher the SECURITY MODE COMPLETE message with the selected 5GS ciphering algorithm and the 5GS NAS ciphering key based on the KAMF or mapped K'AMF indicated by the ngKSI. </action> <action> The UE shall set the security header type of the message to "integrity protected and ciphered with new 5G NAS security context". </action> </control>
<control> <condition> From this time onward </condition> <action> the UE shall cipher and integrity protect all NAS signalling messages with the selected 5GS integrity and ciphering algorithms. </action> </control>
<control> <condition> If the AMF indicated in the SECURITY MODE COMMAND message that the IMEISV is requested </condition> and: </control>
a) if the UE:
<control> <condition> 1) supports at least one 3GPP access technology, </condition> <action> the UE shall include its IMEISV in the IMEISV IE of the SECURITY MODE COMPLETE message; </action> </control> or
<control> <condition> 2) does not support any 3GPP access technology (i.e. satellite NG-RAN, NG-RAN, satellite E-UTRAN, E- UTRAN, UTRAN or GERAN) and supports NAS over untrusted or trusted non-3GPP access, </condition> <action> the UE shall include its EUI-64 in the non-IMEISV PEI IE of the SECURITY MODE COMPLETE message; </action> </control> or
<control> b) <condition> if the 5G-RG contains neither an IMEISV nor an IMEI or when the W-AGF acts on behalf of the FN-RG (or on behalf of the N5GC device), </condition> <action> the 5G-RG or the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) shall include the MAC address and the MAC address usage restriction indication determined as specified in subclause 5.3.2 in the non-IMEISV PEI IE in the SECURITY MODE COMPLETE message. </action> </control>
<control> <condition> <condition> If during an ongoing registration procedure or service request procedure, </condition> <condition> the UE receives a SECURITY MODE COMMAND message </condition> which includes the Additional 5G security information IE with the RINMR bit set to "Retransmission of the initial NAS message requested", </condition> <action> the UE shall include the entire unciphered REGISTRATION REQUEST message or SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message, which the UE had previously included in the NAS message container IE of the initial NAS message (i.e. REGISTRATION REQUEST message or SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message, respectively), in the NAS message container IE of the SECURITY MODE COMPLETE message. </action> </control> The retransmitted CONTROL PLANE SERVICE REQUEST message:
<control> <action> a) shall not include any non-cleartext IE, except the Uplink data status IE; </action> and </control>
<control> <action> b) may include the Uplink data status IE. </action> </control>
<control> If, <condition> prior to receiving the SECURITY MODE COMMAND message, the UE without a valid 5G NAS security context had sent a REGISTRATION REQUEST message </condition> <action> the UE shall include the entire REGISTRATION REQUEST message in the NAS message container IE of the SECURITY MODE COMPLETE message as described in subclause 4.4.6. </action> </control>
<control> <condition> If the UE operating in the single-registration mode receives the Selected EPS NAS security algorithms IE, </condition> <action> the UE shall use the IE according to 3GPP TS 33.501 . </action> </control>
<control> <condition> For a UE operating in single-registration mode in a network supporting N26 interface after an inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode, </condition> <control> <action> the UE shall set the value of the Selected EPS NAS security algorithms IE in the 5G NAS security context to the NAS security algorithms that were received from the source MME </action> <condition> when the UE was in S1 mode. </condition> </control> </control>
5.4.2.4 NAS security mode control completion by the network
<control> The AMF shall, <condition> upon receipt of the SECURITY MODE COMPLETE message, </condition> <action> stop timer T3560. </action> <action> From this time onward the AMF shall integrity protect and encipher all signalling messages with the selected 5GS integrity and ciphering algorithms. </action> </control>
<control> <condition> If the SECURITY MODE COMPLETE message contains a NAS message container IE with a REGISTRATION REQUEST message, </condition> <action> the AMF shall complete the ongoing registration procedure by considering the REGISTRATION REQUEST message contained in the NAS message container IE as the message that triggered the procedure. </action> </control>
<control> <condition> <condition> If the SECURITY MODE COMPLETE message contains a NAS message container IE with a REGISTRATION REQUEST message, </condition> condition the 5GMM capability IE included in the REGISTRATION REQUEST message indicates "S1 mode supported" </condition> and <condition> the AMF supports N26 interface, </condition> <action> the AMF shall initiate another NAS security mode control procedure in order to provide the selected EPS NAS security algorithms to the UE as described in subclause 5.4.2.2. </action> </control>
This second NAS security mode control procedure should be initiated as part of 5GMM common procedures of the ongoing registration procedure.
<control> <condition> If the SECURITY MODE COMPLETE message contains a NAS message container IE with a SERVICE REQUEST message, </condition> <action> the AMF shall complete the ongoing service request procedure by considering the SERVICE REQUEST message contained in the NAS message container IE as the message that triggered the procedure. </action> </control>
<control> <condition> If the SECURITY MODE COMPLETE message contains a NAS message container IE with a CONTROL PLANE SERVICE REQUEST message, </condition> <action> the AMF shall complete the ongoing service request procedure by considering the CONTROL PLANE SERVICE REQUEST message contained in the NAS message container IE as the message that triggered the procedure. </action> </control>
5.4.2.5 NAS security mode command not accepted by the UE
<control> <condition> If the security mode command cannot be accepted, </condition> <action> the UE shall send a SECURITY MODE REJECT message. </action> </control> The SECURITY MODE REJECT message contains a 5GMM cause that typically indicates one of the following cause values: #23 UE security capabilities mismatch. #24 security mode rejected, unspecified.
<control> <condition> If the UE detects that the received Replayed UE security capabilities IE has been altered compared to the latest values that the UE sent to the network, </condition> <action> the UE shall set the cause value to #23 "UE security capabilities mismatch". </action> </control>
<control> <condition> Upon receipt of the SECURITY MODE REJECT message, </condition> <action> the AMF shall stop timer T3560. </action> <action> The AMF shall also abort the ongoing procedure that triggered the initiation of the NAS security mode control procedure. </action> </control>
<control> <action> Both the UE and the AMF shall apply the 5G NAS security context in use </action> <condition> before the initiation of the security mode control procedure, if any, </condition> to protect the SECURITY MODE REJECT message and any other subsequent messages according to the rules in subclause 4.4.4 and 4.4.5. </control>
5.4.2.6 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) <condition> Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication from lower layers </condition> ( <condition> if the security mode control procedure is triggered by a registration procedure). </condition> </condition> <action> The UE shall abort the security mode control procedure and re-initiate the registration procedure. </action> </control> <control> <condition> b) <condition> Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication with change in the current TAI </condition> ( <condition> if the security mode control procedure is triggered by a service request procedure). </condition> </condition> <control> <condition> If the current TAI is not in the TAI list, </condition> <action> the security mode control procedure shall be aborted </action> and <action> a registration procedure shall be initiated. </action> </control> <control> <condition> If the current TAI is still part of the TAI list, </condition> <action> the security mode control procedure shall be aborted </action> and <action> it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure. </action> </control> </control> <control> <condition> c) <condition> Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication without change in the current TAI </condition> ( <condition> if the security mode control procedure is triggered by a service request procedure). </condition> </condition> <action> The security mode control procedure shall be aborted </action> and <action> it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure. </action> </control>
5.4.2.7 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) Lower layer failure before the SECURITY MODE COMPLETE or SECURITY MODE REJECT message is received. </condition> <action> The network shall abort the security mode control procedure. </action> </control> <control> <condition> b) Expiry of timer T3560. </condition> <action> The network shall, on the first expiry of the timer T3560, retransmit the SECURITY MODE COMMAND message </action> and <action> shall reset </action> and <action> start timer T3560. </action> </control> <control> <action> This retransmission is repeated four times, i.e. on the fifth expiry of timer T3560, the procedure shall be aborted. </action> </control> <control> <condition> c) Collision between security mode control procedure and registration, service request or de-registration procedure not indicating switch off. </condition> <action> The network shall abort the security mode control procedure and proceed with the UE initiated procedure. </action> </control> <control> <condition> d) Collision between security mode control procedure and other 5GMM procedures than in item c. </condition> <action> The network shall progress both procedures. </action> </control> <control> <condition> e) Lower layers indication of non-delivered NAS PDU due to handover: </condition> <control> <condition> <condition> If the SECURITY MODE COMMAND message could not be delivered due to an intra AMF handover and the target TA is included in the TAI list, <condition> then <condition> upon successful completion of the intra AMF handover </condition> </condition> </condition> </condition> <action> the AMF shall retransmit the SECURITY MODE COMMAND message. </action> </control> <control> <condition> <condition> If a failure of the handover procedure is reported by the lower layer </condition> and <condition> the N1 signalling connection exists, </condition> </condition> <action> the AMF shall retransmit the SECURITY MODE COMMAND message. </action> </control> </control>
5.4.3 Identification procedure
5.4.3.1 General
The purpose of this procedure is to request a particular UE to provide specific identification parameters, e.g. the SUCI, the IMEI, the IMEISV, the EUI-64 or the MAC address. The SUCI is a privacy preserving identifier containing the concealed SUPI and the IMEI, the IMEISV, the EUI-64 and the MAC address are formats of PEI.
5.4.3.2 Identification initiation by the network
<control> <action> The AMF initiates the identification procedure by sending an IDENTITY REQUEST message to the UE </action> and <action> starting timer T3570 (see example in figure 5.4.3.2.1). </action> </control> <control> <action> The IDENTITY REQUEST message specifies the requested identification parameters in the Identity type information element. </action> </control>
5.4.3.3 Identification response by the UE
<control> <action> A UE shall be ready to respond to an IDENTITY REQUEST message at any time whilst in 5GMM-CONNECTED mode. </action> </control>
<control> <condition> Upon receipt of the IDENTITY REQUEST message: </condition> <control> a) <condition> if the Identity type IE in the IDENTITY REQUEST message is not set to "SUCI", </condition> <action> the UE shall send an IDENTITY RESPONSE message to the network. </action> <action> The IDENTITY RESPONSE message shall contain the identification parameters as requested by the network; </action> </control> and <control> b) <condition> if the Identity type IE in the IDENTITY REQUEST message is set to "SUCI", </condition> the UE shall: <control> 1) <condition> if timer T3519 is not running, </condition> <action> generate a fresh SUCI as specified in 3GPP TS 33.501 , </action> <action> send an IDENTITY RESPONSE message with the SUCI, </action> <action> start timer T3519 and store the value of the SUCI sent in the IDENTITY RESPONSE message; </action> </control> and <control> 2) <condition> if timer T3519 is running, </condition> <action> send an IDENTITY RESPONSE message with the stored SUCI. </action> </control> </control> </control>
5.4.3.4 Identification completion by the network
<control> <condition> Upon receipt of the IDENTITY RESPONSE </condition> <action> the network shall stop the timer T3570. </action> </control>
5.4.3.5 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> <condition> a) Transmission failure of the IDENTITY RESPONSE message </condition> ( <condition> if the identification procedure is triggered by a registration procedure). </condition> </condition> <action> The UE shall re-initiate the registration procedure. </action> </control> <control> <condition> b) Requested identity is not available </condition> <control> <condition> If the UE cannot encode the requested identity in the IDENTITY RESPONSE message, </condition> e.g. because no valid USIM is available, then <action> it shall encode the identity type as "No identity". </action> </control> </control>
5.4.3.6 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) Lower layer failure. </condition> <control> <condition> <condition> Upon detection of a lower layer failure </condition> <condition> before the IDENTITY RESPONSE is received, </condition> </condition> <action> the network shall abort any ongoing 5GMM procedure. </action> </control> </control> <control> <condition> b) Expiry of timer T3570. </condition> <control> The network shall, <condition> on the first expiry of the timer T3570, </condition> <action> retransmit the IDENTITY REQUEST message </action> and <action> reset </action> and <action> restart the timer T3570. </action> </control> </control> This retransmission is repeated four times, i.e. on the fifth expiry of timer T3570, the network shall abort the identification procedure and any ongoing 5GMM procedure. <control> <condition> c) Collision of an identification procedure with a registration procedure for initial registration. </condition> <control> <condition> <condition> If the network receives a REGISTRATION REQUEST message indicating either "initial registration" or "emergency registration" in the 5GS registration type IE </condition> <condition> before the ongoing identification procedure has been completed </condition> and <condition> no registration procedure is pending on the network (i.e. no REGISTRATION ACCEPT/REJECT message has still to be sent as an answer to a REGISTRATION REQUEST message), </condition> </condition> <action> the network shall proceed with the registration procedure for initial registration. </action> </control> </control> <control> <condition> d) Collision of an identification procedure with a registration procedure for initial registration when the identification procedure has been caused by a registration procedure for initial registration. </condition> <control> <condition> <condition> If the network receives a REGISTRATION REQUEST message indicating either "initial registration" or "emergency registration" in the 5GS registration type IE </condition> <condition> before the ongoing identification procedure has been completed and a registration procedure for initial registration is pending (i.e. a REGISTRATION ACCEPT/REJECT message has to be sent as an answer to an earlier REGISTRATION REQUEST message), </condition> </condition> then: <control> a) <condition> If one or more of the information elements in the REGISTRATION REQUEST message differ from the ones received within the previous REGISTRATION REQUEST message, </condition> <action> the network shall proceed with the new registration procedure for initial registration; </action> </control> or <control> b) <condition> If the information elements do not differ, </condition> then <action> the network shall not treat any further this new REGISTRATION REQUEST message. </action> </control> </control> </control> <control> <condition> e) Collision of an identification procedure with a registration procedure for mobility and periodic registration </condition> <control> <condition> <condition> If the network receives a REGISTRATION REQUEST message indicating either "mobility registration updating" or "periodic registration updating" in the 5GS registration type IE </condition> <condition> before the ongoing identification procedure has been completed, </condition> </condition> <action> the network shall progress both procedures. </action> </control> </control> <control> <condition> f) Collision of an identification procedure with a UE initiated de-registration procedure. </condition> <control> <condition> <condition> If the network receives a DEREGISTRATION REQUEST message with "switch off" indication in the de-registration type IE </condition> <condition> before the ongoing identification procedure has been completed, </condition> </condition> <action> the network shall abort the identification procedure </action> and <action> shall progress the UE-initiated de-registration procedure; </action> </control> </control>
<control> <condition> Else </condition> <action> the network shall complete the identification procedure </action> and <action> shall respond to the UE-initiated de-registration procedure as described in subclause 5.5.2.2. </action> </control>
5.4.4 Generic UE configuration update procedure
5.4.4.1 General
The purpose of this procedure is to:
a) allow the AMF to update the UE configuration for access and mobility management-related parameters decided and provided by the AMF by providing new parameter information within the command;
b) request the UE to perform a registration procedure for mobility and periodic registration update towards the network to update access and mobility management-related parameters decided and provided by the AMF (see subclause 5.5.1.3);
c) deliver the UAV authorization information to the UE, as described in 3GPP TS 23.256 ; or
d) update the PEIPS assistance information in the UE (see subclause 5.3.25).
<control> <action> This procedure is initiated by the network </action> and <action> can only be used </action> when <condition> <condition> the UE has an established 5GMM context, </condition> and <condition> the UE is in 5GMM-CONNECTED mode. </condition> </condition> </control> <control> <condition> When the UE is in 5GMM-IDLE mode, </condition> <action> the AMF may use the paging or notification procedure to initiate the generic UE configuration update procedure. </action> </control> <control> <action> The AMF can request a confirmation response in order to ensure that the parameter has been updated by the UE. </action> </control>
<control> <action> This procedure shall be initiated by the network to assign a new 5G-GUTI to the UE </action> after: <condition> <condition> a) a successful service request procedure invoked as a response to a paging request from the network and before the: 1) release of the N1 NAS signalling connection; or 2) suspension of the N1 NAS signalling connection due to user plane CIoT 5GS optimization i.e. before the UE and the AMF enter 5GMM-IDLE mode with suspend indication; or </condition> <condition> b) the AMF receives an indication from the lower layers that it has received the NGAP UE context resume request message as specified in 3GPP TS 38.413 for a UE in 5GMM-IDLE mode with suspend indication and this resumption is a response to a paging request from the network, and before the: 1) release of the N1 NAS signalling connection; or 2) suspension of the N1 NAS signalling connection due to user plane CIoT 5GS optimization i.e. before the UE and the AMF enter 5GMM-IDLE mode with suspend indication. </condition> </condition> </control>
<control> <condition> If the service request procedure was triggered due to 5GSM downlink signalling pending, </condition> <action> the procedure for assigning a new 5G-GUTI can be initiated by the network after the transport of the 5GSM downlink signalling. </action> </control>
The following parameters are supported by the generic UE configuration update procedure without the need to request the UE to perform the registration procedure for mobility and periodic registration update: a) 5G-GUTI; b) TAI list; c) Service area list; d) Network identity and time zone information (Full name for network, short name for network, local time zone, universal time and local time zone, network daylight saving time); f) Rejected NSSAI; NOTE: A cause value associated with a rejected S-NSSAI can be included in the Rejected NSSAI IE or in the Extended rejected NSSAI IE and a back-off timer value associated with rejected S-NSSAI(s) can be included in the Extended rejected NSSAI IE. k) UE radio capability ID; o) "list of PLMN(s) to be used in disaster condition"; p) disaster roaming wait range; q) disaster return wait range; and r) PEIPS assistance information; s) Priority indicator; and t) NSAG information.
The following parameters can be sent to the UE with or without a request to perform the registration procedure for mobility and periodic registration update: a) Allowed NSSAI; b) Configured NSSAI; c) Network slicing subscription change indication; or d) NSSRG information.
The following parameters are sent to the UE with a request to perform the registration procedure for mobility and periodic registration update: a) MICO indication; b) UE radio capability ID deletion indication; and c) Additional configuration indication.
The following parameters can be included in the Service-level-AA container IE to be sent to the UE without a request to perform the registration procedure for mobility and periodic registration update: a) Service-level device ID; b) Service-level-AA payload type; c) Service-level-AA payload; or d) Service-level-AA response.
The following parameters are sent over 3GPP access only: a) LADN information; b) MICO indication; c) TAI list; d) Service area list; f) UE radio capability ID; g) UE radio capability ID deletion indication; i) Additional configuration indication; j) T3447 value; k) Service-level-AA container; and l) NSAG information.
The following parameters are managed and sent per access type i.e., independently over 3GPP access or non-3GPP access: a) Allowed NSSAI; b) Rejected NSSAI (when the NSSAI is rejected for the current registration area or is rejected for the maximum number of UEs reached); and
If the UE is registered to the same PLMN or SNPN over 3GPP and non-3GPP access, the following parameters are managed commonly and sent over 3GPP access or non-3GPP access: a) 5G-GUTI; b) Network identity and time zone information; c) Rejected NSSAI (when the NSSAI is rejected for the current PLMN or SNPN or rejected for the failed or revoked NSSAA); e) SMS indication; and g) "list of PLMN(s) to be used in disaster condition"; h) disaster roaming wait range; i) disaster return wait range; j) PEIPS assistance information; and k) NSSRG information;
UE AMF CONFIGURATION UPDATE COMMAND
Start T3555 CONFIGURATION UPDATE COMPLETE
Stop T3555 CONFIGURATION UPDATE COMMAND
5.4.4.2 Generic UE configuration update procedure initiated by the network
<control> <action> The AMF shall initiate the generic UE configuration update procedure </action> by sending the CONFIGURATION UPDATE COMMAND message to the UE. </control>
<control> <action> The AMF shall in the CONFIGURATION UPDATE COMMAND message </action> either: <condition> <condition> b) include the Configuration update indication IE with the Registration requested bit set to "registration requested"; </condition> or <condition> c) include a combination of both a) and b). </condition> </condition> </control>
<control> <condition> Ifthe UE is registering or registered for onboarding services in SNPN, </condition> <action> the serving SNPN shall not provide the configured NSSAI, the allowed NSSAI or the rejected NSSAI to the UE. </action> </control>
<control> <condition> If the UE supports extended rejected NSSAI, </condition> <action> the rejected S-NSSAI(s) shall be included in the Extended rejected NSSAI IE. </action> </control> <control> <condition> Otherwise </condition> <action> the rejected S-NSSAI(s) shall be included in the Rejected NSSAI IE. </action> </control>
<control> <condition> If an acknowledgement from the UE is requested, </condition> <action> the AMF shall indicate "acknowledgement requested" in the Acknowledgement bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message and shall start timer T3555. </action> </control> <control> <action> Acknowledgement shall be requested for all parameters </action> <condition> except when only NITZ is included. </condition> </control>
<control> To initiate parameter re-negotiation between the UE and network, <action> the AMF shall indicate "registration requested" in the Registration requested bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND </action> </control>
NOTE 1: Generic UE configuration update procedure can be initiated by the AMF for updating the emergency number list, the extended emergency number list or both by indicating "registration requested" in the Registration requested bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message to the UE.
<control> <condition> If a new allowed NSSAI information or AMF re-configuration of supported S-NSSAIs requires an AMF relocation, </condition> <action> the AMF shall indicate "registration requested" in the Registration requested bit of the Configuration update indication IE </action> and <action> include the Allowed NSSAI IE in the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> <condition> If the AMF includes a new allowed NSSAI in the CONFIGURATION UPDATE COMMAND message </condition> and <condition> the subscription information includes the NSSRG information, </condition> </condition> then <action> the S-NSSAIs of the allowed NSSAI shall be associated with at least one common NSSRG value. </action> </control>
<control> <condition> <condition> If the AMF includes a new configured NSSAI in the CONFIGURATION UPDATE COMMAND message </condition> and <condition> the new configured NSSAI requires an AMF relocation as specified in 3GPP TS 23.501 , </condition> </condition> <action> the AMF shall indicate "registration requested" in the Registration requested bit of the Configuration update indication IE in the message. </action> </control>
<control> <condition> <condition> If the AMF includes a new configured NSSAI in the CONFIGURATION UPDATE COMMAND message, </condition> <condition> the subscription information includes the NSSRG information, </condition> and <condition> the UE has set the NSSRG bit in the 5GMM capability IE of the REGISTRATION REQUEST message to: </condition> </condition> <control> <condition> a) "NSSRG supported", </condition> then <action> the AMF shall include the NSSRG information in the CONFIGURATION UPDATE COMMAND message; </action> </control> or <control> <condition> b) "NSSRG not supported", </condition> then <action> the configured NSSAI shall include one or more S-NSSAIs each of which is associated with all the NSSRG value(s) of the default S-NSSAI(s), </action> or <action> the configured NSSAI shall include, based on the indication received from the UDM as specified in 3GPP TS 23.501 , all subscribed S-NSSAIs even if these S-NSSAIs do not share any common NSSRG value. </action> </control> </control>
<control> <condition> <condition> If the AMF needs to update the NSSRG information </condition> and <condition> the UE has set the NSSRG bit to "NSSRG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> </condition> then <action> the AMF shall include the new NSSRG information in the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> <condition> If the CONFIGURATION UPDATE COMMAND message is initiated only due to changes to the allowed NSSAI </condition> and <condition> these changes require the UE to initiate a registration procedure, </condition> but <condition> the AMF is unable to determine an allowed NSSAI for the UE as specified in 3GPP TS 23.501 , </condition> </condition> then <action> the CONFIGURATION UPDATE COMMAND message shall indicate "registration requested" in the Registration requested bit of the Configuration update indication IE, </action> and <action> shall not contain any other parameters. </action> </control>
<control> If: <condition> <condition> a) the AMF needs to enforce a change in the restriction on the use of enhanced coverage or use of CE mode B as described in subclause 5.3.18; </condition> or <condition> b) the AMF decides to inform a UE in 5GMM-CONNECTED mode and registered for disaster roaming services, that a disaster condition is no longer applicable; </condition> </condition> NOTE 1A: The case of the AMF triggering a generic UE configuration update procedure to inform a UE registered for disaster roaming services that a disaster condition is no longer applicable, is only applicable for a UE already in 5GMM-CONNECTED mode. <action> the AMF shall indicate "registration requested" in the Registration requested bit of the Configuration update indication IE </action> and <action> "release of N1 NAS signalling connection not required" in the Signalling connection maintain request bit of the Additional configuration indication IE in the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> If a network slice-specific authentication and authorization procedure for an S-NSSAI is completed as a: </condition> <control> <condition> a) success, </condition> <action> the AMF shall include this S-NSSAI in the allowed NSSAI over the same access of the requested S- NSSAI; </action> </control> or <control> <condition> b) failure, </condition> <action> the AMF shall include this S-NSSAI in the rejected NSSAI for the failed or revoked NSSAA with the rejection cause "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization" over either 3GPP access or non-3GPP access. </action> </control> </control>
<control> <condition> If authorization is revoked for an S-NSSAI that is in the current allowed NSSAI for an access type, </condition> the AMF shall: <action> a) provide a new allowed NSSAI to the UE, </action> <action> excluding the S-NSSAI for which authorization is revoked; </action> and <action> b) provide a new rejected NSSAI for the failed or revoked NSSAA, </action> <action> including the S-NSSAI in the rejected NSSAI for which the authorization is revoked, </action> <action> with the rejection cause "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization". </action> </control>
<control> <action> The allowed NSSAI and the rejected NSSAI shall be included in the CONFIGURATION UPDATE COMMAND message </action> to reflect the result of the procedures subject to network slice-specific authentication and authorization. </control>
NOTE 2: If there are multiple S-NSSAIs subject to network slice-specific authentication and authorization, it is implementation specific if the AMF informs the UE about the outcome of the procedures in one or more CONFIGURATION UPDATE COMMAND messages.
<control> <condition> <condition> If the AMF includes the Network slicing indication IE in the CONFIGURATION UPDATE COMMAND message with the Network slicing subscription change indication set to "Network slicing subscription changed", </condition> and <condition> changes to the allowed NSSAI require the UE to initiate a registration procedure, </condition> but <condition> the AMF is unable to determine an allowed NSSAI for the UE as specified in 3GPP TS 23.501 , </condition> </condition> then <action> the CONFIGURATION UPDATE COMMAND message shall additionally indicate "registration requested" in the Registration requested bit of the Configuration update indication IE </action> and <action> shall not include an allowed NSSAI. </action> </control> <condition> If EAC mode is activated for an S-NSSAI, </condition> <control> <action> the AMF shall perform NSAC for the S-NSSAI subject to NSAC </action> <condition> before such S-NSSAI is included in the allowed NSSAI in the CONFIGURATION UPDATE COMMAND message. </condition> </control> <control> <condition> If EAC mode is deactivated for an S-NSSAI, </condition> <control> <action> the AMF shall perform NSAC for the S-NSSAI subject to NSAC </action> <condition> after such S- NSSAI is included in the allowed NSSAI in the CONFIGURATION UPDATE COMMAND message. </condition> </control> </control>
<control> <condition> <condition> If the UE supports extended rejected NSSAI </condition> and <condition> the AMF determines that maximum number of UEs reached for one or more S-NSSAI(s) in the allowed NSSAI as specified in subclause 4.6.2.5, </condition> </condition> <action> the AMF shall include the rejected NSSAI containing one or more S-NSSAIs with the rejection </action> cause "S-NSSAI not available due to maximum number of UEs reached" in the Extended rejected NSSAI IE in the CONFIGURATION UPDATE COMMAND message. </control> <control> In addition, <action> the AMF may include a back-off timer value for each S-NSSAI with the rejection </action> cause "S-NSSAI not available due to maximum number of UEs reached" included in the Extended rejected NSSAI IE of the CONFIGURATION UPDATE COMMAND message. </control> <control> To avoid that large numbers of UEs simultaneously initiate deferred requests, <action> the network should select the value for the backoff timer for each S-NSSAI for the informed UEs </action> so that timeouts are not synchronised. </control>
<control> <condition> <condition> If the UE does not indicate support for extended rejected NSSAI </condition> and <condition> the maximum number of UEs has been reached, </condition> </condition> <action> the AMF should include the rejected NSSAI containing one or more S-NSSAIs with the rejection </action> cause "S-NSSAI not available in the current registration area" in the Rejected NSSAI IE and <action> should not include these S-NSSAIs in the allowed NSSAI in the CONFIGURATION UPDATE COMMAND message. </action> </control> <control> In addition, <action> the AMF may based on the network policies start a local implementation specific timer for the UE per rejected S-NSSAI </action> and <control> <condition> upon expiration of the local implementation specific timer, </condition> <action> the AMF may remove the rejected S-NSSAI from the rejected NSSAI </action> and <action> update to the UE by initiating the generic UE configuration update procedure. </action> </control> </control>
NOTE 3: <control> Based on network policies, <action> the AMF can include the S-NSSAI(s) for which the maximum number of UEs has been reached in the rejected NSSAI with rejection </action> causes other than "S-NSSAI not available in the current registration area". </control>
<control> <condition> If the UE has set the NSAG bit to "NSAG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> <action> the AMF may include the NSAG information IE in the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> If the AMF needs to update the LADN information, </condition> <action> the AMF shall include the LADN information in the LADN information IE of the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> If the AMF needs to update the "CAG information list", </condition> <action> the AMF shall include the CAG information list IE or the Extended CAG information list IE in the CONFIGURATION UPDATE COMMAND message. </action> </control>
NOTE 4: <control> <condition> If the UE supports extended CAG information list, </condition> <action> the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE. </action> </control>
<control> <condition> If the UE does not support extended CAG information list, </condition> <action> the CAG information list shall not be included in the Extended CAG information list IE. </action> </control>
<control> <condition> <condition> If the AMF needs to update the "CAG information list", </condition> <condition> the UE has an emergency PDU session, </condition> and <condition> the AMF can determine that the UE is in a) a CAG cell and none of the CAG-ID(s) supported by the CAG cell is included in the "allowed CAG list" for the current PLMN in the updated "CAG information list"; </condition> or <condition> b) a non-CAG cell and the entry for the current PLMN in the updated "CAG information list" includes an "indication that the UE is only allowed to access 5GS via CAG cells"; </condition> </condition> <action> the AMF may indicate to the SMF to perform a local release of: a) all non-emergency single access PDU sessions associated with 3GPP access; </action> <action> b) all MA PDU sessions without a PDN connection established as a user-plane resource and without user plane resources established on non-3GPP access; </action> and <action> c) the 3GPP access user plane resources of all those MA PDU sessions with user plane resources established on both accesses. </action> </control> <control> <action> The AMF shall not indicate to the SMF to release the emergency PDU session. </action> </control> <control> <condition> <condition> If the AMF indicated to the SMF to perform a local release of: a) all single access non-emergency PDU sessions associated with 3GPP access; </condition> <condition> b) all MA PDU sessions without a PDN connection established as a user-plane resource and without user plane resources established on non-3GPP access; </condition> and <condition> c) the 3GPP access user plane resources of all those MA PDU sessions with user plane resources established on both accesses; </condition> </condition> <action> the network shall behave as if the UE is registered for emergency services over 3GPP access </action> and <action> shall set the 5GS registration result IE value to "Registered for emergency services" in the CONFIGURATION UPDATE COMMAND </action> </control>
<control> <condition> <condition> If the AMF is initiating the generic UE configuration update procedure to indicate to a UE </condition> which is registered for disaster roaming services, and <condition> which has an ongoing emergency PDU session, </condition> that <condition> the UE is registered for emergency services as described in subclause 4.24, </condition> </condition> <action> the AMF shall set the 5GS registration result IE value to "Registered for emergency services" in the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> If the AMF: <condition> <condition> a) updated the "CAG information list" to remove one or more CAG-ID(s) in the Allowed CAG list for the serving PLMN or an equivalent PLMN; </condition> or <condition> b) updated the "CAG information list" to set the "indication that the UE is only allowed to access 5GS via CAG cells" for the serving PLMN or an equivalent PLMN which was not set before, </condition> then <condition> upon completion of the configuration update procedure </condition> and <condition> if the UE does not have an emergency PDU session, </condition> </condition> <action> the AMF shall initiate the release of the N1 NAS signalling connection according to subclause 5.3.1.3. </action> </control>
<control> <condition> If the AMF needs to update the truncated 5G-S-TMSI configuration for a UE in NB-N1 mode using control plane CIoT 5GS optimization, </condition> <action> the AMF shall include the Truncated 5G-S-TMSI configuration IE in the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> If the AMF includes a UE radio capability ID deletion indication IE in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the AMF shall indicate "registration requested" in the Registration requested bit of the Configuration update indication IE. </action> </control>
<control> <condition> If the AMF needs to redirect the UE to EPC as described in subclause 4.8.4A.2, </condition> <action> the AMF shall indicate "registration requested" in the Registration requested bit of the Configuration update indication IE </action> and <action> "release of N1 NAS signalling connection not required" in the Signalling connection maintain request bit of the Additional configuration indication IE in the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> <condition> If the UE is not in NB-N1 mode </condition> and <condition> the UE supports RACS, </condition> </condition> <action> the AMF may include either a UE radio capability ID IE </action> or <action> a UE radio capability ID deletion indication IE in the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> During an established 5GMM context, </condition> <action> the network may send none, one, or more CONFIGURATION UPDATE COMMAND messages to the UE. </action> </control> <control> <condition> If more than one CONFIGURATION UPDATE COMMAND message is sent, </condition> <action> the messages need not have the same content. </action> </control>
<control> <condition> Upon receipt of the result of the UUAA-MM procedure from the UAS-NF, </condition> <action> the AMF shall include: a) the service-level-AA response with the SLAR field set to: </action> <control> <action> 1) "Service level authentication and authorization was successful" </action> <condition> if the AMF detects the UUAA-MM procedure has succeeded; </condition> </control> or <control> <action> 2) "Service level authentication and authorization was not successful or service level authorization is revoked" </action> <condition> if the AMF detects the UUAA-MM procedure has failed; </condition> </control> <control> b) <condition> if the CAA-Level UAV ID is provided by the UAS-NF, </condition> <action> the service-level device ID with the value set to the CAA-Level UAV ID; </action> </control> and; <control> c) <condition> if the UUAA authorization payload is received from the UAS-NF: </condition> <action> 1) the service-level-AA payload type, with the values set to "UUAA payload"; </action> and 2) <action> the service-level-AA payload, with the value set to the UUAA payload; in the Service-level-AA container IE of the CONFIGURATION UPDATE COMMAND message. </action> </control> </control>
NOTE 5: UAS security information can be included in the UUAA payload by the USS as specified in 3GPP TS 33.256 .
NOTE 6: <control> <condition> <condition> If the AMF receives the HTTP code set to "4xx" or "5xx" as specified in 3GPP TS 29.500 </condition> or <condition> the AMF detects that the UUAA-MM failure as specified in 3GPP TS 29.256 , </condition> </condition> then <action> the AMF considers the UUAA-MM procedure has failed. </action> </control>
<control> <condition> If the AMF needs to deliver to the UE the UUAA revocation notification received from the UAS-NF, </condition> <action> the AMF shall include the service-level-AA response </action> with <action> SLAR set to "Service level authentication </action> and <action> authorization was not successful or service level authorization is revoked" in the Service-level-AA container IE of the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> If the UE supports MINT, </condition> <action> the AMF may include the List of PLMNs to be used in disaster condition IE in the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> If the UE supports MINT, </condition> <action> the AMF may include the Disaster roaming wait range IE in the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> If the UE supports MINT, </condition> <action> the AMF may include the Disaster return wait range IE in the CONFIGURATION UPDATE COMMAND message. </action> </control>
NOTE 7: The AMF can determine the content of the "list of PLMN(s) to be used in disaster condition", the value of the disaster roaming wait range and the value of the disaster return wait range based on the network local
<control> <condition> <condition> If the UE supports </condition> and <condition> the network supports </condition> and <condition> accepts the use of the PEIPS assistance information, </condition> and <condition> the AMF needs to update the PEIPS assistance information, </condition> </condition> <action> the AMF may include the PEIPS assistance information in the Updated PEIPS assistance information IE of the CONFIGURATION UPDATE COMMAND message. </action> </control>
<control> <condition> <condition> If the AMF needs to inform the UE that the use of access identity 1 is valid </condition> or <condition> is no longer valid, </condition> </condition> <action> the AMF informs the UE by setting the MPS indicator bit of the Priority indicator IE to "Access identity 1 valid" or "Access identity 1 not valid" respectively, in the CONFIGURATION UPDATE COMMAND message. </action> </control> <control> Based on operator policy, <action> the AMF sets the MPS indicator bit in the CONFIGURATION UPDATE COMMAND message </action> based on the MPS priority information in the user's subscription context obtained from the UDM. </control>
5.4.4.3 Generic UE configuration update accepted by the UE
<control> <condition> Upon receiving the CONFIGURATION UPDATE COMMAND message, </condition> <control> <action> the UE shall stop timer T3346 </action> <condition> if running and use the contents to update appropriate information stored within the UE. </condition> </control> </control>
<control> <condition> If "acknowledgement requested" is indicated in the Acknowledgement bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the UE shall send a CONFIGURATION UPDATE COMPLETE message. </action> </control>
<control> <condition> If the UE receives a new 5G-GUTI in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the UE shall consider the new 5G-GUTI as valid, </action> <action> the old 5G-GUTI as invalid, </action> <control> <action> stop timer T3519 </action> <condition> if running, </condition> </control> and <action> delete any stored SUCI; </action> <control> <condition> otherwise, </condition> <action> the UE shall consider the old 5G-GUTI as valid. </action> </control> </control> <control> <action> The UE shall provide the 5G-GUTI to the lower layer of 3GPP access </action> <condition> <condition> if the CONFIGURATION UPDATE COMMAND message is sent over the non-3GPP access, </condition> and <condition> the UE is in 5GMM-REGISTERED in both 3GPP access and non-3GPP access in the same PLMN. </condition> </condition> </control>
<control> <condition> If the UE receives a new TAI list in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the UE shall consider the new TAI list as valid </action> and <action> the old TAI list as invalid; </action> <control> <condition> otherwise, </condition> <action> the UE shall consider the old TAI list as valid. </action> </control> </control> <condition> If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, </condition> and <control> <condition> a) the UE already has stored allowed NSSAI for the current registration area, </condition> <action> the UE shall store the allowed NSSAI for the current registration area in each of the allowed NSSAIs which are associated with each of the PLMNs in the registration area; </action> </control> and <control> <condition> b) the UE already has stored rejected NSSAI for the current registration area, </condition> <action> the UE shall store the rejected NSSAI for the current registration area in each of the rejected NSSAIs which are associated with each of the PLMNs in the registration area. </action> </control>
<control> <condition> If the UE receives a new truncated 5G-S-TMSI configuration in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the UE shall consider the new truncated 5G-S-TMSI configuration as valid </action> and <action> the old truncated 5G-S-TMSI configuration as invalid; </action> <control> <condition> otherwise, </condition> <action> the UE shall consider the old truncated 5G-S-TMSI configuration as valid. </action> </control> </control>
<control> <condition> If the UE receives a new service area list in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the UE shall consider the new service area list as valid </action> and <action> the old service area list as invalid; </action> <control> <condition> otherwise, </condition> <control> <action> the UE shall consider the old service area list, </action> <condition> if any, </condition> as valid. </control> </control> </control>
<control> <condition> If the UE receives new NITZ information in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the UE considers the new NITZ information as valid </action> and action the old NITZ information as invalid; <control> <condition> otherwise, </condition> <action> the UE shall consider the old NITZ information as valid. </action> </control> </control>
<control> <condition> If the UE receives a LADN information IE in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the UE shall consider the old LADN information as invalid </action> and <control> <action> the new LADN information as valid, </action> <condition> if any; </condition> </control> <control> <condition> otherwise, </condition> <action> the UE shall consider the old LADN information as valid. </action> </control> </control>
<control> <condition> If the UE receives a new allowed NSSAI for the associated access type in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the UE shall consider the new allowed NSSAI as valid for the associated access type, </action> <action> store the allowed NSSAI for the associated access type as specified in subclause 4.6.2.2 </action> and <action> consider the old allowed NSSAI for the associated access type as invalid; </action> <control> <condition> otherwise, </condition> <action> the UE shall consider the old allowed NSSAI as valid for the associated access type. </action> </control> </control>
<control> <condition> If the UE receives a new configured NSSAI in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the UE shall consider the new configured NSSAI for the registered PLMN or SNPN as valid </action> and <action> the old configured NSSAI for the registered PLMN or SNPN as invalid; </action> <control> <condition> otherwise, </condition> <action> the UE shall consider the old configured NSSAI for the registered PLMN or SNPN as valid </action> </control> </control> <control> <action> The UE shall store the new configured NSSAI as specified in subclause 4.6.2.2. </action> </control> <control> In addition, <condition> if the CONFIGURATION UPDATE COMMAND message contains an NSSRG information IE, </condition> <action> the UE shall store the contents of the NSSRG information IE as specified in subclause 4.6.2.2. </action> </control>
<control> <condition> If the UE receives the Network slicing indication IE in the CONFIGURATION UPDATE COMMAND message with the Network slicing subscription change indication set to "Network slicing subscription changed", </condition> <action> the UE shall delete the network slicing information for each and every PLMN except for the current PLMN as specified in subclause 4.6.2.2. </action> </control>
<control> <condition> <condition> If the UE receives Operator-defined access category definitions IE in the CONFIGURATION UPDATE COMMAND message </condition> and <condition> the Operator-defined access category definitions IE contains one or more operator-defined access category definitions, </condition> </condition> <action> the UE shall delete any operator-defined access category definitions stored for the RPLMN </action> and <action> shall store the received operator-defined access category definitions for the RPLMN. </action> </control> <control> <condition> <condition> If the UE receives the Operator-defined access category definitions IE in the CONFIGURATION UPDATE COMMAND message </condition> and <condition> the Operator-defined access category definitions IE contains no operator-defined access category definitions, </condition> </condition> <action> the UE shall delete any operator-defined access category definitions stored for the RPLMN. </action> </control> <control> <condition> If the CONFIGURATION UPDATE COMMAND message does not contain the Operator-defined access category definitions IE, </condition> <action> the UE shall not delete the operator- defined access category definitions stored for the RPLMN. </action> </control>
<control> <condition> If the UE receives the SMS indication IE in the CONFIGURATION UPDATE COMMAND message </condition> with the SMS availability indication set to: <control> <condition> a) "SMS over NAS not available", </condition> <action> the UE shall consider that SMS over NAS transport is not allowed by the network; </action> </control> and <control> <condition> b) "SMS over NAS available", </condition> <control> <action> the UE may request the use of SMS over NAS transport by performing a registration procedure for mobility and periodic registration update as specified in subclause 5.5.1.3, </action> <condition> after the completion of the generic UE configuration update procedure. </condition> </control> </control> </control>
<control> <condition> If the UE receives the CAG information list IE in the CONFIGURATION UPDATE COMMAND message, </condition> the UE shall: <action> a) replace the "CAG information list" stored in the UE with the received CAG information list IE when received in the HPLMN or EHPLMN; </action> NOTE 1: When the UE receives the CAG information list IE in the HPLMN derived from the IMSI, the EHPLMN list is present and is not empty and the HPLMN is not present in the EHPLMN list, the UE behaves as if it receives the CAG information list IE in a VPLMN. <control> <action> b) replace the serving VPLMN's entry of the "CAG information list" stored in the UE with the serving VPLMN's entry of the received CAG information list IE </action> <condition> when the UE receives the CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; </condition> </control> or NOTE 2: When the UE receives the CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE are ignored. <control> <action> c) remove the serving VPLMN's entry of the "CAG information list" stored in the UE </action> <condition> <condition> when the UE receives the CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN </condition> and <condition> the CAG information list IE does not contain the serving VPLMN's entry. </condition> </condition> </control> </control>
<control> <action> The UE shall store the "CAG information list" received in the CAG information list IE as specified in annex C. </action> </control>
<control> <condition> <condition> If the received "CAG information list" includes an entry containing the identity of the current PLMN </condition> and <condition> the UE had set the CAG bit to "CAG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> </condition> the UE shall operate as follows. <control> a) <condition> <condition> If the UE receives the CONFIGURATION UPDATE COMMAND message via a CAG cell, </condition> <condition> the entry for the current PLMN in the received "CAG information list" does not include any of the CAG-ID(s) supported by the current CAG cell, </condition> </condition> and: <control> <condition> 1) the entry for the current PLMN in the received "CAG information list" does not include an "indication that the UE is only allowed to access 5GS via CAG cells", </condition> then <end_state> the UE shall enter the state 5GMM- REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list"; </action> </control> or <control> <condition> 2) the entry for the current PLMN in the received "CAG information list" includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> and: <control> i) <condition> if the entry for the current PLMN in the received "CAG information list" includes one or more CAG-IDs, </condition> <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 with the updated "CAG information list"; </action> </control> or <control> ii) <condition> if the entry for the current PLMN in the received "CAG information list" does not include any CAG-ID </condition> and: <control> <condition> A) the UE does not have an emergency PDU session, </condition> then <end_state> the UE shall enter the state 5GMM- REGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list"; </action> </control> or <control> <condition> B) the UE has an emergency PDU session, </condition> then <action> the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session </action> and <end_state> enter the state 5GMM- REGISTERED.LIMITED-SERVICE; </end_state> </control> </control> </control> </control> or <control> b) <condition> If	 <condition> the UE receives the CONFIGURATION UPDATE COMMAND message via a non-CAG cell </condition> and <condition> the entry for the current PLMN in the received "CAG information list" includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> </condition> and: <control> 1) <condition> if the "allowed CAG list" for the current PLMN in the received "CAG information list" includes one or more CAG-IDs, </condition> <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 with the updated "CAG information list"; </action> </control> or <control> 2) <condition> if the entry for the current PLMN in the received "CAG information list" does not include any CAG-ID </condition> and: <control> <condition> i) the UE does not have an emergency PDU session, </condition> then <end_state> the UE shall enter the state 5GMM- REGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list"; </action> </control> or <control> <condition> ii) the UE has an emergency PDU session, </condition> then <action> the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session </action> and <end_state> enter the state 5GMM- REGISTERED.LIMITED-SERVICE. </end_state> </control> </control> </control> </control>
<control> <condition> <condition> If the received "CAG information list" does not include an entry containing the identity of the current PLMN </condition> and <condition> the UE receives the CONFIGURATION UPDATE COMMAND message via a CAG cell, </condition> </condition> <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list". </action> </control>
<control> <condition> If the CONFIGURATION UPDATE COMMAND message indicates "registration requested" in the Registration requested bit of the Configuration update indication IE </condition> and: <control> <condition> a) contains no other parameters or contains at least one of the following parameters: a new allowed NSSAI, a new configured NSSAI or the Network slicing subscription change indication, </condition> and: <control> <condition> <condition> 1) an emergency PDU session exists, </condition> the UE shall, <condition> after the completion of the generic UE configuration update procedure and the release of the emergency PDU session, </condition> </condition> <action> release the existing N1 NAS signalling connection. </action> </control> <control> <condition> If any Tsor-cm timer(s) were running and have stopped, </condition> <action> the UE shall attempt to obtain service on a higher priority PLMN (see 3GPP TS 23.122 ). </action> </control> <control> <condition> Otherwise </condition> <action> the UE start a registration procedure for mobility and periodic registration update as specified in subclause 5.5.1.3; </action> </control> or <control> <condition> <condition> 2) no emergency PDU Session exists, </condition> the UE shall, <condition> after the completion of the generic UE configuration update procedure and the release of the existing N1 NAS signalling connection. If any Tsor-cm timer(s) were running and have stopped, </condition> </condition> <action> the UE shall attempt to obtain service on a higher priority PLMN (see 3GPP TS 23.122 ). </action> </control> <control> <condition> Otherwise </condition> <action> the UE start a registration procedure for mobility and periodic registration update as specified in subclause 5.5.1.3; </action> </control> </control> <control> <condition> <condition> b) a MICO indication is included without a new allowed NSSAI; </condition> <condition> a new configured NSSAI or the Network slicing subscription change indication, </condition> </condition> the UE shall, <condition> after the completion of the generic UE configuration update procedure, </condition> <action> start a registration procedure for mobility and registration update as specified in subclause 5.5.1.3 to re-negotiate MICO mode with the network; </action> </control> <control> <condition> <condition> c) an Additional configuration indication IE is included, </condition> and: <condition> 1) "release of N1 NAS signalling connection not required" is indicated in the Signalling connection maintain request bit of the Additional configuration indication IE; </condition> and <condition> 2) a new allowed NSSAI, a new configured NSSAI and the Network slicing subscription change indication is not included in the CONFIGURATION UPDATE COMMAND message, </condition> the UE shall, <condition> after the completion of the generic UE configuration update procedure, </condition> </condition> <action> start a registration procedure for mobility and registration update as specified in subclause 5.5.1.3; </action> </control> or <control> <condition> <condition> d) a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested" is included, </condition> and: <condition> 1) the UE is not in NB-N1 mode; </condition> <condition> 2) a new allowed NSSAI, a new configured NSSAI or a Network slicing subscription change indication is not included; </condition> and <condition> 3) the UE has set the RACS bit to "RACS supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> the UE shall, <condition> after the completion of the generic UE configuration update procedure, </condition> </condition> <action> start a registration procedure for mobility and registration update as specified in subclause 5.5.1.3. </action> </control> </control>
The UE receiving the rejected NSSAI in the CONFIGURATION UPDATE COMMAND message takes the following actions based on the rejection cause in the rejected S-NSSAI(s): <control> <condition> "S-NSSAI not available in the current PLMN or SNPN" </condition> <action> The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI(s) in the current PLMN or SNPN until switching off the UE, </action> <action> the UICC containing the USIM is removed, </action> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </action> or <action> the rejected S-NSSAI(s) are removed or deleted as described in subclause 4.6.2.2. </action> </control> <control> <condition> "S-NSSAI not available in the current registration area" </condition> <action> The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI(s) in the current registration area until switching off the UE, </action> <action> the UE moving out of the current registration area, </action> <action> the UICC containing the USIM is removed, </action> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </action> or <action> the rejected S- NSSAI(s) are removed or deleted as described in subclause 4.6.2.2. </action> </control> <control> <condition> "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization" </condition> <action> The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access until switching off the UE, </action> <action> the UICC containing the USIM is removed, </action> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </action> or <action> the rejected S-NSSAI(s) are removed or deleted as described in subclause 4.6.1 and 4.6.2.2. </action> </control> <control> <condition> <condition> "S-NSSAI not available due to maximum number of UEs reached" </condition> <condition> Unless the back-off timer value received along with the S-NSSAI is zero, </condition> </condition> <action> the UE shall add the rejected S- NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access until switching off the UE, </action> <action> the UICC containing the USIM is removed, </action> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </action> or <action> the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </action> </control>
NOTE 3: If the back-off timer value received along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached is zero as specified in subclause 10.5.7.4a of TS 24.008, the UE does not consider the S-NSSAI as the rejected S-NSSAI.
<control> <condition> If there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause "S-NSSAI not available due to maximum number of UEs reached", </condition> then for each S-NSSAI, the UE shall behave as follows: <control> <action> a) stop the timer T3526 associated with the S-NSSAI, </action> <condition> if running; </condition> </control> <control> <action> b) start the timer T3526 with: </action> <condition> <condition> 1) the back-off timer value received along with the S-NSSAI, if back-off timer value is received along with the S-NSSAI that is neither zero nor deactivated; </condition> or <condition> 2) an implementation specific back-off timer value, if no back-off timer value is received along with the S- NSSAI; </condition> </condition> </control> and <control> <action> c) remove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached </action> <condition> when the timer T3526 associated with the S-NSSAI expires. </condition> </control> </control>
<control> <condition> If the UE receives the NSAG information IE in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the UE shall store the NSAG information as specified in subclause 4.6.2.2. </action> </control>
<control> <condition> <condition> If the UE receives a T3447 value IE in the CONFIGURATION UPDATE COMMAND message </condition> and <condition> has indicated "service gap control supported" in the REGISTRATION REQUEST, </condition> </condition> then <control> <action> the UE shall replace the stored T3447 value with the received value in the T3447 value IE, </action> and <control> <condition> if neither zero nor deactivated use the received T3447 value with the timer T3447 next time it is started. </condition> </control> </control> <control> <condition> If the received T3447 value is zero or deactivated, </condition> then <action> the UE shall stop the timer T3447 if running. </action> </control> </control>
<control> <condition> <condition> If the UE is not in NB-N1 mode, </condition> <condition> the UE has set the RACS bit to "RACS supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </condition> </condition> and the CONFIGURATION UPDATE COMMAND message includes: <control> <condition> a) a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", </condition> <action> the UE shall delete any network-assigned UE radio capability IDs associated with the RPLMN or RSNPN and, </action> <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, </condition> <action> the selected entry of the "list of subscriber data" or the selected PLMN subscription stored at the UE; </action> </control> </control> or <control> <condition> b) a UE radio capability ID IE, </condition> <action> the UE shall store the UE radio capability ID as specified in annex C. </action> </control> </control>
<control> <condition> <condition> If the UE is not currently registered for emergency services </condition> and <condition> the 5GS registration result IE value in the CONFIGURATION UPDATE COMMAND message is set to "Registered for emergency services", </condition> </condition> <action> the UE shall consider itself registered for emergency services </action> and <control> <action> shall locally release all non-emergency PDU sessions, </action> <condition> if any. </condition> </control> </control>
<control> <condition> If the UE receives the service-level-AA container IE of the CONFIGURATION UPDATE COMMAND message, </condition> <action> the UE passes it to the upper layer. </action> </control>
<control> <condition> <condition> If the CONFIGURATION UPDATE COMMAND message includes the service-level-AA response in the Service- level-AA container IE with the SLAR field set to "Service level authentication </condition> and <condition> authorization was not successful or service level authorization is revoked", </condition> </condition> <action> the UE shall forward the service-level-AA response to the upper layers, </action> so the UUAA authorization data is deleted as specified in 3GPP TS 33.256 . </control>
<control> <condition> <condition> If the UE receives the List of PLMNs to be used in disaster condition IE in the CONFIGURATION UPDATE COMMAND message </condition> and <condition> the UE supports MINT </condition> </condition> , <control> <action> the UE shall delete the "list of PLMN(s) to be used in disaster condition" stored in the ME together with the PLMN ID of the RPLMN, </action> <condition> if any, </condition> </control> and <action> may store the "list of PLMN(s) to be used in disaster condition" included in the List of PLMNs to be used in disaster condition IE in the ME together with the PLMN ID of the RPLMN. </action> </control>
<control> <condition> <condition> If the UE receives the Disaster roaming wait range IE in the CONFIGURATION UPDATE COMMAND message </condition> and <condition> the UE supports MINT, </condition> </condition> <control> <action> the UE shall delete the disaster roaming wait range stored in the ME, </action> <condition> if any, </condition> </control> and <action> store the disaster roaming wait range included in the Disaster roaming wait range IE in the ME. </action> </control>
<control> <condition> <condition> If the UE receives the Disaster return wait range IE in the CONFIGURATION UPDATE COMMAND message </condition> and <condition> the UE supports MINT, </condition> </condition> <control> <action> the UE shall delete the disaster roaming wait range stored in the ME, </action> <condition> if any, </condition> </control> and <action> store the disaster roaming wait range included in the Disaster roaming wait range IE in the ME. </action> </control>
<control> <condition> <condition> If the UE receives the Updated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message </condition> and <condition> the UE supports NR paging subgrouping, </condition> </condition> <action> the UE shall use the PEIPS assistance information included in the Updated PEIPS assistance information IE. </action> </control>
<control> <condition> If the UE receives a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit set to "Access identity 1 valid", </condition> <action> the UE shall act as a UE with access identity 1 configured for MPS as described in subclause 4.5.2, </action> in all NG-RAN of the registered PLMN and its equivalent PLMNs or in the case of SNPN, as described in subclause 4.5.2A, in all NG-RAN of the registered SNPN. </control> The MPS indicator bit in the Priority indicator IE provided in the CONFIGURATION UPDATE COMMAND message is valid until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to "Access identity 1 not valid" or the UE receives a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit of the Priority indicator IE set to "Access identity 1 not valid" or until the UE selects a non-equivalent PLMN (or in the case of SNPN, selects another SNPN). Access identity
1 is only applicable while the UE is in N1 mode.
5.4.4.4 Generic UE configuration update completion by the network
<control> <condition> Upon receipt of the CONFIGURATION UPDATE COMPLETE message, </condition> <action> the AMF shall stop the timer T3555. </action> </control>
<control> <condition> If a new 5G-GUTI was included in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the AMF shall consider the new 5G-GUTI as valid </action> and <action> the old 5G-GUTI as invalid. </action> </control>
<control> <condition> If a new TAI list was included in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the AMF shall consider the new TAI list as valid </action> and <action> the old TAI list as invalid. </action> </control>
<control> <condition> If a new truncated 5G-S-TMSI configuration was included in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the AMF shall consider the new truncated 5G-S-TMSI configuration as valid </action> and <action> he old truncated 5G-S-TMSI configuration as invalid. </action> </control>
<control> <condition> If a new service area list was included in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the AMF shall consider the new service area list as valid </action> and <action> the old service area list as invalid. </action> </control>
<control> <condition> If new allowed NSSAI information was included in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the AMF shall consider the new allowed NSSAI information as valid </action> and <action> the old allowed NSSAI information as invalid. </action> </control> <control> <condition> If new configured NSSAI information was included in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the AMF shall consider the new configured NSSAI information as valid </action> and <action> the old configured information as invalid. </action> </control> <control> <condition> If there are active PDU sessions associated with S-NSSAI(s) not included in the new allowed NSSAI, </condition> <action> the AMF shall notify the SMF(s) associated with these PDU sessions to initiate the network-requested PDU session release procedure according to subclause 6.3.3 in the present specification and subclause 5.15.5.2.2 in 3GPP TS 23.501 . </action> </control>
If "registration requested" was indicated in the Registration requested bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message and:
a) the CONFIGURATION UPDATE COMMAND message contained:
1) an allowed NSSAI, a configured NSSAI or both;
2) the Network slicing indication IE with the Network slicing subscription change indication set to "Network slicing subscription changed"; or
3) no other parameters; and
b) no emergency PDU session has been established for the UE; then the AMF shall initiate the release of the N1 NAS signalling connection.
<control> <condition> If a LADN information IE was included in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the AMF shall consider the old LADN information as invalid </action> and <control> <action> the new LADN information as valid, </action> <condition> if any. </condition> </control> </control> <control> In this case, <condition> if the tracking area identity list in the new LADN information does not include the current TA, </condition> <action> the AMF shall indicate UE presence in LADN service area to the SMF (see 3GPP TS 23.501 and 3GPP TS 23.502 ). </action> </control>
<control> <condition> If a T3447 value was included in the CONFIGURATION UPDATE COMMAND message, </condition> <control> <action> the AMF shall consider the T3447 value as valid </action> and <condition> if neither zero nor deactivated use the T3447 value with the timer T3447 next time it is started. </condition> </control> </control> <control> <condition> If the T3447 value included in the CONFIGURATION UPDATE COMMAND message contained an indication that the timer is deactivated or timer value zero, </condition> then <control> <action> the AMF shall stop the timer T3447 </action> <condition> if running. </condition> </control> </control>
<control> <condition> If a CAG information IE was included in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the AMF shall consider the new "CAG information list" as valid </action> and <action> the old "CAG information list" as invalid. </action> </control>
<control> <condition> If a UE radio capability ID IE was included in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the AMF shall consider the new UE radio capability ID as valid </action> and <action> the old UE radio capability ID as invalid. </action> </control>
<control> <condition> If an Updated PEIPS assistance information IE was included in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the AMF shall consider the new PEIPS assistance information as valid </action> and <control> <action> the old PEIPS assistance information, </action> <condition> if any, </condition> as invalid. </control> </control>
5.4.4.5 Abnormal cases in the UE
The following abnormal cases can be identified: <control> <condition> a) Transmission failure of the CONFIGURATION UPDATE COMPLETE message with TAI change from lower layers </condition> <control> <condition> If the current TAI is not in the TAI list, </condition> <action> the generic UE configuration update procedure shall be aborted </action> and <action> a registration procedure for mobility and periodic registration update shall be initiated. </action> </control> <control> <condition> If the current TAI is still part of the TAI list, </condition> <action> it is up to the UE implementation how to re-run the ongoing procedure that triggered the generic UE configuration update procedure. </action> </control> </control> <control> <condition> b) Transmission failure of CONFIGURATION UPDATE COMPLETE message indication without TAI change from lower layers </condition> <action> It is up to the UE implementation how to re-run the ongoing procedure that triggered the generic UE configuration update procedure. </action> </control> <control> <condition> c) Generic UE configuration update and de-registration procedure collision </condition> <control> <condition> <condition> If the UE receives CONFIGURATION UPDATE COMMAND message after sending a DEREGISTRATION REQUEST message </condition> and <condition> the access type included in the DEREGISTRATION REQEUST message is same as the access in which the CONFIGURATION UPDATE COMMAND message is received, </condition> </condition> then <action> the UE shall ignore the CONFIGURATION UPDATE COMMAND message </action> and <action> proceed with the de-registration procedure. </action> </control> <control> <condition> Otherwise, </condition> <action> the UE shall proceed with both the procedures. </action> </control> </control> <control> <condition> d) Void </condition> </control> <control> <condition> e) Generic UE configuration update and service request procedure collision </condition> <control> <condition> <condition> If the SERVICE REQUEST message does not include UE request type IE with Request type value set to "NAS signalling connection release" </condition> and <condition> the UE receives a CONFIGURATION UPDATE COMMAND message before the ongoing service request procedure has been completed, </condition> </condition> <action> the UE shall proceed with both the procedures. </action> </control> <control> <condition> <condition> If the SERVICE REQUEST message includes UE request type IE with Request type value set to "NAS signalling connection release" </condition> and <condition> the UE receives a CONFIGURATION UPDATE COMMAND message before the ongoing service request procedure has been completed, </condition> </condition> <action> the UE shall ignore the CONFIGURATION UPDATE COMMAND message </action> and <action> proceed with the service request procedure. </action> </control> </control> <control> <condition> f) "CAG information list" is received and the UE is operating in SNPN access operation mode </condition> <control> <condition> <condition> If the UE receives the CAG information list IE in the CONFIGURATION UPDATE COMMAND message </condition> and <condition> the UE is operating in SNPN access operation mode, </condition> </condition> <action> the UE shall ignore the content of CAG information list IE. </action> </control> </control>
5.4.4.6 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> <condition> a) Expiry of timer T3555. </condition> The network shall, <condition> on the first expiry of the timer T3555, </condition> </condition> <action> retransmit the CONFIGURATION UPDATE COMMAND message </action> and <action> shall reset and start timer T3555. </action> </control> This retransmission is repeated four times, i.e. on the fifth expiry of timer T3555, the procedure shall be aborted. <control> In addition, <condition> if the CONFIGURATION UPDATE COMMAND message includes the 5G-GUTI IE, </condition> <action> the network shall behave as described in case b)-1) below. </action> </control> <control> <condition> <condition> b) Lower layer failure. </condition> <condition> If a lower layer failure is detected before the CONFIGURATION UPDATE COMPLETE message is received </condition> </condition> </control> and: <control> <condition> 1) if the CONFIGURATION UPDATE COMMAND message includes the 5G-GUTI IE, </condition> <action> the old and the new 5G-GUTI shall be considered as valid </action> until the old 5G-GUTI can be considered as invalid by the AMF. </control> <control> <condition> If a new TAI list was provided in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the old and new TAI list shall also be considered as valid until the old TAI list can be considered as invalid by the AMF. </action> </control> <control> Additionally, <condition> <condition> if the Updated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message includes a new Paging subgroup ID </condition> and <condition> the UE is previously assigned a different Paging subgroup ID </condition> </condition> then, <action> the AMF shall consider both, the old and new Paging subgroup IDs as valid until the old Paging subgroup ID can be considered as invalid by the AMF. </action> </control> During this period the AMF: <control> <action> i) may first use the old 5G-S-TMSI from the old 5G-GUTI and the old Paging subgroup ID, </action> <condition> if any, </condition> <condition> for paging within the area defined by the old TAI list for an implementation dependent number of paging attempts for network originated transactions. </condition> <control> If a <condition> new TAI list was provided in the CONFIGURATION UPDATE COMMAND message, </condition> <action> the new TAI list should also be used for paging. </action> </control> <control> <condition> Upon response from the UE, </condition> <action> the AMF may re-initiate the CONFIGURATION UPDATE COMMAND. </action> </control> <control> <condition> If the Updated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message includes a newPaging subgroup ID, </condition> then <action> the AMF may re-initiate the CONFIGURATION UPDATE COMMAND. </action> </control> <control> <condition> If the response is received from a tracking area within the old and new TAI list, the network shall re-initiate the CONFIGURATION UPDATE COMMAND message. If no response is received to the paging attempts, </condition> <action> the network may use the new 5G-S-TMSI from the new 5G-GUTI and the new Paging subgroup ID, if any, for paging for an implementation dependent number of paging attempts. In this case, if a new TAI list was provided with new 5G-GUTI in the CONFIGURATION UPDATE COMMAND message, </action> <action> the new TAI list shall be used instead of the old TAI list. </action> </control> <control> <condition> Upon response from the UE </condition> <action> the AMF shall consider the new 5G-GUTI and the new PEIPS assistance information as valid </action> and <action> the old 5G-GUTI and the old PEIPS assistance information as invalid. </action> </control> <control> <action> ii) shall consider the new 5G-GUTI as valid </action> <condition> if it is used by the UE </condition> and, additionally, <control> <action> the new TAI list as valid </action> <condition> if it was provided with this 5G-GUTI in the CONFIGURATION UPDATE COMMAND message; </condition> </control> </control> and <control> <action> iii) may use the identification procedure followed by a new generic UE configuration update procedure </action> <condition> if the UE uses the old 5G-GUTI; </condition> </control> or <control> 2) <condition> if the CONFIGURATION UPDATE COMMAND message does not include the 5G-GUTI IE </condition> and: <control> <condition> i) the CONFIGURATION UPDATE COMMAND message does not contain the Allowed NSSAI IE, the Rejected NSSAI IE, the Extended rejected NSSAI IE, or the Updated PEIPS assistance information IE, </condition> <action> the network shall abort the procedure; </action> </control> or <control> <condition> ii) the CONFIGURATION UPDATE COMMAND message contains the Allowed NSSAI IE, the Rejected NSSAI IE, the Extended rejected NSSAI IE, or the Updated PEIPS assistance information IE, </condition> <action> the network shall either abort the procedure or retransmit the CONFIGURATION UPDATE COMMAND message on expiry of the timer T3555. </action> <action> The retransmission shall not be repeated more than four times. </action> <control> <condition> If the retransmission is repeated for four times, </condition> <action> the network shall abort the procedure. </action> </control> </control> </control> </control> <control> <condition> <condition> c) Generic UE configuration update and UE initiated de-registration procedure collision. </condition> <condition> If the network receives a DEREGISTRATION REQUEST message before the ongoing generic UE configuration update procedure has been completed, </condition> </condition> <action> the network shall abort the generic UE configuration update procedure </action> and <action> shall progress the de-registration procedure. </action> </control> <control> <condition> <condition> d) Generic UE configuration update and registration procedure for mobility and periodic registration update collision </condition> <condition> If the network receives a REGISTRATION REQUEST message before the ongoing generic UE configuration update procedure has been completed, </condition> </condition> <action> the network shall abort the generic UE configuration update procedure </action> and <action> shall progress the registration procedure for mobility and periodic registration update procedure. </action> </control> <control> <condition> <condition> e) Generic UE configuration update and service request procedure collision </condition> <condition> If the network receives a SERVICE REQUEST message before the ongoing generic UE configuration update procedure has been completed </condition> and <condition> the SERVICE REQUEST message does not include UE request type IE with Request type value set to "NAS signalling connection release", </condition> </condition> <action> both the procedures shall be progressed. </action> </control>
<control> <condition> <condition> If the network receives a SERVICE REQUEST message before the ongoing generic UE configuration update procedure has been completed </condition> and <condition> the SERVICE REQUEST message includes UE request type IE with Request type value set to "NAS signalling connection release", </condition> </condition> <action> the network shall abort the generic UE configuration update procedure </action> and <action> shall progress the service request procedure. </action> </control>
5.4.5 NAS transport procedure(s)
5.4.5.1 General
The purpose of the NAS transport procedures is to provide a transport of payload between the UE and the AMF. The type of the payload is identified by the Payload container type IE and includes one of the following: a) a single 5GSM message; b) SMS; c) an LPP message (see 3GPP TS 37.355 [26]); d) an SOR transparent container; e) a UE policy container; f) a UE parameters update transparent container; g) a location services message (see 3GPP TS 24.080 ); h) a CIoT user data container; j) multiple payloads.
<control> <condition> For payload type a) to e), g) and h), along with the payload, </condition> <action> the NAS transport procedure may transport the associated information (e.g. PDU session information for 5GSM message payload). </action> </control>
<control> <condition> For payload type j), </condition> <action> the Payload container IE consists a list of payload container entries, </action> <condition> where each of payload container entry contains the payload and optional associated information (e.g. PDU session information for 5GSM message payload). </condition> </control>
NOTE: <control> Payload type can be set to "Multiple payloads" <condition> if there are more than one payloads to be transported using the NAS transport procedures. </condition> </control>
5.4.5.2 UE-initiated NAS transport procedure
5.4.5.2.1 General
The purpose of the UE-initiated NAS transport procedure is to provide a transport of: a) a single 5GSM message as defined in subclause 8.3; b) SMS (see 3GPP TS 24.011 [13]); c) an LPP message; d) an SOR transparent container; e) a UE policy container; or f) a UE parameters update transparent container; g) a location services message; h) a CIoT user data container; j) multiple of the above types.
and: <control> <condition> a) for a) to e), g) and h), </condition> <action> optional associated payload routing information from the UE to the AMF in a 5GMM message; </action> </control> and <control> b) for j), <action> the Payload container IE consists a list of payload container entries, </action> <condition> where each of the payload container entry contains the payload and optional associated payload routing information (e.g. PDU session information for 5GSM message payload). </condition> </control>
5.4.5.2.2 UE-initiated NAS transport procedure initiation
<control> <condition> In the connected mode, </condition> <action> the UE initiates the NAS transport procedure by sending the UL NAS TRANSPORT message to the AMF, as shown in figure 5.4.5.2.2.1. </action> </control>
<control> <condition> In case a) in subclause 5.4.5.2.1, </condition> the UE shall: a) <action> include the PDU session information (PDU session ID, old PDU session ID, S-NSSAI, mapped S-NSSAI (if available in roaming scenarios), DNN, request type), </action> <condition> if available; </condition> b) <action> set the Payload container type IE to "N1 SM information"; </action> and c) <action> set the Payload container IE to the 5GSM message. </action> </control>
<control> <action> The UE shall set the PDU session ID IE to the PDU session ID. </action> <control> <condition> If an old PDU session ID is to be included, </condition> <action> the UE shall set the Old PDU session ID IE to the old PDU session ID. </action> </control> </control>
<control> <condition> If an S-NSSAI is to be included, </condition> <action> the UE shall set the S-NSSAI IE to the S-NSSAI </action> <condition> selected for the PDU session from the allowed NSSAI for the current PLMN or SNPN, associated with the mapped S-NSSAI <condition> (if available in roaming scenarios). </condition> </condition> </control>
<control> <condition> If a DNN is to be included, </condition> <action> the UE shall set the DNN IE to the DNN. </action> </control> <control> 5GSM procedures specified in clause 6 describe conditions for inclusion of the S-NSSAI, mapped S-NSSAI <condition> (if available in roaming scenarios), </condition> and the DNN. </control>
<control> <condition> If a request type is to be included, </condition> <action> the UE shall set the Request type IE to the request type. </action> </control> The request type is not provided along 5GSM messages other than the PDU SESSION ESTABLISHMENT REQUEST message and the PDU SESSION MODIFICATION REQUEST message.
<control> <condition> If an MA PDU session information is to be included, </condition> <action> the UE shall set the MA PDU session information IE to the MA PDU session information. </action> </control> The MA PDU session information is not provided along 5GSM messages other than the PDU SESSION ESTABLISHMENT REQUEST message and the PDU SESSION MODIFICATION REQUEST message as specified in 3GPP TS 24.193 .
<control> <condition> In case b) in subclause 5.4.5.2.1, </condition> the UE shall: a) <action> set the Payload container type IE to "SMS"; </action> and b) <action> set the Payload container IE to the SMS payload. </action> </control>
<control> <condition> Based on the UE preferences regarding access selection for mobile originated (MO) transmission of SMS over NAS as described in 3GPP TS 23.501 : </condition> <control> a) <control> <condition> when SMS over NAS is preferred to be sent over 3GPP access: </condition> <action> the UE attempts to deliver MO SMS over NAS via the 3GPP access </action> <condition> if the UE is registered over both 3GPP access and non-3GPP access. </condition> </control> <control> <condition> If the delivery of SMS over NAS via the 3GPP access is not available, </condition> <action> the UE attempts to deliver MO SMS over NAS via the non- 3GPP access; </action> </control> <condition> when SMS over NAS is preferred to be sent over non-3GPP access: </condition> <action> the UE attempts to deliver MO SMS over NAS via the non-3GPP access </action> <condition> if the UE is registered over both 3GPP access and non-3GPP access. </condition> </control> and b) <control> <condition> If the delivery of SMS over NAS via the non-3GPP access is not available, </condition> <action> the UE attempts to deliver MO SMS over NAS via the 3GPP access. </action> </control> </control>
<control> <condition> In case c) in subclause 5.4.5.2.1, </condition> the UE shall: <action> a) set the Payload container type IE to "LTE Positioning Protocol (LPP) message container"; </action> b) <action> set the Payload container IE to the LPP message payload; </action> and c) <action> set the Additional information IE to the routing information provided by the upper layer location services. </action> </control>
<control> <condition> In case d) in subclause 5.4.5.2.1, </condition> the UE shall: a) <action> set the Payload container type IE to "SOR transparent container"; </action> and b) <action> set the Payload container IE to the UE acknowledgement due to successful reception of steering of roaming information, </action> and <action> set the ME support of SOR-CMCI indicator to "SOR-CMCI supported by the ME" in the Payload container IE carrying the acknowledgement (see 3GPP TS 23.122 ) </action> </control> .
<control> <condition> In case e) in subclause 5.4.5.2.1, </condition> the UE shall: a) <action> set the Payload container type IE to "UE policy container"; </action> and b) <action> set the contents of the Payload container IE as specified in Annex D. </action> </control>
<control> <condition> In case f) in subclause 5.4.5.2.1, </condition> the UE shall: a) <action> set the Payload container type IE to "UE parameters update transparent container"; </action> and b) <action> set the contents of the Payload container IE to the UE acknowledgement due to successful reception of UE parameters update data (see 3GPP TS 23.502 ). </action> </control>
<control> <condition> In case g) in subclause 5.4.5.2.1, </condition> the UE shall: a) <action> set the Payload container type IE to "Location services message container"; </action> b) <action> set the Payload container IE to the Location services message payload; </action> and c) <action> set the Additional information IE to the routing information, </action> <condition> if provided by the upper layer location services </condition> </control>
<control> <condition> In case h) in subclause 5.4.5.2.1, </condition> the UE shall: a) <action> include the PDU session ID, and Release assistance indication </action> <condition> (if available); </condition> b) <action> set the Payload container type IE to "CIoT user data container"; </action> and c) <action> set the Payload container IE to the user data container. </action> </control>
<control> <condition> In case i) in subclause 5.4.5.2.1, </condition> the UE shall: a) <action> set the Payload container type IE to "Service-level-AA container"; </action> and b) <action> set the Payload container IE to the Service-level-AA container. </action> </control>
<control> <condition> In case j) in subclause 5.4.5.2.1, </condition> the UE shall: a) <action> set the Payload container type IE to "Multiple payloads"; </action> and b) set each payload container entry of the Payload container IE (see subclause 9.11.3.39), as follows: <control> i) <action> set the payload container type field of the payload container entry </action> <condition> to a payload container type value set in the Payload container type IE as specified in cases a) to i) above; </condition> </control> <control> ii) <action> set the payload container entry contents field of the payload container entry </action> <condition> to the payload container contents set in the Payload container IE as specified in cases a) to i) above, </condition> </control> and <control> iii) <action> set the optional IE fields, </action> <condition> if any, </condition> to the optional associated payload routing information as specified in cases </control> </control>
5.4.5.2.3 UE-initiated NAS transport of messages accepted by the network
<control> <condition> Upon reception of a UL NAS TRANSPORT message, <condition> if the Payload container type IE is set to: </condition> </condition> </control>
<control> <condition> a) "N1 SM information", the AMF looks up a PDU session routing context for: </condition> </control>
<control> 1) <condition> the UE and the PDU session ID IE in case the Old PDU session ID IE is not included, </condition> and: </control>
NOTE 1: <control> <condition> <condition> If the Old PDU session ID IE is not included in the UL NAS TRANSPORT message </condition> and <condition> the AMF has received a reallocation requested indication from the SMF, </condition> </condition> <action> the AMF needs to ignore the reallocation requested indication. </action> </control>
<control> <condition> i) <condition> if the AMF has a PDU session routing context for the PDU session ID and the UE, </condition> and <condition> the Request type IE is either not included or is included </condition> <condition> but set to other value than "initial request", "existing PDU session", "initial emergency request", "existing emergency PDU session" or "MA PDU request", </condition> </condition> <action> the AMF shall send the 5GSM message, and the PDU session ID IE towards the SMF </action> <condition> identified by the SMF ID of the PDU session routing context; </condition> </control>
<control> ii) <condition> <condition> if the AMF has a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the PDU session routing context indicates that the PDU session is not an emergency PDU session, </condition> <condition> the Request type IE is included and is set to "existing PDU session" or "MA PDU request", </condition> and <condition> the S-NSSAI <condition> ssociated with the PDU session </condition> <condition> identified by the PDU session ID </condition> is allowed for the target access type, </condition> </condition> <action> the AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI, the mapped S-NSSAI (if available in roaming scenarios), the DNN (if received) and the request type towards the SMF </action> <condition> identified by the SMF ID of the PDU session routing context; </condition> </control>
<control> iii) <condition> <condition> if the AMF does not have a PDU session routing context for the PDU session ID and the UE, </condition> and <condition> the Request type IE is included and is set to "initial request" or "MA PDU request" </condition> </condition> </control> :
<control> A) <action> the AMF shall select an SMF with following handlings </action> <condition> in case the UE is not registered for onboarding services in SNPN: </condition> </control>
<control> <condition> If the S-NSSAI IE is not included </condition> and the allowed NSSAI contains: <control> <condition> a) one S-NSSAI, </condition> <action> the AMF shall use the S-NSSAI in the allowed NSSAI as the S-NSSAI; </action> </control> <control> <condition> b) <condition> two or more S-NSSAIs </condition> and <condition> the user's subscription context <condition> obtained from UDM </condition> contains only one default S-NSSAI that is included in the allowed NSSAI, </condition> </condition> <action> the AMF shall use the S-NSSAI in the allowed NSSAI that matches the default S-NSSAI as the S-NSSAI; </action> </control> or <control> <condition> c) <condition> two or more S-NSSAIs and the user's subscription context <condition> obtained from UDM </condition> contains zero, </condition> <condition> two or more default S-NSSAI(s) included in the allowed NSSAI, </condition> </condition> <action> the AMF shall use an S-NSSAI in the allowed NSSAI selected based on operator policy as the S-NSSAI. </action> </control> </control>
<control> <condition> If the DNN IE is included, </condition> <action> the AMF shall use the UE requested DNN as the DNN determined by the AMF; </action> </control> and
<control> <condition> If the DNN IE is not included, </condition> and the user's subscription context obtained from UDM: <control> <condition> a) contains the default DNN for the S-NSSAI, </condition> <action> the AMF shall use the default DNN as the DNN determined by the AMF; </action> </control> and <control> <condition> b) does not contain the default DNN for the S-NSSAI, </condition> <action> the AMF shall use a locally configured DNN as the DNN determined by the AMF; </action> </control> </control>
<control> A1) <action> the AMF shall select an SMF with following handlings </action> <condition> in case the UE is registered for onboarding services in SNPN: </condition> </control> <control> <condition> a) <condition> if the AMF onboarding configuration data does not contain a configured SMF <condition> used for onboarding services in SNPN </condition> </condition> and <condition> contains the S-NSSAI <condition> used for onboarding services in SNPN, </condition> </condition> </condition> <action> the AMF shall use the S-NSSAI used for onboarding services in SNPN as the S-NSSAI; </action> </control> <control> <condition> b) <condition> if the AMF onboarding configuration data does not contain a configured SMF <condition> used for onboarding services </condition> in SNPN and <condition> contains the DNN used for onboarding services in SNPN, </condition> </condition> </condition> <action> the AMF shall use the DNN used for onboarding services in SNPN as the DNN; </action> </control> <control> <condition> c) <condition> if the AMF onboarding configuration data does not contain the S-NSSAI <condition> used for onboarding services in SNPN, </condition> </condition> <condition> does not contain the DNN <condition> used for onboarding services in SNPN, </condition> </condition> and <condition> contains a configured SMF <condition> used for onboarding services in SNPN, </condition> </condition> </condition> <action> the AMF shall select the configured SMF used for onboarding services in SNPN; </action> </control> <control> <condition> d) <condition> if the AMF onboarding configuration data contains the S-NSSAI <condition> used for onboarding services in SNPN, </condition> </condition> <condition> DNN <condition> used for onboarding services in SNPN, </condition> </condition> or <condition> both, </condition> and <condition> contains a configured SMF <condition> used for onboarding services in SNPN, </condition> </condition> </condition> <action> the AMF shall use the S-NSSAI used for onboarding services in SNPN, </action> <condition> if any, </condition> as the S-NSSAI, and <action> use the DNN used for onboarding services in SNPN, </action> <condition> if any, </condition> as the DNN or <action> shall select the configured SMF used for onboarding services in SNPN, according to local policy; </action> </control> and <control> <condition> e) <condition> if the AMF onboarding configuration data <condition> contains none of the S-NSSAI <condition> used for onboarding services in SNPN, </condition> </condition> <condition> the DNN <condition> used for onboarding services in SNPN </condition> </condition> and <condition> a configured SMF used for onboarding services in SNPN, </condition> </condition> </condition> <action> the AMF handling is implementation specific; </action> </control> and
NOTE 2: The AMF can e.g. use a locally configured DNN used for onboarding services in SNPN as the DNN determined by the AMF.
NOTE 3: SMF selection is outside the scope of the present document.
NOTE 4: As part of SMF selection, the PCF can provide the AMF with a DNN selected by the network different from the DNN determined by the AMF.
<control> <condition> b) if the SMF selection is successful: </condition> </control> <control> <condition> a) if the DNN selected by the network is a LADN DNN, </condition> <action> the AMF shall determine the UE presence in LADN service area; </action> </control> <control> b) <action> the AMF shall store a PDU session routing context for the PDU session ID and the UE, </action> <action> shall set the SMF ID in the stored PDU session routing context to the SMF ID </action> <condition> corresponding to the DNN in the user's subscription context obtained from the UDM; </condition> </control> and <control> c) <action> the AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI, the mapped S-NSSAI <condition> (if available in roaming scenarios) </condition> , the DNN determined by the AMF, DNN selected by the network <condition> (if different from DNN determined by the AMF) </condition> , the request type, the MA PDU session information, UE presence in LADN service area <condition> (if DNN received corresponds to an LADN DNN), </condition> and the onboarding indication <condition> (if the UE is registered for onboarding services in SNPN) </condition> towards the SMF identified by the SMF ID of the PDU session routing context; </action> </control>
NOTE 5: <control> <action> The MA PDU session information is not sent towards the SMF </action> <condition> if the DNN received corresponds to an LADN DNN. </condition> </control>
<control> iv) <condition> <condition> if the AMF does not have a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the Request type IE is included and is set to "existing PDU session" or "MA PDU request", </condition> <condition> and the AMF retrieves an SMF ID associated with: <condition> a) the PDU session ID matching the PDU session ID received from the UE, <condition> if any; </condition> </condition> or B) <condition> the DNN matching the DNN received from the UE, <condition> otherwise; </condition> </condition> </condition> <condition> such that the SMF ID includes a PLMN identity corresponding to the UE's HPLMN or the current PLMN, then: </condition> </condition> </control>
<control> A) <action> the AMF shall store a PDU session routing context for the PDU session ID and the UE, </action> <action> shall set the SMF ID in the stored PDU session routing context to the retrieved SMF ID; </action> </control> and <control> B) <action> the AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI, the mapped S-NSSAI <condition> (if available in roaming scenarios), </condition> the DNN <condition> (if received) </condition> and the request type towards the SMF identified by the SMF ID of the PDU session routing context; </action> </control>
<control> v) <condition> <condition> if the AMF does not have a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the Request type IE is included and is set to "initial emergency request", </condition> and <condition> the AMF does not have a PDU session routing context for another PDU session ID of the UE <condition> indicating that the PDU session is an emergency PDU session: </condition> </condition> </condition> </control>
<control> A) <action> the AMF shall select an SMF. </action> <action> The AMF shall use the emergency DNN from the AMF emergency configuration data as the DNN, </action> <condition> if configured. </condition> <action> The AMF shall derive the SMF from the emergency DNN or use the statically configured SMF from the AMF emergency configuration data, </action> <condition> if configured; </condition> </control> and <control> <condition> b) if the SMF selection is successful: </condition> </control> <control> a) <action> the AMF shall store a PDU session routing context for the PDU session ID and the UE, </action> <action> shall set the SMF ID in the stored PDU session routing context to the SMF ID of the selected SMF, </action> and <action> shall store an indication that the PDU session is an emergency PDU session in the stored PDU session routing context; </action> and </control> <control> b) <action> the AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI <condition> (if configured in the AMF emergency configuration data) </condition> , the DNN <condition> (if configured in the AMF emergency configuration data) </condition> , and the request type towards the SMF identified by the SMF ID of the PDU session routing context; </action> </control> and
<control> vi) <condition> <condition> if the AMF does not have a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the Request type IE is included and is set to "initial emergency request", </condition> and <condition> the AMF has a PDU session routing context indicating that the PDU session is an emergency PDU session for another PDU session ID of the UE: </condition> </condition> </control>
<control> A) <action> the AMF shall store a PDU session routing context for the PDU session ID </action> and <action> the UE and shall set the SMF ID in the stored PDU session routing context to the SMF ID of the PDU session routing context for the other PDU session ID of the UE; </action> </control> and <control> B) <action> the AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI <condition> (if configured in the AMF emergency configuration data) </condition> , the DNN <condition> (if configured in the AMF emergency configuration data) </condition> and the request type towards the SMF identified by the SMF ID of the PDU session routing context; </action> </control> or
<control> vii) <condition> <condition> if the AMF has a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the PDU session routing context indicates that the PDU session is an emergency PDU session, </condition> and <condition> the Request type IE is included and is set to "existing emergency PDU session", </condition> </condition> <action> the AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI <condition> (if configured in the AMF emergency configuration data), </condition> the DNN <condition> (if configured in the AMF emergency configuration data), </condition> and the request type towards the SMF identified by the SMF ID of the PDU session routing context; </action> </control> and
<control> viii) <condition> <condition> if the AMF does not have a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the Request type IE is included and is set to "existing emergency PDU session", </condition> and <condition> the AMF retrieves an SMF ID associated with emergency services such that the SMF ID includes a PLMN identity corresponding to the current PLMN, </condition> </condition> then: </control>
<control> A) <action> the AMF shall store a PDU session routing context for the PDU session ID and the UE, </action> <action> shall set the SMF ID in the stored PDU session routing context to the retrieved SMF ID; </action> </control> and <control> B) <action> the AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI <condition> (if configured in the AMF emergency configuration data), </condition> the DNN <condition> (if configured in the AMF emergency configuration data), </condition> and the request type towards the SMF identified by the SMF ID of the PDU session routing context; </action> </control> or
<control> 2) <condition> the UE and the Old PDU session ID IE in case the Old PDU session ID IE is included, </condition> and: </control>
<control> <condition> i) <condition> the AMF has a PDU session routing context for the old PDU session ID </condition> and <condition> the UE and does not have a PDU session routing context for the PDU session ID and the UE </condition> , <condition> the Request type IE is included and is set to "initial request", </condition> and <condition> the AMF received a reallocation requested indication from the SMF <condition> indicating that the SMF is to be reused, </condition> </condition> </condition> <action> the AMF shall store a PDU session routing context for the PDU session ID and the UE, </action> <action> set the SMF ID in the stored PDU session routing context to the SMF ID of the PDU session routing context for the old PDU session ID and the UE. </action> <control> <condition> If the DNN is a LADN DNN, </condition> <action> the AMF shall determine the UE presence in LADN service area. </action> </control> <action> The AMF shall send the 5GSM message, the PDU session ID, the old PDU session ID, the S-NSSAI (if received), the mapped S-NSSAI <condition> (if available in roaming scenarios) </condition> , the DNN, the request type and UE presence in LADN service area <condition> (if DNN received corresponds to an LADN DNN) </condition> towards the SMF identified by the SMF ID of the PDU session routing context; </action> </control>
<control> ii) <condition> <condition> the AMF has a PDU session routing context for the old PDU session ID </condition> and <condition> the UE and does not have a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the Request type IE is included and is set to "initial request", </condition> and <condition> the AMF received a reallocation requested indication from the SMF <condition> indicating that the SMF is to be reallocated: </condition> </condition> </condition> </control>
<control> A) <action> the AMF shall select an SMF with the following handling; </action> </control>
<control> <condition> If the S-NSSAI IE is not included </condition> and the allowed NSSAI contains: <control> <condition> a) one S-NSSAI, </condition> <action> the AMF shall use the S-NSSAI in the allowed NSSAI as the S-NSSAI; </action> </control> <control> <condition> b) two or more S-NSSAIs and the user's subscription context obtained from UDM <condition> contains only one default S-NSSAI that is included in the allowed NSSAI, </condition> </condition> <action> the AMF shall use the S-NSSAI in the allowed NSSAI that matches the default S-NSSAI; </action> </control> or <control> <condition> c) <condition> two or more S-NSSAIs and the user's subscription context obtained from UDM contains zero, </condition> <condition> two or more default S-NSSAI(s) included in the allowed NSSAI, </condition> </condition> <action> the AMF shall use an S-NSSAI in the allowed NSSAI selected based on operator policy as the S-NSSAI. </action> </control> </control>
<control> <condition> If the DNN is a LADN DNN, </condition> <action> the AMF shall determine the UE presence in LADN service area. </action> </control>
<control> <condition> b) if the SMF selection is successful: </condition> </control> <control> a) <action> the AMF shall store a PDU session routing context for the PDU session ID and the UE </action> and <action> set the SMF ID of the PDU session routing context to the SMF ID of the selected SMF; </action> </control> and <control> b) <action> the AMF shall send the 5GSM message, the PDU session ID, the old PDU session ID, the S- NSSAI, the mapped S-NSSAI <condition> (if available in roaming scenarios) </condition> , the DNN, the request type, the MA PDU session information and UE presence in LADN service area <condition> (if DNN received corresponds to an LADN DNN) </condition> towards the SMF identified by the SMF ID of the PDU session routing context for the PDU session ID and the UE; </action> </control>
NOTE 6: <control> <action> The MA PDU session information is not sent towards the SMF </action> <condition> if the DNN received corresponds to an LADN DNN. </condition> </control>
<control> <condition> b) "SMS", </condition> <action> the AMF shall send the content of the Payload container IE to the SMSF associated with the UE; </action> </control>
<control> <condition> c) "LTE Positioning Protocol (LPP) message container", </condition> <action> the AMF shall send the Payload container type and the content of the Payload container IE to the LMF </action> <condition> associated with the routing information <condition> included in the Additional information IE of the UL NAS TRANSPORT message; </condition> </condition> </control>
<control> <condition> d) "SOR transparent container", </condition> <action> the AMF shall send the content of the Payload container IE to the UDM (see 3GPP TS 29.503 ); </action> </control>
<control> <condition> e) "UE policy container", </condition> <action> the AMF shall send the content of the Payload container IE to the PCF. </action> </control>
<control> <condition> f) "UE parameters update transparent container", </condition> <action> the AMF shall send the content of the Payload container IE to the UDM. </action> </control>
<control> <condition> g) "Location services message container": </condition> </control>
<control> 1) <condition> if the Additional information IE is not included in the UL NAS TRANSPORT message, </condition> <action> the AMF shall provide the Payload container type and the content of the Payload container IE to the location services application; </action> </control> and
<control> 2) <condition> if the Additional information IE is included in the UL NAS TRANSPORT message, </condition> <action> the AMF shall send the Payload container type and the content of the Payload container IE to an LMF </action> <condition> associated with routing information <condition> included in the Additional information IE of the UL NAS TRANSPORT message. </condition> </condition> </control>
<control> <condition> h) "CIoT user data container", </condition> </control> <control> <action> the AMF shall look up a PDU session routing context for the UE and the PDU session ID, </action> and 1) <action> send the content of the Payload container IE towards the SMF <condition> identified by the SMF ID of the PDU session routing context </condition> ; </action> and 2) <action> initiate the release of the N1 NAS signalling connection: </action> </control>
<control> <condition> i) <condition> if the Release assistance indication IE is included in the UL NAS TRANSPORT message </condition> and <condition> the DDX field of the Release assistance indication IE indicates "No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected" </condition> and <condition> if there is no downlink signalling or downlink data for the UE; </condition> </condition> </control> or
<control> ii) <condition> upon subsequent delivery of the next received downlink data transmission to the UE <condition> if the Release assistance indication IE is included in the UL NAS TRANSPORT message </condition> and <condition> the DDX field of the Release assistance indication IE indicates "Only a single downlink data transmission and no further uplink data transmission subsequent to the uplink data transmission is expected" </condition> and <condition> if there is no additional downlink signalling or downlink data for the UE. </condition> </condition> </control>
<control> <condition> i) <condition> "Service-level-AA container" and the Service-level-AA container is included in the Payload container IE of the UL NAS TRANSPORT message, </condition> and <condition> the Service-level device ID <condition> included in the Service-level-AA container </condition> is set to a CAA-level UAV ID, </condition> </condition> <action> the AMF shall send the content of the Payload container IE to the UAS-NF corresponding to the CAA-level UAV ID. </action> <control> <condition> <condition> If the Service-level device ID is not included in the Service-level-AA container </condition> and <condition> a CAA-level UAV ID is included in the 5GMM context of the UE, </condition> </condition> <action> then the AMF shall send the content of the Payload container IE to the UAS-NF corresponding to the CAA-level UAV ID included in the 5GMM context of the UE. </action> </control> </control>
<control> <condition> j) "Multiple payloads", </condition> <action> the AMF shall first decode the content of the Payload container IE (see subclause 9.11.3.39) </action> <condition> to obtain the number of payload container entries and for each payload container entry, </condition> the AMF shall: i) <action> decode the payload container type field; </action> ii) <action> decode the optional IE fields and the payload container contents field in the payload container entry; </action> and iii) <action> handle the content of each payload container entry the same as the content of the Payload container IE and the associated optional IEs as specified in bullets a) to i) above according to the payload container type field. </action> </control>
5.4.5.2.4 UE-initiated NAS transport of messages not accepted by the network
<control> <condition> Upon reception of an UL NAS TRANSPORT message, <condition> <condition> if the Payload container type IE is set to "N1 SM information" </condition> and <condition> the UE is not configured for high priority access in selected PLMN, </condition> </condition> </condition> and: </control>
<control> <condition> a) if the Request type IE is set to "initial request", "existing PDU session" or "MA PDU request" </condition> </control> ;
<control> 1) <action> DNN based congestion control is activated </action> for the DNN <condition> included in the UL NAS TRANSPORT message, </condition> or <action> DNN based congestion control is activated </action> for the selected DNN <condition> in case of no DNN included in the UL NAS TRANSPORT message, </condition> e.g. configured by operation and maintenance, <action> the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #22 "congestion" as specified in subclause 5.4.5.3.1 case f); </action> </control>
<control> 2) <action> S-NSSAI and DNN based congestion control is activated for the S-NSSAI and DNN </action> <condition> included in the UL NAS TRANSPORT message, </condition> or <action> S-NSSAI and DNN based congestion control is activated for the S-NSSAI </action> <condition> included in the UL NAS TRANSPORT message and the selected DNN in case of no DNN included in the UL NAS TRANSPORT message, </condition> or <action> S-NSSAI and DNN based congestion control is activated for the selected S-NSSAI </action> <condition> <condition> in case of no S-NSSAI included in the UL NAS TRANSPORT message </condition> and <condition> the DNN included in the UL NAS TRANSPORT message, </condition> </condition> or <action> S-NSSAI and DNN based congestion control is activated for the selected S-NSSAI and the selected DNN </action> <condition> in case of no S-NSSAI and no DNN included in the UL NAS TRANSPORT message, e.g. configured by operation and maintenance, </condition> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #67 "insufficient resources for specific slice and DNN" as specified in subclause 5.4.5.3.1 case f); </action> </control>
<control> 3) <action> S-NSSAI only based congestion control is activated for the S-NSSAI </action> <condition> included in the UL NAS TRANSPORT message, </condition> or <action> S-NSSAI based congestion control is activated for the selected S-NSSAI </action> <condition> in case of no S-NSSAI included in the UL NAS TRANSPORT message, e.g. configured by operation and maintenance, </condition> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #69 "insufficient resources for specific slice" as specified in subclause 5.4.5.3.1 case f); </action> </control>
<control> <condition> c) <condition> if the Request type IE is set to "modification request" </condition> and <condition> the PDU session is not an emergency PDU session; </condition> </condition> </control>
<control> 1) <action> DNN based congestion control is activated for the stored DNN, e.g. configured by operation and maintenance, </action> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #22 "congestion" as specified in subclause 5.4.5.3.1 case f); </action> </control>
<control> 2) <action> S-NSSAI and DNN based congestion control is activated for the stored S-NSSAI and DNN, e.g. configured by operation and maintenance, </action> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #67 "insufficient resources for specific slice and DNN" as specified in subclause 5.4.5.3.1 case f); </action> </control>
<control> 3) <action> S-NSSAI only based congestion control is activated for the stored S-NSSAI, e.g. configured by operation and maintenance, </action> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #69 "insufficient resources for specific slice" as specified in subclause 5.4.5.3.1 case f); </action> </control> or
<control> <condition> d) <condition> the timer T3447 is running </condition> and <condition> the UE does not support service gap control: </condition> </condition> </control>
<control> 1) <condition> the Request type IE: i) <condition> is set to "initial request"; </condition> ii) <condition> is set to "existing PDU session"; or </condition> iii) <condition> is set to "modification request" and the PDU session being modified is a non-emergency PDU session; </condition> </condition> </control>
<control> 2) <condition> the current NAS signalling connection was not triggered by paging; </condition> and </control>
<control> 3) <condition> <condition> mobile terminated signalling has not been sent </condition> or <condition> no user-plane resources have been established for any PDU session <condition> after the establishment of the current NAS signalling connection, </condition> </condition> </condition> </control>
<control> <action> the AMF shall send back to the UE the message </action> which was not forwarded, <action> send the 5GMM cause #22 "Congestion", </action> and <action> may include a back-off timer </action> set to the remaining time of the timer T3447 as specified in subclause 5.4.5.3.1 case f). </control>
<control> <condition> Upon reception of a UL NAS TRANSPORT message, <condition> if the Payload container type IE is set to "N1 SM information", </condition> <condition> the Request type IE is set to "initial request", "existing PDU session" or "MA PDU request", </condition> and <condition> the AMF determines that the PLMN's maximum number of PDU sessions has already been reached for the UE, </condition> </condition> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded and 5GMM cause #65 "maximum number of PDU sessions reached" as specified in subclause 5.4.5.3.1 case h). </action> </control>
<control> <condition> Upon reception of a UL NAS TRANSPORT message, <condition> if the Payload container type IE is set to "N1 SM information", </condition> <condition> the Request type IE is set to "initial request", "existing PDU session" or "MA PDU request", </condition> and <condition> the AMF determines that the PLMN's maximum number of PDU sessions has already been reached for the UE, </condition> </condition> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded and 5GMM cause #65 "maximum number of PDU sessions reached" as specified in subclause 5.4.5.3.1 case h). </action> </control>
<control> <condition> Upon reception of a UL NAS TRANSPORT message, <condition> if the Payload container type IE is set to "N1 SM information", </condition> </condition> <action> the Request type IE is set to "initial request", </action> and </control>
<control> <condition> a) the UE is in NB-N1 mode; </condition> </control>
<control> <condition> b) the UE has indicated preference for user plane CIoT 5GS optimization; </condition> </control>
<control> <condition> c) the network accepted the use of user plane CIoT 5GS optimization; and </condition> </control>
<control> <condition> d) the AMF determines that there are user-plane resources established for a number of PDU sessions <condition> that is equal to the UE' s maximum number of supported user-plane resources (see 3GPP TS 23.501 ), </condition> </condition> the AMF shall either: </control>
<control> a) <action> send back to the UE the message which was not forwarded as specified in in subclause 5.4.5.3.1 case h1); </action> </control> or
<control> b) <action> proceed with the PDU session establishment </action> and <action> include the Control Plane CIoT 5GS Optimisation indication or Control Plane Only indicator to the SMF. </action> </control>
<control> <condition> Upon reception of an UL NAS TRANSPORT message, <condition> if the Payload container type IE is set to "CIoT user data container", </condition> </condition> <action> the UE is not configured for high priority access in selected PLMN, </action> and </control> :
<control> <condition> a) the timer T3447 is running and the UE does not support service gap control; </condition> </control>
<control> <condition> b) the current NAS signalling connection was not triggered by paging; </condition> and </control>
<control> <condition> c) mobile terminated signalling has not been sent or no user-plane resources have been established for any PDU session <condition> after the establishment of the current NAS signalling connection; </condition> </condition> </control> <control> <action> the AMF shall send back to the UE the CIoT user data which was not forwarded, </action> <action> send the 5GMM cause #22 "Congestion", </action> and <action> include a back-off timer set to the remaining time of the timer T3447 as specified in subclause 5.4.5.3.1 case l2). </action> </control>
<control> <condition> <condition> Upon reception of a UL NAS TRANSPORT message, <condition> if the Payload container type IE is set to "N1 SM information", the Request type IE is set to "existing PDU session", </condition> </condition> </condition> and </control>
<control> <condition> a) the UE is in NB-N1 mode; </condition> </control>
<control> <condition> b) the UE has indicated preference for user plane CIoT 5GS optimization; </condition> </control>
<control> <condition> c) the network accepted the use of user plane CIoT 5GS optimization; </condition> and </control>
<control> <condition> d) the AMF determines that there are user-plane resources established for a number of PDU sessions that <condition> equals to the UE's maximum number of supported user-plane resources (see 3GPP TS 23.501 ), </condition> </condition> </control> <control> <action> the AMF shall send back to the UE the message which was not forwarded as specified in in subclause 5.4.5.3.1 case h1). </action> </control>
<control> <condition> Upon reception of an UL NAS TRANSPORT message, <condition> if the Payload container type IE is set to "N1 SM information", </condition> <condition> the Request type IE is set to "initial request" or "modification request", </condition> <condition> the associated S-NSSAI <condition> that the AMF determined through the S-NSSAI IE or the PDU session ID IE </condition> is an S-NSSAI <condition> for which the AMF is performing NSSAA, </condition> </condition> and <condition> the AMF determines to not forward the 5GSM message to the SMF based on local policy, </condition> </condition> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case h2). </action> </control>
<control> <condition> Upon reception of an UL NAS TRANSPORT message, <condition> if the Payload container type IE is set to "SMS" or "LTE Positioning Protocol (LPP) message container", </condition> <condition> the UE is not configured for high priority access in selected PLMN, </condition> and: <condition> </condition> </condition> </control>
<control> <condition> a) the timer T3447 is running and the UE does not support service gap control; </condition> </control>
<control> <condition> b) the current NAS signalling connection was not triggered by paging; and </condition> </control>
<control> <condition> c) mobile terminated signalling has not been sent or no user-plane resources have been established for any PDU session <condition> after the establishment of the current NAS signalling connection; </condition> </condition> </control> <control> <action> the AMF shall abort the procedure. </action> </control>
<control> <condition> Upon reception of an UL NAS TRANSPORT message, <condition> if the Payload container type IE is set to "N1 SM information", </condition> <condition> the Request type IE is set to "initial request" or "modification request", </condition> <condition> the associated S-NSSAI <condition> that the AMF determined through the S-NSSAI IE or the PDU session ID IE </condition> is an S-NSSAI <condition> for which the AMF is performing NSSAA, </condition> </condition> and <condition> the AMF determines to not forward the 5GSM message to the SMF based on local policy, </condition> </condition> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case h2). </action> </control>
<control> <condition> Upon reception of an UL NAS TRANSPORT message, <condition> if the Payload container type IE is set to "SMS" or "LTE Positioning Protocol (LPP) message container", </condition> <condition> the UE is not configured for high priority access in selected PLMN, </condition> </condition> </control> and: <control> <condition> a) the timer T3447 is running and the UE does not support service gap control; </condition> </control> <control> <condition> b) the current NAS signalling connection was not triggered by paging; and </condition> </control> <control> <condition> c) mobile terminated signalling has not been sent or no user-plane resources have been established for any PDU session <condition> after the establishment of the current NAS signalling connection; </condition> </condition> </control> <control> <action> the AMF shall abort the procedure. </action> </control>
NOTE 1: In this state the NAS signalling connection can be released by the network.
<control> <condition> Upon reception of an UL NAS TRANSPORT message, <condition> if the Payload container type IE is set to "N1 SM information", </condition> <condition> the Request type IE is set to "initial request", </condition> </condition> </control> and: <control> <condition> a) the determined DNN, S-NSSAI or both DNN and S-NSSAI are identified for UAS services; </condition> </control> and <control> <condition> b) the UE is marked in the UE's 5GMM context <condition> that it is not allowed to request UAS services; </condition> </condition> </control> <control> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case h4). </action> </control>
NOTE 2: <control> <condition> The UE marked in the UE's 5GMM context </condition> as <action> not allowed to request UAS services happens </action> <condition> in the case that the UUAA-MM procedure needs to be performed <condition> during the registration procedure according to operator policy. </condition> </condition> </control>
5.4.5.2.5 Abnormal cases on the network side
The following abnormal cases in AMF are identified:
<control> <condition> a) If the Payload container type IE is set to "N1 SM information" </condition> and: </control>
<control> 1) <condition> <condition> if the Old PDU session ID IE is not included in the UL NAS TRANSPORT message, </condition> <condition> the AMF does not have a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the Request type IE is set to "initial request" or "MA PDU request", </condition> and <condition> the SMF selection fails, </condition> </condition> then <action> the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f); </action> </control>
<control> 2) <condition> <condition> if the Old PDU session ID IE is included in the UL NAS TRANSPORT message, </condition> <condition> the AMF has a PDU session routing context for the old PDU session ID </condition> and <condition> the UE and does not have a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the Request type IE is set to "initial request", </condition> <condition> the AMF received a reallocation requested indication from the SMF <condition> indicating that the SMF is to be reallocated, </condition> </condition> and <condition> the SMF selection fails, </condition> </condition> then <action> the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f); </action> </control>
<control> 3) <condition> <condition> if the AMF does not have a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the Request type IE is set to "existing PDU session" or "MA PDU request", </condition> and <condition> the user's subscription context <condition> obtained from the UDM </condition> does not contain an SMF ID for the PDU session ID <condition> matching the PDU session ID received from the UE </condition> or for the DNN <condition> matching the DNN received from the UE </condition> <condition> such that the SMF ID includes a PLMN identity <condition> corresponding to the UE's HPLMN or the current PLMN or the PLMN ID part of the current SNPN, </condition> </condition> </condition> </condition> <action> then the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f). </action> </control>
<control> 4) <condition> <condition> if the Old PDU session ID IE is included in the UL NAS TRANSPORT message, </condition> and <condition> <condition> the AMF has a PDU session routing context for the old PDU session ID </condition> and <condition> the UE and does not have a PDU session routing context for the PDU session ID and the UE, </condition> </condition> <condition> <condition> the Request type IE is set to "initial request" </condition> and <condition> the AMF has not received a reallocation requested indication, </condition> </condition> </condition> the AMF should select an SMF with following handlings: </control>
<control> <condition> i) if the S-NSSAI IE is not included and the allowed NSSAI contains: </condition> </control>
<control> <condition> a) one S-NSSAI, </condition> <action> the AMF shall use the S-NSSAI in the allowed NSSAI as the S-NSSAI; </action> </control> <control> <condition> b) <condition> two or more S-NSSAIs </condition> and <condition> the user's subscription context obtained from UDM <condition> contains only one default S-NSSAI that is included in the allowed NSSAI, </condition> </condition> </condition> <action> the AMF shall use the S-NSSAI in the allowed NSSAI as the S-NSSAI; </action> </control> <control> or C) <condition> <condition> two or more S-NSSAIs and the user's subscription context obtained from UDM <condition> contains zero, </condition> <condition> two or more default S-NSSAI(s) included in the allowed NSSAI, </condition> </condition> </condition> <action> the AMF shall use an S-NSSAI in the allowed NSSAI selected based on operator policy as the S-NSSAI; </action> </control>
<control> ii) <condition> if the DNN IE is not included, and the user's subscription context obtained from UDM: </condition> </control>
<control> <condition> a) contains the default DNN for the S-NSSAI, </condition> <action> the AMF shall use the default DNN as the DNN; </action> </control> and <control> <condition> b) does not contain the default DNN for the S-NSSAI, </condition> <action> the AMF shall use a locally configured DNN as the DNN; </action> </control>
<control> iii) <condition> if the DNN selected by the network is a LADN DNN, </condition> <action> the AMF shall determine the UE presence in LADN service area; </action> </control>
<control> iv) <condition> if the SMF selection is successful, </condition> <action> the AMF should store a PDU session routing context for the PDU session ID and the UE, </action> <action> set the SMF ID in the stored PDU session routing context to the selected SMF ID, </action> and <action> forward the 5GSM message, the PDU session ID, the old PDU session ID, the S-NSSAI, the mapped S-NSSAI </action> <condition> (if available in roaming scenarios), </condition> <action> the DNN determined by the AMF, DNN selected by the network </action> <condition> (if different from DNN determined by the AMF), </condition> <action> the request type and UE presence in LADN service area </action> <condition> (if DNN selected by the network corresponds to an LADN DNN) </condition> towards the SMF ID of the PDU session routing context; </control> and
<control> v) <condition> if the SMF selection fails, </condition> <action> then the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f); </action> </control>
<control> 5) if the AMF has a PDU session routing context for the PDU session ID and the UE, the PDU session routing context indicates that the PDU session is an emergency PDU session, the Request type IE is set to "initial emergency request", <action> the AMF should forward the 5GSM message, the PDU session ID, the S-NSSAI </action> <condition> (if configured in the AMF emergency configuration data), </condition> <action> the DNN </action> <condition> (if configured in the AMF emergency configuration data) </condition> and <action> the request type towards the SMF ID of the PDU session routing context; </action> </control>
<control> 6) <condition> <condition> if the Request type IE is set to "initial emergency request" </condition> and <condition> the S-NSSAI or the DNN is received, </condition> </condition> <action> the AMF ignores the received S-NSSAI or the DNN </action> and <action> uses the emergency DNN from the AMF emergency configuration data, </action> <condition> if any; </condition> </control>
<control> 7) <condition> <condition> if the AMF does not have a PDU session routing context for the PDU session ID and the UE, </condition> and <condition> <condition> the Request type IE of the UL NAS TRANSPORT message is either not provided </condition> or <condition> is provided <condition> but set to other value than "initial request", "existing PDU session", "initial emergency request", "existing emergency PDU session" and "MA PDU request", </condition> </condition> </condition> </condition> <action> then the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f); </action> </control>
<control> 8) <condition> if the AMF unsuccessfully attempted to forward the 5GSM message, the PDU session ID, the S-NSSAI, the mapped S-NSSAI <condition> (if available in roaming scenarios), </condition> the DNN and the request type <condition> (if received) </condition> towards a SMF ID, </condition> <action> then the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f). </action> </control>
<control> 9) <condition> <condition> if the Old PDU session ID IE is included in the UL NAS TRANSPORT message, </condition> <condition> the AMF does not have a PDU session routing context for the old PDU session ID and the UE, </condition> <condition> the AMF does not have a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the Request type IE is set to "initial request", </condition> </condition> the AMF should select an SMF with following handlings: </control>
<control> <condition> i) if the S-NSSAI IE is not included and the allowed NSSAI contains: </condition> </control>
<control> <condition> a) one S-NSSAI, </condition> <action> the AMF shall use the S-NSSAI in the allowed NSSAI as the S-NSSAI; </action> </control> <control> <condition> b) two or more S-NSSAIs and <condition> the user's subscription context obtained from UDM <condition> contains only one default S-NSSAI that is included in the allowed NSSAI, </condition> </condition> </condition> <action> the AMF shall use the default S-NSSAI in the allowed NSSAI as the S-NSSAI; </action> </control> or <control> <condition> c) two or more S-NSSAIs and the user's subscription context obtained from UDM contains zero, </condition> <condition> two or more default S-NSSAI(s) included in the allowed NSSAI, </condition> <action> the AMF shall use an S-NSSAI in the allowed NSSAI selected based on operator policy as the S-NSSAI. </action> </control>
<control> ii) <condition> if the DNN IE is not included, and the user's subscription context obtained from UDM: </condition> </control>
<control> <condition> a) contains the default DNN for the S-NSSAI, </condition> <action> the AMF shall use the default DNN as the DNN; </action> </control> and <control> <condition> b) does not contain the default DNN for the S-NSSAI, </condition> <action> the AMF shall use a locally configured DNN as the DNN; </action> </control>
<control> iii) <condition> if the DNN selected by the network is a LADN DNN, </condition> <action> the AMF shall determine the UE presence in LADN service area; </action> </control>
<control> iv) <condition> if the SMF selection is successful, </condition> <action> the AMF should store a PDU session routing context for the PDU session ID and the UE, </action> <action> set the SMF ID in the stored PDU session routing context to the selected SMF ID, </action> and <action> forward the 5GSM message, the PDU session ID, the old PDU session ID, the S-NSSAI, the mapped S-NSSAI </action> <condition> (if available in roaming scenarios), </condition> <action> the DNN determined by the AMF, DNN selected by the network </action> <condition> (if different from DNN determined by the AMF), </condition> <action> the request type and UE presence in LADN service area </action> <condition> (if DNN selected by the network corresponds to an LADN DNN) </condition> towards the SMF ID of the PDU session routing context; </control> and
<control> v) <condition> if the SMF selection fails, </condition> then <action> the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f); </action> </control>
<control> 10) <condition> <condition> if the AMF has a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the PDU session routing context indicates that the PDU session is not an emergency PDU session, </condition> and <condition> the Request type IE is included and is set to "existing emergency PDU session", </condition> </condition> <action> the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f); </action> </control>
<control> 11) <condition> <condition> if the AMF has a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the PDU session routing context indicates that the PDU session is an emergency PDU session, </condition> and <condition> the Request type IE is included and is set to "existing PDU session", </condition> </condition> <action> the AMF may forward the 5GSM message, the PDU session ID, the S- NSSAI </action> <condition> (if configured in the AMF emergency configuration data), </condition> <action> the DNN </action> <condition> (if configured in the AMF emergency configuration data), </condition> and <action> the request type towards the SMF identified by the SMF ID of the PDU session routing context; </action> </control>
<control> 12) <condition> <condition> if the AMF has a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the Request type IE is set to "initial request", </condition> </condition> <action> then the AMF shall perform a local release of the PDU session identified by the PDU session ID </action> and <action> shall request the SMF to perform a local release of the PDU session, and proceed as specified in subclause 5.4.5.2.3; </action> </control>
<control> 13) <condition> <condition> if the Request type IE is set to "initial request" or "modification request", </condition> and <condition> the S-NSSAI IE contains an S- NSSAI <condition> that is not allowed by the network, </condition> </condition> </condition> <action> then the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e), case f) or h4); </action> </control>
<control> 14) <condition> <condition> if the Request type IE is set to "existing PDU session", </condition> <condition> the AMF has a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the PDU session routing context indicates that the PDU session is not an emergency PDU session, </condition> and <condition> the S-NSSAI associated with the PDU session <condition> identified by the PDU session ID </condition> is not allowed for the target access type, </condition> </condition> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e), case f) or h4); </action> </control>
<control> 15) <condition> <condition> if the Request type IE is set to "initial request", "existing PDU session", "modification request" or "MA PDU request", </condition> <condition> the UE is not configured for high priority access in selected PLMN, </condition> and <condition> the UE is in non-allowed area or is not in allowed area, </condition> </condition> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded, and 5GMM cause #28 "Restricted service area" as specified in subclause 5.4.5.3.1 case i); </action> </control>
<control> <condition> 15a) <condition> if the Request type IE is set to "initial request" or "initial emergency request" </condition> and <condition> the AMF determines that the UE has registered to a PLMN <condition> via a satellite NG-RAN cell </condition> that is <condition> not allowed to operate at the present UE location, </condition> </condition> </condition> <action> then the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case i1); and </action> </control>
<control> 16) <condition> <condition> if the Request type IE is set to "initial request" or "MA PDU request", </condition> <condition> the AMF is pending the receipt of a REGISTRATION REQUEST message <condition> indicating "mobility registration updating" in the 5GS registration type IE, </condition> </condition> and <condition> an emergency PDU session exists for the UE (see subclause 5.4.4.3), </condition> </condition> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f); </action> </control>
<control> 17) <condition> <condition> if the timer T3447 is running and the UE supports service gap control </condition> and: <condition> </condition> </condition> </control>
<control> <condition> i) the Request type IE: <condition> a) is set to "initial request"; </condition> B) <condition> is set to "existing PDU session"; </condition> or C) <condition> is set to "modification request" and the PDU session being modified is a non-emergency PDU session; </condition> </condition> </control>
<control> ii) <condition> the UE is not configured for high priority access in selected PLMN; </condition> </control>
<control> iii) <condition> the current NAS signalling connection was not triggered by paging; </condition> and </control>
<control> iv) <condition> mobile terminated signalling has not been sent or no user-plane resources have been established for any PDU session <condition> after the establishment of the current NAS signalling connection, </condition> </condition> </control>
<control> <action> then the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f); </action> </control>
<control> 18) <condition> <condition> if the AMF has a PDU session routing context for the PDU session ID and the UE, </condition> <condition> the Request type IE is not included, </condition> <condition> the UE is not configured for high priority access in selected PLMN, </condition> and <condition> the PDU session is not an emergency PDU session, </condition> </condition> <action> then the AMF shall forward the 5GSM message, and the PDU session ID IE towards the SMF identified by the SMF ID of the PDU session routing context with: </action> </control>
<control> <condition> i) an exemptionInd attribute <condition> indicating "message was exempted from the DNN based congestion activated in the AMF" as specified in 3GPP TS 29.502 , </condition> <condition> if DNN based congestion control is activated for the selected DNN; </condition> </condition> </control>
<control> ii) <condition> an exemptionInd attribute <condition> indicating "message was exempted from the S-NSSAI and DNN based congestion activated in the AMF" as specified in 3GPP TS 29.502 , </condition> <condition> if S-NSSAI and DNN based congestion control is activated for the selected S-NSSAI and the selected DNN; </condition> </condition> </control> or
<control> iii) <condition> an exemptionInd attribute <condition> indicating "message was exempted from the S-NSSAI only based congestion activated in the AMF" as specified in 3GPP TS 29.502 , </condition> <condition> if S-NSSAI only based congestion control is activated for the selected S-NSSAI; </condition> </condition> </control>
<control> 19) <condition> <condition> if the Request type IE is set to "MA PDU request" </condition> and <condition> the S-NSSAI IE contains an S-NSSAI <condition> that is not allowed by the network on neither access, </condition> </condition> </condition> <action> then the AMF shall send to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f); </action> </control>
<control> 20) <condition> <condition> if the Request type IE is set to "initial request" </condition> and <condition> the UE is registered for emergency services over the current access, </condition> </condition> <action> then the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e) or case f); </action> </control> and
<control> 21) <condition> <condition> if the Request type IE is set to "existing PDU session", </condition> <condition> the UE is attempting to transfer a PDU session from 3GPP access to non-3GPP access, </condition> and <condition> the PDU session is associated with control plane only indication </condition> </condition> <action> then the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case e). </action> </control>
<control> 22) <condition> <condition> if the Request type IE is set to "MA PDU request" </condition> and <condition> the UE requested DNN corresponds to an LADN DNN, </condition> </condition> <action> the AMF shall send back to the UE the 5GSM message which was not forwarded and 5GMM cause #90 "payload was not forwarded" as specified in subclause 5.4.5.3.1 case hx). </action> </control>
<control> 23) <condition> <condition> if the Request type IE is set to "initial request", </condition> <condition> the UE requested DNN corresponds to an LADN DNN, </condition> and <condition> the MA PDU session information IE is included, </condition> </condition> <action> the AMF shall not forward the MA PDU session information towards the SMF. </action> </control>
<control> 24) <condition> <condition> if the Request type IE is set to "modification request", </condition> <condition> the DNN associated with the PDU session corresponds to an LADN DNN, </condition> and <condition> MA PDU session information IE is included, </condition> </condition> <action> the AMF shall not forward the MA PDU session information towards the SMF. </action> </control>
<control> <condition> b) <condition> If the Payload container type IE is set to "SMS" </condition> and <condition> the AMF does not have an SMSF address associated with the UE </condition> or <condition> the AMF cannot forward the content of the Payload container IE to the SMSF <condition> associated with the SMSF address available in the AMF, </condition> </condition> </condition> <action> the AMF shall abort the procedure. </action> </control>
<control> <condition> c) <condition> If the Payload container type IE is set to "LTE Positioning Protocol (LPP) message container" </condition> and <condition> if the Additional information IE is not included in the UL NAS TRANSPORT message </condition> or <condition> the AMF cannot forward the content of the Payload container IE to the LMF <condition> associated with the routing information included in the Additional information IE, </condition> </condition> </condition> <action> the AMF shall abort the procedure. </action> </control>
<control> <condition> d) <condition> If the Payload container type IE is set to "UE policy container" </condition> and <condition> the AMF does not have a PCF address associated with the UE </condition> or <condition> the AMF cannot forward the content of the Payload container IE to the PCF <condition> associated with the PCF address available in the AMF, </condition> </condition> </condition> <action> the AMF shall abort the procedure. </action> </control>
<control> <condition> e) <condition> If the Payload container type IE is set to "Location services message container" </condition> and <condition> if the Additional information IE is included in the UL NAS TRANSPORT message </condition> and <condition> the AMF cannot forward the content of the Payload container IE to an LMF <condition> associated with the routing information included in the Additional information IE, </condition> </condition> </condition> <action> the AMF shall abort the procedure. </action> </control>
<control> <condition> f) If the Payload container type IE is set to "SMS" or "LTE Positioning Protocol (LPP) message container": </condition> </control> <control> 1) <condition> the timer T3447 is running and the UE supports service gap control; </condition> </control> <control> 2) <condition> the UE is not configured for high priority access in selected PLMN; </condition> </control> <control> 3) <condition> the current NAS signalling connection was not triggered by paging; </condition> </control> and <control> 4) <condition> <condition> mobile terminated signalling has not been sent </condition> or <condition> no user-plane resources have been established for any PDU session <condition> after the establishment of the current NAS signalling connection, </condition> </condition> </condition> </control> <control> <action> the AMF shall abort the procedure. </action> </control>
NOTE: In this state the N1 NAS signalling connection can be released by the network.
<control> <condition> g) If the Payload container type IE is set to "CIoT user data container" </condition> </control> and: <control> <condition> 1) <condition> if the AMF does not have a PDU session routing context for the PDU session ID and the UE; </condition> or 2) <condition> if the AMF unsuccessfully attempted to forward the user data container and the PDU session ID, </condition> </condition> then <action> the AMF may send back to the UE the CIoT user data container which was not forwarded as specified in subclause 5.4.5.3.1 case l1). </action> </control>
<control> <condition> h) If the Payload container type IE is set to "CIoT user data container": </condition> </control> <control> <condition> <condition> 1) if the timer T3447 is running and the UE supports service gap control; </condition> 2) <condition> the UE is not configured for high priority access in selected PLMN; </condition> 3) <condition> the current N1 NAS signalling connection was not triggered by paging; </condition> and 4) <condition> <condition> mobile terminated signalling has not been sent </condition> or <condition> no user-plane resources have been established for any PDU session <condition> after the establishment of the current NAS signalling connection, </condition> </condition> </condition> </condition> <action> then the AMF shall send back to the UE the CIoT user data container which was not forwarded as specified in subclause 5.4.5.3.1 case l1). </action> </control>
5.4.5.2.6 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) The lower layers indicate that the access attempt is barred. </condition> <action> The UE shall not start the UE-initiated NAS transport procedure. </action> The UE stays in the current serving cell and applies the normal cell reselection process. <control> <condition> <condition> If the access category for the access attempt is 6 <condition> due to a request from upper layers to send a mobile originated SMS over NAS </condition> and <condition> the UE is registered to the network via both 3GPP access and non-3GPP access, </condition> </condition> </condition> <action> the UE may transmit the UL NAS TRANSPORT message via non-3GPP access, </action> <condition> if available. </condition> </control> <control> <condition> Otherwise, </condition> <action> the UE-initiated NAS transport procedure is started, </action> <condition> if still needed, </condition> <condition> when the lower layers indicate that the barring is alleviated for the access category <condition> with which the access attempt was associated. </condition> </condition> </control> </control>
aa) The lower layers indicate that:
1) <control> <action> access barring is applicable for all access categories </action> <condition> except categories 0 and 2 and the access category <condition> with which the access attempt was associated is other than 0 and 2; </condition> </condition> </control> or
2) <control> <action> access barring is applicable for all access categories </action> <condition> except category 0 and the access category <condition> with which the access attempt was associated is other than 0. </condition> </condition> </control>
<control> <action> The UE shall proceed as specified for case a. For additional UE requirements see subclause 4.5.5. </action> </control>
<control> <condition> b) <condition> If the Payload container type IE is set to "N1 SM information", </condition> <condition> the Request type IE is set to "initial request" or "MA PDU request" </condition> and <condition> registration procedure for mobility and periodic registration update is pending <condition> due to receipt by the UE of new network slicing information <condition> via the generic UE configuration update procedure with re- registration request; </condition> </condition> </condition> and <condition> an emergency PDU session exists </condition> </condition> then:1) <action> The UE shall not send the UL NAS TRANSPORT message; </action> and 2) <action> The UL NAS TRANSPORT message can be sent, </action> <condition> if still necessary, </condition> <condition> after a successful procedure for mobility and periodic registration update. </condition> </control>
<control> <condition> c) Transmission failure of the UL NAS TRANSPORT message with change in the current TAI. </condition> <control> <condition> If the current TAI is not in the TAI list, </condition> <action> the UE-initiated NAS transport procedure shall be aborted </action> and <action> a registration procedure for mobility and periodic registration update shall be initiated. </action> <action> The UL NAS TRANSPORT message can be sent, </action> <condition> <condition> if still necessary, </condition> after a successful procedure for mobility and periodic registration update. </condition> </control> <control> <condition> If the current TAI is still part of the TAI list, </condition> it is up to the UE implementation how to re-run the ongoing procedure that triggered the UE-initiated NAS transport procedure. </control> </control>
<control> <condition> d) Transmission failure of the UL NAS TRANSPORT message indication without change in the current TAI. </condition> </control>
It is up to the UE implementation how to re-run the ongoing procedure that triggered the UE-initiated NAS transport procedure.
<control> <condition> f) Timer T3447 is running </condition> <control> <action> The UE shall not send the UL NAS TRANSPORT message </action> unless <condition> : 1) <condition> the Payload container type IE is set to "N1 SM information" </condition> and : <condition> i) <condition> the Request type IE is set to: <condition> a) "initial emergency request"; </condition> B) <condition> "existing emergency PDU session"; </condition> or C) <condition> "modification request" and the PDU session being modified is an emergency PDU session </condition> (see error cases described in subclause 6.4.1.3 and subclause 6.3.2.3); </condition> or ii) <condition> <condition> the Request type IE is not included </condition> and <condition> the PDU session modification procedure is used to indicate a change of 3GPP PS data off UE status for a PDU session; </condition> </condition> </condition> 2) <condition> the UE is a UE configured for high priority access in selected PLMN; </condition> 3) <condition> a paging request triggered the establishment of the current NAS signalling connection; </condition> or 4) <condition> the UE in 5GMM-CONNECTED mode receives mobile terminated signalling or downlink data over the user-plane. </condition> </condition> </control> <control> <action> The UL NAS TRANSPORT message can be sent, </action> <condition> <condition> if still necessary, </condition> when timer T3447 expires or timer T3447 is stopped. </condition> </control> </control>
<control> <condition> g) The lower layers indicate that the RRC connection has been suspended. </condition> <action> The UE shall abort the UE-initiated NAS transport procedure. </action> </control>
<control> <condition> h) Timer T3346 is running. </condition> <action> The UE shall not send the UL NAS TRANSPORT message </action> unless: <condition> 1) <condition> <condition> the Payload container type IE is set to "N1 SM information" </condition> and: <condition> i) the Request type IE is set to: <condition> a) "initial emergency request"; </condition> B) <condition> "existing emergency PDU session"; </condition> or C) <condition> "modification request" and the PDU session being modified is an emergency PDU session; </condition> </condition> or ii) <condition> <condition> the Request type IE is not included </condition> and <condition> the PDU session modification procedure is used to indicate a change of 3GPP PS data off UE status for a PDU session; </condition> </condition> </condition> or 2) <condition> > the UE is a UE configured for high priority access in selected PLMN. </condition> </condition> </control>
<control> <action> The UL NAS TRANSPORT message can be sent, </action> <condition> <condition> if still necessary, </condition> when timer T3346 expires. </condition> </control>
<control> <condition> i) NAS MAC calculation indication from lower layers. </condition> <control> <condition> If lower layers indicate to calculate an NAS MAC, </condition> <action> the UE shall calculate an NAS MAC as specified in 3GPP TS 33.501 </action> and then <action> provide the calculated NAS MAC and 5 least significant bits of the uplink NAS COUNT used to calculate the NAS MAC to lower layers (see 3GPP TS 36.331 ). </action> <action> The UE shall increase the uplink NAS COUNT by one after the calculation of the NAS MAC. </action> </control> </control>
5.4.5.3 Network-initiated NAS transport procedure
5.4.5.3.1 General
<control> The purpose of the network-initiated NAS transport procedure is to provide a transport of: c) an LPP message; d) an SOR transparent container; e) a single uplink 5GSM message <condition> which was not forwarded <condition> due to routing failure; </condition> </condition> f) a single uplink 5GSM message <condition> which was not forwarded <condition> due to congestion control; </condition> </condition> g) a UE policy container; h) a single uplink 5GSM message <condition> which was not forwarded, <condition> because the PLMN's maximum number of PDU sessions has been reached; </condition> </condition> h1) a single uplink 5GSM message <condition> which was not forwarded, <condition> because the maximum number of PDU sessions with active user-plane resources has been reached; </condition> </condition> h2) a single uplink 5GSM message <condition> which was not forwarded, <condition> because of ongoing network slice-specific authentication and authorization procedure for the S-NSSAI that is requested; </condition> </condition> h3) a single uplink 5GSM message <condition> which was not forwarded, <condition> because the UE requested to establish an MA PDU session for LADN DNN; </condition> </condition> h4) a single uplink 5GSM message <condition> which was not forwarded, <condition> because the maximum number of UEs for a network slice has been reached; </condition> </condition> h5) a single uplink 5GSM message <condition> which was not forwarded <condition> because the UE is marked in the UE's 5GMM context <condition> that it is not allowed to request UAS services; </condition> </condition> </condition> i) a single uplink 5GSM message <condition> which was not forwarded <condition> due to service area restrictions; </condition> </condition> i1) a single uplink 5GSM message <condition> which was not forwarded <condition> because the UE is registered to a PLMN via a satellite NG-RAN cell <condition> that is not allowed to operate at the present UE location; </condition> </condition> </condition> j) a UE parameters update transparent container; k) a location services message; l) a CIoT user data container; l1) a single uplink CIoT user data container or control plane user data <condition> which was not forwarded <condition> due to routing failure; </condition> </condition> l2) a single uplink CIoT user data container <condition> which was not forwarded <condition> due to congestion control; </condition> </condition> m1) an event notification for upper layers; or n) multiple of the above types. from the AMF to the UE in a 5GMM message. </control>
5.4.5.3.2 Network-initiated NAS transport procedure initiation
<control> <condition> In 5GMM-CONNECTED mode, </condition> <action> the AMF initiates the NAS transport procedure by sending the DL NAS TRANSPORT message, as shown in figure 5.4.5.3.2.1. </action> </control>
<control> <condition> In case a) in subclause 5.4.5.3.1, i.e. upon reception from an SMF of a 5GSM message <condition> without an N1 SM delivery skip allowed indication for a UE </condition> or a 5GSM message <condition> with an N1 SM delivery skip allowed indication for a UE in the 5GMM-CONNECTED mode, </condition> </condition> the AMF shall: a) <action> include the PDU session information (PDU session ID) in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "N1 SM information"; </action> and c) <action> set the Payload container IE to the 5GSM message. </action> </control>
<control> <condition> In case b) in subclause 5.4.5.3.1, i.e. upon reception from an SMSF of an SMS payload, </condition> the AMF shall: a) <action> set the Payload container type IE to "SMS"; </action> b) <action> set the Payload container IE to the SMS payload; </action> and <control> c) <action> select the access type to deliver the DL NAS TRANSPORT message as follows </action> <condition> in case the access type selection is required </condition> : 1) <control> <condition> <condition> if the UE <condition> to receive the DL NAS TRANSPORT message </condition> is registered to the network via both 3GPP access and non-3GPP access, </condition> <condition> the 5GMM context of the UE indicates that SMS over NAS is allowed, </condition> <condition> the UE is in MICO mode, </condition> and <condition> the UE is in 5GMM-IDLE mode for 3GPP access and in 5GMM-CONNECTED mode for non-3GPP access, </condition> </condition> <action> then the AMF selects non-3GPP access. </action> </control> <control> <condition> Otherwise, </condition> <action> the AMF selects either 3GPP access or non-3GPP access. </action> </control> <control> <condition> If the delivery of the DL NAS TRANSPORT message over 3GPP access has failed, </condition> <action> the AMF may re-send the DL NAS TRANSPORT message over the non-3GPP access. </action> </control> <control> <condition> If the delivery of the DL NAS TRANSPORT message over non-3GPP access has failed, </condition> <action> the AMF may re-send the DL NAS TRANSPORT message over the 3GPP access; </action> </control> and 2) <control> <condition> otherwise, </condition> <action> the AMF selects 3GPP access. </action> </control> </control> </control>
NOTE 1: The AMF selects an access type between 3GPP access and non-3GPP access based on operator policy.
<control> <condition> In case c) in subclause 5.4.5.3.1 i.e. upon reception from an LMF of an LPP message payload, </condition> the AMF shall: a) <action> set the Payload container type IE to "LTE Positioning Protocol (LPP) message container"; </action> b) <action> set the Payload container IE to the LPP message payload received from the LMF; </action> c) <action> set the Additional information IE to an LCS correlation identifier received from the LMF from which the LPP message was received. </action> </control>
NOTE 2: <control> The LCS Correlation Identifier is assigned originally by the AMF <condition> except for LPP message transfer associated with event reporting for periodic or triggered location as described in subclause 6.3.1 of 3GPP TS 23.273 , <condition> where the LMF assigns the correlation identifier. </condition> </condition> AMF and LMF assigned correlation identifiers can be distinguished by an implementation specific convention (e.g. use of a different number of octets) to enable an AMF to distinguish one from the other <condition> when received in the Additional Information IE in an UL NAS Transport message. </condition> </control>
<control> <condition> In case d) in subclause 5.4.5.3.1 i.e. upon reception of a steering of roaming information (see 3GPP TS 23.122 ) <condition> from the UDM to be forwarded to the UE, </condition> </condition> the AMF shall: a) <action> set the Payload container type IE to "SOR transparent container"; </action> and b) <action> set the Payload container IE to the steering of roaming information received from the UDM (see 3GPP TS 29.503 ). </action> </control>
<control> <condition> In case e) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM message <condition> which was not forwarded due to routing failure, </condition> </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "N1 SM information"; </action> c) <action> set the Payload container IE to the 5GSM message which was not forwarded; </action> d) <action> set the 5GMM cause IE to the 5GMM cause #90 "payload was not forwarded" or 5GMM cause #91 "DNN not supported or not subscribed in the slice". </action> <control> <action> The AMF sets the 5GMM cause IE to the 5GMM cause #91 "DNN not supported or not subscribed in the slice", </action> <condition> if the 5GSM message could not be forwarded since SMF selection fails because: <condition> 1) <condition> the DNN is not supported in the slice identified by the S-NSSAI used by the AMF; </condition> or2) <condition> neither the DNN provided by the UE nor the wildcard DNN are in the subscribed DNN list of the UE for the S-NSSAI used by the AMF. </condition> </condition> </condition> </control> <control> <condition> Otherwise, </condition> <action> the AMF sets the 5GMM cause IE to the 5GMM cause #90 "payload was not forwarded"; </action> and <control> e) <action> optionally include the Back-off timer value IE </action> <condition> if the 5GMM cause IE is set to 5GMM cause #91 "DNN not supported or not subscribed in the slice" <condition> due to the DNN is not supported in the slice. </condition> </condition> </control> </control> </control>
<control> <condition> In case f) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM message <condition> which was not forwarded due to congestion control, </condition> </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "N1 SM information"; </action> c) <action> set the Payload container IE to the 5GSM message which was not forwarded; </action> d) <action> set the 5GMM cause IE to the 5GMM cause #22 "Congestion", the 5GMM cause #67 "insufficient resources for specific slice and DNN" or the 5GMM cause #69 "insufficient resources for specific slice"; </action> and e) <action> include the Back-off timer value IE. </action> </control>
<control> <condition> In case g) in subclause 5.4.5.3.1, i.e. upon reception of a UE policy container <condition> from the PCF to be forwarded to the UE, </condition> </condition> the AMF shall: a) <action> set the Payload container type IE to "UE policy container"; </action> and b) <action> set the Payload container IE to the UE policy container received from the PCF. </action> </control>
<control> <condition> In case h) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM message <condition> which was not forwarded, <condition> because the PLMN's maximum number of PDU sessions has been reached, </condition> </condition> </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "N1 SM information"; </action> c) <action> set the Payload container IE to the 5GSM message which was not forwarded; </action> and d) <action> set the 5GMM cause IE to the 5GMM cause #65 "maximum number of PDU sessions reached". </action> </control>
<control> <condition> In case h1) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM message <condition> which was not forwarded= <condition> because the maximum number of PDU sessions with active user-plane resources has been reached, </condition> </condition> </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "N1 SM information"; </action> c) <action> set the Payload container IE to the 5GSM message which was not forwarded; </action> and d) <action> set the 5GMM cause IE to the 5GMM cause #92 "insufficient user-plane resources for the PDU session". </action> </control>
<control> <condition> In case h2) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM message <condition> which was not forwarded <condition> <condition> because the UE requested to establish a PDU session associated with an S-NSSAI </condition> or <condition> to modify a PDU session associated with an S-NSSAI for which: <condition> a) <condition> the AMF is performing network slice-specific authentication and authorization </condition> and <condition> determined to reject the request based on local policy; </condition> </condition> or b) <condition> <condition> the network slice-specific authentication and authorization has failed </condition> or <condition> the authorization has been revoked; </condition> </condition> </condition> </condition> </condition> </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "N1 SM information"; </action> c) <action> set the Payload container IE to the 5GSM message which was not forwarded; </action> > and d) <action> set the 5GMM cause IE to the 5GMM cause #90 "payload was not forwarded". </action> </control>
<control> <condition> In case h3) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM message <condition> which was not forwarded <condition> because the UE requested to establish an MA PDU session for LADN DNN, </condition> </condition> </condition> the AMF shall:a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "N1 SM information"; </action> c) <action> set the Payload container IE to the 5GSM message which was not forwarded; </action> and d) <action> set the 5GMM cause IE to the 5GMM cause #90 "payload was not forwarded". </action> </control>
<control> <condition> In case h4) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM message <condition> which was not forwarded, <condition> because the maximum number of UEs for a network slice has been reached, </condition> </condition> </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "N1 SM information"; </action> c) <action> set the Payload container IE to the 5GSM message which was not forwarded; </action> d) <action> set the 5GMM cause IE to the 5GMM cause #69 "insufficient resources for specific slice"; </action> and e) <action> include the Back-off timer value IE. </action> </control>
<control> <condition> For case h5) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM message <condition> which was not forwarded <condition> because the UE is marked in the UE's 5GMM context that it is not allowed to request UAS services, </condition> </condition> </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "N1 SM information"; </action> c) <action> set the Payload container IE to the 5GSM message which was not forwarded; </action> and d) <action> set the 5GMM cause IE to the 5GMM cause #79 "UAS services not allowed". </action> </control>
<control> <condition> In case i) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM message <condition> which was not forwarded <condition> due to service area restrictions, </condition> </condition> </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "N1 SM information"; </action> c) <action> set the Payload container IE to the 5GSM message which was not forwarded; </action> and d) <action> set the 5GMM cause IE to the 5GMM cause #28 "Restricted service area". </action> </control>
<control> <condition> In case i1) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM message <condition> which was not forwarded <condition> because the UE is registered to a PLMN via a satellite NG-RAN cell <condition> that is not allowed to operate at the present UE location, </condition> </condition> </condition> </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "N1 SM information"; </action> c) <action> set the Payload container IE to the 5GSM message which was not forwarded; </action> and d) <action> set the 5GMM cause IE to the 5GMM cause #78 "PLMN not allowed to operate at the present UE location". </action> </control>
<control> <condition> In case j) in subclause 5.4.5.3.1 i.e. upon reception of UE parameters update data (see 3GPP TS 23.502 ) <condition> from the UDM to be forwarded to the UE, </condition> </condition> the AMF shall: a) <action> set the Payload container type IE to "UE parameters update transparent container"; </action> andb) <action> set the contents of the Payload container IE to the UE parameters update data (see 3GPP TS 23.502 ) received from the UDM. </action> </control>
<control> <condition> For case k) in subclause 5.4.5.3.1 upon reception from a location services application of a Location services message payload, </condition> the AMF shall: a) <action> set the Payload container type IE to "Location services message container"; </action> and b) <action> set the Payload container IE to the Location services message payload. </action> </control>
<control> <condition> For case k) in subclause 5.4.5.3.1 upon reception from an LMF of a Location services message payload, </condition> the AMF shall: a) <action> set the Payload container type IE to "Location services message container"; </action> b) <action> set the Payload container IE to the Location services message payload; </action> and c) <action> set the Additional information IE to routing information associated with the LMF from which the Location services message payload was received. </action> </control>
NOTE 3: <control> Case k) in subclause 5.4.5.3.1 supports transport of a Location services message container between a UE and an AMF and between a UE and an LMF. <condition> For transport between a UE and an LMF, </condition> the Additional information IE is included and provides routing information for the LMF. <condition> For transport between a UE and an AMF, </condition> the Additional information IE is not included. </control>
<control> <condition> In case l) in subclause 5.4.5.3.1, i.e. upon reception from an SMF of a user data container payload, </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to "CIoT user data container"; </action> and c) <action> set the Payload container IE to the user data container. </action> </control>
<control> <condition> For case l1) in subclause 5.4.5.3.1, i.e. upon sending a single uplink CIoT user data container or control plane user data <condition> which was not forwarded <condition> due to routing failure, </condition> </condition> </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to " CIoT user data container"; </action> c) <action> set the Payload container IE to the CIoT user data container or control plane user data which was not forwarded; </action> and d) <action> set the 5GMM cause IE to the 5GMM cause #90 "payload was not forwarded". </action> </control>
NOTE 4: <control> For case l1) in subclause 5.4.5.3.1, this is also applied for a single uplink CIoT user data container or control plane user data in the CONTROL PLANE SERVICE REQUEST message <condition> which was not forwarded <condition> due to routing failure. </condition> </condition> </control>
<control> <condition> For case l2) in subclause 5.4.5.3.1, i.e. upon sending a single uplink CIoT user data container <condition> which was not forwarded <condition> due to congestion control, </condition> </condition> </condition> the AMF shall: a) <action> include the PDU session ID in the PDU session ID IE; </action> b) <action> set the Payload container type IE to " CIoT user data container"; </action> c) <action> set the Payload container IE to the CIoT user data container which was not forwarded; </action> d) <action> set the 5GMM cause IE to the 5GMM cause #22 "Congestion", the 5GMM cause #67 "insufficient resources for specific slice and DNN" or the 5GMM cause #69 "insufficient resources for specific slice", and include the Back-off timer value IE. </action> </control>
<control> <condition> In case m) in subclause 5.4.5.3.1, <condition> during UUAA-MM procedure, </condition> <condition> if the AMF receives the UUAA payload from the UAS-NF, </condition> </condition> <action> the AMF shall include the Service-level-AA container IE containing the service-level-AA payload type with the value set to "UUAA payload" </action> and <action> the service-level-AA payload with the value set to the UUAA payload. </action> </control>
<control> <condition> In case m1) in subclause 5.4.5.3.1, i.e. if the AMF needs to send an event notification indicator for upper layers to the UE <condition> which set the "EventNotification" bit of the 5GMM capability IE <condition> in the last REGISTRATION REQUEST message to "Event notification supported", </condition> </condition> </condition> the AMF shall: a) <action> set the Payload container type IE to "Event notification"; </action> and b) <action> set the Payload container IE to the event notification indicator. </action> </control>
<control> <condition> In case n) in subclause 5.4.5.3.1, </condition> the AMF shall: a) <action> set the Payload container type IE to "Multiple payloads"; </action> b) <action> set each payload container entry of the Payload container IE (see subclause 9.11.3.39) </action> as follows: i) <action> set the payload container type field of the payload container entry to a payload container type value set in the Payload container type IE as specified for cases a) to m) above; </action> ii) <action> set the payload container entry contents field of the payload container entry to the payload container contents set in the Payload container IE as specified for cases a) to m) above; </action> iii) <action> set the optional IE fields, <condition> if any, </condition> to the optional associated information as specified for cases a) to m) above. </action> </control>
5.4.5.3.3 Network-initiated NAS transport of messages
<control> <condition> Upon reception of a DL NAS TRANSPORT message, </condition> <action> the UE shall stop the timer T3346 if running. </action> </control>
<control> <condition> Upon reception of a DL NAS TRANSPORT message, </condition> if the Payload container type IE is set to: </control>
<control> <condition> a) "N1 SM information" and the 5GMM cause IE is not included in the DL NAS TRANSPORT message, </condition> <action> the 5GSM message in the Payload container IE and the PDU session ID are handled in the 5GSM procedures specified in clause 6; </action> </control>
<control> <condition> b) "SMS", </condition> <action> the UE shall forward the content of the Payload container IE to the SMS stack entity; </action> </control>
<control> <condition> c) "LTE Positioning Protocol (LPP) message container", </condition> <action> the UE shall forward the payload container type, the content of the Payload container IE and the routing information included in the Additional information IE to the upper layer location services application; </action> </control>
<control> <condition> d) SOR transparent container" </condition> "and if the Payload container IE: </control>
<control> 1) <condition> successfully passes the integrity check (see 3GPP TS 33.501 ), </condition> <action> the ME shall store the received SOR counter as specified in annex C and proceed as follows </action> </control> :
<control> <condition> i) If the Payload container IE indicates <condition> <condition> a list of preferred PLMN/access technology combinations is provided </condition> and <condition> the list type indicates "PLMN ID and access technology list", </condition> </condition> </condition> then <action> the ME shall replace the highest priority entries in the "Operator Controlled PLMN Selector with Access Technology" list stored in the ME; </action> </control>
<control> ii) <condition> If the list type indicates "secured packet", </condition> then <action> the ME shall behave as if a SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of SOR transparent container IE. </action> <action> The SMS payload is forwarded to UICC as specified in 3GPP TS 23.040 ; </action> </control>
<control> iii) <condition> If the Payload container IE includes SOR-SNPN-SI, </condition> <action> the ME shall replace SOR-SNPN-SI of the selected entry of the "list of subscriber data" or associated with the selected PLMN subscription, as specified in 3GPP TS 23.122 with the received SOR-SNPN-SI; </action> </control> and
<control> iv) <condition> <condition> If the SOR-CMCI is present, in plain text, </condition> and <condition> the Store SOR-CMCI in ME indicator is set to "Store SOR-CMCI in ME" </condition> </condition> then <action> the UE shall store or delete the SOR-CMCI in the non-volatile memory of the ME as described in annex C.1; </action> </control>
<control> <condition> If the ACK bit of the SOR header for SOR data type <condition> in the SOR transparent container </condition> is set to "acknowledgement requested" </condition> and the list type indicates: </control>
<control> <condition> a) "PLMN ID and access technology list"; </condition> </control> or <control> <condition> b) "secured packet" and the ME receives status bytes from the UICC <condition> indicating that the UICC has received the secured packet successfully; </condition> </condition> </control>
<control> then <action> the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to "SOR transparent container" as specified in subclause 5.4.5.2.2. </action> <control> <condition> In the Payload container IE carrying the acknowledgement, </condition> <action> the UE shall set the ME support of SOR-CMCI indicator to "SOR-CMCI supported by the ME". </action> </control> <control> Additionally, <condition> <condition> if the UE supports access to an SNPN <condition> using credentials from a credentials holder </condition> </condition> and <condition> the UE is not operating in SNPN access operation mode, </condition> </condition> <action> the UE may set the ME support of SOR-SNPN-SI indicator to "SOR-SNPN-SI supported by the ME". </action> </control> </control>
<control> <action> The UE shall proceed with the behaviour as specified in 3GPP TS 23.122 annex C; </action> </control> or
<control> 2) <condition> does not successfully pass the integrity check (see 3GPP TS 33.501 ) </condition> then <action> the UE shall discard the content of the payload container IE and proceed with the behaviour as specified in 3GPP TS 23.122 annex C. </action> </control>
<control> <condition> g) "N1 SM information" </condition> and: </control>
<control> 1) <condition> the 5GMM cause IE is set to the 5GMM cause #22 "Congestion", </condition> <action> the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to DNN based congestion control along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE; </action> </control>
<control> 2) <condition> the 5GMM cause IE is set to the 5GMM cause #28 "Restricted service area", </condition> <action> the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to service area restrictions along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, </action> <end_state> enters the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE </end_state> and, <control> <condition> if the DL NAS TRANSPORT message is received over 3GPP access, </condition> <action> performs the registration procedure for mobility and periodic registration update without waiting for the release of the N1 NAS signalling connection (see subclauses 5.3.5 and 5.5.1.3); </action> </control> </control>
<control> 3) <condition> the 5GMM cause IE is set to the 5GMM cause #65 "maximum number of PDU sessions reached", </condition> <action> the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded because the PLMN's maximum number of PDU sessions has been reached, along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message; </action> </control>
<control> 4) <condition> the 5GMM cause IE is set to the 5GMM cause #67 "insufficient resources for specific slice and DNN", </condition> <action> the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to S-NSSAI and DNN based congestion control along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE; </action> </control>
<control> 5) <condition> the 5GMM cause IE is set to the 5GMM cause #69 "insufficient resources for specific slice", </condition> <action> the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to S-NSSAI only based congestion control along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE; </action> </control>
<control> <condition> 5a) the 5GMM cause IE is set to the 5GMM cause #78 "PLMN not allowed to operate at the present UE location", </condition> <action> the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded because the UE is registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message; </action> </control>
<control> 6) <condition> the 5GMM cause IE is set to the 5GMM cause #90 "payload was not forwarded", </condition> <action> the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to routing failure along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message; </action> </control>
<control> 7) <condition> the 5GMM cause IE is set to the 5GMM cause #91 "DNN not supported or not subscribed in the slice", </condition> <action> the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded because the DNN is not supported or not subscribed in a slice along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE, </action> <condition> if any </condition> </control> ;
<control> 8) <condition> the 5GMM cause IE is set to the 5GMM cause #92 "insufficient user-plane resources for the PDU session", </condition> <action> the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to insufficient user-plane resources along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message. </action> </control>
<control> 9) <condition> the 5GMM cause IE is set to the 5GMM cause #79 "UAS services not allowed", </condition> <action> the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded because the UE is marked in the UE's 5GMM context that it is not allowed to request UAS services along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message. </action> </control>
<control> <condition> h) "UE policy container", </condition> <action> the UE policy container in the Payload container IE is handled in the UE policy delivery procedures specified in Annex D; </action> </control>
<control> <condition> i) "UE parameters update transparent container" </condition> and if the Payload container IE </control>
<control> 1) <condition> successfully passes the integrity check (see 3GPP TS 33.501 ), </condition> <action> the ME shall store the received UE parameter update counter as specified in annex C </action> and proceed as follows: </control>
<control> <condition> i) if the UE parameters update list includes a UE parameters update data set <condition> with UE parameters update data set type indicating "Routing indicator update data", </condition> </condition> </control> <control> A) <action> the ME shall behave as if an SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of UE parameters update transparent container IE. </action> <action> The SMS payload is forwarded to UICC as specified in 3GPP TS 23.040 ; </action> </control> <control> and B) <condition> <condition> <condition> if the ACK bit of the UE parameters update header <condition> in the UE parameters update transparent container </condition> is set to "acknowledgment requested" </condition> </condition> and <condition> if the ME receives status bytes from the UICC <condition> indicating that the UICC has received the secured packet successfully, </condition> </condition> </condition> the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to "UE parameters update transparent container" as specified in subclause 5.4.5.2.2; </control> and <control> <condition> c) <condition> if the ME receives a REFRESH command from the UICC as specified in 3GPP TS 31.111 </condition> and <condition> if the REG bit of the UE parameters update header <condition> in the UE parameters update transparent container IE </condition> is set to "re-registration requested", </condition> </condition> </control> and:
<control> C1) <condition> the UE is registered over 3GPP access, </condition> <action> then the UE shall wait </action> <condition> until the emergency services over 3GPP access, if any, are completed, </condition> <action> enter 5GMM-IDLE mode over 3GPP access or 5GMM- CONNECTED mode with RRC inactive indication, </action> <action> perform a de-registration procedure, </action> and then <action> delete its 5G-GUTI </action> <condition> <condition> <condition> if the UE is registered to different PLMN or SNPN on non-3GPP access </condition> or <condition> the UE is not registered over non-3GPP access, </condition> </condition> or <condition> wait <condition> until the de-registration procedure over non- 3GPP access specified in case C2) or C3) is completed <condition> before deleting its 5G-GUTI <condition> if the UE is registered to same PLMN or SNPN on non-3GPP access, </condition> </condition> </condition> </condition> </condition> and then <action> initiate a registration procedure for initial registration as specified in subclause 5.5.1.2; </action> </control>
<control> C2) <condition> <condition> the UE is registered over non-3GPP access </condition> and <condition> does not have emergency services ongoing over non-3GPP access, </condition> </condition> then <action> the UE shall locally release the N1 NAS signalling connection </action> and <action> enter 5GMM-IDLE mode over non-3GPP access, </action> <action> perform a de-registration procedure, </action> and then <action> delete its 5G-GUTI </action> <condition> <condition> <condition> if the UE is registered to different PLMN or SNPN on 3GPP access </condition> or <condition> the UE is not registered over 3GPP access, </condition> </condition> or <condition> wait <condition> until the de-registration procedure over 3GPP access specified in case C1) is completed <condition> before deleting its 5G-GUTI <condition> if the UE is registered to same PLMN or SNPN on 3GPP access, </condition> </condition> </condition> </condition> </condition> and then <action> initiate a registration procedure for initial registration as specified in subclause 5.5.1.2; </action> </control> and
<control> C3) <condition> <condition> the UE is registered over non-3GPP access </condition> and <condition> has an emergency services ongoing over non- 3GPP access, </condition> </condition> <action> then the UE shall wait </action> <condition> until the emergency services are completed <condition> before locally releasing the N1 NAS signalling connection </condition> </condition> and <action> enter 5GMM-IDLE mode over non-3GPP access, </action> <action> perform a de-registration procedure, </action> and then <action> delete its 5G-GUTI </action> <condition> <condition> <condition> if the UE is registered to different PLMN or SNPN on 3GPP access </condition> or <condition> if the UE is not registered over 3GPP access, </condition> </condition> or <condition> wait <condition> until the de-registration procedure over 3GPP access specified in case C1) is completed <condition> before deleting its 5G-GUTI <condition> if the UE is registered to same PLMN or SNPN on 3GPP access, </condition> </condition> </condition> </condition> </condition> and then <action> initiate a registration procedure for initial registration as specified in subclause 5.5.1.2. </action> </control>
<control> ii) <condition> if the UE parameters update list includes a UE parameters update data set <condition> with UE parameters update data set type indicating "Default configured NSSAI update data", </condition> </condition> </control> <control> <condition> a) <condition> if the ACK bit of the UE parameters update header <condition> in the UE parameters update transparent container </condition> is set to "acknowledgment requested" </condition> and <condition> if the UE parameters update list does not include a UE parameters update data set <condition> with UE parameters update data set type indicating "Routing indicator update data", </condition> </condition> </condition> <action> the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to "UE parameters update transparent container" as specified in subclause 5.4.5.2.2 </action> </control> <control> B) <action> the ME shall replace the stored default configured NSSAI with the default configured NSSAI included in the default configured NSSAI update data. </action> <control> <condition> In case of SNPN, </condition> <action> the ME shall replace the stored default configured NSSAI associated with the selected entry of the "list of subscriber data" or the PLMN subscription with the default configured NSSAI included in the default configured NSSAI update data; </action> </control> </control> and <control> <condition> c) <condition> if the REG bit of the UE parameters update header <condition> in the UE parameters update transparent container </condition> is set to "re-registration requested" </condition> and <condition> the UE parameters update list does not include a UE parameters update data set <condition> with UE parameters update data set type indicating "Routing indicator update data", </condition> </condition> </condition> <action> the UE shall wait </action> <condition> until it enters 5GMM-IDLE mode </condition> and then <action> the UE shall initiate a registration procedure for mobility registration update as specified in subclause 5.5.1.3. </action> </control>
<control> <condition> if the UE parameters update list does not include a UE parameters update data set <condition> with UE parameters update data set type indicating "Routing indicator update data", </condition> </condition> <action> the UE used the old default configured NSSAI to create the requested NSSAI in a REGISTRATION REQUEST message, </action> <action> the UE does not have a configured NSSAI for the current PLMN or SNPN </action> and <action> the UE has an allowed NSSAI for the current PLMN or SNPN which contains one or more S-NSSAIs that are not included in the new default configured NSSAI, </action> <action> > the UE shall wait </action> <condition> until it enters 5GMM-IDLE mode </condition> and then <action> the UE shall initiate a registration procedure for mobility and periodic registration update as specified in subclause 5.5.1.3; </action> </control> and
<control> iii) <condition> if the UE parameters update list includes a UE parameters update data set <condition> with UE parameters update data set type indicating "Disaster roaming information update data", </condition> </condition> </control> <control> <condition> a) <condition> if the ACK bit of the UE parameters update header <condition> in the UE parameters update transparent container </condition> is set to "acknowledgment requested" </condition> and <condition> <condition> if the UE parameters update list does not include a UE parameters update data set <condition> with UE parameters update data set type indicating "Routing indicator update data" </condition> or <condition> a UE parameters update data set with UE parameters update data set type indicating "Default configured NSSAI update data", </condition> </condition> </condition> </condition> <action> the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to "UE parameters update transparent container" as specified in subclause 5.4.5.2.2; </action> </control> <control> B) <action> the UE shall delete the indication of whether disaster roaming is enabled in the UE stored in the ME, </action> <condition> if any, </condition> and <action> store the indication of whether disaster roaming is enabled in the UE included in the disaster roaming information update data in the ME; </action> </control> <control> C) <action> the UE shall delete the indication of 'applicability of "lists of PLMN(s) to be used in disaster condition" provided by a VPLMN' stored in the ME, </action> <condition> if any, </condition> and <condition> store the indication of 'applicability of "lists of PLMN(s) to be used in disaster condition" provided by a VPLMN' included in the disaster roaming information update data in the ME; </condition> and <control> <condition> d) <condition> if the REG bit of the UE parameters update header <condition> in the UE parameters update transparent container </condition> is set to "re-registration requested" </condition> and <condition> the UE parameters update list does not include a UE parameters update data set <condition> with UE parameters update data set type indicating "Routing indicator update data", </condition> </condition> </condition> <action> the UE shall wait </action> <condition> until it enters 5GMM-IDLE mode </condition> and then <action> the UE shall initiate a registration procedure for mobility registration update as specified in subclause 5.5.1.3. </action> </control> </control>
<control> iv) <condition> if the UE parameters update list includes a UE parameters update data set <condition> with UE parameters update data set type indicating "ME routing indicator update data" </condition> </condition> </control> :
<control> <condition> a) <condition> if the ACK bit of the UE parameters update header <condition> in the UE parameters update transparent container </condition> is set to "acknowledgment requested" </condition> and <condition> the UE parameters update list does not include a UE parameters update data set <condition> with UE parameters update data set type indicating "Default configured NSSAI update data", </condition> </condition> </condition> <action> the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to "UE parameters update transparent container" as specified in subclause 5.4.5.2.2; </action> </control> <control> B) <action> the UE shall set or replace the routing indicator of the selected entry of the "list of subscriber data" with the routing indicator included in the ME routing indicator update data; </action> </control> and <control> <condition> c) if the REG bit of the UE parameters update header <condition> in the UE parameters update transparent container IE </condition> is set to "re-registration requested", </condition> </control> and:
<control> C1) <condition> <condition> the UE is registered over 3GPP access </condition> and <condition> is not registered over non-3GPP access, </condition> </condition> <action> then the UE shall wait </action> <condition> until the emergency services over 3GPP access, <condition> if any, </condition> are completed, </condition> <action> enter 5GMM- IDLE mode over 3GPP access or 5GMM-CONNECTED mode with RRC inactive indication, </action> <action> perform a de-registration procedure, </action> <action> delete its 5G-GUTI, </action> and the n <action> initiate a registration procedure for initial registration as specified in subclause 5.5.1.2; </action> </control> <control> C2) <condition> <condition> the UE is registered over non-3GPP access </condition> and <condition> is not registered over 3GPP access, </condition> </condition> <action> then the UE shall locally release the N1 NAS signalling connection </action> and <action> enter 5GMM-IDLE mode over non- 3GPP access, </action> <action> perform a de-registration procedure, </action> <action> delete its 5G-GUTI, </action> and then <action> initiate a registration procedure for initial registration as specified in subclause 5.5.1.2; </action> </control> or <control> C3) <condition> the UE is registered over 3GPP access and non-3GPP access to same SNPN, </condition> <action> then the UE shall wait </action> <condition> until the emergency services over 3GPP access, <condition> if any, </condition> are completed, </condition> <action> enter 5GMM-IDLE mode over 3GPP access or 5GMM-CONNECTED mode with RRC inactive indication over 3GPP access, </action> <action> perform a de-registration procedure over 3GPP access, <action> locally release the N1 NAS signalling connection </action> and <action> enter 5GMM-IDLE mode over non-3GPP access, </action> <action> perform a de-registration procedure over non-3GPP access, </action> delete its 5G-GUTI and then initiate a registration procedure for initial registration as specified in subclause 5.5.1.2. </action> </control>
NOTE: The term "non-3GPP access" in an SNPN refers to the case where the UE is accessing SNPN services via a PLMN.
<control> 2) <condition> does not successfully pass the integrity check (see 3GPP TS 33.501 ) </condition> then <action> the UE shall discard the content of the payload container IE; </action> </control>
<control> <condition> j) <condition> "Location services message container" </condition> and <condition> the 5GMM cause IE is not included in the DL NAS TRANSPORT message, </condition> </condition> <action> the UE shall forward the payload container type, the content of the Payload container IE and the routing information in the Additional information IE </action> <condition> if included to the upper layer location services application; </condition> </control>
<control> <condition> k) "CIoT user data container", </condition> <action> the UE shall forward the content of the Payload container IE and the PDU session ID to the 5GSM sublayer; </action> </control>
<control> <condition> l)"CIoT user data container" </condition> and: </control>
<control> 1) <condition> the 5GMM cause IE is set to the 5GMM cause #22 "Congestion", </condition> <action> the UE passes to the 5GSM sublayer an indication that the CIoT user data was not forwarded due to DNN based congestion control along with the CIoT user data from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE; </action> </control>
<control> 2) <condition> the 5GMM cause IE is set to the 5GMM cause #67 "insufficient resources for specific slice and DNN", </condition> <action> the UE passes to the 5GSM sublayer an indication that the CIoT user data was not forwarded due to S-NSSAI and DNN based congestion control along with the CIoT user data from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE; </action> </control>
<control> 3) <condition> the 5GMM cause IE is set to the 5GMM cause #69 "insufficient resources for specific slice", </condition> <action> the UE passes to the 5GSM sublayer an indication that the CIoT user data was not forwarded due to S-NSSAI only based congestion control along with the CIoT user data from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE; </action> </control>
<control> 4) <condition> the 5GMM cause IE is set to the 5GMM cause #90 "payload was not forwarded", </condition> <action> the UE passes to the 5GSM sublayer an indication that the user data container was not forwarded due to routing failure along with the user data container from the Payload container IE and the PDU session ID from the PDU session ID IE of the DL NAS TRANSPORT message. </action> </control>
<control> <condition> m) "service-level-AA container", </condition> <action> the UE shall forward the content of the Payload container IE to the upper layers; </action> </control>
<control> m1) <condition> "Event notification", </condition> <action> the UE shall forward the received event notification indicator(s) to the upper layers (see 3GPP TS 23.216 and 3GPP TS 24.237 for the "SRVCC handover cancelled, IMS session re- establishment required" indicator); </action> </control> or
<control> <condition> n) "Multiple payloads", </condition> </control> <control> <action> the UE shall first decode the content of the Payload container IE (see subclause 9.11.3.39) to obtain the number of payload container entries </action> and <control> <condition> for each payload container entry, </condition> <action> the UE shall: 1) decode the payload container type field; 2) decode the optional IE fields and the payload container contents field in the payload container entry; and 3) handle the content of each payload container entry the same as the content of the Payload container IE and the associated optional IEs as specified in bullets a) to m) above according to the payload container type </action> </control> </control>
5.4.6 5GMM status procedure
5.4.6.1 General
<control> The purpose of the 5GMM status procedure is to report at any time in the 5GMM STATUS message certain error conditions detected <condition> upon receipt of 5GMM protocol data in the AMF or in the UE. </condition> </control> <control> The 5GMM STATUS message can be sent by both the AMF and the UE (see example in figure 5.4.6.1). </control>
5.4.6.2 5GMM status received in the UE
<control> <condition> On receipt of a 5GMM STATUS message, </condition> <action> no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. </action> </control> The local actions to be taken by UE on receipt of a 5GMM STATUS message are implementation dependent.
5.4.6.3 5GMM status received in the network
<control> <condition> On receipt of a 5GMM STATUS message in the AMF, </condition> <action> no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. </action> </control> The local actions to be taken by the AMF on receipt of a 5GMM STATUS message are implementation dependent.
5.4.7 Network slice-specific authentication and authorization procedure
5.4.7.1 General
The purpose of the network slice-specific authentication and authorization procedure is to enable the authentication, authorization and accounting server (AAA-S) via the Network Slice Specific and SNPN Authentication and Authorization Function (NSSAAF) to (re-)authenticate or (re-)authorize the upper layers of the UE.
The network slice-specific authentication and authorization procedure can be invoked for a UE supporting network slice-specific authentication and authorization procedure and for a HPLMN S-NSSAI or an SNPN S-NSSAI (see subclauses 5.15.10 and 5.30.2.9 in 3GPP TS 23.501 and subclause 4.2.9.2 of 3GPP TS 23.502 ).
The network (re-)authenticates the UE using the EAP as specified in IETF RFC 3748 . EAP has defined four types of EAP messages: a) an EAP-request message; b) an EAP-response message; c) an EAP-success message; and d) an EAP-failure message.
<control> <action> The EAP-request message is transported from the network to the UE using the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message of the network slice-specific EAP message reliable transport procedure. </action> </control>
<control> <action> The EAP-response message to the EAP-request message is transported from the UE to the network using the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message of the network slice-specific EAP message reliable transport procedure. </action> </control>
<control> <condition> If the (re-)authentication of the UE completes successfully or unsuccessfully, </condition> <action> the EAP-success message or the EAP- failure message, respectively, is transported from the network to the UE using the NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message of the network slice-specific result message transport procedure. </action> </control>
There can be several rounds of exchange of an EAP-request message and a related EAP-response message for the AAA-S via the NSSAAF to complete the (re-)authentication and (re-)authorization of the request for an S-NSSAI (see example in figure 5.4.7.1.1).
<control> <action> The AMF shall set the authenticator retransmission timer specified in subclause 4.3 of IETF RFC 3748 to infinite </action> </control>
NOTE: The network slice-specific authentication and authorization procedure provides a reliable transport of EAP messages and therefore retransmissions at the EAP layer of the AMF do not occur.
5.4.7.2 Network slice-specific EAP message reliable transport procedure
5.4.7.2.1 Network slice-specific EAP message reliable transport procedure initiation
<control> <condition> In order to initiate the network slice-specific EAP message reliable transport procedure, </condition> <action> the AMF shall create a NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message. </action> </control>
<control> <action> The AMF shall set the EAP message IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message to the EAP-request message </action> <condition> which is generated by the AMF or provided by the AAA-S via the NSSAAF. </condition> </control>
<control> <action> The AMF shall set the S-NSSAI IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message to the HPLMN S-NSSAI or the SNPN S-NSSAI </action> <condition> to which the EAP-request message is related. </condition> </control>
<control> <action> The AMF shall send the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message and start timer T3575 per S-NSSAI (see example in figure 5.4.7.1.1). </action> </control>
<control> <condition> Upon receipt of a NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message, </condition> <action> the UE shall stop timer T3346 </action> <condition> if running. </condition> <action> The UE shall pass: a) the EAP-request message received in the EAP message IE; and b) the HPLMN S-NSSAI or the SNPN S-NSSAI in the S-NSSAI IE; to the upper layers. </action> Apart from this action, the network slice-specific authentication and authorization procedure is transparent to the 5GMM layer of the UE. </control>
5.4.7.2.2 Network slice-specific EAP message reliable transport procedure accepted by the UE
<control> <condition> When the upper layers provide an EAP-response message associated with the HPLMN S-NSSAI or the SNPN S- NSSAI, </condition> <action> the UE shall create a NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message. </action> </control>
<control> <action> The UE shall set the EAP message IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message to the EAP-response message. </action> </control>
<control> <action> The UE shall set the S-NSSAI IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message to the HPLMN S-NSSAI or the SNPN S-NSSAI associated with the EAP-response message. </action> </control>
<control> <action> The UE shall send the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message. </action> Apart from this action, the network slice-specific authentication and authorization procedure is transparent to the 5GMM layer of the UE. </control>
<control> <condition> Upon receipt of a NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message, </condition> <action> the AMF shall stop timer T3575 </action> and: a) <action> pass the EAP-response message received in the EAP message IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message associated with the HPLMN S-NSSAI or the SNPN S-NSSAI in the S-NSSAI IE to the upper layers; </action> or b) <action> provide the EAP-response message received in the EAP message IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message associated with the HPLMN S-NSSAI or the SNPN S-NSSAI in the S-NSSAI IE to the AAA-S via the NSSAAF. </action> </control>
5.4.7.2.3 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) T3575 expiry </condition> </control> <control> The AMF shall, <condition> on the first expiry of the timer T3575, </condition> <action> retransmit the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message </action> and <action> shall reset and start timer T3575. </action> <action> This retransmission is repeated four times, </action> </control> i.e. <control> <condition> on the fifth expiry of timer T3575, </condition> <action> the AMF shall abort the network slice-specific authentication and authorization procedure for the S-NSSAI. </action> <action> The AMF shall consider that the network slice- specific authentication and authorization procedure for the S-NSSAI is completed as a failure. </action> </control>
<control> <condition> b) Lower layers indication of non-delivered NAS PDU <condition> due to handover </condition> </condition> </control> <control> <condition> <condition> If the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message could not be delivered <condition> due to an intra AMF handover </condition> and <condition> the target TAI is included in the TAI list, </condition> </condition> </condition> then <control> <condition> upon successful completion of the intra AMF handover </condition> <action> the AMF shall retransmit the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message. </action> </control> <control> <condition> <condition> If a failure of handover procedure is reported by the lower layer </condition> and <condition> the N1 NAS signalling connection exists, </condition> </condition> <action> the AMF shall retransmit the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message. </action> </control> </control>
<control> <condition> c) Network slice-specific authentication and authorization procedure and de-registration procedure collision </condition> </control> <control> <condition> <condition> If the network receives a DEREGISTRATION REQUEST message <condition> before the ongoing network slice-specific authentication </condition> and <condition> authorization procedure has been completed </condition> and <condition> the access type included in the DEREGISTRATION REQUEST message <condition> > is the same as the one <condition> for which the network slice-specific authentication and authorization procedure is ongoing, </condition> </condition> </condition> </condition> </condition> <action> the network shall abort the network slice-specific authentication and authorization procedure </action> and <action> shall progress the UE-initiated de-registration procedure. </action> <action> The AMF may initiate the network slice-specific authentication and authorization procedure for the S-NSSAI which is completed as a failure, </action> <condition> if available. </condition> <control> <condition> If the access type included in the DEREGISTRATION REQUEST message is different from the one <condition> for which the network slice-specific authentication and authorization procedure is ongoing, </condition> </condition> <action> the network shall proceed with both procedures. </action> </control> </control>
5.4.7.2.4 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) Transmission failure of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message <condition> with change in the current TAI </condition> </condition> <control> <condition> If the current TAI is not in the TAI list, </condition> <action> the network slice-specific authentication and authorization procedure shall be aborted </action> and: <control> a) <condition> if the UE is in 5GMM-REGISTERED state, </condition> <action> a registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message shall be initiated; </action> </control> and <control> <condition> b) otherwise </condition> <action> a registration procedure for initial registration shall be initiated. </action> </control> </control> </control>
<control> <condition> b) Transmission failure of NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message indication without change in the current TAI </condition> </control>
It is up to the UE implementation how to re-run the ongoing procedure that triggered the network slice-specific authentication and authorization procedure.
<control> <condition> c) Network slice-specific authentication and authorization procedure and de-registration procedure collision </condition> <control> <condition> <condition> If the UE receives NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message <condition> after sending a DEREGISTRATION REQUEST message </condition> </condition> and <condition> the access type included in the DEREGISTRATION REQUEST message is the same as the access <condition> in which the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message is received, </condition> </condition> </condition> <action> then the UE shall ignore the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message and proceed with the de-registration procedure. </action> </control> <control> <condition> Otherwise, </condition> <action> the UE shall proceed with both procedures. </action> </control> </control>
5.4.7.3 Network slice-specific EAP result message transport procedure
5.4.7.3.1 Network slice-specific EAP result message transport procedure initiation
<control> <condition> In order to initiate the network slice-specific EAP result message transport procedure, </condition> <action> the AMF shall create a NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message. </action> </control>
<control> <action> The AMF shall set the EAP message IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message to the EAP-success or EAP-failure message provided by the AAA-S via the NSSAAF. </action> </control>
<control> <action> The AMF shall set the S-NSSAI IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message to the HPLMN S-NSSAI or the SNPN S-NSSAI to which the EAP-success or EAP-failure message is related. </action> </control>
<control> <action> The AMF shall send the NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message. </action> </control> <control> <action> The AMF shall retain the authentication result for the UE and the HPLMN S-NSSAI or the SNPN S-NSSAI </action> <condition> while the UE is registered to the PLMN (see subclause 5.15.10 in 3GPP TS 23.501 ). </condition> </control>
<control> <condition> Upon receipt of a NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message, </condition> the UE shall pass:a) <action> the EAP-success or EAP-failure message received in the EAP message IE; </action> and b) <action> the HPLMN S-NSSAI or the SNPN S-NSSAI in the S-NSSAI IE; to the upper layers. </action> Apart from this action, the network slice-specific authentication and authorization procedure is transparent to the 5GMM layer of the UE. </control>
5.5 5GMM specific procedures
5.5.1 Registration procedure
5.5.1.1 General
<control> <action> The registration procedure is always initiated by the UE and used for initial registration as specified in subclause 5.5.1.2.2 </action> <action> mobility and periodic registration update as specified in subclause 5.5.1.3.2. </action> </control>
<control> <condition> When the UE needs to initiate registration over both 3GPP access and non-3GPP access in the same PLMN (e.g. the 3GPP access and the selected N3IWF are located in the same PLMN), </condition> UE: <control> <condition> a) in 5GMM-REGISTERED-INITIATED over 3GPP access </condition> <action> shall not initiate registration over non-3GPP access; </action> </control> or <control> <condition> b) in 5GMM-REGISTERED-INITIATED over non-3GPP access </condition> <action> shall not initiate registration over 3GPP access. </action> </control> NOTE 1: <control> <action> To which access (i.e. 3GPP access or non-3GPP access) the UE initiates registration first is up to UE implementation </action> </control> <control> <condition> When the UE is registered with a PLMN over a non-3GPP access, </condition> <action> the AMF and the UE maintain: a) registration state and state machine over non-3GPP access; b) 5G NAS security context; c) 5G-GUTI; d) registration area for non-3GPP access, which is associated with a single TAI; and e) non-3GPP de-registration timer in the UE and non-3GPP implicit de-registration timer in the AMF. </action> </control> </control>
A registration attempt counter is used to limit the number of subsequently rejected registration attempts. The registration attempt counter shall be incremented as specified in subclause 5.5.1.2.7 or subclause 5.5.1.3.7.
<control> <condition> Depending on the value of the registration attempt counter, </condition> <action> specific actions shall be performed. </action> <action> The registration attempt counter shall be reset </action> <condition> when: <condition> a) the UE is powered on; </condition> <condition> b) a USIM is inserted; </condition> <condition> c) a registration procedure is successfully completed; </condition> <condition> d) <condition> an EPS attach or combined EPS attach procedure is successfully completed in S1 mode </condition> and <condition> the UE is operating in single-registration mode. </condition> </condition> <action> In this case, the UE shall reset the registration attempt counter for 3GPP access; </action> </condition> NOTE 2: The registration attempt counter for non-3GPP access is not impacted by the EPS attach and the combined EPS attach procedure. <condition> e) a registration procedure is rejected with cause #11, #12, #13, #15, #27, #31, #62, #72, #73, #74, #75, #76, #77 or #78; </condition> <condition> f) <condition> a registration procedure is rejected with cause #3, #6 or #7, </condition> <condition> the REGISTRATION REJECT message is received without integrity protection </condition> and <condition> the counter for "SIM/USIM considered invalid for GPRS services" events has a value less than a UE implementation-specific maximum value. </condition> </condition> <condition> g) a network initiated deregistration procedure is completed with cause #11, #12, #13, #15, #27, #62, #72, #74, #75, #76, #77 or #78; </condition> or <condition> h) a new PLMN or SNPN is selected. </condition> </control>
<control> Additionally, <action> the registration attempt counter shall be reset </action> <start_state> when the UE is in substate 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION or 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE, </start_state> and: <condition> <condition> a) the current TAI is changed; </condition> <condition> b) timer T3502 expires; </condition> or <condition> c) timer T3346 is started. </condition> </condition> </control>
<control> <condition> When the registration attempt counter is reset, </condition> <action> the UE shall stop timer T3519 if running, and delete any stored SUCI. </action> </control>
The lower layers indicate to NAS whether the network supports emergency services for the UE in limited service state (see 3GPP TS 38.331 ). This information is taken into account when deciding whether to initiate an initial registration for emergency services.
5.5.1.2 Registration procedure for initial registration
5.5.1.2.1 General
This procedure can be used by a UE for initial registration for 5GS services.
<control> <condition> When the UE initiates the registration procedure for initial registration, </condition> <action> the UE shall indicate "initial registration" in the 5GS registration type IE. </action> </control> <control> <condition> When the UE initiates the registration procedure for emergency services, </condition> <action> the UE shall indicate "emergency registration" in the 5GS registration type IE. </action> </control> <control> <condition> When the UE initiates the initial registration for onboarding services in SNPN, </condition> <action> the UE shall indicate "SNPN onboarding registration" in the 5GS registration type IE. </action> </control> <control> <condition> When the UE initiates the initial registration procedure for disaster roaming services, </condition> <action> the UE shall indicate "disaster roaming initial registration" in the 5GS registration type IE. </action> </control>
<control> <condition> <condition> If the MUSIM UE initiates the registration procedure for initial registration </condition> and <condition> indicates "emergency registration" in the 5GS registration type IE in the REGISTRATION REQUEST message, </condition> </condition> <action> the network shall not indicate the support of: a) the N1 NAS signalling connection release; b) the paging indication for voice services; c) the reject paging request; or d) the paging restriction; in the REGISTRATION ACCEPT message. </action> </control>
5.5.1.2.2 Initial registration initiation
<control> <start_state> The UE in state 5GMM-DEREGISTERED </start_state> <action> shall initiate the registration procedure for initial registration by sending a REGISTRATION REQUEST message to the AMF, </action> </control>
<control> <condition> a) when the UE performs initial registration for 5GS services; </condition> </control>
<control> <condition> b) when the UE performs initial registration for emergency services; </condition> </control>
<control> <condition> c) when the UE performs initial registration for SMS over NAS; </condition> </control>
<control> <condition> d) <condition> when the UE moves from GERAN to NG-RAN coverage </condition> or <condition> <condition> the UE moves from a UTRAN to NG-RAN coverage </condition> and the following applies: </condition> </condition> </control>
<control> <condition> 1) the UE initiated a GPRS attach or routing area updating procedure while in A/Gb mode or Iu mode; </condition> </control> or
<control> <condition> 2) the UE has performed 5G-SRVCC from NG-RAN to UTRAN as specified in 3GPP TS 23.216 , </condition> and <condition> <condition> since then the UE did not perform a successful EPS attach or tracking area updating procedure in S1 mode </condition> or <condition> registration procedure in N1 mode; </condition> </condition> </control>
<control> <condition> e) when the UE performs initial registration for onboarding services in SNPN; </condition> and </control>
<control> <condition> f) when the UE performs initial registration for disaster roaming services; </condition> with the following clarifications to initial registration for emergency services: </control>
<control> a) <action> the UE shall not initiate an initial registration for emergency services over the current access, </action> <condition> <condition> if the UE is already registered for emergency services over the non-current access, </condition> <condition> unless the initial registration has to be initiated to perform handover of an existing emergency PDU session from the non-current access to the current access; </condition> </condition> </control> and NOTE 1: Transfer of an existing emergency PDU session between 3GPP access and non-3GPP access is needed e.g. if the UE determines that the current access is no longer available.
<control> b) <action> the UE can only initiate an initial registration for emergency services over non-3GPP access </action> <condition> if it cannot register for emergency services over 3GPP access. </condition> </control>
<control> <condition> The UE initiates the registration procedure for initial registration </condition> <action> by sending a REGISTRATION REQUEST message to the AMF, </action> <action> starting timer T3510. </action> <control> <condition> If timer T3502 is currently running, </condition> <action> the UE shall stop timer T3502. </action> </control> <control> <condition> If timer T3511 is currently running, </condition> <action> the UE shall stop timer T3511. </action> </control> </control>
<control> <condition> During initial registration </condition> <action> the UE handles the 5GS mobile identity IE in the following order: </action> </control>
<control> <condition> i) was previously registered in S1 mode before entering state EMM-DEREGISTERED; </condition> </control> and
<control> <condition> ii) has received an "interworking without N26 interface not supported" indication from the network; </condition> </control> and
<control> <condition> 2) EPS security context and a valid native 4G-GUTI are available; </condition> </control>
<control> <action> then the UE shall create a 5G-GUTI mapped from the valid native 4G-GUTI as specified in 3GPP TS 23.003 </action> and <action> indicate the mapped 5G-GUTI in the 5GS mobile identity IE. </action> <action> The UE shall include the UE status IE with the EMM registration status set to "UE is not in EMM-REGISTERED state" </action> and <action> shall include an ATTACH REQUEST message as specified in 3GPP TS 24.301 in the EPS NAS message container IE. </action> </control>
<control> Additionally, <condition> if the UE holds a valid 5G-GUTI, </condition> <action> the UE shall include the 5G-GUTI in the Additional GUTI IE in the REGISTRATION REQUEST message in the following order: </action> </control>
<control> <condition> 1) <condition> a valid 5G-GUTI that was previously assigned by the same PLMN </condition> <condition> with which the UE is performing the registration, </condition> <condition> if available; </condition> </condition> </control>
<control> <condition> 2) <condition> a valid 5G-GUTI that was previously assigned by an equivalent PLMN, </condition> <condition> if available; </condition> </condition> </control> and
<control> <condition> 3) <condition> a valid 5G-GUTI that was previously assigned by any other PLMN, </condition> <condition> if available; </condition> </condition> </control>
<control> 1) <condition> <condition> if the UE is registering with a PLMN and the UE holds a valid 5G-GUTI that was previously assigned, </condition> <condition> over 3GPP access or non-3GPP access, <condition> </condition> by the same PLMN </condition> <condition> with which the UE is performing the registration, </condition> </condition> <action> the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE; </action> </control> or <control> 2) <condition> <condition> if the UE is registering with a SNPN, </condition> <condition> the UE holds a valid 5G-GUTI that was previously assigned, </condition> <condition> over 3GPP access or non-3GPP access, </condition> <condition> by the same SNPN with which the UE is performing the registration, </condition> and <condition> the UE is not initiating the initial registration for onboarding services in SNPN, </condition> </condition> <action> the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE; </action> </control> <control> <condition> c) <condition> if the UE holds a valid 5G-GUTI that was previously assigned, </condition> <condition> over 3GPP access or non-3GPP access, </condition> <condition> by an equivalent PLMN, </condition> </condition> <action> the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE; </action> </control>
<control> <condition> 1) <condition> <condition> the UE is registering with a PLMN </condition> and <condition> the UE holds a valid 5G-GUTI that was previously assigned, </condition> </condition> <condition> over 3GPP access or non-3GPP access, </condition> <condition> by any other PLMN, </condition> </condition> <action> the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE; </action> </control> or <control> 2) <condition> <condition> the UE is registering with an SNPN, </condition> <condition> the UE holds a valid 5G-GUTI that was previously assigned, </condition> <condition> over 3GPP access or non-3GPP access, </condition> <condition> by any other SNPN, </condition> and <condition> the UE is not initiating the initial registration for onboarding services in SNPN, </condition> </condition> <action> the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE </action> and <action> shall additionally include the NID of the other SNPN in the NID IE; </action> </control>
<control> <condition> e) <condition> if a SUCI other than an onboarding SUCI is available, </condition> and <condition> the UE is not initiating the initial registration for onboarding services in SNPN, </condition> <action> the UE shall include the SUCI other than an onboarding SUCI in the 5GS mobile identity IE; </action> </condition> </control> <control> <condition> f) <condition> if the UE does not hold a valid 5G-GUTI or SUCI other than an onboarding SUCI, </condition> and <condition> is initiating the initial registration for emergency services, </condition> <action> the PEI shall be included in the 5GS mobile identity IE; </action> </condition> </control> and <control> <condition> g) if the UE is initiating the initial registration for onboarding services in SNPN, </condition> <action> an onboarding SUCI shall be included in the 5GS mobile identity IE. </action> </control>
NOTE 2: The AMF in ON-SNPN uses the onboarding SUCI as specified in 3GPP TS 23.501 .
<control> <condition> <condition> If the SUCI is included in the 5GS mobile identity IE </condition> and <condition> the timer T3519 is not running, </condition> </condition> <action> the UE shall start timer T3519 </action> and <action> store the value of the SUCI sent in the REGISTRATION REQUEST message. </action> <control> <action> The UE shall include the stored SUCI in the REGISTRATION REQUEST message </action> <condition> while timer T3519 is running. </condition> </control> </control>
<control> <condition> If the UE is operating in the dual-registration mode </condition> and <start_state> it is in EMM state EMM-REGISTERED, </start_state> <action> the UE shall include the UE status IE with the EMM registration status set to "UE is in EMM-REGISTERED state". </action> </control>
NOTE 3: Inclusion of the UE status IE with this setting corresponds to the indication that the UE is "moving from EPC" as specified in 3GPP TS 23.502 .
NOTE 4: The value of the 5GMM registration status included by the UE in the UE status IE is not used by the AMF.
<control> <condition> If the last visited registered TAI is available, </condition> <action> the UE shall include the last visited registered TAI in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE requests the use of SMS over NAS, </condition> <action> the UE shall include the 5GS update type IE in the REGISTRATION REQUEST message with the SMS requested bit set to "SMS over NAS supported". </action> <control> <condition> <condition> When the 5GS update type IE is included in the REGISTRATION REQUEST for reasons other than requesting the use of SMS over NAS, </condition> and <condition> the UE does not need to register for SMS over NAS, </condition> </condition> <action> the UE shall set the SMS requested bit of the 5GS update type IE to "SMS over NAS not supported" in the REGISTRATION REQUEST message. </action> </control> </control>
<control> <condition> If the UE needs to use the UE specific DRX parameters, </condition> <action> the UE shall include the Requested DRX parameters IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE is in NB-N1 mode </condition> and <condition> if the UE needs to use the UE specific DRX parameters for NB-N1 mode, </condition> </condition> <action> the UE shall include the Requested NB-N1 mode DRX parameters IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports eDRX and requests the use of eDRX, </condition> <action> the UE shall include the Requested extended DRX parameters IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE needs to request LADN information for specific LADN DNN(s) </condition> or <condition> indicates a request for LADN information as specified in 3GPP TS 23.501 , </condition> </condition> <action> the UE shall include the LADN indication IE in the REGISTRATION REQUEST message </action> and: <action> a) request specific LADN DNNs by including a LADN DNN value in the LADN indication IE for each LADN DNN for which the UE requests LADN information; </action> or <action> b) to indicate a request for LADN information by not including any LADN DNN value in the LADN indication IE. </action> </control>
<control> <action> The UE shall include the requested NSSAI containing the S-NSSAI(s) corresponding to the slice(s) to which the UE intends to register with </action> and <action> shall include the mapped S-NSSAI(s) for the requested NSSAI, </action> <condition> <condition> if available, </condition> <condition> in the REGISTRATION REQUEST message. </condition> </condition> <control> <condition> If the UE has allowed NSSAI or configured NSSAI or both for the current PLMN or SNPN, </condition> <action> the requested NSSAI shall be either: <action> a) the configured NSSAI for the current PLMN or SNPN, </action> or <action> a subset thereof as described below; </action> <action> b) the allowed NSSAI for the current PLMN or SNPN, </action> or <action> a subset thereof as described below; </action> or <action> c) the allowed NSSAI for the current PLMN or SNPN, </action> or <action> a subset thereof as described below, plus one or more S- NSSAIs from the configured NSSAI for which no corresponding S-NSSAI is present in the allowed NSSAI </action> and <action> those are neither in the rejected NSSAI nor in the pending NSSAI. </action> </action> </control> </control>
<control> <condition> <condition> <condition> If the UE has neither allowed NSSAI for the current PLMN or SNPN </condition> nor <condition> configured NSSAI for the current PLMN or SNPN </condition> </condition> and <condition> has a default configured NSSAI, </condition> </condition> the UE shall: <action> a) include the S-NSSAI(s) in the Requested NSSAI IE of the REGISTRATION REQUEST message using the default configured NSSAI; </action> and <action> b) include the Network slicing indication IE with the Default configured NSSAI indication bit set to "Requested NSSAI created from default configured NSSAI" in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE has no allowed NSSAI for the current PLMN or SNPN, </condition> <condition> no configured NSSAI for the current PLMN or SNPN, </condition> and <condition> no default configured NSSAI, </condition> </condition> <action> the UE shall not include a requested NSSAI in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If all the S-NSSAI(s) corresponding to the slice(s) to which the UE intends to register are included in the pending NSSAI, </condition> <action> the UE shall not include a requested NSSAI in the REGISTRATION REQUEST message. </action> </control>
<control> The subset of configured NSSAI provided in the requested NSSAI consists of one or more S-NSSAIs in the configured NSSAI applicable to the current PLMN or SNPN, <condition> if the S-NSSAI is neither in the rejected NSSAI nor associated to the S-NSSAI(s) in the rejected NSSAI. </condition> </control> <control> In addition, <condition> if the NSSRG information is available, </condition> <action> the subset of configured NSSAI provided in the requested NSSAI shall be associated with at least one common NSSRG value. </action> <control> <condition> <condition> If the UE is in 5GMM- REGISTERED state over the other access </condition> and <condition> has already an allowed NSSAI for the other access, </condition> </condition> <action> all the S-NSSAI(s) in the requested NSSAI for the current access shall share at least an NSSRG value common to all the S-NSSAI(s) of the allowed NSSAI for the other access. </action> </control> <control> <condition> If the UE is simultaneously performing the registration procedure on the other access, </condition> <action> the UE shall include S-NSSAIs that share at least a common NSSRG value across all access types. </action> </control> </control>
NOTE 5: <control> <condition> If the UE has stored mapped S-NSSAI(s) for the rejected NSSAI, and one or more S-NSSAIs in the stored mapped S-NSSAI(s) for the configured NSSAI are not included in the stored mapped S-NSSAI(s) for the rejected NSSAI, </condition> then a S-NSSAI in the configured NSSAI associated to one or more of these mapped S-NSSAI(s) for the configured NSSAI are available to be included in the requested NSSAI together with their mapped S-NSSAI. </control>
NOTE 6: <control> <condition> If one or more mapped S-NSSAIs in the stored mapped S-NSSAI(s) for the configured NSSAI are not included in the stored rejected NSSAI for the failed or revoked NSSAA, </condition> a S-NSSAI in the configured NSSAI associated to one or more of these mapped S-NSSAI(s) for the configured NSSAI are available to be included in the registration request together with their mapped S-NSSAI. </control>
The subset of allowed NSSAI provided in the requested NSSAI consists of one or more S-NSSAIs in the allowed NSSAI for the current PLMN.
NOTE 7: How the UE selects the subset of configured NSSAI or allowed NSSAI to be provided in the requested NSSAI is implementation specific. The UE can take preferences indicated by the upper layers (e.g. policies like URSP, applications) and UE local configuration into account.
NOTE 8: The number of S-NSSAI(s) included in the requested NSSAI cannot exceed eight.
<control> <condition> If the UE initiates an initial registration for onboarding services in SNPN, </condition> <action> the UE shall not include the Requested NSSAI IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports NSAG, </condition> <action> the UE shall set the NSAG bit to "NSAG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE initiates an initial registration for emergency services </condition> or <condition> needs to prolong the established NAS signalling connection after the completion of the initial registration procedure (e.g. due to uplink signalling pending), </condition> </condition> <action> the UE shall set the Follow-on request indicator to "Follow-on request pending". </action> </control>
NOTE 9: The UE does not have to set the Follow-on request indicator to 1, even if the UE has to request resources for V2X communication over PC5 reference point, 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5.
<control> <condition> If the UE supports S1 mode and the 5GS registration type IE in the REGISTRATION REQUEST message is not set to "disaster roaming initial registration", </condition> <control> the UE shall: <action> a) set the S1 mode bit to "S1 mode supported" in the 5GMM capability IE of the REGISTRATION REQUEST message; </action> </control> <control> b) <action> include the S1 UE network capability IE in the REGISTRATION REQUEST message; </action> <control> additionally, <condition> if the UE supports EPS-UPIP, </condition> <action> the UE shall set the EPS-UPIP bit to "EPS-UPIP supported" in the S1 UE network capability IE in the REGISTRATION REQUEST message; </action> </control> and <control> <condition> c) if the UE supports sending an ATTACH REQUEST message containing a PDN CONNECTIVITY REQUEST message with request type set to "handover" to transfer a PDU session from N1 mode to S1 mode, </condition> <action> set the HO attach bit to "attach request message containing PDN connectivity request with request type set to handover to transfer PDU session from N1 mode to S1 mode supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> </control> </control>
<control> <condition> If the UE supports the LTE positioning protocol (LPP) in N1 mode as specified in 3GPP TS 37.355 , </condition> <action> the UE shall set the LPP bit to "LPP in N1 mode supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports the Location Services (LCS) notification mechanisms in N1 mode as specified in 3GPP TS 23.273 , </condition> <action> the UE shall set the 5G-LCS bit to "LCS notification mechanisms supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE is in NB-N1 mode, </condition> <action> then the UE shall set the Control plane CIoT 5GS optimization bit to "Control plane CIoT 5GS optimization supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> <control> <condition> If the UE is capable of NB-S1 mode, </condition> <action> then the UE shall set the Control plane CIoT EPS optimization bit to "Control plane CIoT EPS optimization supported" in the S1 UE network capability IE of the REGISTRATION REQUEST message. </action> </control> </control>
<control> <condition> If the UE supports N3 data transfer and multiple user-plane resources in NB-N1 mode (see 3GPP TS 36.306 , 3GPP TS 36.331 ), </condition> <action> then the UE shall set the Multiple user-plane resources support bit to "Multiple user-plane resources supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports 5G-SRVCC from NG-RAN to UTRAN as specified in 3GPP TS 23.216 , </condition> the UE shall: <control> a) <action> set the 5G-SRVCC from NG-RAN to UTRAN capability bit to "5G-SRVCC from NG-RAN to UTRAN supported" in the 5GMM capability IE of the REGISTRATION REQUEST message; </action> </control> and <control> b) <action> include the Mobile station classmark 2 IE and the Supported codecs IE in the REGISTRATION REQUEST message. </action> </control> </control>
<control> <condition> If the UE supports service gap control, </condition> <action> then the UE shall set the SGC bit to "service gap control supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports the restriction on use of enhanced coverage, </condition> <action> the UE shall set the RestrictEC bit to "Restriction on use of enhanced coverage supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports network slice-specific authentication and authorization, </condition> <action> the UE shall set the NSSAA bit to "network slice-specific authentication </action> and <action> authorization supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports CAG feature, </condition> <action> the UE shall set the CAG bit to "CAG Supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports extended CAG information list, </condition> <action> the UE shall set the Ex-CAG bit to "Extended CAG information list supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> When the UE is not in NB-N1 mode, </condition> <condition> if the UE supports RACS, </condition> </condition> the UE shall: <control> a) <action> set the RACS bit to "RACS supported" in the 5GMM capability IE of the REGISTRATION REQUEST message; </action> </control> <control> <condition> b) if the UE has an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN or SNPN, </condition> <action> include the applicable network-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message; </action> </control> and <control> c) <condition> if the UE: <condition> 1) does not have an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN or SNPN; </condition> and <condition> 2) has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration, </condition> </condition> <action> include the applicable manufacturer-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message. </action> </control> </control>
<control> <condition> If the UE has one or more stored UE policy sections: <condition> a) identified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN; </condition> or <condition> b) identified by a UPSI with the PLMN ID part indicating the PLMN ID part of the SNPN identity of the selected SNPN and associated with the NID of the selected SNPN; </condition> </condition> <action> then the UE shall set the Payload container type IE to "UE policy container" </action> and <condition> include the UE STATE INDICATION message (see annex D) in the Payload container IE of the REGISTRATION REQUEST message. </condition> </control>
NOTE 10: In this version of the protocol, the UE can only include the Payload container IE in the REGISTRATION REQUEST message to carry a payload of type "UE policy container".
<control> <condition> If the UE does not have a valid 5G NAS security context, </condition> <action> the UE shall send the REGISTRATION REQUEST message without including the NAS message container IE. </action> <control> <action> The UE shall include the entire REGISTRATION REQUEST message (i.e. containing cleartext IEs and non-cleartext IEs, if any) in the NAS message container IE that is sent as part of the SECURITY MODE COMPLETE message as described in subclauses 4.4.6 and 5.4.2.3. </action> </control> </control>
<control> <condition> <condition> If the UE has a valid 5G NAS security context </condition> and <condition> the UE needs to send non-cleartext IEs, </condition> </condition> <action> the UE shall send a REGISTRATION REQUEST message including the NAS message container IE as described in subclause 4.4.6. </action> </control> <control> <condition> If the UE does not need to send non-cleartext IEs, </condition> <action> the UE shall send a REGISTRATION REQUEST message without including the NAS message container IE. </action> </control>
<control> <condition> <condition> If the UE supports ciphered broadcast assistance data </condition> and <condition> needs to obtain new ciphering keys, </condition> <action> the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the REGISTRATION REQUEST message. </action> </condition> </control>
<control> <action> The UE shall set the WUSA bit to "WUS assistance information reception supported" in the 5GMM capability IE </action> <condition> if the UE supports WUS assistance information. </condition> <control> <action> The UE may include its UE paging probability information in the Requested WUS assistance information IE </action> <condition> <condition> if the UE has set the WUSA bit to "WUS assistance information reception supported" in the 5GMM capability IE </condition> and <condition> the UE is not performing the initial registration for emergency services. </condition> </condition> </control> </control>
<control> <action> The UE shall set the NR-PSSI bit to "NR paging subgrouping supported" in the 5GMM capability IE </action> <condition> <condition> if the UE supports PEIPS assistance information </condition> and <condition> the 5GS registration type IE in the REGISTRATION REQUEST message is not set to "emergency registration". </condition> </condition> <control> <action> The UE may include its UE paging probability information in the Requested PEIPS assistance information IE </action> <condition> if the UE has set the NR-PSSI bit to "NR paging subgrouping supported" in the 5GMM capability IE. </condition> </control> </control>
<control> <condition> If the REGISTRATION REQUEST message includes a NAS message container IE, </condition> <action> the AMF shall process the REGISTRATION REQUEST message that is obtained from the NAS message container IE as described in subclause 4.4.6. </action> </control>
<control> <condition> If the UE supports V2X as specified in 3GPP TS 24.587, </condition> <action> the UE shall set the V2X bit to "V2X supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE supports V2X communication over E- UTRA-PC5 as specified in 3GPP TS 24.587 , </condition> <action> the UE shall set the V2XCEPC5 bit to "V2X communication over E-UTRA-PC5 supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE supports V2X communication over NR-PC5 as specified in 3GPP TS 24.587 , </condition> <action> the UE shall set the V2XCNPC5 bit to "V2X communication over NR-PC5 supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <action> The UE shall set the ER-NSSAI bit to "Extended rejected NSSAI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports the NSSRG, </condition> <action> then the UE shall set the NSSRG bit to "NSSRG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the W-AGF acting on behalf of an N5GC device initiates an initial registration as specified in 3GPP TS 23.316, </condition> <action> the W-AGF acting on behalf of the N5GC device shall include the N5GC indication IE with the N5GC device indication bit set to "N5GC device registration is requested" in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> When the UE supporting UAS services initiates an initial registration for UAS services, </condition> <action> the UE shall include the service-level device ID in the Service-level-AA container IE of the REGISTRATION REQUEST message </action> and <action> set the value to the CAA-level UAV ID. </action> <control> <action> The UE shall include the service-level-AA server address in the Service-level-AA container IE of the REGISTRATION REQUEST message and set the value to the USS address, </action> <condition> if it is provided by the upper layers. </condition> </control> </control>
<control> <condition> If the UE supports 5G ProSe direct discovery as specified in 3GPP TS 24.554 , </condition> <action> the UE shall set the 5G ProSe-dd bit to "5G ProSe direct discovery supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports 5G ProSe direct communication as specified in 3GPP TS 24.554 , </condition> <action> the UE shall set the 5G ProSe-dc bit to "5G ProSe direct communication supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE supports acting as 5G ProSe layer-2 UE-to-network relay UE as specified in 3GPP TS 24.554 , </condition> <action> the UE shall set the 5G ProSe-l2relay bit to "Acting as a 5G ProSe layer-2 UE-to-network relay UE supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE supports acting as 5G ProSe layer-3 UE-to-network relay UE as specified in 3GPP TS 24.554 , </condition> <action> the UE shall set the 5G ProSe-l3relay bit to "Acting as a 5G ProSe layer-3 UE-to-network relay UE supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE supports acting as 5G ProSe layer-2 UE-to-network remote UE as specified in 3GPP TS 24.554 , </condition> <action> the UE shall set the 5G ProSe-l2rmt bit to "Acting as a 5G ProSe layer-2 UE-to- network remote UE supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE supports acting as 5G ProSe layer-3 UE-to-network remote UE as specified in 3GPP TS 24.554 , </condition> <action> the UE shall set the 5G ProSe-l3rmt bit to "Acting as a 5G ProSe layer-3 UE-to-network remote UE supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the MUSIM UE supports the N1 NAS signalling connection release, </condition> <action> then the UE shall set the N1 NAS signalling connection release bit to "N1 NAS signalling connection release supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </action> <condition> otherwise </condition> <action> the UE shall not set the N1 NAS signalling connection release bit to "N1 NAS signalling connection release supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the MUSIM UE supports the paging indication for voice services, </condition> <action> then the UE shall set the paging indication for voice services bit to "paging indication for voice services supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </action> <condition> otherwise </condition> <action> the UE shall not set the paging indication for voice services bit to "paging indication for voice services supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the MUSIM UE supports the reject paging request, </condition> <action> then the UE shall set the reject paging request bit to "reject paging request supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </action> <condition> otherwise </condition> <action> the UE shall not set the reject paging request bit to "reject paging request supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the MUSIM UE sets: <condition> a) the reject paging request bit to "reject paging request supported"; </condition> <condition> b) the N1 NAS signalling connection release bit to "N1 NAS signalling connection release supported"; </condition> or <condition> c) both of them; </condition> and <condition> supports the paging restriction, </condition> </condition> <action> then the UE shall set the paging restriction bit to "paging restriction supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </action> <condition> otherwise </condition> <action> the UE shall not set the paging restriction bit to "paging restriction supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports MINT, </condition> <action> the UE shall set the MINT bit to "MINT supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE initiates the registration procedure for disaster roaming services, </condition> <condition> the UE has determined the MS determined PLMN with disaster condition as specified in 3GPP TS 23.122 </condition> and: </condition> </control> <control> <condition> a) <condition> the MS determined PLMN with disaster condition is the HPLMN </condition> and: <condition> 1) the Additional GUTI IE is included in the REGISTRATION REQUEST message and does not contain a valid 5G-GUTI that was previously assigned by the HPLMN; </condition> or <condition> 2) the Additional GUTI IE is not included in the REGISTRATION REQUEST message and the 5GS mobile identity IE contains neither the SUCI nor a valid 5G-GUTI that was previously assigned by the HPLMN; </condition> </condition> </control> <control> or <condition> b) <condition> the MS determined PLMN with disaster condition is not the HPLMN </condition> and: <condition> 1) the Additional GUTI IE is included in the REGISTRATION REQUEST message and does not contain a valid 5G-GUTI that was previously assigned by the MS determined PLMN with disaster condition; </condition> or <condition> 2) the Additional GUTI IE is not included in the REGISTRATION REQUEST message and the 5GS mobile identity IE does not contain a valid 5G-GUTI that was previously assigned by the MS determined PLMN with disaster condition; </condition> </condition> </control> <control> <action> the UE shall include in the REGISTRATION REQUEST message the MS determined PLMN with disaster condition IE indicating the MS determined PLMN with disaster condition. </action> </control>
NOTE 11: <control> <condition> If the UE initiates the registration procedure for disaster roaming services, </condition> and <condition> the MS determined PLMN with disaster condition cannot be determined when an NG-RAN cell of the PLMN broadcasts the disaster related indication as specified in 3GPP TS 23.122 , </condition> <action> the UE does not include in the REGISTRATION REQUEST message the MS determined PLMN with disaster condition IE but includes the Additional GUTI IE or the 5GS mobile identity IE or both as specified in subclauses 5.5.1.2.2. </action> </control>
<control> <condition> If the UE supports event notification, </condition> <action> the UE shall set the EventNotification bit to "Event notification supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE supports access to an SNPN using credentials from a credentials holder </condition> and <condition> the UE is in its HPLMN or EHPLMN or a subscribed SNPN, </condition> </condition> <action> the UE shall set the SSNPNSI bit to "SOR-SNPN-SI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
5.5.1.2.3 5GMM common procedure initiation
<control> <action> The network may initiate 5GMM common procedures, e.g. the identification, authentication and security procedures during the registration procedure, </action> <condition> depending on the information received in the REGISTRATION REQUEST message. </condition> </control>
<control> <condition> If two NAS security mode control procedures are needed to signal an entire unciphered REGISTRATION REQUEST message followed by signalling of selected EPS NAS security algorithms, </condition> <action> both NAS security mode control procedures should be initiated as part of 5GMM common procedures of the ongoing registration procedure (see clause 5.4.2.4). </action> </control>
<control> <condition> <condition> During a registration procedure with 5GS registration type IE set to "emergency registration", </condition> <condition> if the AMF is configured to support emergency registration for unauthenticated SUCIs, </condition> </condition> <action> the AMF may choose to skip the authentication procedure </action> <condition> even if no 5G NAS security context is available </condition> and <action> proceed directly to the execution of the security mode control procedure. </action> </control>
5.5.1.2.4 Initial registration accepted by the network
<control> <condition> During a registration procedure with 5GS registration type IE set to "emergency registration", </condition> <action> the AMF shall not check for mobility and access restrictions, regional restrictions or subscription restrictions, or CAG restrictions </action> <condition> when processing the REGISTRATION REQUEST message. </condition> </control>
<control> <condition> If the initial registration request is accepted by the network, </condition> <action> the AMF shall send a REGISTRATION ACCEPT message to the UE. </action> </control>
<control> <condition> For each of the information elements: 5GMM capability, S1 UE network capability, and UE security capability, </condition> <action> the AMF shall store all octets received from the UE in the REGISTRATION REQUEST message, up to the maximum length defined for the respective information element. </action> </control>
NOTE 1: This information is forwarded to the new AMF during inter-AMF handover or to the new MME during inter-system handover to S1 mode.
<control> <action> The AMF shall assign and include a TAI list as a registration area the UE is registered to in the REGISTRATION ACCEPT message. </action> <action> The AMF shall not assign a TAI list containing both tracking areas in NB-N1 mode and tracking areas not in NB-N1 mode. </action> </control> <control> The UE, <condition> upon receiving a REGISTRATION ACCEPT message, </condition> <action> shall delete its old TAI list and store the received TAI list. </action> </control> <control> <condition> If the REGISTRATION REQUEST message was received over non-3GPP access, </condition> <action> the AMF shall include a single TAI in the TAI list. </action> </control>
NOTE 2: For non-3GPP access, the operator can allocate a TAI per N3IWF, TNGF, TWIF or W-AGF. Each N3IWF, TNGF, TWIF or W-AGF is locally configured with a TAI. Each N3IWF, TNGF, TWIF or W- AGF can be configured with its own TAI value, or with the same TAI value as other N3IWFs, TNGFs, TWIFs or W-AGFs.
NOTE 3: When assigning the TAI list, the AMF can take into account the eNodeB's capability of support of CIoT 5GS optimization.
<control> <action> The AMF may include service area restrictions in the Service area list IE in the REGISTRATION ACCEPT message. </action> </control>
<control> The UE, <condition> upon receiving a REGISTRATION ACCEPT message with the service area restrictions </condition> <action> shall act as described in subclause 5.3.5. </action> </control>
<control> <action> The AMF may also include a list of equivalent PLMNs in the REGISTRATION ACCEPT message. </action> Each entry in the list contains a PLMN code (MCC+MNC). <action> The UE shall store the list as provided by the network, and if the initial registration procedure is not for emergency services, the UE shall remove from the list any PLMN code that is already in the forbidden PLMN list as specified in subclause 5.3.13A. </action> <action> In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. </action> <action> The UE shall replace the stored list on each receipt of the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If the REGISTRATION ACCEPT message does not contain a list, </condition> <action> then the UE shall delete the stored list. </action> </control>
<control> <condition> If the initial registration procedure is not for emergency services, </condition> <action> the UE is not registered for disaster roaming, </action> and <condition> if the PLMN identity of the registered PLMN is a member of the forbidden PLMN list as specified in subclause 5.3.13A, </condition> <action> any such PLMN identity shall be deleted from the corresponding list(s). </action> </control>
<control> <condition> If the Service area list IE is not included in the REGISTRATION ACCEPT message, </condition> <action> any tracking area in the registered PLMN and its equivalent PLMN(s) in the registration area is considered as an allowed tracking area as described in subclause 5.3.5. </action> </control>
<control> <condition> If the REGISTRATION REQUEST message contains the LADN indication IE, based on the LADN indication IE, UE subscription information, UE location and local configuration about LADN </condition> and: <control> <condition> a) <condition> if the LADN indication IE includes requested LADN DNNs, </condition> <condition> the UE subscribed DNN list includes the requested LADN DNNs or the wildcard DNN, </condition> and <condition> the LADN service area of the requested LADN DNN has an intersection with the current registration area, </condition> </condition> <action> the AMF shall determine the requested LADN DNNs included in the LADN indication IE as LADN DNNs for the UE; </action> </control> <control> <condition> b) if no requested LADN DNNs included in the LADN indication IE and the wildcard DNN is included in the UE subscribed DNN list, </condition> <action> the AMF shall determine the LADN DNN(s) configured in the AMF whose LADN service area has an intersection with the current registration area as LADN DNNs for the UE; </action> </control> or <control> <condition> c) <condition> if no requested LADN DNNs included in the LADN indication IE </condition> and <condition> the wildcard DNN is not included in the UE subscribed DNN list, </condition> or <condition> if the UE subscribed DNN list does not include any of the DNN's in the LADN indication IE, </condition> </condition> <action> the AMF shall determine the LADN DNN(s) included in the UE subscribed DNN list whose LADN service area has an intersection with the current registration area as LADN DNNs for the UE. </action> </control> </control>
<control> <condition> If the LADN indication IE is not included in the REGISTRATION REQUEST message, </condition> <action> the AMF shall determine the LADN DNN(s) included in the UE subscribed DNN list whose service area has an intersection with the current registration area as LADN DNNs for the UE, </action> <condition> except for the wildcard DNN included in the UE subscribed DNN list. </condition> </control>
<control> <condition> <condition> If the UE supports WUS assistance information </condition> and <condition> the AMF supports and accepts the use of WUS assistance information for the UE, </condition> </condition> <action> then the AMF shall determine the negotiated UE paging probability information for the UE, </action> <action> store it in the 5GMM context of the UE, </action> and <condition> if the UE is not performing the initial registration for emergency services, </condition> <action> the AMF shall include it in the Negotiated WUS assistance information IE in the REGISTRATION ACCEPT message. </action> </control> <control> <action> The AMF may consider the UE paging probability information received in the Requested WUS assistance information IE </action> <condition> when determining the negotiated UE paging probability information for the UE. </condition> </control>
NOTE 4: <control> <condition> Besides the UE paging probability information requested by the UE, </condition> the AMF can take local configuration or previous statistical information for the UE into account <condition> when determining the negotiated UE paging probability information for the UE. </condition> </control>
<control> <condition> <condition> If the UE sets the NR-PSSI bit to "NR paging subgrouping supported" in the 5GMM capability IE in the REGISTRATION REQUEST message </condition> and <condition> the AMF supports and accepts the use of PEIPS assistance information for the UE, </condition> </condition> <action> then the AMF shall determine the Paging subgroup ID for the UE, </action> <action> store it in the 5GMM context of the UE, </action> and <action> shall include it in the Negotiated PEIPS assistance information IE in the REGISTRATION ACCEPT message or in theUpdated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message as part of the registration procedure. </action> <action> The AMF may consider the UE paging probability information received in the Requested PEIPS assistance information IE when determining the Paging subgroup ID for the UE. </action> </control>
NOTE 5: <control> <condition> Besides the UE paging probability information when provided by the UE, </condition> the AMF can also take local configuration, whether the UE is likely to receive IMS voice over PS session calls, UE mobility pattern or previous statistical information for the UE or information provided by the NG-RAN into account <condition> when determining the Paging subgroup ID for the UE. </condition> </control>
<control> <action> The AMF shall include the LADN information which consists of the determined LADN DNNs for the UE and LADN service area(s) available in the current registration area in the LADN information IE of the REGISTRATION ACCEPT message. </action> </control>
<control> The UE, <condition> upon receiving the REGISTRATION ACCEPT message with the LADN information, </condition> <action> shall store the received LADN information. </action> </control> <control> <condition> <condition> If there exists one or more LADN DNNs which are included in the LADN indication IE of the REGISTRATION REQUEST message </condition> and <condition> are not included in the LADN information IE of the REGISTRATION ACCEPT message, </condition> <action> the UE considers such LADN DNNs as not available in the current registration area. </action> </condition> </control>
The 5G-GUTI reallocation shall be part of the initial registration procedure. <control> <condition> <condition> During the initial registration procedure, </condition> <condition> if the AMF has not allocated a new 5G-GUTI by the generic UE configuration update procedure, </condition> </condition> <action> the AMF shall include in the REGISTRATION ACCEPT message the new assigned 5G-GUTI together with the assigned TAI list. </action> </control>
<control> <condition> <condition> If the UE has set the CAG bit to "CAG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </condition> and <condition> the AMF needs to update the "CAG information list" stored in the UE, </condition> <action> the AMF shall include the CAG information list IE or the Extended CAG information list IE in the REGISTRATION ACCEPT message. </action> </condition> </control>
NOTE 6: <control> The "CAG information list" can be provided by the AMF and include no entry <condition> if no "CAG information list" exists in the subscription. </condition> </control>
NOTE 7: <control> <condition> If the UE supports extended CAG information list, </condition> the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE. </control>
<control> <condition> If the UE does not support extended CAG information list, </condition> <action> the CAG information list shall not be included in the Extended CAG information list IE. </action> </control>
<control> <condition> If a 5G-GUTI or the SOR transparent container IE is included in the REGISTRATION ACCEPT message, </condition> <action> the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <condition> If the Operator-defined access category definitions IE, the Extended emergency number list IE, the CAG information list IE or the Extended CAG information list IE are included in the REGISTRATION ACCEPT message, </condition> <action> the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <condition> <condition> If the UE is not in NB-N1 mode </condition> and <condition> the UE has set the RACS bit to "RACS supported" in the 5GMM Capability IE of the REGISTRATION REQUEST message, </condition> </condition> <action> the AMF may include either a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the REGISTRATION ACCEPT message. </action> <control> <condition> If the UE radio capability ID IE or the UE radio capability ID deletion indication IE is included in the REGISTRATION ACCEPT message, </condition> <action> the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control> </control>
<control> <action> The AMF shall include the MICO indication IE in the REGISTRATION ACCEPT message </action> <condition> <condition> only if the MICO indication IE was included in the REGISTRATION REQUEST message, </condition> <condition> the AMF supports and accepts the use of MICO mode. </condition> </condition> </control> <control> <condition> If the AMF supports and accepts the use of MICO mode, </condition> <action> the AMF may indicate "all PLMN registration area allocated" in the MICO indication IE in the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If "all PLMN registration area allocated" is indicated in the MICO indication IE, </condition> <action> the AMF shall not assign and include the TAI list in the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If the REGISTRATION ACCEPT message included an MICO indication IE indicating "all PLMN registration area allocated", </condition> <action> the UE shall treat all TAIs in the current PLMN as a registration area </action> and <condition> delete its old TAI list. </condition> </control> <control> <condition> If "strictly periodic registration timer supported" is indicated in the MICO indication IE in the REGISTRATION REQUEST message, </condition> <action> the AMF may indicate "strictly periodic registration timer supported" in the MICO indication IE in the REGISTRATION ACCEPT message. </action> </control>
<control> <action> The AMF shall include an active time value in the T3324 IE in the REGISTRATION ACCEPT message </action> <condition> <condition> if the UE requested an active time value in the REGISTRATION REQUEST message </condition> and <condition> the AMF accepts the use of MICO mode and the use of active time. </condition> </condition> </control> <control> <action> The AMF shall include the T3512 value IE in the REGISTRATION ACCEPT message </action> <condition> only if the REGISTRATION REQUEST message was sent over the 3GPP access. </condition> </control>
<control> <action> The AMF shall include the non-3GPP de-registration timer value IE in the REGISTRATION ACCEPT message </action> <condition> only if the REGISTRATION REQUEST message was sent over the non-3GPP access. </condition> </control>
<control> <condition> <condition> If the UE requests "control plane CIoT 5GS optimization" in the 5GS update type IE, </condition> <condition> indicates support of control plane CIoT 5GS optimization in the 5GMM capability IE </condition> and <condition> the AMF decides to accept the requested CIoT 5GS optimization and the registration request, </condition> </condition> <action> the AMF shall indicate "control plane CIoT 5GS optimization supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. </action> </control>
<control> <action> The AMF may include the T3447 value IE set to the service gap time value in the REGISTRATION ACCEPT message </action> <condition> if: <condition> a) the UE has indicated support for service gap control in the REGISTRATION REQUEST message; </condition> and <condition> b) a service gap time value is available in the 5GMM context. </condition> </condition> </control>
<control> <condition> <condition> If there is a running T3447 timer in the AMF </condition> and <condition> the Follow-on request indicator is set to "Follow-on request pending" in the REGISTRATION REQUEST message, </condition> </condition> <action> the AMF shall ignore the flag </action> and <action> proceed as if the flag was not received except for the following cases: </action> <condition> <condition> a) the UE is configured for high priority access in the selected PLMN; </condition> or <condition> b) the 5GS registration type IE in the REGISTRATION REQUEST message is set to "emergency registration". </condition> </condition> </control>
<control> <condition> <condition> If the UE has indicated support for the control plane CIoT 5GS optimizations, </condition> and <condition> the AMF decides to activate the congestion control for transport of user data via the control plane, </condition> </condition> <action> then the AMF shall include the T3448 value IE in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If: <condition> a) the UE in NB-N1 mode is using control plane CIoT 5GS optimization; </condition> and <condition> b) the network is configured to provide the truncated 5G-S-TMSI configuration for control plane CIoT 5GS optimizations; </condition> </condition> <action> the AMF shall include the Truncated 5G-S-TMSI configuration IE in the REGISTRATION ACCEPT message </action> and <condition> set the "Truncated AMF Set ID value" and the "Truncated AMF Pointer value" in the Truncated 5G-S-TMSI configuration IE based on network policies. </condition> <action> The AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE- INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <condition> <condition> If the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message, </condition> and <condition> if: <condition> a) the UE has a valid aerial UE subscription information; </condition> <condition> b) the UUAA procedure is to be performed during the registration procedure according to operator policy; </condition> <condition> c) there is no valid successful UUAA result for the UE in the UE 5GMM context; </condition> and <condition> d) the REGISTRATION REQUEST message was not received over non-3GPP access, </condition> </condition> </condition> <action> then the AMF shall initiate the UUAA-MM procedure with the UAS-NF as specified in TS 23.256 </action> and <action> shall include a service-level-AA pending indication in the Service-level-AA container IE of the REGISTRATION ACCEPT message. </action> <action> The AMF shall store in the UE 5GMM context that a UUAA procedure is pending. </action> <action> The AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control> <control> <condition> If the REGISTRATION REQUEST message was received over non-3GPP access, </condition> <action> the AMF shall not initiate UUAA-MM procedure. </action> </control>
<control> <condition> <condition> If the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message, </condition> and <condition> if: <condition> a) the UE has a valid aerial UE subscription information; </condition> b) <condition> the UUAA procedure is to be performed during the registration procedure according to operator policy; </condition> and <condition> c) there is a valid successful UUAA result for the UE in the UE 5GMM context, </condition> </condition> </condition> <action> then the AMF shall include a service-level-AA response in the Service-level-AA container IE of the REGISTRATION ACCEPT message </action> and <action> set the SLAR field in the service-level-AA response to "Service level authentication and authorization was successful". </action> </control>
<control> <condition> <condition> If the AMF determines that the UUAA-MM procedure needs to be performed for a UE, </condition> <condition> the AMF has not received the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message from the UE </condition> and <condition> the AMF decides to accept the UE to be registered for other services than UAS services based on the user's subscription data and the operator policy, </condition> </condition> <action> the AMF shall accept the initial registration request </action> and <action> shall mark in the UE's 5GMM context that the UE is not allowed to request UAS services. </action> </control>
<control> <condition> If the UE supports MINT, </condition> <action> the AMF may include the List of PLMNs to be used in disaster condition IE in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the UE supports MINT, </condition> <action> the AMF may include the Disaster roaming wait range IE in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the UE supports MINT, </condition> <action> the AMF may include the Disaster return wait range IE in the REGISTRATION ACCEPT message. </action> </control>
NOTE 8: The AMF can determine the contents of the "list of PLMN(s) to be used in disaster condition", the value of the disaster roaming wait range and the value of the disaster return wait range based on the network local configuration.
<control> <condition> <condition> If the AMF received the list of TAIs from the satellite NG-RAN as described in 3GPP TS 23.501 , </condition> and <condition> determines that any but not all TAIs in the received list of TAIs is forbidden for roaming or for regional provision of service as per information from the UDM and operator's choice, </condition> </condition> <action> the AMF shall include the TAI(s) in: a) the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for roaming" IE; or b) the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for regional provision of service" IE; or c) both; in the REGISTRATION ACCEPT message. </action> </control>
NOTE 9: "5GS forbidden tracking areas for roaming" corresponds to cause values #13 and #15, and "5GS forbidden tracking areas for regional provision of service" corresponds cause value #12.
<control> <condition> Upon receipt of the REGISTRATION ACCEPT message, </condition> <action> the UE shall reset the registration attempt counter, </action> <end_state> enter state 5GMM-REGISTERED </end_state> and <action> set the 5GS update status to 5U1 UPDATED. </action> </control>
<control> <condition> If the UE receives the REGISTRATION ACCEPT message from a PLMN, </condition> <action> then the UE shall reset the PLMN-specific attempt counter for that PLMN for the specific access type for which the message was received. </action> <action> The UE shall also reset the PLMN-specific N1 mode attempt counter for that PLMN for the specific access type </action> <condition> for which the message was received. </condition> </control> <control> <condition> If the message was received via 3GPP access, </condition> <action> the UE shall reset the counter for "SIM/USIM considered invalid for GPRS services" events and the counter for "SIM/USIM considered invalid for non-GPRS services" events, </action> <condition> if any. </condition> </control> <control> <condition> If the message was received via non-3GPP access, </condition> <action> the UE shall reset the counter for "USIM considered invalid for 5GS services over non-3GPP" events. </action> </control>
<control> <condition> If the UE receives the REGISTRATION ACCEPT message from an SNPN, </condition> <action> then the UE shall reset the SNPN-specific attempt counter for the current SNPN for the specific access type for which the message was received. </action> </control> <control> <condition> If the message was received via 3GPP access, </condition> <action> the UE shall reset the counter for "the entry for the current SNPN considered invalid for 3GPP access" events. </action> </control> <control> <condition> If the message was received via non-3GPP access, </condition> <action> the UE shall reset the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message included a T3512 value IE, </condition> <action> the UE shall use the value in the T3512 value IE as periodic registration update timer (T3512). </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message include a T3324 value IE, </condition> <action> the UE shall use the value in the T3324 value IE as active timer (T3324). </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message included a non-3GPP de-registration timer value IE, </condition> <action> the UE shall use the value in non-3GPP de-registration timer value IE as non-3GPP de-registration timer. </action> </control>
<control> <condition> <condition> If the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to "Network slicing subscription changed", </condition> or <condition> contains a Configured NSSAI IE with a new configured NSSAI for the current PLMN or SNPN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN or SNPN, </condition> or <condition> contains an NSSRG information IE with a new NSSRG information, </condition> </condition> <action> the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the successful update of the network slicing information. </action> </control>
<control> <condition> <condition> If the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to "Network slicing subscription changed", </condition> or <condition> contains a configured NSSAI IE with a new configured NSSAI for the current PLMN or SNPN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN or SNPN, </condition> </condition> <action> the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the successful update of the network slicing information. </action> </control>
<control> <condition> <condition> If the REGISTRATION ACCEPT message contains the CAG information list IE or the Extended CAG information list IE </condition> and <condition> the UE had set the CAG bit to "CAG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> </condition> the UE shall: <control> a) <action> replace the "CAG information list" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN; </action> </control> NOTE 10: <control> <condition> <condition> When the UE receives the CAG information list IE or the Extended CAG information list IE in the HPLMN derived from the IMSI, </condition> <condition> the EHPLMN list is present and is not empty and the HPLMN is not present in the EHPLMN list, </condition> </condition> <action> the UE behaves as if it receives the CAG information list IE or the Extended CAG information list IE in a VPLMN. </action> </control> <control> b) <action> replace the serving VPLMN's entry of the "CAG information list" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE </action> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; </condition> </control> or NOTE 11: <control> <condition> When the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, </condition> <action> entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored. </action> </control> <control> c) <action> remove the serving VPLMN's entry of the "CAG information list" stored in the UE </action> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry. </condition> </control> </control>
<control> <action> The UE shall store the "CAG information list" received in the CAG information list IE or the Extended CAG information list IE as specified in annex C. </action> </control>
<control> <condition> If the received "CAG information list" includes an entry containing the identity of the registered PLMN, </condition> the UE shall operate as follows: </control>
<control> <condition> a) <condition> if the UE receives the REGISTRATION ACCEPT message via a CAG cell, </condition> <condition> the entry for the registered PLMN in the received "CAG information list" does not include any of the CAG-ID(s) supported by the current CAG cell, </condition> </condition> </control> and:
<control> 1) <condition> the entry for the registered PLMN in the received "CAG information list" does not include an "indication that the UE is only allowed to access 5GS via CAG cells", </condition> <end_state> then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list"; </action> </control> or
<control> 2) <condition> the entry for the registered PLMN in the received "CAG information list" includes an "indication that the UE is only allowed to access 5GS via CAG cells" and: </condition> </control>
<control> <condition> i) if the entry for the registered PLMN in the received "CAG information list" includes one or more CAG- IDs, </condition> <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 with the updated "CAG information list"; </action> </control> or <control> ii) <condition> <condition> if the entry for the registered PLMN in the received "CAG information list" does not include any CAG- ID, </condition> <condition> the UE has not set the 5GS registration type IE in the REGISTRATION REQUEST message to "emergency registration", </condition> and <condition> the initial registration was not initiated to perform handover of an existing emergency PDU session from the non-current access to the current access, </condition> </condition> <end_state> then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list"; </action> </control> or
<control> <condition> b) <condition> if the UE receives the REGISTRATION ACCEPT message via a non-CAG cell </condition> and <condition> the entry for the registered PLMN in the received "CAG information list" includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> </condition> </control> and:
<control> 1) <condition> if the "allowed CAG list" for the registered PLMN in the received "CAG information list" includes one or more CAG-IDs, </condition> <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 with the updated "CAG information list"; </action> </control> or <control> 2) <condition> <condition> if the entry for the registered PLMN in the received "CAG information list" does not include any CAG-ID, </condition> <condition> the UE has not set the 5GS registration type IE in the REGISTRATION REQUEST message to "emergency registration", </condition> and <condition> the initial registration was not initiated to perform handover of an existing emergency PDU session from the non-current access to the current access, </condition> </condition> <end_state> then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list". </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains the Operator-defined access category definitions IE, the Extended emergency number list IE ,the CAG information list IE or the Extended CAG information list IE, </condition> <action> the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the operator-defined access category definitions, the extended local emergency numbers list or the "CAG information list". </action> </control>
<control> <condition> <condition> If the REGISTRATION ACCEPT message contains the UE radio capability ID IE </condition> or <condition> the UE radio capability ID deletion indication IE, </condition> </condition> <action> the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the UE radio capability ID IE or the UE radio capability ID deletion indication IE. </action> </control>
<control> <condition> Upon receiving a REGISTRATION COMPLETE message, </condition> <action> the AMF shall stop timer T3550 </action> and <end_state> change to state 5GMM-REGISTERED. </end_state> </control> <control> The 5G-GUTI, <condition> if sent in the REGISTRATION ACCEPT message, </condition> <action> shall be considered as valid, </action> and the UE radio capability ID, <condition> if sent in the REGISTRATION ACCEPT, </condition> <action> shall be considered as valid. </action> </control>
<control> <condition> <condition> If the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to "SMS over NAS supported", </condition> and <condition> SMSF selection is successful, </condition> </condition> <action> then the AMF shall send the REGISTRATION ACCEPT message after the SMSF has confirmed that the activation of the SMS service was successful. </action> </control> <control> <condition> When sending the REGISTRATION ACCEPT message, </condition> the AMF shall: <control> a) <action> set the SMS allowed bit of the 5GS registration result IE to "SMS over NAS allowed" in the REGISTRATION ACCEPT message, </action> <condition> <condition> if the UE has set the SMS requested bit of the 5GS update type IE to "SMS over NAS supported" in the REGISTRATION REQUEST message </condition> and <condition> the network allows the use of SMS over NAS for the UE; </condition> </condition> </control> and <control> b) <action> store the SMSF address and the value of the SMS allowed bit of the 5GS registration result IE in the UE 5GMM context </action> and <action> consider the UE available for SMS over NAS. </action> </control> </control>
<control> <condition> If: <condition> a) the SMSF selection in the AMF is not successful; </condition> <condition> b) the SMS activation via the SMSF is not successful; </condition> <condition> c) the AMF does not allow the use of SMS over NAS; </condition> <condition> d) the SMS requested bit of the 5GS update type IE was set to "SMS over NAS not supported" in the REGISTRATION REQUEST message; </condition> or <condition> e) the 5GS update type IE was not included in the REGISTRATION REQUEST message; </condition> </condition> <action> then the AMF shall set the SMS allowed bit of the 5GS registration result IE to "SMS over NAS not allowed" in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> When the UE receives the REGISTRATION ACCEPT message, </condition> <condition> if the UE is also registered over another access to the same PLMN, </condition> </condition> <action> the UE considers the value indicated by the SMS allowed bit of the 5GS registration result IE as applicable for both accesses over which the UE is registered. </action> </control>
<control> <action> The AMF shall include the 5GS registration result IE in the REGISTRATION ACCEPT message. </action> <condition> If the 5GS registration result IE value indicates: a) "3GPP access", </condition> the UE: <action> a) shall consider itself as being registered to 3GPP access only; </action> and <condition> b) <start_state> if in 5GMM-REGISTERED state over non-3GPP access </start_state> and <condition> on the same PLMN as 3GPP access, </condition> </condition> <end_state> shall enter state 5GMM-DEREGISTERED ATTEMPTING-REGISTRATION over non-3GPP access </end_state> and <action> set the 5GS update status to 5U2 NOT UPDATED over non-3GPP access; </action> </control> <control> <condition> b) "Non-3GPP access", </condition> the UE: <action> a) shall consider itself as being registered to non-3GPP access only; </action> and <start_state> b) if in the 5GMM-REGISTERED state over 3GPP access </start_state> and <condition> is on the same PLMN as non-3GPP access, </condition> <end_state> shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over 3GPP access </end_state> and <action> set the 5GS update status to 5U2 NOT UPDATED over 3GPP access; </action> </control> or <control> <condition> c) "3GPP access and Non-3GPP access", </condition> <action> the UE shall consider itself as being registered to both 3GPP access and non-3GPP access. </action> </control>
<control> <action> The AMF shall include the allowed NSSAI for the current PLMN or SNPN </action> and <action> shall include the mapped S-NSSAI(s) for the allowed NSSAI contained in the requested NSSAI from the UE if available, </action> <condition> <condition> in the REGISTRATION ACCEPT message if the UE included the requested NSSAI in the REGISTRATION REQUEST message </condition> and <condition> the AMF allows one or more S-NSSAIs in the requested NSSAI. </condition> </condition> </control>
<control> <action> The AMF may also include rejected NSSAI in the REGISTRATION ACCEPT message </action> <condition> if the initial registration request is not for onboarding services in SNPN. </condition> </control> <control> <condition> If the UE has set the ER-NSSAI bit to "Extended rejected NSSAI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> <action> the rejected NSSAI shall be included in the Extended rejected NSSAI IE in the REGISTRATION ACCEPT message; </action> <condition> otherwise </condition> <action> the rejected NSSAI shall be included in the Rejected NSSAI IE in the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If the initial registration request is for onboarding services in SNPN, </condition> <action> the AMF shall not include rejected NSSAI in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the UE has set the ER-NSSAI bit to "Extended rejected NSSAI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> <action> the rejected NSSAI contains S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with rejection cause(s); </action> </control> <control> <condition> otherwise </condition> the rejected NSSAI contains S- NSSAI(s) <condition> <condition> which was included in the requested NSSAI </condition> <condition> but rejected by the network associated with rejection cause(s) with the following restrictions: <action> a) rejected NSSAI for the current PLMN or SNPN shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are not allowed; </action> and <action> b) rejected NSSAI for the current registration area shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are not allowed. </action> </condition> </condition> </control>
NOTE 12: <control> <action> The UE that does not support extended rejected NSSAI can avoid requesting an S-NSSAI associated with a mapped S-NSSAI, </action> <condition> <condition> which was included in the previous requested NSSAI </condition> <condition> but neither in the allowed NSSAI nor in the rejected NSSAI in the consequent registration procedures. </condition> </condition> </control>
<control> <condition> <condition> If the UE indicated the support for network slice-specific authentication and authorization, </condition> and <condition> if the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, </condition> </condition> <action> the AMF shall in the REGISTRATION ACCEPT message include: a) the allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s), if any: <condition> <condition> 1) <condition> which are not subject to network slice-specific authentication and authorization </condition> and <condition> are allowed by the AMF; </condition> </condition> or <condition> 2) for which the network slice-specific authentication and authorization has been successfully performed; </condition> </condition> b) optionally, the rejected NSSAI; c) pending NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization (except for re-NSSAA) will be performed or is ongoing, and one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing, if any; and d) the "NSSAA to be performed" indicator in the 5GS registration result IE set to indicate that the network slice- specific authentication and authorization procedure will be performed by the network, if the allowed NSSAI is not included in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the initial registration request is not for onboarding services in SNPN, </condition> <action> the UE indicated the support for network slice-specific authentication and authorization, </action> and: <action> a) the UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S- NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; </action> <action> b) all default S-NSSAIs are subject to network slice-specific authentication and authorization; </action> and <action> c) the network slice-specific authentication and authorization procedure has not been successfully performed for any of the default S-NSSAIs, </action> <action> the AMF shall in the REGISTRATION ACCEPT message include: a) the "NSSAA to be performed" indicator in the 5GS registration result IE to indicate that the network slice- specific authentication and authorization procedure will be performed by the network; b) pending NSSAI containing one or more default S-NSSAIs for which network slice-specific authentication and authorization will be performed or is ongoing and one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing (if any); </action> </control> and
<control> <condition> If the initial registration request is not for onboarding services in SNPN, </condition> <action> the UE indicated the support for network slice-specific authentication and authorization, </action> and: <action> a) the UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; </action> and <action> b) one or more default S-NSSAIs are not subject to network slice-specific authentication and authorization or the network slice-specific authentication and authorization procedure has been successfully performed for one or more default S-NSSAIs; </action> <action> the AMF shall in the REGISTRATION ACCEPT message include: a) pending NSSAI containing one or more default S-NSSAIs for which network slice-specific authentication and authorization will be performed or is ongoing (if any) and one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing (if any); b) allowed NSSAI containing S-NSSAI(s) for the current PLMN each of which corresponds to a default S-NSSAI which are not subject to network slice-specific authentication and authorization or for which the network slice- specific authentication and authorization has been successfully performed; c) allowed NSSAI containing one or more default S-NSSAIs, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed; and d) optionally, the rejected NSSAI. </action> </control>
<control> <condition> If the UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed, </condition> <action> the allowed NSSAI shall not contain default S-NSSAI(s) that are subject to NSAC. </action> </control> <control> <condition> If the subscription information includes the NSSRG information, </condition> <action> the S-NSSAIs of the allowed NSSAI shall be associated with at least one common NSSRG value. </action> </control>
<control> <condition> When the REGISTRATION ACCEPT message includes a pending NSSAI, </condition> <action> the pending NSSAI shall contain all S-SSAIs for which network slice-specific authentication and authorization (except for re-NSSAA) will be performed or is ongoing from the requested NSSAI of the REGISTRATION REQUEST message that was received over the 3GPP access, non-3GPP access, or both the 3GPP access and non-3GPP access. </action> </control>
<control> <condition> <condition> If the UE supports extended rejected NSSAI </condition> and <condition> the AMF determines that maximum number of UEs reached for one or more S-NSSAI(s) in the requested NSSAI as specified in subclause 4.6.2.5, </condition> </condition> <action> the AMF shall include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause "S-NSSAI not available due to maximum number of UEs reached" in the Extended rejected NSSAI IE in the REGISTRATION ACCEPT message. </action> <action> In addition, the AMF may include a back-off timer value for each S-NSSAI with the rejection cause "S-NSSAI not available due to maximum number of UEs reached" included in the Extended rejected NSSAI IE of the REGISTRATION ACCEPT message. </action> </control> <control> <condition> To avoid that large numbers of UEs simultaneously initiate deferred requests, </condition> <action> the network should select the value for the backoff timer for each S-NSSAI for the informed UEs so that timeouts are not synchronised. </action> </control>
<control> <condition> If the UE does not indicate support for extended rejected NSSAI and the maximum number of UEs has been reached, </condition> <action> the AMF should include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause "S-NSSAI not available in the current registration area" in the Rejected NSSAI IE </action> and <action> should not include these S-NSSAIs in the allowed NSSAI in the REGISTRATION ACCEPT message. </action> </control>
NOTE 13: Based on network policies, the AMF can include the S-NSSAI(s) for which the maximum number of UEs has been reached in the rejected NSSAI with rejection causes other than "S-NSSAI not available in the current registration area".
<control> <action> The AMF may include a new configured NSSAI for the current PLMN or SNPN in the REGISTRATION ACCEPT message </action> <condition> if: <condition> a) the REGISTRATION REQUEST message did not include the requested NSSAI and the initial registration request is not for onboarding services in SNPN; </condition> <condition> b) the REGISTRATION REQUEST message included the requested NSSAI containing an S-NSSAI that is not valid in the serving PLMN or SNPN; </condition> <condition> c) the REGISTRATION REQUEST message included the requested NSSAI containing S-NSSAI(s) with incorrect mapped S-NSSAI(s); </condition> <condition> d) the REGISTRATION REQUEST message included the Network slicing indication IE with the Default configured NSSAI indication bit set to "Requested NSSAI created from default configured NSSAI"; </condition> <condition> e) <condition> the S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message are not associated with any common NSSRG value, </condition> <condition> except for the case that the AMF, </condition> based on the indication received from the UDM as specified in 3GPP TS 23.501 , has provided all subscribed S-NSSAIs in the configured NSSAI to a UE who does not support NSSRG; </condition> or NOTE 14: If the S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message are not associated with any common NSSRG value, it is possible that at least one of the S-NSSAIs is not included in any of new allowed NSSAI, new (extended) rejected NSSAI (if applicable), and new pending NSSAI (if applicable). <condition> f) the S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message over the current access and the allowed NSSAI over the other access are not associated with any common NSSRG value. </condition> </condition> </control>
<control> <condition> If a new configured NSSAI for the current PLMN or SNPN is included in the REGISTRATION ACCEPT message, </condition> <action> the AMF shall also include the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN or SNPN </action> <condition> if available in the REGISTRATION ACCEPT message. </condition> <action> In this case the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM- COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <condition> If a new configured NSSAI for the current PLMN or SNPN is included in the REGISTRATION ACCEPT message, </condition> <action> the AMF shall also include the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN if available in the REGISTRATION ACCEPT message. </action> <action> In this case the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <condition> If a new configured NSSAI for the current PLMN is included in the REGISTRATION ACCEPT message, </condition> <condition> the subscription information includes the NSSRG information, </condition> and <condition> the NSSRG bit in the 5GMM capability IE of the REGISTRATION REQUEST message is set to: <control> <condition> a) "NSSRG supported", </condition> <action> then the AMF shall include the NSSRG information in the REGISTRATION ACCEPT message; </action> </control> or <control> <condition> b) "NSSRG not supported", </condition> <action> then the configured NSSAI shall include one or more S-NSSAIs each of which is associated with all the NSSRG value(s) of the default S-NSSAI(s), </action> or <action> the configured NSSAI shall include, based on the indication received from the UDM as specified in 3GPP TS 23.501 , </action> <action> all subscribed S-NSSAIs even if these S-NSSAIs do not share any common NSSRG value. </action> </control> </condition> </control>
<control> <condition> <condition> If the AMF needs to update the NSSRG information </condition> and <condition> the UE has set the NSSRG bit to "NSSRG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> <action> then the AMF shall include the new NSSRG information in the REGISTRATION ACCEPT message. </action> In addition, <action> the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </condition> </control>
<control> <condition> If the UE has set the NSAG bit to "NSAG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> <action> the AMF may include the NSAG information IE in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the UE receives the NSAG information IE in the REGISTRATION ACCEPT message, </condition> <action> the UE shall store the NSAG information as specified in subclause 4.6.2.2. </action> </control>
<control> <condition> If the UE requests ciphering keys for ciphered broadcast assistance data in the REGISTRATION REQUEST message </condition> and <condition> the AMF has valid ciphering key data applicable to the UE's subscription and current tracking area, </condition> <action> then the AMF shall include the ciphering key data in the Ciphering key data IE of the REGISTRATION ACCEPT message. </action> </control>
<control> <action> The AMF shall include the Network slicing indication IE with the Network slicing subscription change indication set to "Network slicing subscription changed" in the REGISTRATION ACCEPT message </action> <condition> if the UDM has indicated that the subscription data for network slicing has changed. </condition> <action> In this case the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM- COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <action> The UE that has indicated the support for network slice-specific authentication and authorization receiving the pending NSSAI in the REGISTRATION ACCEPT message shall store the S-NSSAI(s) in the pending NSSAI as specified in subclause 4.6.2.2. </action> </control> <control> <condition> <condition> If the registration area contains TAIs belonging to different PLMNs, </condition> <condition> which are equivalent PLMNs, </condition> </condition> <action> the UE shall store the received pending NSSAI for each of the equivalent PLMNs as specified in subclause 4.6.2.2. </action> </control> <control> <condition> <condition> If the pending NSSAI is not included in the REGISTRATION ACCEPT message </condition> and <condition> the "NSSAA to be performed" indicator is not set to "Network slice-specific authentication </condition> and <condition> authorization is to be performed" in the 5GS registration result IE of the REGISTRATION ACCEPT message, </condition> </condition> <action> then the UE shall delete the pending NSSAI for the current PLMN or SNPN and its equivalent PLMN(s), </action> <condition> if existing, </condition> as specified in subclause 4.6.2.2. </control>
<control> The UE receiving the rejected NSSAI in the REGISTRATION ACCEPT message takes the following actions based on the rejection cause in the rejected S-NSSAI(s): <control> <condition> "S-NSSAI not available in the current PLMN or SNPN" </condition> <action> The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI(s) in the current PLMN or SNPN </action> <condition> until switching off the UE, </condition> <action> the UICC containing the USIM is removed, </action> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </action> or <action> the rejected S-NSSAI(s) are removed or deleted as described in subclause 4.6.2.2. </action> </control> <control> <condition> "S-NSSAI not available in the current registration area" </condition> <action> The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI(s) in the current registration area </action> <condition> until switching off the UE, </condition> <action> the UE moving out of the current registration area, </action> <action> the UICC containing the USIM is removed, </action> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </action> or <action> the rejected S- NSSAI(s) are removed or deleted as described in subclause 4.6.2.2. </action> </control> <control> <condition> "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization" </condition> <action> The UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access </action> <condition> until switching off the UE, </condition> <action> the UICC containing the USIM is removed, </action> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </action> or <action> the rejected S-NSSAI(s) are removed or deleted as described in subclause 4.6.1 and 4.6.2.2. </action> </control> <control> <condition> "S-NSSAI not available due to maximum number of UEs reached" </condition> <condition> Unless the back-off timer value received along with the S-NSSAI is zero, </condition> <action> the UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access </action> <condition> until switching off the UE, </condition> <action> the UICC containing the USIM is removed, </action> <action> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </action> or <action> the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </action> </control> </control>
NOTE 15: <control> <condition> If the back-off timer value received along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached is zero as specified in subclause 10.5.7.4a of TS 24.008, </condition> the UE does not consider the S-NSSAI as the rejected S-NSSAI. </control>
<control> <condition> If there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause "S-NSSAI not available due to maximum number of UEs reached", </condition> then for each S-NSSAI, the UE shall behave as follows: <action> a) stop the timer T3526 associated with the S-NSSAI, </action> if running; <action> b) start the timer T3526 with: 1) the back-off timer value received along with the S-NSSAI, <condition> <condition> if a back-off timer value is received along with the S-NSSAI that is neither zero </condition> <condition> nor deactivated; </condition> </condition> or 2) an implementation specific back-off timer value, <condition> if no back-off timer value is received along with the S- NSSAI; </condition> </action> and <action> c) remove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached </action> <condition> when the timer T3526 associated with the S-NSSAI expires. </condition> </control>
<control> <condition> If the UE sets the NSSAA bit in the 5GMM capability IE to "Network slice-specific authentication and authorization not supported", </condition> and: <control> <condition> a) if the Requested NSSAI IE only includes the S-NSSAI(s) subject to network slice-specific authentication and authorization and one or more default S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S-NSSAI) which are not subject to network slice-specific authentication and authorization are available, </condition> <action> the AMF shall in the REGISTRATION ACCEPT message include: 1) the allowed NSSAI containing S-NSSAI(s) for the current PLMN or SNPN each of which corresponds to a default S-NSSAI which are not subject to network slice-specific authentication and authorization; 2) the allowed NSSAI containing the default S-NSSAIs, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization; and 3) the rejected NSSAI containing the S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating "S-NSSAI not available in the current PLMN or SNPN", except if the UE has not set the ER-NSSAI bit to "Extended rejected NSSAI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message and the S-NSSAI(s) is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are subject to NSSAA; </action> or </control> <control> <condition> b) if the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, </condition> <action> the AMF shall in the REGISTRATION ACCEPT message include: 1) the allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s) which are not subject to network slice-specific authentication and authorization; and 2) the rejected NSSAI containing: i) the S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating "S-NSSAI not available in the current PLMN or SNPN", except if the UE has not set the ER- NSSAI bit to "Extended rejected NSSAI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message and the S-NSSAI is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are subject to NSSAA; and ii) the S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with the rejection cause indicating "S-NSSAI not available in the current PLMN or SNPN" or the rejection cause indicating "S-NSSAI not available in the current registration area", </action> <condition> if any. </condition> </control> </control>
<control> <condition> <condition> If the UE does not indicate support for network slice-specific authentication and authorization, </condition> <condition> the initial registration request is not for onboarding services in SNPN, </condition> and <condition> if: <condition> a) the UE did not include the requested NSSAI in the REGISTRATION REQUEST message; </condition> or <condition> b) none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; </condition> </condition> and <condition> one or more default S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S- NSSAI) which are not subject to network slice-specific authentication and authorization are available, </condition> </condition> the AMF shall: <action> a) put the allowed S-NSSAI(s) for the current PLMN or SNPN each of which corresponds to a default S-NSSAI and not subject to network slice-specific authentication and authorization in the allowed NSSAI of the REGISTRATION ACCEPT message; </action> <action> b) put the default S-NSSAIs and not subject to network slice-specific authentication and authorization, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, in the allowed NSSAI of the REGISTRATION ACCEPT message; </action> and <action> c) determine a registration area such that all S-NSSAIs of the allowed NSSAI are available in the registration area. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to "Network slicing subscription changed", </condition> <action> the UE shall delete the network slicing information for each and every PLMN except for the current PLMN as specified in subclause 4.6.2.2. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains the allowed NSSAI, </condition> <action> then the UE shall store the included allowed NSSAI together with the PLMN identity of the registered PLMN or the SNPN identity of the registered SNPN and the registration area as specified in subclause 4.6.2.2. </action> </control> <control> <condition> <condition> If the registration area contains TAIs belonging to different PLMNs, </condition> <condition> which are equivalent PLMNs, </condition> </condition> <action> the UE shall store the received allowed NSSAI in each of allowed NSSAIs which are associated with each of the PLMNs. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains a configured NSSAI IE with a new configured NSSAI for the current PLMN or SNPN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN or SNPN, </condition> <action> the UE shall store the contents of the configured NSSAI IE as specified in subclause 4.6.2.2. </action> </control> <control> In addition, <condition> if the REGISTRATION ACCEPT message contains an NSSRG information IE, </condition> <action> the UE shall store the contents of the NSSRG information IE as specified in subclause 4.6.2.2. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message: <condition> a) includes the 5GS registration result IE with the "NSSAA to be performed" indicator set to "Network slice-specific authentication and authorization is to be performed"; </condition> <condition> b) includes a pending NSSAI; </condition> and <condition> c) does not include an allowed NSSAI, </condition> </condition> <action> the UE shall delete the stored allowed NSSAI, </action> <condition> if any, </condition> as specified in subclause 4.6.2.2, and the UE: <action> a) shall not initiate a 5GSM procedure except for emergency services ; </action> and <action> b) shall not initiate a service request procedure except for cases f), i), m) and o) in subclause 5.6.1.1; </action> <action> c) shall not initiate an NAS transport procedure except for sending SMS, an LPP message, a location service message, an SOR transparent container, a UE policy container, a UE parameters update transparent container or a CIoT user data container; until the UE receives an allowed NSSAI. </action> </control>
<control> <condition> If the UE included S1 mode supported indication in the REGISTRATION REQUEST message, </condition> <action> the AMF supporting interworking with EPS shall set the IWK N26 bit to either: <action> a) "interworking without N26 interface not supported" </action> <condition> if the AMF supports N26 interface; </condition> or <action> b) "interworking without N26 interface supported" </action> <condition> if the AMF does not support N26 interface in the 5GS network feature support IE in the REGISTRATION ACCEPT message. </condition> </action> </control>
<control> The UE supporting S1 mode shall operate in the mode for interworking with EPS as follows: <control> <condition> a) if the IWK N26 bit in the 5GS network feature support IE is set to "interworking without N26 interface not supported", </condition> <action> the UE shall operate in single-registration mode; </action> </control> <control> <condition> b) <condition> if the IWK N26 bit in the 5GS network feature support IE is set to "interworking without N26 interface supported" </condition> and <condition> the UE supports dual-registration mode, </condition> </condition> <action> the UE may operate in dual-registration mode; </action> </control> or NOTE 16: The registration mode used by the UE is implementation dependent. <control> <condition> c) <condition> if the IWK N26 bit in the 5GS network feature support IE is set to "interworking without N26 interface supported" </condition> and <condition> the UE only supports single-registration mode, </condition> </condition> <action> the UE shall operate in single-registration mode. </action> </control> </control>
<control> <action> The UE shall treat the received interworking without N26 interface indicator for interworking with EPS as valid in the entire PLMN and its equivalent PLMN(s). </action> </control>
<control> <action> The network informs the UE about the support of specific features, such as IMS voice over PS session, location services (5G-LCS), emergency services, emergency services fallback and ATSSS, in the 5GS network feature support information element. </action> </control> <control> <condition> In a UE with IMS voice over PS session capability, </condition> <action> the IMS voice over PS session indicator, the Emergency services support indicator, and the Emergency services fallback indicator shall be provided to the upper layers. </action> <control> <action> The upper layers take the IMS voice over PS session indicator into account </action> <condition> when selecting the access domain for voice sessions or calls. </condition> </control> </control> <control> <condition> In a UE with LCS capability, </condition> <action> location services indicator (5G-LCS) shall be provided to the upper layers. </action> <control> <condition> When initiating an emergency call, </condition> <action> the upper layers also take the IMS voice over PS session indicator, the Emergency services support indicator, and the Emergency services fallback indicator into account for the access domain selection. </action> </control> </control> <control> <condition> In a UE with the capability for ATSSS, </condition> <action> the network support for ATSSS shall be provided to the upper layers. </action> </control> <control> <condition> If the UE receives the 5GS network feature support IE with the ATSSS support indicator set to "ATSSS not supported", </condition> <action> the UE shall perform a local release of the MA PDU session, </action> <condition> if any. </condition> </control>
<control> The AMF shall set the EMF bit in the 5GS network feature support IE to: <control> a) <action> "Emergency services fallback supported in NR connected to 5GCN and E-UTRA connected to 5GCN" </action> <condition> <condition> if the network supports the emergency services fallback procedure </condition> <condition> when the UE is in an NR cell connected to 5GCN or an E-UTRA cell connected to 5GCN; </condition> </condition> </control> <control> b) <action> "Emergency services fallback supported in NR connected to 5GCN only" </action> <condition> <condition> if the network supports the emergency services fallback procedure </condition> <condition> when the UE is in an NR cell connected to 5GCN </condition> and <condition> does not support the emergency services fallback procedure </condition> <condition> when the UE is in an E-UTRA cell connected to 5GCN; </condition> </condition> </control> <control> c) <action> "Emergency services fallback supported in E-UTRA connected to 5GCN only" </action> <condition> <condition> if the network supports the emergency services fallback procedure </condition> <condition> when the UE is in an E-UTRA cell connected to 5GCN </condition> and <condition> <condition> does not support the emergency services fallback procedure </condition> <condition> when the UE is in an NR cell connected to 5GCN; </condition> </condition> </condition> </control> or <control> d) <action> "Emergency services fallback not supported" </action> <condition> <condition> if network does not support the emergency services fallback procedure </condition> <condition> when the UE is in any cell connected to 5GCN. </condition> </condition> </control> </control>
NOTE 17: <control> <condition> If the emergency services are supported in neither the EPS nor the 5GS homogeneously, </condition> based on operator policy, <action> the AMF will set the EMF bit in the 5GS network feature support IE to "Emergency services fallback not supported". </action> </control>
NOTE 18: <control> <condition> Even though the AMF's support of emergency services fallback is indicated per RAT, </condition> the UE's support of emergency services fallback is not per RAT, i.e. the UE's support of emergency services fallback is the same for both NR connected to 5GCN and E-UTRA connected to 5GCN. </control>
<control> <condition> If the UE is not operating in SNPN access operation mode: </condition> <control> a) <action> the network informs the UE that the use of access identity 1 is valid in the RPLMN or equivalent PLMN by setting the MPS indicator bit of the 5GS network feature support IE to "Access identity 1 valid", in the REGISTRATION ACCEPT message. </action> <action> Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM; </action> </control> <control> <condition> b) upon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to "Access identity 1 valid", </condition> <action> the UE shall act as a UE with access identity 1 configured for MPS as described in subclause 4.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. </action> </control> <control> The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid <condition> <condition> until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to "Access identity 1 not valid" </condition> or <condition> until the UE selects a non-equivalent PLMN. </condition> </condition> Access identity 1 is only applicable while the UE is in N1 mode. </control> <control> c) <action> the network informs the UE that the use of access identity 2 is valid in the RPLMN or equivalent PLMN by setting the MCS indicator bit of the 5GS network feature support IE to "Access identity 2 valid", in the REGISTRATION ACCEPT message. </action> <action> Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM; </action> </control> and <control> <condition> d) upon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to "Access identity 2 valid", </condition> <action> the UE shall act as a UE with access identity 2 configured for MCS as described in subclause 4.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. </action> </control> </control> <control> The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid <condition> <condition> until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to "Access identity 2 not valid" </condition> or <condition> until the UE selects a non-equivalent PLMN. Access identity 2 is only applicable while the UE is in N1 mode. </condition> </condition> </control>
<control> <condition> If the UE is operating in SNPN access operation mode: </condition> <action> a) the network informs the UE that the use of access identity 1 is valid in the RSNPN by setting the MPS indicator bit of the 5GS network feature support IE to "Access identity 1 valid", in the REGISTRATION ACCEPT message. </action> <action> Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM; </action> <control> <condition> b) upon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to "Access identity 1 valid", </condition> <action> the UE shall act as a UE with access identity 1 configured for MPS as described in subclause 4.5.2A, in all NG-RAN of the registered SNPN. </action> </control> <control> The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid <condition> <condition> until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to "Access identity 1 not valid" </condition> or <condition> until the UE selects another SNPN. </condition> </condition> Access identity 1 is only applicable while the UE is in N1 mode. </control> <action> c) the network informs the UE that the use of access identity 2 is valid in the RSNPN by setting the MCS indicator bit of the 5GS network feature support IE to "Access identity 2 valid", in the REGISTRATION ACCEPT message. </action> <action> Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM; </action> and <control> <condition> d) upon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to "Access identity 2 valid", </condition> <action> the UE shall act as a UE with access identity 2 configured for MCS as described in subclause 4.5.2A, in all NG-RAN of the registered SNPN. </action> </control> </control> <control> The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid <condition> <condition> until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to "Access identity 2 not valid" </condition> or <condition> <condition> until the UE selects another SNPN. Access identity 2 is only applicable </condition> <condition> while the UE is in N1 mode. </condition> </condition> </condition> </control>
<control> <condition> If the UE indicates support for restriction on use of enhanced coverage in the REGISTRATION REQUEST message </condition> and: <control> <condition> a) in WB-N1 mode, </condition> <action> the AMF decides to restrict the use of CE mode B for the UE, </action> <action> then the AMF shall set the RestrictEC bit to "CE mode B is restricted"; </action> </control> <control> <condition> b) in WB-N1 mode, </condition> <action> the AMF decides to restrict the use of both CE mode A and CE mode B for the UE, </action> <action> then the AMF shall set the RestrictEC bit to " Both CE mode A and CE mode B are restricted"; </action> </control> or <control> <condition> c) in NB-N1 mode, </condition> <action> the AMF decides to restrict the use of enhanced coverage for the UE, </action> <action> then the AMF shall set the RestrictEC bit to "Use of enhanced coverage is restricted", </action> </control> in the 5GS network feature support IE in the REGISTRATION ACCEPT message. </control>
<control> <condition> <condition> If the UE indicates support of the N1 NAS signalling connection release in the REGISTRATION REQUEST message </condition> and <condition> the network decides to accept the N1 NAS signalling connection release, </condition> </condition> <action> then the AMF shall set the N1 NAS signalling connection release bit to "N1 NAS signalling connection release supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE indicates support of the paging indication for voice services in the REGISTRATION REQUEST message </condition> and <condition> the network decides to accept the paging indication for voice services, </condition> </condition> <action> then the AMF shall set the paging indication for voice services bit to "paging indication for voice services supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. </action> </control> <control> <condition> Upon receipt of REGISTRATION ACCEPT message with the paging indication for voice services bit set to "paging indication for voice services supported", </condition> <action> the UE NAS layer informs the lower layers that paging indication for voice services is supported. </action> </control> <control> <condition> Otherwise, </condition> <action> the UE NAS layer informs the lower layers that paging indication for voice services is not supported. </action> </control>
<control> <condition> <condition> If the UE indicates support of the reject paging request in the REGISTRATION REQUEST message </condition> and <condition> the network decides to accept the reject paging request, </condition> </condition> <action> then the AMF shall set the reject paging request bit to "reject paging request supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE indicates support of the paging restriction in the REGISTRATION REQUEST message, </condition> and <condition> <condition> the AMF sets: <condition> a) the reject paging request bit to "reject paging request supported"; </condition> <condition> b) the N1 NAS signalling connection release bit to "N1 NAS signalling connection release supported"; </condition> or <condition> c) both of them; </condition> </condition> <condition> in the 5GS network feature support IE of the REGISTRATION ACCEPT message, </condition> and <condition> the network decides to accept the paging restriction, </condition> </condition> </condition> <action> then the AMF shall set the paging restriction bit to "paging restriction supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE has set the Follow-on request indicator to "Follow-on request pending" in the REGISTRATION REQUEST message, </condition> or <condition> the network has downlink signalling pending, </condition> </condition> <action> the AMF shall not immediately release the NAS signalling connection </action> <condition> after the completion of the registration procedure. </condition> </control>
<control> <condition> If the UE is authorized to use V2X communication over PC5 reference point based on: <condition> a) <condition> at least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, </condition> or <condition> already stored in the 5GMM context in the AMF during the previous registration procedure as follows: <condition> 1) the V2XCEPC5 bit to "V2X communication over E-UTRA-PC5 supported"; </condition> or <condition> 2) the V2XCNPC5 bit to "V2X communication over NR-PC5 supported"; </condition> </condition> </condition> and <condition> b) the user's subscription context obtained from the UDM as defined in 3GPP TS 23.287 ; </condition> </condition> <action> the AMF should not immediately release the NAS signalling connection after the completion of the registration procedure. </action> </control>
<control> <condition> If the UE is authorized to use 5G ProSe services based on: <condition> a) <condition> at least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, </condition> or <condition> already stored in the 5GMM context in the AMF during the previous registration procedure as follows: <condition> 1) the 5G ProSe direct discovery bit to "5G ProSe direct discovery supported"; </condition> or <condition> 2) the 5G ProSe direct communication bit to "5G ProSe direct communication supported"; </condition> </condition> and <condition> b) the user's subscription context obtained from the UDM as defined in 3GPP TS 23.304 ; </condition> </condition> </condition> <action> the AMF should not immediately release the NAS signalling connection after the completion of the registration procedure. </action> </control>
<control> <condition> If the Requested DRX parameters IE was included in the REGISTRATION REQUEST message, </condition> <action> the AMF shall include the Negotiated DRX parameters IE in the REGISTRATION ACCEPT message. </action> <action> The AMF may set the Negotiated DRX parameters IE based on the received Requested DRX parameters IE and operator policy </action> <condition> if available. </condition> </control>
<control> <condition> If the Requested NB-N1 mode DRX parameters IE was included in the REGISTRATION REQUEST message, </condition> <action> the AMF shall include the Negotiated NB-N1 mode DRX parameters IE in the REGISTRATION ACCEPT message. </action> <action> The AMF may set the Negotiated NB-N1 mode DRX parameters IE based on the received Requested NB-N1 mode DRX parameters IE and operator policy </action> <condition> if available. </condition> </control>
<control> <action> The AMF shall include the Negotiated extended DRX parameters IE in the REGISTRATION ACCEPT message </action> <condition> <condition> only if the Requested extended DRX parameters IE was included in the REGISTRATION REQUEST message, </condition> and <condition> the AMF supports and accepts the use of eDRX. </condition> </condition> <action> The AMF may set the Negotiated extended DRX parameters IE based on the received Requested extended DRX parameters IE, operator policy, information from NG-RAN and the user's subscription context obtained from the UDM </action> <condition> if available. </condition> </control>
<control> <condition> If: <condition> a) <condition> the UE's USIM is configured with indication that the UE is to receive the SOR transparent container IE, </condition> <condition> the SOR transparent container IE included in the REGISTRATION ACCEPT message does not successfully pass the integrity check (see 3GPP TS 33.501 ); </condition> </condition> and <condition> b) if the UE attempts obtaining service on another PLMNs as specified in 3GPP TS 23.122 annex C; </condition> </condition> <action> then the UE shall locally release the established N1 NAS signalling connection after sending a REGISTRATION COMPLETE message. </action> </control>
<control> <condition> If: <condition> a) <condition> the UE's USIM is configured with indication that the UE is to receive the SOR transparent container IE, </condition> <condition> the SOR transparent container IE is not included in the REGISTRATION ACCEPT message; </condition> </condition> and <condition> b) the UE attempts obtaining service on another PLMNs as specified in 3GPP TS 23.122 annex C; </condition> </condition> <action> then the UE shall locally release the established N1 NAS signalling connection. </action> </control>
<control> <condition> If: <condition> a) the UE operates in SNPN access operation mode; </condition> <condition> b) the ME is configured to indicate that the UE shall expect to receive the steering of roaming information during initial registration procedure for the selected entry of the "list of subscriber data" or the selected PLMN subscription; </condition> <condition> c) the SOR transparent container IE included in the REGISTRATION ACCEPT message does not successfully pass the integrity check (see 3GPP TS 33.501 ); </condition> and <condition> d) the UE attempts obtaining service on another SNPN as specified in 3GPP TS 23.122 annex C; </condition> </condition> <action> then the UE shall locally release the established N1 NAS signalling connection after sending a REGISTRATION COMPLETE message. </action> </control>
<control> <condition> If: <condition> a) the UE operates in SNPN access operation mode; </condition> <condition> b) the ME is configured to indicate that the UE shall expect to receive the steering of roaming information during initial registration procedure for the selected entry of the "list of subscriber data" or the selected PLMN subscription; </condition> <condition> c) the SOR transparent container IE is not included in the REGISTRATION ACCEPT message; </condition> and <condition> d) the UE attempts obtaining service on another SNPN as specified in 3GPP TS 23.122 annex C; </condition> </condition> <action> then the UE shall locally release the established N1 NAS signalling connection. </action> </control> <control> <condition> <condition> If the REGISTRATION ACCEPT message includes the SOR transparent container IE </condition> and <condition> the SOR transparent container IE successfully passes the integrity check (see 3GPP TS 33.501 ), </condition> </condition> <action> the ME shall store the received SOR counter as specified in annex C </action> and proceed as follows: <control> a) <action> the UE shall proceed with the behaviour as specified in 3GPP TS 23.122 annex C; </action> </control> and <control> <condition> b) if the registration procedure is performed over 3GPP access and the UE attempts obtaining service on another PLMNs or SNPNs as specified in 3GPP TS 23.122 annex C, </condition> <action> then the UE may locally release the established N1 NAS signalling connection after sending a REGISTRATION COMPLETE message. </action> <condition> Otherwise </condition> <action> the UE shall send a REGISTRATION COMPLETE message </action> and <action> not release the current N1 NAS signalling connection locally. </action> </control> <control> <condition> If an acknowledgement is requested in the SOR transparent container IE of the REGISTRATION ACCEPT message, </condition> <action> the UE acknowledgement is included in the SOR transparent container IE of the REGISTRATION COMPLETE message. </action> <control> <condition> In the SOR transparent container IE carrying the acknowledgement, </condition> <action> the UE shall set the ME support of SOR-CMCI indicator to "SOR-CMCI supported by the ME". </action> </control> </control> <control> Additionally, <condition> <condition> if the UE supports access to an SNPN using credentials from a credentials holder </condition> and <condition> the UE is not operating in SNPN access operation mode, </condition> </condition> <action> the UE may set the ME support of SOR-SNPN-SI indicator to "SOR-SNPN-SI supported by the ME". </action> </control> </control>
<control> <condition> If the SOR transparent container IE successfully passes the integrity check (see 3GPP TS 33.501 ) </condition> and: <control> a) the list type indicates: 1) <condition> "PLMN ID and access technology list", and the SOR transparent container IE indicates a list of preferred PLMN/access technology combinations is provided, </condition> <action> then the ME shall replace the highest priority entries in the "Operator Controlled PLMN Selector with Access Technology" list stored in the ME </action> and <action> shall proceed with the behaviour as specified in 3GPP TS 23.122 annex C; </action> </control> or <control> 2) <condition> "secured packet", </condition> <action> then the ME shall behave as if a SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of SOR transparent container IE. </action> <action> The SMS payload is forwarded to UICC as specified in 3GPP TS 23.040 </action> and <action> the ME shall proceed with the behaviour as specified in 3GPP TS 23.122 annex C; </action> </control> or <control> <condition> b) <condition> the list type indicates "PLMN ID and access technology list" </condition> and <condition> the SOR transparent container IE indicates "HPLMN indication that 'no change of the "Operator Controlled PLMN Selector with Access Technology" list stored in the UE is needed </condition> and <condition> thus no list of preferred PLMN/access technology combinations is provided'", </condition> </condition> <action> the UE operates in SNPN access operation mode and the SOR transparent container IE includes SOR-SNPN-SI, </action> <action> the ME shall replace SOR-SNPN-SI of the selected entry of the "list of subscriber data" or associated with the selected PLMN subscription, as specified in 3GPP TS 23.122 with the received SOR-SNPN-SI. </action> </control> </control>
<control> <condition> If the SOR-CMCI is present and the Store SOR-CMCI in ME indicator is set to "Store SOR-CMCI in ME" </condition> <action> then the UE shall store or delete the SOR-CMCI in the non-volatile memory of the ME as described in annex C.1. </action> </control>
The UE shall proceed with the behaviour as specified in 3GPP TS 23.122 annex C.
<control> <condition> If the SOR transparent container IE does not pass the integrity check successfully, </condition> <action> then the UE shall discard the content of the SOR transparent container IE. </action> </control>
<control> <condition> If required by operator policy, </condition> <action> the AMF shall include the NSSAI inclusion mode IE in the REGISTRATION ACCEPT message (see table 4.6.2.3.1 of subclause 4.6.2.3). </action> </control> <control> <condition> Upon receipt of the REGISTRATION ACCEPT message: </condition> <control> <condition> a) if the message includes the NSSAI inclusion mode IE, </condition> <action> the UE shall operate in the NSSAI inclusion mode indicated in the NSSAI inclusion mode IE over the current access within the current PLMN or SNPN and its equivalent PLMN(s), </action> <condition> if any, </condition> <condition> in the current registration area; </condition> </control> or <control> <condition> b) otherwise: </condition> <control> 1) <condition> if the UE has NSSAI inclusion mode for the current PLMN or SNPN and access type stored in the UE, </condition> <action> the UE shall operate in the stored NSSAI inclusion mode; </action> </control> <control> 2) <condition> <condition> if the UE does not have NSSAI inclusion mode for the current PLMN or SNPN </condition> and <condition> the access type stored in the UE </condition> and <condition> if the UE is performing the registration procedure over: <control> <condition> i) 3GPP access, </condition> <action> the UE shall operate in NSSAI inclusion mode D in the current PLMN or SNPN and the current access type; </action> </control> <control> ii) <condition> untrusted non-3GPP access, </condition> <action> the UE shall operate in NSSAI inclusion mode B in the current PLMN and the current access type; </action> </control> or <control> iii) <condition> trusted non-3GPP access, </condition> <action> the UE shall operate in NSSAI inclusion mode D in the current PLMN and the current access type; </action> </control> </condition> </condition> </control> or <control> 3) <condition> <condition> if the 5G-RG does not have NSSAI inclusion mode for the current PLMN and wireline access stored in the 5G-RG, </condition> and <condition> the 5G-RG is performing the registration procedure over wireline access, </condition> </condition> <action> the 5G-RG shall operate in NSSAI inclusion mode B in the current PLMN and the current access type. </action> </control> </control> </control>
<control> <action> The AMF may include operator-defined access category definitions in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE receives Operator-defined access category definitions IE in the REGISTRATION ACCEPT message </condition> and <condition> the Operator-defined access category definitions IE contains one or more operator-defined access category definitions, </condition> </condition> <action> the UE shall delete any operator-defined access category definitions stored for the RPLMN </action> and <action> shall store the received operator-defined access category definitions for the RPLMN. </action> </control> <control> <condition> If the UE receives the Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains no operator-defined access category definitions, </condition> <action> the UE shall delete any operator-defined access category definitions stored for the RPLMN. </action> </control> <control> <condition> If the REGISTRATION ACCEPT message does not contain the Operator-defined access category definitions IE, </condition> <action> the UE shall not delete the operator-defined access category definitions stored for the RPLMN. </action> </control>
<control> <condition> If the UE has indicated support for service gap control in the REGISTRATION REQUEST message </condition> and: <control> <condition> a) the REGISTRATION ACCEPT message contains the T3447 value IE, </condition> <action> then the UE shall store the new T3447 value, </action> <action> erase any previous stored T3447 value </action> <condition> if exists </condition> and <action> use the new T3447 value with the timer T3447 next time it is started; </action> </control> or <control> <condition> b) the REGISTRATION ACCEPT message does not contain the T3447 value IE, </condition> <action> then the UE shall erase any previous stored T3447 value </action> <condition> if exists </condition> and <action> stop the timer T3447 </action> <condition> if running. </condition> </control> </control>
<control> <condition> <condition> If the T3448 value IE is present in the received REGISTRATION ACCEPT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> the UE shall: <action> a) stop timer T3448 if it is running; </action> and <action> b) start timer T3448 with the value provided in the T3448 value IE. </action> </control>
<control> <condition> <condition> If the UE is using 5GS services with control plane CIoT 5GS optimization, </condition> <condition> the T3448 value IE is present in the REGISTRATION ACCEPT message </condition> and <condition> the value indicates that this timer is either zero or deactivated, </condition> </condition> <action> the UE shall ignore the T3448 value IE </action> and <action> proceed as if the T3448 value IE was not present. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains the Truncated 5G-S-TMSI configuration IE, </condition> <action> then the UE shall store the included truncated 5G-S-TMSI configuration </action> and <action> return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the truncated 5G-S-TMSI configuration. </action> </control>
NOTE 19: <control> <action> The UE provides the truncated 5G-S-TMSI configuration to the lower layers. </action> </control>
<control> <condition> If the UE is not in NB-N1 mode, </condition> <action> the UE has set the RACS bit to "RACS supported" in the 5GMM Capability IE of the REGISTRATION REQUEST message </action> and the REGISTRATION ACCEPT message includes: <control> a) a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", <action> the UE shall delete any network-assigned UE radio capability IDs associated with the RPLMN or RSNPN </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, </condition> <condition> the selected entry of the "list of subscriber data" or the selected PLMN subscription stored at the UE, </condition> <action> then the UE shall, <condition> after the completion of the ongoing registration procedure, </condition> initiate a registration procedure for mobility and periodic registration update as specified in subclause 5.5.1.3.2 over the existing N1 NAS signalling connection; </action> </control> or <control> b) a UE radio capability ID IE, </control> <action> the UE shall store the UE radio capability ID as specified in annex C. </action> </control>
<control> <condition> <condition> If the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message </condition> and <condition> the REGISTRATION ACCEPT message contains the service-level-AA pending indication in the Service-level-AA container IE, </condition> </condition> <action> the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the service-level-AA pending indication, </action> and <action> the UE shall not attempt to perform another registration procedure for UAS services </action> <condition> until the UUAA-MM procedure is completed, </condition> or <action> to establish a PDU session for USS communication or a PDU session for C2 communication </action> <condition> until the UUAA-MM procedure is completed successfully. </condition> </control>
<control> <condition> <condition> If the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message </condition> and <condition> the REGISTRATION ACCEPT message does not contain the service-level-AA pending indication in the Service-level-AA container IE, </condition> </condition> <action> the UE shall consider the UUAA-MM procedure is not triggered. </action> </control>
<control> <condition> <condition> If the REGISTRATION REQUEST message includes the 5GS registration type IE set to "SNPN onboarding registration" </condition> or <condition> the network determines that the UE's subscription only allows for configuration of SNPN subscription parameters in PLMN via the user plane, </condition> </condition> <action> the AMF may start an implementation specific timer for onboarding services </action> <condition> when the network considers that the UE is in 5GMM-REGISTERED (i.e. the network receives the REGISTRATION COMPLETE message from UE). </condition> </control>
NOTE 20: <control> <condition> <condition> If the AMF considers that the UE is in 5GMM-IDLE, </condition> <condition> when the implementation specific timer for onboarding services expires </condition> and <condition> the network considers that the UE is still in state 5GMM-REGISTERED, </condition> </condition> <action> the AMF can locally de-register the UE; </action> or <condition> if the UE is in 5GMM-CONNECTED, </condition> <action> the AMF can initiate the network-initiated de-registration procedure (see subclause 5.5.2.3). </action> </control>
NOTE 21: The value of the implementation specific timer for onboarding services needs to be large enough to allow a UE to complete the configuration of one or more entries of the "list of subscriber data" taking into consideration that configuration of SNPN subscription parameters in PLMN via the user plane or onboarding services in SNPN involves third party entities outside of the operator's network.
<control> <condition> If the UE receives the List of PLMNs to be used in disaster condition IE in the REGISTRATION ACCEPT message </condition> and <condition> the UE supports MINT, </condition> <action> the UE shall delete the "list of PLMN(s) to be used in disaster condition" stored in the ME together with the PLMN ID of the RPLMN, </action> <condition> if any, </condition> and <action> may store the "list of PLMN(s) to be used in disaster condition" included in the List of PLMNs to be used in disaster condition IE in the ME together with the PLMN ID of the RPLMN. </action> </control>
<control> <condition> <condition> If the UE receives the Disaster roaming wait range IE in the REGISTRATION ACCEPT message </condition> and <condition> the UE supports MINT, </condition> </condition> <action> the UE shall delete the disaster roaming wait range stored in the ME, </action> <condition> if any, </condition> and <action> store the disaster roaming wait range included in the Disaster roaming wait range IE in the ME. </action> </control>
<control> <condition> <condition> If the UE receives the Disaster return wait range IE in the REGISTRATION ACCEPT message </condition> and <condition> the UE supports MINT, </condition> </condition> <action> the UE shall delete the disaster return wait range stored in the ME, </action> <condition> if any, </condition> and <action> store the disaster return wait range included in the Disaster return wait range IE in the ME. </action> </control>
<control> <condition> If the 5GS registration type IE in the REGISTRATION REQUEST message is set to "disaster roaming initial registration" and: </condition> </control>
<control> <condition> a) the MS determined PLMN with disaster condition IE is included in the REGISTRATION REQUEST message, </condition> <action> the AMF shall determine the PLMN with disaster condition in the MS determined PLMN with disaster condition IE; </action> </control> <control> <condition> b) <condition> the MS determined PLMN with disaster condition IE is not included in the REGISTRATION REQUEST message and the Additional GUTI IE is included in the REGISTRATION REQUEST message </condition> and <condition> contains 5G- GUTI of a PLMN of the country of the PLMN providing disaster roaming, </condition> </condition> <action> the AMF shall determine the PLMN with disaster condition in the PLMN identity of the 5G-GUTI; </action> </control> <control> <condition> c) the MS determined PLMN with disaster condition IE and the Additional GUTI IE are not included in the REGISTRATION REQUEST message and: </condition> </control>
<control> 1) <condition> the 5GS mobile identity IE contains 5G-GUTI of a PLMN of the country of the PLMN providing disaster roaming, </condition> <action> the AMF shall determine the PLMN with disaster condition in the PLMN identity of the 5G-GUTI; </action> </control> or <control> 2) <condition> the 5GS mobile identity IE contains SUCI of a PLMN of the country of the PLMN providing disaster roaming, </condition> <action> the AMF shall determine the PLMN with disaster condition in the PLMN identity of the SUCI; </action> </control> or
<control> <condition> d) <condition> the MS determined PLMN with disaster condition IE is not included in the REGISTRATION REQUEST message, </condition> <condition> NG-RAN of the PLMN providing disaster roaming broadcasts disaster roaming indication </condition> and: <condition> <condition> a) the Additional GUTI IE is included in the REGISTRATION REQUEST message and contains 5G-GUTI of a PLMN of a country other than the country of the PLMN providing disaster roaming; </condition> or b) <condition> the Additional GUTI IE is not included and the 5GS mobile identity IE contains 5G-GUTI or SUCI of a PLMN of a country other than the country of the PLMN providing disaster roaming; </condition> </condition> </condition> <action> the AMF shall determine the PLMN with disaster condition based on the disaster roaming agreement arrangement between mobile network operators. </action> </control>
NOTE 22: The disaster roaming agreement arrangement between mobile network operators is out scope of 3GPP.
<control> <condition> <condition> If the AMF determines that a disaster condition applies to the PLMN with disaster condition, </condition> and <condition> the UE is allowed to be registered for disaster roaming services, </condition> </condition> <action> the AMF shall set the Disaster roaming registration result value bit in the 5GS registration result IE to "no additional information" in the REGISTRATION ACCEPT message. </action> <control> <condition> If the AMF determines that the UE can be registered to the PLMN for normal service, </condition> <action> the AMF shall set the Disaster roaming registration result value bit in the 5GS registration result IE to "request for registration for disaster roaming service accepted as registration not for disaster roaming service " in the REGISTRATION ACCEPT message. </action> </control> </control>
<control> <condition> <condition> If the UE indicates "disaster roaming initial registration" in the 5GS registration type IE in the REGISTRATION REQUEST message </condition> and <condition> the 5GS registration result IE value in the REGISTRATION ACCEPT message is set to: </condition> </condition> </control> <control> <condition> a) "request for registration for disaster roaming service accepted as registration not for disaster roaming service", </condition> <action> the UE shall consider itself registered for normal service. </action> <control> <condition> If the PLMN identity of the registered PLMN is a member of the forbidden PLMN list as specified in subclause 5.3.13A, </condition> <action> any such PLMN identity shall be deleted from the corresponding list(s); </action> </control> or <control> <condition> b) "no additional information", </condition> <action> the UE shall consider itself registered for disaster roaming. </action> </control> </control>
<control> <condition> <condition> If the UE receives the forbidden TAI(s) for the list of "5GS forbidden tracking areas for roaming" IE in the REGISTRATION ACCEPT message </condition> and <condition> if the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for roaming", </condition> </condition> <action> the UE shall store the TAI(s) included in the IE, <condition> if not already stored, </condition> into the list of "5GS forbidden tracking areas for roaming". </action> </control>
<control> <condition> <condition> If the UE receives the forbidden TAI(s) for the list of "5GS forbidden tracking areas for regional provision of service" IE in the REGISTRATION ACCEPT message </condition> and <condition> if the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for regional provision of service", </condition> </condition> <action> the UE shall store the TAI(s) included in the IE, <condition> if not already stored, </condition> into the list of "5GS forbidden tracking areas for regional provision of service". </action> </control>
5.5.1.2.5 Initial registration not accepted by the network
<control> <condition> If the initial registration request cannot be accepted by the network, </condition> <action> the AMF shall send a REGISTRATION REJECT message to the UE including an appropriate 5GMM cause value. </action> </control>
<control> <condition> If the initial registration request is rejected due to general NAS level mobility management congestion control, </condition> <action> the network shall set the 5GMM cause value to #22 "congestion" </action> and <action> assign a value for back-off timer T3346. </action> </control>
<control> <condition> <condition> In NB-N1 mode, </condition> <condition> if the registration request is rejected due to operator determined barring (see 3GPP TS 29.503 ), </condition> </condition> <action> the network shall set the 5GMM cause value to #22 "congestion" </action> and <action> assign a value for back-off timer T3346. </action> </control>
<control> <condition> If the REGISTRATION REJECT message with 5GMM cause #76 or #78 was received without integrity protection, </condition> <action> then the UE shall discard the message. </action> </control> <control> <condition> If the REGISTRATION REJECT message with 5GMM cause #62 was received without integrity protected, </condition> the behaviour of the UE is specified in subclause 5.3.20.2. </control>
<control> Based on operator policy, <condition> if the initial registration request is rejected due to core network redirection for CIoT optimizations, </condition> <action> the network shall set the 5GMM cause value to #31 "Redirection to EPC required". </action> </control>
NOTE 1: The network can take into account the UE's S1 mode capability, the EPS CIoT network behaviour supported by the UE or the EPS CIoT network behaviour supported by the EPC to determine the rejection with the 5GMM cause value #31 "Redirection to EPC required".
<control> <condition> If the initial registration request is rejected because: <condition> a) all the S-NSSAI(s) included in the requested NSSAI are rejected; </condition> and <condition> b) the UE set the NSSAA bit in the 5GMM capability IE to: <condition> 1) <condition> "Network slice-specific authentication and authorization supported" </condition> and: <condition> i) there are no default S-NSSAIs; </condition> <condition> ii) all default S-NSSAIs are not allowed; </condition> or <condition> iii) <condition> network slice-specific authentication and authorization has failed </condition> or <condition> been revoked for all default S- NSSAIs and based on network local policy, </condition> <condition> the network decides not to initiate the network slice-specific re-authentication and re-authorization procedures for any subscribed S-NSSAI marked as default requested by the UE; </condition> </condition> </condition> or <condition> 2) <condition> "Network slice-specific authentication and authorization not supported"; </condition> and <condition> i) there are no default S-NSSAIs; </condition> or <condition> ii) all default S-NSSAIs are either not allowed or are subject to network slice-specific authentication and authorization; </condition> </condition> </condition> </condition> <action> the network shall set the 5GMM cause value to #62 "No network slices available" </action> and <action> shall include the rejected S- NSSAI(s) in the rejected NSSAI of the REGISTRATION REJECT message. </action> </control> <control> <condition> Otherwise, </condition> <action> the network may include the rejected S-NSSAI(s) in the rejected NSSAI of the REGISTRATION REJECT message. </action> </control>
<control> <condition> If the UE has set the ER-NSSAI bit to "Extended rejected NSSAI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> <action> the rejected S-NSSAI(s) shall be included in the Extended rejected NSSAI IE of the REGISTRATION REJECT message. </action> </control> <control> <condition> Otherwise </condition> <action> the rejected S-NSSAI(s) shall be included in the Rejected NSSAI IE of the REGISTRATION REJECT message. </action> </control>
<control> <condition> <condition> If the UE supports extended rejected NSSAI </condition> and <condition> the AMF determines that maximum number of UEs reached for one or more S-NSSAIs in the requested NSSAI as specified in subclause 4.6.2.5, </condition> </condition> <action> the AMF shall include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause "S-NSSAI not available due to maximum number of UEs reached" in the Extended rejected NSSAI IE in the REGISTRATION REJECT message. </action> <action> In addition, the AMF may include a back-off timer value for each S-NSSAI with the rejection cause "S-NSSAI not available due to maximum number of UEs reached" in the Extended rejected NSSAI IE of the REGISTRATION REJECT message. </action> </control>
<control> <condition> <condition> If the AMF receives the initial registration request along with the authenticated indication over N2 reference point on non-3GPP access </condition> and <condition> does not receive the indication that authentication by the home network is not required over N12 reference point, </condition> </condition> <action> the network shall set the 5GMM cause value to #72 "Non-3GPP access to 5GCN not allowed". </action> </control>
<control> <condition> If the initial registration request from a UE supporting CAG is rejected due to CAG restrictions, </condition> <action> the network shall set the 5GMM cause value to #76 "Not authorized for this CAG or authorized for CAG cells only" </action> and <action> should include the "CAG information list" in the CAG information list IE or the Extended CAG information list IE in the REGISTRATION REJECT message. </action> </control>
NOTE 2: The network cannot be certain that "CAG information list" stored in the UE is updated as result of sending of the REGISTRATION REJECT message with the CAG information list IE or the Extended CAG information list IE, as the REGISTRATION REJECT message is not necessarily delivered to the UE (e.g. due to abnormal radio conditions).
NOTE 3: The "CAG information list" can be provided by the AMF and include no entry if no "CAG information list" exists in the subscription.
NOTE 4: <control> <condition> If the UE supports extended CAG information list, </condition> the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE. </control>
<control> <condition> If the UE does not support extended CAG information list, </condition> <action> the CAG information list shall not be included in the Extended CAG information list IE. </action> </control>
<control> <condition> If the initial registration request from a UE not supporting CAG is rejected due to CAG restrictions, </condition> <action> the network shall operate as described in bullet j) of subclause 5.5.1.2.8. </action> </control>
<control> <condition> <condition> If the UE's initial registration request is via a satellite NG-RAN cell </condition> and <condition> the network using the User Location Information provided by the NG-RAN, </condition> see 3GPP TS 38.413 , <condition> is able to determine that the UE is in a location where the network is not allowed to operate, </condition> </condition> <action> the network shall set the 5GMM cause value in the REGISTRATION REJECT message to #78 "PLMN not allowed to operate at the present UE location". </action> </control>
NOTE 5: <control> <condition> When the UE is accessing network for emergency services, </condition> it is up to operator and regulatory policies whether the network needs to determine if the UE is in a location where network is not allowed to operate. </control>
<control> <condition> <condition> If the AMF receives the initial registration request including the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE </condition> and <condition> the AMF determines that the UE is not allowed to use UAS services via 5GS based on the user's subscription data and the operator policy, </condition> </condition> <action> the AMF shall return a REGISTRATION REJECT message with 5GMM cause #79 (UAS services not allowed). </action> </control>
<control> <condition> <condition> If the UE initiates the registration procedure for disaster roaming </condition> and <condition> the AMF determines that it does not support providing disaster roaming services for the determined PLMN with disaster condition to the UE, </condition> </condition> <action> then the AMF shall send a REGISTRATION REJECT message with 5GMM cause #80 (Disaster roaming for the determined PLMN with disaster condition not allowed). </action> </control>
<control> <action> Regardless of the 5GMM cause value received in the REGISTRATION REJECT message, </action> <control> <condition> a) <condition> if the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for roaming" IE in the REGISTRATION REJECT message </condition> and <condition> if the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for roaming", </condition> </condition> <action> the UE shall store the TAI(s) included in the IE, </action> <condition> if not already stored, </condition> <action> into the list of "5GS forbidden tracking areas for roaming" </action> and <action> remove the TAI(s) from the stored TAI list <condition> if present; </condition> </action> </control> and <control> <condition> b) <condition> if the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for regional provision of service" IE in the REGISTRATION REJECT message </condition> and <condition> if the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for regional provision of service", </condition> </condition> <action> the UE shall store the TAI(s) included in the IE, </action> <condition> if not already stored, </condition> <action> into the list of "5GS forbidden tracking areas for regional provision of service" </action> and <action> remove the TAI(s) from the stored TAI list <condition> if present. </condition> </action> </control> </control>
<control> <action> Furthermore, the UE shall take the following actions depending on the 5GMM cause value received in the REGISTRATION REJECT message. </action> </control>
<control> <condition> <condition> #3 (Illegal UE); </condition> or <condition> #6 (Illegal ME). </condition> </condition> </control>
<control> <end_state> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED </end_state> (and shall store it according to subclause 5.1.3.2.2) and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control> <control> <condition> In case of PLMN, </condition> <action> the UE shall consider the USIM as invalid for 5GS services until switching off, </action> <action> the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.19a.1; </action> </control> <control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE is not performing initial registration for onboarding services in SNPN </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid </action> <condition> until the UE is switched off, the entry is updated or the timer T3245 expires as described in clause 5.3.19a.2. </condition> </control> <control> <condition> <condition> In case of SNPN, </condition> <condition> <condition> if the UE is not performing initial registration for onboarding services in SNPN </condition> and <condition> the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid for 3GPP access </action> <condition> until the UE is switched off, the entry is updated or the timer T3245 expires as described in clause 5.3.19a.2. </condition> </control> <control> Additionally, <condition> if EAP based primary authentication and key agreement procedure using EAP-AKA' or 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, </condition> <action> the UE shall consider the USIM as invalid for the current SNPN until switching off, </action> <action> the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.19a.2. </action> </control>
<control> <condition> If the UE is not performing initial registration for onboarding services in SNPN </condition> and <action> the UE shall delete the list of equivalent PLMNs (if any) </action> and <end_state> enter the state 5GMM-DEREGISTERED.NO-SUPI. </end_state> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> then the UE shall: <action> 1) set the counter for "SIM/USIM considered invalid for GPRS services" events and the counter for "USIM considered invalid for 5GS services over non-3GPP access" events in case of PLMN </action> <condition> if the UE maintains these counters; </condition> or <action> 2) set the counter for "the entry for the current SNPN considered invalid for 3GPP access" events and the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events in case of SNPN <condition> if the UE maintains these counters; </condition> to a UE implementation-specific maximum value. </action> </control> <control> 3) <action> delete the 5GMM parameters stored in non-volatile memory of the ME as specified in annex C. </action> </control> <control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 <condition> for the case when the EPS attach request procedure is rejected with the EMM cause with the same value. </condition> </action> <action> The USIM shall be considered as invalid also for non-EPS services </action> <condition> until switching off, </condition> <action> the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a in 3GPP TS 24.301 . </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> </condition> <action> then the UE shall set this counter to a UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> If the UE is performing initial registration for onboarding services in SNPN, </condition> <action> the UE shall reset the registration attempt counter, </action> <action> store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
<control> <condition> #7 (5GS services not allowed). </condition> </control>
<control> <end_state> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </end_state> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control> <control> <condition> In case of PLMN, </condition> <action> the UE shall consider the USIM as invalid for 5GS services </action> <condition> until switching off, </condition> <action> the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.19a.1; </action> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> <condition> if the UE is not performing initial registration for onboarding services in SNPN </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid for 5GS services </action> <condition> until the UE is switched off, </condition> <action> the entry is updated or the timer T3245 expires as described in clause 5.3.19a.2. </action> </control> <control> <condition> <condition> In case of SNPN, </condition> <condition> <condition> if the UE is not performing initial registration for onboarding services in SNPN </condition> and <condition> the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid for 3GPP access </action> <condition> until the UE is switched off, the entry is updated or the timer T3245 expires as described in clause 5.3.19a.2. </condition> </control> <control> Additionally, <condition> <condition> if EAP based primary authentication </condition> and <condition> key agreement procedure using EAP-AKA' </condition> or <condition> 5G AKA based primary authentication </condition> and <condition> key agreement procedure was performed in the current SNPN, </condition> </condition> <action> the UE shall consider the USIM as invalid for the current SNPN </action> <condition> until switching off, </condition> <action> the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.19a.2. </action> </control>
<control> <condition> If the UE is not performing initial registration for onboarding services in SNPN, </condition> <end_state> the UE shall enter the state 5GMM-DEREGISTERED.NO-SUPI. </end_state> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> then the UE shall: 1) set the counter for "SIM/USIM considered invalid for GPRS services" events and the counter for "USIM considered invalid for 5GS services over non-3GPP access" events in case of PLMN if the UE maintains these counters; or 2) set the counter for "the entry for the current SNPN considered invalid for 3GPP access" events and the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events in case of SNPN if the UE maintains these counters;to a UE implementation-specific maximum value. 3) delete the 5GMM parameters stored in non-volatile memory of the ME as specified in annex C. </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the EPS attach request procedure is rejected with the EMM cause with the same value. </condition> </control>
<control> <condition> If the UE is performing initial registration for onboarding services in SNPN, </condition> <action> the UE shall reset the registration attempt counter, </action> <action> store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
<control> <condition> #11 (PLMN not allowed). </condition> </control>
This cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.2.7.
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall delete the list of equivalent PLMNs </action> and <action> reset the registration attempt counter </action> and <action> store the PLMN identity in the forbidden PLMN list as specified in subclause 5.3.13A </action> and <condition> if the UE is configured to use timer T3245 </condition> <action> then the UE shall start timer T3245 and proceed as described in clause 5.3.19a.1. </action> <control> For <end_state> 3GPP access the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform a PLMN selection according to 3GPP TS 23.122 , </action> and <end_state> for non-3GPP access the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE </end_state> and <action> perform network selection as defined in 3GPP TS 24.502 . </action> </control> </control> <control> <condition> If the message has been successfully integrity checked by the NAS and the UE maintains the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN, </condition> <action> the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN to the UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the EPS attach request procedure is rejected with the EMM cause with the same value. </condition> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access to the same PLMN, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
<control> <condition> #12 (Tracking area not allowed). </condition> </control>
<action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) and shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> Additionally, the UE shall reset the registration attempt counter. </action>
If: <control> 1) <condition> the UE is not operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for regional provision of service" </action> and <end_state> enter the state 5GMM- DEREGISTERED.LIMITED-SERVICE. </end_state> </control> <control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message; </action> </control> or <control> 2) <condition> the UE is operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for regional provision of service" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control> <control> <condition> If the REGISTRATION REJECT is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for regional provision of service" for the current SNPN </action> and, <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, for non-integrity protected NAS reject message. </condition> </control> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the EPS attach request procedure is rejected with the EMM cause with the same value. </condition> </control>
<control> <condition> #13 (Roaming not allowed in this tracking area). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> Additionally, the UE shall delete the list of equivalent PLMNs (if available) and reset the registration attempt counter. </action> </control>
<control> 1) <condition> the UE is not operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" </action> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE or optionally 5GMM-DEREGISTERED.PLMN-SEARCH. </end_state> </control> <control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for non-integrity protected NAS reject message; </action> </control> or <control> 2) <condition> the UE is operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> </control> and, <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE or optionally 5GMM- DEREGISTERED.PLMN-SEARCH. </end_state> </control> <control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, for non-integrity protected NAS reject message. </condition> </control>
<control> For 3GPP access, <condition> if the UE is registered in S1 mode and operating in dual-registration mode, </condition> <action> the PLMN that the UE chooses to register in is specified in subclause 4.8.3. </action> </control> <control> <condition> Otherwise </condition> <action> the UE shall perform a PLMN selection or SNPN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> For non-3GPP access, </condition> <action> the UE shall perform network selection as defined in 3GPP TS 24.502 . </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the EPS attach request procedure is rejected with the EMM cause with the same value. </condition> </control>
<control> <condition> #15 (No suitable cells in tracking area). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> Additionally, the UE shall reset the registration attempt counter. </action> </control>
<control> 1) <condition> the UE is not operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" </action> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control> <control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for non-integrity protected NAS reject message; </action> </control> or <control> 2) <condition> the UE is operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control> <control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, for non-integrity protected NAS reject message. </condition> </control>
<control> <action> The UE shall search for a suitable cell in another tracking area according to 3GPP TS 38.304 or 3GPP TS 36.304 . </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the EPS attach request procedure is rejected with the EMM cause with the same value. </condition> </control>
<control> <condition> If received over non-3GPP access </condition> the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.1.2.7. </control>
<control> <condition> #22 (Congestion). </condition> </control>
<control> <condition> <condition> If the T3346 value IE is present in the REGISTRATION REJECT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> <action> the UE shall proceed as described below; </action> </control> <control> <condition> otherwise </condition> <action> it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.1.2.7. </action> </control>
<control> <action> The UE shall abort the initial registration procedure, set the 5GS update status to 5U2 NOT UPDATED, reset the registration attempt counter </action> and <end_state> enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION. </end_state> </control>
<control> <action> The UE shall stop timer T3346 </action> <condition> if it is running. </condition> </control>
<control> <condition> If the REGISTRATION REJECT message is integrity protected, </condition> <action> the UE shall start timer T3346 with the value provided in the T3346 value IE. </action> </control>
<control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 . </action> </control>
<control> <action> The UE stays in the current serving cell </action> and <condition> applies the normal cell reselection process. </condition> <action> The initial registration procedure is started </action> <condition> <condition> if still needed when timer T3346 expires </condition> or <condition> is stopped. </condition> </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, </action> and <action> attach attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the EPS attach request procedure is rejected with the EMM cause with the same value. </condition> </control>
<control> <condition> If the UE is registering for onboarding services in SNPN, </condition> <end_state> the UE may enter the state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control>
<control> <condition> #27 (N1 mode not allowed). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> Additionally, the UE shall reset the registration attempt counter </action> and <end_state> shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set: 1) the PLMN-specific N1 mode attempt counter for 3GPP access and the PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN in case of PLMN; or 2) the SNPN-specific attempt counter for 3GPP access for the current SNPN in case of SNPN and the SNPN- specific attempt counter for non-3GPP access for the current SNPN; to the UE implementation-specific maximum value. </action> </control>
<control> <action> The UE shall disable the N1 mode capability for the specific access type for which the message was received (see subclause 4.9). </action> </control>
<control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall disable the N1 mode capability also for the other access type (see subclause 4.9). </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED </action> and <action> shall delete any 4G-GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> Additionally, the UE shall reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control>
<control> <condition> #31 (Redirection to EPC required). </condition> </control>
5GMM cause #31 received by a UE that has not indicated support for CIoT optimizations or not indicated support for S1 mode or received by a UE over non-3GPP access is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.2.7.
This cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.2.7.
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> Additionally, the UE shall reset the registration attempt counter. </action> </control>
<control> <action> The UE shall enable the E-UTRA capability </action> <condition> if it was disabled, </condition> <action> disable the N1 mode capability for 3GPP access (see subclause 4.9.2) </action> and <end_state> enter the 5GMM-DEREGISTERED.NO-CELL-AVAILABLE. </end_state> </control>
<control> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and attach attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the EPS attach procedure is rejected with the EMM cause with the same value. </condition> </control>
<control> <condition> #62 (No network slices available). </condition> </control>
<control> <action> The UE shall abort the initial registration procedure, set the 5GS update status to 5U2 NOT UPDATED </action> and <end_state> enter state 5GMM-DEREGISTERED. ATTEMPTING-REGISTRATION or 5GMM-DEREGISTERED.PLMN- SEARCH. </end_state> <action> Additionally, the UE shall reset the registration attempt counter. </action> </control>
The UE receiving the rejected NSSAI in the REGISTRATION REJECT message takes the following actions based on the rejection cause in the rejected S-NSSAI(s):
<control> <condition> "S-NSSAI not available in the current PLMN or SNPN" </condition> <action> The UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI(s) in the current PLMN or SNPN </action> <condition> until switching off the UE, the UICC containing the USIM is removed, an entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause 4.6.2.2. </condition> </control>
<control> <condition> "S-NSSAI not available in the current registration area" </condition> <action> The UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as described in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI(s) in the current registration area </action> <condition> until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed or deleted as described in subclause 4.6.2.2. </condition> </control>
<control> <condition> "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization" </condition> <action> The UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access </action> <condition> until switching off the UE, the UICC containing the USIM is removed, the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, or the rejected S- NSSAI(s) are removed or deleted as described in subclause 4.6.1 and 4.6.2.2. </condition> </control>
<control> <condition> <condition> "S-NSSAI not available due to maximum number of UEs reached" </condition> <condition> Unless the back-off timer value received along with the S-NSSAI is zero, </condition> </condition> <action> the UE shall add the rejected S- NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access </action> <condition> until switching off the UE, the UICC containing the USIM is removed, the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </condition> </control>
NOTE 6: <control> <condition> If the back-off timer value received along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached is zero as specified in subclause 10.5.7.4a of TS 24.008, </condition> the UE does not consider the S-NSSAI as the rejected S-NSSAI. </control>
<control> <condition> If there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause "S-NSSAI not available due to maximum number of UEs reached", </condition> then for each S-NSSAI, the UE shall behave as follows: <action> a) stop the timer T3526 associated with the S-NSSAI, </action> <condition> if running; </condition> <action> b) start the timer T3526 with: 1) the back-off timer value received along with the S-NSSAI, <condition> if a back-off timer value is received along with the S-NSSAI that is neither zero nor deactivated; </condition> or 2) an implementation specific back-off timer value, <condition> if no back-off timer value is received along with the S- NSSAI; </condition> </action> and <action> c) remove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached <condition> when the timer T3526 associated with the S-NSSAI expires. </condition> </action> </control>
<control> <condition> <condition> If the UE has an allowed NSSAI </condition> or <condition> configured NSSAI that contains S-NSSAI(s) which are not included in the rejected NSSAI the UE may stay in the current serving cell, </condition> </condition> <action> apply the normal cell reselection process </action> and <action> start an initial registration with a requested NSSAI that includes any S-NSSAI from the allowed NSSAI or the configured NSSAI that is not in the rejected NSSAI. </action> </control> <control> <condition> Otherwise </condition> <action> the UE may perform a PLMN selection or SNPN selection according to 3GPP TS 23.122 </action> and additionally, <action> the UE may disable the N1 mode capability for the current PLMN or SNPN </action> <condition> if the UE does not have an allowed NSSAI and each S-NSSAI in configured NSSAI, if available, was rejected with cause "S-NSSAI not available in the current PLMN or SNPN" or "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization" as described in subclause 4.9. </condition> </control>
<control> <condition> <condition> If the UE has neither allowed NSSAI for the current PLMN or SNPN </condition> nor <condition> configured NSSAI for the current PLMN or SNPN </condition> </condition> </control> and
<control> 1) <condition> if at least one S-NSSAI in the default configured NSSAI is not rejected, </condition> <action> the UE may stay in the current serving cell, apply the normal cell reselection process, </action> and <action> start an initial registration with a requested NSSAI with that default configured NSSAI; </action> </control> or <control> 2) <condition> if all the S-NSSAI(s) in the default configured NSSAI are rejected and at least one S-NSSAI is rejected due to "S-NSSAI not available in the current registration area", </condition> </control>
<control> <condition> i) if the REGISTRATION REJECT message is integrity protected </condition> and <condition> the UE is not operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" </action> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; </end_state> </control> or <control> ii) <condition> <condition> if the REGISTRATION REJECT message is integrity protected </condition> and <condition> the UE is operating in SNPN access operation mode, </condition> </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> Otherwise, </condition> <action> the UE may perform a PLMN selection or SNPN selection according to 3GPP TS 23.122 </action> and additionally, <action> the UE may disable the N1 mode capability for the current PLMN or SNPN </action> <condition> if each S-NSSAI in the default configured NSSAI was rejected with cause "S-NSSAI not available in the current PLMN or SNPN" or "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization" as described in subclause 4.9. </condition> </control>
<control> <condition> <condition> If the UE has neither allowed NSSAI for the current PLMN or SNPN </condition> nor <condition> <condition> configured NSSAI for the current PLMN or SNPN </condition> and <condition> has rejected NSSAI for the reached maximum number of UEs, </condition> </condition> and <condition> the UE wants to obtain services in the current serving cell without performing a PLMN selection or SNPN selection, </condition> </condition> <action> the UE may stay in the current serving cell </action> and <action> attempt to use the rejected S-NSSAI(s) for the maximum number of UEs reached in the current serving cell <condition> after the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </condition> </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU2 NOT UPDATED, </action> <action> reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control>
<control> <condition> #72 (Non-3GPP access to 5GCN not allowed). </condition> </control>
<control> <condition> When received over non-3GPP access </condition> <action> the UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> Additionally, the UE shall reset the registration attempt counter </action> and <end_state> enter the state 5GMM-DEREGISTERED. </end_state> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set: 1) the PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN in case of PLMN: or 2) the SNPN-specific attempt counter for non-3GPP access for that SNPN in case of SNPN; to the UE implementation-specific maximum value. </action> </control>
NOTE 7: The 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses 4.7.2 and 5.1.3).
<control> <action> The UE shall disable the N1 mode capability for non-3GPP access (see subclause 4.9.3). </action> </control>
<control> As an implementation option, <end_state> the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> <condition> in order to perform a PLMN selection according to 3GPP TS 23.122 . </condition> </control>
If received over 3GPP access the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.1.2.7.
<control> <condition> #73 (Serving network not authorized). </condition> </control>
This cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.2.7.
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall delete the list of equivalent PLMNs, reset the registration attempt counter, store the PLMN identity in the forbidden PLMN list as specified in subclause 5.3.13A. </action> <control> <condition> For 3GPP access </condition> <end_state> the UE shall enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> in order to perform a PLMN selection according to 3GPP TS 23.122 , and <condition> for non-3GPP access </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE </end_state> and <action> perform network selection as defined in 3GPP TS 24.502 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non- 3GPP access for that PLMN to the UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED </action> and <action> shall delete any 4G-GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> Additionally, the UE shall reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control>
<control> <condition> #74 (Temporarily not authorized for this SNPN). </condition> </control>
5GMM cause #74 is only applicable when received from a cell belonging to an SNPN. 5GMM cause #74 received from a cell not belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.2.7.
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall reset the registration attempt counter and store the SNPN identity in the "temporarily forbidden SNPNs" list for the specific access type for which the message was received </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription. </condition> </control> <control> <condition> If the registration request is not for onboarding services in SNPN, </condition> <end_state> the UE shall enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the registration request is for onboarding services in SNPN, </condition> <end_state> the UE shall enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum value. </action> </control>
<control> <condition> If the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access to the same SNPN, </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
NOTE 8: <control> <condition> When 5GMM cause #74 is received over 3GPP access, </condition> the term "other access" in "the UE also supports the registration procedure over the other access to the same SNPN" is used to express access to SNPN services via a PLMN. </control>
NOTE 9: The term "non-3GPP access" in an SNPN refers to the case where the UE is accessing SNPN services via a PLMN.
<control> <condition> #75 (Permanently not authorized for this SNPN). </condition> </control>
5GMM cause #75 is only applicable when received from a cell belonging to an SNPN with a globally-unique SNPN identity. 5GMM cause #75 received from a cell not belonging to an SNPN or a cell belonging to an SNPN with a non-globally-unique SNPN identity is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.2.7.
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall reset the registration attempt counter </action> and <action> store the SNPN identity in the "permanently forbidden SNPNs" list for the specific access type for which the message was received </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription. </condition> </control> <control> <condition> If the registration request is not for onboarding services in SNPN, </condition> <end_state> the UE shall enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the registration request is for onboarding services in SNPN, </condition> <end_state> the UE shall enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access to the same SNPN, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
NOTE 10: <control> <condition> When 5GMM cause #75 is received over 3GPP access, </condition> the term "other access" in "the UE also supports the registration procedure over the other access to the same SNPN" is used to express access to SNPN services via a PLMN. </control>
NOTE 11: The term "non-3GPP access" in an SNPN refers to the case where the UE is accessing SNPN services via a PLMN.
<control> <condition> #76 (Not authorized for this CAG or authorized for CAG cells only). </condition> </control>
<control> <action> This cause value received via non-3GPP access or from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.2.7. </action> </control>
<control> <end_state> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED, </end_state> <action> store the 5GS update status according to clause 5.1.3.2.2, </action> and <action> reset the registration attempt counter. </action> </control>
<control> <condition> If 5GMM cause #76 is received from: </condition> </control>
<control> 1) <condition> <condition> a CAG cell, </condition> and <condition> if the UE receives a "CAG information list" in the CAG information list IE or the Extended CAG information list IE included in the REGISTRATION REJECT message, </condition> </condition> the UE shall: </control>
<control> <action> i) replace the "CAG information list" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN; </action> </control>
<control> <action> ii) replace the serving VPLMN's entry of the "CAG information list" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE </action> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; </condition> </control> or NOTE 12: <control> <condition> <condition> When the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, </condition> <condition> if any, </condition> </condition> in the received CAG information list IE or the Extended CAG information list IE <action> are ignored. </action> </control>
<control> <action> iii) remove the serving VPLMN's entry of the "CAG information list" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry. </action> </control> <control> <condition> Otherwise, </condition> <action> then the UE shall delete the CAG-ID(s) of the cell from the "allowed CAG list" for the current PLMN. </action> </control> <control> <condition> In the case the "allowed CAG list" for the current PLMN only contains a range of CAG-IDs, how the UE deletes the CAG-ID(s) of the cell from the "allowed CAG list" for the current PLMN is up to UE implementation. </condition> </control> In addition:
<control> <condition> i) <condition> if the entry in the "CAG information list" for the current PLMN does not include an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> or <condition> if the entry in the "CAG information list" for the current PLMN includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> and <condition> the updated "allowed CAG list" for the current PLMN includes one or more CAG-IDs, </condition> </condition> <end_state> then the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list"; </action> </control> <control> ii) <condition> <condition> if the entry in the "CAG information list" for the current PLMN includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> and <condition> the updated "allowed CAG list" for the current PLMN does not include any CAG-ID, </condition> </condition> <end_state> then the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list"; </action> </control> or <control> iii) <condition> if the "CAG information list" does not include an entry for the current PLMN, </condition> <end_state> then the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list". </action> </control>
<control> 2) <condition> <condition> a non-CAG cell, </condition> and <condition> if the UE receives a "CAG information list" in the CAG information list IE or the Extended CAG information list IE included in the REGISTRATION REJECT message, </condition> </condition> the UE shall: </control>
<control> <action> i) replace the "CAG information list" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN; </action> </control>
<control> <action> ii) replace the serving VPLMN's entry of the "CAG information list" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE </action> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; </condition> </control> or NOTE 13: <control> <condition> When the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, </condition> entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored. </control>
<control> <action> iii) remove the serving VPLMN's entry of the "CAG information list" stored in the UE </action> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry. </condition> </control>
<control> <condition> Otherwise, </condition> <action> the UE shall store an "indication that the UE is only allowed to access 5GS via CAG cells" in the entry of the "CAG information list" for the current PLMN, </action> <condition> if any. </condition> </control> <control> <condition> If the "CAG information list" stored in the UE does not include the current PLMN's entry, </condition> <action> the UE shall add an entry for the current PLMN to the "CAG information list" </action> and <action> store an "indication that the UE is only allowed to access 5GS via CAG cells" in the entry of the "CAG information list" for the current PLMN. </action> </control> <control> <condition> If the UE does not have a stored "CAG information list", </condition> <action> the UE shall create a new "CAG information list" </action> and <action> add an entry with an "indication that the UE is only allowed to access 5GS via CAG cells" for the current PLMN. </action> </control>
In addition:
<control> <condition> i) if the "allowed CAG list" for the current PLMN includes one or more CAG-IDs, </condition> <end_state> then the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 with the updated CAG information; </action> </control> or <control> ii) <condition> if the "allowed CAG list" for the current PLMN does not include any CAG-ID, </condition> <end_state> then the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list". </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED, </action> <action> reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control>
<control> <condition> #77 (Wireline access area not allowed). </condition> </control>
<control> 5GMM cause #77 is only applicable <condition> when received from a wireline access network by the 5G-RG or the W-AGF acting on behalf of the FN-CRG. </condition> 5GMM cause #77 received from a 5G access network other than a wireline access network and 5GMM cause #77 received by the W-AGF acting on behalf of the FN-BRG are considered as abnormal cases and the behaviour of the UE is specified in subclause 5.5.1.2.7. </control>
<control> <condition> When received over wireline access network, </condition> <action> the 5G-RG and the W-AGF acting on behalf of the FN-CRG shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2), </action> <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI, </action> <action> shall reset the registration attempt counter, </action> <end_state> shall enter the state 5GMM-DEREGISTERED </end_state> and <action> shall act as specified in subclause 5.3.23. </action> </control>
NOTE 14: The 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses 4.7.2 and 5.1.3).
<control> <condition> #78 (PLMN not allowed to operate at the present UE location). </condition> </control>
This cause value received from a non-satellite NG-RAN cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.2.7.
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> Additionally, the UE shall reset the registration attempt counter. </action> <action> The UE shall store the PLMN identity and, if it is known, the current geographical location in the list of "PLMNs not allowed to operate at the present UE location" </action> and <action> shall start a corresponding timer instance (see subclause 4.23.2). </action> <end_state> The UE shall enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI </action> and <action> attach attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the EPS attach procedure is rejected with the EMM cause with the same value. </condition> </control>
<control> <condition> #79 (UAS services not allowed). </condition> </control>
<control> <action> The UE shall abort the initial registration procedure, </action> <condition> set the 5GS update status to 5U2 NOT UPDATED </condition> and <end_state> enter state 5GMM-DEREGISTERED. ATTEMPTING-REGISTRATION or 5GMM-DEREGISTERED.PLMN- SEARCH. </end_state> <action> Additionally, the UE shall reset the registration attempt counter. </action> <control> <condition> If the UE re-attempt the registration procedure to the current PLMN, </condition> <action> the UE shall not include the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of REGISTRATION REQUEST message. </action> </control> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU2 NOT UPDATED, </action> <action> reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control>
<control> <condition> #80 (Disaster roaming for the determined PLMN with disaster condition not allowed). </condition> </control>
<control> <action> The UE shall abort the initial registration procedure, </action> <action> set the 5GS update status to 5U2 NOT UPDATED, </action> <end_state> enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION </end_state> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> Additionally, the UE shall reset the registration attempt counter. </action> <action> The UE shall not attempt to register for disaster roaming on this PLMN for the determined PLMN with disaster condition for a period in the range of 12 to 24 hours. </action> <action> The UE shall not attempt to register for disaster roaming on this PLMN for a period in the range of 3 to 10 minutes. </action> <action> The UE shall perform PLMN selection as described in 3GPP TS 23.122 . </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU2 NOT UPDATED, </action> <action> reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control>
<control> <action> Other values are considered as abnormal cases. </action> </control> The behaviour of the UE in those cases is specified in subclause 5.5.1.2.7.
5.5.1.2.6 Initial registration for emergency services not accepted by the network
<control> <condition> Upon receiving the REGISTRATION REJECT message including 5GMM cause #5 "PEI not accepted", </condition> <end_state> the UE shall enter the state 5GMM-DEREGISTERED.NO-SUPI. </end_state> </control> <control> <condition> If the REGISTRATION REJECT message is received, a) over 3GPP access; </condition> or <condition> b) over non-3GPP access </condition> and <condition> is integrity protected; </condition> and <condition> the UE also supports the registration procedure over the other access, </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
<control> <condition> Upon receiving the REGISTRATION REJECT message including 5GMM cause value which is not #5 "PEI not accepted", </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.5 with the following addition: the UE shall inform the upper layers of the failure of the procedure. </action> </control>
NOTE 1: This can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> If the initial registration request for emergency services fails due to abnormal cases, </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.7 </action> and <action> inform the upper layers of the failure to access the network or the failure of the </action> </control>
NOTE 2: This can result in the upper layers requesting other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> <condition> In a shared network, </condition> <condition> upon receiving the REGISTRATION REJECT message, </condition> </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.5, </action> </control> and shall:
<control> a) <action> inform the upper layers of the failure of the procedure; </action> </control> or NOTE 3: The upper layers can request implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 that can result in the emergency call being attempted to another IP-CAN.
<control> b) <action> attempt to perform a PLMN selection in the shared network </action> and, <condition> <condition> if an initial registration for emergency services was not already attempted with the selected PLMN and the REGISTRATION REQUEST message, </condition> <condition> for which the REGISTRATION REJECT message was received, </condition> is: <condition> a) not for sending a PDU SESSION ESTABLISHMENT REQUEST message with request type set to "existing emergency PDU session", </condition> </condition> <action> initiate an initial registration for emergency services with the selected PLMN; </action> </control> or <control> <condition> b) for sending a PDU SESSION ESTABLISHMENT REQUEST message with request type set to "existing emergency PDU session", </condition> and: </control>
<control> <condition> i) the selected PLMN is an equivalent PLMN, </condition> <action> initiate an initial registration for emergency services with the selected PLMN; </action> </control> and
<control> ii) <condition> the selected PLMN is not an equivalent PLMN, </condition> <action> perform a PLMN selection </action> and <action> initiate an initial registration for emergency services with the selected PLMN </action> <condition> if an initial registration for emergency services was not already attempted with the selected PLMN. </condition> </control>
<control> <condition> In a shared network, </condition> <condition> if the initial registration request for emergency services fails due to abnormal cases, </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.7 </action> and shall: </control>
<control> a) <action> inform the upper layers of the failure of the procedure; </action> or NOTE 4: The upper layers can request implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 that can result in the emergency call being attempted to another IP-CAN. </control>
<control> b) <action> attempt to perform a PLMN selection in the shared network </action> </control> and, <control> <condition> if an initial registration for emergency services was not already attempted with the selected PLMN </condition> and <condition> > the REGISTRATION REQUEST message is: a) not for sending a PDU SESSION ESTABLISHMENT REQUEST message with request type set to "existing emergency PDU session", </condition> <action> initiate an initial registration for emergency services with the selected PLMN; </action> </control> or <control> <condition> b) for sending a PDU SESSION ESTABLISHMENT REQUEST message with request type set to "existing emergency PDU session", </condition> and: </control>
<control> <condition> i) the selected PLMN is an equivalent PLMN, </condition> <action> initiate an initial registration for emergency services with the selected PLMN; </action> </control> and
<control> ii) <condition> the selected PLMN is not an equivalent PLMN, </condition> <action> perform a PLMN selection </action> and <action> initiate an initial registration for emergency services with the selected PLMN </action> <condition> if an initial registration for emergency services was not already attempted with the selected PLMN. </condition> </control>
5.5.1.2.6A Initial registration for initiating an emergency PDU session not accepted by the network
<control> <condition> If the network cannot accept an initial registration request with 5GS registration type IE set to "initial registration" </condition> and <condition> for sending a PDU SESSION ESTABLISHMENT REQUEST message with request type set to "initial emergency request", </condition> <action> the UE shall perform the procedures as described in subclause 5.5.1.2.5. </action> </control> <control> <condition> Then if the UE is in the same selected PLMN where the last initial registration request was attempted, </condition> the UE shall: </control>
<control> <action> a) inform the upper layers of the failure of the procedure; </action> or NOTE 1: This can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN. </control>
<control> b) <action> attempt initial registration for emergency services. </action> </control>
<control> <condition> <condition> If the network cannot accept an initial registration request with 5GS registration type IE set to "initial registration", </condition> <condition> for establishing an emergency PDU session and the PDU session needs to be established due to handover of an existing PDN connection for emergency bearer services, </condition> </condition> <action> the UE shall perform the procedures as described in subclause 5.5.1.2.5. </action> </control> <control> <condition> Then if the UE is in the same selected PLMN or equivalent PLMN where the last initial registration request was attempted, </condition> <action> the UE shall attempt initial registration for emergency services. </action> </control>
<control> <condition> <condition> If the initial registration request, with 5GS registration type IE set to "initial registration" </condition> and <condition> for initiating an emergency PDU session, fails due to abnormal case b) in subclause 5.5.1.2.7, </condition> </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.7 </action> and <action> inform the upper layers of the failure to access the network. </action> </control>
NOTE 2: This can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> If the initial registration request, with 5GS registration type IE set to "initial registration" </condition> and <condition> for initiating an emergency PDU session, fails due to abnormal cases c), d) or e) in subclause 5.5.1.2.7, </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.7. </action> </control> <control> <condition> Then if the UE is in: </condition> </control>
<control> <condition> a) the same selected PLMN where the last initial registration request was attempted </condition> and <condition> the PDU session does not need to be established due to handover of an existing PDN connection for emergency bearer services, </condition> <action> the UE shall: a) inform the upper layers of the failure of the procedure; </action> or NOTE 3: This can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN. b) <action> attempt initial registration for emergency services; </action> or </control>
<control> <condition> c) <condition> the same selected PLMN or equivalent PLMN where the last initial registration request was attempted </condition> and <condition> the PDU session needs to be established due to handover of an existing PDN connection for emergency bearer services, </condition> </condition> <action> attempt initial registration for emergency services. </action> </control>
5.5.1.2.7 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <action> The UE shall not start the registration procedure for initial registration </action> unless: </control>
<control> <condition> 1) the UE is a UE configured for high priority access in selected PLMN; </condition> </control>
<control> 2) <condition> the UE needs to perform the registration procedure for initial registration for emergency services; </condition> </control>
<control> 3) <condition> the UE receives a DEREGISTRATION REQUEST message with the "re-registration required" indication; </condition> </control>
<control> 4) <condition> the UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event </condition> and: <condition> a) the UE is allowed to use exception data reporting </condition> (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ); NASCONFIG and b) <condition> timer T3346 was not started when N1 NAS signalling connection was established with RRC establishment cause set to "mo-ExceptionData"; </condition> </control>
<control> 5) <condition> the UE needs to perform the registration procedure with 5GS registration type IE set to "initial registration" for initiating of an emergency PDU session, upon request of the upper layers to establish the emergency PDU </condition> </control>
The UE stays in the current serving cell and applies the normal cell reselection process.
NOTE 1: It is considered an abnormal case if the UE needs to initiate a registration procedure for initial registration while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or
b) The lower layers indicate that the access attempt is barred.
<control> <action> The UE shall not start the initial registration procedure. </action> <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> Receipt of the access barred indication shall not trigger the selection of a different core network type (EPC or 5GCN). </control>
<control> <action> The initial registration procedure is started, </action> <condition> if still needed, when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated. </condition> </control>
ba) The lower layers indicate that:
<control> 1) <condition> <condition> access barring is applicable for all access categories except categories 0 and 2 </condition> and <condition> the access category with which the access attempt was associated is other than 0 and 2; </condition> </condition> </control> or
<control> 2) <condition> <condition> access barring is applicable for all access categories except category 0 </condition> and <condition> the access category with which the access attempt was associated is other than 0. </condition> </condition> </control>
<control> <condition> If the REGISTRATION REQUEST message has not been sent, </condition> <action> the UE shall proceed as specified for case b. </action> </control> <control> <condition> If the REGISTRATION REQUEST message has been sent, </condition> <action> the UE shall proceed as specified for case e </action> and, additionally, <action> the registration procedure for initial registration is started, </action> <condition> if still needed, when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated. </condition> </control>
<control> <action> The UE shall abort the registration procedure for initial registration and the NAS signalling connection, </action> if any, shall be released locally <condition> if the initial registration request is neither for emergency services nor for initiating a PDU session for emergency services with request type set to "existing emergency PDU session". </condition> The UE shall proceed as described below. </control>
<control> <condition> <condition> If the registration request is neither an initial registration request for emergency services nor an initial registration request for initiating a PDU session for emergency services with request type set to "existing emergency PDU session", </condition> <condition> upon reception of the 5GMM causes #95, #96, #97, #99 and #111 </condition> </condition> <action> the UE should set the registration attempt counter to 5. </action> </control>
The UE shall proceed as described below.
<control> <condition> e) Lower layer failure or release of the NAS signalling connection received from lower layers before the REGISTRATION ACCEPT or REGISTRATION REJECT message is received. </condition> </control>
<control> <action> The UE shall abort the registration procedure for initial registration and proceed as described below. </action> <action> The registration procedure for initial registration shall be aborted, </action> and <action> the UE initiated de-registration procedure shall be performed. </action> </control>
<control> <condition> If the UE receives a DEREGISTRATION REQUEST message from the network in state 5GMM- REGISTERED-INITIATED </condition> <action> the de-registration procedure shall be aborted </action> and <action> the initial registration procedure shall be progressed. </action> </control>
NOTE 2: The above collision case is valid if the DEREGISTRATION REQUEST message indicates the access type over which the initial registration procedure is attempted otherwise both the procedures are
h) Change in the current TAI.
<control> <condition> If the current TAI is changed before the registration procedure for initial registration is completed, </condition> <action> the registration procedure for initial registration shall be aborted and re-initiated immediately. </action> </control>
<control> <condition> If the REGISTRATION COMPLETE message needs to be sent </condition> and <condition> a tracking area border is crossed when the REGISTRATION ACCEPT message has been received </condition> <condition> but before a REGISTRATION COMPLETE message is sent </condition> and: </control>
<control> 1) <condition> if the current TAI is in the TAI list, </condition> <action> the UE sends the REGISTRATION COMPLETE message to the network; </action> </control> and
<control> 2) <condition> otherwise, </condition> <action> the registration procedure for initial registration shall be aborted </action> and <action> the registration procedure for mobility registration update shall be initiated. </action> </control>
<control> <condition> If a 5G-GUTI was allocated during the registration procedure, </condition> <action> this 5G-GUTI shall be used in the registration </action> </control>
<control> <condition> i) Transmission failure of REGISTRATION COMPLETE message indication with change in the current TAI. </condition> </control>
<control> 1) <condition> If the current TAI is still part of the TAI list, </condition> <action> the UE resends the REGISTRATION COMPLETE message to the network; </action> </control> and
<control> 2) <condition> otherwise, </condition> <action> the registration procedure for initial registration shall be aborted </action> and <action> the registration procedure for mobility registration update shall be initiated. </action> </control>
<control> <condition> j) Transmission failure of REGISTRATION COMPLETE message indication without change in the current TAI from lower layers. </condition> </control>
It is up to the UE implementation how to re-run the ongoing procedure.
<control> <condition> k) Transmission failure of REGISTRATION REQUEST message indication from the lower layers. </condition> </control>
<control> <action> The registration procedure for initial registration shall be aborted and re-initiated immediately. </action> </control>
<control> <action> The UE shall not start the registration procedure for initial registration with Follow-on request indicator set to "Follow-on request pending" </action> unless: </control>
<control> <condition> 1) the UE is a UE configured for high priority access in selected PLMN; </condition> or </control>
<control> 2) <condition> the UE needs to perform the registration procedure for initial registration for emergency services. </condition> </control>
<control> <action> The UE stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> </control> The registration procedure for initial registration is started, if still necessary, when timer T3447 expires or timer T3447 is
<control> <condition> For the cases c, d and e, </condition> <action> the UE shall proceed as follows: </action> </control>
<control> <action> Timer T3510 shall be stopped </action> <condition> if still running. </condition> </control>
<control> <condition> If the registration procedure is neither an initial registration for emergency services nor for establishing an emergency PDU session with registration type not set to "emergency registration", </condition> <action> the registration attempt counter shall be incremented, </action> <condition> unless it was already set to 5. </condition> </control>
<control> <condition> <condition> If the registration attempt counter is less than 5: </condition> <condition> a) if the initial registration request is not for emergency services, </condition> <condition> timer T3511 is started </condition> and <condition> the state is changed to 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION. </condition> <condition> timer T3511 expires </condition> </condition> <action> the registration procedure for initial registration shall be restarted, </action> <condition> if still required. </condition> </control>
<control> <condition> If the registration attempt counter is equal to 5 </condition> a) <action> the UE shall delete 5G-GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs (if any), and ngKSI, </action> <action> start timer T3502 </action> and <action> shall set the 5GS update status to 5U2 NOT UPDATED. </action> <end_state> The state is changed to 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION or optionally to 5GMM- DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection, SNPN selection according to 3GPP TS 23.122. </end_state> </control> <control> <condition> b) if the procedure is performed via 3GPP access </condition> and <condition> the UE is operating in single-registration mode: </condition> c) <action> the UE shall in addition handle the EMM parameters EPS update status, EMM state, 4G-GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the abnormal cases when an EPS attach procedure fails </condition> and <condition> the attach attempt counter is equal to 5; </condition> </control> and <control> d) <action> the UE shall attempt to select E-UTRAN radio access technology </action> and <action> proceed with appropriate EMM specific procedures. </action> <action> Additionally, The UE may disable the N1 mode capability as specified in subclause 4.9. </action> </control>
5.5.1.2.8 Abnormal cases on the network side
The following abnormal cases can be identified:
a) Lower layer failure
<control> <condition> If a lower layer failure occurs before the REGISTRATION COMPLETE message has been received from the UE </condition> and <condition> timer T3550 is running, </condition> <action> the AMF shall locally abort the registration procedure for initial registration, </action> <end_state> enter state 5GMM-REGISTERED </end_state> and <action> shall not resend the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If a new 5G- GUTI was assigned to the UE in the registration procedure for initial registration, </condition> <action> the AMF shall consider both the old and the new 5G-GUTI as valid </action> <condition> until the old 5G-GUTI can be considered as invalid by the AMF </condition> or <condition> the 5GMM context which has been marked as deregistered in the AMF is released. </condition> </control> <control> <condition> If the old 5G-GUTI was allocated by an AMF other than the current AMF, </condition> <action> the current AMF does not need to retain the old 5G-GUTI. </action> </control>
<control> <condition> <condition> During this period the network may use the identification procedure followed by a generic UE configuration update procedure </condition> <condition> if the old 5G-GUTI is used by the UE in a subsequent message. </condition> </condition> </control>
b) Protocol error
<control> <condition> If the REGISTRATION REQUEST message is received with a protocol error, </condition> <action> the AMF shall return a REGISTRATION REJECT message with one of the following 5GMM cause values: </action> </control>
<control> <condition> #96 invalid mandatory information; </condition> <condition> #99 information element non-existent or not implemented; </condition> <condition> #100 conditional IE error; </condition> or <condition> #111 protocol error, unspecified. </condition> </control>
<control> <condition> On the first expiry of the timer, </condition> <action> the AMF shall retransmit the REGISTRATION ACCEPT message </action> and <action> shall reset and restart timer T3550. </action> </control>
<control> This retransmission is repeated four times, i.e. <condition> on the fifth expiry of timer T3550, </condition> <action> the registration procedure for initial registration shall be aborted </action> and <end_state> the AMF enters state 5GMM-REGISTERED. </end_state> </control> <control> <condition> If a new 5G-GUTI was allocated in the REGISTRATION ACCEPT message, </condition> <action> the AMF shall consider both the old and the new 5G- GUTIs as valid </action> <condition> until the old 5G-GUTI can be considered as invalid by the AMF </condition> or <condition> the 5GMM context which has been marked as de-registered in the AMF is released. </condition> </control> <control> <condition> If the old 5G-GUTI was allocated by an AMF other than the current AMF, </condition> <action> the current AMF does not need to retain the old 5G-GUTI. </action> </control> <control> <condition> During this period, </condition> <condition> if the old 5G- GUTI is used by the UE in a subsequent message, </condition> <action> the AMF acts as specified for case a) above. </action> </control>
d) REGISTRATION REQUEST message received after the REGISTRATION ACCEPT message has been sent and before the REGISTRATION COMPLETE message is received, if the REGISTRATION COMPLETE message is expected.
<control> 1) <condition> If one or more of the information elements in the REGISTRATION REQUEST message differ from the ones received within the previous REGISTRATION REQUEST message, </condition> <action> the previously initiated the registration procedure for initial registration shall be aborted </action> <condition> if the REGISTRATION COMPLETE message has not been received </condition> and <condition> the new registration procedure for initial registration shall be progressed; </condition> </control> or
<control> 2) <condition> if the information elements do not differ, </condition> <action> then the REGISTRATION ACCEPT message shall be resent </action> and <action> the timer T3550 shall be restarted. </action> </control> In that case, the retransmission counter related to T3550 is not
<control> <condition> e) More than one REGISTRATION REQUEST message with 5GS registration type IE set to "initial registration" received </condition> and <condition> no REGISTRATION ACCEPT message or REGISTRATION REJECT message has been sent. </condition> </control>
<control> 1) <condition> If one or more of the information elements in the REGISTRATION REQUEST message with 5GS registration type IE set to "initial registration" differs from the ones received within the previous REGISTRATION REQUEST message with 5GS registration type IE set to "initial registration", </condition> <action> the previously initiated the registration procedure for initial registration shall be aborted </action> and <action> the new the registration procedure for initial registration shall be executed; </action> </control>
<control> 2) <condition> if the information elements do not differ, </condition> <action> then the network shall continue with the previous the registration procedure for initial registration </action> and <action> shall ignore the second REGISTRATION REQUEST message. </action> </control>
<control> <condition> f) REGISTRATION REQUEST message with 5GS registration type IE set to "initial registration" received in state 5GMM-REGISTERED. </condition> </control>
<control> <condition> If a REGISTRATION REQUEST message with 5GS registration type IE set to "initial registration" is received in state 5GMM-REGISTERED </condition> <action> the network may initiate the 5GMM common procedures; </action> </control> <control> <condition> if it turned out that the REGISTRATION REQUEST message was sent by a genuine UE that has already been registered, </condition> <action> the 5GMM context, if any, are deleted and the new REGISTRATION REQUEST is progressed. </action> </control>
NOTE 1: The network can determine that the UE is genuine by executing the authentication procedure as described in subclause 5.4.1.
<control> <condition> g) REGISTRATION REQUEST message with 5GS registration type IE set to "mobility registration updating" </condition> or <condition> "periodic registration updating" received before REGISTRATION COMPLETE message, </condition> <condition> if the REGISTRATION COMPLETE message is expected. </condition> </control>
<control> <action> Timer T3550 shall be stopped. </action> <action> The allocated 5G-GUTI in the registration procedure for initial registration shall be considered as valid </action> and <action> the registration procedure for mobility and periodic update shall be progressed as described in subclause 5.5.1.3. </action> </control>
<control> <condition> h) DEREGISTRATION REQUEST message received before REGISTRATION COMPLETE message, </condition> <condition> if the REGISTRATION COMPLETE message is expected. </condition> </control>
<control> <action> The AMF shall abort the registration procedure for initial registration </action> and <action> shall progress the de-registration procedure as described in subclause 5.5.2.2. </action> </control>
<control> <condition> i) UE security capabilities invalid or unacceptable </condition> </control>
<control> <condition> If the REGISTRATION REQUEST message is received with invalid or unacceptable UE security capabilities (e.g. no 5GS encryption algorithms (all bits zero), no 5GS integrity algorithms (all bits zero), mandatory 5GS encryption algorithms not supported or mandatory 5GS integrity algorithms not supported, etc.), </condition> <action> the AMF shall return a REGISTRATION REJECT message. </action> </control>
NOTE 2: 5GMM cause value to be used in REGISTRATION REJECT message is up to the network
<control> <condition> j) <condition> Based on operator policy, </condition> <condition> if the initial registration request from a UE not supporting CAG is rejected due to CAG restrictions, </condition> </condition> <action> the network shall reject the initial registration with a 5GMM cause value other than the 5GMM cause #76 (Not authorized for this CAG or authorized for CAG cells only). </action> </control>
NOTE 3: 5GMM cause #7 (5GS services not allowed), 5GMM cause #11 (PLMN not allowed), 5GMM cause #27 (N1 mode not allowed), 5GMM cause #73 (Serving network not authorized) can be used depending on the subscription of the UE and whether the UE roams or not.
5.5.1.3 Registration procedure for mobility and periodic registration update
5.5.1.3.1 General
This procedure is used by a UE for both mobility and periodic registration update of 5GS services. This procedure, when used for periodic registration update of 5GS services, is performed only in 3GPP access.
This procedure used for periodic registration update of 5GS services is controlled in the UE by timer T3512. <control> <condition> When timer T3512 expires, </condition> <action> the registration procedure for mobility and periodic registration area updating is started. </action> </control> Start and reset of timer T3512 is described in subclause 10.2.
<control> <condition> If the MUSIM UE is registered for emergency services </condition> and <condition> initiates a registration procedure for mobility and periodic registration update, </condition> <action> the network shall not indicate the support of: a) the NAS signalling connection release; b) the paging indication for voice services; c) the reject paging request; or d) the paging restriction; in the REGISTRATION ACCEPT message. </action> </control>
5.5.1.3.2 Mobility and periodic registration update initiation
<control> <condition> The UE in state 5GMM-REGISTERED </condition> <action> shall initiate the registration procedure for mobility and periodic registration update by sending a REGISTRATION REQUEST message to the AMF, </action> <condition> a) when the UE detects that the current TAI is not in the list of tracking areas that the UE previously registered in the AMF; </condition> </control>
<control> <condition> b) when the periodic registration updating timer T3512 expires in 5GMM-IDLE mode; </condition> </control>
<control> <condition> c) when the UE receives a CONFIGURATION UPDATE COMMAND message indicating "registration requested" in the Registration requested bit of the Configuration update indication IE as specified in subclauses 5.4.4.3; </condition> </control>
<control> <condition> d) when the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE either receives a paging </condition> or <condition> the UE receives a NOTIFICATION message with access type indicating 3GPP access over the non- 3GPP access for PDU sessions associated with 3GPP access; </condition> </control> NOTE 1: As an implementation option, MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.
<control> <condition> e) <condition> upon inter-system change from S1 mode to N1 mode </condition> and <condition> if the UE previously had initiated an attach procedure or a tracking area updating procedure when in S1 mode; </condition> </condition> </control>
<control> <condition> f) when the UE receives an indication of "RRC Connection failure" from the lower layers </condition> and <condition> does not have signalling pending (i.e. when the lower layer requests NAS signalling connection recovery) except for the case specified in subclause 5.3.1.4; </condition> </control>
<control> <condition> g) when the UE changes the 5GMM capability or the S1 UE network capability or both; </condition> </control>
<control> <condition> h) when the UE's usage setting changes; </condition> </control>
<control> <condition> i) when the UE needs to change the slice(s) it is currently registered to; </condition> </control>
<control> <condition> j) when the UE changes the UE specific DRX parameters; </condition> </control>
<control> <condition> k) when the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE receives a request from the upper layers to establish an emergency PDU session </condition> or <condition> perform emergency services fallback; </condition> </control>
<control> <condition> l) when the UE needs to register for SMS over NAS, </condition> <condition> indicate a change in the requirements to use SMS over NAS, </condition> or <condition> de-register from SMS over NAS; </condition> </control>
<control> <condition> m) when the UE needs to indicate PDU session status to the network after performing a local release of PDU session(s) as specified in subclauses 6.4.1.5 and 6.4.3.5; </condition> </control>
<control> <condition> n) when the UE in 5GMM-IDLE mode changes the radio capability for NG-RAN or E-UTRAN; </condition> </control>
<control> <condition> o) when the UE receives a fallback indication from the lower layers </condition> and <condition> does not have signalling pending </condition> (i.e. when the lower layer requests NAS signalling connection recovery, see subclauses 5.3.1.4 and 5.3.1.2); </control>
<control> <condition> q) when the UE needs to request new LADN information; </condition> </control>
<control> <condition> r) when the UE needs to request the use of MICO mode </condition> or <condition> needs to stop the use of MICO mode </condition> or <condition> to request the use of new T3324 value; </condition> </control>
<control> <condition> s) when the UE <condition> in 5GMM-CONNECTED mode with RRC inactive indication </condition> enters a cell in the current registration area belonging to an equivalent PLMN of the registered PLMN </condition> and <condition> not belonging to the registered PLMN; </condition> </control>
<control> <condition> t) when the UE receives over 3GPP access a SERVICE REJECT message or a DL NAS TRANSPORT message, </condition> <condition> with the 5GMM cause value set to #28 "Restricted service area"; </condition> </control>
<control> <condition> u) when the UE needs to request the use of eDRX, </condition> <condition> when a change in the eDRX usage conditions at the UE requires different extended DRX parameters, </condition> or <condition> needs to stop the use of eDRX; </condition> </control> NOTE 2: A change in the eDRX usage conditions at the UE can include e.g. a change in the UE configuration, a change in requirements from upper layers or the battery running low at the UE.
<control> <condition> v) when the UE supporting 5G-SRVCC from NG-RAN to UTRAN changes the mobile station classmark 2 or the supported codecs; </condition> </control>
<control> <condition> w) when the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE decides to request new network slices after being rejected due to no allowed network slices requested, </condition> or <condition> request S-NSSAI(s) which have been removed from the rejected NSSAI for the maximum number of UEs reached; </condition> </control>
<control> <condition> x) when the UE is not in NB-N1 mode </condition> and <condition> the applicable UE radio capability ID for the current UE radio configuration changes due to a revocation of the network-assigned UE radio capability IDs by the serving PLMN or SNPN; </condition> </control>
<control> <condition> y) when the UE receives a REGISTRATION REJECT message with 5GMM cause values #3, #6 or #7 without integrity protection over another access; </condition> </control>
<control> <condition> z) when the UE needs to request new ciphering keys for ciphered broadcast assistance data; </condition> </control>
<control> <condition> za) when due to manual CAG selection the UE has selected a CAG-ID which is not included in the "allowed CAG list" for the selected PLMN or a CAG-ID in a PLMN for which the entry in the "CAG information list" does not exist </condition> or <condition> when the UE has selected, without selecting a CAG-ID, a PLMN for which the entry in the "CAG information list" includes an "indication that the UE is only allowed to access 5GS via CAG cells"; </condition> </control>
<control> <condition> zb) when the UE needs to start, stop or change the conditions for using the WUS assistance information or PEIPS assistance information; </condition> </control>
<control> <condition> zc) when the UE changes the UE specific DRX parameters in NB-N1 mode; </condition> </control>
<control> <condition> zd) when the UE <condition> in 5GMM-CONNECTED mode with RRC inactive indication </condition> enters a new cell with different RAT in current TAI list or not in current TAI list; </condition> </control>
<control> <condition> ze) <condition> when the UE enters state 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON- ALLOWED-SERVICE (as described in subclause 5.3.5.2) over 3GPP access </condition> <condition> after the UE has sent a NOTIFICATION RESPONSE message over non-3GPP access in response to reception of a NOTIFICATION message over non-3GPP access as specified in subclause 5.6.3.1; </condition> </condition> </control>
<control> <condition> zf) when the UE supporting UAS services is not registered for UAS services </condition> and <condition> needs to register to the 5GS for UAS services; </condition> </control>
<control> <condition> zg) <condition> when the UE supporting MINT needs to perform the registration procedure for mobility </condition> and <condition> periodic registration update to register to the PLMN offering disaster roaming; </condition> </condition> </control>
<control> <condition> zh) <condition> when the MUSIM UE supporting the paging timing collision control needs to request a new 5G-GUTI assignment </condition> and <condition> the UE is not registered for emergency services; </condition> </condition> </control> NOTE 3: Based on implementation, the MUSIM UE can request a new 5G-GUTI assignment (e.g. when the lower layers request to modify the timing of the paging occasions).
<control> <condition> zi) <condition> when the network supports the paging restriction </condition> and <condition> the MUSIM UE in state 5GMM-REGISTERED.NON- ALLOWED-SERVICE needs to requests the network to remove the paging restriction; </condition> </condition> </control>
<control> <condition> zj) when the UE changes the 5GS Preferred CIoT network behaviour or the EPS Preferred CIoT network behaviour; </condition> </control>
<control> <condition> zk) <condition> when the UE that has entered 5GMM-REGISTERED.NO-CELL-AVAILABLE </condition> and <condition> it has one or more S- NSSAI(s) in pending NSSAI, finds a suitable cell according to 3GPP TS 38.304; </condition> </condition> </control> or
<control> <condition> zl) <condition> when the UE is registered for disaster roaming services </condition> and <condition> receives a request from the upper layers to establish an emergency PDU session or perform emergency services fallback. </condition> </condition> </control>
<control> <condition> If case b) is the only reason for initiating the registration procedure for mobility and periodic registration update, </condition> <action> the UE shall indicate "periodic registration updating" in the 5GS registration type IE; </action> </control> <control> <condition> otherwise, </condition> <condition> if the UE initiates the registration procedure for mobility and periodic registration update due to case Zg), </condition> <action> the UE shall indicate "disaster roaming mobility registration updating" in the 5GS registration type IE; </action> </control> <control> <condition> otherwise </condition> <action> the UE shall indicate "mobility registration updating". </action> </control>
<control> <condition> If case zl) is the reason for initiating the registration procedure for mobility and periodic registration update </condition> and <condition> if the UE supports S1 mode, </condition> <action> the UE shall: a) set the S1 mode bit to "S1 mode supported" in the 5GMM capability IE of the REGISTRATION REQUEST message; </action> and b) <action> include the S1 UE network capability IE in the REGISTRATION REQUEST message; </action> </control> <control> <condition> If the UE which is not registered for disaster roaming services indicates "mobility registration updating" in the 5GS registration type IE </condition> and <condition> the UE supports S1 mode, </condition> <action> the UE shall: c) set the S1 mode bit to "S1 mode supported" in the 5GMM capability IE of the REGISTRATION REQUEST message; </action> d) <action> include the S1 UE network capability IE in the REGISTRATION REQUEST message; </action> </control> <control> and e) <condition> if the UE supports sending an ATTACH REQUEST message containing a PDN CONNECTIVITY REQUEST message with request type set to "handover" to transfer a PDU session from N1 mode to S1 mode, </condition> <action> set the HO attach bit to "attach request message containing PDN connectivity request with request type set to handover to transfer PDU session from N1 mode to S1 mode supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports the LTE positioning protocol (LPP) in N1 mode as specified in 3GPP TS 37.355, </condition> <action> the UE shall set the LPP bit to "LPP in N1 mode supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports the Location Services (LCS) notification mechanisms in N1 mode as specified in 3GPP TS 23.273, </condition> <action> the UE shall set the 5G-LCS bit to " LCS notification mechanisms supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b), </condition> <condition> when the UE is not in NB-N1 mode </condition> and <condition> the UE supports RACS, </condition> </condition> <action> the UE shall set the RACS bit to "RACS supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports 5G-SRVCC from NG-RAN to UTRAN as specified in 3GPP TS 23.216, </condition> <action> the UE shall set: a) the 5G-SRVCC from NG-RAN to UTRAN capability bit to "5G-SRVCC from NG-RAN to UTRAN supported" in the 5GMM capability IE of the REGISTRATION REQUEST message for all cases except case b; </action> and b) <action> include the Mobile station classmark 2 IE and the Supported codecs IE in the REGISTRATION REQUEST message for all cases except case b. </action> </control>
<control> <condition> If the UE supports the restriction on use of enhanced coverage, </condition> <action> the UE shall set the RestrictEC bit to "Restriction on use of enhanced coverage supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports network slice-specific authentication and authorization, </condition> <action> the UE shall set the NSSAA bit to "network slice-specific authentication and authorization supported" in the 5GMM capability IE of the REGISTRATION REQUEST message for all cases except case b. </action> </control>
<control> <condition> If the UE supports CAG feature, </condition> <action> the UE shall set the CAG bit to "CAG Supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports extended CAG information list, </condition> <action> the UE shall set the Ex-CAG bit to "Extended CAG information list supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE operating in the single-registration mode performs inter-system change from S1 mode to N1 mode </condition> and <condition> has one or more stored UE policy sections identified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN, </condition> </condition> <action> the UE shall set the Payload container type IE to "UE policy container" </action> and <action> include the UE STATE INDICATION message (see annex D) in the Payload container IE of the REGISTRATION REQUEST message. </action> </control>
NOTE 4: In this version of the protocol, the UE can only include the Payload container IE in the REGISTRATION REQUEST message to carry a payload of type "UE policy container".
<control> <condition> The UE in state 5GMM-REGISTERED </condition> <action> shall initiate the registration procedure for mobility and periodic update by sending a REGISTRATION REQUEST message to the AMF </action> <condition> when the UE needs to request the use of SMS over NAS transport or the current requirements to use SMS over NAS transport change in the UE. </condition> <action> The UE shall set the SMS requested bit of the 5GS update type IE in the REGISTRATION REQUEST message as specified in subclause 5.5.1.2.2. </action> </control>
<control> <condition> When initiating a registration procedure for mobility and periodic registration update </condition> and <condition> the UE needs to send the 5GS update type IE for a reason different than indicating a change in requirement to use SMS over NAS, </condition> <action> the UE shall set the SMS requested bit of the 5GS update type IE in the REGISTRATION REQUEST message to the same value as indicated by the UE in the last REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE no longer requires the use of SMS over NAS, </condition> <action> then the UE shall include the 5GS update type IE in the REGISTRATION REQUEST message with the SMS requested bit set to "SMS over NAS not supported". </action> </control>
<control> <condition> After sending the REGISTRATION REQUEST message to the AMF </condition> <action> the UE shall start timer T3510. </action> </control> <control> <condition> If timer T3502 is currently running, </condition> <action> the UE shall stop timer T3502. </action> </control> <control> <condition> If timer T3511 is currently running, </condition> <action> the UE shall stop timer T3511. </action> </control>
<control> <condition> If the last visited registered TAI is available, </condition> <action> the UE shall include the last visited registered TAI in the REGISTRATION REQUEST message. </action> </control>
<control> <action> The UE shall handle the 5GS mobile identity IE in the REGISTRATION REQUEST message as follows: </action> </control>
<control> <condition> a) <condition> if the UE is operating in the single-registration mode, </condition> <condition> performs inter-system change from S1 mode to N1 mode, </condition> and <condition> the UE holds a valid native 4G-GUTI, </condition> </condition> <action> the UE shall create a 5G-GUTI mapped from the valid native 4G- GUTI as specified in 3GPP TS 23.003 </action> and <action> indicate the mapped 5G-GUTI in the 5GS mobile identity IE. </action> </control>
<control> <condition> Additionally, if the UE holds a valid 5G-GUTI, </condition> <action> the UE shall include the 5G-GUTI in the Additional GUTI IE in the REGISTRATION REQUEST message in the following order: </action> </control>
<control> 1) <action> a valid 5G-GUTI that was previously assigned by the same PLMN with which the UE is performing the registration, </action> <condition> if available; </condition> </control>
<control> 2) <action> a valid 5G-GUTI that was previously assigned by an equivalent PLMN, </action> <condition> if available; </condition> </control>
<control> 3) <action> a valid 5G-GUTI that was previously assigned by any other PLMN, </action> <condition> if available; </condition> and NOTE 5: The 5G-GUTI included in the Additional GUTI IE is a native 5G-GUTI. </control>
<control> <condition> b) <condition> for all other cases, </condition> <condition> if the UE holds a valid 5G-GUTI, </condition> </condition> <action> the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE. </action> </control> <control> <condition> <condition> If the UE is registering with an SNPN </condition> and <condition> the valid 5G-GUTI was previously assigned by another SNPN, </condition> </condition> <action> the UE shall additionally include the NID of the other SNPN in the NID IE. </action> </control>
<control> <condition> <condition> If the UE does not operate in SNPN access operation mode, </condition> <condition> holds two valid native 5G-GUTIs assigned by PLMNs </condition> and: </condition> </control>
<control> 1) <condition> one of the valid native 5G-GUTI was assigned by the PLMN with which the UE is performing the registration, </condition> then <action> the UE shall indicate the valid native 5G-GUTI assigned by the PLMN with which the UE is performing the registration. </action> In addition, <action> the UE shall include the other valid native 5G-GUTI in the Additional GUTI IE; </action> </control> or
<control> 2) <condition> none of the valid native 5G-GUTI was assigned by the PLMN with which the UE is performing the registration, </condition> <action> then the UE shall indicate the valid native 5G-GUTI assigned over the same access via which the UE is performing the registration. </action> </control>
<control> <condition> If the UE supports MICO mode </condition> and <condition> requests the use of MICO mode, </condition> <action> then the UE shall include the MICO indication IE in the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE requests to use an active time value, </condition> <action> it shall include the active time value in the T3324 IE in the REGISTRATION REQUEST message. </action> </control> <control> Additionally, <condition> if the UE supports strictly periodic registration timer, </condition> <action> the UE shall set the Strictly Periodic Registration Timer Indication bit of the MICO indication IE in the REGISTRATION REQUEST message to "strictly periodic registration timer supported". </action> </control> <control> <condition> If the UE needs to stop the use of MICO mode, </condition> then <action> the UE shall not include the MICO indication IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE needs to use or change the UE specific DRX parameters, </condition> <action> the UE shall include the Requested DRX parameters IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE is in NB-N1 mode </condition> and <condition> if the UE needs to use or change the UE specific DRX parameters for NB-N1 mode, </condition> </condition> <action> the UE shall include the Requested NB-N1 mode DRX parameters IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports eDRX and requests the use of eDRX, </condition> <action> the UE shall include the Requested extended DRX parameters IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE needs to request LADN information for specific LADN DNN(s) </condition> or <condition> indicates a request for LADN information as specified in 3GPP TS 23.501, </condition> <action> the UE shall include the LADN indication IE in the REGISTRATION REQUEST message </action> and: a) <action> request specific LADN DNNs by including a LADN DNN value in the LADN indication IE for each LADN DNN for which the UE requests LADN information; </action> or b) <action> to indicate a request for LADN information by not including any LADN DNN value in the LADN indication IE. </action> </control>
<control> <condition> If the UE is initiating the registration procedure for mobility and periodic registration update, </condition> <action> the UE may include the Uplink data status IE to indicate which PDU session(s) that is: a) not associated with control plane only indication; </action> b) <action> associated with the access type the REGISTRATION REQUEST message is sent over; </action> and c) <action> have pending user data to be sent over user plane. </action> </control>
<control> <condition> <condition> If the UE has one or more active always-on PDU sessions associated with the access type over which the REGISTRATION REQUEST message is sent </condition> and <condition> the user-plane resources for these PDU sessions are not established, </condition> and <condition> for cases triggering the REGISTRATION REQUEST message except b), </condition> </condition> <action> the UE shall include the Uplink data status IE and indicate that the UE has pending user data to be sent for those PDU sessions. </action> </control> <control> <condition> If the UE is located outside the LADN service area, </condition> <action> the UE shall not include the PDU session for LADN in the Uplink data status IE. </action> </control> <control> <condition> If the UE is in a non-allowed area or is not in an allowed area as specified in subclause 5.3.5, </condition> <action> the UE shall not include the Uplink data status IE except for emergency services or for high priority access. </action> </control> <control> <condition> If the MUSIM UE requests the network to release the NAS signalling connection, </condition> <action> the UE shall not include the Uplink data status IE in the REGISTRATION REQUEST. </action> </control>
<control> <condition> <condition> If the UE has one or more active PDU sessions which are not accepted by the network as always-on PDU sessions </condition> and <condition> no uplink user data pending to be sent for those PDU sessions, </condition> </condition> <action> the UE shall not include those PDU sessions in the Uplink data status IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> When the registration procedure for mobility and periodic registration update is initiated in 5GMM-IDLE mode, </condition> <action> the UE may include a PDU session status IE in the REGISTRATION REQUEST message, indicating: a) which single access PDU sessions associated with the access type the REGISTRATION REQUEST message is sent over are active in the UE; </action> and b) <action> which MA PDU sessions are active and having user plane resources established in the UE on the access the REGISTRATION REQUEST message is sent over. </action> </control>
<control> <condition> If the UE received a paging message with the access type indicating non-3GPP access, </condition> <action> the UE shall include the Allowed PDU session status IE in the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE has established the PDU session(s) over the non-3GPP access for which the associated S-NSSAI(s) are included in the allowed NSSAI for 3GPP access, </condition> <action> the UE shall indicate the PDU session(s) for which the UE allows to re-establish the user-plane resources over 3GPP access in the Allowed PDU session status IE. </action> </control> <control> <condition> Otherwise, </condition> <action> the UE shall not indicate any PDU session(s) in the Allowed PDU session status IE. </action> </control>
<control> <condition> When the Allowed PDU session status IE is included in the REGISTRATION REQUEST message, </condition> <action> the UE shall indicate that a PDU session is not allowed to be transferred to the 3GPP access </action> </control> <control> <condition> if the 3GPP PS data off UE status is "activated" for the corresponding PDU session </condition> and <condition> the UE is not using the PDU session to send uplink IP packets for any of the 3GPP PS data off exempt services (see subclause 6.2.10). </condition> </control>
<control> <condition> If the UE operating in the single-registration mode performs inter-system change from S1 mode to N1 mode, </condition> the UE: </control>
<control> <action> a) shall include the UE status IE with the EMM registration status set to "UE is in EMM-REGISTERED state" in the REGISTRATION REQUEST message; </action> </control> NOTE 6: Inclusion of the UE status IE with this setting corresponds to the indication that the UE is "moving from EPC" as specified in 3GPP TS 23.502 , subclause 4.11.1.3.3 and 4.11.2.3.
NOTE 7: The value of the 5GMM registration status included by the UE in the UE status IE is not used by the AMF.
<control> b) <action> may include the PDU session status IE in the REGISTRATION REQUEST message indicating the status of the PDU session(s) mapped </action> <condition> during the inter-system change from S1 mode to N1 mode from the PDN connection(s) for which the EPS indicated that interworking to 5GS is supported, if any (see subclause 6.1.4.1); </condition> </control>
<control> c) <action> shall include a TRACKING AREA UPDATE REQUEST message as specified in 3GPP TS 24.301 in the EPS NAS message container IE in the REGISTRATION REQUEST message </action> <condition> <condition> if the registration procedure is initiated in 5GMM-IDLE mode </condition> and <condition> the UE has received an "interworking without N26 interface not supported" indication from the network; </condition> </condition> </control>
<control> c1) <action> may include a TRACKING AREA UPDATE REQUEST message as specified in 3GPP TS 24.301 in the EPS NAS message container IE in the REGISTRATION REQUEST message </action> <condition> <condition> if the registration procedure is initiated in 5GMM-IDLE mode </condition> and <condition> the UE has received an "interworking without N26 interface supported" indication from the network; </condition> </condition> </control> and
<control> d) <action> shall include an EPS bearer context status IE in the REGISTRATION REQUEST message indicating which EPS bearer contexts are active in the UE, </action> <condition> if the UE has locally deactivated EPS bearer context(s) for which interworking to 5GS is supported </condition> <condition> while the UE was in S1 mode without notifying the network. </condition> </control>
<control> <condition> For a REGISTRATION REQUEST message with a 5GS registration type IE indicating "mobility registration updating", </condition> </control> if the UE:
<control> <condition> a) is in NB-N1 mode </condition> and: </control>
<control> 1) <condition> the UE needs to change the slice(s) it is currently registered to within the same registration area; </condition> or </control>
<control> 2) <condition> the UE has entered a new registration area; </condition> </control> or
<control> <condition> b) <condition> the UE is not in NB-N1 mode </condition> and <condition> is not registered for onboarding services in SNPN; </condition> </condition> <action> the UE shall include the Requested NSSAI IE containing the S-NSSAI(s) corresponding to the network slices to which the UE intends to register and associated mapped S-NSSAI(s), if available, in the REGISTRATION REQUEST message as described in this subclause. </action> </control> <control> <condition> <condition> When the UE is entering a visited PLMN </condition> and <condition> intends to register to the slices for which the UE has only HPLMN S-NSSAI(s) available, </condition> <action> the UE shall include these HPLMN S-NSSAI(s) in the Requested mapped NSSAI IE. </action> </condition> </control>
NOTE 8: The REGISTRATION REQUEST message can include both the Requested NSSAI IE and the Requested mapped NSSAI IE as described below.
<control> <condition> If the UE is registered for onboarding services in SNPN, </condition> <action> the UE shall not include the Requested NSSAI IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE has allowed NSSAI or configured NSSAI or both for the current PLMN, </condition> <action> the Requested NSSAI IE shall include either: </action> </control>
<control> <action> a) the configured NSSAI for the current PLMN or SNPN, or a subset thereof as described below; </action> </control>
<control> b) <action> the allowed NSSAI for the current PLMN or SNPN, or a subset thereof as described below; </action> or </control>
<control> c) <action> the allowed NSSAI for the current PLMN or SNPN, or a subset thereof as described below, </action> <action> plus one or more S- NSSAIs from the configured NSSAI for which no corresponding S-NSSAI is present in the allowed NSSAI and those are neither in the rejected NSSAI nor in the pending NSSAI. </action> </control>
<control> and <action> in addition the Requested NSSAI IE shall include S-NSSAI(s) applicable in the current PLMN or SNPN, </action> and <condition> if available the associated mapped S-NSSAI(s) for: </condition> </control>
<control> <condition> a) each PDN connection that is established in S1 mode when the UE is operating in the single-registration mode </condition> and <condition> the UE is performing an inter-system change from S1 mode to N1 mode; </condition> </control> or
<control> <condition> b) each active PDU session. </condition> </control>
<control> <condition> If the UE does not have S-NSSAI(s) applicable in the current PLMN or SNPN, </condition> <action> then the Requested mapped NSSAI IE shall include HPLMN S-NSSAI(s) (e.g. mapped S-NSSAI(s), </action> if available) for: </control>
<control> <action> a) each PDN connection established in S1 mode </action> <condition> <condition> when the UE is operating in the single-registration mode </condition> and <condition> the UE is performing an inter-system change from S1 mode to N1 mode to a visited PLMN; </condition> </condition> </control> or
<control> <condition> b) each active PDU session when the UE is performing mobility from N1 mode to N1 mode to a visited PLMN. </condition> </control>
NOTE 9: The Requested NSSAI IE is used instead of Requested mapped NSSAI IE in REGISTRATION REQUEST message when the UE enters HPLMN.
<control> <condition> <condition> If the UE has: a) no allowed NSSAI for the current PLMN or SNPN; </condition> <condition> b) no configured NSSAI for the current PLMN or SNPN; </condition> <condition> c) neither active PDU session(s) nor PDN connection(s) to transfer associated with an S-NSSAI applicable in the current PLMN or SNPN; </condition> and <condition> d) neither active PDU session(s) nor PDN connection(s) to transfer associated with mapped S-NSSAI(s); </condition> and <condition> has a default configured NSSAI, </condition> </condition> then the UE shall: </control>
<control> <action> a) include the S-NSSAI(s) in the Requested NSSAI IE of the REGISTRATION REQUEST message using the default configured NSSAI; </action> and </control>
<control> b) <action> include the Network slicing indication IE with the Default configured NSSAI indication bit set to "Requested NSSAI created from default configured NSSAI" in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE has: a) no allowed NSSAI for the current PLMN or SNPN; </condition> <condition> b) no configured NSSAI for the current PLMN or SNPN; </condition> <condition> c) neither active PDU session(s) nor PDN connection(s) to transfer associated with an S-NSSAI applicable in the current PLMN or SNPN </condition> <condition> d) neither active PDU session(s) nor PDN connection(s) to transfer associated with mapped S-NSSAI(s); </condition> <condition> e) no default configured NSSAI, </condition> </condition> <action> the UE shall include neither Requested NSSAI IE nor Requested mapped NSSAI IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If all the S-NSSAI(s) corresponding to the slice(s) to which the UE intends to register are included in the pending NSSAI, </condition> <action> the UE shall not include a requested NSSAI in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> When the UE storing a pending NSSAI intends to register to additional S-NSSAI(s) over the same access type, </condition> <action> the UE shall send the requested NSSAI containing the additional S-NSSAI(s) that the UE intends to register to in the REGISTRATION REQUEST message. </action> <action> The requested NSSAI shall not include any S-NSSAI from the pending NSSAI. </action> </control>
<control> <action> The subset of configured NSSAI provided in the requested NSSAI consists of one or more S-NSSAIs in the configured NSSAI applicable to this PLMN or SNPN, </action> <condition> if the S-NSSAI is neither in the rejected NSSAI nor associated to the S- NSSAI(s) in the rejected NSSAI. </condition> </control> <control> <condition> In addition, if the NSSRG information is available, </condition> <action> the subset of configured NSSAI provided in the requested NSSAI shall be associated with at least one common NSSRG value. </action> </control> <control> <condition> If the UE is in 5GMM- REGISTERED state over the other access </condition> and <condition> has already an allowed NSSAI for the other access, </condition> <action> all the S-NSSAI(s) in the requested NSSAI for the current access shall share at least an NSSRG value common to all the S-NSSAI(s) of the allowed NSSAI for the other access. </action> </control> <control> <condition> If the UE is simultaneously performing the registration procedure on the other access, </condition> <action> the UE shall include S-NSSAIs that share at least a common NSSRG value across all access types. </action> </control>
<control> NOTE 10: <condition> > <condition> If the UE has stored mapped S-NSSAI(s) for the rejected NSSAI, </condition> and <condition> one or more S-NSSAIs in the stored mapped S-NSSAI(s) for the configured NSSAI are not included in the stored mapped S-NSSAI(s) for the rejected NSSAI, </condition> </condition> <action> then a S-NSSAI in the configured NSSAI associated to one or more of these mapped S-NSSAI(s) for the configured NSSAI are available to be included in the requested NSSAI together with their mapped S-NSSAI. </action> </control>
<control> NOTE 11: <condition> If one or more mapped S-NSSAIs in the stored mapped S-NSSAI(s) for the configured NSSAI are not included in the stored rejected NSSAI for the failed or revoked NSSAA, </condition> <action> a S-NSSAI in the configured NSSAI associated to one or more of these mapped S-NSSAI(s) for the configured NSSAI are available to be included in the registration request together with their mapped S-NSSAI. </action> </control>
The subset of allowed NSSAI provided in the requested NSSAI consists of one or more S-NSSAIs in the allowed NSSAI for this PLMN.
NOTE 12: How the UE selects the subset of configured NSSAI or allowed NSSAI to be provided in the requested NSSAI is implementation specific. The UE can take preferences indicated by the upper layers (e.g.
policies like URSP, applications) and UE local configuration into account.
NOTE 13: The number of S-NSSAI(s) included in the requested NSSAI cannot exceed eight.
<control> <condition> If the UE supports NSAG, </condition> <action> the UE shall set the NSAG bit to "NSAG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <action> The UE shall set the Follow-on request indicator to "Follow-on request pending", </action> if the UE: </control>
<control> <condition> a) initiates the mobility and periodic registration updating procedure upon request of the upper layers to establish an emergency PDU session; </condition> </control>
<control> <condition> b) initiates the mobility and periodic registration updating procedure upon receiving a request from the upper layers to perform emergency services fallback; </condition> or </control>
<control> <condition> c) needs to prolong the established NAS signalling connection after the completion of the registration procedure for mobility and periodic registration update (e.g. due to uplink signalling pending but no user data pending). </condition> </control>
<control> NOTE 14: <action> The UE does not have to set the Follow-on request indicator to 1 </action> <condition> <condition> even if the UE has to request resources for V2X communication over PC5 reference point, </condition> <condition> 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5. </condition> </condition> </control>
<control> <condition> For case n), </condition> <action> the UE shall include the 5GS update type IE in the REGISTRATION REQUEST message with the NG- RAN-RCU bit set to " UE radio capability update needed". </action> </control> <control> <condition> <condition> Additionally, if the UE is not in NB-N1 mode, </condition> <condition> the UE supports RACS </condition> and <condition> the UE has an applicable UE radio capability ID for the new UE radio configuration in the serving PLMN or SNPN, </condition> </condition> <action> the UE shall include the applicable UE radio capability ID in the UE radio capability ID of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE is in the 5GMM-CONNECTED mode </condition> and <condition> the UE changes the radio capability for NG-RAN or E-UTRAN, </condition> </condition> <action> the UE may locally release the established N1 NAS signalling connection </action> and <action> enter the 5GMM-IDLE mode. </action> <action> Then, the UE shall initiate the registration procedure for mobility and periodic updating including the 5GS update type IE in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to " UE radio capability update needed". </action> </control>
<control> <condition> For case o), </condition> <action> the UE shall include the Uplink data status IE in the REGISTRATION REQUEST message indicating the PDU session(s) without active user-plane resources for which the UE has pending user data to be sent, </action> <condition> if any, </condition> and <action> the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, </action> <condition> if any. </condition> </control> <control> <condition> If the UE is in a non-allowed area </condition> or <condition> if the UE is not in allowed area, </condition> <action> the UE shall not include the Uplink data status IE in REGISTRATION REQUEST message, </action> <condition> except if the PDU session for which user-plane resources were active prior to receiving the fallback indication is an emergency PDU session, </condition> or <condition> if the UE is configured for high priority access in the selected PLMN as specified in subclause 5.3.5. </condition> </control>
<control> <condition> For case f), </condition> <action> the UE shall include the Uplink data status IE in the REGISTRATION REQUEST message indicating the PDU session(s) for which user-plane resources were active prior to receiving "RRC Connection failure" indication from the lower layers, if any. </action> </control> <control> <condition> If the UE is in non-allowed area or not in allowed area, </condition> <action> the UE shall not include the Uplink data status IE in REGISTRATION REQUEST message, </action> <condition> except that the PDU session(s) for which user-plane resources were active prior to receiving the "RRC Connection failure"indication is emergency PDU session(s), </condition> or <condition> that the UE is configured for high priority access in selected PLMN, as specified in subclause 5.3.5. </condition> </control>
<control> <condition> If the UE supports service gap control, </condition> <action> then the UE shall set the SGC bit to "service gap control supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> For case a), x) </condition> or <condition> if the UE operating in the single-registration mode performs inter-system change from S1 mode to N1 mode, </condition> the UE shall: </control>
<control> <condition> a) if the UE has an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN or SNPN, </condition> <action> include the applicable network-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message; </action> </control> and
b) if the UE:
<control> <condition> 1) does not have an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN or SNPN; </condition> and </control>
<control> 2) <condition> has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration, </condition> <action> include the applicable manufacturer-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except cases b and z, </condition> <condition> if the UE supports ciphered broadcast assistance data </condition> and <condition> the UE needs to obtain new ciphering keys, </condition> </condition> <action> the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> For case z, </condition> <action> the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> For case a, </condition> <condition> if the UE supports ciphered broadcast assistance data </condition> and <condition> the UE detects that one or more ciphering keys stored at the UE is not applicable in the current TAI, </condition> </condition> <action> the UE should include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> For case b, </condition> <condition> if the UE supports ciphered broadcast assistance data </condition> and <condition> the remaining validity time for one or more ciphering keys stored at the UE is less than timer T3512, </condition> </condition> <action> the UE should include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the REGISTRATION REQUEST message. </action> </control>
<control> <action> The UE shall set the WUSA bit to "WUS assistance information reception supported" in the 5GMM capability IE </action> <condition> if the UE supports WUS assistance information. </condition> <action> The UE may include its UE paging probability information in the Requested WUS assistance information IE </action> <condition> <condition> if the UE has set the WUSA bit to "WUS assistance information reception supported" in the 5GMM capability IE </condition> and <condition> does not have an active emergency PDU session. </condition> </condition> </control>
<control> <action> The UE shall set the NR-PSSI bit to "NR paging subgrouping supported" in the 5GMM capability IE </action> <condition> <condition> if the UE supports PEIPS assistance information, </condition> <condition> is not registered for emergency services </condition> and <condition> does not have an active emergency PDU session. </condition> </condition> </control> <control> <action> The UE may include its UE paging probability information in the Requested PEIPS assistance information IE </action> <condition> if the UE has set the NR-PSSI bit to "NR paging subgrouping supported" in the 5GMM capability IE. </condition> </control>
<control> <condition> <condition> If the network supports the N1 NAS signalling connection release, </condition> and <condition> the MUSIM UE requests the network to release the NAS signalling connection, </condition> </condition> <action> the UE shall set Request type to "NAS signalling connection release" in the UE request type IE, </action> <action> set the Follow-on request indicator to "No follow-on request pending" </action> </control> and, <control> <condition> if the network supports the paging restriction, </condition> <action> may set the paging restriction preference in the Paging restriction IE in the REGISTRATION REQUEST message. </action> <action> In addition, the UE shall not include the Uplink data status IE or the Allowed PDU session status IE in the REGISTRATION REQUEST message </action> <condition> even if the UE has one or more active always-on PDU sessions associated with the 3GPP access. </condition> </control>
<control> NOTE 15: <condition> <condition> If the network has already indicated support for N1 NAS signalling connection release in the current stored registration area </condition> and <condition> the UE doesn't have an emergency PDU session established, </condition> </condition> <action> the MUSIM UE is allowed to request the network to release the NAS signalling connection during mobility registration update procedure that is due to mobility outside the registration area </action> <condition> even before detecting whether the network supports the N1 NAS signalling connection release in the current TAI. </condition> </control>
<control> NOTE 16: <condition> <condition> If the network has already indicated support for paging restriction in the current stored registration area </condition> and <condition> the UE doesn't have an emergency PDU session established, </condition> </condition> <action> the MUSIM UE is allowed to include paging restriction together with the request to the network to release the NAS signalling connection during mobility registration update procedure that is due to mobility outside the registration area </action> <condition> even before detecting whether the network supports the paging restriction in the current TAI. </condition> </control>
<control> <condition> For case zi), </condition> <action> the UE shall not include the Paging restriction IE in the REGISTRATION REQUEST message. </action> <condition> <condition> If the UE is in 5GMM-IDLE mode </condition> and <condition> the network supports the N1 NAS signalling connection release, </condition> </condition> <action> the UE may include the UE request type IE </action> and <action> set Request type to "NAS signalling connection release" to remove the paging restriction </action> and <action> request the release of the NAS signalling connection at the same time. </action> <action> In addition, the UE shall not include the Uplink data status IE in the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE does not have a valid 5G NAS security context </condition> and <condition> the UE is sending the REGISTRATION REQUEST message after an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, </condition> </condition> <action> the UE shall send the REGISTRATION REQUEST message without including the NAS message container IE. </action> <action> The UE shall include the entire REGISTRATION REQUEST message (i.e. containing cleartext IEs and non-cleartext IEs, if any) in the NAS message container IE that is sent as part of the SECURITY MODE COMPLETE message as described in subclauses 4.4.6 and 5.4.2.3. </action> </control>
<control> <condition> <condition> If the UE indicates "mobility registration updating" in the 5GS registration type IE </condition> and <condition> supports V2X as specified in 3GPP TS 24.587, </condition> </condition> <action> the UE shall set the V2X bit to "V2X supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE indicates "mobility registration updating" in the 5GS registration type IE </condition> and <condition> supports V2X communication over E-UTRA-PC5 as specified in 3GPP TS 24.587, </condition> <action> the UE shall set the V2XCEPC5 bit to "V2X communication over E-UTRA-PC5 supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE indicates "mobility registration updating" in the 5GS registration type IE </condition> and <condition> supports V2X communication over NR-PC5 as specified in 3GPP TS 24.587, </condition> <action> the UE shall set the V2XCNPC5 bit to "V2X communication over NR-PC5 supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <action> The UE shall send the REGISTRATION REQUEST message including the NAS message container IE as described in subclause 4.4.6: </action> </control>
<control> <condition> a) when the UE is sending the message from 5GMM-IDLE mode, </condition> <condition> the UE has a valid 5G NAS security context, </condition> and <condition> needs to send non-cleartext IEs; </condition> </control> or
<control> <condition> b) when the UE is sending the message after an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode </condition> and <condition> the UE has a valid 5G NAS security context and needs to send non-cleartext IEs. </condition> </control>
<control> <condition> The UE with a valid 5G NAS security context </condition> <action> shall send the REGISTRATION REQUEST message without including the NAS message container IE </action> <condition> <condition> when the UE does not need to send non-cleartext IEs </condition> and <condition> the UE is sending the message: </condition> </condition> </control>
<control> <condition> b) after an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode. </condition> </control>
<control> <condition> <condition> If the UE is sending the REGISTRATION REQUEST message after an inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode </condition> and <condition> the UE needs to send non-cleartext IEs, </condition> </condition> <action> the UE shall cipher the NAS message container IE using the mapped 5G NAS security context </action> and <action> send the REGISTRATION REQUEST message including the NAS message container IE as described in subclause 4.4.6. </action> </control> <control> <condition> If the UE does not need to send non-cleartext IEs, </condition> <action> the UE shall send the REGISTRATION REQUEST message without including the NAS message container IE. </action> </control>
<control> <condition> If the REGISTRATION REQUEST message includes a NAS message container IE, </condition> <action> the AMF shall process the REGISTRATION REQUEST message that is obtained from the NAS message container IE as described in subclause 4.4.6. </action> </control>
<control> <condition> If the UE is in NB-N1 mode, </condition> <action> then the UE shall set the Control plane CIoT 5GS optimization bit to "Control plane CIoT 5GS optimization supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE is capable of NB-S1 mode, </condition> <action> then the UE shall set the Control plane CIoT EPS optimization bit to "Control plane CIoT EPS optimization supported" in the S1 UE network capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the registration procedure for mobility and periodic registration update is initiated </condition> and <condition> there is request from the upper layers to perform "emergency services fallback" pending, </condition> <action> the UE shall send a REGISTRATION REQUEST message without an Uplink data status IE. </action> </control>
<control> <condition> If the UE supports N3 data transfer and multiple user-plane resources in NB-N1 mode (see 3GPP TS 36.306 , 3GPP TS 36.331 ), </condition> <action> then the UE shall set the Multiple user-plane resources support bit to "Multiple user-plane resources supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
The UE shall set the ER-NSSAI bit to "Extended rejected NSSAI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message.
<control> <condition> If the UE supports the NSSRG, </condition> <action> then the UE shall set the NSSRG bit to "NSSRG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> For case zf), </condition> <action> the UE shall include the service-level device ID in the Service-level-AA container IE of the REGISTRATION REQUEST message </action> and <action> set the value to the CAA-level UAV ID. </action> <action> The UE shall include the service- level-AA server address in the Service-level-AA container IE of the REGISTRATION REQUEST message </action> and <action> set the value to the USS address, </action> <condition> if it is provided by the upper layers. </condition> </control>
<control> <condition> If the UE supports 5G ProSe direct discovery as specified in 3GPP TS 24.554, </condition> <action> the UE shall set the 5G ProSe-dd bit to "5G ProSe direct discovery supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports 5G ProSe direct communication as specified in 3GPP TS 24.554, </condition> <action> the UE shall set the 5G ProSe-dc bit to "5G ProSe discovery communication supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE supports acting as 5G ProSe layer-2 UE-to-network relay UE as specified in 3GPP TS 24.554, </condition> <action> the UE shall set the 5G ProSe-l2relay bit to "Acting as a 5G ProSe layer-2 UE-to-network relay UE supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE supports acting as 5G ProSe layer-3 UE-to-network relay UE as specified in 3GPP TS 24.554, </condition> <action> the UE shall set the 5G ProSe-l3relay bit to "Acting as a 5G ProSe layer-3 UE-to-network relay UE supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE supports acting as 5G ProSe layer-2 UE-to-network remote UE as specified in 3GPP TS 24.554, </condition> <action> the UE shall set the 5G ProSe-l2rmt bit to "Acting as a 5G ProSe layer-2 UE-to- network remote UE supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control> <control> <condition> If the UE supports acting as 5G ProSe layer-3 UE-to-network remote UE as specified in 3GPP TS 24.554, </condition> <action> the UE shall set the 5G ProSe-l3rmt bit to "Acting as a 5G ProSe layer-3 UE-to-network remote UE supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> For all cases except case b, </condition> <condition> if the MUSIM UE supports the N1 NAS signalling connection release, </condition> <action> then the UE shall set the N1 NAS signalling connection release bit to "N1 NAS signalling connection release supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </action> </control> <control> <condition> otherwise </condition> <action> the UE shall not set the N1 NAS signalling connection release bit to "N1 NAS signalling connection release supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> For all cases except case b, </condition> <condition> if the MUSIM UE supports the paging indication for voice services, </condition> <action> then the UE shall set the paging indication for voice services bit to "paging indication for voice services supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </action> </control> <control> <condition> otherwise </condition> <action> the UE shall not set the paging indication for voice services bit to "paging indication for voice services supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> For all cases except case b, </condition> <condition> if the MUSIM UE supports the reject paging request, </condition> <action> then the UE shall set the reject paging request bit to "reject paging request supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </action> </control> <control> <condition> otherwise </condition> <action> the UE shall not set the reject paging request bit to "reject paging request supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the MUSIM UE sets: a) the reject paging request bit to "reject paging request supported"; </condition> <condition> b) the N1 NAS signalling connection release bit to "N1 NAS signalling connection release supported"; </condition> or <condition> c) both of them; </condition> and <condition> supports the paging restriction, </condition> </condition> <action> then the UE shall set the paging restriction bit to "paging restriction supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </action> </control> <control> <condition> otherwise </condition> <action> the UE shall not set the paging restriction bit to "paging restriction supported" in the 5GMM capability IE of the REGISTRATION REQUEST </action> </control>
<control> <condition> If the UE supports MINT, </condition> <action> the UE shall set the MINT bit to "MINT supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> For case zg), </condition> <condition> if the UE has determined the MS determined PLMN with disaster condition as specified in 3GPP TS 23.122, </condition> and: </condition> </control>
<control> <condition> a) the MS determined PLMN with disaster condition is the HPLMN </condition> and: </control>
<control> 1) <condition> the Additional GUTI IE is included in the REGISTRATION REQUEST message </condition> and <condition> does not contain a valid 5G-GUTI that was previously assigned by the HPLMN; </condition> or </control>
<control> 2) <condition> the Additional GUTI IE is not included in the REGISTRATION REQUEST message </condition> and <condition> the 5GS mobile identity IE contains neither the SUCI nor a valid 5G-GUTI that was previously assigned by the HPLMN; </condition> or </control>
<control> <condition> b) the MS determined PLMN with disaster condition is not the HPLMN </condition> and: </control>
<control> 1) <condition> the Additional GUTI IE is included in the REGISTRATION REQUEST message </condition> and <condition> does not contain a valid 5G-GUTI that was previously assigned by the MS determined PLMN with disaster condition; </condition> or </control>
<control> <condition> 2) <condition> the Additional GUTI IE is not included in the REGISTRATION REQUEST message </condition> and <condition> the 5GS mobile identity IE does not contain a valid 5G-GUTI that was previously assigned by the MS determined PLMN with disaster condition; </condition> </condition> <action> the UE shall include in the REGISTRATION REQUEST message the MS determined PLMN with disaster condition IE indicating the MS determined PLMN with disaster condition. </action> </control>
<control> NOTE 17: <condition> If the UE initiates the registration procedure for disaster roaming services, </condition> and <condition> the MS determined PLMN with disaster condition cannot be determined when an NG-RAN cell of the PLMN broadcasts the disaster related indication as specified in 3GPP TS 23.122, </condition> <action> the UE does not include in the REGISTRATION REQUEST message the MS determined PLMN with disaster condition IE but includes the Additional GUTI IE or the 5GS mobile identity IE or both as specified in subclauses 5.5.1.2.2. </action> </control>
<control> <condition> For case zh) </condition> <action> the UE shall indicate "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> If the UE supports event notification, </condition> <action> the UE shall set the EventNotification bit to "Event notification supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE supports access to an SNPN using credentials from a credentials holder </condition> and <condition> the UE is in its HPLMN or EHPLMN or a subscribed SNPN, </condition> </condition> <action> the UE shall set the SSNPNSI bit to "SOR-SNPN-SI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message. </action> </control>
UE AMF REGISTRATION REQUEST
Start T3510 REGISTRATION ACCEPT
Stop T3510 OR REGISTRATION REQUEST
Start T3510 REGISTRATION ACCEPT
Start T3550
Stop T3510 REGISTRATION COMPLETE
Stop T3550 OR REGISTRATION REQUEST
Start T3510 REGISTRATION REJECT
Stop T3510
5.5.1.3.3 5GMM common procedure initiation
<control> <action> The AMF may initiate 5GMM common procedures, e.g. the identification, authentication and security procedures </action> <condition> during the registration procedure, </condition> <condition> depending on the information received in the REGISTRATION REQUEST message. </condition> </control>
<control> <action> The AMF may be configured to skip the authentication procedure </action> <condition> even if no 5GS security context is available </condition> and <action> proceed directly to the execution of the security mode control procedure as specified in subclause 5.4.2, </action> <condition> during the registration procedure for mobility and periodic registration update for a UE that has only an emergency PDU session. </condition> </control>
<control> <action> The AMF shall not initiate a 5GMM authentication procedure before completion of the registration procedure for mobility and periodic registration update, </action> <condition> if the following conditions apply: </condition> </control>
<control> <condition> a) the UE initiated the registration procedure for mobility and periodic registration update after handover or inter- system change to N1 mode in 5GMM-CONNECTED mode; </condition> </control>
<control> <condition> b) <condition> the target cell is a shared network cell; </condition> and c.1) <condition> the UE has provided its 5G-GUTI in the 5GS mobile identity IE or the Additional GUTI IE in the REGISTRATION REQUEST message, </condition> and <condition> the PLMN identity included in the 5G-GUTI is different from the selected PLMN identity of the target cell; </condition> or c.2) <condition> the UE has included the 5G-GUTI mapped from the 4G-GUTI in the 5GS mobile identity IE </condition> and <condition> not included an Additional GUTI IE in the REGISTRATION REQUEST message, </condition> and <condition> the PLMN identity included in the 5G-GUTI is different from the selected PLMN identity of the target cell. </condition> </condition> </control>
5.5.1.3.4 Mobility and periodic registration update accepted by the network
<control> <condition> If the registration update request has been accepted by the network, </condition> <action> the AMF shall send a REGISTRATION ACCEPT message to the UE. </action> </control>
<control> <condition> If timer T3513 is running in the AMF, </condition> <action> the AMF shall stop timer T3513 </action> <condition> <condition> if a paging request was sent with the access type indicating non-3GPP </condition> and <condition> the REGISTRATION REQUEST message includes the Allowed PDU session status IE. </condition> </condition> </control>
<control> <condition> If timer T3565 is running in the AMF, </condition> <action> the AMF shall stop timer T3565 </action> <condition> when a REGISTRATION REQUEST message is received. </condition> </control>
<control> <condition> For each of the information elements: 5GMM capability, S1 UE network capability, and UE security capability, </condition> <action> the AMF shall store all octets received from the UE in the REGISTRATION REQUEST message, up to the maximum length defined for the respective information element. </action> </control>
NOTE 1: This information is forwarded to the new AMF during inter-AMF handover or to the new MME during inter-system handover to S1 mode.
The 5G-GUTI reallocation shall be part of the registration procedure for mobility registration update. The 5G-GUTI reallocation should be part of the registration procedure for periodic registration update. <control> <condition> <condition> During the registration procedure for mobility registration update, </condition> <condition> if the AMF has not allocated a new 5G-GUTI by the generic UE configuration update procedure, </condition> </condition> <action> the AMF shall include in the REGISTRATION ACCEPT message the new assigned 5G-GUTI. </action> </control>
<control> <condition> <condition> If the UE has set the CAG bit to "CAG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </condition> and <condition> the AMF needs to update the "CAG information list" stored in the UE, </condition> </condition> <action> the AMF shall include the CAG information list IE or the Extended CAG information list IE in the REGISTRATION ACCEPT message. </action> </control>
NOTE 2: The "CAG information list" can be provided by the AMF and include no entry if no "CAG information list" exists in the subscription.
<control> NOTE 2A: <condition> If the UE supports extended CAG information list, </condition> <action> the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE. </action> </control>
<control> <condition> If the UE does not support extended CAG information list, </condition> <action> the CAG information list shall not be included in the Extended CAG information list IE. </action> </control>
<control> <condition> If a 5G-GUTI or the SOR transparent container IE is included in the REGISTRATION ACCEPT message, </condition> <action> the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <condition> If the Operator-defined access category definitions IE or the Extended emergency number list IE, the CAG information list IE or the Extended CAG information list IE are included in the REGISTRATION ACCEPT message, </condition> <action> the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </action> </control>
<control> <condition> If the UE is not in NB-N1 mode </condition> and <condition> the UE has set the RACS bit to "RACS supported" in the 5GMM Capability IE of the REGISTRATION REQUEST message, </condition> <action> the AMF may include either a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If the UE radio capability ID IE or the UE radio capability ID deletion indication IE is included in the REGISTRATION ACCEPT message, </condition> <action> the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <action> The AMF may include a new TAI list for the UE in the REGISTRATION ACCEPT message. </action> <action> The new TAI list shall not contain both tracking areas in NB-N1 mode and tracking areas not in NB-N1 mode. </action> <condition> The UE, upon receiving a REGISTRATION ACCEPT message, </condition> <action> shall delete its old TAI list and store the received TAI list. </action> </control> <control> <condition> If there is no TAI list received, </condition> <action> the UE shall consider the old TAI list as valid. </action> </control> <control> <condition> If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, </condition> and <condition> a) the UE already has stored allowed NSSAI for the current registration area, </condition> <action> the UE shall store the allowed NSSAI for the current registration area in each of the allowed NSSAIs which are associated with each of the PLMNs in the registration area; </action> </control> and
<control> <condition> b) the UE already has stored rejected NSSAI for the current registration area, </condition> <action> the UE shall store the rejected NSSAI for the current registration area in each of the rejected NSSAIs which are associated with each of the PLMNs in the registration area. </action> </control>
NOTE 3: When assigning the TAI list, the AMF can take into account the eNodeB's capability of support of CIoT 5GS optimization.
The AMF may also include a list of equivalent PLMNs in the REGISTRATION ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). <control> <action> The UE shall store the list as provided by the network, </action> and <condition> if there is no emergency PDU session established, </condition> <action> the UE shall remove from the list any PLMN code that is already in the forbidden PLMN list as specified in subclause 5.3.13A. </action> </control> <control> <condition> <condition> If the UE is not registered for emergency services </condition> and <condition> there is an emergency PDU session established, </condition> </condition> <action> the UE shall remove from the list of equivalent PLMNs any PLMN code present in the forbidden PLMN list as specified in subclause 5.3.13A, </action> <condition> when the emergency PDU session is released. </condition> <action> In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. </action> <action> The UE shall replace the stored list on each receipt of the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If the REGISTRATION ACCEPT message does not contain a list, </condition> <action> then the UE shall delete the stored list. </action> </control>
<control> <condition> <condition> If the UE is not registered for emergency services, </condition> and <condition> if the PLMN identity of the registered PLMN is a member of the forbidden PLMN list as specified in subclause 5.3.13A, </condition> </condition> <action> any such PLMN identity shall be deleted from the corresponding list(s). </action> </control>
<control> <action> The AMF may include new service area restrictions in the Service area list IE in the REGISTRATION ACCEPT message. </action> <condition> The UE, upon receiving a REGISTRATION ACCEPT message with new service area restrictions </condition> <action> shall act as described in subclause 5.3.5. </action> </control>
<control> <condition> If the Service area list IE is not included in the REGISTRATION ACCEPT message, </condition> <action> any tracking area in the registered PLMN and its equivalent PLMN(s) in the registration area is considered as an allowed tracking area as described in subclause 5.3.5. </action> </control>
<control> <action> The AMF shall include the MICO indication IE in the REGISTRATION ACCEPT message </action> <condition> only if the MICO indication IE was included in the REGISTRATION REQUEST message, </condition> <action> the AMF supports and accepts the use of MICO mode. </action> </control> <control> <condition> If the AMF supports and accepts the use of MICO mode, </condition> <action> the AMF may indicate "all PLMN registration area allocated" in the MICO indication IE in the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If "all PLMN registration area allocated" is indicated in the MICO indication IE, </condition> <action> the AMF shall not assign and include the TAI list in the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If the REGISTRATION ACCEPT message includes an MICO indication IE indicating "all PLMN registration area allocated", </condition> <action> the UE shall treat all TAIs in the current PLMN as a registration area and delete its old TAI list. </action> </control> <control> <condition> If "strictly periodic registration timer supported" is indicated in the MICO indication IE in the REGISTRATION REQUEST message, </condition> <action> the AMF may indicate "strictly periodic registration timer supported" in the MICO indication IE </action> and <action> may include the T3512 value IE in the REGISTRATION ACCEPT message. </action> </control> <control> <condition> <condition> If the timer value received in T3512 IE is different from the already stored value of the timer T3512 </condition> and <condition> the timer T3512 is running, </condition> </condition> <action> the UE shall restart T3512 with the new value received in the T3512 value IE. </action> </control>
<control> <action> The AMF shall include an active time value in the T3324 IE in the REGISTRATION ACCEPT message </action> <condition> <condition> if the UE requested an active time value in the REGISTRATION REQUEST message </condition> and <condition> the AMF accepts the use of MICO mode and the use of active time. </condition> </condition> </control>
<control> <condition> If the UE does not include MICO indication IE in the REGISTRATION REQUEST message, </condition> <action> then the AMF shall disable MICO mode if it was already enabled. </action> </control>
<control> <action> The AMF may include the T3512 value IE in the REGISTRATION ACCEPT message </action> <condition> only if the REGISTRATION REQUEST message was sent over the 3GPP access. </condition> </control>
<control> <action> The AMF may include the non-3GPP de-registration timer value IE in the REGISTRATION ACCEPT message </action> <condition> only if the REGISTRATION REQUEST message was sent for the non-3GPP access. </condition> </control>
<control> <condition> <condition> If the UE indicates support of the N1 NAS signalling connection release in the REGISTRATION REQUEST message </condition> and <condition> the network decides to accept the N1 NAS signalling connection release, </condition> </condition> <action> then the AMF shall set the N1 NAS signalling connection release bit to "N1 NAS signalling connection release supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE indicates support of the paging indication for voice services in the REGISTRATION REQUEST message </condition> and <condition> the network decides to accept the paging indication for voice services, </condition> </condition> <action> then the AMF shall set the paging indication for voice services bit to "paging indication for voice services supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If the UE receives the REGISTRATION ACCEPT message with the paging indication for voice services bit set to "paging indication for voice services supported", </condition> <action> the UE NAS layer informs the lower layers that paging indication for voice services is supported. </action> </control> <control> <condition> Otherwise, </condition> <action> the UE NAS layer informs the lower layers that paging indication for voice services is not supported. </action> </control>
<control> <condition> <condition> If the UE indicates support of the reject paging request in the REGISTRATION REQUEST message </condition> and <condition> the network decides to accept the reject paging request, </condition> </condition> <action> then the AMF shall set the reject paging request bit to "reject paging request supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE indicates support of the paging restriction in the REGISTRATION REQUEST message, </condition> and <condition> the AMF sets: a) the reject paging request bit to "reject paging request supported"; </condition> b) <condition> the N1 NAS signalling connection release bit to "N1 NAS signalling connection release supported"; </condition> or c) <condition> both of them; </condition> in the 5GS network feature support IE of the REGISTRATION ACCEPT message, and <condition> the network decides to accept the paging restriction, </condition> </condition> <action> then the AMF shall set the paging restriction bit to "paging restriction supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the MUSIM UE does not include the Paging restriction IE in the REGISTRATION REQUEST message, </condition> <action> the AMF shall delete any stored paging restriction for the UE and stop restricting paging. </action> </control>
<control> <condition> <condition> If the MUSIM UE requests the release of the NAS signalling connection, by setting Request type to "NAS signalling connection release" in the UE request type IE included in the REGISTRATION REQUEST message, </condition> and <condition> the AMF supports the N1 NAS signalling connection release, </condition> </condition> <action> the AMF shall initiate the release of the NAS signalling connection after the completion of the registration procedure for mobility and periodic registration update. </action> </control> <control> <condition> If the UE requests restriction of paging by including the Paging restriction IE and the AMF supports the paging restriction, </condition> <condition> the AMF: a) if accepts the paging restriction, </condition> <action> shall include the 5GS additional request result IE in the REGISTRATION ACCEPT message </action> and <action> set the Paging restriction decision to "paging restriction is accepted". </action> <action> The AMF shall store the paging restriction of the UE and enforce these restrictions in the paging procedure as described in clause 5.6.2; </action> </control> <control> or b) <condition> if rejects the paging restriction, </condition> <action> shall include the 5GS additional request result IE in the REGISTRATION ACCEPT message </action> and <action> set the Paging restriction decision to "paging restriction is rejected", </action> and <action> shall discard the received paging restriction. </action> <action> The AMF shall delete any stored paging restriction for the UE and stop restricting </action> </control>
<control> <condition> <condition> If the UE requests "control plane CIoT 5GS optimization" in the 5GS update type IE, </condition> <condition> indicates support of control plane CIoT 5GS optimization in the 5GMM capability IE </condition> and <condition> the AMF decides to accept the requested CIoT 5GS optimization and the registration request, </condition> </condition> <action> the AMF shall indicate "control plane CIoT 5GS optimization supported" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE has indicated support for the control plane CIoT 5GS optimizations, </condition> and <condition> the AMF decides to activate the congestion control for transport of user data via the control plane, </condition> </condition> <action> then the AMF shall include the T3448 value IE in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the AMF decides to deactivate the congestion control for transport of user data via the control plane, </condition> <action> then the AMF shall delete the stored control plane data back-off time for the UE </action> and <action> the AMF shall not include timer T3448 value IE in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> If: a) the UE in NB-N1 mode is using control plane CIoT 5GS optimization; </condition> and <condition> b) the network is configured to provide the truncated 5G-S-TMSI configuration for control plane CIoT 5GS optimizations; </condition> </condition> <action> the AMF shall include the Truncated 5G-S-TMSI configuration IE in the REGISTRATION ACCEPT message </action> and <action> set the "Truncated AMF Set ID value" and the "Truncated AMF Pointer value" in the Truncated 5G-S-TMSI configuration IE based on network policies. </action> <action> The AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE- INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <condition> For inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, </condition> <condition> if the UE has included a ngKSI indicating a current 5G NAS security context in the REGISTRATION REQUEST message by which the REGISTRATION REQUEST message is integrity protected, </condition> <action> the AMF shall take one of the following actions: </action> </control>
<control> <condition> a) if the AMF retrieves the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, </condition> <action> the AMF shall integrity check the REGISTRATION REQUEST message using the current 5G NAS security context </action> and <action> integrity protect the REGISTRATION ACCEPT message using the current 5G NAS security context; </action> </control>
<control> <condition> b) if the AMF cannot retrieve the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, </condition> <action> the AMF shall treat the REGISTRATION REQUEST message fails the integrity check and take actions as specified in subclause 4.4.4.3; </action> </control> or
<control> <condition> c) if the UE has not included an Additional GUTI IE, </condition> <action> the AMF may treat the REGISTRATION REQUEST message as in the previous item, i.e. as if it cannot retrieve the current 5G NAS security context. </action> </control>
NOTE 4: The handling described above at failure to retrieve the current 5G NAS security context or if no Additional GUTI IE was provided does not preclude the option for the AMF to perform a primary authentication and key agreement procedure and create a new native 5G NAS security context.
<control> <condition> For inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode, </condition> <action> the AMF shall integrity check REGISTRATION REQUEST message using the current K' as derived when triggering the handover to N1 mode AMF (see subclause 4.4.2.2). </action> <action> The AMF shall verify the received UE security capabilities in the REGISTRATION REQUEST message. </action> <action> The AMF shall then take one of the following actions: </action> </control>
<control> <condition> a) if the REGISTRATION REQUEST does not contain a valid KSI in the Non-current native NAS key set AMF identifier IE, </condition> <action> the AMF shall remove the non-current native 5G NAS security context, if any, for any 5G-GUTI for this UE. </action> <action> The AMF shall then integrity protect and cipher the REGISTRATION ACCEPT message using the security context based on K' </action> and <action> take the mapped 5G NAS security context into use; </action> </control> or AMF
<control> <condition> b) if the REGISTRATION REQUEST contains a valid KSI in the Non-current native NAS key set identifier IE AMF </condition> and: </control>
<control> 1) <condition> the AMF decides to take the native 5G NAS security context into use, </condition> <action> the AMF shall initiate a security mode control procedure to take the corresponding native 5G NAS security context into use </action> and <action> then integrity protect and cipher the REGISTRATION ACCEPT message using the corresponding native 5G NAS security context; </action> </control> and
<control> 2) <condition> otherwise, </condition> <action> the AMF shall then integrity protect and cipher the REGISTRATION ACCEPT message using the security context based on K' </action> and <action> take the mapped 5G NAS security context into use. </action> </control>
NOTE 5: In above bullet b), it is recommended for the AMF to initiate a security mode control procedure to take the corresponding native 5G NAS security context into use.
<control> <condition> <condition> If the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message, </condition> and <condition> if: a) the UE has a valid aerial UE subscription information; </condition> and <condition> b) the UUAA procedure is to be performed during the registration procedure according to operator policy; </condition> and c) <condition> there is no valid successful UUAA result for the UE in the UE 5GMM context, </condition> </condition> <action> then the AMF shall initiate the UUAA-MM procedure with the UAS-NF as specified in TS 23.256 </action> and <action> shall include a service-level-AA pending indication in the Service-level-AA container IE of the REGISTRATION ACCEPT message. </action> <action> The AMF shall store in the UE 5GMM context that a UUAA procedure is pending. </action> <action> The AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <condition> <condition> If the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message, </condition> and <condition> if: a) the UE has a valid aerial UE subscription information; </condition> b) <condition> the UUAA procedure is to be performed during the registration procedure according to operator policy; </condition> and c) <condition> there is a valid successful UUAA result for the UE in the UE 5GMM context, </condition> </condition> <action> then the AMF shall include a service-level-AA response in the Service-level-AA container IE of the REGISTRATION ACCEPT message </action> and <action> set the SLAR field in the service-level-AA response to "Service level authentication and authorization was successful". </action> </control>
<control> <condition> If the AMF determines that the UUAA-MM procedure needs to be performed for a UE, </condition> <condition> the AMF has not received the service -level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message from the UE </condition> and <condition> the AMF decides to accept the UE to be registered for other services than UAS services based on the user's subscription data and the operator policy, </condition> <action> the AMF shall accept the registration update request </action> and <action> shall mark in the UE's 5GMM context that the UE is not allowed to request UAS services. </action> </control>
<control> <condition> If the UE supports MINT, </condition> <action> the AMF may include the List of PLMNs to be used in disaster condition IE in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the UE supports MINT, </condition> <action> the AMF may include the Disaster roaming wait range IE in the REGISTRATION ACCEPT </action> </control>
<control> <condition> If the UE supports MINT, </condition> <action> the AMF may include the Disaster return wait range IE in the REGISTRATION ACCEPT </action> </control>
NOTE 6: The AMF can determine the content of the "list of PLMN(s) to be used in disaster condition", the value of the disaster roaming wait range and the value of the disaster return wait range based on the network local
<control> <condition> If the AMF received the list of TAIs from the satellite NG-RAN as described in 3GPP TS 23.501, </condition> and <condition> determines that any but not all TAIs in the received list of TAIs is forbidden for roaming or for regional provision of service as per information from the UDM and operator's choice, </condition> the AMF shall include the TAI(s) in: </control>
<control> <action> a) the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for roaming" IE; </action> or </control>
<control> b) <action> the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for regional provision of service" IE; </action> or </control>
<control> c) <action> both; in the REGISTRATION ACCEPT message. </action> </control>
NOTE 7a: "5GS forbidden tracking areas for roaming" corresponds to cause values #13 and #15, and "5GS forbidden tracking areas for regional provision of service" corresponds cause value #12.
<control> <condition> Upon receipt of the REGISTRATION ACCEPT message, </condition> <action> the UE shall reset the registration attempt counter </action> and <action> service request attempt counter, </action> <end_state> enter state 5GMM-REGISTERED </end_state> and <action> set the 5GS update status to 5U1 UPDATED. </action> </control>
<control> <condition> If the UE receives the REGISTRATION ACCEPT message from a PLMN, </condition> <action> then the UE shall reset the PLMN-specific attempt counter for that PLMN for the specific access type for which the message was received. </action> <action> The UE shall also reset the PLMN-specific N1 mode attempt counter for that PLMN for the specific access type for which the message was received. </action> </control> <control> <condition> If the message was received via 3GPP access, </condition> <action> the UE shall reset the counter for "SIM/USIM considered invalid for GPRS services" events and the counter for "SIM/USIM considered invalid for non-GPRS services", if any. </action> <condition> If the message was received via non-3GPP access, </condition> <action> the UE shall reset the counter for "USIM considered invalid for 5GS services over non-3GPP" events. </action> </control>
<control> <condition> If the UE receives the REGISTRATION ACCEPT message from an SNPN, </condition> <action> then the UE shall reset the SNPN-specific attempt counter for the current SNPN for the specific access type for which the message was received. </action> </control> <control> <condition> If the message was received via 3GPP access, </condition> <action> the UE shall reset the counter for "the entry for the current SNPN considered invalid for 3GPP access" events. </action> </control> <control> <condition> If the message was received via non-3GPP access, </condition> <action> the UE shall reset the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message included a T3512 value IE, </condition> <action> the UE shall use the value in T3512 value IE as periodic registration update timer (T3512). </action> </control> <control> <condition> If the T3512 value IE is not included, </condition> <action> the UE shall use the value currently stored, e.g. from a prior REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message include a T3324 value IE, </condition> <action> the UE shall use the value in the T3324 value IE as active time timer (T3324). </action> </control> <control> <condition> If the REGISTRATION ACCEPT message does not include a T3324 value IE, </condition> <action> UE shall not start the timer T3324 until a new value is received from the network. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message included a non-3GPP de-registration timer value IE, </condition> <action> the UE shall use the value in non-3GPP de-registration timer value IE as non-3GPP de-registration timer. </action> </control> <control> <condition> If non-3GPP de-registration timer value IE is not included, </condition> <action> the UE shall use the value currently stored, e.g. from a prior REGISTRATION ACCEPT message. </action> </control> <control> <condition> <condition> If non-3GPP de-registration timer value IE is not included </condition> and <condition> there is no stored non-3GPP de-registration timer value in the UE, </condition> </condition> <action> the UE shall use the default value of the non-3GPP de-registration timer. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains a 5G-GUTI, </condition> <action> the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the received 5G-GUTI, </action> <action> stop timer T3519 if running, </action> and <action> delete any stored SUCI. </action> </control>
<control> <action> The UE shall provide the 5G-GUTI to the lower layer of 3GPP access </action> <condition> if the REGISTRATION ACCEPT message is sent over the non-3GPP access, </condition> and <condition> the UE is in 5GMM-REGISTERED in both 3GPP access and non-3GPP access in the same PLMN. </condition> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to "Network slicing subscription changed", </condition> or <condition> contains a Configured NSSAI IE with a new configured NSSAI for the current PLMN or SNPN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN or SNPN, </condition> or <condition> contains an NSSRG information IE with a new NSSRG information, </condition> <action> the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the successful update of the network slicing information. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains the CAG information list IE </condition> or <condition> the Extended CAG information list IE and the UE had set the CAG bit to "CAG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> the UE shall: </control>
<control> <action> a) replace the "CAG information list" stored in the UE with the received CAG information list IE or the Extended CAG information list IE </action> <condition> when received in the HPLMN or EHPLMN; </condition> </control>
<control> b) <action> replace the serving VPLMN's entry of the "CAG information list" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE </action> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; </condition> or NOTE 7: When the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored. </control>
<control> c) <action> remove the serving VPLMN's entry of the "CAG information list" stored in the UE </action> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry. </condition> </control>
The UE shall store the "CAG information list" received in the CAG information list IE or the Extended CAG information list IE as specified in annex C.
<control> <condition> If the received "CAG information list" includes an entry containing the identity of the registered PLMN, </condition> <action> the UE shall operate as follows. </action> </control>
<control> <condition> a) if the UE receives the REGISTRATION ACCEPT message via a CAG cell, </condition> <condition> the entry for the registered PLMN in the received "CAG information list" does not include any of the CAG-ID(s) supported by the current CAG cell, </condition> and: </control>
<control> 1) <condition> the entry for the registered PLMN in the received "CAG information list" does not include an "indication that the UE is only allowed to access 5GS via CAG cells", </condition> <end_state> then the UE shall enter the state 5GMM- REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list"; </action> </control> or
<control> 2) <condition> the entry for the registered PLMN in the received "CAG information list" includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> and: </control>
<control> <condition> i) if the entry for the registered PLMN in the received "CAG information list" includes one or more CAG- IDs, </condition> <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 with the updated "CAG information list"; </action> </control> or
<control> ii) <condition> if the entry for the registered PLMN in the received "CAG information list" does not include any CAG-ID </condition> and: </control>
<control> <condition> a) the UE does not have an emergency PDU session, </condition> <end_state> then the UE shall enter the state 5GMM- REGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list"; </action> </control> or <control> <condition> b) the UE has an emergency PDU session, </condition> <action> then the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session </action> and <end_state> enter the state 5GMM- REGISTERED.LIMITED-SERVICE; </end_state> </control> or
<control> <condition> b) <condition> if the UE receives the REGISTRATION ACCEPT message via a non-CAG cell </condition> and <condition> the entry for the registered PLMN in the received "CAG information list" includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> and: </condition> </control>
<control> 1) <condition> if the "allowed CAG list" for the registered PLMN in the received "CAG information list" includes one or more CAG-IDs, </condition> <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 with the updated "CAG information list"; </action> </control> or
<control> 2) <condition> if the entry for the registered PLMN in the received "CAG information list" does not include any CAG-ID </condition> and: </control>
<control> <condition> i) the UE does not have an emergency PDU session, </condition> <end_state> then the UE shall enter the state 5GMM- REGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS23.122 with the updated "CAG information list"; </action> or </control>
<control> ii) <condition> the UE has an emergency PDU session, </condition> <action> then the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session </action> and <end_state> enter the state 5GMM- REGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> <condition> If the received "CAG information list" does not include an entry containing the identity of the registered PLMN </condition> and <condition> the UE receives the REGISTRATION ACCEPT message via a CAG cell, </condition> </condition> <end_state> the UE shall enter the state 5GMM- REGISTERED. LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list". </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains the Operator-defined access category definitions IE, the Extended emergency number list IE, the CAG information list IE or the Extended CAG information list IE, </condition> <action> the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the operator-defined access category definitions or the extended local emergency numbers list or the CAG information list. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains the UE radio capability ID IE or the UE radio capability ID deletion indication IE, </condition> <action> the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the UE radio capability ID IE or the UE radio capability ID deletion indication IE. </action> </control>
<control> <condition> If the T3448 value IE is present in the received REGISTRATION ACCEPT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> the UE shall: </control>
<control> <action> a) stop timer T3448 if it is running; </action> and </control>
<control> b) <action> start timer T3448 with the value provided in the T3448 value IE. </action> </control>
<control> <condition> If the UE is using 5GS services with control plane CIoT 5GS optimization, </condition> <action> the T3448 value IE is present in the REGISTRATION ACCEPT message </action> and <action> the value indicates that this timer is either zero or deactivated, </action> <action> the UE shall ignore the T3448 value IE and proceed as if the T3448 value IE was not present. </action> </control>
<control> <condition> If the UE in 5GMM-IDLE mode initiated the registration procedure for mobility and periodic registration update </condition> and <condition> the REGISTRATION ACCEPT message does not include the T3448 value IE </condition> and <condition> if timer T3448 is running, </condition> <action> then the UE shall stop timer T3448. </action> </control>
<control> <condition> Upon receiving a REGISTRATION COMPLETE message, </condition> <action> the AMF shall stop timer T3550 and change to state 5GMM-REGISTERED. </action> <condition> The 5G-GUTI, if sent in the REGISTRATION ACCEPT message, </condition> <action> shall be considered as valid, </action> and <condition> the UE radio capability ID, if sent in the REGISTRATION ACCEPT message, </condition> <action> shall be considered as valid. </action> </control>
<control> <condition> If the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to "SMS over NAS supported" </condition> and: </control>
<control> <condition> a) the SMSF address is stored in the UE 5GMM context </condition> and: </control>
<control> 1) <condition> the UE is considered available for SMS over NAS; </condition> or </control>
<control> 2) <condition> the UE is considered not available for SMS over NAS and the SMSF has confirmed that the activation of the SMS service is successful; </condition> or </control>
<control> <condition> b) the SMSF address is not stored in the UE 5GMM context, </condition> <condition> the SMSF selection is successful </condition> and <condition> the SMSF has confirmed that the activation of the SMS service is successful; </condition> <action> then the AMF shall set the SMS allowed bit of the 5GS registration result IE in the REGISTRATION ACCEPT message as specified in subclause 5.5.1.2.4. </action> </control> <control> <condition> If the UE 5GMM context does not contain an SMSF address </condition> or <condition> the UE is not considered available for SMS over NAS, </condition> then the AMF shall: </control>
<control> <action> a) store the SMSF address in the UE 5GMM context </action> <condition> if not stored already; </condition> and </control>
<control> b) <action> store the value of the SMS allowed bit of the 5GS registration result IE in the UE 5GMM context </action> and <action> consider the UE available for SMS over NAS. </action> </control>
<control> <condition> If SMSF selection in the AMF or SMS activation via the SMSF is not successful, </condition> or <condition> the AMF does not allow the use of SMS over NAS, </condition> <action> then the AMF shall set the SMS allowed bit of the 5GS registration result IE to "SMS over NAS not allowed" in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to "SMS over NAS not supported" or the 5GS update type IE was not included in the REGISTRATION REQUEST message, </condition> then the AMF shall: </control>
<control> <action> a) mark the 5GMM context to indicate that the UE is not available for SMS over NAS; </action> and NOTE 8: The AMF can notify the SMSF that the UE is deregistered from SMS over NAS based on local </control>
<control> b) <action> set the SMS allowed bit of the 5GS registration result IE to "SMS over NAS not allowed" in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> When the UE receives the REGISTRATION ACCEPT message, </condition> <condition> if the UE is also registered over another access to the same PLMN, </condition> </condition> <action> the UE considers the value indicated by the SMS allowed bit of the 5GS registration result IE as applicable for both accesses over which the UE is registered. </action> </control>
<control> <condition> If the 5GS update type IE was included in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to "UE radio capability update needed", </condition> <action> the AMF shall delete the stored UE radio capability information or the UE radio capability ID, if any. </action> </control>
<control> <action> The AMF shall include the 5GS registration result IE in the REGISTRATION ACCEPT message. </action> <condition> If the 5GS registration result IE value indicates: </condition> </control>
<control> <condition> a) "3GPP access", </condition> <action> the UE: a) shall consider itself as being registered to 3GPP access only; </action> and b) <condition> if in 5GMM-REGISTERED state over non-3GPP access and on the same PLMN as 3GPP access, </condition> <end_state> shall enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over non-3GPP access </end_state> and <action> set the 5GS update status to 5U2 NOT UPDATED over non-3GPP access; </action> </control>
<control> <condition> b) "Non-3GPP access", </condition> <action> the UE: a) shall consider itself as being registered to non-3GPP access only; </action> and b) <condition> if in the 5GMM-REGISTERED state over 3GPP access </condition> and <condition> is on the same PLMN as non-3GPP access, </condition> <end_state> shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over 3GPP access </end_state> and <action> set the 5GS update status to 5U2 NOT UPDATED over 3GPP access; </action> </control> or
<control> <condition> c) "3GPP access and Non-3GPP access", </condition> <action> the UE shall consider itself as being registered to both 3GPP access and non-3GPP access. </action> </control>
<control> <condition> If the UE is not currently registered for emergency services </condition> and <condition> the 5GS registration result IE value in the REGISTRATION ACCEPT message is set to "Registered for emergency services", </condition> <action> the UE shall consider itself registered for emergency services and shall locally release all non-emergency PDU sessions, if any. </action> </control>
<control> <action> The AMF shall include the allowed NSSAI for the current PLMN or SNPN </action> and <action> shall include the mapped S-NSSAI(s) for the allowed NSSAI contained in the requested NSSAI (i.e. Requested NSSAI IE or Requested mapped NSSAI IE) from the UE if available, </action> <condition> in the REGISTRATION ACCEPT message if the UE included the requested NSSAI in the REGISTRATION REQUEST message </condition> and <action> the AMF allows one or more S-NSSAIs for the current PLMN or SNPN in the Requested NSSAI IE or one or more mapped S-NSSAIs in the Requested NSSAI IE or Requested mapped NSSAI IE. </action> <action> The S-NSSAI associated with each of the active PDN connections for which interworking to 5GS is supported, shall be included in the allowed NSSAI </action> <condition> if the UE included the UE status IE with the EMM registration status set to "UE is in EMM-REGISTERED state" in the REGISTRATION REQUEST message </condition> and <condition> the AMF supports N26 interface. </condition> </control>
<control> <action> The AMF may also include rejected NSSAI in the REGISTRATION ACCEPT message </action> <condition> if the UE is not registered for onboarding services in SNPN. </condition> </control> <control> <condition> If the UE has set the ER-NSSAI bit to "Extended rejected NSSAI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> , <action> the rejected NSSAI shall be included in the Extended rejected NSSAI IE in the REGISTRATION ACCEPT message; </action> </control> <control> <condition> otherwise </condition> <action> the rejected NSSAI shall be included in the Rejected NSSAI IE in the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If the UE is registered for onboarding services in SNPN, </condition> <action> the AMF shall not include rejected NSSAI in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the UE has set the ER-NSSAI bit to "Extended rejected NSSAI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> <action> the rejected NSSAI contains S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with rejection cause(s); </action> </control> <control> <condition> otherwise </condition> <action> the rejected NSSAI contains S- NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with rejection cause(s) with the following restrictions: </action> </control>
a) rejected NSSAI for the current PLMN or SNPN shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are not allowed; and
b) rejected NSSAI for the current registration area shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are not allowed;
NOTE 9: The UE that does not support extended rejected NSSAI can avoid requesting an S-NSSAI associated with a mapped S-NSSAI, which was included in the previous requested NSSAI but neither in the allowed NSSAI nor in the rejected NSSAI in the consequent registration procedures.
<control> <condition> If the UE indicated the support for network slice-specific authentication and authorization, </condition> and <condition> if the requested NSSAI (i.e. the Requested NSSAI IE or the Requested mapped NSSAI IE) includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, </condition> <action> the AMF shall in the REGISTRATION ACCEPT message include: </action> </control>
<control> <action> a) the allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s), </action> <condition> if any: </condition> </control>
<control> <condition> i) which are not subject to network slice-specific authentication and authorization and are allowed by the AMF; </condition> </control> or
<control> ii) <condition> for which the network slice-specific authentication and authorization has been successfully performed; </condition> </control>
<control> c) <action> pending NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization (except for re-NSSAA) will be performed or is ongoing, </action> and <action> one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing, if any; </action> and </control>
<control> d) <action> the "NSSAA to be performed" indicator in the 5GS registration result IE set to indicate that the network slice- specific authentication and authorization procedure will be performed by the network, </action> <condition> if the allowed NSSAI is not included in the REGISTRATION ACCEPT message. </condition> </control>
<control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> <action> the UE indicated the support for network slice-specific authentication and authorization, </action> and: </control>
<control> a) <action> the UE did not include the requested NSSAI in the REGISTRATION REQUEST message </action> or <action> none of the S- NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; </action> </control>
<control> b) <action> all default S-NSSAIs are subject to network slice-specific authentication and authorization; </action> and </control>
<control> c) <action> the network slice-specific authentication and authorization procedure has not been successfully performed for any of the default S-NSSAIs, </action> <action> the AMF shall in the REGISTRATION ACCEPT message include: </action> </control>
<control> <action> a) the "NSSAA to be performed" indicator in the 5GS registration result IE to indicate that the network slice- specific authentication and authorization procedure will be performed by the network; </action> and </control>
<control> b) <action> pending NSSAI containing one or more default S-NSSAIs for which network slice-specific authentication and authorization will be performed or is ongoing </action> and <action> one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing (if any); </action> </control> and
<control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> <condition> the UE indicated the support for network slice-specific authentication and authorization, </condition> and: </control>
<control> <condition> a) the UE did not include the requested NSSAI in the REGISTRATION REQUEST message </condition> or <condition> none of the S- NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; </condition> and </control>
<control> <condition> b) one or more default S-NSSAIs are not subject to network slice-specific authentication and authorization </condition> or <condition> the network slice-specific authentication and authorization procedure has been successfully performed for one or more default S-NSSAIs; </condition> <action> the AMF shall in the REGISTRATION ACCEPT message include: </action> </control>
<control> <action> a) pending NSSAI containing one or more default S-NSSAIs for which network slice-specific authentication </action> and <action> authorization will be performed or is ongoing (if any) and one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing (if any); </action> </control>
<control> b) <action> allowed NSSAI containing S-NSSAI(s) for the current PLMN or SNPN each of which corresponds to a default S-NSSAI which are not subject to network slice-specific authentication and authorization </action> or <action> for which the network slice-specific authentication and authorization has been successfully performed; </action> </control>
<control> c) <action> allowed NSSAI containing one or more default S-NSSAIs, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed; </action> </control> and
<control> <condition> If the UE did not include the requested NSSAI in the REGISTRATION REQUEST message </condition> or <condition> none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed, </condition> <action> the allowed NSSAI shall not contain default S-NSSAI(s) that are subject to NSAC. </action> </control> <control> <condition> If the subscription information includes the NSSRG information, </condition> <action> the S- NSSAIs of the allowed NSSAI shall be associated with at least one common NSSRG value. </action> </control>
<control> <condition> If the UE supports extended rejected NSSAI </condition> and <condition> the AMF determines that maximum number of UEs reached for all S- NSSAIs in the requested NSSAI as specified in subclause 4.6.2.5, </condition> <action> the AMF shall include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause "S-NSSAI not available due to maximum number of UEs reached" in the Extended rejected NSSAI IE in the REGISTRATION ACCEPT message. </action> <action> In addition, the AMF may include a back- off timer value for each S-NSSAI with the rejection cause "S-NSSAI not available due to maximum number of UEs reached" included in the Extended rejected NSSAI IE of the REGISTRATION ACCEPT message. </action> </control> <control> <condition> To avoid that large numbers of UEs simultaneously initiate deferred requests, </condition> <action> the network should select the value for the backoff timer for each S-NSSAI for the informed UEs so that timeouts are not synchronised. </action> </control>
<control> <condition> <condition> If the UE does not indicate support for extended rejected NSSAI </condition> and <condition> the maximum number of UEs has been reached, </condition> </condition> <action> the AMF should include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause "S-NSSAI not available in the current registration area" in the Rejected NSSAI IE </action> and <action> should not include these S-NSSAIs in the allowed NSSAI in the REGISTRATION ACCEPT message. </action> </control>
NOTE 10: Based on network policies, the AMF can include the S-NSSAI(s) for which the maximum number of UEs has been reached in the rejected NSSAI with rejection causes other than "S-NSSAI not available in the current registration area".
<control> <action> The AMF may include a new configured NSSAI for the current PLMN or SNPN in the REGISTRATION ACCEPT message </action> if: </control>
<control> <condition> a) the REGISTRATION REQUEST message did not include a requested NSSAI </condition> and <condition> the UE is not registered for onboarding services in SNPN; </condition> </control>
<control> <condition> b) the REGISTRATION REQUEST message included a requested NSSAI containing an S-NSSAI that is not valid in the serving PLMN or SNPN; </condition> </control>
<control> <condition> c) the REGISTRATION REQUEST message included a requested NSSAI containing an S-NSSAI with incorrect mapped S-NSSAI(s); </condition> </control>
<control> <condition> d) the REGISTRATION REQUEST message included the Network slicing indication IE with the Default configured NSSAI indication bit set to "Requested NSSAI created from default configured NSSAI"; </condition> </control>
<control> <condition> e) the REGISTRATION REQUEST message included the requested mapped NSSAI; </condition> </control>
<control> <condition> f) the S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message are not associated with any common NSSRG value, except for the case that the AMF, based on the indication received from the UDM as specified in 3GPP TS 23.50, has provided all subscribed S-NSSAIs in the configured NSSAI to a UE who does not support NSSRG; </condition> </control> or NOTE 11: If the S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message are not associated with any common NSSRG value, it is possible that at least one of the S-NSSAIs is not included in any of new allowed NSSAI, new (extended) rejected NSSAI (if applicable), and new pending NSSAI (if applicable).
<control> <condition> g) <condition> the S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message over the current access </condition> and <condition> the allowed NSSAI over the other access are not associated with any common NSSRG value. </condition> </condition> </control>
<control> <condition> If a new configured NSSAI for the current PLMN or SNPN is included, </condition> <action> the AMF shall also include the mapped S- NSSAI(s) for the configured NSSAI for the current PLMN or SNPN </action> <condition> if available in the REGISTRATION ACCEPT message. </condition> <action> In this case the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <condition> If a new configured NSSAI for the current PLMN or SNPN is included, </condition> <condition> the subscription information includes the NSSRG information, </condition> and <condition> the NSSRG bit in the 5GMM capability IE of the REGISTRATION REQUEST message is set to: </condition> </control>
<control> <condition> a) "NSSRG supported", </condition> <action> then the AMF shall include the NSSRG information in the REGISTRATION ACCEPT message; </action> or </control>
<control> <condition> b) "NSSRG not supported", </condition> <action> then the configured NSSAI shall include S-NSSAIs each of which is associated with all the NSSRG value(s) of the default S-NSSAI(s), </action> or <action> the configured NSSAI shall include, based on the indication received from the UDM as specified in 3GPP TS 23.501 , all subscribed S-NSSAIs even if these S-NSSAIs do not share any common NSSRG value. </action> </control>
<control> <condition> If the AMF needs to update the NSSRG information </condition> and <condition> the UE has set the NSSRG bit to "NSSRG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> <action> then the AMF shall include the new NSSRG information in the REGISTRATION ACCEPT message. </action> <action> In addition, the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <action> The AMF shall include the Network slicing indication IE with the Network slicing subscription change indication set to "Network slicing subscription changed" in the REGISTRATION ACCEPT message </action> <condition> if the UDM has indicated that the subscription data for network slicing has changed. </condition> <action> In this case the AMF shall start timer T3550 </action> and <end_state> enter state 5GMM- COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3. </end_state> </control>
<control> <condition> If the S-NSSAI(s) associated with the existing PDU session(s) of the UE is not included in the requested NSSAI (i.e. Requested NSSAI IE or Requested mapped NSSAI IE) of the REGISTRATION REQUEST message, </condition> <action> the AMF shall perform a local release of the PDU session(s) associated with the S-NSSAI(s) except for a PDU session associated with DNN and S-NSSAI in the AMF onboarding configuration data </action> and <action> shall request the SMF to perform a local release of those PDU session(s). </action> </control>
<control> <condition> The UE that has indicated the support for network slice-specific authentication and authorization receiving the pending NSSAI in the REGISTRATION ACCEPT message </condition> <action> shall store the S-NSSAI(s) in the pending NSSAI as specified in subclause 4.6.2.2. </action> </control> <control> <condition> If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, </condition> <action> the UE shall store the received pending NSSAI for each of the equivalent PLMNs as specified in subclause 4.6.2.2. </action> </control> <control> <condition> <condition> If the pending NSSAI is not included in the REGISTRATION ACCEPT message </condition> and <condition> the "NSSAA to be performed" indicator is not set to "Network slice-specific authentication </condition> and <condition> authorization is to be performed" in the 5GS registration result IE of the REGISTRATION ACCEPT message, </condition> </condition> <action> then the UE shall delete the pending NSSAI for the current PLMN or SNPN and its equivalent PLMN(s), if existing, as specified in subclause 4.6.2.2. </action> </control>
<control> <condition> The UE receiving the rejected NSSAI in the REGISTRATION ACCEPT message </condition> <action> takes the following actions based on the rejection cause in the rejected S-NSSAI(s): </action> <condition> "S-NSSAI not available in the current PLMN or SNPN" </condition> <action> The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI(s) in the current PLMN or SNPN </action> <condition> <condition> until switching off the UE, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S-NSSAI(s) are removed or deleted as described in subclause 4.6.2.2. </condition> </condition> </control>
<control> <condition> "S-NSSAI not available in the current registration area" </condition> </control>
<control> <action> The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI(s) in the current registration area </action> <condition> <condition> until switching off the UE, </condition> <condition> the UE moving out of the current registration area, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S- NSSAI(s) are removed or deleted as described in subclause 4.6.2.2. </condition> </condition> </control>
<control> <condition> "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization" </condition> </control>
<control> <action> The UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access </action> <condition> <condition> until switching off the UE, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S-NSSAI(s) are removed or deleted as described in subclause 4.6.1 and 4.6.2.2. </condition> </condition> </control>
<control> <condition> "S-NSSAI not available due to maximum number of UEs reached" </condition> </control>
<control> <condition> Unless the back-off timer value received along with the S-NSSAI is zero, </condition> <action> the UE shall add the rejected S- NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI in the current PLMN over the current access </action> <condition> <condition> until switching off the UE, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </condition> </condition> </control>
NOTE 12: If the back-off timer value received along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached is zero as specified in subclause 10.5.7.4a of TS 24.008, the UE does not consider the S-NSSAI as the rejected S-NSSAI.
<control> <condition> If there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause "S-NSSAI not available due to maximum number of UEs reached", </condition> <action> then for each S-NSSAI, the UE shall behave as follows: </action> </control>
<control> <action> a) stop the timer T3526 associated with the S-NSSAI, if running; </action> </control>
<control> b) <action> start the timer T3526 with: </action> </control>
<control> <action> 1) the back-off timer value received along with the S-NSSAI, </action> <condition> if a back-off timer value is received along with the S-NSSAI that is neither zero nor deactivated; </condition> or </control>
<control> 2) <action> an implementation specific back-off timer value, </action> <condition> if no back-off timer value is received along with the S- NSSAI; </condition> and </control>
<control> c) <action> remove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached </action> <condition> when the timer T3526 associated with the S-NSSAI expires. </condition> </control>
<control> <condition> If the UE sets the NSSAA bit in the 5GMM capability IE to "Network slice-specific authentication and authorization not supported", </condition> and: </control>
<control> <condition> a) if the Requested NSSAI IE only includes the S-NSSAI(s) subject to network slice-specific authentication and authorization </condition> and <condition> one or more default S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S-NSSAI) which are not subject to network slice-specific authentication and authorization are available, </condition> <action> the AMF shall in the REGISTRATION ACCEPT message include: </action> </control>
<control> <action> 1) the allowed NSSAI containing S-NSSAI(s) for the current PLMN or SNPN each of which corresponds to a default S-NSSAI which are not subject to network slice-specific authentication and authorization; </action> </control>
<control> 2) <action> the allowed NSSAI containing the default S-NSSAIs, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization; </action> and </control>
<control> 3) <action> the rejected NSSAI containing the S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating "S-NSSAI not available in the current PLMN or SNPN", </action> <condition> except if the UE has not set the ER-NSSAI bit to "Extended rejected NSSAI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message and the S-NSSAI(s) is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are subject to NSSAA; </condition> or </control>
<control> <condition> b) if the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, </condition> <action> the AMF shall in the REGISTRATION ACCEPT message include: </action> </control>
<control> <action> 1) the allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s) which are not subject to network slice-specific authentication and authorization; </action> and </control>
<control> 2) <action> the rejected NSSAI containing: </action> </control>
<control> <action> i) the S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating "S-NSSAI not available in the current PLMN or SNPN", </action> <condition> <condition> except if the UE has not set the ER- NSSAI bit to "Extended rejected NSSAI supported" in the 5GMM capability IE of the REGISTRATION REQUEST message </condition> and <condition> the S-NSSAI(s) is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are subject to NSSAA; </condition> and </condition> </control>
<control> <condition> ii) <condition> the S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with the rejection cause indicating "S-NSSAI not available in the current PLMN or SNPN" </condition> or <condition> the rejection cause indicating "S-NSSAI not available in the current registration area", if any. </condition> </condition> </control>
<control> <condition> <condition> For a REGISTRATION REQUEST message with a 5GS registration type IE indicating "mobility registration updating", </condition> <condition> if the UE does not indicate support for network slice-specific authentication and authorization, </condition> <condition> the UE is not registered for onboarding services in SNPN, </condition> and: </condition> </control>
<control> <condition> a) the UE is not in NB-N1 mode; </condition> and </control>
<control> 1) <condition> the UE did not include the requested NSSAI in the REGISTRATION REQUEST message; </condition> or </control>
<control> <condition> 2) <condition> none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; </condition> and <condition> one or more default S-NSSAIs which are not subject to network slice-specific authentication and authorization are available, </condition> </condition> the AMF shall: </control>
<control> <action> a) put the allowed S-NSSAI(s) for the current PLMN or SNPN each of which corresponds to a default S-NSSAI and not subject to network slice-specific authentication and authorization in the allowed NSSAI of the REGISTRATION ACCEPT message; </action> </control>
<control> b) <action> put the default S-NSSAIs and not subject to network slice-specific authentication and authorization, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, in the allowed NSSAI of the REGISTRATION ACCEPT message; </action> and </control>
<control> c) <action> determine a registration area such that all S-NSSAIs of the allowed NSSAI are available in the registration </action> </control>
<control> <condition> During a registration procedure for mobility and periodic registration update for which the 5GS registration type IE indicates: </condition> </control>
<control> <condition> b) "mobility registration updating" </condition> and <condition> the UE is in NB-N1 mode; </condition> and <condition> the UE is not registered for onboarding services in SNPN, </condition> the AMF: </control>
<control> <action> a) may provide a new allowed NSSAI to the UE; </action> </control>
<control> b) <action> shall provide a pending NSSAI to the UE </action> <condition> <condition> if the UE has indicated the support for network slice-specific authentication and authorization </condition> and <condition> there are S-NSSAIs for which network slice-specific authentication and authorization (except for re-NSSAA) will be performed or is ongoing for the current PLMN or SNPN; </condition> </condition> or </control>
<control> c) <action> may provide both a new allowed NSSAI and a pending NSSAI to the UE; in the REGISTRATION ACCEPT message. </action> <condition> Additionally, if a pending NSSAI is provided without an allowed NSSAI and no S-NSSAI is currently allowed for the UE, </condition> <action> the REGISTRATION ACCEPT message shall include the 5GS registration result IE with the "NSSAA to be performed" indicator set to "Network slice-specific authentication and authorization is to be performed". </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to "Network slicing subscription changed", </condition> <action> the UE shall delete the network slicing information for each and every PLMN except for the current PLMN as specified in subclause 4.6.2.2. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains the allowed NSSAI, </condition> <action> then the UE shall store the included allowed NSSAI together with the PLMN identity of the registered PLMN or the SNPN identity of the registered SNPN and the registration area as specified in subclause 4.6.2.2. </action> </control> <control> <condition> If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, </condition> <action> the UE shall store the received allowed NSSAI in each of allowed NSSAIs which are associated with each of the PLMNs. </action> </control>
<control> <condition> For each of the PDU session(s) active in the UE: </condition> <condition> a) if the allowed NSSAI contains an HPLMN S-NSSAI (e.g. mapped S-NSSAI, if available) matching to the HPLMN S-NSSAI of the PDU session, </condition> <action> the UE shall locally update the S-NSSAI associated with the PDU session to the corresponding S-NSSAI received in the allowed NSSAI; </action> and b) <condition> if the allowed NSSAI does not contain an HPLMN S-NSSAI (e.g. mapped S-NSSAI, if available) matching to the HPLMN S-NSSAI of the PDU session, </condition> <action> the UE may perform a local release of the PDU session except for an emergency PDU session, if any, and except for a PDU session established when the UE is registered for onboarding services in SNPN, if any. </action> </control>
NOTE 13: According to 3GPP TS 23.501 , also the AMF will determine which PDU sessions can no longer be supported based on the new allowed NSSAI, and it will cause a release on the UE side either by indicating in the PDU session status IE which PDU sessions are inactive on the network side or by triggering the SMF to initiate a release via 5GSM signalling.
<control> <condition> <condition> If the REGISTRATION ACCEPT message contains a configured NSSAI IE with a new configured NSSAI for the current PLMN or SNPN </condition> and <condition> optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN or SNPN, </condition> </condition> <action> the UE shall store the contents of the configured NSSAI IE as specified in subclause 4.6.2.2. </action> <condition> In addition, if the REGISTRATION ACCEPT message contains an NSSRG information IE, </condition> <action> the UE shall store the contents of the NSSRG information IE as specified in subclause 4.6.2.2. </action> </control>
<control> <condition> If the UE has set the NSAG bit to "NSAG supported" in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> <action> the AMF may include the NSAG information IE in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the UE receives the NSAG information IE in the REGISTRATION ACCEPT message, </condition> <action> the UE shall store the NSAG information as specified in subclause 4.6.2.2. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message: </condition> </control>
<control> <condition> a) includes the 5GS registration result IE with the "NSSAA to be performed" indicator set to "Network slice- specific authentication and authorization is to be performed"; </condition> </control>
<control> <condition> b) includes a pending NSSAI; </condition> and </control>
<control> <condition> c) does not include an allowed NSSAI; </condition> the UE: </control>
<control> <action> a) shall not perform the registration procedure for mobility and registration update with the Uplink data status IE except for emergency services; </action> </control>
<control> b) <action> shall not initiate a service request procedure except for emergency services, </action> </control> <control> <condition> for responding to paging or notification over non-3GPP access, </condition> <condition> for cases f), i), m) and o) in subclause 5.6.1.1; </condition> </control>
<control> c) <action> shall not initiate a 5GSM procedure except for emergency services, indicating a change of 3GPP PS data off UE status, </action> or <action> to request the release of a PDU session; </action> and </control>
<control> d) <action> shall not initiate the NAS transport procedure except for sending a CIoT user data container, SMS, an LPP message, a location services message, an SOR transparent container, a UE policy container or a UE parameters update transparent container; </action> <condition> until the UE receives an allowed NSSAI. </condition> </control>
<control> <condition> During a registration procedure for mobility and periodic registration update for which the 5GS registration type IE indicates: </condition> </control>
<control> <condition> a) "mobility registration updating" </condition> and <condition> the UE is in NB-N1 mode; </condition> or </control>
<control> <condition> b) <condition> "periodic registration updating"; </condition> <condition> if the REGISTRATION ACCEPT message includes the 5GS registration result IE with the "NSSAA to be performed" indicator not set to "Network slice-specific authentication and authorization is to be performed" </condition> and <condition> the message does not contain an allowed NSSAI and no new allowed NSSAI, </condition> </condition> <action> the UE shall consider the previously received allowed NSSAI as valid. </action> </control>
<control> <condition> During a registration procedure for mobility and periodic registration update for which the 5GS registration type IE indicates: </condition> </control>
<control> <condition> <condition> b) "periodic registration updating"; </condition> <condition> if the REGISTRATION ACCEPT message includes the 5GS registration result IE with the "NSSAA to be performed" indicator set to "Network slice-specific authentication and authorization is to be performed" </condition> and <condition> the message contains a pending NSSAI, </condition> </condition> <action> the UE shall delete any stored allowed NSSAI as specified in subclause 4.6.2.2. </action> </control>
<control> <condition> If the Uplink data status IE is included in the REGISTRATION REQUEST message: </condition> </control>
<control> <condition> a) <condition> if the AMF determines that the UE is in non-allowed area or is not in allowed area, </condition> and <condition> the PDU session(s) indicated by the Uplink data status IE is non-emergency PDU session(s) </condition> or <condition> the UE is not configured for high priority access in selected PLMN, </condition> </condition> <action> the AMF shall include the PDU session reactivation result IE in the REGISTRATION ACCEPT message indicating that user-plane resources for the corresponding PDU session(s) cannot be re-established, </action> and <action> shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #28 "Restricted service area"; </action> </control>
<control> <condition> b) otherwise, </condition> the AMF shall: </control>
<control> <action> 1) indicate the SMF to re-establish the user-plane resources for the corresponding PDU session; </action> </control>
<control> 2) <action> include PDU session reactivation result IE in the REGISTRATION ACCEPT message to indicate the user- plane resources re-establishment result of the PDU sessions for which the UE requested to re-establish the user-plane resources; </action> and </control>
<control> 3) <action> determine the UE presence in LADN service area and forward the UE presence in LADN service area towards the SMF, </action> <condition> if the corresponding PDU session is a PDU session for LADN. </condition> </control>
<control> <condition> <condition> If the Uplink data status IE is not included in the REGISTRATION REQUEST message </condition> and <condition> the REGISTRATION REQUEST message is sent for the trigger d) in subclause 5.5.1.3.2, </condition> </condition> <action> the AMF may indicate the SMF to re-establish the user-plane resources for the PDU sessions. </action> </control>
<control> <condition> If a PDU session status IE is included in the REGISTRATION REQUEST message: </condition> </control>
<control> <condition> a) for single access PDU sessions, </condition> the AMF shall: </control>
<control> <action> 1) perform a local release of all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE on the AMF side associated with the access type the REGISTRATION REQUEST message is sent over, but are indicated by the UE as being in 5GSM state PDU SESSION INACTIVE. </action> <condition> If any of those PDU sessions is associated with one or more MBS sessions, </condition> <action> the SMF shall consider the UE as removed from the associated MBS sessions; </action> and </control>
<control> 2) <action> include a PDU session status IE in the REGISTRATION ACCEPT message to indicate which PDU sessions associated with the access type the REGISTRATION ACCEPT message is sent over are not in 5GSM state PDU SESSION INACTIVE in the AMF; </action> and </control>
<control> b) <condition> for MA PDU sessions: </condition> </control>
<control> 1) <condition> for all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE and have user plane resources established on the access the REGISTRATION REQUEST message is sent over on the AMF side, but are indicated by the UE as no user plane resources established: </condition> </control>
<control> <condition> i) for PDU sessions having user plane resources established only on the access the REGISTRATION REQUEST message is sent over, </condition> <action> the AMF shall perform a local release of all those PDU sessions. </action> <condition> If the MA PDU session is associated with one or more MBS sessions, </condition> <action> the SMF shall consider the UE as removed from the associated MBS sessions; </action> </control> and
<control> ii) <condition> for PDU sessions having user plane resources established on both accesses, </condition> <action> the AMF shall perform a local release on the user plane resources associated with the access type the REGISTRATION REQUEST message is sent over. </action> <condition> If the REGISTRATION REQUEST message is sent over 3GPP access </condition> and <condition> the MA PDU session is associated with one or more MBS sessions, </condition> <action> the SMF shall consider the UE as removed from the associated MBS sessions; </action> and </control>
<control> 2) <action> the AMF shall include a PDU session status IE in the REGISTRATION ACCEPT message to indicate which MA PDU sessions having user plane resources established on the AMF side on the access the REGISTRATION ACCEPT message is sent over. </action> </control>
<control> <condition> If the Allowed PDU session status IE is included in the REGISTRATION REQUEST message, </condition> the AMF shall: </control>
<control> <condition> a) for a 5GSM message from each SMF that has indicated pending downlink signalling only, </condition> <action> forward the received 5GSM message via 3GPP access to the UE after the REGISTRATION ACCEPT message is sent; </action> </control>
<control> <condition> b) for each SMF that has indicated pending downlink data only: </condition> </control>
<control> 1) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed </action> <condition> if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE; </condition> and </control>
<control> 2) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed </action> <condition> if the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE. </condition> </control>
<control> <condition> c) for each SMF that have indicated pending downlink signalling and data: </condition> </control>
<control> 1) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed </action> <condition> if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE; </condition> </control>
<control> 2) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed </action> <condition> if the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; </condition> and </control>
<control> 3) <action> discard the received 5GSM message for PDU session(s) associated with non-3GPP access; </action> and </control>
<control> d) <action> include the PDU session reactivation result IE in the REGISTRATION ACCEPT message to indicate the successfully re-established user-plane resources for the corresponding PDU sessions, if any. </action> </control>
<control> <condition> If the PDU session reactivation result IE is included in the REGISTRATION ACCEPT message indicating that the user-plane resources have been successfully reactivated for a PDU session that was requested by the UE in the Allowed PDU session status IE, </condition> <action> the UE considers the corresponding PDU session to be associated with the 3GPP access. </action> </control> <control> <condition> If the user-plane resources of a PDU session have been successfully reactivated over the 3GPP access, </condition> <action> the AMF and SMF update the associated access type of the corresponding PDU session. </action> </control>
<control> <condition> If the PDU session reactivation result IE is included in the REGISTRATION ACCEPT message indicating that the user-plane resources cannot be established for a PDU session that was requested by the UE in the Allowed PDU session status IE, </condition> <action> the UE considers the corresponding PDU session to be associated with the non-3GPP access. </action> </control>
<control> <condition> If an EPS bearer context status IE is included in the REGISTRATION REQUEST message, </condition> <action> the AMF handles the received EPS bearer context status IE as specified in 3GPP TS 23.502. </action> </control>
<control> <condition> If the EPS bearer context status information is generated for the UE during the inter-system change from S1 mode to N1 mode as specified in 3GPP TS 23.502 </condition> and <condition> the AMF supports N26 interface, </condition> <action> the AMF shall include an EPS bearer context status IE in the REGISTRATION ACCEPT message to indicate the UE which mapped EPS bearer contexts are active in the network. </action> </control>
<control> <condition> If the user-plane resources cannot be established for a PDU session, </condition> <action> the AMF shall include the PDU session reactivation result IE in the REGISTRATION ACCEPT message indicating that user-plane resources for the corresponding PDU session cannot be re-established, </action> </control> and:
<control> <condition> a) if the user-plane resources cannot be established because the SMF indicated to the AMF that the UE is located out of the LADN service area (see 3GPP TS 29.502 ), </condition> <action> the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #43 "LADN not available"; </action> </control>
<control> <condition> b) if the user-plane resources cannot be established because the SMF indicated to the AMF that only prioritized services are allowed (see 3GPP TS 29.502 ), </condition> <action> the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #28 "restricted service area"; </action> </control>
<control> <condition> c) if the user-plane resources cannot be established because the SMF indicated to the AMF that the resource is not available in the UPF (see 3GPP TS 29.502 ), </condition> <action> the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #92 "insufficient user-plane resources for the PDU session"; </action> </control>
<control> <condition> d) if the user-plane resources cannot be established because the SMF indicated to the AMF that the S-NSSAI associated with the PDU session is unavailable due to NSAC (see 3GPP TS 29.502 ), </condition> <action> the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #69 "insufficient resources for specific slice"; </action> </control> or
<control> <condition> e) otherwise, </condition> <action> the AMF may include the PDU session reactivation result error cause IE to indicate the cause of failure to re-establish the user-plane resources. </action> </control>
NOTE 14: It is up to UE implementation when to re-send a request for user-plane re-establishment for the associated PDU session after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to #92 "insufficient user-plane resources for the PDU session".
NOTE 15: The UE can locally start a back-off timer after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to #69 "insufficient resources for specific slice". The value of the back-off timer is up to UE implementation. Upon expiry of the back-off timer, the UE can re-send a request for user- plane re-establishment for the associated PDU session.
<control> <condition> If the AMF needs to initiate PDU session status synchronization </condition> <action> the AMF shall include a PDU session status IE in the REGISTRATION ACCEPT message to indicate the UE: a) which single access PDU sessions associated with the access the REGISTRATION ACCEPT message is sent over are not in 5GSM state PDU SESSION INACTIVE in the AMF; </action> and b) <action> which MA PDU sessions are not in 5GSM state PDU SESSION INACTIVE and having user plane resources established in the AMF on the access the REGISTRATION ACCEPT message is sent over. </action> </control>
<control> <action> The AMF may include the LADN information IE in the REGISTRATION ACCEPT message as described in subclause 5.5.1.2.4. </action> <condition> The UE, upon receiving the REGISTRATION ACCEPT message with the LADN information IE, </condition> <action> shall delete its old LADN information (if any) and store the received new LADN information. </action> </control>
<control> <condition> If the AMF does not include the LADN information IE in the REGISTRATION ACCEPT message during registration procedure for mobility and registration update, </condition> <action> the UE shall delete its old LADN information. </action> </control>
<control> <condition> If the PDU session status IE is included in the REGISTRATION ACCEPT message: </condition> </control>
<control> <condition> a) for single access PDU sessions, </condition> <action> the UE shall perform a local release of all those PDU sessions associated with the access type the REGISTRATION ACCEPT message is sent over which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING on the UE side, but are indicated by the AMF as being in 5GSM state PDU SESSION INACTIVE. </action> <condition> If a locally released PDU session is associated with one or more MBS sessions, </condition> <action> the UE shall locally leave the associated MBS sessions; </action> and </control>
<control> <condition> b) for MA PDU sessions, </condition> <condition> for all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING </condition> and <condition> have user plane resources established in the UE on the access the REGISTRATION ACCEPT message is sent over, but are indicated by the AMF as no user plane resources established: </condition> </control>
<control> 1) <condition> for MA PDU sessions having user plane resources established only on the access the REGISTRATION ACCEPT message is sent over, </condition> <action> the UE shall perform a local release of those MA PDU sessions. </action> <condition> If a locally released MA PDU session is associated with one or more MBS sessions, </condition> <action> the UE shall locally leave the associated MBS sessions; </action> </control> and
<control> 2) <condition> for MA PDU sessions having user plane resources established on both accesses, </condition> <action> the UE shall perform a local release on the user plane resources on the access the REGISTRATION ACCEPT message is sent over. </action> </control> <control> <condition> If the user plane resources over 3GPP access are released and the MA PDU session is associated with one or more MBS sessions, </condition> <action> the UE shall locally leave the associated MBS sessions. </action> </control>
if:
<control> <condition> a) the UE included a PDU session status IE in the REGISTRATION REQUEST message; </condition> </control>
<control> <condition> b) the UE is operating in the single-registration mode; </condition> </control>
<control> <condition> c) the UE is performing inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode; </condition> and </control>
<control> <condition> d) the UE has received the IWK N26 bit set to "interworking without N26 interface supported"; </condition> <action> the UE shall ignore the PDU session status IE if received in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the EPS bearer context status IE is included in the REGISTRATION ACCEPT message, </condition> <action> the UE shall locally delete all those QoS flow descriptions and all associated QoS rules, if any, which are associated with inactive EPS bearer contexts as indicated by the AMF in the EPS bearer context status IE. </action> </control>
<control> <condition> If the UE included S1 mode supported indication in the REGISTRATION REQUEST message, </condition> <action> the AMF supporting inter-system change with EPS shall set the IWK N26 bit to either: </action> </control>
<control> <action> a) "interworking without N26 interface not supported" </action> <condition> if the AMF supports N26 interface; </condition> or </control>
<control> b) <action> "interworking without N26 interface supported" </action> <condition> if the AMF does not support N26 interface in the 5GS network feature support IE in the REGISTRATION ACCEPT message. </condition> </control>
<control> <action> The UE supporting S1 mode shall operate in the mode for inter-system interworking with EPS as follows: </action> </control>
<control> <condition> a) if the IWK N26 bit in the 5GS network feature support IE is set to "interworking without N26 interface not supported", </condition> <action> the UE shall operate in single-registration mode; </action> </control>
<control> <condition> b) if the IWK N26 bit in the 5GS network feature support IE is set to "interworking without N26 interface supported" </condition> and <condition> the UE supports dual-registration mode, </condition> <action> the UE may operate in dual-registration mode; </action> </control> or NOTE 16: The registration mode used by the UE is implementation dependent.
<control> <condition> c) if the IWK N26 bit in the 5GS network feature support IE is set to "interworking without N26 interface supported" </condition> and <condition> the UE only supports single-registration mode, </condition> <action> the UE shall operate in single-registration mode. </action> </control>
The UE shall treat the received interworking without N26 interface indicator for inter-system change with EPS as valid in the entire PLMN and its equivalent PLMN(s).
<control> The network informs the UE about the support of specific features, such as IMS voice over PS session, location services (5G-LCS), emergency services, emergency services fallback and ATSSS, in the 5GS network feature support information element. <condition> <condition> In a UE with IMS voice over PS session capability, </condition> <condition> the IMS voice over PS session indicator, </condition> </condition> <action> Emergency services support indicator and Emergency services fallback indicator shall be provided to the upper layers. </action> </control>
<control> <action> The upper layers take the IMS voice over PS session indicator into account </action> <condition> when selecting the access domain for voice sessions or calls. </condition> </control> <control> <condition> When initiating an emergency call, </condition> <action> the upper layers take the IMS voice over PS session indicator, Emergency services support indicator and Emergency services fallback indicator into account for the access domain selection. </action> </control> <control> <condition> When the UE determines via the IMS voice over PS session indicator that the network does not support IMS voice over PS sessions in N1 mode, </condition> <action> then the UE shall not perform a local release of any persistent PDU session </action> <condition> if the AMF does not indicate that the PDU session is in 5GSM state PDU SESSION INACTIVE via the PDU session status IE. </condition> </control> <control> <condition> When the UE determines via the Emergency services support indicator that the network does not support emergency services in N1 mode, </condition> <action> then the UE shall not perform a local release of any emergency PDU session </action> <condition> if user-plane resources associated with that emergency PDU session are established </condition> </control> <control> <condition> if the AMF does not indicate that the PDU session is in 5GSM state PDU SESSION INACTIVE via the PDU session status IE. </condition> <condition> In a UE with LCS capability, </condition> <action> location services indicators (5G-LCS) shall be provided to the upper layers. </action> </control> <control> <condition> In a UE with the capability for ATSSS, </condition> <action> the network support for ATSSS shall be provided to the upper layers. </action> </control> <control> <condition> If the UE receives the 5GS network feature support IE with the ATSSS support indicator set to "ATSSS not supported", </condition> <action> the UE shall perform a local release of the MA PDU session, if any. </action> </control> <control> <condition> If a locally released MA PDU session is associated with one or more MBS sessions, </condition> <action> the UE shall locally leave the associated MBS sessions. </action> </control>
<control> <action> The AMF shall set the EMF bit in the 5GS network feature support IE to: </action> </control>
<control> <action> a) "Emergency services fallback supported in NR connected to 5GCN and E-UTRA connected to 5GCN" </action> <condition> if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN or an E-UTRA cell connected to 5GCN; </condition> </control>
<control> b) <action> "Emergency services fallback supported in NR connected to 5GCN only" </action> <condition> <condition> if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN </condition> and <condition> does not support the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN; </condition> </condition> </control>
<control> c) <action> "Emergency services fallback supported in E-UTRA connected to 5GCN only" </action> <condition> <condition> if the network supports the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN </condition> and <condition> does not support the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN; </condition> </condition> or </control>
<control> d) <action> "Emergency services fallback not supported" </action> <condition> if network does not support the emergency services fallback procedure when the UE is in any cell connected to 5GCN. </condition> </control>
<control> NOTE 17: <condition> If the emergency services are supported in neither the EPS nor the 5GS homogeneously, based onoperator policy, </condition> <action> the AMF will set the EMF bit in the 5GS network feature support IE to "Emergency services fallback not supported". </action> </control>
NOTE 18: Even though the AMF's support of emergency services fallback is indicated per RAT, the UE's support of emergency services fallback is not per RAT, i.e. the UE's support of emergency services fallback is the same for both NR connected to 5GCN and E-UTRA connected to 5GCN.
<control> <condition> If the UE is not operating in SNPN access operation mode: </condition> </control>
<control> a) <action> the network informs the UE that the use of access identity 1 is valid in the RPLMN or equivalent PLMN by setting the MPS indicator bit of the 5GS network feature support IE to "Access identity 1 valid", in the REGISTRATION ACCEPT message. </action> <condition> Based on operator policy, </condition> <action> the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM; </action> </control>
<control> <condition> b) upon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to "Access identity 1 valid", </condition> <action> the UE shall act as a UE with access identity 1 configured for MPS as described in subclause 4.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. </action> </control> The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to "Access identity 1 not valid" or until the UE selects a non-equivalent PLMN. Access identity 1 is only applicable while the UE is in N1 mode;
<control> <condition> c) during ongoing active PDU sessions that were set up relying on the MPS indicator bit being set to "Access identity 1 valid", </condition> <condition> if the network indicates in a registration update that the MPS indicator bit is reset to "Access identity 1 not valid", </condition> <action> then the UE shall no longer act as a UE with access identity 1 configured for MPS as described in subclause 4.5.2 </action> <condition> unless the USIM contains a valid configuration for access identity 1 in RPLMN or equivalent PLMN. </condition> In the UE, the ongoing active PDU sessions are not affected by the change of the MPS indicator bit; </control>
<control> d) <action> the network informs the UE that the use of access identity 2 is valid in the RPLMN or equivalent PLMN by setting the MCS indicator bit of the 5GS network feature support IE to "Access identity 2 valid", in the REGISTRATION ACCEPT message. </action> <action> Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM; </action> </control>
<control> <condition> e) upon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to "Access identity 2 valid", </condition> <action> UE shall act as a UE with access identity 2 configured for MCS as described in subclause 4.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. </action> </control> The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to "Access identity 2 not valid" or until the UE selects a non-equivalent PLMN. Access identity 2 is only applicable while the UE is in N1 mode; and
<control> <condition> f) <condition> during \ongoing active PDU sessions that were set up relying on the MCS indicator bit being set to "Access identity 2 valid", </condition> <condition> if the network indicates in a registration update that the MCS indicator bit is reset to "Access identity 2 not valid", </condition> </condition> <action> then the UE shall no longer act as a UE with access identity 2 configured for MCS as described in subclause 4.5.2 unless the USIM contains a valid configuration for access identity 2 in RPLMN or equivalent PLMN. </action> </control> In the UE, the ongoing active PDU sessions are not affected by the change of the MCS indicator bit.
<control> <condition> If the UE indicates support for restriction on use of enhanced coverage in the REGISTRATION REQUEST message </condition> and: </control>
<control> <condition> a) <condition> in WB-N1 mode, </condition> <condition> the AMF decides to restrict the use of CE mode B for the UE, </condition> </condition> <action> then the AMF shall set the RestrictEC bit to "CE mode B is restricted"; </action> </control>
<control> <condition> b) <condition> in WB-N1 mode, </condition> <condition> the AMF decides to restrict the use of both CE mode A and CE mode B for the UE, </condition> </condition> <action> then the AMF shall set the RestrictEC bit to " Both CE mode A and CE mode B are restricted"; </action> </control> or
<control> <condition> c) <condition> in NB-N1 mode, </condition> <condition> the AMF decides to restrict the use of enhanced coverage for the UE, </condition> </condition> <action> then the AMF shall set the RestrictEC bit to "Use of enhanced coverage is restricted", in the 5GS network feature support IE in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the UE is operating in SNPN access operation mode: </condition> </control>
<control> a) <action> the network informs the UE that the use of access identity 1 is valid in the RSNPN by setting the MPS indicator bit of the 5GS network feature support IE to "Access identity 1 valid", </action> <condition> in the REGISTRATION ACCEPT message. </condition> <action> Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM; </action> </control>
<control> <condition> b) upon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to "Access identity 1 valid", </condition> <action> the UE shall act as a UE with access identity 1 configured for MPS as described in subclause 4.5.2A, in all NG-RAN of the registered SNPN. </action> </control> <control> The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid <condition> <condition> until the UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to "Access identity 1 not valid" </condition> or <condition> until the UE selects another SNPN. </condition> </condition> Access identity 1 is only applicable while the UE is in N1 mode; </control>
<control> <condition> c) <condition> during ongoing active PDU sessions that were set up relying on the MPS indicator bit being set to "Access identity 1 valid", </condition> <condition> if the network indicates in a registration update that the MPS indicator bit is reset to "Access identity 1 not valid", </condition> </condition> <action> then the UE shall no longer act as a UE with access identity 1 configured for MPS as described in subclause 4.5.2A </action> <condition> unless the unified access control configuration in the "list of subscriber data" stored in the ME (see 3GPP TS 23.122 ) indicates the UE is configured for access identity 1 in the RSNPN. </condition> </control> In the UE, the ongoing active PDU sessions are not affected by the change of the MPS indicator bit;
<control> d) <action> the network informs the UE that the use of access identity 2 is valid in the RSNPN by setting the MCS indicator bit of the 5GS network feature support IE to "Access identity 2 valid", </action> <condition> in the REGISTRATION ACCEPT message. </condition> </control> Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM;
<control> <condition> e) upon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to "Access identity 2 valid", </condition> <action> the UE shall act as a UE with access identity 2 configured for MCS as described in subclause 4.5.2A, in all NG-RAN of the registered SNPN. </action> </control> <control> The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid <condition> <condition> until the UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to "Access identity 2 not valid" </condition> or <condition> until the UE selects another SNPN. </condition> </condition> </control> Access identity 2 is only applicable while the UE is in N1 mode; and
<control> <condition> f) <condition> during ongoing active PDU sessions that were set up relying on the MCS indicator bit being set to "Access identity 2 valid", </condition> <condition> if the network indicates in a registration update that the MCS indicator bit is reset to "Access identity 2 not valid", </condition> </condition> <action> then the UE shall no longer act as a UE with access identity 2 configured for MCS as described in subclause 4.5.2A unless the unified access control configuration in the "list of subscriber data" stored in the ME (see 3GPP TS 23.122 ) indicates the UE is configured for access identity 2 in the RSNPN. </action> </control> In the UE, the ongoing active PDU sessions are not affected by the change of the MCS indicator bit.
<control> <condition> <condition> If the UE has set the Follow-on request indicator to "Follow-on request pending" in the REGISTRATION REQUEST message, </condition> or <condition> the network has downlink signalling pending, </condition> </condition> <action> the AMF shall not immediately release the NAS signalling connection after the completion of the registration procedure. </action> </control>
<control> <condition> If the UE is authorized to use V2X communication over PC5 reference point based on: </condition> </control>
<control> <condition> <condition> a) at least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, </condition> or <condition> already stored in the 5GMM context in the AMF during the previous registration procedure as follows: </condition> </condition> </control>
<control> <condition> 1) the V2XCEPC5 bit to "V2X communication over E-UTRA-PC5 supported"; </condition> or </control>
<control> <condition> 2) the V2XCNPC5 bit to "V2X communication over NR-PC5 supported"; </condition> and </control>
<control> <condition> b) the user's subscription context obtained from the UDM as defined in 3GPP TS 23.287 ; </condition> <action> the AMF should not immediately release the NAS signalling connection after the completion of the registration procedure. </action> </control>
<control> <condition> If the UE is authorized to use 5G ProSe services based on: </condition> </control>
<control> <condition> a) <condition> at least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, </condition> or <condition> already stored in the 5GMM context in the AMF during the previous registration procedure as follows: </condition> </condition> </control>
<control> <condition> 1) the 5G ProSe direct discovery bit to "5G ProSe direct discovery supported"; </condition> or </control>
<control> <condition> 2) the 5G ProSe direct communication bit to "5G ProSe direct communication supported"; </condition> and </control>
<control> <condition> b) the user's subscription context obtained from the UDM as defined in 3GPP TS 23.304 ; </condition> <action> the AMF should not immediately release the NAS signalling connection after the completion of the registration procesure. </action> </control>
<control> <condition> If the Requested DRX parameters IE was included in the REGISTRATION REQUEST message, </condition> <action> the AMF shall include the Negotiated DRX parameters IE in the REGISTRATION ACCEPT message. </action> <action> The AMF may set the Negotiated DRX parameters IE based on the received Requested DRX parameters IE and operator policy if available. </action> </control>
<control> <condition> If the Requested NB-N1 mode DRX parameters IE was included in the REGISTRATION REQUEST message, </condition> <action> the AMF shall include the Negotiated NB-N1 mode DRX parameters IE in the REGISTRATION ACCEPT message. </action> <action> The AMF may set the Negotiated NB-N1 mode DRX parameters IE based on the received Requested NB-N1 mode DRX parameters IE and operator policy if available. </action> </control>
<control> <action> The AMF shall include the Negotiated extended DRX parameters IE in the REGISTRATION ACCEPT message </action> <condition> <condition> only if the Requested extended DRX parameters IE was included in the REGISTRATION REQUEST message, </condition> and <condition> the AMF supports and accepts the use of eDRX. </condition> </condition> <action> The AMF may set the Negotiated extended DRX parameters IE based on the received Requested extended DRX parameters IE, operator policy, information from NG-RAN and the user's subscription context obtained from the UDM if available. </action> </control>
<control> <condition> <condition> If the UE included in the REGISTRATION REQUEST message the UE status IE with the EMM registration status set to "UE is in EMM-REGISTERED state" </condition> and <condition> the AMF does not support N26 interface, </condition> </condition> <action> the AMF shall operate as described in subclause 5.5.1.2.4. </action> </control>
<control> <condition> <condition> If the UE has indicated support for service gap control in the REGISTRATION REQUEST message, </condition> <condition> a service gap time value is available in the 5GMM context, </condition> </condition> <action> the AMF may include the T3447 value IE set to the service gap time value in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE requests ciphering keys for ciphered broadcast assistance data in the REGISTRATION REQUEST message </condition> and <condition> the AMF has valid ciphering key data applicable to the UE's subscription and current tracking area, </condition> </condition> <action> then the AMF shall include the ciphering key data in the Ciphering key data IE of the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE supports WUS assistance information </condition> and <condition> the AMF supports and accepts the use of WUS assistance information for the UE, </condition> </condition> <action> then the AMF shall determine the negotiated UE paging probability information for the UE, </action> <action> store it in the 5GMM context of the UE, </action> and <condition> if the UE does not have an active emergency PDU session, </condition> <action> the AMF shall include it in the Negotiated WUS assistance information IE in the REGISTRATION ACCEPT message. </action> <action> The AMF may consider the UE paging probability information received in the Requested WUS assistance information IE </action> <condition> when determining the negotiated UE paging probability information for the UE. </condition> </control>
NOTE 19: Besides the UE paging probability information requested by the UE, the AMF can take local configuration or previous statistical information for the UE into account when determining the negotiated UE paging probability information for the UE.
<control> <condition> <condition> If the UE sets the NR-PSSI bit to "NR paging subgrouping supported" in the 5GMM capability IE in the REGISTRATION REQUEST message </condition> and <condition> the AMF supports and accepts the use of PEIPS assistance information for the UE, </condition> </condition> <action> then the AMF shall determine the Paging subgroup ID for the UE, </action> <action> store it in the 5GMM context of the UE, </action> and <action> include it in the Negotiated PEIPS assistance information IE in the REGISTRATION ACCEPT message </action> or <action> in the Updated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message as part of the registration procedure. </action> <action> The AMF may consider the UE paging probability information received in the Requested PEIPS assistance information IE </action> <condition> when determining the Paging subgroup ID for the UE. </condition> </control>
NOTE 20: Besides the UE paging probability information when provided by the UE, the AMF can also take local configuration, whether the UE is likely to receive IMS voice over PS session calls, UE mobility pattern or previous statistical information for the UE or information provided by the NG-RAN into account when determining the Paging subgroup ID for the UE.
<control> <condition> <condition> If due to regional subscription restrictions or access restrictions the UE is not allowed to access the TA </condition> or <condition> due to CAG restrictions the UE is not allowed to access the cell, </condition> <condition> but the UE has an emergency PDU session established, </condition> </condition> <action> the AMF may accept the REGISTRATION REQUEST message </action> and <action> indicate to the SMF to perform a local release of all non- emergency PDU sessions (associated with 3GPP access if it is due to CAG restrictions) </action> and <action> informs the UE via the PDU session status IE in the REGISTRATION ACCEPT message. </action> <action> The AMF shall not indicate to the SMF to release the emergency PDU session. </action> </control> <control> <condition> If the AMF indicated to the SMF to perform a local release of all non-emergency PDU sessions (associated with 3GPP access if it is due to CAG restrictions), </condition> <action> the network shall behave as if the UE is registered for emergency services and shall set the 5GS registration result IE value to "Registered for emergency services" in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message includes the PDU session reactivation result error cause IE with the 5GMM cause set to #28 "Restricted service area", </condition> <end_state> the UE shall enter the state 5GMM-REGISTERED.NON-ALLOWED- SERVICE and behave as specified in subclause 5.3.5. </end_state> </control>
<control> <condition> If the REGISTRATION ACCEPT message includes the SOR transparent container IE </condition> and: </control>
<control> <condition> a) the SOR transparent container IE does not successfully pass the integrity check (see 3GPP TS 33.501 ); </condition> and </control>
<control> <condition> b) if the UE attempts obtaining service on another PLMNs or SNPNs as specified in 3GPP TS 23.122 annex C; </condition> <action> then the UE shall release locally the established NAS signalling connection after sending a REGISTRATION COMPLETE message. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message includes the SOR transparent container IE </condition> and <condition> the SOR transparent container IE successfully passes the integrity check (see 3GPP TS 33.501 ), </condition> <action> the ME shall store the received SOR counter as specified in annex C and proceed as follows: </action> </control>
<control> a) <action> the UE shall proceed with the behaviour as specified in 3GPP TS 23.122 annex C; </action> </control> and
<control> <condition> b) <condition> if the registration procedure is performed over 3GPP access </condition> and <condition> the UE attempts obtaining service on another PLMNs or SNPNs as specified in 3GPP TS 23.122 annex C </condition> </condition> <action> then the UE may release locally the established NAS signalling connection after sending a REGISTRATION COMPLETE message. </action> </control> <control> <condition> Otherwise </condition> <action> the UE shall send a REGISTRATION COMPLETE message </action> and <action> not release the current N1 NAS signalling connection locally. </action> </control> <control> <condition> If an acknowledgement is requested in the SOR transparent container IE of the REGISTRATION ACCEPT message, </condition> <action> the UE acknowledgement is included in the SOR transparent container IE of the REGISTRATION COMPLETE message. </action> </control> <control> <condition> In the SOR transparent container IE carrying the acknowledgement, </condition> <action> the UE shall set the ME support of SOR-CMCI indicator to "SOR-CMCI supported by the ME". </action> <condition> <condition> Additionally, if the UE supports access to an SNPN using credentials from a credentials holder </condition> and <condition> the UE is not operating in SNPN access operation mode, </condition> </condition> <action> the UE may set the ME support of SOR-SNPN-SI indicator to "SOR-SNPN-SI supported by the ME". </action> </control>
<control> <condition> If the SOR transparent container IE successfully passes the integrity check (see 3GPP TS 33.501 ), </condition> and: </control>
<control> <condition> a) the SOR transparent container IE indicates a list of preferred PLMN/access technology combinations is provided and the list type indicates "PLMN ID and access technology list", </condition> <action> then the ME shall replace the highest priority entries in the "Operator Controlled PLMN Selector with Access Technology" list stored in the ME and shall proceed with the behaviour as specified in 3GPP TS 23.122 annex C. </action> </control>
<control> <condition> <condition> If the SOR-CMCI is present </condition> and <condition> the Store SOR-CMCI in ME indicator is set to "Store SOR-CMCI in ME" </condition> </condition> <action> then the UE shall store or delete the SOR-CMCI in the non-volatile memory of the ME as described in annex C.1; </action> </control>
<control> <condition> b) the list type indicates "secured packet", </condition> <action> then the ME shall behave as if a SMS is received with protocol identifier set to SIM data download, </action> <action> data coding scheme set to class 2 message and SMS payload as secured packet contents of SOR transparent container IE. </action> <action> The SMS payload is forwarded to UICC as specified in 3GPP TS 23.040; </action> </control> or
<control> <condition> c) <condition> the SOR transparent container IE indicates "HPLMN indication that 'no change of the "Operator Controlled PLMN Selector with Access Technology" list stored in the UE is needed </condition> and <condition> thus no list of preferred PLMN/access technology combinations is provided'", </condition> <condition> the UE operates in SNPN access operation mode </condition> and <condition> the SOR transparent container IE includes SOR-SNPN-SI, </condition> </condition> <action> the ME shall replace SOR-SNPN-SI of the selected entry of the "list of subscriber data" or associated with the selected PLMN subscription, as specified in 3GPP TS 23.122 with the received SOR-SNPN-SI. </action> </control>
<control> <condition> If the SOR-CMCI is present and the Store SOR-CMCI in ME indicator is set to "Store SOR-CMCI in ME" </condition> <action> then the UE shall store or delete the SOR-CMCI in the non-volatile memory of the ME as described in annex C.1; </action> and <action> the UE shall proceed with the behaviour as specified in 3GPP TS 23.122 annex C. </action> </control>
<control> <condition> If the SOR transparent container IE does not pass the integrity check successfully, </condition> <action> then the UE shall discard the content of the SOR transparent container IE. </action> </control>
<control> <condition> If required by operator policy, </condition> <action> the AMF shall include the NSSAI inclusion mode IE in the REGISTRATION ACCEPT message (see table 4.6.2.3.1 of subclause 4.6.2.3). </action> </control> <control> <condition> Upon receipt of the REGISTRATION ACCEPT message: </condition> </control>
<control> <condition> a) if the message includes the NSSAI inclusion mode IE, </condition> <action> the UE shall operate in the NSSAI inclusion mode indicated in the NSSAI inclusion mode IE over the current access within the current PLMN or SNPN and its equivalent PLMN(s), if any, in the current registration area; </action> </control> or
<control> 1) <condition> if the UE has NSSAI inclusion mode for the current PLMN or SNPN </condition> and <condition> access type stored in the UE, </condition> <action> the UE shall operate in the stored NSSAI inclusion mode; </action> </control>
<control> 2) <condition> <condition> if the UE does not have NSSAI inclusion mode for the current PLMN or SNPN </condition> and <condition> the access type stored in the UE </condition> and <condition> if the UE is performing the registration procedure over: </condition> </condition> </control>
<control> <condition> i) 3GPP access, </condition> <action> the UE shall operate in NSSAI inclusion mode D in the current PLMN or SNPN and the current access type; </action> </control>
<control> ii) <condition> untrusted non-3GPP access, </condition> <action> the UE shall operate in NSSAI inclusion mode C in the current PLMN and the current access type; </action> or </control>
<control> iii) <condition> trusted non-3GPP access, </condition> <action> the UE shall operate in NSSAI inclusion mode D in the current PLMN and the current access type; </action> or </control>
<control> 3) <condition> if the 5G-RG does not have NSSAI inclusion mode for the current PLMN and wireline access stored in the 5G-RG, </condition> and <condition> the 5G-RG is performing the registration procedure over wireline access, </condition> <action> the 5G-RG shall operate in NSSAI inclusion mode B in the current PLMN and the current access type. </action> </control>
The AMF may include operator-defined access category definitions in the REGISTRATION ACCEPT message.
<control> <condition> <condition> If there is a running T3447 timer in the AMF </condition> and <condition> the Uplink data status IE is included or the Follow-on request indicator is set to "Follow-on request pending" in the REGISTRATION REQUEST message, </condition> </condition> <action> the AMF shall ignore the Uplink data status IE or that the Follow-on request indicator is set to "Follow-on request pending" </action> and <action> proceed as if the Uplink data status IE was not received or the Follow-on request indicator was not set to "Follow-on request pending" </action> <condition> <condition> except for the following case: a) the PDU session(s) indicated by the Uplink data status IE is emergency PDU session(s); </condition> <condition> b) the UE is configured for high priority access in selected PLMN; </condition> <condition> c) the REGISTRATION REQUEST message is as a paging response; </condition> or <condition> d) the UE is establishing an emergency PDU session or performing emergency services fallback. </condition> </condition> </control>
<control> <condition> If the UE receives Operator-defined access category definitions IE in the REGISTRATION ACCEPT message </condition> and <condition> the Operator-defined access category definitions IE contains one or more operator-defined access category definitions, </condition> <action> UE shall delete any operator-defined access category definitions stored for the RPLMN </action> and <action> shall store the received operator-defined access category definitions for the RPLMN. </action> </control> <control> <condition> <condition> If the UE receives the Operator-defined access category definitions IE in the REGISTRATION ACCEPT message </condition> and <condition> the Operator-defined access category definitions IE contains no operator-defined access category definitions, </condition> </condition> <action> the UE shall delete any operator-defined access category definitions stored for the RPLMN. </action> </control> <control> <condition> If the REGISTRATION ACCEPT message does not contain the Operator-defined access category definitions IE, </condition> <action> the UE shall not delete the operator-defined access category definitions stored for the RPLMN. </action> </control>
<control> <condition> If the UE has indicated support for service gap control in the REGISTRATION REQUEST message </condition> and: <condition> a) the REGISTRATION ACCEPT message contains the T3447 value IE, </condition> <action> then the UE shall store the new T3447 value, </action> <action> erase any previous stored T3447 value if exists </action> and <action> use the new T3447 value with the timer T3447 next time it is started; </action> or b) <condition> the REGISTRATION ACCEPT message does not contain the T3447 value IE, </condition> <action> then the UE shall erase any previous stored T3447 value if exists and stop the timer T3447 if running. </action> </control>
<control> <condition> If the REGISTRATION ACCEPT message contains the Truncated 5G-S-TMSI configuration IE, </condition> <action> then the UE shall store the included truncated 5G-S-TMSI configuration </action> and <action> return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the truncated 5G-S-TMSI configuration. </action> </control>
NOTE 21: The UE provides the truncated 5G-S-TMSI configuration to the lower layers.
<control> <condition> If the UE is not in NB-N1 mode, </condition> <condition> the UE has set the RACS bit to "RACS supported" in the 5GMM Capability IE of the REGISTRATION REQUEST message, </condition> and <condition> the REGISTRATION ACCEPT message includes: </condition> </control>
<control> <condition> a) a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", </condition> <action> the UE shall delete any network-assigned UE radio capability IDs associated with the RPLMN or RSNPN </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, </condition> <condition> the selected entry of the "list of subscriber data" or the selected PLMN subscription stored at the UE, </condition> <action> then the UE shall initiate a registration procedure for mobility and periodic registration update as specified in subclause 5.5.1.3.2 over the existing N1 NAS signalling connection; </action> or </control>
<control> <condition> b) a UE radio capability ID IE, </condition> <action> the UE shall store the UE radio capability ID as specified in annex C. </action> </control>
<control> <condition> <condition> If the registration procedure for mobility and periodic registration update was initiated </condition> and <condition> there is a request from the upper layers to perform "emergency services fallback" pending, </condition> </condition> <action> the UE shall restart the service request procedure </action> <condition> after the successful completion of the mobility and periodic registration update. </condition> </control>
<control> <condition> When AMF re-allocation occurs in the registration procedure for mobility and periodic registration update, </condition> <condition> if the new AMF receives in the 5GMM context of the UE the indication that the UE is registered for onboarding services in SNPN, </condition> <action> the new AMF may start an implementation specific timer for onboarding services </action> <condition> when the registration procedure for mobility and periodic registration update is successfully completed. </condition> </control>
<control> <condition> If the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message </condition> and <condition> the REGISTRATION ACCEPT message contains the service-level- AA pending indication in the Service-level-AA container IE, </condition> <action> the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the service-level-AA pending indication, </action> and <action> the UE shall not attempt to perform another registration procedure for UAS services </action> <condition> until the UUAA-MM procedure is completed, </condition> or <action> to establish a PDU session for USS communication or a PDU session for C2 communication </action> <condition> until the UUAA-MM procedure is completed successfully. </condition> </control>
<control> <condition> <condition> If the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message </condition> and <condition> the REGISTRATION ACCEPT message does not contain the service-level-AA pending indication in the Service-level-AA container IE, </condition> </condition> <action> the UE shall consider the UUAA-MM procedure is not triggered. </action> </control>
<control> <condition> If the UE is registered for onboarding services in SNPN </condition> or <condition> the network determines that the UE's subscription only allows for configuration of SNPN subscription parameters in PLMN via the user plane, </condition> <action> the AMF may start an implementation specific timer for onboarding services, if not running already, </action> <condition> when the network considers that the UE is in 5GMM-REGISTERED (i.e. the network receives the REGISTRATION COMPLETE message from UE). </condition> </control>
<control> NOTE 22: <condition> <condition> If the AMF considers that the UE is in 5GMM-IDLE, </condition> <condition> when the implementation specific timer for onboarding services expires </condition> and <condition> the network considers that the UE is still in state 5GMM-REGISTERED, </condition> </condition> <action> the AMF can locally de-register the UE; </action> or <condition> if the UE is in 5GMM-CONNECTED, </condition> <action> the AMF can initiate the network-initiated de-registration procedure (see subclause 5.5.2.3). </action> </control>
NOTE 23: The value of the implementation specific timer for onboarding services needs to be large enough to allow a UE to complete the configuration of one or more entries of the "list of subscriber data" taking into consideration that configuration of SNPN subscription parameters in PLMN via the user plane or onboarding services in SNPN involves third party entities outside of the operator's network.
<control> <condition> <condition> If the UE receives the List of PLMNs to be used in disaster condition IE in the REGISTRATION ACCEPT message </condition> and <condition> the UE supports MINT, </condition> </condition> <action> the UE shall delete the "list of PLMN(s) to be used in disaster condition" stored in the ME together with the PLMN ID of the RPLMN, if any, </action> and <action> may store the "list of PLMN(s) to be used in disaster condition" included in the List of PLMNs to be used in disaster condition IE in the ME together with the PLMN ID of the RPLMN. </action> </control>
<control> <condition> <condition> If the UE receives the Disaster roaming wait range IE in the REGISTRATION ACCEPT message </condition> and <condition> the UE supports MINT, </condition> </condition> <action> the UE shall delete the disaster roaming wait range stored in the ME, if any, </action> and <action> store the disaster roaming wait range included in the Disaster roaming wait range IE in the ME. </action> </control>
<control> <condition> If the UE receives the Disaster return wait range IE in the REGISTRATION ACCEPT message </condition> and <condition> the UE supports MINT, </condition> <action> the UE shall delete the disaster return wait range stored in the ME, if any, </action> and <action> store the disaster return wait range stored included in the Disaster return wait range IE in the ME. </action> </control>
<control> <condition> If the 5GS registration type IE is set to "disaster roaming mobility registration updating" </condition> and: </control>
<control> <condition> a) the MS determined PLMN with disaster condition IE is included in the REGISTRATION REQUEST message, </condition> <action> the AMF shall determine the PLMN with disaster condition in the MS determined PLMN with disaster condition IE; </action> </control>
<control> <condition> b) <condition> the MS determined PLMN with disaster condition IE is not included in the REGISTRATION REQUEST message </condition> and <condition> the Additional GUTI IE is included in the REGISTRATION REQUEST message </condition> and <condition> contains 5G- GUTI of a PLMN of the country of the PLMN providing disaster roaming, </condition> </condition> <action> the AMF shall determine the PLMN with disaster condition in the PLMN identity of the 5G-GUTI; </action> </control>
<control> <condition> c) the MS determined PLMN with disaster condition IE </condition> and <condition> the Additional GUTI IE are not included in the REGISTRATION REQUEST message </condition> and: </control>
<control> 1) <condition> the 5GS mobile identity IE contains 5G-GUTI of a PLMN of the country of the PLMN providing disaster roaming, </condition> <action> the AMF shall determine the PLMN with disaster condition in the PLMN identity of the 5G-GUTI; </action> or </control>
<control> 2) <condition> the 5GS mobile identity IE contains SUCI of a PLMN of the country of the PLMN providing disaster roaming, </condition> <action> the AMF shall determine the PLMN with disaster condition in the PLMN identity of the SUCI; </action> or </control>
<control> <condition> d) the MS determined PLMN with disaster condition IE is not included in the REGISTRATION REQUEST message, </condition> <condition> NG-RAN of the PLMN providing disaster roaming broadcasts disaster roaming indication </condition> and: <condition> a) the Additional GUTI IE is included in the REGISTRATION REQUEST message </condition> and <condition> contains 5G-GUTI of a PLMN of a country other than the country of the PLMN providing disaster roaming; </condition> or b) <condition> the Additional GUTI IE is not included </condition> and <condition> the 5GS mobile identity IE contains 5G-GUTI or SUCI of a PLMN of a country other than the country of the PLMN providing disaster roaming; </condition> <action> the AMF shall determine the PLMN with disaster condition based on the disaster roaming agreement arrangement between mobile network operators. </action> </control>
NOTE 24: The disaster roaming agreement arrangement between mobile network operators is out scope of 3GPP.
<control> <condition> If the AMF determines that a disaster condition applies to the PLMN with disaster condition, </condition> and <condition> the UE is allowed to be registered for disaster roaming services, </condition> <action> the AMF shall set the Disaster roaming registration result value bit in the 5GS registration result IE to "no additional information" in the REGISTRATION ACCEPT message. </action> </control> <control> <condition> If the AMF determines that the UE can be registered to the PLMN for normal service, </condition> <action> the AMF shall set the Disaster roaming registration result value bit in the 5GS registration result IE to "request for registration for disaster roaming service accepted as registration not for disaster roaming service " in the REGISTRATION ACCEPT message. </action> </control>
<control> <condition> If the UE indicates "disaster roaming mobility registration updating" in the 5GS registration type IE in the REGISTRATION REQUEST message </condition> and <condition> the 5GS registration result IE value in the REGISTRATION ACCEPT message is set to: a) "request for registration for disaster roaming service accepted as registration not for disaster roaming service", </condition> <action> the UE shall consider itself registered for normal service. </action> </control> <control> <condition> If the PLMN identity of the registered PLMN is a member of the forbidden PLMN list as specified in subclause 5.3.13A, </condition> <action> any such PLMN identity shall be deleted from the corresponding list(s); or b) "no additional information", </action> <action> the UE shall consider itself registered for disaster roaming. </action> </control>
<control> <condition> <condition> If the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for roaming" IE in the REGISTRATION ACCEPT message </condition> and <condition> the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for roaming", </condition> </condition> <action> the UE shall store the TAI(s) included in the IE into the list of "5GS forbidden tracking areas for roaming" </action> and <action> remove the TAI(s) from the stored TAI list if present. </action> </control>
<control> <condition> <condition> If the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for regional provision of service" IE in the REGISTRATION ACCEPT message </condition> and <condition> the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for regional provision of service", </condition> </condition> <action> the UE shall store the TAI(s) included in the IE into the list of "5GS forbidden tracking areas for regional provision of service" </action> and <action> remove the TAI(s) from the stored TAI list if present. </action> </control>
5.5.1.3.5 Mobility and periodic registration update not accepted by the network
<control> <condition> If the mobility and periodic registration update request cannot be accepted by the network, </condition> <action> the AMF shall send a REGISTRATION REJECT message to the UE including an appropriate 5GMM cause value. </action> </control>
<control> <condition> If the mobility and periodic registration update request is rejected <condition> due to general NAS level mobility management congestion control, </condition> </condition> <action> the network shall set the 5GMM cause value to #22 "congestion" and assign a value for back-off timer T3346. </action> </control>
<control> <condition> <condition> In NB-N1 mode, </condition> <condition> if the mobility and periodic registration update request is rejected <condition> due to operator determined barring (see 3GPP TS 29.503 ), </condition> </condition> </condition> <action> the network shall set the 5GMM cause value to #22 "congestion" and assign a value for back-off timer T3346. </action> </control>
<control> <condition> When the UE performs inter-system change from S1 mode to N1 mode, <condition> if the AMF is informed that verification of the integrity protection of the TRACKING AREA UPDATE REQUEST message <condition> included by the UE in the EPS NAS message container IE of the REGISTRATION REQUEST message </condition> has failed in the MME, </condition> </condition> then: </control>
<control> <condition> a) If the AMF can retrieve the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, </condition> <action> the AMF shall proceed as specified in subclause 5.5.1.3.4; </action> </control>
<control> <condition> b) <condition> if the AMF cannot retrieve the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, </condition> or <condition> the ngKSI or 5G-GUTI was not sent by the UE, </condition> </condition> <action> the AMF may initiate the identification procedure by sending the IDENTITY REQUEST message with the "Type of identity" of the 5GS identity type IE set to "SUCI" before taking actions as specified in subclause 4.4.4.3; </action> </control> or
<control> <condition> c) If the AMF needs to reject the mobility and periodic registration update procedure, </condition> <action> the AMF shall send REGISTRATION REJECT message including 5GMM cause #9 "UE identity cannot be derived by the network". </action> </control>
<control> <condition> If the REGISTRATION REJECT message with 5GMM cause #76 or #78 was received without integrity protection, </condition> <action> then the UE shall discard the message. </action> </control> <control> <condition> If the REGISTRATION REJECT message with 5GMM cause #62 was received without integrity protected, the behaviour of the UE is specified in subclause 5.3.20.2. </condition> </control>
<control> <condition> Based on operator policy, <condition> if the mobility and periodic registration update request is rejected <condition> due to core network redirection for CIoT optimizations, </condition> </condition> </condition> <action> the network shall set the 5GMM cause value to #31 "Redirection to EPC required". </action> </control>
NOTE 1: The network can take into account the UE's S1 mode capability, the EPS CIoT network behaviour supported by the UE or the EPS CIoT network behaviour supported by the EPC to determine the rejection with the 5GMM cause value #31 "Redirection to EPC required".
<control> <condition> If the mobility and periodic registration update request is rejected </condition> because: </control>
<control> <condition> a) all the S-NSSAI(s) included in the requested NSSAI (i.e. Requested NSSAI IE or Requested mapped NSSAI IE) are rejected; </condition> </control>
<control> <condition> b) the UE set the NSSAA bit in the 5GMM capability IE to: </condition> </control>
<control> <condition> i) there are no default S-NSSAIs; </condition> </control>
<control> ii) <condition> all default S-NSSAIs are not allowed; </condition> or </control>
<control> <condition> iii) <condition> network slice-specific authentication and authorization has failed or been revoked for all subscribed S- NSSAIs marked as default and based on network local policy, </condition> the network decides not to initiate the network slice-specific re-authentication and re-authorization procedures for any subscribed S-NSSAI <condition> marked as default requested by the UE; </condition> </condition> or </control>
<control> <condition> i) there are no subscribed S-NSSAIs which are marked as default; </condition> or </control>
<control> ii) <condition> all subscribed S-NSSAIs marked as default are either not allowed or are subject to network slice-specific authentication and authorization; </condition> and </control>
<control> <condition> c) no emergency PDU session has been established for the UE; </condition> <action> the network shall set the 5GMM cause value to #62 "No network slices available". </action> </control> <control> <condition> If the UE had included requested NSSAI in the REGISTRATION REQUEST message, </condition> then <action> the network shall include the rejected S-NSSAI(s) in the rejected NSSAI of the REGISTRATION REJECT message. </action> </control> <control> <condition> Otherwise, </condition> <action> the network may include the rejected S- NSSAI(s) in the rejected NSSAI of the REGISTRATION REJECT message. </action> </control>
<control> <condition> If the UE has set the ER-NSSAI bit to "Extended rejected NSSAI supported" <condition> in the 5GMM capability IE of the REGISTRATION REQUEST message, </condition> </condition> <action> the rejected S-NSSAI(s) shall be included in the Extended rejected NSSAI IE of the REGISTRATION REJECT message. </action> </control> <control> <condition> Otherwise </condition> <action> the rejected S-NSSAI(s) shall be included in the Rejected NSSAI IE of the REGISTRATION REJECT message. </action> </control>
<control> <condition> <condition> If the UE supports extended rejected NSSAI </condition> and <condition> the AMF determines that maximum number of UEs reached for one or more S-NSSAI(s) <condition> in the requested NSSAI as specified in subclause 4.6.2.5, </condition> </condition> </condition> <action> the AMF shall include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause "S-NSSAI not available due to maximum number of UEs reached" in the Extended rejected NSSAI IE in the REGISTRATION REJECT message. </action> In addition, <action> the AMF may include a back-off timer value for each S-NSSAI with the rejection cause "S-NSSAI not available due to maximum number of UEs reached" in the Extended rejected NSSAI IE of the REGISTRATION REJECT message. </action> </control>
<control> <condition> If the mobility and periodic registration update request from a UE supporting CAG is rejected <condition> due to CAG restrictions, </condition> </condition> <action> the network shall set the 5GMM cause value to #76 "Not authorized for this CAG or authorized for CAG cells only" </action> and <action> should include the "CAG information list" in the CAG information list IE or the Extended CAG information list IE in the REGISTRATION REJECT message. </action> </control>
NOTE 2: The network cannot be certain that "CAG information list" stored in the UE is updated as result of sending of the REGISTRATION REJECT message with the CAG information list IE or the Extended CAG information list IE, as the REGISTRATION REJECT message is not necessarily delivered to the UE (e.g due to abnormal radio conditions).
NOTE 3: <control> The "CAG information list" can be provided by the AMF and include no entry <condition> if no "CAG information list" exists in the subscription. </condition> </control>
NOTE 3A: <control> <condition> If the UE supports extended CAG information list, </condition> the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE. </control>
<control> <condition> If the UE does not support extended CAG information list, </condition> <action> the CAG information list shall not be included in the Extended CAG information list IE. </action> </control>
<control> If the mobility and periodic registration update request from a UE not supporting CAG is rejected <condition> due to CAG restrictions, </condition> <action> the network shall operate as described in bullet i) of subclause 5.5.1.3.8. </action> </control>
If the UE's mobility and periodic registration update request is via a satellite NG-RAN cell and the network determines that the UE is in a location where the network is not allowed to operate, see 3GPP TS 23.502 , the network shall set the 5GMM cause value in the REGISTRATION REJECT message to #78 "PLMN not allowed at the present UE location".
NOTE 4: <control> <condition> When the UE accessing network for emergency services, </condition> it is up to operator and regulatory policies whether the network needs to determine if the UE is in a location where network is not allowed to operate </control>
<control> <condition> <condition> If the AMF receives the mobility and periodic registration update request including the service-level device ID <condition> set to the CAA-level UAV ID in the Service-level-AA container IE </condition> </condition> and <condition> the AMF determines that the UE is not allowed to use UAS services via 5GS <condition> based on the user's subscription data and the operator policy, </condition> </condition> </condition> <action> the AMF shall return a REGISTRATION REJECT message with 5GMM cause #79 (UAS services not allowed). </action> </control>
<control> <condition> If the mobility and periodic registration update request from a UE supporting MINT is rejected <condition> due to a disaster condition no longer being applicable in the current location of the UE, </condition> </condition> <action> the network shall set the 5GMM cause value to #11 "PLMN not allowed" or #13 "Roaming not allowed in this tracking area" </action> and may <action> include a disaster return wait range in the Disaster return wait range IE in the REGISTRATION REJECT message. </action> </control>
<control> <condition> If the UE initiates the registration procedure for disaster roaming </condition> and <condition> the AMF determines that it does not support providing disaster roaming services for the determined PLMN with disaster condition to the UE, </condition> </control> <action> then the AMF shall send a REGISTRATION REJECT message with 5GMM cause #80 (Disaster roaming for the determined PLMN with disaster condition not allowed). </action>
Regardless of the 5GMM cause value received in the REGISTRATION REJECT message, <control> <condition> a) <condition> if the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for roaming" IE <condition> in the REGISTRATION REJECT message </condition> </condition> and <condition> if the TAI(s) <condition> included in the IE </condition> is not part of the list of "5GS forbidden tracking areas for roaming", </condition> </condition> <action> the UE shall store the TAI(s) included in the IE, </action> <condition> if not already stored, </condition> <action> into the list of "5GS forbidden tracking areas for roaming" </action> and <action> remove the TAI(s) from the stored TAI list </action> <condition> if present; </condition> </control> and <control> <condition> b) <condition> if the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for regional provision of service" IE <condition> in the REGISTRATION REJECT message </condition> </condition> and <condition> <condition> if the TAI(s) <condition> included in the IE </condition> is not part of the list of "5GS forbidden tracking areas for regional provision of service", </condition> </condition> </condition> <action> the UE shall store the TAI(s) included in the IE, </action> <condition> if not already stored, </condition> <action> into the list of "5GS forbidden tracking areas for regional provision of service" </action> and <action> remove the TAI(s) from the stored TAI list </action> <condition> if present. </condition> </control>
<control> Furthermore, the UE shall take the following actions depending on the 5GMM cause value received in the REGISTRATION REJECT message. </control>
<control> <condition> #3 (Illegal UE); or #6 (Illegal ME). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> In case of PLMN, </condition> <action> the UE shall consider the USIM as invalid for 5GS services </action> <condition> <condition> until switching off, </condition> <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.1. </condition> </control>
<control> <condition> In case of SNPN, <condition> <condition> if the UE is not registered for onboarding services in SNPN </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid </action> <condition> <condition> until the UE is switched off, </condition> <condition> the entry is updated </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.2. </condition> </control> <control> <condition> In case of SNPN, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid for 3GPP access </action> <condition> <condition> until the UE is switched off, </condition> <condition> the entry is updated </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.2. </condition> </control> <control> Additionally, <condition> if EAP based primary authentication and key agreement procedure <condition> using EAP-AKA'or 5G AKA based primary authentication and key agreement procedure </condition> was performed in the current SNPN, </condition> <action> the UE shall consider the USIM as invalid for the current SNPN </action> <condition> <condition> until switching off, </condition> <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.2. </condition> </control>
<control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> <action> the UE shall delete the list of equivalent PLMNs </action> <condition> (if any) </condition> and <action> shall move to 5GMM-DEREGISTERED.NO-SUPI state. </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> then the UE shall: </control>
<control> 1) <action> set the counter for "SIM/USIM considered invalid for GPRS services" events and the counter for "USIM considered invalid for 5GS services over non-3GPP access" events to UE implementation-specific maximum value in case of PLMN </action> <condition> if the UE maintains these counters; </condition> </control>
<control> 2) <action> set the counter for "the entry for the current SNPN considered invalid for 3GPP access" events and the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events to UE implementation-specific maximum value in case of SNPN </action> <condition> if the UE maintains these counters; </condition> and </control>
<control> <action> 3) delete the 5GMM parameters stored in non-volatile memory of the ME as specified in annex C. </action> </control>
<control> <action> 3) delete the 5GMM parameters stored in non-volatile memory of the ME as specified in annex C. </action> </control>
<control> <action> to UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 for the case </action> <condition> when the normal tracking area updating procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> <action> The USIM shall be considered as invalid also for non-EPS services </action> <condition> <condition> until switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.7a in 3GPP TS 24.301 . </condition> <control> <condition> If the UE is in EMM-REGISTERED state, </condition> <end_state> the UE shall move to EMM-DEREGISTERED state. </end_state> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> If the UE is registered for onboarding services in SNPN, </condition> <action> the UE shall reset the registration attempt counter, </action> <action> store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM- DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
<control> <condition> #7 (5GS services not allowed). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> In case of PLMN, </condition> <action> the UE shall consider the USIM as invalid for 5GS services </action> <condition> <condition> until switching off, </condition> <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.1; </condition> </control>
<control> <condition> In case of SNPN, <condition> <condition> if the UE is not registered for onboarding services in SNPN </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid for 5GS services </action> <condition> <condition> until the UE is switched off, </condition> <condition> the entry is updated </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.2. </condition> </control> <control> <condition> In case of SNPN, <condition> <condition> if the UE is not registered for onboarding services in SNPN </condition> and <condition> the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid for 3GPP access </action> <condition> <condition> until the UE is switched off, </condition> <condition> the entry is updated </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.2. </condition> </control> <control> Additionally, <condition> if EAP based primary authentication and key agreement procedure <condition> using EAP- AKA' or 5G AKA based primary authentication and key agreement procedure </condition> was performed in the current SNPN, </condition> <action> the UE shall consider the USIM as invalid for the current SNPN </action> <condition> <condition> until switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.2. </condition> </control>
<control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> <end_state> the UE shall move to 5GMM- DEREGISTERED.NO-SUPI state. </end_state> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> then the UE shall: </control>
<control> 1) <action> set the counter for "SIM/USIM considered invalid for GPRS services" events and the counter for "USIM considered invalid for 5GS services over non-3GPP access" events to UE implementation-specific maximum value </action> <condition> in case of PLMN </condition> <condition> if the UE maintains these counters </condition> ; </control>
<control> 2) <action> set the counter for "the entry for the current SNPN considered invalid for 3GPP access" events and the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events to UE implementation-specific maximum value </action> <condition> in case of SNPN </condition> <condition> if the UE maintains these counters; </condition> and </control>
<control> 3) <action> delete the 5GMM parameters stored in non-volatile memory of the ME as specified in annex C. </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the normal tracking area updating procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> If the UE is registered for onboarding services in SNPN, </condition> <action> the UE shall reset the registration attempt counter, </action> <action> store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM- DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
<control> <condition> #9 (UE identity cannot be derived by the network). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U2 NOT UPDATED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <end_state> The UE shall enter the state 5GMM-DEREGISTERED. </end_state> </control>
<control> <condition> If the UE has initiated the registration procedure <condition> in order to enable performing the service request procedure for emergency services fallback, </condition> </condition> <action> the UE shall attempt to select an E-UTRA cell connected to EPC or 5GCN according to the domain priority and selection rules specified in 3GPP TS 23.167 . </action> </control> <control> <condition> If the UE finds a suitable E-UTRA cell, </condition> <action> it then proceeds with the appropriate EMM or 5GMM procedures. </action> </control> <control> <condition> If the UE operating in single- registration mode has changed to S1 mode, </condition> <action> it shall disable the N1 mode capability for 3GPP access. </action> </control>
<control> <condition> If the rejected request was neither for initiating an emergency PDU session nor for emergency services fallback, </condition> <action> the UE shall subsequently, automatically initiate the initial registration procedure. </action> </control>
NOTE 5: <control> User interaction is necessary in some cases <condition> when the UE cannot re-establish the PDU session(s) </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action > the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the normal tracking area updating procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> #10 (implicitly de-registered). </condition> </control>
<control> <end_state> The UE shall enter the state 5GMM-DEREGISTERED.NORMAL-SERVICE. </end_state> <action> The UE shall delete any mapped 5G NAS security context or partial native 5G NAS security context. </action> </control>
<control> <condition> If the UE has initiated the registration procedure <condition> in order to enable performing the service request procedure for emergency services fallback, </condition> </condition> <action> the UE shall attempt to select an E-UTRA cell connected to EPC or 5GCN according to the domain priority and selection rules specified in 3GPP TS 23.167 . </action> </control> <control> <condition> If the UE finds a suitable E-UTRA cell, </condition> <action> it then proceeds with the appropriate EMM or 5GMM procedures. </action> </control> <control> <condition> If the UE operating in single- registration mode has changed to S1 mode, </condition> <action> it shall disable the N1 mode capability for 3GPP access. </action> </control>
<control> <condition> If the rejected request was neither for initiating an emergency PDU session nor for emergency services fallback, </condition> <action> the UE shall perform a new registration procedure for initial registration. </action> </control>
NOTE 6: <control> User interaction is necessary in some cases <condition> when the UE cannot re-establish the PDU session(s) </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM state as specified in 3GPP TS 24.301 </action> <condition> for the case when the normal tracking area updating procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> #11 (PLMN not allowed). </condition> </control>
This cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.3.7.
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall store the PLMN identity in the forbidden PLMN list as specified in subclause 5.3.13A </action> and <control> <condition> if the UE is configured to use timer T3245 </condition> then <action > the UE shall start timer T3245 and proceed as described in clause 5.3.19a.1, </action> <action> delete the list of equivalent PLMNs, </action> <action> reset the registration attempt counter. </action> </control> <control> <condition> For 3GPP access, </condition> <end_state> the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform a PLMN selection according to 3GPP TS 23.122 . </action> </control> <control> <condition> For non-3GPP access </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.LIMITED- SERVICE </end_state> and <action> perform network selection as defined in 3GPP TS 24.502 . </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains the PLMN-specific attempt counter </condition> and <condition> the PLMN-specific attempt counter for non-3GPP access for that PLMN, </condition> </condition> <action> the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN to the UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and tracking area updating attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the normal tracking area updating procedure is rejected <condition > with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access to the same PLMN, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
<control> <condition> <condition> If the UE receives the Disaster return wait range IE in the REGISTRATION REJECT message </condition> and <condition> the UE supports MINT, </condition> </condition> <action> the UE shall delete the disaster return wait range stored in the ME, </action> <condition> if any, </condition> and <condition> store the disaster return wait range included in the Disaster return wait range IE in the ME. </condition> </control>
<control> <condition> #12 (Tracking area not allowed). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> Additionally, the UE shall reset the registration attempt counter. </action> </control>
If: 1) <control> <condition> the UE is not operating in SNPN access operation mode, </condition> <action > the UE shall store the current TAI in the list of "5GS forbidden tracking areas for regional provision of service" </action> and <end_state> enter the state 5GMM- DEREGISTERED.LIMITED-SERVICE. </end_state> </control> <control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message; </action> </control> or
2) <control> <condition> the UE is operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for regional provision of service" for the current SNPN </action> and, <control> <condition> if the UE supports access to an SNPN <condition> using credentials from a credentials holder, </condition> the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED- SERVICE. </end_state> </control> </control> <control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for regional provision of service" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN <condition> using credentials from a credentials holder, </condition> the selected entry of the "list of subscriber data" or the selected PLMN subscription, for non-integrity protected NAS reject message. </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and tracking area updating attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the normal tracking area updating procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> #13 (Roaming not allowed in this tracking area). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete the list of equivalent PLMNs (if available). </action> <action> The UE shall reset the registration attempt counter. </action> <control> <condition> For 3GPP acess </condition> <end_state> the UE shall change to state 5GMM-REGISTERED.PLMN- SEARCH, </end_state> </control> and <control> <condition> for non-3GPP access </condition> <end_state> the UE shall change to state 5GMM-REGISTERED.LIMITED-SERVICE. </end_state> </control> </control>
<control> <condition> <condition> If the UE is registered in S1 mode </condition> and <condition> > operating in dual-registration mode, </condition> <condition> the PLMN </condition> </condition> that <action> the UE chooses to register in is specified in subclause 4.8.3. </action> </control> Otherwise if:
1) <control> <condition> the UE is not operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" </action> and <action> shall remove the current TAI from the stored TAI list </action> <condition> if present. </condition> </control> <control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for non-integrity protected NAS reject message; </action> </control> or
2) <control> <condition> the UE is operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN <condition> using credentials from a credentials holder, </condition> the selected entry of the "list of subscriber data" or the selected PLMN subscription. </condition> </control> <control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN <condition> using credentials from a credentials holder, </condition> the selected entry of the "list of subscriber data" or the selected PLMN subscription, for non-integrity protected NAS reject message. </condition> </control>
<control> <condition> For 3GPP access </condition> <action> the UE shall perform a PLMN selection or SNPN selection according to 3GPP TS 23.122 , </action> </control> and <control> <condition> for non-3GPP access </condition> <action> the UE shall perform network selection as defined in 3GPP TS 24.502 . </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the normal tracking area updating procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> <condition> If the UE receives the Disaster return wait range IE in the REGISTRATION REJECT message </condition> and <condition> the UE supports MINT, </condition> </condition> <action> the UE shall delete the disaster return wait range stored in the ME, </action> <condition> if any, </condition> and <action> store the disaster return wait range included in the Disaster return wait range IE in the ME. </action> </control>
<control> <condition> #15 (No suitable cells in tracking area). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2). </action> <action> The UE shall reset the registration attempt counter </action> and <end_state> shall enter the state 5GMM- REGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> If the UE has initiated the registration procedure <condition> in order to enable performing the service request procedure for emergency services fallback, </condition> </condition> <action> the UE shall attempt to select an E-UTRA cell connected to EPC or 5GC according to the emergency services support indicator (see 3GPP TS 36.331 ). </action> </control> <control > <condition> If the UE finds a suitable E-UTRA cell, </condition> <action> it then proceeds with the appropriate EMM or 5GMM procedures. </action> </control> <control> <condition> If the UE operating in single-registration mode has changed to S1 mode, </condition> <action> it shall disable the N1 mode capability for 3GPP access. </action> </control> <control> <condition> Otherwise, </condition> <action> the UE shall search for a suitable cell in another tracking area according to 3GPP TS 38.304 or 3GPP TS 36.304 . </action> </control>
If 1) <control> <condition> the UE is not operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" </action> and <action> shall remove the current TAI from the stored TAI list, </action> <condition> if present. </condition> </control> <control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for non-integrity protected NAS reject message; </action> </control> or
2) <control> <condition> the UE is operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN <condition> using credentials from a credentials holder, </condition> the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> and <action> shall remove the current TAI from the stored TAI list, </action> <condition> if present. </condition> </control> <control> If the REGISTRATION REJECT message is not integrity protected, <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN <condition> using credentials from a credentials holder, </condition> the selected entry of the "list of subscriber data" or the selected PLMN subscription, for non-integrity protected NAS reject message. </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value. </condition> </control>
<control> <condition> If received over non-3GPP access </condition> the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.1.3.7. </control>
<control> <condition> #22 (Congestion). </condition> </control>
<control> <condition> <condition> If the T3346 value IE is present in the REGISTRATION REJECT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> <action> the UE shall proceed as described below, </action> </control> <control> <condition> otherwise </condition> <action> it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.1.3.7. </action> </control>
<control> <action> The UE shall abort the registration procedure for mobility and periodic registration update. </action> <condition> If the rejected request was not for initiating an emergency PDU session, </condition> <action> the UE shall set the 5GS update status to 5U2 NOT UPDATED, </action> <action> reset the registration attempt counter </action> and <end_state> change to state 5GMM-REGISTERED.ATTEMPTING- REGISTRATION-UPDATE. </end_state> </control>
<control> <action> The UE shall stop timer T3346 if it is running. </action> </control>
<control> <condition> If the REGISTRATION REJECT message is integrity protected, </condition> <action> the UE shall start timer T3346 with the value provided in the T3346 value IE. </action> </control>
<control> <condition> If the REGISTRATION REJECT message is not integrity protected, </condition> <action> the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 . </action> </control>
<control> <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> <action> The registration procedure for mobility and periodic registration update is started, </action> <condition> <condition> if still necessary, </condition> <condition> when timer T3346 expires or is stopped. </condition> </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the normal tracking area updating procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> If the registration procedure for mobility and periodic registration update was initiated <condition> for an MO MMTEL voice call (i.e. access category 4), </condition> or <condition> an MO MMTEL video call (i.e. access category 5), </condition> or <condition> an MO IMS registration related signalling (i.e. access category 9) </condition> or <condition> for NAS signalling connection recovery during an ongoing MO MMTEL voice call (i.e. access category 4), </condition> or <condition> during an ongoing MO MMTEL video call (i.e. access category 5) </condition> or <condition> during an ongoing MO IMS registration related signalling (i.e. access category 9), </condition> </condition> <action> then a notification that the request was not accepted due to network congestion shall be provided to upper layers. </action> </control>
NOTE 7: <control> Upper layers specified in 3GPP TS 24.173 and 3GPP TS 24.229 handle the notification that the request was not accepted <condition> due to network congestion. </condition> </control>
<control> <condition> If the UE is registered for onboarding services in SNPN, </condition> <end_state> the UE may enter the state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control>
<control> <condition > #27 (N1 mode not allowed). </condition> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2). </action> <action> Additionally, the UE shall reset the registration attempt counter </action> and <end_state> shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE. </end_state> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set: 1) the PLMN-specific N1 mode attempt counter for 3GPP access and the PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN in case of PLMN; or 2) the SNPN-specific attempt counter for 3GPP access for the current SNPN and the SNPN-specific attempt counter for non-3GPP access for the current SNPN in case of SNPN;to the UE implementation-specific maximum value. </action> </control> <action> The UE shall disable the N1 mode capability for the specific access type for which the message was received (see subclause 4.9). </action> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall disable the N1 mode capability also for the other access type (see subclause 4.9). </action> </control> <control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED. </action> <action> Additionally, the UE shall reset the tracking area updating attempt counter </action> and <end_state> enter the state EMM-REGISTERED. </end_state> </control> </control>
<control> <condition> #31 (Redirection to EPC required). </condition> <control> 5GMM cause #31 received by a UE <condition> that has not indicated support for CIoT optimizations or not indicated support for S1 mode or received by a UE over non-3GPP access </condition> is considered an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.3.7. </control> <control> This cause value <condition> received from a cell belonging to an SNPN </condition> is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.3.7. </control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2). </action> <action> The UE shall reset the registration attempt counter </action> and <end_state> enter the state 5GMM- REGISTERED.LIMITED-SERVICE. </end_state> <control> <action> The UE shall enable the E-UTRA capability </action> <condition> if it was disabled </condition> and <action> disable the N1 mode capability for 3GPP access (see subclause 4.9.2). </action> </control> <control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the normal tracking area updating procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control> </control>
<control> <condition> #62 (No network slices available). </condition> <action> The UE shall abort the registration procedure for mobility and periodic registration update procedure, </action> <action> set the 5GS update status to 5U2 NOT UPDATED </action> and <end_state> enter state 5GMM-REGISTERED.ATTEMPTING- REGISTRATION-UPDATE. </end_state> <action> Additionally, the UE shall reset the registration attempt counter. </action> <control> <action> The UE receiving the rejected NSSAI in the REGISTRATION REJECT message takes the following actions </action> <condition> based on the rejection cause in the rejected S-NSSAI(s): </condition> <control> <condition> "S-NSSAI not available in the current PLMN or SNPN" </condition> <action> The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI(s) in the current PLMN or SNPN </action> <condition> <condition> until switching off the UE, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> an entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </condition> </condition> </control> <control> <condition> "S-NSSAI not available in the current registration area" </condition> <action> The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI(s) in the current registration area </action> <condition> <condition> until switching off the UE, </condition> <condition> the UE moving out of the current registration area, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> an entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </condition> </condition> </control> <control> <condition> "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization" </condition> <action> The UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access </action> <condition> <condition> until switching off the UE, </condition> <condition > the UICC containing the USIM is removed, </condition> <condition> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S- NSSAI(s) are removed or deleted as described in subclause 4.6.1 and 4.6.2.2. </condition> </condition> </control> <control> <condition> "S-NSSAI not available due to maximum number of UEs reached" </condition> <control> <condition> Unless the back-off timer value received along with the S-NSSAI is zero, </condition> <action> the UE shall add the rejected S- NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause 4.6.2.2 </action> and <action> shall not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access </action> <condition> <condition> until switching off the UE, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </condition> </condition> </control> </control> </control> </control>
NOTE 8: <control> <condition> If the back-off timer value received <condition> along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached </condition> is zero as specified in subclause 10.5.7.4a of TS 24.008, </condition> <action> the UE does not consider the S-NSSAI as the rejected S-NSSAI. </action> </control>
<control> <condition> If there is one or more S-NSSAIs in the rejected NSSAI <condition> with the rejection cause "S-NSSAI not available due to maximum number of UEs reached", </condition> </condition> then <control> for each S-NSSAI, the UE shall behave as follows: a) <action> stop the timer T3526 associated with the S-NSSAI, </action> <condition> if running; </condition> <control> b) start the timer T3526 with: 1) <action> the back-off timer value received along with the S-NSSAI, </action> <condition> if a back-off timer value is received <condition> along with the S-NSSAI that is neither zero nor deactivated; </condition> </condition> or 2) <action> an implementation specific back-off timer value, </action> <condition> if no back-off timer value is received along with the S- NSSAI; </condition> </control> and c) <action> remove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached </action> <condition> when the timer T3526 associated with the S-NSSAI expires. </condition> </control> </control>
<control> <condition> If the UE has an allowed NSSAI or configured NSSAI <condition> that contains S-NSSAIs <condition> which are not included in the rejected NSSAI, </condition> </condition> </condition> t <action> he UE may stay in the current serving cell, </action> <action> apply the normal cell reselection process </action> and <action> start a registration procedure for mobility and periodic registration update with a requested NSSAI that includes any S- NSSAI from the allowed S-NSSAI or the configured NSSAI that is not in the rejected NSSAI. </action> </control> <control> <condition> Otherwise </condition> <action> the UE may perform a PLMN selection or SNPN selection according to 3GPP TS 23.122 and additionally, </action> <action> the UE may disable the N1 mode capability for the current PLMN or SNPN </action> <condition> <condition> if the UE does not have an allowed NSSAI </condition> and <condition> each S-NSSAI in the configured NSSAI, <condition> if available, </condition> was rejected with cause "S-NSSAI not available in the current PLMN or SNPN" or "S-NSSAI not available <condition> due to the failed or revoked network slice-specific authentication and authorization" as described in subclause 4.9. </condition> </condition> </condition> </control>
<control> <condition> If the UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN </condition> and, 1) <control> <condition> if at least one S-NSSAI in the default configured NSSAI is not rejected, </condition> <action> the UE may stay in the current serving cell, </action> <action> apply the normal cell reselection process, </action> and <action> start a registration procedure for mobility and periodic registration update with a requested NSSAI with that default configured NSSAI; </action> </control> or 2) <control> <condition> <condition> if all the S-NSSAI(s) in the default configured NSSAI are rejected </condition> and <condition> at least one S-NSSAI is rejected <condition> due to "S-NSSAI not available in the current registration area", </condition> </condition> </condition> <control> <condition> i) <condition> if the REGISTRATION REJECT message is integrity protected </condition> and <condition> the UE is not operating in SNPN access operation mode, </condition> </condition> <action> > the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" </action> and <end_state> enter the state 5GMM-REGISTERED.LIMITED-SERVICE; </end_state> </control> or <control> ii) <condition> <condition> If the REGISTRATION REJECT message is integrity protected </condition> and <condition> the UE is operating in SNPN access operation mode, </condition> </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and <end_state> enter the state 5GMM-REGISTERED.LIMITED-SERVICE. </end_state> </control> </control> </control>
<control> <condition> Otherwise, </condition> <action> the UE may perform a PLMN selection or SNPN selection according to 3GPP TS 23.122 </action> and <action> additionally, the UE may disable the N1 mode capability for the current PLMN or SNPN </action> <condition> if each S-NSSAI in the default configured NSSAI was rejected <condition> <condition> with cause "S-NSSAI not available in the current PLMN or SNPN" </condition> or <condition> "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization" as described in subclause 4.9. </condition> </condition> </condition> </control>
<control> <condition> <condition> If the UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN </condition> and <condition> has rejected NSSAI for the reached maximum number of UEs, </condition> </condition> and <action> the UE wants to obtain services in the current serving cell without performing a PLMN selection or SNPN selection, </action> <action> the UE may stay in the current serving cell and attempt to use the rejected S-NSSAI(s) for the maximum number of UEs reached in the current serving cell </action> <condition> after rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU2 NOT UPDATED, </action> <action> reset the tracking area updating attempt counter </action> and <end_state> enter the state EMM-REGISTERED. </end_state> </control>
<control> <condition> #72 (Non-3GPP access to 5GCN not allowed). </condition> <control> <condition> When received over non-3GPP access </condition> <action> the UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> Additionally, the UE shall reset the registration attempt counter </action> and <end_state> enter the state 5GMM-DEREGISTERED. </end_state> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set: 1) the PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN in case of PLMN; or 2) the SNPN-specific attempt counter for non-3GPP access for that SNPN in case of SNPN; to the UE implementation-specific maximum value. </action> </control> </control> NOTE 9: The 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses 4.7.2 and 5.1.3). <action> The UE shall disable the N1 mode capability for non-3GPP access (see subclause 4.9.3). </action> <control> As an implementation option, <end_state> the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> <condition> in order to perform a PLMN selection according to 3GPP TS 23.122 . </condition> </control> <control> <condition> If received over 3GPP access </condition> <action> the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.1.3.7. </action> </control> </control>
<control> <condition> #73 (Serving network not authorized). </condition> This cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.3.7. <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall delete the list of equivalent PLMNs, </action> <action> reset the registration attempt counter, </action> <action> store the PLMN identity in the forbidden PLMN list as specified in subclause 5.3.13A. </action> <control> <condition> For 3GPP access </condition> <end_state> the UE shall enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> <condition> in order to perform a PLMN selection according to 3GPP TS 23.122 , </condition> </control> and <control> <condition> for non-3GPP access </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE </end_state> and <action> perform network selection as defined in 3GPP TS 24.502 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non- 3GPP access for that PLMN to the UE implementation-specific maximum value. </action> </control> <control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED </action> and <action> shall delete any 4G-GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> Additionally, the UE shall reset the tracking area updating attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control> </control>
<control> <condition > #74 (Temporarily not authorized for this SNPN). </condition> <control> 5GMM cause #74 is only applicable <condition> when received from a cell belonging to an SNPN. </condition> 5GMM cause #74 received from a cell <condition> not belonging to an SNPN </condition> is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.3.7. </control> <action> he UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall reset the registration attempt counter </action> and <action> store the SNPN identity in the "temporarily forbidden SNPNs" list for the specific access type for which the message was received </action> and, <condition> if the UE supports access to an SNPN <condition> using credentials from a credentials holder, </condition> the selected entry of the "list of subscriber data" or the selected PLMN subscription. </condition> <control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> <end_state> the UE shall enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the UE is registered for onboarding services in SNPN, </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.PLMN- SEARCH </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum value. </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access to the same SNPN, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control> </control>
NOTE 10: <control> <condition> When 5GMM cause #74 is received over 3GPP access, </condition> the term "other access" in "the UE also supports the registration procedure over the other access to the same SNPN" is used to express access to SNPN services via a PLMN. </control>
NOTE 11: The term "non-3GPP access" in an SNPN refers to the case where the UE is accessing SNPN services via a PLMN.
<control> <condition> #75 (Permanently not authorized for this SNPN). </condition> <control> 5GMM cause #75 is only applicable <condition> when received from a cell belonging to an SNPN with a globally-unique SNPN identity. </condition> </control> <control> 5GMM cause #75 received from a cell <condition> not belonging to an SNPN or a cell belonging to an SNPN with a non-globally-unique SNPN identity </condition> is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.3.7. </control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall reset the registration attempt counter </action> and <action> store the SNPN identity in the "permanently forbidden SNPNs" list for the specific access type for which the message was received </action> and, <condition> if the UE supports access to an SNPN <condition> using credentials from a credentials holder, </condition> the selected entry of the "list of subscriber data" or the selected PLMN subscription. </condition> <control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> <end_state> the UE shall enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the UE is registered for onboarding services in SNPN, </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.PLMN- SEARCH </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum value. </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access to the same SNPN, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control> </control>
NOTE 12: <control> <condition> When 5GMM cause #75 is received over 3GPP access, the term "other access" in "the UE also supports the registration procedure over the other access to the same SNPN" is used to express access to SNPN services via a PLMN. </condition> </control>
NOTE 13: <control> The term "non-3GPP access" in an SNPN refers to the case <condition> where the UE is accessing SNPN services via a PLMN. </condition> </control>
<control> <condition> #76 (Not authorized for this CAG or authorized for CAG cells only). </condition> This cause value received via non-3GPP access or from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.3.7. <action> The UE shall set the 5GS update status to 5U3.ROAMING NOT ALLOWED, </action> <action> store the 5GS update status according to clause 5.1.3.2.2, </action> and <action> reset the registration attempt counter. </action> <control> If 5GMM cause #76 is received from: 1) <control> <condition> <condition> a CAG cell, </condition> and <condition> if the UE receives a "CAG information list" <condition> in the CAG information list IE </condition> or the Extended CAG information list IE <condition> included in the REGISTRATION REJECT message, </condition> </condition> </condition> the UE shall: <control> i) <action> replace the "CAG information list" stored in the UE with the received CAG information list IE or the Extended CAG information list IE </action> <condition> when received in the HPLMN or EHPLMN; </condition> ii) <action> replace the serving VPLMN's entry of the "CAG information list" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE </action> <condition> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN; </condition> </condition> or NOTE 14: <condition> When the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN, </condition> <condition> entries of a PLMN other than the serving VPLMN, <condition> if any, </condition> <condition> in the received CAG information list IE </condition> </condition> or <condition> the Extended CAG information list IE are ignored. </condition> </condition> </condition> iii) <action> remove the serving VPLMN's entry of the "CAG information list" stored in the UE </action> <condition> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN </condition> </condition> and <condition> the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry. </condition> </condition> </control> <control> <condition> Otherwise, </condition> <action> the UE shall delete the CAG-ID(s) of the cell from the "allowed CAG list" for the current PLMN. </action> </control> <control> <condition> In the case the "allowed CAG list" for the current PLMN only contains a range of CAG-IDs, </condition> how the UE deletes the CAG-ID(s) of the cell from the "allowed CAG list" for the current PLMN is up to UE implementation. </control> In addition: <control> <condition> i) <condition> if the entry <condition> in the "CAG information list" for the current PLMN </condition> does not include an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> or <condition> if the entry <condition> in the "CAG information list" for the current PLMN </condition> includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> and <condition> the updated "allowed CAG list" for the current PLMN includes one or more CAG-IDs, </condition> </condition> then <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list"; </action> </control> <control> ii) <condition> <condition> if the entry <condition> in the "CAG information list" for the current PLMN </condition> includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> and <condition > the updated "allowed CAG list" for the current PLMN does not include any CAG-ID, </condition> </condition> then <end_state> the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list"; </action> </control> or <control> iii) <condition> if the "CAG information list" does not include an entry for the current PLMN, </condition> then <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list". </action> </control> </control> 2) <control> <condition> <condition> a non-CAG cell, </condition> and <condition> if the UE receives a "CAG information list" <condition> in the CAG information list IE </condition> or the Extended CAG information list IE included <condition> in the REGISTRATION REJECT message, </condition> </condition> </condition> the UE shall: <control> i) <action> replace the "CAG information list" stored in the UE with the received CAG information list IE or the Extended CAG information list IE </action> <condition> when received in the HPLMN or EHPLMN; </condition> ii) <action> replace the serving VPLMN's entry of the "CAG information list" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE </action> <condition> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN; </condition> </condition> or NOTE 15: <condition> When the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN, </condition> <condition> entries of a PLMN other than the serving VPLMN, <condition> if any, </condition> <condition> in the received CAG information list IE </condition> </condition> or <condition> the Extended CAG information list IE are ignored. </condition> </condition> </condition> iii) <action> remove the serving VPLMN's entry of the "CAG information list" stored in the UE </action> <condition> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE </condition> </condition> or <condition> the Extended CAG information list IE does not contain the serving VPLMN's entry. </condition> </condition> </control> <control> <condition> Otherwise, </condition> <action> the UE shall store an "indication that the UE is only allowed to access 5GS via CAG cells" in the entry of the "CAG information list" for the current PLMN, </action> <condition> if any. </condition> </control> <control> <condition> If the "CAG information list" stored in the UE does not include the current PLMN's entry, </condition> <action> the UE shall add an entry for the current PLMN to the "CAG information list" </action> and <action> store an "indication that the UE is only allowed to access 5GS via CAG cells" in the entry of the "CAG information list" for the current PLMN. </action> </control> <control> <condition> If the UE does not have a stored "CAG information list", </condition> <action> the UE shall create a new "CAG information list" </action> and <action> add an entry with an "indication that the UE is only allowed to access 5GS via CAG cells" for the current PLMN. </action> </control> In addition: <control> <condition> i) if the "allowed CAG list" for the current PLMN includes one or more CAG-IDs, </condition> then <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 with the updated CAG information; </action> </control> or <control> ii) <condition> if the "allowed CAG list" for the current PLMN does not include any CAG-ID, </condition> then <end_state> the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list". </action> </control> <control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED, </action> <action> reset the tracking area updating attempt counter </action> and <end_state> enter the state EMM-REGISTERED. </end_state> </control> </control> </control> </control>
<control> <condition> #77 (Wireline access area not allowed). </condition> <control> 5GMM cause #77 is only applicable <condition> when received from a wireline access network by the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device). </condition> </control> <control> 5GMM cause #77 <condition> received from a 5G access network other than a wireline access network </condition> and 5GMM cause #77 <condition> received by the W-AGF acting on behalf of the FN-BRG </condition> are considered as abnormal cases and the behaviour of the UE is specified in subclause 5.5.1.3.7. </control> <control> <condition> When received over wireline access network, </condition> <action> the 5G-RG and the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2), </action> <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI, </action> <action> shall reset the registration attempt counter, </action> <end_state> shall enter the state 5GMM-DEREGISTERED </end_state> and <action> shall act as specified in subclause 5.3.23. </action> </control> </control>
NOTE 16: The 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses 4.7.2 and 5.1.3).
<control> <condition> #78 (PLMN not allowed to operate at the present UE location). </condition> <control> This cause value <condition> received from a non-satellite NG-RAN cell </condition> is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.3.7. </control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> Additionally, the UE shall reset the registration attempt counter. </action> <action> The UE shall store the PLMN identity and, if it is known, the current geographical location in the list of "PLMNs not allowed to operate at the present UE location" </action> and <action> shall start a corresponding timer instance (see subclause 4.23.2). </action> <end_state> The UE shall enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform a PLMN selection according to 3GPP TS 23.122 . </action> <control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP TS 24.301 </action> <condition> for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value. </condition> </control> </control>
<control> <condition> #79 (UAS services not allowed). </condition> <action> The UE shall abort the registration procedure for mobility and periodic registration update procedure, set the 5GS update status to 5U2 NOT UPDATED </action> and <end_state> enter state 5GMM-REGISTERED.ATTEMPTING- REGISTRATION-UPDATE. </end_state> <action> Additionally, the UE shall reset the registration attempt counter. </action> <action> The UE may re- attempt the registration procedure to the current PLMN for services other than UAS services </action> and <action> shall not include the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of REGISTRATION REQUEST message. </action> <control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU2 NOT UPDATED, reset the tracking area updating attempt counter </action> and <end_state> enter the state EMM-REGISTERED. </end_state> </control> </control>
<control> <condition> #80 (Disaster roaming for the determined PLMN with disaster condition not allowed). </condition> <action> The UE shall abort the registration procedure for mobility and periodic registration update procedure, </action> <action> set the 5GS update status to 5U2 NOT UPDATED </action> and <end_state> enter state 5GMM-REGISTERED.ATTEMPTING- REGISTRATION-UPDATE. </end_state> <action> Additionally, the UE shall reset the registration attempt counter. </action> <action> The UE shall not attempt to register for disaster roaming on this PLMN for the determined PLMN with disaster condition for a period in the range of 12 to 24 hours. </action> <action> The UE shall not attempt to register for disaster roaming on this PLMN for a period in the range of 3 to 10 minutes. </action> <action> The UE shall perform PLMN selection as described in 3GPP TS 23.122 </action> <control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU2 NOT UPDATED, </action> <action> reset the tracking area updating attempt counter </action> and <end_state> enter the state EMM-REGISTERED. </end_state> </control> </control>
Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause 5.5.1.3.7.
5.5.1.3.6 Mobility and periodic registration update for initiating an emergency PDU session not accepted by the network
<control> <condition> If the mobility and periodic registration update request for initiating an emergency PDU session cannot be accepted by the network, </condition> <action> the UE shall perform the procedures as described in subclause 5.5.1.3.5. </action> <control> <condition> Then if the UE is in the same selected PLMN <condition> where the last mobility and periodic registration update request was attempted, </condition> </condition> the UE shall: a) <action> inform the upper layers of the failure of the procedure; </action> or NOTE 1: This can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN. b) <action> perform de-registration locally, </action> <condition> if not de-registered already, </condition> and <action> attempt initial registration for emergency </action> </control> </control>
<control> <condition> If the mobility and periodic registration update request for initiating an emergency PDU session fails <condition> due to abnormal case b) in subclause 5.5.1.3.7, </condition> </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.3.7 </action> and <action> inform the upper layers of the failure to access the network. </action> </control>
NOTE 2: This can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> If the mobility and periodic registration update request for initiating an emergency PDU session fails <condition> due to abnormal cases c) or d) in subclause 5.5.1.3.7, </condition> </condition> <action> the UE shall perform the procedures as described in subclause 5.5.1.3.7. </action> <control> <condition> Then if the UE is in the same selected PLMN <condition> where the last mobility and periodic registration update request was attempted, </condition> </condition> the UE shall: a) <action> inform the upper layers of the failure of the procedure; </action> or NOTE 3: , This can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN. b) <action> perform de-registration locally, </action> <condition> if not de-registered already, </condition> and <action> attempt initial registration for emergency </action> </control> </control>
5.5.1.3.6A Mobility and periodic registration update for an emergency services fallback not accepted by the network
<control> If the mobility and periodic registration update request for initiating an emergency services fallback: <control> <condition> a) fails due to an abnormal case described in subclause 5.5.1.3.7, </condition> <action> the UE shall perform the procedures as described in subclause 5.5.1.3.7; </action> </control> or <control> <condition> b) cannot be accepted by the network as described in subclause 5.5.1.3.5, </condition> <action> the UE shall perform the procedures as described in subclause 5.5.1.3.5. </action> </control> </control>
<control> <condition> If the mobility and periodic registration update request for initiating an emergency services fallback fails <condition> due to abnormal case b) in subclause 5.5.1.3.7, </condition> </condition> <action> the UE shall inform the upper layers of the failure to access the network. </action> </control>
NOTE 1: This can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> <condition> If the mobility and periodic registration update request for initiating an emergency services fallback fails <condition> due to abnormal cases c) or d) </condition> </condition> or <condition> cannot be accepted </condition> and <condition> the UE does not attempt to select an E-UTRA cell connected to EPC or 5GCN as described in subclause 5.5.1.3.5 </condition> and <condition> the UE is camped on NR or E-UTRA cell connected to 5GCN in the same PLMN <condition> where the last mobility and periodic registration update request was attempted, </condition> </condition> </condition> <action> the UE shall inform the upper layers of the failure of the procedure. </action> </control>
NOTE 2: This can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
5.5.1.3.7 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) Timer T3346 is running. </condition> <action> The UE shall not start the registration procedure for mobility and periodic registration update </action> unless: <condition> 1) <condition> the UE is in 5GMM-CONNECTED mode; </condition> 2) <condition> the UE received a paging; </condition> 3) <condition> the UE receives a NOTIFICATION message over non-3GPP access <condition> when the UE is <condition> in 5GMM- CONNECTED mode over non-3GPP access </condition> and <condition> in 5GMM-IDLE mode over 3GPP access; </condition> </condition> </condition> 4) <condition> the UE is a UE configured for high priority access in selected PLMN; </condition> 5) <condition> the UE has an emergency PDU session established or is establishing an emergency PDU session; </condition> 6) <condition> the UE receives a request from the upper layers to perform emergency services fallback; </condition> 7) <condition> the UE receives the CONFIGURATION UPDATE COMMAND message as specified in subclause 5.4.4.3; </condition> 8) <condition> <condition> the UE <condition> in NB-N1 mode </condition> is requested by the upper layer to transmit user data related to an exceptional event </condition> and : <condition> a) <condition> the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ); NASCONFIG </condition> and b) <condition> timer T3346 was not started <condition> when N1 NAS signalling connection was established with RRC establishment cause set to "mo-ExceptionData"; </condition> </condition> </condition> </condition> or 9) <condition> the MUSIM UE needs to request a new 5G-GUTI assignment as specified in subclause 5.5.1.3.2. </condition> </condition> <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> NOTE 1: <control> It is considered an abnormal case <condition> if the UE needs to initiate a registration procedure for mobility and periodic registration update </condition> <condition> while timer T3346 is running independent on whether timer T3346 was started <condition> due to an abnormal case or a non-successful case. </condition> </condition> </control> <control> <condition> If the registration procedure for mobility and periodic registration update was initiated <condition> for an MO MMTEL voice call (i.e. access category 4), </condition> <condition> for an MO MMTEL video call (i.e. access category 5), </condition> <condition> for an MO IMS registration related signalling (i.e. access category 9) </condition> or <condition> for NAS signalling connection recovery during an ongoing MO MMTEL voice call (i.e. access category 4), </condition> or <condition> during an MO MMTEL video call (i.e. access category 5) </condition> or <condition> during an ongoing MO IMS registration related signalling (i.e. access category 9), </condition> </condition> <action> then a notification that the procedure was not initiated due to network congestion shall be provided to upper layers. </action> </control> </control>
<control> <condition> b) The lower layers indicate that the access attempt is barred. </condition> <action> The UE shall not start the registration procedure for mobility and periodic registration update. </action> <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> <action> Receipt of the access barred indication shall not trigger the selection of a different core network type (EPC or 5GCN). </action> <action> The registration procedure for mobility and periodic registration update is started, </action> <condition> if still needed, </condition> <condition> when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated. </condition> </control>
<control> <condition> ba) The lower layers indicate that: 1) <condition> <condition> access barring is applicable for all access categories <condition> except categories 0 and 2 </condition> </condition> and <condition> the access category <condition> with which the access attempt was associated </condition> is other than 0 and 2; </condition> </condition> or 2) <condition> <condition> access barring is applicable for all access categories <condition> except category 0 </condition> </condition> and <condition> the access category <condition> with which the access attempt </condition> was associated is other than 0. </condition> </condition> </condition> <control> <condition> If the REGISTRATION REQUEST message has not been sent, </condition> <action> the UE shall proceed as specified for case b. </action> </control> <control> <condition> If the REGISTRATION REQUEST message has been sent, </condition> <action> the UE shall proceed as specified for case e and, </action> <action> additionally, the registration procedure for mobility and periodic registration update is started, </action> <condition> if still needed, </condition> <condition> when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated. </condition> </control> </control> For additional UE requirements for both cases see subclause 4.5.5.
<control> <condition> c) T3510 timeout. </condition> <action> The UE shall abort the registration update procedure </action> and <action> the N1 NAS signalling connection, <condition> if any, </condition> shall be released locally. </action> <control> <condition> If the UE has initiated the registration procedure <condition> in order to enable performing the service request procedure for emergency services fallback, </condition> </condition> <action> the UE shall inform the upper layers of the failure of the emergency services fallback (see 3GP P TS 24.229 ). </action> </control> <control> <condition> Otherwise, </condition> <action> the UE shall proceed as described below. </action> </control> </control>
<control> <condition> d) <condition> REGISTRATION REJECT message, other 5GMM cause values than those treated in subclause 5.5.1.3.5, </condition> and <condition> cases of 5GMM cause values #11, #15, #22, #31, #72, #73, #74, #75, #76, #77 and #78, <condition> if considered as abnormal cases according to subclause 5.5.1.3.5. </condition> </condition> </condition> <control> <condition> Upon reception of the 5GMM causes #95, #96, #97, #99 and #111 </condition> <action> the UE should set the registration attempt counter to 5. </action> </control> <action> The UE shall proceed as described below. </action> </control>
<control> <condition> e) <condition> Lower layer failure, </condition> <condition> release of the NAS signalling connection received from lower layers </condition> or <condition> the lower layers indicate that the RRC connection has been suspended <condition> without a cell change </condition> <condition> before the REGISTRATION ACCEPT or REGISTRATION REJECT message is received. </condition> </condition> </condition> <action> The UE shall abort the registration procedure and proceed as described below. </action> </control>
<control> <condition> f) Change in the current TAI. </condition> <control> <condition> <condition> If the current TAI is changed <condition> before the registration procedure for mobility </condition> </condition> and <condition> periodic registration update is completed </condition> </condition> , <action> the registration procedure for mobility and periodic registration update shall be aborted and re- initiated immediately. </action> <action> The UE shall set the 5GS update status to 5U2 NOT UPDATED. </action> </control> </control>
<control> <condition> g) Registration procedure for mobility and periodic registration update and de-registration procedure collision. </condition> <control> <condition> If the UE receives a DEREGISTRATION REQUEST message <condition> without 5GMM cause value #11, #12, #13 or #15 </condition> <condition> before the registration procedure for mobility and periodic registration update has been completed, </condition> </condition> <action> the registration procedure for mobility and periodic registration update shall be aborted </action> and <action> the de-registration procedure shall be progressed. </action> </control> </control>
<control> <condition> If the UE receives a DEREGISTRATION REQUEST message <condition> with 5GMM cause value #11, #12, #13 or #15 </condition> <condition> before the registration procedure for mobility and periodic registration update has been completed, </condition> </condition> <action> the registration procedure for mobility and periodic registration update shall be progressed </action> and <action> the de-registration procedure shall be aborted. </action> </control>
NOTE 2: <control> <action> The registration procedure for mobility and periodic registration update shall be aborted </action> <condition> only if the DEREGISTRATION REQUEST message indicates in the access type that <condition> the access <condition> in which the registration procedure for mobility and periodic registration update was attempted </condition> shall be de-registered. </condition> </condition> </control>
<control> <condition> Otherwise </condition> <action> both the procedures shall be progressed. </action> </control>
h) Void
<control> <condition> i) <condition> Transmission failure of REGISTRATION REQUEST message indication from the lower layers </condition> or <condition> the lower layers indicate that the RRC connection has been suspended with a cell change. </condition> </condition> <action> The registration procedure for mobility and periodic registration update shall be aborted and re-initiated immediately. </action> <action> The UE shall set the 5GS update status to 5U2 NOT UPDATED. </action> </control>
<control> <condition> j) Transmission failure of REGISTRATION COMPLETE message indication with change in the current TAI. </condition> <control> <condition> If the current TAI is not in the TAI list, </condition> <action> the registration procedure for mobility and periodic registration update shall be aborted and re-initiated immediately. </action> <action> The UE shall set the 5GS update status to 5U2 NOT UPDATED. </action> </control> </control>
<control> <condition> If the current TAI is still part of the TAI list, </condition> it is up to the UE implementation how to re-run the ongoing </control>
<control> <condition> k) Transmission failure of REGISTRATION COMPLETE message indication without change in the current TAI. </condition> </control>
It is up to the UE implementation how to re-run the ongoing procedure.
<control> <condition> l) UE-initiated de-registration required. </condition> <control> <condition> De-registration <condition> due to removal of USIM or entry update in the "list of subscriber data" </condition> or <condition> due to switch off: </condition> </condition> <action> The registration procedure for mobility and periodic registration update shall be aborted, </action> and <action> the UE initiated de-registration procedure shall be performed. </action> </control> <control> <condition> De-registration <condition> not due to removal of USIM or entry update in the "list of subscriber data" </condition> and <condition> not due to switch off: </condition> </condition> <action> the UE initiated de-registration procedure shall be initiated </action> <condition> after successful completion of the registration procedure for mobility and periodic registration update. </condition> </control> </control>
<control> <condition> m) Timer T3447 is running </condition> <action> The UE shall not start any mobility and periodic registration update procedure with Uplink data status IE or Follow-on request indicator set to "Follow-on request pending" </action> <condition> unless: a) <condition> the UE received a paging; </condition> b) <condition> the UE is a UE configured for high priority access in selected PLMN; </condition> c) <condition> the UE has an emergency PDU session established or is establishing an emergency PDU session; </condition> d) <condition> the UE receives a request from the upper layers to perform emergency services fallback; </condition> or e) <condition> the MUSIM UE needs to request a new 5G-GUTI assignment as specified in subclause 5.5.1.3.2. </condition> </condition> <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> <action> The mobility and periodic registration update procedure is started, </action> <condition> if still necessary, </condition> <condition> when timer T3447 expires or timer T3447 is stopped. </condition> </control>
<control> <condition> n) Timer T3448 is running </condition> <action> The UE in 5GMM-IDLE mode shall not start any mobility and periodic registration update procedure with Follow-on request indicator set to "Follow-on request pending" </action> unless: <condition> 1) <condition> the UE is a UE configured for high priority access in selected PLMN; </condition> 2) <condition> the UE <condition> which is only using 5GS services with control plane CIoT 5GS optimization </condition> received a paging request; </condition> or 3) <condition> <condition> the UE <condition> in NB-N1 mode </condition> is requested by the upper layer to transmit user data <condition> related to an exceptional event </condition> </condition> and <condition> the UE is allowed to use exception data reporting </condition> </condition> </condition> (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF_ NASCONFIG in 3GPP TS 31.102 ). <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> <action> The mobility and periodic registration update procedure is started, </action> <condition> if still necessary, </condition> <condition> when timer T3448 expires. </condition> </control>
<control> For the cases c, d and e the UE shall proceed as follows: <control> <action> Timer T3510 shall be stopped </action> <condition> if still running. </condition> </control> <control> <condition> If the registration procedure is not for initiating an emergency PDU session, </condition> <action> the registration attempt counter shall be incremented, </action> <condition> unless it was already set to 5. </condition> </control> <control> <condition> If the registration attempt counter is less than 5: </condition> <control> <condition> a) <condition> if the TAI of the current serving cell is not included in the TAI list </condition> or <condition> the 5GS update status is different to 5U1 UPDATED </condition> or <condition> if the registration procedure was triggered <condition> due to cases c, g, n, v in subclause 5.5.1.3.2, </condition> </condition> </condition> <action> the UE shall start timer T3511, </action> <action> shall set the 5GS update status to 5U2 NOT UPDATED </action> and <end_state> change to state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE. </end_state> </control> <control> <condition> When timer T3511 expires, </condition> <action> the registration update procedure is triggered again. </action> </control> <control> <condition> b) <condition> if the TAI of the current serving cell is included in the TAI list, </condition> <condition> the 5GS update status is equal to 5U1 UPDATED, </condition> and <condition> the UE is not performing the registration procedure <condition> after an inter-system change from S1 mode to N1 mode, </condition> </condition> </condition> <action> the UE shall keep the 5GS update status to 5U1 UPDATED </action> and <end_state> enter state 5GMM- REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE (as described in subclause 5.3.5.2). </end_state> <action> The UE shall start timer T3511. </action> </control> <control> <condition> <condition> If in addition the REGISTRATION REQUEST message did not include the MICO indication IE or the Extended DRX IE, </condition> and: <condition> c) <condition> the REGISTRATION REQUEST message indicated "periodic registration updating"; </condition> d) <condition> the registration procedure was initiated to recover the NAS signalling connection <condition> due to "RRC Connection failure" from the lower layers; </condition> </condition> or <condition> a) the registration procedure was initiated by the UE <condition> in 5GMM-CONNECTED mode </condition> <condition> with RRC inactive indication entering a cell <condition> in the current registration area belonging to an equivalent PLMN of the registered PLMN </condition> and <condition> not belonging to the registered PLMN, </condition> </condition> </condition> </condition> and <condition> none of the other reasons for initiating the registration updating procedure listed in subclause 5.5.1.3.2 was applicable, </condition> </condition> <action> the timer T3511 may be stopped </action> <condition> when the UE enters 5GMM-CONNECTED mode. </condition> </control> <control> <condition> a) <condition> if the TAI of the current serving cell is included in the TAI list, </condition> <condition> the 5GS update status is equal to 5U1 UPDATED </condition> and <condition> the UE is performing the registration procedure <condition> after an inter-system change from S1 mode to N1 mode, </condition> </condition> </condition> <action> the UE shall change the 5GS update status to 5U2 NOT UPDATED </action> and <end_state> enter state 5GMM- REGISTERED.ATTEMPTING-REGISTRATION-UPDATE. </end_state> <action> The UE shall start timer T3511. </action> </control> <control> <condition> b) <condition> If the procedure is performed via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition handle the EPS update status as specified in 3GPP TS 24.301 </action> <condition> for the abnormal cases <condition> when a normal or periodic tracking area updating procedure fails </condition> and <condition> the tracking area attempt counter is less than 5 </condition> and <condition> the EPS update status is different from EU1 UPDATED. </condition> </condition> </control> <control> <condition> If the registration attempt counter is equal to 5 </condition> a) <action> the UE shall start timer T3502, </action> <action> shall set the 5GS update status to 5U2 NOT UPDATED. </action> b) <action> the UE shall delete the list of equivalent PLMNs </action> <condition> (if any) </condition> and <end_state> shall change to state 5GMM- REGISTERED.ATTEMPTING-REGISTRATION-UPDATE or optionally to 5GMM- REGISTERED.PLMN-SEARCH </end_state> <condition> in order to perform a PLMN selection, SNPN selection or SNPN selection for onboarding services according to 3GPP TS 23.122 . </condition> <control> <condition> c) <condition> if the procedure is performed via 3GPP access </condition> and <condition> the UE is operating in single-registration mode: </condition> </condition> d) <action> the UE shall in addition handle the EPS update status as specified in 3GPP TS 24.301 </action> <condition> for the abnormal cases <condition> when a normal or periodic tracking area updating procedure fails </condition> and <condition> the tracking area attempt counter is equal to 5; </condition> </condition> </control> and <control> <condition> e) if the UE does not change to state 5GMM-REGISTERED.PLMN-SEARCH, </condition> <action> the UE shall attempt to select E-UTRAN radio access technology. </action> <action> The UE may disable the N1 mode capability as specified in subclause 4.9. </action> </control> </control> </control> </control>
5.5.1.3.8 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) <condition> If a lower layer failure occurs <condition> before the message REGISTRATION COMPLETE has been received from the UE </condition> </condition> and <condition> timer T3550 is running, </condition> </condition> <action> the AMF shall abort the procedure, enter 5GMM-IDLE mode. </action> </control>
<control> <condition> If a new 5G-GUTI was assigned to the UE in the REGISTRATION ACCEPT message, </condition> <action> the AMF shall consider both, the old and new 5G-GUTIs as valid </action> <condition> until the old 5G-GUTI can be considered as invalid by the AMF. </condition> </control> <control> <condition> If a new TAI list was provided in the REGISTRATION ACCEPT message, </condition> <action> both the old and new TAI lists shall also be considered valid </action> <condition> until the old TAI list can be considered invalid by the AMF. </condition> </control> <control> <condition> If the old 5G-GUTI was allocated by an AMF other than the current AMF, </condition> <action> the current AMF does not need to retain the old 5G-GUTI. </action> </control>
<control> Additionally, <condition> if the REGISTRATION ACCEPT message includes: </condition> </control>
1) <control> <condition> <condition> Negotiated PEIPS assistance information IE <condition> containing a new Paging subgroup ID </condition> </condition> and <condition> the UE is previously assigned a different Paging subgroup ID </condition> </condition> then, <action> the AMF shall consider both, the old and new Paging subgroup IDs as valid </action> <condition> until the old Paging subgroup ID can be considered as invalid by the AMF; </condition> </control> or
2) <control> <condition> Negotiated PEIPS assistance information IE containing no Paging subgroup ID or no Negotiated PEIPS assistance information IE, </condition> <action> then the AMF shall delete any old Paging subgroup ID stored in the 5GMM context of the UE. </action> </control>
<control> <condition> During this period: </condition> </control>
1) <control> <condition> if the new 5G-GUTI is used by the UE in a subsequent message, </condition> then: </control>
<control> i) <action> the AMF shall consider the old 5G-GUTI as invalid and, additionally, the old TAI list as invalid </action> <condition> if a new TAI list was provided with the new 5G-GUTI in the REGISTRATION ACCEPT message; </condition> and </control>
<control> ii) <condition> if the AMF assigns a new Paging subgroup ID to the UE in the REGISTRATION ACCEPT message, </condition> then, <action> the AMF shall consider the new Paging subgroup ID as valid and the old Paging subgroup ID, <condition> if any, </condition> as invalid. </action> </control>
2) <control> <condition> if the old 5G-GUTI is used by the UE in a subsequent message, </condition> <action> the AMF may use the identification procedure followed by a generic UE configuration update procedure. </action> <control> <condition> If the AMF in the REGISTRATION ACCEPT message: </condition> </control> </control>
<control> <condition> i) assigns a new Paging subgroup ID to the UE, </condition> then, <action> the AMF shall include the PEIPS assistance information; </action> </control> or
<control> ii) <condition> does not assign a Paging subgroup ID to the UE </condition> then, <action> the AMF shall not include the PEIPS assistance information; and initiate the generic UE configuration update procedure; </action> </control> and
3) <control> <condition> if the UE needs to be paged: </condition> </control>
<control> i) if in the REGISTRATION ACCEPT message: <control> <condition> a) a new Paging subgroup ID is assigned to the UE <condition> that previously has no Paging subgroup ID assigned </condition> </condition> then, <action> the AMF shall use the new Paging subgroup ID for paging the UE; </action> </control> <control> <condition> b) a new Paging subgroup ID is assigned to the UE <condition> that is same as the old Paging subgroup ID </condition> </condition> then, <action> the AMF shall use the same Paging subgroup ID for paging the UE; </action> </control> and c) <control> <condition> a new Paging subgroup ID is assigned to the UE <condition> that is different than the old Paging subgroup ID </condition> </condition> then, <action> the AMF may first use the old Paging subgroup ID followed by the new Paging subgroup ID for paging the UE. </action> </control> </control>
<control> ii) the AMF selects the 5G-GUTI and TAI list as follows: a) <action> the AMF may first use the old 5G-S-TMSI from the old 5G-GUTI for paging within the area defined by the old TAI list for an implementation dependent number of paging attempts using the selected Paging subgroup ID. </action> <control> <condition> If a new TAI list was provided in the REGISTRATION ACCEPT message, </condition> <action> the new TAI list should also be used for paging. </action> </control> <control> <condition> Upon response from the UE, </condition> <action> the AMF may initiate the generic UE configuration update procedure. </action> </control> <control> <condition> If the response is received from a tracking area <condition> within the old and new TAI list, </condition> </condition> <action> the network shall initiate the generic UE configuration update procedure. </action> </control> <control> <condition> If in the REGISTRATION ACCEPT message a new Paging subgroup ID was assigned to the UE <condition> that is different than the old Paging subgroup ID </condition> </condition> then <action> the network shall initiate the generic UE configuration update procedure; </action> </control> and <control> <condition> a) if no response is received to the paging attempts <condition> using the old 5G-S-TMSI from the old 5G-GUTI and the old Paging subgroup ID, </condition> </condition> <action> the AMF may use the new 5G-S-TMSI from the new 5G-GUTI and the new Paging subgroup ID, <condition> if any, </condition> for paging, for an implementation dependent number of paging attempts. </action> </control> <control> <condition> In this case, if a new TAI list was provided <condition> with the new 5G-GUTI in the REGISTRATION ACCEPT message, </condition> </condition> <action> the new TAI list shall be used instead of the old TAI list. </action> </control> </control>
<control> <condition> b) Protocol error. </condition> </control>
<control> <condition> If the REGISTRATION REQUEST message has been received with a protocol error, </condition> <action> the AMF shall return a REGISTRATION REJECT message with one of the following 5GMM cause values: </action> </control>
<control> <action> #96 invalid mandatory information; #99 information element non-existent or not implemented; #100 conditional IE error; or #111 protocol error, unspecified. </action> </control>
<control> <condition> c) T3550 time out. </condition> </control>
<control> <condition> On the first expiry of the timer, </condition> <action> the AMF shall retransmit the REGISTRATION ACCEPT message </action> and <action> shall reset and restart timer T3550. </action> <action> The retransmission is performed four times, i.e. on the fifth expiry of timer T3550, the registration procedure for mobility and periodic update procedure is aborted. </action> </control>
<control> <condition> If a new 5G-GUTI was assigned to the UE in the REGISTRATION ACCEPT message, </condition> <action> both, the old and new 5G-GUTI shall be considered as valid </action> <condition> until the old 5G-GUTI can be considered as invalid by the AMF. </condition> </control> <control> <condition> If a new TAI list was provided in the REGISTRATION ACCEPT message, </condition> <action> both the old and new TAI lists shall also be considered valid </action> <condition> until the old TAI list can be considered invalid by the AMF. </condition> </control> <control> <condition> If the old 5G-GUTI was allocated by an AMF other than the current AMF, </condition> <action> the current AMF does not need to retain the old 5G-GUTI. </action> </control> <control> <condition> During this period </condition> <action> the AMF acts as described for case a) above. </action> </control>
<control> <condition> d) REGISTRATION REQUEST <condition> with 5GS registration type IE set to "mobility registration updating" or "periodic registration updating" </condition> <condition> received after the REGISTRATION ACCEPT message has been sent </condition> and <condition> before the REGISTRATION COMPLETE message is received, </condition> <condition> if the REGISTRATION COMPLETE message is expected. </condition> </condition> </control>
1) <control> <condition> If one or more of the information elements <condition> in the REGISTRATION REQUEST message </condition> differ from the ones <condition> received within the previous REGISTRATION REQUEST message, </condition> </condition> <action> the previously initiated registration procedure for mobility and periodic registration update shall be aborted </action> <condition> if the REGISTRATION COMPLETE message has not been received </condition> and <action> the new registration procedure for mobility and periodic registration update shall be progressed; </action> </control> or
2) <control> <condition> if the information elements do not differ, </condition> <action> then the REGISTRATION ACCEPT message shall be resent </action> and <action> timer T3550 shall be restarted. </action> <action> In that case, the retransmission counter related to timer T3550 is not incremented. </action> </control>
<control> <condition> e) <condition> More than one REGISTRATION REQUEST message <condition> with 5GS registration type IE set to "mobility registration updating" or "periodic registration updating" </condition> received </condition> and <condition> neither REGISTRATION ACCEPT message nor REGISTRATION REJECT message has been sent. </condition> </condition> </control>
1) <control> <condition> If one or more of the information elements <condition> in the REGISTRATION REQUEST message </condition> differs from the ones <condition> received within the previous REGISTRATION REQUEST message, </condition> </condition> <action> the previously initiated registration procedure for mobility and periodic registration update shall be aborted </action> and <action> the new registration procedure for mobility and periodic registration update shall be progressed; </action> </control> or
2) <control> <condition> if the information elements do not differ, </condition> <action> then the network shall continue with the previous registration procedure for mobility and periodic registration update </action> and <action> shall not treat any further this REGISTRATION REQUEST message. </action> </control>
<control> <condition> f) Lower layers indication of non-delivered NAS PDU due to handover. </condition> </control>
<control> <condition> <condition> If the REGISTRATION ACCEPT message or REGISTRATION REJECT message could not be delivered <condition> due to an intra AMF handover </condition> and <condition> the target TA is included in the TAI list, </condition> </condition> </condition> then <control> <condition> upon successful completion of the intra AMF handover </condition> <action> the AMF shall retransmit the REGISTRATION ACCEPT message or REGISTRATION REJECT message. </action> </control> </control> <control> <condition> <condition> If a failure of the handover procedure is reported by the lower layer </condition> and <condition> the N1 NAS signalling connection exists, </condition> </condition> <action> the AMF shall retransmit the REGISTRATION ACCEPT message or REGISTRATION REJECT message. </action> </control>
<control> <condition> g) DEREGISTRATION REQUEST message received <condition> before REGISTRATION COMPLETE message is received, </condition> <condition> if the REGISTRATION COMPLETE message is expected. </condition> </condition> </control>
<control> <condition> If the De-registration type IE is set to "switch off": </condition> </control>
<control> <action> The AMF shall abort the signalling for the registration procedure for mobility and periodic update towards the UE </action> and <action> shall progress the de-registration procedure as described in subclause 5.5.2.2. </action> </control>
NOTE 1: <control> <condition> Internally in the AMF, </condition> <condition> before processing the de-registration request, </condition> the AMF can perform the necessary signalling procedures for the registration procedure for mobility and periodic update before progressing the de-registration procedure. </control>
<control> <condition> If the De-registration type IE is set to other type than "switch off": </condition> </control>
<control> <action> The AMF shall proceed with registration procedure for mobility and periodic update </action> and <action> shall progress the de-registration procedure </action> <condition> after successful completion of the registration procedure for mobility and periodic update </condition> </control>
<control> <condition> h) If the REGISTRATION REQUEST message <condition> with 5GS registration type IE indicating "periodic registration updating" </condition> is received by the new AMF <condition> which does not have the 5GMM context data related to the subscription, </condition> </condition> <action> the new AMF may send the REGISTRATION REJECT message with 5GMM cause #10 "implicitly de- registered". </action> </control>
<control> <condition> i) Based on operator policy, if the mobility and periodic registration update request <condition> from a UE not supporting CAG </condition> is rejected <condition> due to CAG restrictions, </condition> </condition> <action> the network shall reject the mobility and periodic registration update request with a 5GMM cause value other than the 5GMM cause #76 (Not authorized for this CAG or authorized for CAG cells only). </action> </control>
NOTE 2: <control> 5GMM cause #7 (5GS services not allowed), 5GMM cause #11 (PLMN not allowed), 5GMM cause #27 (N1 mode not allowed), 5GMM cause #73 (Serving network not authorized) can be used <condition> depending on the subscription of the UE and whether the UE roams or not. </condition> </control>
5.5.2 De-registration procedure
5.5.2.1 General
<control> The de-registration procedure <action> is used: </action> </control>
<control> a) by the UE to de-register for 5GS services over 3GPP access <condition> when the UE is registered over 3GPP access; </condition> </control>
<control> b) by the UE to de-register for 5GS services over non-3GPP access <condition> when the UE is registered over non-3GPP access; </condition> </control>
<control> c) by the UE to de-register for 5GS services over 3GPP access, non-3GPP access or both <condition> when the UE is registered in the same PLMN over both accesses; </condition> </control>
<control> d) by the network to inform the UE that it is deregistered for 5GS services over 3GPP access <condition> when the UE is registered over 3GPP access; </condition> </control>
<control> e) by the network to inform the UE that it is deregistered for 5GS services over non-3GPP access <condition> when the UE is registered over non-3GPP access; </condition> </control>
<control> f) by the network to inform the UE that it is deregistered for 5GS services over 3GPP access, non-3GPP access or both <condition> when the UE is registered in the same PLMN over both accesses; </condition> </control>
<control> g) by the network to inform the UE to re-register to the network; and </control>
<control> h) by the network to inform the UE supporting UAS service that it is deregistered for UAS services in 5GS. </control>
<control> <action> The de-registration procedure with appropriate de-registration type shall be invoked by the UE: </action> </control>
<control> <condition> a) if the UE is switched off; </condition> </control>
<control> <condition> b) as part of the eCall inactivity procedure defined in subclause 5.5.3; </condition> and </control>
<control> <condition> c) as part of USIM removal. </condition> </control>
<control> <action> The de-registration procedure with appropriate de-registration type shall be invoked by the network: </action> </control>
<control> <condition> a) if the network informs whether the UE should re-register to the network. </condition> </control>
<control> <action> The de-registration procedure with appropriate access type shall be invoked by the UE: </action> </control>
<control> <condition> a) if the UE needs to de-register for 5GS services over 3GPP access <condition> when the UE is registered over 3GPP access; </condition> </condition> </control>
<control> <condition> b) if the UE needs to de-register for 5GS services over non-3GPP access <condition> when the UE is registered over non-3GPP access; </condition> </condition> </control>
<control> <condition> c) the UE needs to de-register for 5GS services over 3GPP access, non-3GPP access or both <condition> when the UE is registered in the same PLMN over both accesses; </condition> </condition> or </control>
<control> <condition> d) to de-register for 5GS services over 3GPP access, <condition> <condition> if the UE is registered for disaster roaming over 3GPP access </condition> and <condition> has successfully registered over non-3GPP access on another PLMN. </condition> </condition> </condition> </control>
<control> <action> The de-registration procedure with appropriate access type shall be invoked by the network: </action> </control>
<control> <condition> a) if the network needs to inform the UE <condition> that it is deregistered over 3GPP access </condition> <condition> when the UE is registered over 3GPP access; </condition> </condition> </control>
<control> <condition> b) if the network needs to inform the UE <condition> that it is deregistered </condition> over non-3GPP access <condition> when the UE is registered over non-3GPP access; </condition> </condition> or </control>
<control> <condition> c) if the network needs to inform the UE <condition> that it is deregistered over 3GPP access, non-3GPP access or both </condition> <condition> when the UE is registered in the same PLMN over both accesses. </condition> </condition> </control>
<control> <condition> If the de-registration procedure is triggered <condition> due to USIM removal, </condition> </condition> <action> the UE shall indicate "switch off" in the de-registration type IE. </action> </control>
<control> <condition> If the de-registration procedure is requested by the network <condition> for a UE that has an emergency PDU session, </condition> </condition> <action> the AMF shall not send a DEREGISTRATION REQUEST message to the UE </action> and <action> indicate to the SMF to release all non- emergency PDU sessions as specified in 3GPP TS 23.502 . </action> </control>
<control> <condition> If the de-registration procedure for 5GS services is performed, </condition> <action> a local release of the PDU sessions over the indicated access(es), <condition> if any, </condition> for this particular UE is performed. </action> </control> <control> <condition> If a PDU session that will be released <condition> is associated with one or more MBS sessions, </condition> </condition> <action> the UE is considered as removed from the associated MBS sessions. </action> </control>
<control> <action> The UE is allowed to initiate the de-registration procedure </action> <condition> even if the timer T3346 is running. </condition> </control>
NOTE 1: <control> <condition> <condition> When the UE has no PDU sessions over non-3GPP access, </condition> or <condition> the UE moves all the PDU sessions over a non-3GPP access to a 3GPP access, </condition> </condition> <action> the UE and the AMF need not initiate de-registration over the non- 3GPP access. </action> </control>
<control> <action> The AMF shall provide the UE with a non-3GPP de-registration timer. </action> </control>
<control> <start_state> When the AMF enters the state 5GMM-DEREGISTERED for 3GPP access, </start_state> <action> the AMF shall delete the stored UE radio capability information or the UE radio capability ID, </action> <condition> if any. </condition> </control>
<control> <condition> When upper layers indicate that emergency services are no longer required, </condition> <action> the UE <condition> if still registered for emergency services, </condition> may perform UE-initiated de-registration procedure followed by a re-registration to regain normal services, </action> <condition> if the UE is in or moves to a suitable cell. </condition> </control>
<control> <condition> If the UE is registered for onboarding services in SNPN, <condition> after completing the configuration of one or more entries of the "list of subscriber data", </condition> </condition> <action> the UE should perform UE-initiated de-registration procedure. </action> </control> <control> <condition> <condition> <condition> To prevent the UE <condition> registered for onboarding services in SNPN </condition> from staying on the ON-SNPN </condition> or <condition> to prevent a UE <condition> whose subscription only allows for configuration of SNPN subscription parameters <condition> in PLMN via the user plane, </condition> </condition> </condition> from staying registered indefinitely, </condition> when an implementation specific timer expires: </condition> <control> <condition> a) if the AMF considers that the UE is in 5GMM-IDLE, </condition> <action> the AMF shall locally de-registers the UE; </action> </control> or <control> <condition> b) if the UE is in 5GMM-CONNECTED, </condition> <action> the AMF shall initiate the network-initiated de-registration procedure (see subclause 5.5.2.3). </action> </control> </control>
NOTE 2: <control> The value of the implementation specific timer for onboarding services needs to be large enough to allow a UE to complete the configuration of one or more entries of the "list of subscriber data" taking into consideration that <condition> configuration of SNPN subscription parameters in PLMN via the user plane or onboarding services in SNPN involves third party entities outside of the operator's network. </condition> </control>
NOTE 3: How to determine the completion of the configuration of one or more entries of the "list of subscriber data" is UE implementation specific.
<control> <condition> <condition> If the de-registration procedure is not due to switch off </condition> and <condition> upper layers request establishing an emergency PDU session <condition> before the de-registration procedure has been completed, </condition> </condition> </condition> <action> the UE shall abort the deregistration procedure, </action> <action> perform local de-registration and initiate a registration procedure. </action> </control>
<control> <condition> If the UE <condition> in 5GMM-CONNECTED mode </condition> determines to obtain service on a higher priority PLMN <condition> due to SOR, </condition> then <condition> based on the conditions as specified in 3GPP TS 23.122 annex C, </condition> <condition> where applicable, </condition> </condition> <action> the UE shall perform UE- initiated de-registration procedure. </action> </control>
<control> <condition> <condition> If the UE is registered for disaster roaming services, </condition> and the UE receives an indication of whether disaster roaming is enabled in the UE <condition> set to "Disaster roaming is disabled in the UE" in a UE parameters update transparent container, </condition> </condition> <action> the UE shall perform UE-initiated de-registration procedure. </action> </control>
<control> <action> The de-registration procedure is initiated by the UE by sending a DEREGISTRATION REQUEST message (see example in figure 5.5.2.2.1). </action> </control> The De-registration type IE included in the message indicates whether the de-registration procedure is due to a "switch off" or not. The access type included in the message indicates whether the de-registration procedure is:
<control> a) for 5GS services over 3GPP access <condition> when the UE is registered over 3GPP access; </condition> </control>
<control> b) for 5GS services over non-3GPP access <condition> when the UE is registered over non-3GPP access; </condition> or </control>
<control> c) for 3GPP access, non-3GPP access or both <condition> when the UE is registered in the same PLMN over both accesses. </condition> </control>
<control> <condition> If the UE has a valid 5G-GUTI, </condition> <action> the UE shall populate the 5GS mobile identity IE with the valid 5G-GUTI. </action> </control> <control> <condition> If the UE does not have a valid 5G-GUTI, </condition> <action> the UE shall populate the 5GS mobile identity IE with its SUCI as follows: </action> </control>
<control> <condition> a) if timer T3519 is not running, </condition> <action> generate a fresh SUCI as specified in 3GPP TS 33.501 , </action> <action> send a DEREGISTRATION REQUEST message with the SUCI, </action> <action> start timer T3519 and store the value of the SUCI sent in the DEREGISTRATION REQUEST message; </action> </control> and
<control> <condition> b) if timer T3519 is running, </condition> <action> send a DEREGISTRATION REQUEST message with the stored SUCI. </action> </control>
<control> <condition> <condition> If the UE does not have a valid 5G-GUTI </condition> and <condition> it does not have a valid SUCI, </condition> </condition> <action> then the UE shall populate the5GS mobile identity IE with its PEI. </action> </control>
<control> <condition> <condition> If the de-registration request is not due to switch off </condition> and <start_state> the UE is in the state 5GMM-REGISTERED or 5GMM- REGISTERED-INITIATED, </start_state> </condition> <action> timer T3521 shall be started in the UE </action> <condition> after the DEREGISTRATION REQUEST message has been sent. </condition> <end_state> The UE shall enter the state 5GMM-DEREGISTERED-INITIATED. </end_state> </control>
<control> <condition> If the UE is to be switched off, </condition> <action> the UE shall try for a period of 5 seconds to send the DEREGISTRATION REQUEST message. </action> <control> <condition> During this period, </condition> <action> the UE may be switched off </action> <condition> as soon as the DEREGISTRATION REQUEST message has been sent. </condition> </control> </control>
<control> <condition> When the DEREGISTRATION REQUEST message is received by the AMF, </condition> <action> the AMF shall send a DEREGISTRATION ACCEPT message to the UE, </action> <condition> if the De-registration type IE does not indicate "switch off". </condition> </control>
<control> <condition> Otherwise, </condition> <action> the procedure is completed </action> <condition> when the AMF receives the DEREGISTRATION REQUEST message. </condition> </control>
<control> The UE, <condition> when receiving the DEREGISTRATION ACCEPT message, </condition> <action> shall stop timer T3521, </action> <action> stop timer T3519 </action> <condition> if running, </condition> and <action> delete any stored SUCI. </action> </control>
5.5.2.2.3 UE-initiated de-registration procedure completion for 5GS services over 3GPP access
<control> <condition> If the access type <condition> in the DEREGISTRATION REQUEST message </condition> indicates that the de-registration procedure is for 3GPP access, </condition> <action> the AMF shall trigger the SMF to perform a local release of the PDU session(s) established over 3GPP access, <condition> if any, </condition> for this UE. </action> <action> The UE shall perform a local release of the PDU session(s) established over 3GPP access, </action> <condition> if any. </condition> </control> <control> <condition> If a PDU session is associated with one or more MBS sessions, </condition> <action> the UE shall locally leave the associated MBS sessions </action> and <action> the SMF shall consider the UE as removed from the associated MBS sessions. </action> </control> <control> <condition> If there is an MA PDU session <condition> with user plane resources established on both 3GPP access and non-3GPP access </condition> in the same PLMN or in different PLMNs, </condition> <action> the AMF shall trigger SMF to perform release of user plane resources on 3GPP access, </action> and <action> the UE shall consider the user plane resources on 3GPP access as released. </action> </control> <control> <condition> If there is an MA PDU session <condition> with user plane resources established on 3GPP access only, </condition> </condition> <action> the AMF shall trigger the SMF to perform a local release of the MA PDU session, </action> and <action> the UE shall perform a local release of the MA PDU session. </action> </control> <control> <action> The UE is marked as inactive in the AMF for 5GS services for 3GPP access. </action> <end_state> The AMF shall enter the state 5GMM-DEREGISTERED for 3GPP access. </end_state> </control>
<control> <condition> <condition> If the UE supports N1 mode only </condition> and <condition> the de-registration request is not due to switch off, </condition> </condition> then: </control>
<control> <condition> a) if the de-registration procedure was performed <condition> due to disabling of 5GS services, </condition> </condition> <end_state> then the UE shall enter the 5GMM-NULL state for 3GPP access; </end_state> </control>
<control> <condition> b) otherwise, </condition> <end_state> the UE shall enter the 5GMM-DEREGISTERED state for 3GPP access. </end_state> </control>
NOTE: Case b) is applicable when the UE is also registered over non-3GPP access.
<control> <condition> <condition> If the access type indicates that the de-registration procedure is for 3GPP access or for 3GPP access and non-3GPP access, </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> it shall additionally proceed as specified in 3GPP TS 24.301 , subclause 5.5.2.2.2, </action> <condition> for the case when the UE receives an EMM message DETACH ACCEPT. </condition> </control>
<control> Furthermore, <condition> if the UE supports A/Gb or Iu mode, </condition> <action> it shall disable the N1 mode capability for 3GPP access. </action> </control>
5.5.2.2.4 UE-initiated de-registration procedure completion for 5GS services over non- 3GPP access
<control> <condition> If the access type <condition> in the DEREGISTRATION REQUEST </condition> indicates that the de-registration procedure is for non-3GPP access, </condition> <action> the AMF shall trigger SMF to perform a local release of the PDU session(s) established over non-3GPP access, <condition> if any, </condition> for this UE. </action> <action> The UE shall perform a local release of the PDU session(s) established over non-3GPP access, </action> <condition> if any. </condition> </control> <control> <condition> If there is an MA PDU session <condition> with user plane resources established on both 3GPP access and non-3GPP access </condition> in the same PLMN or in different PLMNs, </condition> <action> the AMF shall trigger SMF to perform release of user plane resources on non- 3GPP access, </action> and <action> the UE shall consider the user plane resources on non-3GPP access as released. </action> </control> <control> <condition> <condition> If there is an MA PDU session with a PDN connection as a user-plane resource </condition> and <condition> user plane resources established on non-3GPP access, </condition> </condition> <action> the AMF shall trigger SMF to perform release of user plane resources on non-3GPP access, </action> and ,action> the UE shall consider the user plane resources on non-3GPP access as released. </control> <control> <condition> If the UE has an MA PDU session <condition> with user plane resources established on non-3GPP access only, </condition> </condition> <action> the AMF shall trigger the SMF to perform a local release of the MA PDU session, </action> and <action> the UE shall perform a local release of the MA PDU session. </action> </control> <control> <action> The UE is marked as inactive in the AMF for 5GS services for non-3GPP access. </action> <end_state> The AMF shall enter the state 5GMM-DEREGISTERED over non-3GPP access. </end_state> </control>
<control> <condition> If the de-registration request is not due to switch off, </condition> the UE shall: </control>
<control> <condition> a) if the de-registration procedure was performed <condition> due to disabling of 5GS services, </condition> </condition> <end_state> enter the 5GMM-NULL state for non-3GPP access; </end_state> </control>
<control> <condition> b) otherwise, </condition> <end_state> enter the 5GMM-DEREGISTERED state for non-3GPP access. </end_state> </control>
NOTE: <control> Case b) is applicable <condition> when the UE is also registered over 3GPP access. </condition> </control>
5.5.2.2.5 UE-initiated de-registration procedure completion for 5GS services over both 3GPP access and non-3GPP access
<control> <condition> If the access type <condition> in the DEREGISTRATION REQUEST </condition> indicates that the de-registration procedure is for both 3GPP access and non-3GPP access <condition> when the UE is registered in the same PLMN over both accesses, </condition> </condition> <action> the descriptions for UE- initiated de-registration procedure completion for 5GS services over 3GPP access and over non-3GPP access, as specified in subclauses 5.5.2.2.3 and 5.5.2.2.4, shall be followed. </action> </control>
5.5.2.2.6 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) Lower layer failure or release of the N1 NAS signalling connection <condition> before reception of DEREGISTRATION ACCEPT message. </condition> </condition> </control>
<control> <action> The de-registration procedure shall be aborted </action> and the UE proceeds as follows: </control>
1) <control> <condition> if the de-registration procedure was performed <condition> due to disabling of 5GS services, </condition> </condition> <end_state> the UE shall enter the 5GMM-NULL state; </end_state> </control> or
2) <control> <condition> if the de-registration type "normal de-registration" was requested for reasons other than disabling of 5GS services, </condition> <end_state> the UE shall enter the 5GMM-DEREGISTERED state . </end_state> </control>
<control> <condition> b) The lower layers indicate that the access attempt is barred. </condition> </control>
<control> <action> The UE shall not start the de-registration signalling procedure. </action> <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> <action> Receipt of the access barred indication shall not trigger the selection of a different core network type (EPC or 5GCN). </action> </control>
<control> <action> The UE may perform a local de-registration </action> <condition> either immediately or after an implementation-dependent time. </condition> </control>
<control> <action> The de-registration signalling procedure is started, </action> <condition> if still needed, </condition> <condition> when the lower layers indicate that the barring is alleviated for the access category <condition> with which the access attempt was associated. </condition> </condition> </control>
<control> <condition> ba) The lower layers indicate that: </condition> </control>
<control> 1) <condition> <condition> access barring is applicable for all access categories <condition> except categories 0 and 2 </condition> </condition> and <condition> the access category <condition> with which the access attempt was associated </condition> is other than 0 and 2; </condition> </condition> or </control>
<control> 2) <condition> <condition> access barring is applicable for all access categories <condition> except category 0 </condition> </condition> and <condition> the access category <condition> with which the access attempt was associated </condition> is other than 0. </condition> </condition> </control>
<control> <condition> If the DEREGISTRATION REQUEST message has not been sent, </condition> <action> the UE shall proceed as specified for case b. </action> </control>
<control> <condition> If the DEREGISTRATION REQUEST message has been sent, </condition> <action> the UE shall proceed as specified for case a. </action> </control>
<control> <condition> c) T3521 timeout. </condition> </control>
<control> <condition> If the de-registration procedure was performed based on conditions specified in 3GPP TS 23.122 annex C, </condition> <control> <condition> on the expiry of timer T3521 </condition> <action> the de-registration procedure shall be aborted </action> and <action> the UE shall locally release the established N1 NAS signalling connection </action> and <end_state> enter the 5GMM-DEREGISTERED state. </end_state> </control> </control>
<control> <condition> Otherwise, </condition> <control> <condition> on the first four expiries of the timer, </condition> <action> the UE shall retransmit the DEREGISTRATION REQUEST message </action> and <action> shall reset and restart timer T3521. </action> </control> </control> <control> <condition> On the fifth expiry of timer T3521, </condition> <action> the de-registration procedure shall be aborted </action> and the UE proceeds as follows: </control>
1) <control> <condition> if the de-registration procedure was performed <condition> due to disabling of 5GS services, </condition> </condition> <end_state> the UE shall enter the 5GMM-NULL state; </end_state> </control> or
2) <control> <condition> if the de-registration type "normal de-registration" was requested for reasons other than disabling of 5GS services, </condition> <end_state> the UE shall enter the 5GMM-DEREGISTERED state. </end_state> </control>
<control> <condition> d) De-registration procedure collision. </condition> </control>
<control> <condition> De-registration containing de-registration type "switch off": </condition> <control> <condition> a) If the UE receives a DEREGISTRATION REQUEST message <condition> before the UE-initiated de-registration procedure has been completed, </condition> </condition> <action> this message shall be ignored </action> and <action> the UE-initiated de-registration procedure shall continue. </action> </control> </control>
<control> <condition> Otherwise: </condition> <control> <condition> a) If the UE receives a DEREGISTRATION REQUEST message <condition> before the UE-initiated de-registration procedure has been completed, </condition> </condition> <action> it shall treat the message as specified in subclause 5.5.2.3.2 with the following modification: </action> </control> <control> <condition> b) <condition> If the DEREGISTRATION REQUEST message <condition> received by the UE </condition> contains de-registration type "re- registration required", </condition> and <condition> the UE-initiated de-registration procedure is with de-registration type "normal de-registration", </condition> </condition> <action> the UE need not initiate the registration procedure for initial registration. </action> </control> </control>
<control> <condition> e) De-registration and 5GMM common procedure collision. </condition> </control>
<control> <condition> De-registration containing de-registration type "switch off": </condition> <control> <condition> a) If the UE receives a message <condition> used in a 5GMM common procedure </condition> <condition> before the de-registration procedure has been completed, </condition> </condition> <action> this message shall be ignored </action> and <action> the de-registration procedure shall continue. </action> </control> </control>
<control> <condition> Otherwise: </condition> <control> <condition> a) If the UE receives a message used in a 5GMM common procedure <condition> before the de-registration procedure has been completed, </condition> </condition> <action> both the 5GMM common procedure and the de-registration procedure shall continue; </action> </control> or <control> <condition> b) If the UE receives a DL NAS TRANSPORT message containing payload container type "Service-level-AA container" <condition> before the de-registration procedure has been completed, </condition> </condition> <action> this message shall be ignored </action> and <action> the de-registration procedure shall continue. </action> </control> </control>
<control> <condition> f) Change in the current TAI. </condition> </control>
<control> <condition> If that the current TAI is not in the stored TAI list <condition> before the UE-initiated de-registration procedure is completed, </condition> </condition> the UE proceeds as follows: </control>
1) <control> <condition> <condition> if the de-registration procedure was initiated for reasons other than removal of the USIM, </condition> <condition> the UE is to be switched off or due to the last Tsor-cm timer expiry or stopped (see 3GPP TS 23.122 ), </condition> </condition> <action> the de-registration procedure shall be aborted and re-initiated </action> <condition> after successfully performing a registration procedure for mobility or periodic update used for mobility (i.e. the 5GS registration type IE set to "mobility registration updating" in the REGISTRATION REQUEST message); </condition> </control> or
2) <control> <condition> <condition> if the de-registration procedure was initiated <condition> due to removal of the USIM </condition> </condition> or <condition> the UE is to be switched off or due to the last Tsor-cm timer expiry or stopped </condition> </condition> (see 3GPP TS 23.122 ), <action> the UE shall abort the de-registration procedure, </action> <action> perform a local de-registration </action> and <end_state> enter the state 5GMM-DEREGISTERED. </end_state> </control>
<control> <condition> g) Transmission failure of DEREGISTRATION REQUEST message indication with change in the current TAI. </condition> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> the UE proceeds as follows: </control>
1) <control> <condition> <condition> if the de-registration procedure was initiated for reasons other than removal of the USIM , </condition> <condition> the UE is to be switched off or due to the last Tsor-cm timer expiry or stopped (see 3GPP TS 23.122 ), </condition> </condition> <action> the de-registration procedure shall be aborted and re-initiated </action> <condition> after successfully performing a registration procedure for mobility or periodic update; </condition> </control> or
2) <control> <condition> <condition> if the de-registration procedure was initiated <condition> due to removal of the USIM </condition> or <condition> </condition> the UE is to be switched off or due to the last Tsor-cm timer expiry or stopped (see 3GPP TS 23.122 ), </condition> </condition> <action> the UE shall abort the de-registration procedure, </action> <action> perform a local de-registration </action> and <end_state> enter the state 5GMM-DEREGISTERED. </end_state> </control>
<control> <condition> If the current TAI is still part of the TAI list, </condition> <action> the UE shall restart the de-registration procedure. </action> </control>
<control> <condition> h) Transmission failure of DEREGISTRATION REQUEST message indication without change in the current TAI. </condition> </control>
<control> <action> The UE shall restart the de-registration procedure. </action> </control>
<control> <condition> i) The lower layers indicate that the RRC connection has been suspended. </condition> </control>
<control> <condition> De-registration containing de-registration type "switch off": </condition> a) <action> The UE may perform a local de-registration </action> <condition> either immediately or after an implementation-dependent time. </condition> </control>
<control> <condition> Otherwise: </condition> a) <action> The UE shall wait for an implementation-dependent time </action> and shall <action> restart the de-registration procedure, </action> <condition> if still needed, </condition> <condition> upon expiry of the implementation-dependent time. </condition> </control>
<control> <condition> For the cases a, f, g and i: </condition> a) <action> Timer T3521 shall be stopped </action> <condition> if still running. </condition> </control>
5.5.2.2.7 Abnormal cases in the network side
The following abnormal cases can be identified:
<control> <condition> a) De-registration request received in a cell belonging to an SNPN <condition> with a non-globally-unique SNPN identity <condition> for which the UE has no valid subscription </condition> </condition> </condition> </control>
<control> <condition> <condition> If the UE initiates a de-registration procedure in a cell belonging to an SNPN <condition> with a non-globally-unique SNPN identity <condition> for which the UE has no valid subscription, </condition> </condition> </condition> and <condition> the de-registration procedure is not due to "switch off", </condition> </condition> <action> the network shall initiate the de-registration procedure. </action> <action> The AMF shall send a DEREGISTRATION REQUEST message including the 5GMM cause #74 "Temporarily not authorized for this SNPN". </action> </control>
<control> <condition> b) De-registration request received in a cell belonging to an SNPN <condition> with a globally-unique SNPN identity </condition> <condition> for which the UE has no valid subscription </condition> </condition> </control>
<control> <condition> <condition> If the UE initiates a de-registration procedure in a cell belonging to an SNPN <condition> with a globally-unique SNPN identity <condition> for which the UE has no valid subscription, </condition> </condition> </condition> and <condition> the de-registration procedure is not due to "switch off", </condition> </condition> <action> the network shall initiate the de-registration procedure. </action> <action> The AMF shall send a DEREGISTRATION REQUEST message including the 5GMM cause #75 "Permanently not authorized for this SNPN". </action> </control>
<control> <condition> c) <condition> De-registration request received in a CAG cell </condition> and <condition> none of the CAG ID <condition> broadcasted by the CAG cell </condition> is included in the UE's "allowed CAG list" for the current PLMN </condition> </condition> </control>
<control> <condition> <condition> <condition> If the UE initiates a de-registration procedure in a CAG cell </condition> and <condition> none of the CAG ID <condition> broadcasted by the CAG cell </condition> is included in the UE's "allowed CAG list" for the current PLMN </condition> </condition> and <condition> the de-registration procedure is not due to "switch off", </condition> </condition> <action> the AMF shall initiate the de-registration procedure. </action> <action> The AMF shall send a DEREGISTRATION REQUEST message including the 5GMM cause #76 "Not authorized for this CAG or authorized for CAG cells only" </action> <condition> if the UE supports CAG. </condition> </control> <control> <condition> Otherwise, </condition> <action> the network shall operate as described in bullet g) of subclause 5.5.2.3.5. </action> </control>
<control> <condition> d) De-registration request received in a non-CAG cell from a UE <condition> whose "CAG information list" includes an entry associated with the current PLMN, <condition> where the entry contains an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> </condition> </condition> </control>
<control> <condition> <condition> If the UE initiates a de-registration procedure in a non-CAG cell from a UE <condition> whose "CAG information list" includes an entry associated with the current PLMN, <condition> where the entry contains an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> </condition> </condition> and <condition> the de-registration procedure is not due to "switch off", </condition> </condition> <action> the AMF shall initiate the de-registration procedure. </action> <action> The AMF shall send a DEREGISTRATION REQUEST message including the 5GMM cause #76 "Not authorized for this CAG or authorized for CAG cells only" </action> <condition> if the UE supports CAG. </condition> </control> <control> <condition> Otherwise, </condition> <action> the network shall operate as described in bullet g) of subclause 5.5.2.3.5. </action> </control>
<control> <condition> e) De-registration and registration procedure for initial registration collision </condition> </control>
<control> <condition> If the network receives a REGISTRATION REQUEST message <condition> indicating either "initial registration" or "emergency registration" in the 5GS registration type IE from the UE <condition> before the UE-initiated de-registration procedure, </condition> <condition> which is not due to switch off, </condition> has been completed, </condition> </condition> <action> the network shall abort the de-registration procedure </action> and <action> the registration procedure shall be progressed. </action> </control>
5.5.2.3 Network-initiated de-registration procedure
5.5.2.3.1 Network-initiated de-registration procedure initiation
<control> <action> The network initiates the de-registration procedure by sending a DEREGISTRATION REQUEST message to the UE (see example in figure 5.5.2.3.1.1). </action> </control>
NOTE 1: <control> <condition> If the AMF performs a local de-registration, </condition> <action> it will inform the UE with a 5GMM messages (e.g. SERVICE REJECT message or REGISTRATION REJECT message) with 5GMM cause #10 "implicitly de-registered" only when the UE initiates a 5GMM procedure. </action> </control>
<control> <action> The network may include a 5GMM cause IE to specify the reason for the DEREGISTRATION REQUEST message. </action> </control>
<control> <action> The network shall start timer T3522. </action> <action> The network shall indicate whether re-registration is needed or not in the de-registration type IE. </action> <action> The network shall also indicate via the access type </action> <condition> whether the de-registration procedure is: </condition> </control>
<control> <condition> b) for non-3GPP access only; </condition> or </control>
<control> <condition> c) for 3GPP access, non-3GPP access or both <condition> when the UE is registered in the same PLMN for both accesses. </condition> </condition> </control>
<control> <condition> If the network de-registration is triggered <condition> due to network slice-specific authentication and authorization failure or revocation as specified in subclause 4.6.2.4, </condition> </condition> <action> then the network shall set the 5GMM cause value to #62 "No network slices available" in the DEREGISTRATION REQUEST message. </action> </control> <control> In addition, <condition> if the UE supports extended rejected NSSAI, </condition> <action> the AMF shall include the Extended rejected NSSAI IE in the DEREGISTRATION REQUEST message; </action> </control> <control> <condition> otherwise </condition> <action> the AMF shall include the Rejected NSSAI IE in the DEREGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the UE supports extended rejected NSSAI </condition> and <condition> the network de-registration is triggered <condition> due to mobility management based network slice admission control as specified in subclause 4.6.2.5, </condition> </condition> </condition> then <action> the network shall set the 5GMM cause value to #62 "No network slices available" in the DEREGISTRATION REQUEST message. </action> </control> <control> In addition, <action> the network may include a back-off timer value for each S-NSSAI with the rejection cause "S-NSSAI not available due to maximum number of UEs reached" in the Extended rejected NSSAI IE of the DEREGISTRATION REQUEST message. </action> </control>
<control> <condition> If the network de-registration is triggered for a UE supporting CAG <condition> due to CAG restrictions, </condition> </condition> <action> the network shall set the 5GMM cause value to #76 "Not authorized for this CAG or authorized for CAG cells only" </action> and <action> should include the "CAG information list" in the CAG information list IE or the Extended CAG information list IE in the DEREGISTRATION REQUEST message. </action> </control>
NOTE 2: <control> <condition> If the UE supports extended CAG information list, </condition> the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE. </control>
<control> <condition> If the network de-registration is triggered for a UE not supporting CAG <condition> due to CAG restrictions, </condition> </condition> <action> the network shall operate as described in bullet g) of subclause 5.5.2.3.5. </action> </control>
<control> <condition> If the network de-registration is triggered <condition> because the network determines that the UE is in a location <condition> where the network is not allowed to operate, see 3GPP TS 23.502 , </condition> </condition> </condition> <action> the network shall set the 5GMM cause value in the DEREGISTRATION REQUEST message to #78 "PLMN not allowed to operate at the present UE location". </action> </control>
<control> <condition> If the network de-registration is triggered due to: </condition> </control>
<control> <condition> a) an unsuccessful outcome of an ongoing UUAA-MM procedure; </condition> </control>
<control> <condition> b) an UUAA revocation notification received from the UAS-NF for a UE supporting UAS service requesting UAS services; </condition> or </control>
<control> <condition> c) the UE not allowed to use UAS services via 5GS <condition> due to a change of the aerial UE subscription information, </condition> </condition> <action> then the network shall set the 5GMM cause value in the DEREGISTRATION REQUEST message to #79 "UAS services not allowed". </action> </control>
NOTE 3: <control> <condition> <condition> If the UE supporting UAS service has requested other services than UAS services, </condition> or <condition> if there are other ongoing network slice-specific authentication and authorization on pending NSSAIs, </condition> </condition> it is then an operator policy or configuration decision whether to keep the UE supporting UAS service registered to the network, but that UE supporting UAS services is not allowed to access UAS services via 5GS as specified in 3GPP TS 23.256 . </control>
<control> <condition> If the network de-registration is triggered for a UE supporting MINT <condition> due to a disaster condition no longer being applicable in the current location of the UE, </condition> </condition> <action> the network shall set the 5GMM cause value to #11 "PLMN not allowed" </action> and <action> may include a disaster return wait range in the Disaster return wait range IE in the DEREGISTRATION REQUEST message </action> </control>
<control> <action> The AMF shall trigger the SMF to release locally the PDU session(s) over the indicated access(es), <condition> if any, </condition> for the UE </action> and <end_state> enter state 5GMM-DEREGISTERED-INITIATED. </end_state> </control> <control> <condition> If a PDU session is associated with one or more MBS sessions, </condition> <action> the SMF shall consider the UE as removed from the associated MBS sessions. </action> </control>
5.5.2.3.2 Network-initiated de-registration procedure completion by the UE
<control> <condition> <condition> Upon receiving the DEREGISTRATION REQUEST message, </condition> <condition> if the DEREGISTRATION REQUEST message indicates "re-registration required" </condition> and <condition> the de-registration request is for 3GPP access, </condition> </condition> the UE shall <action> perform a local release of the PDU sessions over 3GPP access, </action> if any. <control> <condition> If a PDU session is associated with one or more MBS sessions, </condition> the UE shall <action> locally leave the associated MBS sessions. </action> </control> <control> <condition> If there is an MA PDU session with user plane resources established on both 3GPP access and non-3GPP access in the same PLMN or in different PLMNs, </condition> the UE shall <action> perform access. </action> </control> <control> Furthermore, the UE shall, <condition> <condition> after the completion of the de-registration procedure, </condition> and <condition> the release of the existing NAS signalling connection, </condition> <condition> if any Tsor-cm timer(s) were running and have stopped, </condition> </condition> the UE shall <action> attempt to obtain service on a higher priority PLMN (see 3GPP TS 23.122 ) on 3GPP access, </action> <control> <condition> otherwise </condition> <action> initiate an initial registration. </action> </control> </control> </control>
<control> The UE should also <action> re-establish any previously established PDU sessions </action> over 3GPP access. </control> <control> <condition> For any previously established MA PDU sessions with user plane resources established on both accesses </condition> the UE should also <action> re-establish the user plane resources over 3GPP access, </action> and <control> <condition> for any previously established MA PDU sessions with user plane resources established only on the 3GPP access </condition> the UE should <action> re-establish the MA PDU session over 3GPP access. </action> </control> </control>
<control> <condition> <condition> Upon receiving the DEREGISTRATION REQUEST message, </condition> <condition> if the DEREGISTRATION REQUEST message indicates "re-registration required" </condition> and <condition> the de-registration request is for non-3GPP access, </condition> </condition> the UE shall <action> perform a local release of the PDU sessions over non-3GPP access, </action> if any. <control> <condition> If there is an MA PDU session with user plane resources established on both 3GPP access and non-3GPP access in the same PLMN or in different PLMNs, </condition> the UE shall <action> perform a local release of the user plane resources on non-3GPP access. </action> </control> <control> <condition> If there is an MA PDU session with a PDN connection as a user-plane resource and user plane resources established on non-3GPP access, </condition> the UE shall <action> perform a local release of the user plane resources on non-3GPP access. </action> </control> <control> <condition> If there is an MA PDU session with user plane resources established on non-3GPP access only, </condition> the UE shall <action> perform a local release of the MA PDU session. </action> The UE shall <action> stop the timer(s) T3346, T3396, T3584 and T3585, </action> <condition> if it is running. </condition> </control> <control> The UE shall <action> send a DEREGISTRATION ACCEPT message to the network </action> and <end_state> enter the state 5GMM-DEREGISTERED for non-3GPP access. </end_state> </control> <control> Furthermore, the UE shall, <condition> after the completion of the de-registration procedure, and the release of the existing NAS signalling connection, </condition> <action> initiate an initial registration over non-3GPP. </action> </control> <control> The UE should also <action> re-establish any previously established PDU sessions over non-3GPP access. </action> </control> <control> <condition> For any previously established MA PDU sessions with user plane resources established on both accesses </condition> the UE should also <action> re-establish the user plane resources over non-3GPP access, </action> and <control> <condition> for any previously established MA PDU sessions with user plane resources established only on the non-3GPP access </condition> the UE should <action> re-establish the MA PDU session over non-3GPP access, </action> </control> and <control> <condition> for any previously established MA PDU sessions with a PDN connection as a user- plane resource and user plane resources established on non-3GPP access </condition> the UE should <action> re-establish the user plane resources over non-3GPP access. </action> </control> </control> </control>
<control> <condition> <condition> Upon receiving the DEREGISTRATION REQUEST message, </condition> <condition> if the DEREGISTRATION REQUEST message indicates "re-registration required" </condition> and <condition> the de-registration request is for both 3GPP access and non-3GPP access </condition> <condition> when the UE is registered in the same PLMN for both accesses, </condition> </condition> the UE shall <action> perform a local release of the MA PDU sessions and PDU sessions over both 3GPP access and non-3GPP access, </action> if any. <control> <condition> If an MA PDU session or a PDU sessions is associated with one or more MBS sessions, </condition> the UE shall <action> locally leave the associated MBS sessions. </action> </control> <control> The UE shall <action> stop the timer(s) T3346, T3396, T3584 and T3585, </action> <condition> if it is running. </condition> </control> <control> The UE shall <action> send a DEREGISTRATION ACCEPT message to the network </action> and <end_state> enter the state 5GMM-DEREGISTERED for both 3GPP access and non-3GPP access. </end_state> </control> </control>
<control> Furthermore, the UE shall, <condition> <condition> after the completion of the de-registration procedure, and the release of the existing NAS signalling connection, </condition> <condition> if any Tsor-cm timer(s) were running and have stopped, </condition> </condition> the UE shall <action> attempt to obtain service on a higher priority PLMN (see 3GPP TS 23.122 ) on 3GPP access, </action> <control> <condition> otherwise </condition> <action> initiate an initial registration over both 3GPP access and non-3GPP access. </action> </control> </control> <control> The UE should also <action> re-establish any previously established PDU sessions over both 3GPP access and non-3GPP access. </action> </control> <control> <condition> For any previously established MA PDU sessions </condition> the UE should also <action> re-establish the MA PDU session and the user plane resources </action> which were established previously. </control>
NOTE 1: <control> <condition> When the de-registration type indicates "re-registration required", </condition> user interaction <action> is necessary in some cases </action> <condition> when the UE cannot re-establish the PDU session (s), </condition> if any, automatically. </control>
<control> <condition> <condition> Upon receiving the DEREGISTRATION REQUEST message, </condition> <condition> if the DEREGISTRATION REQUEST message indicates "re-registration not required" </condition> and <condition> the de-registration request is for 3GPP access, </condition> </condition> the UE shall <action> perform a local release of the PDU sessions over 3GPP access, </action> if any. <control> <condition> If a PDU session is associated with one or more MBS sessions, </condition> the UE shall <action> locally leave the associated MBS sessions. </action> </control> <control> <condition> If there is an MA PDU session with user plane resources established on both 3GPP access and non-3GPP access in the same PLMN or in different PLMNs, </condition> the UE shall <action> perform a local release of the user plane resources on 3GPP access. </action> </control> <control> <condition> If there is an MA PDU session with user plane resources established on 3GPP access only, </condition> the UE shall <action> perform a local release of the MA PDU session. </action> </control> <control> <condition> If the MA PDU session is associated with one or more MBS sessions, </condition> the UE shall <action> locally leave the associated MBS sessions. </action> </control> <control> <action> The UE shall send a DEREGISTRATION ACCEPT message to the network </action> and <end_state> enter the state 5GMM-DEREGISTERED for 3GPP </end_state> </control> </control>
<control> <condition> <condition> Upon receiving the DEREGISTRATION REQUEST message, </condition> <condition> if the DEREGISTRATION REQUEST message indicates "re-registration not required" </condition> and <condition> the de-registration request is for non-3GPP access, </condition> </condition> the UE shall <action> perform a local release of the PDU sessions over non-3GPP access, </action> if any. <control> <condition> <condition> If there is an MA PDU session with user plane resources established on both 3GPP access </condition> and <condition> non-3GPP access in the same PLMN or in different PLMNs, </condition> </condition> the UE shall <action> perform a local release of the user plane resources on non-3GPP access. </action> </control> <control> <condition> If there is an MA PDU session with a PDN connection as a user-plane resource and user plane resources established on non-3GPP access, </condition> the UE shall <action> perform a local release of the user plane resources on non-3GPP access. </action> </control> <control> <condition> If there is an MA PDU session with user plane resources established on non-3GPP access only, </condition> the UE shall <action> perform a local release of the MA PDU session. </action> </control> <control> The UE shall <action> send a DEREGISTRATION ACCEPT message to the network </action> and <end_state> enter the state 5GMM-DEREGISTERED for non-3GPP access. </end_state> </control> </control>
<control> <condition> <condition> Upon receiving the DEREGISTRATION REQUEST message, </condition> <condition> if the DEREGISTRATION REQUEST message indicates "re-registration not required" </condition> and <condition> the de-registration request is for both 3GPP access and non-3GPP access </condition> <condition> when the UE is registered in the same PLMN for both accesses, </condition> </condition> the UE shall <action> perform a local release of the MA PDU sessions and PDU sessions over both 3GPP access and non-3GPP access, </action> if any. <control> <condition> If an MA PDU session or a PDU session is associated with one or more MBS sessions, </condition> the UE shall <action> locally leave the associated MBS sessions. </action> </control> <control> The UE shall <action> send a DEREGISTRATION ACCEPT message to the network </action> and <end_state> enter the state 5GMM-DEREGISTERED </end_state> for both 3GPP access and non-3GPP access. </control> </control>
<control> <condition> <condition> Upon receiving the DEREGISTRATION REQUEST message, </condition> <condition> if the DEREGISTRATION REQUEST message includes the rejected NSSAI, </condition> </condition> the UE <action> takes the following actions </action> based on the rejection cause in the rejected S- NSSAI(s): "S-NSSAI not available in the current PLMN or SNPN" </control>
<control> The UE shall <action> store the rejected S-NSSAI(s) in the rejected NSSAI </action> for the current PLMN or SNPN as specified in subclause 4.6.2.2 and shall <action> not attempt to use this S-NSSAI in the current PLMN or SNPN </action> <condition> <condition> until switching off the UE, </condition> <condition> the UICC containing the USIM is removed, </condition> or <condition> the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </condition> </condition> </control>
"S-NSSAI not available in the current registration area"
<control> The UE shall <action> store the rejected S-NSSAI(s) in the rejected NSSAI </action> for the current registration area as described in subclause 4.6.2.2 and <control> shall <action> not attempt to use this S-NSSAI(s) in the current registration area </action> <condition> <condition> until switching off the UE, </condition> <condition> the UE moving out of the current registration area, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> an entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S- NSSAI(s) are removed as described in subclause 4.6.2.2. </condition> </condition> </control> </control>
"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization"
<control> The UE shall <action> store the rejected S-NSSAI(s) in the rejected NSSAI </action> for the failed or revoked NSSAA as specified in subclause 4.6.2.2 and shall <action> not attempt to use this S-NSSAI in the current PLMN or SNPN over any access </action> <condition> <condition> until switching off the UE, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S-NSSAI(s) are removed or deleted as described in subclause 4.6.1 and 4.6.2.2. </condition> </condition> </control>
"S-NSSAI not available due to maximum number of UEs reached"
<control> The UE shall <action> add the rejected S-NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause 4.6.2.2 </action> and <control> shall <action> not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access </action> <condition> <condition> until switching off the UE, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </condition> </condition> </control> </control>
<control> <condition> If there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause "S-NSSAI not available due to maximum number of UEs reached", </condition> then for each S-NSSAI, the UE shall behave as follows: </control>
<control> <action> a) stop the timer T3526 associated with the S-NSSAI, </action> <condition> if running; </condition> </control>
<control> <action> b) start the timer T3526 with: </action> </control>
<control> <action> 1) the back-off timer value received along with the S-NSSAI, </action> <condition> if a back-off timer value is received along with the S-NSSAI that is neither zero nor deactivated; </condition> </control> or
<control> <action> 2) an implementation specific back-off timer value, </action> <condition> if no back-off timer value is received along with the S- NSSAI; </condition> </control> and
<control> <action> c) remove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached </action> <condition> when the timer T3526 associated with the S-NSSAI expires. </condition> </control>
<control> <condition> Upon sending a DEREGISTRATION ACCEPT message, </condition> the UE shall <action> delete the rejected NSSAI as specified in subclause 4.6.2.2. </action> </control>
<control> Regardless of the 5GMM cause value received in the DEREGISTRATION REQUEST message, <control> a) <condition> <condition> if the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for roaming" IE in the DEREGISTRATION REQUEST message </condition> and <condition> if the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for roaming", </condition> </condition> the UE <control> shall <action> store the TAI(s) included in the IE, </action> <condition> if not already stored, </condition> </control> into the list of "5GS forbidden tracking areas for roaming" and <action> remove the TAI(s) from the stored TAI list </action> if present; </control> and <control> b) <condition> <condition> if the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for regional provision of service" IE in the DEREGISTRATION REQUEST message </condition> and <condition> if the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for regional provision of service", </condition> </condition> <control> the UE shall <action> store the TAI(s) included in the IE, </action> <condition> if not already stored, </condition> </control> into the list of "5GS forbidden tracking areas for regional provision of service" and <control> <action> remove the TAI(s) from the stored TAI list </action> <condition> if present. </condition> </control> </control> </control>
<control> <condition> If the de-registration type indicates "re-registration required", </condition> then <control> the UE shall <action> ignore the 5GMM cause IE </action> <condition> if received. </condition> </control> </control>
<control> <condition> If the de-registration type indicates "re-registration not required", </condition> the UE shall <action> take the actions depending on the received 5GMM cause value: #3 (Illegal UE); #6 (Illegal ME) </action> </control>
<control> The message <action> was received via 3GPP access </action> and the UE shall <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and shall <action> store it according to subclause 5.1.3.2.2) </action> and shall <action> delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control> <control> <condition> a) In case of PLMN, </condition> the UE shall <action> consider the USIM as invalid for 5GS services </action> <condition> <condition> until switching off, </condition> <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in clause 5.3.19a.1; </condition> </condition> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE is not registered for onboarding services in SNPN </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> the UE shall <action> consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid </action> <condition> <condition> until the UE is switched off, </condition> <condition> the entry is updated </condition> or <condition> the timer T3245 expires as described in clause 5.3.19a.2. </condition> </condition> </control> <control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> the UE shall <action> consider the selected entry of the "list of subscriber data" as invalid for 3GPP access </action> <condition> <condition> until the UE is switched off, </condition> <condition> the entry is updated or the timer T3245 expires as described in clause 5.3.19a.2. </condition> </condition> </control> <control> Additionally, <condition> if EAP based primary authentication and key agreement procedure using EAP-AKA' or 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, </condition> the UE shall <action> consider the USIM as invalid for the current SNPN </action> <condition> <condition> until switching off, </condition> <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in clause 5.3.19a.2. </condition> </condition> </control>
<control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> the UE shall <action> delete the list of equivalent PLMNs </action> (if any) and shall <end_state> enter the state 5GMM-DEREGISTERED.NO-SUPI. </end_state> </control>
<control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> the UE shall <action> delete the 5GMM parameters stored in non-volatile memory of the ME as specified in annex C. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> the UE shall <action> handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> for the case <condition> when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required". </condition> </control> <control> The USIM shall <action> be considered as invalid also for non-EPS services </action> <condition> <condition> until switching off or the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in clause 5.3.7a in 3GPP TS 24.301 </condition> </condition> </control>
<control> <condition> If the UE is registered for onboarding services in SNPN, </condition> the UE shall <action> reset the registration attempt counter, </action> <action> store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM- DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If the UE also supports the registration procedure over the other access, </condition> the UE shall <action> in addition handle 5GMM parameters and 5GMM state for this access, </action> as described for this 5GMM cause value. </control>
#7 (5GS services not allowed).
<control> The UE shall <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and shall <action> store it according to subclause 5.1.3.2.2) </action> and shall <action> delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> In case of PLMN, </condition> the UE shall <action> consider the USIM as invalid for 5GS services until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.19a.1; </action> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE is not registered for onboarding services in SNPN </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> the UE shall <action> consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid for 5GS services </action> <condition> <condition> until the UE is switched off, </condition> or <condition> the entry is updated or the timer T3245 expires as described in clause 5.3.19a.2. </condition> </condition> </control> <control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE is not registered for onboarding services in SNPN </condition> and <condition> the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> the UE shall <action> consider the selected entry of the "list of subscriber data" as invalid for 3GPP access </action> <condition> <condition> until the UE is switched off, </condition> <condition> the entry is updated or the timer T3245 expires as described in clause 5.3.19a.2. </condition> </condition> </control> <control> Additionally, <condition> <condition> if EAP based primary authentication and key agreement procedure using EAP-AKA' </condition> or <condition> 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, </condition> </condition> the UE shall <action> consider the USIM as invalid for the current SNPN </action> <condition> <condition> until switching off, </condition> <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in clause 5.3.19a.2. </condition> </condition> </control>
<control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> the UE shall <end_state> enter the state 5GMM- DEREGISTERED.NO-SUPI. </end_state> </control>
<control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> the UE shall <action> delete the 5GMM parameters stored in non-volatile memory of the ME as specified in annex C. </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> the UE shall <action> handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 for the case </action> <condition> when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required". </condition> </control>
<control> <condition> If the UE is registered for onboarding services in SNPN, </condition> the UE shall <action> reset the registration attempt counter, </action> <action> store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM- DEREGISTERED.PLMN-SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If the UE also supports the registration procedure over the other access, </condition> the UE shall <action> in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
#11 (PLMN not allowed).
This cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.2.3.4.
<control> The UE shall <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and shall <action> store it according to subclause 5.1.3.2.2) </action> and shall <action> delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control> <control> The UE shall <action> delete the list of equivalent PLMNs, </action> shall <action> reset the registration attempt counter. </action> </control> <control> <condition> For 3GPP access </condition> the UE shall <end_state> enter the state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> </control> and <control> <condition> for non-3GPP access </condition> the UE shall <end_state> enter state 5GMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> The UE shall <action> store the PLMN identity in the forbidden PLMN list </action> as specified in subclause 5.3.13A and <control> <condition> if the UE is configured to use timer T3245 </condition> then the UE shall <action> start timer T3245 </action> and <action> proceed as described in clause </action> </control> </control>
<control> <condition> For 3GPP access </condition> the UE shall <action> perform a PLMN selection according to 3GPP TS 23.122 , </action> </control> and <control> <condition> for non-3GPP access </condition> the UE shall <action> perform network selection as defined in 3GPP TS 24.502 . </action> </control>
<control> <condition> If the message was received via 3GPP access and the UE is operating in single-registration mode, </condition> the UE shall <action> handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI </action> and <action> attach attempt counter as specified in 3GPP TS 24.301 for the case </action> <condition> when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required". </condition> </control>
<control> <condition> If the UE also supports the registration procedure over the other access to the same PLMN, </condition> the UE shall <action> in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
<control> <condition> <condition> If the UE receives the Disaster return wait range IE in the DEREGISTRATION REQUEST message </condition> and <condition> the UE supports MINT, </condition> </condition> the UE shall <action> delete the disaster return wait range stored in the ME, </action> if any, and <action> store the disaster return wait range included in the Disaster return wait range IE in the ME. </action> </control>
#12 (Tracking area not allowed).
<control> The UE shall <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and shall <action> store it according to subclause 5.1.3.2.2) </action> and shall <action> delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control> <control> The UE shall <action> reset the registration attempt counter </action> and shall <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> If the UE is not operating in SNPN access operation mode, </condition> the UE shall <action> store the current TAI in the list of "5GS forbidden tracking areas for regional provision of service". </action> </control> <control> <condition> Otherwise, </condition> the UE shall <action> store the current TAI in the list of "5GS forbidden tracking areas for regional provision of service" for the current SNPN </action> and, <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription. </condition> </control> </control>
<control> <condition> If the message was received via 3GPP access and the UE is operating in single-registration mode, </condition> the UE shall <action> handle the EMM parameters, EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP TS 24.301 for the case </action> <condition> when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required". </condition> </control>
#13 (Roaming not allowed in this tracking area).
<control> The UE shall <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and shall <action> store it according to subclause 5.1.3.2.2) </action> and shall <action> delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control> <control> The UE shall <action> delete the list of equivalent PLMNs (if available), </action> <action> reset the registration attempt counter. </action> </control> <control> <condition> For 3GPP access </condition> the UE shall <end_state> change to state 5GMM-DEREGISTERED.PLMN-SEARCH, </end_state> and <control> <condition> for non-3GPP access </condition> the UE shall <end_state> change to state 5GMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control> </control>
<control> <condition> If the UE is not operating in SNPN access operation mode, </condition> the UE shall <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming". </action> </control> <control> <condition> Otherwise, </condition> the UE shall <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN </condition> </control> </control>
<control> <condition> For 3GPP access </condition> the UE shall <action> perform a PLMN selection or SNPN selection according to 3GPP TS 23.122 , </action> and <condition> for non-3GPP access </condition> the UE shall <action> perform network selection as defined in 3GPP TS 24.502 . </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> the UE shall <action> handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI </action> and <action> attach attempt counter as specified in 3GPP TS 24.301 for the case </action> <condition> when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required". </condition> </control>
#15 (No suitable cells in tracking area).
<control> The UE shall <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and shall <action> delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control> <control> The UE shall <action> reset the registration attempt counter </action> and shall <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> If the UE is not operating in SNPN access operation mode, </condition> the UE shall <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming". </action> </control> <control> <condition> Otherwise </condition> the UE shall <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription. </condition> </control> </control>
<control> The UE shall <action> search for a suitable cell in another tracking area according to 3GPP TS 38.304 or 3GPP TS 36.304 . </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> the UE shall <action> handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI </action> and <action> attach attempt counter as specified in 3GPP TS 24.301 for the case </action> <condition> when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required". </condition> </control>
<control> <condition> If received over non-3GPP access and de-registration request is for non-3GPP access only, </condition> the cause shall <action> be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.2.3.4. </action> </control>
#22 (Congestion).
<control> <condition> <condition> If the T3346 value IE is present in the DEREGISTRATION REQUEST message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> the UE shall <action> proceed as described below, </action> <control> <condition> otherwise </condition> it shall <action> be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.2.3.4. </action> </control> </control>
<control> The UE shall <control> <action> stop timer T3346 </action> <condition> if it is running, </condition> </control> <action> set the 5GS update status to 5U2 NOT UPDATED, </action> <action> reset the registration attempt counter </action> and <end_state> enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION. </end_state> </control>
<control> The UE shall <action> start timer T3346 with the value provided in the T3346 value IE. </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in the single-registration mode, </condition> </condition> the UE shall <action> set the EPS update status to EU2 NOT UPDATED, </action> <action> reset the attach attempt counter </action> and shall <end_state> enter the state EMM-DEREGISTERED. </end_state> </control>
#27 (N1 mode not allowed).
<control> The UE shall <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and shall <action> store it according to subclause 5.1.3.2.2) </action> and shall <action> delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control> <control> Additionally, the UE shall <action> reset the registration attempt counter </action> and shall <end_state> enter the state 5GMM-DEREGISTERED.LIMITED- SERVICE. </end_state> </control>
<control> The UE shall <action> disable the N1 mode capability for both 3GPP access and non-3GPP access (see subclause 4.9). </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> the UE shall <action> in addition set the EPS update status to EU3 ROAMING NOT ALLOWED </action> and shall <action> delete any 4G-GUTI, last visited registered TAI, TAI list and eKSI. </action> </control> <control> Additionally, the UE shall <action> reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control>
#62 (No network slices available).
<control> The UE shall <action> set the 5GS update status to 5U2 NOT UPDATED </action> and <end_state> enter state 5GMM- DEREGISTERED.NORMAL-SERVICE or 5GMM-DEREGISTERED.PLMN-SEARCH. </end_state> </control> <control> Additionally, the UE shall <action> reset the registration attempt counter. </action> </control>
The UE receiving the rejected NSSAI in the DEREGISTRATION REQUEST message takes the following actions based on the rejection cause in the rejected S-NSSAI(s): "S-NSSAI not available in the current PLMN or SNPN"
<control> The UE shall <action> store the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause 4.6.2.2 </action> and shall <action> not attempt to use this S-NSSAI(s) in the current PLMN or SNPN </action> <condition> <condition> until switching off the UE, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> an entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S-NSSAI(s) are removed or deleted as described in subclause 4.6.2.2. </condition> </condition> </control>
"S-NSSAI not available in the current registration area"
<control> The UE shall <action> store the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as described in subclause 4.6.2.2 </action> and shall <action> not attempt to use this S-NSSAI(s) in the current registration area </action> <condition> <condition> until switching off the UE, </condition> <condition> the UE moving out of the current registration area, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S-NSSAI(s) are removed or deleted as described in subclause 4.6.2.2. </condition> </condition> </control>
"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization"
<control> The UE shall <action> store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause 4.6.2.2 </action> and shall <action> not attempt to use this S-NSSAI in the current PLMN or SNPN over any access </action> <condition> <condition> until switching off the UE, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S- NSSAI(s) are removed or deleted as described in subclause 4.6.1 and 4.6.2.2. </condition> </condition> </control>
"S-NSSAI not available due to maximum number of UEs reached"
<control> The UE shall <action> add the rejected S-NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause 4.6.2.2 </action> and shall <action> not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access </action> <condition> <condition> until switching off the UE, </condition> <condition> the UICC containing the USIM is removed, </condition> <condition> the entry of the "list of subscriber data" with the SNPN identity of the current SNPN is updated, </condition> or <condition> the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </condition> </condition> </control>
<control> <condition> If the UE has an allowed NSSAI or configured NSSAI that contains S-NSSAI(s) which are not included in the rejected NSSAI, </condition> the UE may <action> stay in the current serving cell, </action> <action> apply the normal cell reselection process </action> and <action> start an initial registration with a requested NSSAI that includes any S-NSSAI from the allowed NSSAI or the configured NSSAI that is not in the rejected NSSAI. </action> </control> <control> <condition> Otherwise </condition> the UE may <action> perform a PLMN selection or SNPN selection according to 3GPP TS 23.122 </action> and additionally, the UE may <action> disable the N1 mode capability for the current PLMN or SNPN </action> <condition> if the UE does not have an allowed NSSAI and each S-NSSAI in configured NSSAI, </condition> if available, was rejected with cause "S-NSSAI not available in the current PLMN or SNPN" or "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization" or "S-NSSAI not available due to maximum number of UEs reached" as described in subclause 4.9. </control>
<control> <condition> If the UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN </condition> and, </control>
<control> <condition> 1) if at least one S-NSSAI in the default configured NSSAI is not rejected, </condition> the UE may <action> stay in the current serving cell, </action> <action> apply the normal cell reselection process, </action> and <action> start an initial registration with a requested NSSAI with that default configured NSSAI; </action> or </control>
<control> 2) <condition> <condition> if all the S-NSSAI(s) in the default configured NSSAI are rejected </condition> and <condition> at least one S-NSSAI is rejected due to "S-NSSAI not available in the current registration area", </condition> </condition> </control>
<control> i) <condition> if the UE is not operating in SNPN access operation mode, </condition> the UE shall <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming" </action> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED- SERVICE; </end_state> or </control>
<control> ii) <condition> if the UE is operating in SNPN access operation mode, </condition> the UE shall <action> store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and <end_state> enter the state 5GMM- DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> Otherwise, </condition> the UE may <action> perform a PLMN selection or SNPN selection according to 3GPP TS 23.122 </action> and additionally, the UE may <action> disable the N1 mode capability for the current PLMN or SNPN </action> <condition> if each S-NSSAI in the default configured NSSAI was rejected with cause "S-NSSAI not available in the current PLMN or SNPN" or "S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization" as described in subclause 4.9. </condition> </control>
<control> <condition> <condition> If the UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN </condition> and <condition> has rejected NSSAI for the reached maximum number of UEs, </condition> and <condition> the UE wants to obtain services in the current serving cell without performing a PLMN selection or SNPN selection, </condition> </condition> the UE may <action> stay in the current serving cell </action> and <action> attempt to use the rejected S-NSSAI(s) for the maximum number of UEs reached in the current serving cell after the rejected S-NSSAI(s) are removed as described in subclause 4.6.2.2. </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> the UE shall <action> in addition set the EPS update status to EU2 NOT UPDATED, </action> <action> reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control>
#72 (Non-3GPP access to 5GCN not allowed).
<control> <condition> <condition> If received over non-3GPP access when the UE is registered over non-3GPP access, </condition> or <condition> received over 3GPP access and de-registration request is for non-3GPP access when the UE is registered in the same PLMN for both accesses, </condition> </condition> the UE shall <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and shall <action> store it according to subclause 5.1.3.2.2) </action> and shall <action> delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI for non-3GPP access. </action> </control> <control> Additionally, the UE shall <action> reset the registration attempt counter </action> and <end_state> enter the state 5GMM- DEREGISTERED for non-3GPP access. </end_state> </control>
NOTE 2: The 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses 4.7.2 and 5.1.3).
<control> The UE shall <action> disable the N1 mode capability for non-3GPP access (see subclause 4.9.3). </action> </control>
<control> As an implementation option, <condition> if the UE is not currently registered over 3GPP access, </condition> the UE may <end_state> enter the state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> in order to perform a PLMN selection according to 3GPP TS 23.122 . </control>
<control> <condition> <condition> If received over 3GPP access </condition> and <condition> de-registration request is for 3GPP access only, </condition> </condition> the cause shall <action> be considered as an abnormal case </action> and <action> the behaviour of the UE for this case is specified in subclause 5.5.2.3.4. </action> </control>
#74 (Temporarily not authorized for this SNPN).
5GMM cause #74 is only applicable when received from a cell belonging to an SNPN. 5GMM cause #74 received from a cell not belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.2.3.4.
<control> The UE shall <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and shall <action> store it according to subclause 5.1.3.2.2) </action> and shall <action> delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control> <control> The UE shall <action> reset the registration attempt counter </action> and shall <action> store the SNPN identity in the "temporarily forbidden SNPNs" list for the specific access type for which the message was received </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription. </condition> </control> <control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> the UE shall <end_state> enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the UE is registered for onboarding services in SNPN, </condition> the UE shall <end_state> enter state 5GMM-DEREGISTERED.PLMN- SEARCH </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control>
#75 (Permanently not authorized for this SNPN).
5GMM cause #75 is only applicable when received from a cell belonging to an SNPN with a globally-unique SNPN identity. 5GMM cause #75 received from a cell not belonging to an SNPN or a cell belonging to an SNPN with a non-globally-unique SNPN identity is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.2.3.4.
<control> The UE shall <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and shall <action> store it according to subclause 5.1.3.2.2) </action> and shall <action> delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall reset the registration attempt counter </action> and <action> store the SNPN identity in the "permanently forbidden SNPNs" list for the specific access type for which the message was received </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription. </condition> </control> <control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> the UE shall <end_state> enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the UE is registered for onboarding services in SNPN, </condition> the UE shall <end_state> enter state 5GMM-DEREGISTERED.PLMN- SEARCH </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control>
#76 (Not authorized for this CAG or authorized for CAG cells only).
This cause value received via non-3GPP access or from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.2.3.4.
<control> The UE shall <action> set the 5GS update status to 5U3.ROAMING NOT ALLOWED, </action> <action> store the 5GS update status according to clause 5.1.3.2.2, </action> and <action> reset the registration attempt counter. </action> </control>
<control> If 5GMM cause #76 is received from: </control>
<control> <condition> 1) a CAG cell, </condition> and <condition> if the UE receives a "CAG information list" in the CAG information list IE or the Extended CAG information list IE included in the DEREGISTRATION REQUEST message, </condition> the UE shall: </control>
<control> <action> i) replace the "CAG information list" stored in the UE with the received CAG information list IE or the Extended CAG information list IE </action> <condition> when received in the HPLMN or EHPLMN; </condition> </control>
<control> <action> ii) replace the serving VPLMN's entry of the "CAG information list" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE </action> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; </condition> </control> or NOTE 3: <control> <condition> When the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored. </condition> </control>
<control> <action> iii) remove the serving VPLMN's entry of the "CAG information list" stored in the UE </action> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry. </condition> </control>
<control> <condition> Otherwise, </condition> the UE shall <action> delete the CAG-ID(s) of the cell from the "allowed CAG list" for the current PLMN. </action> </control>
In the case the "allowed CAG list" for the current PLMN only contains a range of CAG-IDs, how the UE deletes the CAG-ID(s) of the cell from the "allowed CAG list" for the current PLMN is up to UE
<control> i) <condition> <condition> if the entry in the "CAG information list" for the current PLMN does not include an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> or <condition> if the entry in the "CAG information list" for the current PLMN includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> and <condition> the updated "allowed CAG list" for the current PLMN includes one or more CAG-IDs, </condition> </condition> then the UE shall <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE </end_state> and shall <action> search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list"; </action> </control> or
<control> ii) <condition> <condition> if the entry in the "CAG information list" for the current PLMN includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> and <condition> the updated "allowed CAG list" for the current PLMN does not include any CAG-ID, </condition> </condition> then the UE shall <end_state> enter the state 5GMM-DEREGISTERED.PLMN- SEARCH </end_state> and shall <action> apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list". </action> </control>
<control> <condition> 2) a non-CAG cell, </condition> and <condition> if the UE receives a "CAG information list" in the CAG information list IE or the Extended CAG information list IE included in the DEREGISTRATION REQUEST message, </condition> the UE shall: </control>
<control> <action> i) replace the "CAG information list" stored in the UE with the received CAG information list IE or the Extended CAG information list IE </action> <condition> when received in the HPLMN or EHPLMN; </condition> </control>
<control> <action> ii) replace the serving VPLMN's entry of the "CAG information list" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE </action> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; </condition> or NOTE 4: When the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored. </control>
<control> <action> iii) remove the serving VPLMN's entry of the "CAG information list" stored in the UE </action> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry. </condition> </control>
<control> <condition> Otherwise, </condition> the UE shall <action> store an "indication that the UE is only allowed to access 5GS via CAG cells" in the entry of the "CAG information list" for the current PLMN, if any. </action> </control> <control> <condition> If the "CAG information list" stored in the UE does not include the current PLMN's entry, </condition> the UE shall <action> add an entry for the current PLMN to the "CAG information list" </action> and <action> store an "indication that the UE is only allowed to access 5GS via CAG cells" in the entry of the "CAG information list" for the current PLMN. </action> </control> <control> <condition> If the UE does not have a stored "CAG information list", </condition> the UE shall <action> create a new "CAG information list" </action> and <action> add an entry with an "indication that the UE is only allowed to access 5GS via CAG cells" for the current PLMN. </action> </control>
In addition:
<control> i) <condition> if the "allowed CAG list" for the current PLMN includes one or more CAG-IDs, </condition> then the UE shall <end_state> enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE </end_state> and shall <action> search for a suitable cell according to 3GPP TS 38.304 with the updated CAG information; or </action> </control>
<control> ii) <condition> if the "allowed CAG list" for the current PLMN does not include any CAG-ID, </condition> then the UE shall <end_state> enter the state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> and shall <action> apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list". </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> the UE shall <action> in addition set the EPS update status to EU3 ROAMING NOT ALLOWED, </action> <action> reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control>
#77 (Wireline access area not allowed).
5GMM cause #77 is only applicable when received from a wireline access network by the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device). 5GMM cause #77 received from a 5G access network other than a wireline access network and 5GMM cause #77 received by the W-AGF acting on behalf of the FN-BRG are considered as abnormal cases and the behaviour of the UE is specified in subclause 5.5.2.3.4.
<control> <condition> When received over wireline access network, </condition> the 5G-RG and the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) shall set <action> the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and shall <action> store it according to subclause 5.1.3.2.2), </action> shall <action> delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI, </action> shall <action> reset the registration attempt counter, </action> shall <end_state> enter the state 5GMM-DEREGISTERED </end_state> and shall <action> act as specified in subclause 5.3.23. </action> </control>
NOTE 5: The 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses 4.7.2 and 5.1.3).
#78 (PLMN not allowed to operate at the present UE location).
This cause value received from a non-satellite NG-RAN cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.2.3.4.
<control> The UE shall <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and shall <action> store it according to subclause 5.1.3.2.2) </action> and shall <action> delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control> <control> Additionally, the UE shall <action> reset the registration attempt counter. </action> </control> <control> The UE shall <action> store the PLMN identity </action> and, if it is known, the current geographical location in the list of "PLMNs not allowed to operate at the present UE location" and shall <action> start a corresponding timer instance (see subclause 4.23.2). </action> </control> <control> The UE shall <end_state> enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> the UE shall <action> handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI </action> and <action> attach attempt counter as specified in 3GPP TS 24.301 for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required". </action> </control>
#79 (UAS services not allowed). a) A UE which is not a UE supporting UAS services receiving this cause value shall considered it as an abnormal case and the behaviour of the UE is specified in subclause 5.5.2.3.4.
<control> A UE supporting UAS service shall <action> set the 5GS update status to 5U2 NOT UPDATED </action> and <end_state> enter state 5GMM- DEREGISTERED.NORMAL-SERVICE or 5GMM-DEREGISTERED.PLMN-SEARCH. </end_state> </control> <control> Additionally, the UE shall <action> reset the registration attempt counter. </action> </control> <control> <condition> If the UE re-attempt the registration procedure to the current PLMN, </condition> the UE shall <action> not include the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of REGISTRATION REQUEST message. </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> the UE shall <action> in addition set the EPS update status to EU2 NOT UPDATED, </action> <action> reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control>
#93 (Onboarding services terminated).
<control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> this cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.2.3.4. </control>
<control> <condition> If the UE is not operating in SNPN access operation mode, </condition> the UE shall <end_state> enter the state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If the UE is operating in SNPN access operation mode, </condition> the UE shall <end_state> enter the state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection according to 3GPP TS 23.122 . </action> </control>
NOTE 6: In case the configuration of one or more entries of the "list of subscriber data" was not completed at the time of network-initiated de-registration procedure, the UE can retry registration after the de-registration procedure is completed.
5.5.2.3.3 Network-initiated de-registration procedure completion by the network
<control> The network shall <action> stop timer T3522 </action> <condition> upon receipt of the DEREGISTRATION ACCEPT message. </condition> </control> <control> The network shall <end_state> enter state 5GMM-DEREGISTERED </end_state> for 3GPP access <condition> if the de-registration request is for 3GPP access. </condition> </control> <control> The network shall <end_state> enter state 5GMM-DEREGISTERED </end_state> for non-3GPP access <condition> if the de-registration request is for non-3GPP access. </condition> </control>
<control> The network shall <end_state> enter state 5GMM-DEREGISTERED for both 3GPP access and non-3GPP access </end_state> <condition> if the de-registration request is for both 3GPP access and non-3GPP access. </condition> </control>
5.5.2.3.4 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) Transmission failure of DEREGISTRATION ACCEPT message indication from lower layers. </condition> </control>
<control> The de-registration procedure shall <action> be progressed </action> and the UE shall <action> send the DEREGISTRATION ACCEPT </action> </control>
<control> The UE shall <action> delete 5G-GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs (if any), ngKSI, </action> shall <action> set the 5GS update status to 5U2 NOT UPDATED </action> and shall <action> start timer T3502. </action> </control>
<control> A UE not supporting S1 mode may <end_state> enter the state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> in order to perform a PLMN selection or SNPN selection according to 3GPP TS 23.122 ; <control> <condition> otherwise </condition> the UE shall <end_state> enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION. </end_state> </control> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in the single-registration mode, </condition> </condition> the UE shall: <action> a) enter the state 5GMM-DEREGISTERED </action> and <action> attempt to select E-UTRAN radio access technology and proceed with the appropriate EMM specific procedures. </action> </control> <control> In this case, the UE may <action> disable the N1 mode capability (see subclause 4.9); </action> or b) <end_state> enter the state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> in order to perform a PLMN selection according to 3GPP TS 23.122 . </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in the single-registration mode, </condition> </condition> the UE shall <action> set the EPS update status to EU2 NOT UPDATED, </action> <end_state> enter the state EMM-DEREGISTERED </end_state> and shall <action> delete the EMM parameters 4G-GUTI, last visited registered TAI, TAI list and eKSI. </action> </control>
5.5.2.3.5 Abnormal cases in the network side
The following abnormal cases can be identified:
<control> <condition> On the first expiry of the timer, </condition> the network shall <action> retransmit the DEREGISTRATION REQUEST message </action> and shal <action> start timer T3522. </action> </control> <control> This retransmission is repeated four times, i.e. <condition> on the fifth expiry of timer T3522, </condition> the de-registration procedure shall <action> be aborted. </action> </control> <control> The network shall <end_state> change to the state 5GMM-DEREGISTERED </end_state> for the access type which the de-registration procedure is intended for. </control>
b) Lower layer failure
<control> The de-registration procedure <action> is aborted. </action> </control> <control> The network shall <end_state> change to the state 5GMM-DEREGISTERED </end_state> for the access type which the de-registration procedure is intended for. </control>
c) De-registration procedure collision
<control> <condition> <condition> If the network receives a DEREGISTRATION REQUEST message with "switch off" indication, </condition> <condition> before the network-initiated de-registration procedure has been completed, </condition> </condition> both procedures shall <action> be considered completed. </action> </control>
<control> <condition> <condition> If the network receives a DEREGISTRATION REQUEST message without "switch off" indication, </condition> <condition> before the network-initiated de-registration procedure has been completed, </condition> </condition> the network shall <action> send a DEREGISTRATION ACCEPT message to the UE. </action> </control>
d) De-registration and registration procedure for initial registration collision
<control> <condition> <condition> If the network receives a REGISTRATION REQUEST message indicating either "initial registration" or "emergency registration" in the 5GS registration type IE </condition> <condition> before the network-initiated de-registration procedure has been completed, </condition> </condition> the network shall <action> abort the de-registration procedure </action> and the registration procedure shall <action> be progressed after the PDU sessions associated with the access type the REGISTRATION REQUEST message is sent over have been deleted. </action> </control>
NOTE 1: The above collision case is valid if the DEREGISTRATION REQUEST message indicates the access type over which the initial registration procedure is attempted otherwise both the procedures are
e) De-registration and registration procedure for mobility and periodic registration update collision
<control> <condition> <condition> If the network sent a DEREGISTRATION REQUEST message without 5GMM cause value #11, #12, #13 or #15 </condition> and <condition> the network receives a REGISTRATION REQUEST message indicating either "mobility registration updating" or "periodic registration updating" in the 5GS registration type IE </condition> <condition> before the network-initiated de-registration procedure has been completed, </condition> </condition> the de-registration procedure shall <action> be progressed, </action> i.e. the REGISTRATION REQUEST message shall be ignored. </control>
<control> <condition> <condition> If the network sent a DEREGISTRATION REQUEST message with 5GMM cause value #11, #12, #13 or #15 </condition> and <condition> the network receives a REGISTRATION REQUEST message indicating either "mobility registration updating" or "periodic registration updating" in the 5GS registration type IE </condition> <condition> before the network-initiated de-registration procedure has been completed, </condition> </condition> the de-registration procedure shall <action> be aborted and the registration procedure shall be progressed. </action> </control>
NOTE 2: The above collision case is valid if the DEREGISTRATION REQUEST message indicates the access type over which the mobility and periodic registration procedure is attempted otherwise both the procedures are progressed.
f) De-registration and service request procedure collision
<control> <condition> <condition> If the network receives a SERVICE REQUEST message or a CONTROL PLANE SERVICE REQUEST message </condition> <condition> before the network-initiated de-registration procedure has been completed </condition> </condition> (e.g. the DEREGISTRATION REQUEST message is pending to be sent to the UE), the network shall <action> progress the de-registration procedure. </action> </control>
NOTE 3: The above collision case is valid if the DEREGISTRATION REQUEST message indicates the access type over which the service request procedure is attempted otherwise both the procedures are progressed.
g) De-registration requested for a UE not supporting CAG due to CAG restrictions
<control> Based on operator policy, <condition> if the network-initiated de-registration procedure is triggered for a UE not supporting CAG due to CAG restrictions, </condition> the network shall <action> send the DEREGISTRATION REQUEST message including a 5GMM cause value other than the 5GMM cause #76 (Not authorized for this CAG or authorized for CAG cells only). </action> </control>
NOTE 4: 5GMM cause #7 (5GS services not allowed), 5GMM cause #11 (PLMN not allowed), 5GMM cause #27 (N1 mode not allowed), 5GMM cause #73 (Serving network not authorized) can be used depending on the subscription of the UE and whether the UE roams or not.
5.5.3 eCall inactivity procedure
<control> The eCall inactivity procedure <action> is performed only in 3GPP access and applicable only to a UE configured for eCall only mode as specified in 3GPP TS 31.102 . </action> </control>
<control> The procedure shall <action> be started </action> <condition> when: <condition> a) the UE is in any 5GMM-REGISTERED substate except substates 5GMM-REGISTERED.PLMN-SEARCH or 5GMM-REGISTERED.NO-CELL-AVAILABLE; </condition> <condition> b) the UE is in 5GMM-IDLE mode; and </condition> <condition> c) one of the following conditions applies: </condition> <condition> 1) timer T3444 expires or is found to have already expired and timer T3445 is not running; </condition> <condition> 2) timer T3445 expires or is found to have already expired and timer T3444 is not running; or </condition> <condition> 3) timers T3444 and T3445 expire or are found to have already expired. </condition> </condition> </control>
The UE shall then perform the following actions:
<control> <action> a) stop other running timers (e.g. T3511, T3512); </action> </control>
<control> b) <condition> if the UE is currently registered to the network for 5GS services, </condition> <action> perform a de-registration procedure; </action> </control>
<control> <action> c) delete any 5G-GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, and ngKSI; and </action> </control>
5.5.4 Authentication and key agreement procedure for 5G ProSe UE-to- network relay
5.5.4.1 General
The purpose of the authentication and key agreement procedure for 5G ProSe UE-to-network relay is to perform the authentication for 5G ProSe remote UE initiated by the 5G ProSe UE-to-network relay and to agree on the K and AUSF_PK when the security for 5G ProSe communication via 5G ProSe UE-to-network relay is performed over control NR_ProSe plane as specified in 3GPP TS 33.503 .
The procedure as shown in figure 5.5.4.1.1 is initiated by the UE when the UE receives the ProSe direct link establishment request including the SUCI or the 5GPRUK ID of the 5G ProSe remote UE from the 5G ProSe remote UE, for establishing secure PC5 unicast link as specified in 3GPP TS 24.554 .
<control> <condition> If the network decides to process the relay key request message, </condition> the EAP based authentication and key agreement procedure <action> is initiated and controlled by the network. </action> </control> <control> The exchanges of EAP messages between the 5G ProSe remote UE and the network <action> are relayed by the UE. </action> </control>
UE AMF RELAY KEY REQUEST
Start T3527 RELAY KEY REJECT
Stop T3527
&lt;Key request is rejected&gt; OR RELAY AUTHENTICATION REQUEST
Stop T3527 &lt;EAP-request massage A&gt; RELAY AUTHENTICATION RESPONSE
Start T3527 &lt;EAP-response message to EAP-request message A&gt; RELAY AUTHENTICATION REQUEST
Stop T3527 &lt;EAP-request message B&gt; RELAY AUTHENTICATION RESPONSE
Start T3527 &lt;EAP-response message to EAP-request message B&gt; RELAY KEY ACCEPT
Stop T3527 &lt;EAP-success message&gt; OR RELAY KEY REJECT
5.5.4.2 ProSe relay transaction identity (PRTI)
<control> <condition> Upon receiving a ProSe direct link establishment request from a 5G ProSe remote UE for establishing a secure PC5 unicast link as specified in 3GPP TS 24.554 , </condition> the UE shall <action> allocate an available PRTI value for the authentication and key agreement procedure for 5G ProSe UE-to-network relay and associate this PRTI value with the 5G ProSe remote UE. </action> </control>
<control> The UE shall <action> release the PRTI value allocated to the authentication </action> and <action> key agreement procedure for 5G ProSe UE-to- network relay </action> <condition> when the authentication and key agreement procedure for 5G ProSe UE-to-network relay completes or is </condition> </control>
5.5.4.3 UE-initiated authentication and key agreement procedure initiation
<control> <condition> Upon receiving a ProSe direct link establishment request from the 5G ProSe remote UE including the SUCI or the 5GPRUK ID of the 5G ProSe remote UE, for establishing a secure PC5 unicast link as specified in 3GPP TS 24.554 when the security for 5G ProSe communication via 5G ProSe UE-to-network relay is performed over control plane as specified in 3GPP TS 33.503 , </condition> the UE shall: <action> a) allocate a PRTI value as specified in clause 5.5.4.2; </action> <action> b) create a RELAY KEY REQUEST message; </action> <action> c) set the PRTI IE of the RELAY KEY REQUEST message to the allocated PRTI value; </action> <action> d) set the relay key request parameters IE of the RELAY KEY REQUEST message with SUCI or the 5GPRUK ID, relay service code, and nonce_1 received from the of the 5G ProSe remote UE; </action> <action> e) send the RELAY KEY REQUEST message; and </action> <action> f) start the timer T3527 upon sending the RELAY KEY REQUEST message. </action> </control>
5.5.4.4 UE-initiated authentication and key agreement procedure accepted by the network
<control> <condition> Upon receiving the RELAY KEY REQUEST message, </condition> the AMF <action> processes the message and interacts with the AUSF as specified in 3GPP TS 33.503 . </action> </control> <control> <condition> If EAP-AKA' authentication for the 5G ProSe UE-to-network relay is initiated by the network, </condition> the AMF shall: <action> a) create a RELAY AUTHENTICATION REQUEST message; </action> <action> b) set the PRTI IE of the RELAY AUTHENTICATION REQUEST message to the PRTI value of the received RELAY KEY REQUEST message; </action> c) set the EAP message IE of the RELAY AUTHENTICATION REQUEST message to EAP request message received from the AUSF; and <action> d) send the RELAY AUTHENTICATION REQUEST message to the UE. </action> </control>
<control> <condition> Upon receiving the RELAY AUTHENTICATION REQUEST message, </condition> the UE <action> stops the timer T3527 </action> and <action> forwards the EAP message to the 5G ProSe remote UE as specified in 3GPP TS 24.554 . </action> </control>
<control> <condition> Upon receiving the EAP response message from the 5G ProSe remote UE as specified in 3GPP TS 24.554 , </condition> the UE shall: <action> a) create a RELAY AUTHENTICATION RESPONSE message; </action> <action> b) set the PRTI IE of the RELAY AUTHENTICATION RESPONSE message to the PRTI value of the received RELAY AUTHENTICATION REQUEST message; </action> <action> c) set the EAP message IE of the RELAY AUTHENTICATION RESPONSE message to EAP request message received from the 5G ProSe remote UE; and </action> <action> d) start a timer T3527 upon sending the RELAY AUTHENTICATION RESPONSE message to the AMF. </action> </control>
<control> <condition> After receiving the RELAY AUTHENTICATION RESPONSE message, </condition> the AMF may <action> send a new RELAY AUTHENTICATION REQUEST message carrying EAP request message according to further handling of EAP-AKA' authentication from the AUSF as specified in 3GPP TS 33.503 . </action> </control> <control> The UE <action> repeats the handling of the RELAY AUTHENTICATION REQUEST message as described above. </action> </control>
<control> <condition> Upon receiving the message from the AUSF that the authentication is successful, </condition> the AMF shall: <action> a) create a RELAY KEY ACCEPT message; </action> <action> b) set the PRTI IE of the RELAY KEY ACCEPT message to the PRTI value of the RELAY KEY REQUEST message; </action> <action> c) include the EAP message IE of the RELAY KEY ACCEPT message set to EAP-success message received from the AUSF, if any; </action> <action> d) include the relay key response parameters IE of the RELAY KEY ACCEPT message set to K and NR_ProSe nonce_2 received from AUSF; and </action> <action> e) include the 5GPRUK ID, if provided by AUSF, in the relay key response parameters IE of the RELAY KEY ACCEPT message. </action> </control>
<control> <condition> Upon receiving the RELAY KEY ACCEPT message, </condition> the UE shall <action> forward the EAP-success message, </action> if any, and nonce_2 to the 5G ProSe remote UE as specified in 3GPP TS 24.554 , and <action> considers the authentication is completed successfully. </action> </control>
5.5.4.5 UE-initiated authentication and key agreement procedure not accepted by the network
<control> <condition> If the UE-initiated authentication and key agreement procedure is not accepted by the network, </condition> the AMF shall: <action> a) create a RELAY KEY REJECT message; </action> <action> b) set the PRTI IE of the RELAY KEY REJECT message to the PRTI value of the received RELAY KEY REQUEST message if the network decides to reject the RELAY KEY REQUEST message; or </action> <action> set the PRTI IE of the RELAY KEY REJECT message to the PRTI value of the received RELAY AUTHENTICATION RESPONSE message and include the EAP message IE set with EAP-failure message if the AMF receives an EAP-failure message from the AUSF; and </action> <action> c) send the RELAY KEY REJECT message to the UE. </action> </control>
<control> <condition> Upon receiving the RELAY KEY REJECT message, </condition> the UE shall <action> consider the authentication has failed </action> and <action> perform the PC5 signalling protocol procedure as specified in subclause 7.2.2.5 of 3GPP 24.554 . </action> </control>
5.5.4.6 Abnormal cases in the UE
The following abnormal cases in the UE can be identified:
<control> <condition> a) Transmission failure of RELAY KEY REQUEST message or RELAY KEY AUTHENTICATION RESPONSE message indication from lower layers. </condition> </control>
<control> The UE shall <action> abort the authentication and key agreement procedure for 5G ProSe UE-to-network relay </action> and <action> perform the PC5 signalling protocol procedure as specified in subclause 7.2.2.5 of 3GPP 24.554 . </action> </control>
<control> <condition> b) Expiry of timer T3527. </condition> </control>
<control> The UE shall, <condition> on the first expiry of the timer T3527, </condition> <action> retransmit the RELAY KEY REQUEST message or the RELAY KEY AUTHENTICATION RESPONSE message </action> and shall <action> reset and start timer T3527. </action> </control> <control> This retransmission is repeated four times, i.e. <condition> on the fifth expiry of timer T3527, </condition> the procedure shall <action> be aborted. </action> </control>
<control> <condition> c) Collision between the authentication and key agreement procedure for 5G ProSe UE-to-network relay and de-registration procedure. </condition> </control>
<control> The UE shall <action> abort the authentication and key agreement procedure for 5G ProSe UE-to-network relay, </action> <action> proceed with the network initiated de-registration procedure, </action> and <action> perform the PC5 signalling protocol procedure as specified in subclause 7.2.2.5 of 3GPP 24.554 . </action> </control>
5.5.4.7 Abnormal cases on the network side
The following abnormal cases on the network side can be identified:
<control> <condition> a) Lower layer failure before the RELAY KEY AUTHENTICATION RESPONSE message is received. </condition> </control>
<control> The network shall <action> abort the authentication and key agreement procedure for 5G ProSe UE-to-network relay. </action> </control>
<control> <condition> b) Collision between the authentication and key agreement procedure for 5G ProSe UE-to-network relay and de-registration procedure. </condition> </control>
<control> The network shall <action> abort the authentication and key agreement procedure for 5G ProSe UE-to-network relay </action> and <action> proceed with the UE-initiated de-registration procedure. </action> </control>
<control> <condition> c) Collision between the authentication and key agreement procedure for 5G ProSe UE-to-network relay and other 5GMM procedures other than in item b. </condition> </control>
<control> The network shall <action> progress both procedures. </action> </control>
5.6 5GMM connection management procedures
5.6.1 Service request procedure
5.6.1.1 General
The purpose of the service request procedure is to change the 5GMM mode from 5GMM-IDLE to 5GMM- CONNECTED mode. If the UE is not using 5GS services with control plane CIoT 5GS optimization, this procedure is used to request the establishment of user-plane resources for PDU sessions which are established without user-planeresources. In latter case, the 5GMM mode can be the 5GMM-IDLE mode or the 5GMM-CONNECTED mode if the UE requires to establish user-plane resources for PDU sessions. If the UE is using 5GS services with control plane CIoT 5GS optimization, this procedure can be used for UE initiated transfer of user data via the control plane from 5GMM- IDLE mode.
NOTE 1: <control> The lower layer <action> indicates </action> <condition> when the user-plane resources for PDU sessions are successfully established or </condition> </control>
<control> This procedure <action> is use </action> <condition> when: <condition> a) the network has downlink signalling pending over 3GPP access and the UE is in 5GMM-IDLE mode over 3GPP access; </condition> <condition> b) the network has downlink signalling pending over non-3GPP access, the UE is in 5GMM-IDLE mode over non- 3GPP access and in 5GMM-IDLE or 5GMM-CONNECTED mode over 3GPP access; </condition> <condition> c) the UE has uplink signalling pending over 3GPP access and the UE is in 5GMM-IDLE mode over 3GPP access; </condition> <condition> d) the network has downlink user data pending over 3GPP access and the UE is in 5GMM-IDLE mode over 3GPP access; </condition> <condition> e) the network has downlink user data pending over non-3GPP access, the UE is in 5GMM-IDLE mode over non- 3GPP access and in 5GMM-IDLE or 5GMM-CONNECTED mode over 3GPP access; </condition> <condition> f) the UE has user data pending over 3GPP access and the UE is in 5GMM-IDLE or 5GMM-CONNECTED mode over 3GPP access; </condition> <condition> g) the UE has user data pending over non-3GPP access and the UE is in 5GMM-CONNECTED mode over non- 3GPP access; </condition> <condition> h) the UE in 5GMM-IDLE mode over non-3GPP access, receives an indication from the lower layers of non-3GPP access, that the access stratum connection is established between the UE and the network, if T3346 is not running; </condition> <condition> i) the UE in 5GMM-IDLE or 5GMM-CONNECTED mode over 3GPP access receives a request from the upper layers to perform emergency services fallback and performs emergency services fallback as specified in subclause 4.13.4.2 of 3GPP TS 23.502 ; </condition> <condition> j) the UE has to request resources for V2X communication over PC5; </condition> <condition> k) the UE has to request resources for 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5; </condition> <condition> l) the MUSIM UE in 5GMM-IDLE mode requests the network to remove the paging restriction; </condition> or <condition> m) the MUSIM UE requests the release of the NAS signalling connection or rejects the paging request from the </condition> </condition> </control>
<control> This procedure shall <action> not be used </action> <condition> for: <condition> a) initiating user data transfer; or </condition> <condition> b) PDU session management related signalling other than for performing UE-requested PDU session release procedure related to a PDU session for LADN or for performing the UE-requested PDU session modification procedure to indicate a change of 3GPP PS data off UE status; when the UE is located outside the LADN service area. </condition> </condition> </control>
<control> <condition> In NB-N1 mode, </condition> this procedure shall <action> not be used to request the establishment of user-plane resources: </action> </control>
<control> <condition> a) for a number of PDU sessions that exceeds the UE' s maximum number of supported user-plane resources if there is currently: </condition> </control>
<control> <condition> 1) no user-plane resources established for the UE; </condition> </control>
<control> <condition> i) one PDU session and the Multiple user-plane resources support bit was set to "Multiple user-plane resources not supported" in the 5GMM capability IE; or </condition> </control>
<control> <condition> ii) two PDU sessions and the Multiple user-plane resources support bit was set to "Multiple user-plane resources supported" in the 5GMM capability IE; or </condition> </control>
<control> <condition> b) for additional PDU sessions, if the number of PDU sessions for which user-plane resources are currently established is equal to the UE's maximum number of supported user-plane resources. </condition> </control>
<control> The service request procedure <action> is initiated by the UE, </action> <control> however, it <action> can be triggered by the network </action> <condition> by means of: <condition> a) the paging procedure (see subclause 5.6.2) for the transfer of downlink signalling or user data pending over 3GPP access to a UE in 5GMM-IDLE mode over 3GPP access; </condition> <condition> b) the paging procedure (see subclause 5.6.2) for the transfer of downlink signalling or user data pending over non- 3GPP access to a UE in 5GMM-IDLE mode over 3GPP access and in 5GMM-IDLE mode over non-3GPP access; </condition> <condition> c) the notification procedure (see subclause 5.6.3) for the transfer of downlink signalling or user data pending over non-3GPP access to a UE in 5GMM-CONNECTED mode over 3GPP access and in 5GMM-IDLE mode over non-3GPP access; </condition> or <condition> d) the notification procedure (see subclause 5.6.3) for the transfer of downlink signalling or user data pending over 3GPP access to a UE in 5GMM-IDLE mode over 3GPP access and in 5GMM-CONNECTED mode over non- 3GPP access. </condition> </condition> </control> </control>
NOTE 2: <control> <condition> <condition> In case the UE is in 5GMM-IDLE mode over 3GPP access </condition> and <condition> in 5GMM-CONNECTED mode over non- 3GPP access </condition> and <condition> downlink signalling or user data pending over 3GPP access needs to be transferred, </condition> </condition> the AMF can <action> trigger either the notification procedure or the paging procedure based on implementation. </action> </control>
<control> The UE shall <action> invoke the service request procedure </action> <condition> when: <condition> a) the UE, in 5GMM-IDLE mode over 3GPP access, receives a paging request from the network; NOTE 3: As an implementation option, the MUSIM UE is allowed to not invoke service request to respond to paging based on the information available in the paging message, e.g. voice service indication. </condition> <condition> b) the UE, in 5GMM-CONNECTED mode over 3GPP access, receives a notification from the network with access type indicating non-3GPP access; </condition> <condition> c) the UE, in 5GMM-IDLE mode over 3GPP access, has uplink signalling pending (except in case i); </condition> <condition> d) the UE, in 5GMM-IDLE mode over 3GPP access, has uplink user data pending (except in case j); </condition> <condition> e) the UE, <condition> <condition> in 5GMM-CONNECTED mode </condition> or <condition> in 5GMM-CONNECTED mode with RRC inactive indication, </condition> </condition> has user data pending due to no user-plane resources established for PDU session(s) used for user data transport; </condition> <condition> f) the UE in 5GMM-IDLE mode over non-3GPP access, with T3346 not active or upon expiry of T3346, receives or has already received an indication from the lower layers of non-3GPP access, that the access stratum connection is established between the UE and the network; </condition> <condition> g) the UE, in 5GMM-IDLE mode over 3GPP access, receives a notification from the network with access type indicating 3GPP access when the UE is in 5GMM-CONNECTED mode over non-3GPP access; </condition> <condition> h) the UE, in 5GMM-IDLE, 5GMM-CONNECTED mode over 3GPP access, or 5GMM-CONNECTED mode with RRC inactive indication, receives a request from the upper layers to perform emergency services fallback and performs emergency services fallback as specified in subclause 4.13.4.2 of 3GPP TS 23.502 ; </condition> <condition> i) the UE, <condition> <condition> </condition> in 5GMM-CONNECTED mode over 3GPP access </condition> or <condition> in 5GMM-CONNECTED mode with RRC inactive indication, </condition> <condition> receives a fallback indication from the lower layers (see subclauses 5.3.1.2 and 5.3.1.4) and the UE has a pending NAS procedure other than a registration, service request, or de-registration procedure; </condition> <condition> j) the UE, <condition> <condition> </condition> in 5GMM-CONNECTED mode over 3GPP access </condition> or <condition> in 5GMM-CONNECTED mode with RRC inactive indication, </condition> </condition> receives a fallback indication from the lower layers (see subclauses 5.3.1.2 and 5.3.1.4) and the UE has pending uplink user data for PDU session(s) with user-plane resources already established but no pending NAS procedure; </condition> <condition> k) the UE, in 5GMM-CONNECTED mode and has a NAS signalling connection only, is using 5GS services with control plane CIoT 5GS optimization and has pending user data to be sent via user-plane resources; </condition> <condition> l) the UE in 5GMM-IDLE mode over 3GPP access has to request resources for V2X communication over PC5 (see 3GPP TS 23.287 ); </condition> <condition> m) the network supports the paging restriction, and the MUSIM UE in 5GMM-IDLE mode is requesting the network to remove the paging restriction; </condition> <condition> n) the UE in 5GMM-IDLE mode over 3GPP access a) has to request resources for 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5 (see 3GPP TS 23.304 ); or b) acts as a 5G ProSe layer-2 UE-to-network relay UE and receives a trigger from lower layers to establish the NAS signalling connection (see 3GPP TS 23.304 ); </condition> <condition> o) the network supports the N1 NAS signalling connection release, the MUSIM UE, a) is in 5GMM-CONNECTED mode, requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction; b) is <condition> in 5GMM-CONNECTED mode with RRC inactive indication, </condition> requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction; or c) is <condition> in 5GMM-CONNECTED mode with RRC inactive indication, </condition> rejects the RAN paging, requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction; or </condition> <condition> p) the network supports the reject paging request, the MUSIM UE in 5GMM-IDLE mode when responding to paging rejects the paging request from the network, requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction. </condition> </condition> </control>
<control> <condition> If one of the above criteria to invoke the service request procedure is fulfilled, </condition> then <control> the service request procedure shall <action> only be initiated by the UE </action> <condition> when the following conditions are fulfilled: <condition> a) its 5GS update status is 5U1 UPDATED, and the TAI of the current serving cell is included in the TAI list; </condition> and <condition> b) no 5GMM specific procedure is ongoing. </condition> </condition> </control> </control>
<control> The UE shall <action> not invoke the service request procedure </action> <start_state> when the UE is in the state 5GMM-SERVICE-REQUEST- INITIATED. </start_state> </control>
<control> The MUSIM UE shall <action> not initiate service request procedure for requesting the network to release the N1 NAS signalling connection </action> <condition> <condition> if the UE is registered for emergency services </condition> or <condition> if the UE has an emergency PDU session established. </condition> </condition> </control> <control> To enable the emergency call back, the UE shall <action> not initiate service request procedure for requesting the network </action> to release the NAS signalling connection for a UE implementation-specific duration of time after the completion of the emergency services. </control>
A service request attempt counter is used to limit the number of service request attempts and no response from the network. <control> The service request attempt counter shall be <action> incremented as specified in subclause 5.6.1.7. </action> </control>
<control> The service request attempt counter shall <action> be reset </action> <condition> when: <condition> a) a registration procedure for mobility and periodic registration update is successfully completed; </condition> <condition> b) a service request procedure is successfully completed; </condition> <condition> c) a service request procedure is rejected as specified in subclause 5.6.1.5 or subclause 5.3.20; </condition> or <start_state> d) the UE moves to 5GMM-DEREGISTERED state. </start_state> </condition> </control>
5.6.1.2 Service request procedure initiation
5.6.1.2.1 UE is not using 5GS services with control plane CIoT 5GS optimization
<control> The UE <action> initiates the service request procedure by sending a SERVICE REQUEST message to the AMF. </action> </control> <control> The UE shall <action> start timer T3517 </action> and <end_state> enter the state 5GMM-SERVICE-REQUEST-INITIATED. </end_state> </control>
<control> <condition> <condition> If the UE is sending the SERVICE REQUEST message from 5GMM-IDLE mode </condition> and <condition> the UE needs to send non- cleartext IEs, </condition> </condition> the UE shall <action> send the SERVICE REQUEST message including the NAS message container IE as described in subclause 4.4.6. </action> </control>
<control> <condition> For cases a), b), and g) in subclause 5.6.1.1, </condition> the service type IE in the SERVICE REQUEST message shall <action> be set to "mobile terminated services". </action> </control>
<control> <condition> For case a) in subclause 5.6.1.1: </condition> </control>
<control> a) <condition> if the paging request includes an indication for non-3GPP access type, </condition> the Allowed PDU session status IE shall <action> be included in the SERVICE REQUEST message. </action> </control> <control> <condition> If the UE has established the PDU session(s) over the non- 3GPP access for which the associated S-NSSAI(s) are included in the allowed NSSAI for 3GPP access, </condition> the UE shall <action> indicate the PDU session(s) for which the UE allows the user-plane resources to be re-established over 3GPP access in the Allowed PDU session status IE. </action> </control> <control> <condition> Otherwise, </condition> the UE shall <action> not indicate any PDU session(s) in the Allowed PDU session status IE; </action> </control> and
<control> b) <condition> if the UE has uplink user data pending to be sent over 3GPP access, </condition> the Uplink data status IE shall <action> be included in the SERVICE REQUEST message to indicate the PDU session(s) </action> </control> for which the UE has pending user data to be sent. <control> <condition> Otherwise, </condition> the Uplink data status IE shall <action> not be included in the SERVICE REQUEST message. </action> </control>
<control> <condition> For case b) in subclause 5.6.1.1: </condition> </control>
<control> a) the Allowed PDU session status IE shall <action> be included in the SERVICE REQUEST message. </action> </control> <control> <condition> If the UE has the PDU session(s) over the non-3GPP access for which the associated S-NSSAI(s) are included in the allowed NSSAI for 3GPP access, </condition> the UE shall <action> indicate the PDU session(s) for which the UE allows the user-plane resources to be re-established over 3GPP access in the Allowed PDU session status IE. </action> </control> <control> <condition> Otherwise, </condition> the UE shall not <action> indicate any PDU session(s) in the Allowed PDU session status IE; </action> </control> and
<control> b) <condition> if the UE has uplink user data pending to be sent over 3GPP access, </condition> the Uplink data status IE shall <action> be included in the SERVICE REQUEST message to indicate the PDU session(s) for which the UE has pending user data to be sent. </action> </control> <control> <condition> Otherwise, </condition> the Uplink data status IE shall <action> not be included in the SERVICE REQUEST message. </action> </control>
<control> <condition> When the Allowed PDU session status IE is included in the SERVICE REQUEST message, </condition> the UE shall <action> indicate that a PDU session is not allowed to be transferred to the 3GPP access </action> <condition> <condition> if the 3GPP PS data off UE status is "activated" for the corresponding PDU session </condition> and <condition> the UE is not using the PDU session to send uplink IP packets for any of the 3GPP PS data off exempt services (see subclause 6.2.10). </condition> </condition> </control>
<control> <condition> For case c) in subclause 5.6.1.1, </condition> the Uplink data status IE shall <action> not be included in the SERVICE REQUEST message </action> <condition> except if the UE has one or more active always-on PDU sessions associated with the access type over which the SERVICE REQUEST message is sent. </condition> </control> <control> <condition> If the UE is not a UE configured for high priority access in selected PLMN </condition> and: </control>
<control> a) <condition> if the SERVICE REQUEST message is triggered by a request for emergency services from the upper layer, </condition> the UE shall <action> set the service type IE in the SERVICE REQUEST message to "emergency services"; </action> or </control>
<control> <condition> b) otherwise, </condition> the UE shall <action> set the service type IE to "signalling". </action> </control>
<control> <condition> When the UE is in a non-allowed area or is not in an allowed area as specified in subclause 5.3.5 and: </condition> </control>
<control> a) <condition> if the uplink signalling pending is to indicate a change of 3GPP PS data off UE status for a PDU session, </condition> the UE shall <action> set the service type IE in the SERVICE REQUEST message to "elevated signalling", </action> and shall <action> not include the Uplink data status IE in the SERVICE REQUEST message </action> even if the UE has one or more active always-on PDU sessions associated with the access type over which the SERVICE REQUEST message is sent; or </control>
<control> <condition> b) otherwise, </condition> the UE shall <action> not initiate service request procedure except for emergency services, high priority access or responding to paging or notification. </action> </control>
<control> <condition> For cases d) and e) in subclause 5.6.1.1, </condition> the Uplink data status IE shall <action> be included in the SERVICE REQUEST message to indicate the PDU session(s) the UE has pending user data to be sent. </action> </control> <control> <condition> If the UE is not a UE configured for high priority access in selected PLMN: </condition> </control>
<control> a) <condition> if there exists an emergency PDU session </condition> which is indicated in the Uplink data status IE the service type IE in the SERVICE REQUEST message shall <action> be set to "emergency services"; </action> or </control>
<control> <condition> b) otherwise, </condition> the service type IE in the SERVICE REQUEST message shall <action> be set to "data". </action> </control>
NOTE 1: For a UE in NB-N1 mode, the Uplink data status IE cannot be used to request the establishment of user- plane resources such that there will be user-plane resources established for a number of PDU sessions that exceeds the UE's maximum number of supported user-plane resources.
<control> <condition> For case f) in subclause 5.6.1.1: </condition> </control>
<control> a) <condition> if the UE has uplink user data pending to be sent, </condition> the Uplink data status IE shall <action> be included in the SERVICE REQUEST message to indicate the PDU session(s) the UE has pending user data to be sent. </action> </control> <control> <condition> If the UE is not a UE configured for high priority access in selected PLMN, </condition> the service type IE in the SERVICE REQUEST message shall <action> be set to "data"; </action> </control>
<control> <condition> b) <condition> otherwise, </condition> <condition> if the UE is not a UE configured for high priority access in selected PLMN, </condition> </condition> the service type IE in the SERVICE REQUEST message shall be <action> set to "signalling". </action> </control>
<control> <condition> <condition> For case g) in subclause 5.6.1.1, </condition> <condition> if the UE has uplink user data pending to be sent, </condition> </condition> the Uplink data status IE shall <action> be included in the SERVICE REQUEST message to indicate the PDU session(s) the UE has pending user data to be sent. </action> </control>
<control> <condition> For case h) in subclause 5.6.1.1, </condition> the UE shall <action> send a SERVICE REQUEST message </action> with service type set to "emergency services fallback" and without an Uplink data status IE. </control>
<control> <condition> <condition> For case i) in subclause 5.6.1.1, </condition> <condition> if the UE is not configured for high priority access in selected PLMN, </condition> </condition> the UE shall <action> set the Service type IE in the SERVICE REQUEST message as follows: </action> </control>
<control> a) <condition> if the pending message is an UL NAS TRANSPORT message with the Request type IE set to "initial emergency request" or "existing emergency PDU session", </condition> the UE shall <action> set the Service type IE in the SERVICE REQUEST message to "emergency services"; </action> or </control>
<control> <condition> b) otherwise, </condition> the UE shall <action> set the Service type IE in the SERVICE REQUEST message to "signalling". </action> </control>
<control> <condition> For case j) in subclause 5.6.1.1: </condition> </control>
<control> a) the UE shall <action> include the Uplink data status IE in the SERVICE REQUEST message indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, </action> if any; </control> and
<control> b) <condition> if the UE is not a UE configured for high priority access in selected PLMN, </condition> the UE shall <action> set the Service type IE in the SERVICE REQUEST message as follows: </action> </control>
<control> 1) <condition> if there is an emergency PDU session which is indicated in the Uplink data status IE, </condition> the UE shall <action> set the Service type IE in the SERVICE REQUEST message to "emergency services"; </action> or </control>
<control> 2) <condition> if there is no emergency PDU session which is indicated in the Uplink data status IE, </condition> the UE shall <action> set the Service type IE in the SERVICE REQUEST message to "data". </action> </control>
<control> <condition> <condition> For case l) and n) in subclause 5.6.1.1, </condition> <condition> if the UE is not a UE configured for high priority access in selected PLMN: </condition> </condition> </control>
<control> a) <condition> if there exists an emergency PDU session which is indicated in the Uplink data status IE </condition> the service type IE in the SERVICE REQUEST message shall be <action> set to "emergency services"; </action> </control> or
<control> <condition> b) otherwise, </condition> the service type IE in the SERVICE REQUEST message shall <action> be set to "signalling". </action> </control>
<control> <condition> For case m) in subclause 5.6.1.1, </condition> the UE shall <action> not include the Paging restriction IE in the SERVICE REQUEST message </action> and <action> set Service type to "signalling". </action> </control> <control> The UE <action> may include the UE request type IE </action> and <action> set Request type to "NAS signalling connection release" </action> to remove the paging restriction and request the release of the NAS signalling connection at the same time. </control> <control> <condition> If the UE requests the release of the NAS signalling connection, </condition> the UE shall <action> not include the Uplink data status IE in the SERVICE REQUEST message. </action> </control>
<control> <condition> For cases o and p in subclause 5.6.1.1, </condition> the UE shall <action> not include the Uplink data status IE and the Allowed PDU session status IE in the SERVICE REQUEST message. </action> </control> <control> Further, <condition> a) for case o in subclause 5.6.1.1, </condition> the UE shall <action> set Request type to "NAS signalling connection release" in the UE request type IE and Service type to "signalling"; </action> </control> <control> <condition> b) for case p in subclause 5.6.1.1, </condition> the UE shall <action> set Request type to "Rejection of paging" in the UE request type IE and Service type to "mobile terminated services"; </action> and may <action> include its paging restriction preference in the Paging restriction IE in the SERVICE REQUEST message. </action> </control>
<control> The UE shall <action> include a valid 5G-S-TMSI in the 5G-S-TMSI IE of the SERVICE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except cases o) and p) in subclause 5.6.1.1, </condition> <condition> if the UE has one or more active always-on PDU sessions associated with the access type over which the SERVICE REQUEST message is sent and the user-plane resources for these PDU sessions are not established, </condition> </condition> the UE shall <action> include the Uplink data status IE in the SERVICE REQUEST message </action> and <action> indicate that the UE has pending user data to be sent for those PDU sessions. </action> </control>
<control> <condition> <condition> If the UE has one or more active PDU sessions which are not accepted by the network as always-on PDU sessions </condition> and <condition> no uplink user data pending to be sent for those PDU sessions, </condition> </condition> the UE shall <action> not include those PDU sessions in the Uplink data status IE in the SERVICE REQUEST message. </action> </control>
<control> The Uplink data status IE may <action> be included in the SERVICE REQUEST message </action> to indicate which PDU session(s) associated with the access type the SERVICE REQUEST message is sent over have pending user data to be sent. </control>
<control> The PDU session status information element <action> may be included in the SERVICE REQUEST message </action> to indicate: a) the single access PDU session(s) not in 5GSM state PDU SESSION INACTIVE in the UE associated with the access type the SERVICE REQUEST message is sent over; and b) the MA PDU session(s) not in 5GSM state PDU SESSION INACTIVE and having user plane resources established in the UE on the access the SERVICE REQUEST message is sent over. </control>
<control> <condition> If the SERVICE REQUEST message includes a NAS message container IE, </condition> the AMF shall <action> process the SERVICE REQUEST message that is obtained from the NAS message container IE as described in subclause 4.4.6. </action> </control>
<control> <condition> If the UE has an emergency PDU session over the non-current access, </condition> it shall <action> not initiate the SERVICE REQUEST message with the service type IE set to "emergency services" over the current access, </action> <condition> unless the SERVICE REQUEST message has to be initiated to perform handover of an existing emergency PDU session from the non-current access to the current access. </condition> </control>
NOTE 2: <control> Transfer of an existing emergency PDU session between 3GPP access and non-3GPP access <action> is needed </action> e.g. <condition> if the UE determines that the current access is no longer available. </condition> </control>
5.6.1.2.2 UE is using 5GS services with control plane CIoT 5GS optimization
<control> The UE shall <action> send a CONTROL PLANE SERVICE REQUEST message, </action> <action> start T3517 </action> and <end_state> enter the state 5GMM- SERVICE-REQUEST-INITIATED. </end_state> </control>
<control> <condition> For case a), and case b) in subclause 5.6.1.1, </condition> the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall <action> indicate "mobile terminating request". </action> </control> If:
<control> <condition> a) the UE only has uplink CIoT user data or SMS to be sent, </condition> the UE shall: <control> 1) <condition> <condition> if the data size is not more than 254 octets </condition> and <condition> there is no other optional IE to be included in the message: </condition> </condition> i) for sending CIoT user data, <action> set the Data type field to "control plane user data", </action> <action> include the PDU session ID, data, and Downlink data expected (DDX) (if available), in the CIoT small data container IE; </action> and ii) for sending SMS, <action> set the Data type field to "SMS", include SMS in the CIoT small data container IE; </action> and </control> </control>
<control> 2) <condition> otherwise if the data size is more than 254 octets or there are other optional IEs to be included in the message: </condition> i) for sending CIoT user data, <action> set the Payload container type IE to "CIoT user data container", </action> <action> include the PDU session ID in the PDU session ID IE and include data in the Payload container IE as described in subclause 5.4.5.2.2; </action> and </control>
<control> ii) for sending SMS, <action> set the Payload container type IE to "SMS" and include data in the Payload container IE as described in subclause 5.4.5.2.2; </action> and </control> <control> <condition> b) <condition> the paging request or the notification includes an indication for non-3GPP access type, </condition> <condition> the UE ac has at least one PDU session that is not associated with control plane only indication, </condition> </condition> the Allowed PDU session status IE shall <action> be included in the CONTROL PLANE SERVICE REQUEST message. </action> </control>
NOTE 1: The term DDX used in the present document corresponds to the term NAS RAI used in 3GPP TS 23.502 .
<control> <condition> <condition> For case c), and case d) </condition> <condition> if the UE has pending CIoT user data that is to be sent via the control plane in subclause 5.6.1.1, </condition> </condition> the UE shall <action> set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "mobile originating request". </action> </control> <control> <condition> If the UE has only uplink CIoT user data, SMS or location services message to be sent, </condition> the UE shall: </control>
<control> a) <condition> if the data size is not more than 254 octets, </condition> <action> there is no other optional IE to be included in the CONTROL PLANE SERVICE REQUEST message, </action> and the data being sent <action> is: 1) CIoT user data, set the Data type field to "control plane user data", include the PDU session ID, data, and Downlink data expected (DDX) (if available), in the CIoT small data container IE; </action> <action> 2) location services message, set the Data type field to "Location services message container" and Downlink data expected (DDX), if available, in the CIoT small data container IE, and: </action> </control>
<control> i) <condition> if routing information is provided by upper layers: </condition> </control>
<control> A) <action> set the length of additional information field in the CIoT small data container IE to the length of routing information provided by upper layer location services application (see subclause 9.11.3.67), </action> and <action> set the additional information field in the CIoT small data container IE to the routing information provided by upper layer location services application </action> (see subclause 9.11.3.67); or <control> <condition> b) otherwise </condition> <action> set the length of additional information field in the CIoT small data container IE to zero. </action> </control> <control> In this case the Additional information field of the CIoT small data container IE shall <action> not be included; </action> and </control> </control>
<control> ii) <action> set the Data contents field of the CIoT small data container IE to the location services message payload; </action> or </control>
<control> 3) SMS, <action> set the Data type field to "SMS", include SMS in the CIoT small data container IE; </action> or </control>
<control> <condition> b) otherwise if the data size is more than 254 octets or there are other optional IEs to be included in the CONTROL PLANE SERVICE REQUEST message, </condition> and the data being sent is: </control>
<control> 1) <condition> CIoT user data, </condition> <action> set the Payload container type IE to "CIoT user data container", </action> <action> include the PDU session ID in the PDU session ID IE </action> and <action> include data in the Payload container IE as described in subclause 5.4.5.2.2; </action> </control>
<control> 2) <condition> location services message, </condition> <action> set the Payload container type IE to "Location services message container", </action> <action> include data in the Payload container IE as described in subclause 5.4.5.2.2. </action> <control> <condition> If the upper layer location services application provides the routing information set the Additional information IE to the routing information as described in subclause 5.4.5.2.2; or </condition> </control> </control>
<control> 3) <condition> SMS, </condition> <action> set the Payload container type IE to "SMS" and include data in the Payload container IE as described in subclause 5.4.5.2.2. </action> </control>
<control> <condition> <condition> For case a), and case b) in subclause 5.6.1.1, </condition> <condition> if the UE has pending user data that is to be sent via the user plane, </condition> </condition> the UE shall <action> set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "mobile terminating request". </action> </control> <control> The UE shall <action> include the Uplink data status IE in the CONTROL PLANE SERVICE REQUEST message to indicate which PDU session(s) have pending user data to be sent via user-plane resources. </action> </control>
<control> <condition> <condition> For case c) in subclause 5.6.1.1, </condition> <condition> if the UE is in WB-N1 mode and the CONTROL PLANE SERVICE REQUEST message is triggered by a request for emergency services from the upper layer, </condition> </condition> the UE shall <action> set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "emergency services". </action> </control>
<control> <condition> <condition> For cases d) and k), </condition> <condition> if the UE has pending user data that is to be sent via the user plane in subclause 5.6.1.1: </condition> </condition> <control> a) and <condition> if there exists an emergency PDU session which is indicated in the Uplink data status IE, </condition> the UE shall <action> set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "emergency services"; </action> or </control> <control> <condition> b) otherwise, </condition> the UE shall <action> set the Control plane service type to "mobile originating request". </action> </control> </control>
<control> The UE shall <action> include the Uplink data status IE in the CONTROL PLANE SERVICE REQUEST message to indicate which PDU session(s) have pending user data to be sent via user-plane resources. </action> </control>
NOTE 2: For a UE in NB-N1 mode, the Uplink data status IE cannot be used to request the establishment of user- plane resources such that there will be user-plane resources established for a number of PDU sessions that exceeds the UE's maximum number of supported user-plane resources.
<control> <condition> <condition> For case h) in subclause 5.6.1.1, </condition> <condition> if the UE is in WB-N1 mode and the UE does not have any PDU session that is associated with control plane only indication, </condition> </condition> the UE shall <action> send a CONTROL PLANE SERVICE REQUEST message with the Control plane service type set to "emergency services fallback" and without an Uplink data status IE. </action> </control>
<control> <condition> For case i) in subclause 5.6.1.1, </condition> the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall <action> indicate "mobile originating request". </action> </control> <control> <condition> If the pending message is an UL NAS TRANSPORT message with the Payload container type IE set to: a) "SMS", "Location services message container", or "CIoT user data container", </condition> the UE shall <action> send the CONTROL PLANE SERVICE REQUEST and include the SMS, location services message, or CIoT user data as described in this subclause; </action> or </control>
<control> <condition> b) otherwise, </condition> the UE shall <action> send the CONTROL PLANE SERVICE REQUEST: </action> </control>
<control> 1) <action> without including the CIoT small data container IE and without including the NAS message container IE </action> <condition> if the UE has no other optional IE to be sent; </condition> </control> or
<control> 2) <action> with the NAS message container IE </action> <condition> if the UE has an optional IE to be sent as described in this subclause. </condition> </control>
<control> <condition> For case j) in subclause 5.6.1.1, </condition> the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall <action> indicate "mobile originating request". </action> </control> <control> The UE shall <action> include the Uplink data status IE in the CONTROL PLANE SERVICE REQUEST message </action> indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any. </control>
<control> <condition> For cases o) and p) in subclause 5.6.1.1, </condition> the UE shall <action> not include the Uplink data status IE and the Allowed PDU session status IE in the CONTROL PLANE SERVICE REQUEST message. </action> </control> <control> Further, <condition> a) for case o) in subclause 5.6.1.1, </condition> the UE shall <action> set Request type to "NAS signalling connection release" in the UE request type IE and Control plane service type to "mobile originating request"; </action> </control> <control> <condition> b) for case p) in subclause 5.6.1.1, </condition> the UE shall <action> set Request type to "Rejection of paging" in the UE request type IE and Control plane service type to "mobile terminating request"; </action> and may <action> include its paging restriction preferences in the Paging restriction IE in the CONTROL PLANE SERVICE REQUEST message. </action> </control>
<control> <condition> For case m) in clause 5.6.1.1, </condition> the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall <action> indicate "mobile originating request". </action> </control> <control> The UE shall <action> not include the Paging restriction IE in the CONTROL PLANE SERVICE REQUEST message. </action> </control> <control> The UE may <action> include the UE request type IE and set Request type to "NAS signalling connection release" to remove the paging restriction </action> and <action> request the release of the NAS signalling connection at the same time. </action> </control> <control> <condition> If the UE requests the release of the NAS signalling connection, </condition> the UE shall <action> not include the Uplink data status IE in the SERVICE REQUEST message. </action> </control>
<control> The UE may <action> include the PDU session status IE in the CONTROL PLANE SERVICE REQUEST message to indicate which PDU session(s) associated with the access type the CONTROL PLANE SERVICE REQUEST message is sent over are active in the UE. </action> </control>
5.6.1.3 Common procedure initiation
<control> <condition> Upon receipt of the SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message, </condition> the AMF may <action> initiate the common procedures </action> e.g. the 5G AKA based primary authentication and key agreement procedure or the EAP based primary authentication and key agreement procedure. </control>
5.6.1.4 Service request procedure accepted by the network
5.6.1.4.1 UE is not using 5GS services with control plane CIoT 5GS optimization
<control> <condition> For cases other than h) in subclause 5.6.1.1, </condition> the UE shall <action> treat the reception of the SERVICE ACCEPT message as successful completion of the procedure. </action> </control> <control> The UE shall <action> reset the service request attempt counter, </action> <action> stop timer T3517 </action> and <end_state> enter the state 5GMM-REGISTERED. </end_state> </control>
<control> <condition> For case h) in subclause 5.6.1.1, </condition> </control>
<control> a) the UE shall <action> treat the indication from the lower layers when the UE has changed to S1 mode or E-UTRA connected to 5GCN (see 3GPP TS 23.502 ) as successful completion of the procedure </action> and <action> stop timer T3517; </action> </control>
<control> b) <condition> if a UE operating in single-registration mode has changed to S1 mode, </condition> it shall <action> disable the N1 mode capability for 3GPP access (see subclause 4.9.2); </action> </control> and
<control> c) the AMF shall <action> not check for CAG restrictions. </action> </control>
<control> <condition> If the PDU session status information element is included in the SERVICE REQUEST message, </condition> then: <control> <condition> a) for single access PDU sessions, </condition> the AMF shall: <control> 1) <action> perform a local release of all those PDU sessions </action> which are not in 5GSM state PDU SESSION INACTIVE on the AMF side associated with the access type the SERVICE REQUEST message is sent over, but are indicated by the UE as being in 5GSM state PDU SESSION INACTIVE; and </control> <control> 2) <action> request the SMF to perform a local release of all those PDU sessions. </action> <control> <condition> If any of those PDU sessions is associated with one or more MBS sessions, </condition> the SMF shall <action> consider the UE as removed from the associated MBS sessions; and </action> </control> </control> </control> <control> <condition> b) for MA PDU sessions, </condition> the AMF shall: <control> 1) <condition> for MA PDU sessions having user plane resources established in the AMF only on the access the SERVICE REQUEST message is sent over, but are indicated by the UE as no user plane resources established: </condition> <control> <condition> i) for all those MA PDU sessions without a PDN connection established as a user-plane resource, </condition> <action> perform a local release of all those MA PDU sessions </action> and <action> request the SMF to perform a local release of all those MA PDU sessions. </action> </control> <control> <condition> If the MA PDU session is associated with one or more MBS sessions, </condition> the SMF shall <action> consider the UE as removed from the associated MBS sessions; </action> </control> </control> and <control> ii) <condition> for all those MA PDU sessions with a PDN connection established as a user-plane resource, </condition> <action> perform a local release of user plane resources of all those PDU sessions on the access the SERVICE REQUEST message is sent over and request the SMF to perform a local release of user plane resources of all those PDU sessions on the access type the SERVICE REQUEST message is sent over; </action> </control> and <control> 2) <condition> for MA PDU sessions having user plane resources established on both accesses in the AMF, but are indicated by the UE as no user plane resources established: </condition> <control> i) <action> perform a local release of user plane resources of all those PDU sessions on the access the SERVICE REQUEST message is sent over; </action> and ii) <action> request the SMF to perform a local release of user plane resources of all those PDU sessions on the access type the SERVICE REQUEST message is sent over. </action> <control> <condition> If the SERVICE REQUEST message is sent over 3GPP access and the MA PDU session is associated with one or more MBS sessions, </condition> the SMF shall <action> consider the UE as removed from the associated MBS sessions. </action> </control> </control> </control> </control> </control>
<control> <condition> If the AMF needs to initiate PDU session status synchronization or a PDU session status IE was included in the SERVICE REQUEST message, </condition> the AMF shall <action> include a PDU session status IE in the SERVICE ACCEPT message </action> to indicate: a) which single access PDU sessions associated with the access type the SERVICE ACCEPT message is sent over are not in 5GSM state PDU SESSION INACTIVE in the AMF; and b) which MA PDU sessions are not in 5GSM state PDU SESSION INACTIVE and having user plane resources established in the AMF on the access the SERVICE ACCEPT message is sent over. </control>
<control> <condition> If the PDU session status information element is included in the SERVICE ACCEPT message, </condition> then: <control> <condition> a) for single access PDU sessions, </condition> the UE shall <action> perform a local release </action> of all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING on the UE side associated with the access type the SERVICE ACCEPT message is sent over, but are indicated by the AMF as in 5GSM state PDU SESSION INACTIVE. </control> <control> <condition> If a locally released PDU session is associated with one or more MBS sessions, </condition> the UE shall <action> locally leave the associated MBS sessions; </action> </control> </control> and <control> <condition> <condition> b) for MA PDU sessions, </condition> <condition> for all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING </condition> and <condition> have user plane resources established on the UE side associated with the access the SERVICE ACCEPT message is sent over, </condition> <condition> but are indicated by the AMF as no user plane resources established: </condition> </condition> <control> 1) <condition> for MA PDU sessions having user plane resources established only on the access type the SERVICE ACCEPT message is sent over, </condition> the UE shall <action> perform a local release of those MA PDU sessions. </action> </control> <control> <condition> If a locally released MA PDU session is associated with one or more MBS sessions, </condition> the UE shall <action> locally leave the associated MBS sessions; </action> </control> </control> and <control> 2) <condition> for MA PDU sessions having user plane resources established on both accesses, </condition> the UE shall <action> perform a local release on the user plane resources on the access type the SERVICE ACCEPT message is sent over. </action> <control> <condition> <condition> If the user plane resources over 3GPP access are released </condition> and <condition> the MA PDU session is associated with one or more MBS sessions, </condition> </condition> the UE shall <action> locally leave the associated MBS sessions. </action> </control> </control>
<control> <condition> <condition> If the Uplink data status IE is included in the SERVICE REQUEST message </condition> and <condition> the UE is: a) not in NB-N1 mode; </condition> or b) <condition> in NB-N1 mode and the UE does not indicate a request to have user-plane resources established for a number of PDU sessions that exceeds the UE's maximum number of supported user-plane resources; </condition> </condition> the AMF shall: a) <action> indicate the SMF to re-establish the user-plane resources for the corresponding PDU sessions; </action> b) <action> include the PDU session reactivation result IE in the SERVICE ACCEPT message to indicate the user-plane resources re-establishment result of the PDU sessions for which the UE requested to re-establish the user-plane resources; </action> and <control> c) <action> determine the UE presence in LADN service area and forward the UE presence in LADN service area towards the SMF, </action> <condition> if the corresponding PDU session is a PDU session for LADN. </condition> </control> </control>
<control> <condition> If the Allowed PDU session status IE is included in the SERVICE REQUEST message, </condition> the AMF shall: </control>
<control> <condition> a) for a 5GSM message from each SMF that has indicated pending downlink signalling only, </condition> <action> forward the received 5GSM message via 3GPP access to the UE </action> <condition> after the SERVICE ACCEPT message is sent; </condition> </control>
<control> <condition> b) for each SMF that has indicated pending downlink data only: </condition> </control>
<control> 1) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE; </action> and </control>
<control> 2) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed </action> if: </control>
<control> <condition> i) for a UE not in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; </condition> or </control>
<control> ii) <condition> for a UE in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE, and the resulting number of PDU sessions with established user-plane resources does not exceed the UE's maximum number of supported user-plane resources; </condition> </control>
<control> <condition> c) for each SMF that have indicated pending downlink signalling and data: </condition> </control>
<control> 1) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE; </action> </control>
<control> 2) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed </action> if: </control>
<control> <condition> i) for a UE not in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; or </condition> </control>
<control> ii) <condition> for a UE in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE, and the resulting number of PDU sessions with established user-plane resources does not exceed the UE's maximum number of supported user-plane resources; </condition> </control> and
<control> 3) <action> discard the received 5GSM message for PDU session(s) associated with non-3GPP access; </action> and </control>
<control> d) <action> include the PDU session reactivation result IE in the SERVICE ACCEPT message to indicate the successfully re-established user-plane resources for the corresponding PDU sessions, </action> if any. </control>
<control> <condition> <condition> If due to regional subscription restrictions or access restrictions the UE is not allowed to access the TA or due to CAG restrictions the UE is not allowed to access the cell, </condition> but <condition> the UE has an emergency PDU session established, </condition> </condition> the AMF may <action> accept the SERVICE REQUEST message </action> and <action> indicate to the SMF to perform a local release of all non-emergency PDU sessions </action> (associated with 3GPP access if it is due to CAG restrictions) and <action> informs the UE via the PDU session status IE in the SERVICE ACCEPT message. </action> </control> <control> The AMF shall <action> not indicate to the SMF to release the emergency PDUsession. </action> </control> <control> <condition> If the AMF indicated to the SMF to perform a local release of all non-emergency PDU sessions </condition> (associated with 3GPP access if it is due to CAG restrictions), the network shall <action> behave as if the UE is registered for emergency </action> </control>
<control> <condition> If the PDU session reactivation result IE is included in the SERVICE ACCEPT message indicating that the user-plane resources have been successfully reactivated for a PDU session that was requested by the UE in the Allowed PDU session status IE, </condition> the UE <action> considers the corresponding PDU session to be associated with the 3GPP access. </action> </control> <control> <condition> If the user- plane resources of a PDU session have been successfully reactivated over the 3GPP access, </condition> the AMF and SMF <action> update the associated access type of the corresponding PDU session. </action> </control>
<control> <condition> If the user-plane resources cannot be established for a PDU session, </condition> the AMF shall <action> include the PDU session reactivation result IE in the SERVICE ACCEPT message indicating that user-plane resources for the corresponding PDU session cannot be re-established, and: </action> <control> a) <condition> if the user-plane resources cannot be established because the SMF indicated to the AMF that the UE is located out of the LADN service area (see 3GPP TS 29.502 ), </condition> the AMF shall <action> include the PDU session reactivation result error cause IE with the 5GMM cause set to #43 "LADN not available"; </action> </control> <control> b) <condition> if the user-plane resources cannot be established because the SMF indicated to the AMF that only prioritized services are allowed (see 3GPP TS 29.502 ), </condition> the AMF shall <action> include the PDU session reactivation result error cause IE with the 5GMM cause set to #28 "restricted service area"; </action> </control> <control> c) <condition> if the user-plane resources cannot be established because the SMF indicated to the AMF that the resource is not available in the UPF (see 3GPP TS 29.502 ), </condition> the AMF shall <action> include the PDU session reactivation result error cause IE with the 5GMM cause set to #92 "insufficient user-plane resources for the PDU session"; </action> </control> <control> e) <condition> if the user-plane resources cannot be established because the SMF indicated to the AMF that the S-NSSAI associated with the PDU session is unavailable due to NSAC (see 3GPP TS 29.502 ), </condition> the AMF shall <action> include the PDU session reactivation result error cause IE with the 5GMM cause set to #69 "insufficient resources for specific slice"; or </action> </control> <control> <condition> d) otherwise, </condition> the AMF may <action> include the PDU session reactivation result error cause IE to indicate the cause of failure to re-establish the user-plane resources. </action> </control> </control>
NOTE 1: It is up to UE implementation when to re-send a request for user-plane re-establishment for the associated PDU session after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to
#92 "insufficient user-plane resources for the PDU session".
NOTE 2: The UE can locally start a back-off timer after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to #69 "insufficient resources for specific slice". The value of the back-off timer is up to UE implementation. Upon expiry of the back-off timer, the UE can re-send a request for user- plane re-establishment for the associated PDU session.
<control> <condition> If the PDU session reactivation result IE is included in the SERVICE ACCEPT message indicating that the user-plane resources cannot be established for a PDU session that was requested by the UE in the Allowed PDU session status IE, </condition> the UE <action> considers the corresponding PDU session to be associated with the non-3GPP access. </action> </control>
<control> <condition> If the MUSIM UE does not include the Paging restriction IE in the SERVICE REQUEST message, </condition> the AMF shall <action> delete any stored paging restriction for the UE and stop restricting paging. </action> </control>
<control> <condition> <condition> For case m in subclause 5.6.1.1 </condition> <condition> when the MUSIM UE sets the Request type to "NAS signalling connection release" in the SERVICE REQUEST message, </condition> </condition> the AMF shall <action> initiate the release of the N1 NAS signalling connection after the completion of the service request procedure. </action> </control>
<control> <condition> <condition> For cases o and p in subclause 5.6.1.1 </condition> <condition> when the MUSIM UE sets the Request type to "NAS signalling connection release" or to "Rejection of paging" in the UE request type IE in the SERVICE REQUEST message </condition> and <condition> if the UE requests restriction of paging by including the Paging restriction IE, </condition> </condition> the AMF: <control> a) <condition> if accepts the paging restriction, </condition> shall <action> include the 5GS additional request result IE in the SERVICE ACCEPT message </action> and <action> set the Paging restriction decision to "paging restriction is accepted". </action> </control> <control> The AMF shall <action> store the paging restriction of the UE and enforce these restrictions in the paging procedure as described in clause 5.6.2; </action> </control> or <control> b) <condition> if rejects the paging restriction, </condition> shall <action> include the 5GS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to "paging restriction is rejected", </action> and shall <action> discard the received paging restriction. </action> </control> <control> The AMF shall <action> delete any stored paging restriction for the UE and stop restricting paging; </action> and the AMF shall <action> initiate the release of the N1 NAS signalling connection as follows: </action> <control> <condition> c) <condition> for case o in subclause 5.6.1.1, </condition> <condition> after the completion of the service request procedure; </condition> </condition> </control> <control> <condition> d) <condition> for case p in subclause 5.6.1.1, </condition> <condition> after the completion of the generic UE configuration update procedure that is triggered after the completion of the service request procedure. </condition> </condition> </control> </control> </control>
<control> <condition> If the SERVICE REQUEST message is for emergency services fallback, </condition> the AMF <action> triggers the emergency services fallback procedure as specified in subclause 4.13.4.2 of 3GPP TS 23.502 . </action> </control>
<control> <condition> If the UE having an emergency PDU session sent the SERVICE REQUEST message </condition> via: </control>
<control> <condition> a) a CAG cell and none of the CAG-IDs of the CAG cell are included in the "Allowed CAG list" for the current PLMN in the UE's subscription; </condition> </control> or
<control> <condition> b) a non-CAG cell in a PLMN for which the UE's subscription contains an "indication that the UE is only allowed to access 5GS via CAG cells"; </condition> the network shall <action> accept the SERVICE REQUEST message and release all non-emergency PDU sessions locally. </action> The emergency PDU session shall <action> not be released. </action> </control>
<control> <condition> <condition> If the AMF received the list of TAIs from the satellite NG-RAN as described in 3GPP TS 23.501 , </condition> and <condition> determines that any but not all TAIs in the received list of TAIs is forbidden for roaming or for regional provision of service as per information from the UDM and operator's choice, </condition> </condition> the AMF shall <action> include the TAI(s) in: </action> </control>
<control> <action> a) the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for roaming" IE; </action> or </control>
<control> b) <action> the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for regional provision of service" IE; </action> or </control>
<control> c) <action> both; in the SERVICE ACCEPT message. </action> </control>
NOTE 9: "5GS forbidden tracking areas for roaming" corresponds to cause values #13 and #15, and "5GS forbidden tracking areas for regional provision of service" corresponds cause value #12.
<control> <condition> <condition> If the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for roaming" IE in the SERVICE ACCEPT message </condition> and <condition> the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for roaming", </condition> </condition> the UE shall <action> store the TAI(s) included in the IE into the list of "5GS forbidden tracking areas for roaming" and remove the TAI(s) from the stored TAI list if present. </action> </control>
<control> <condition> If the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for regional provision of service" IE in the SERVICE ACCEPT message and the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for regional provision of service", </condition> the UE shall <action> store the TAI(s) included in the IE into the list of "5GS forbidden tracking areas for regional provision of service" </action> and <action> remove the TAI(s) from the stored TAI list if present. </action> </control>
5.6.1.4.2 UE is using 5GS services with control plane CIoT 5GS optimization
<control> <condition> For case a in subclause 5.6.1.1, <condition> upon receipt of the CONTROL PLANE SERVICE REQUEST message <condition> with Control plane service type indicating "mobile terminating request", </condition> </condition> <condition> after completion of the 5GMM common procedures (if initiated) </condition> </condition> <action> according to subclause 5.6.1.3, the AMF shall send a SERVICE ACCEPT message. </action> </control>
<control> <condition> For cases c, d and m in subclause 5.6.1.1, <condition> upon receipt of the CONTROL PLANE SERVICE REQUEST message <condition> with Control plane service type indicating "mobile originating request", </condition> </condition> <condition> after completion of the 5GMM common procedures <condition> (if initiated) </condition> </condition> </condition> <action> according to subclause 5.6.1.3, the AMF shall send a SERVICE ACCEPT message, </action> <condition> <condition> except for case d when the DDX field of the Release assistance indication IE </condition> or <condition> the DDX field of the CIoT small data container IE indicates "No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected". </condition> </condition> </control>
<control> <condition> For case a, c and d: </condition> </control>
<control> a) <control> <condition> if the CIoT small data container IE is included in the message, </condition> <action> the AMF shall decipher the value part of the CIoT small data container IE </action> </control> and: </control>
1) <control> <condition> if the Data type field indicates "control plane user data", </condition> <action> extract the PDU session ID and data content from the CIoT small data container IE, </action> <action> look up a PDU session routing context for the UE and the PDU session ID, </action> and <action> forward the content of the CIoT small data container IE to the SMF associated with the UE; </action> </control>
2) <control> <condition> if the Data type field indicates "SMS", </condition> <action > </action> forward the content of the CIoT small data container IE to the SMSF associated with the UE; </control> or
3) <control> <condition> if the Data type field indicates "Location services message container", </condition> and if </control>
<control> <condition> i) length of additional information field <condition> in the CIoT small data container IE </condition> is zero, </condition> <action> forward the value of Data type field and the content of the CIoT small data container IE to the to the location services application; </action> </control> or
<control> ii) <condition> otherwise </condition> <action> forward the value of Data type field and the content of the CIoT small data container IE to the LMF associated with the routing information </action> <condition> that is included in the additional information field of the CIoT small data container IE; </condition> </control> or NOTE 1: <control> <condition> If the AMF determines there is no pending data or signalling for the UE, </condition> <action> the AMF provides an indication of control plane CIoT 5GS Optimisation to the LMF as specified in 3GPP TS 29.518 . </action> </control>
<control> <condition> b) otherwise, </condition> <action> the AMF shall decipher the value part of NAS message container IE </action> and: </control>
1) <control> <condition> <condition> if the Payload container IE is included in the CONTROL PLANE SERVICE REQUEST message </condition> and if the </condition> </control>
<control> <condition> Payload container type IE is set to "CIoT user data container", </condition> <action> the AMF shall look up a PDU session routing context for the UE and the PDU session ID, </action> and <action> forward the content of the Payload container IE to the SMF associated with the UE; </action> </control>
2) <control> <condition> <condition> if the Payload container IE is included in the CONTROL PLANE SERVICE REQUEST message </condition> and <condition> if the Payload container type IE is set to "SMS", </condition> </condition> <action> the AMF shall forward the content of the Payload container IE to the SMSF associated with the UE; </action> </control>
3) <control> <condition> <condition> if the PDU session status IE is included in the CONTROL PLANE SERVICE REQUEST message </condition> or <condition> the AMF needs to perform a PDU session status synchronization, </condition> </condition> <action> the AMF shall include a PDU session status IE in the SERVICE ACCEPT message </action> <condition> to indicate which PDU sessions <condition> associated with the access type the SERVICE ACCEPT message is sent over </condition> are active in the AMF; </condition> </control>
4) <control> <condition> if the Uplink data status IE is included in the CONTROL PLANE SERVICE REQUEST message </condition> and the UE is: </control>
<control> <condition> i) not in NB-N1 mode; </condition> or </control>
<control> ii) <condition> <condition> in NB-N1 mode </condition> and <condition> the UE does not indicate a request to have user-plane resources established for a number of PDU sessions <condition> that exceeds the UE's maximum number of supported user-plane resources; </condition> </condition> </condition> </control>
the AMF shall:
<control> i) <action> indicate the SMF to re-establish the user-plane resources for the corresponding PDU sessions; </action> and </control>
<control> ii) <action> include the PDU session reactivation result IE in the SERVICE ACCEPT message </action> <condition> to indicate the user- plane resources re-establishment result of the PDU sessions <condition> for which the UE requested to re-establish the user-plane resources; </condition> </condition> </control>
5) <control> <condition> <condition> if the Uplink data status IE is included in the CONTROL PLANE SERVICE REQUEST, </condition> <condition> the UE is in NB-N1 mode, </condition> and <condition> the UE indicates a request to have user-plane resources established for a number of PDU sessions <condition> that exceeds the UE's maximum number of supported user-plane resources, </condition> </condition> </condition> <action> the AMF shall not indicate to the SMF to re-establish the user-plane resources for the corresponding PDU sessions; </action> </control> or
6) <control> <condition> otherwise, <condition> if the Payload container IE is included in the message </condition> and <condition> if the Payload container type IE is set to "Location services message container", </condition> </condition> <action> the AMF shall forward the Payload container type and the content of the Payload container IE to the LMF associated with the routing information included in the Additional information IE of the CONTROL PLANE SERVICE REQUEST message. </action> </control>
NOTE 2: <control> <condition> If the AMF determines there is no pending data or signalling for the UE, </condition> <action> the AMF provides an indication of control plane CIoT 5GS Optimisation to the LMF as specified in 3GPP TS 29.518 . </action> </control>
<control> <condition> For case k) in subclause 5.6.1.1, if the Uplink data status IE is included in the CONTROL PLANE SERVICE REQUEST message </condition> and the UE is: </control>
<control> <condition> a) not in NB-N1 mode; </condition> or </control>
<control> <condition> b) <condition> in NB-N1 mode </condition> and <condition> the UE does not indicate a request to have user-plane resources established for a number of PDU sessions <condition> that exceeds the UE's maximum number of supported user-plane resources, </condition> </condition> </condition> the AMF shall: </control>
<control> a) <action> indicate the SMF to re-establish the user-plane resources for the corresponding PDU sessions; </action> and </control>
<control> b) <action> include the PDU session reactivation result IE in the SERVICE ACCEPT message </action> <condition> to indicate the user-plane resources re-establishment result of the PDU sessions <condition> for which the UE requested to re-establish the user-plane </condition> </condition> </control>
<control> <condition> If the Allowed PDU session status IE is included in the CONTROL PLANE SERVICE REQUEST message, </condition> the AMF shall: </control>
<control> <condition> a) for a 5GSM message from each SMF <condition> that has indicated pending downlink signalling only, </condition> </condition> <action> forward the received 5GSM message via 3GPP access to the UE </action> <condition> after the SERVICE ACCEPT message is sent; </condition> </control>
<control> <condition> b) for each SMF that has indicated pending downlink data only: </condition> </control>
<control> 1) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed </action> <condition> if the corresponding PDU session ID(s) are not indicated <condition> in the Allowed PDU session status IE; </condition> </condition> and </control>
<control> 2) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed </action> if: </control>
<control> <condition> i) <condition> for a UE not in NB-N1 mode, </condition> the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; </condition> or </control>
<control> ii) <condition> <condition> for a UE in NB-N1 mode, </condition> <condition> the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE </condition> and <condition> the resulting number of PDU sessions with established user-plane resources does not exceed the UE's maximum number of supported user-plane resources; </condition> </condition> </control>
<control> <condition> c) for each SMF that have indicated pending downlink signalling and data: </condition> </control>
<control> 1) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed </action> <condition> if the corresponding PDU session ID(s) are not indicated <condition> in the Allowed PDU session status IE; </condition> </condition> </control>
<control> 2) <action> notify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed </action> if: </control>
<control> <condition> i) <condition> for a UE not in NB-N1 mode, </condition> the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; </condition> or </control>
<control> ii) <condition> <condition> for a UE in NB-N1 mode, </condition> <condition> the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE </condition> and <condition> the resulting number of PDU sessions with established user-plane resources does not exceed the UE's maximum number of supported user-plane resources; </condition> </condition> and </control>
<control> 3) <action> discard the received 5GSM message for PDU session(s) associated with non-3GPP access; </action> </control> and
<control> d) <action> include the PDU session reactivation result IE in the SERVICE ACCEPT message </action> <condition> to indicate the successfully re-established user-plane resources for the corresponding PDU sessions, </condition> <condition> if any. </condition> </control>
<control> <condition> If the DDX field in the CIoT small data container IE or the DDX field of the Release assistance indication IE indicates: </condition> </control>
<control> 1) <condition> <condition> "No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected" </condition> and <condition> if there is no downlink signalling or downlink data for the UE; </condition> </condition> or </control>
<control> 2) <condition> <condition> "Only a single downlink data transmission and no further uplink data transmission subsequent to the uplink data transmission is expected" </condition> and <condition> upon subsequent delivery of the next received downlink data transmission to the UE </condition> and <condition> if there is no additional downlink signalling or downlink data for the UE, </condition> </condition> <action> the AMF initiates the release of the N1 NAS signalling connection (see 3GPP TS 23.502 ). </action> </control>
<control> <condition> If the MUSIM UE does not include the Paging restriction IE <condition> in the CONTROL PLANE SERVICE REQUEST message, </condition> </condition> <action> the AMF shall delete any stored paging restriction for the UE and stop restricting paging. </action> </control>
<control> <condition> For case m in subclause 5.6.1.1 <condition> when the MUSIM UE sets the Request type to "NAS signalling connection release" <condition> in the CONTROL PLANE SERVICE REQUEST message, </condition> </condition> </condition> <action> the AMF shall initiate the release of the N1 NAS signalling connection </action> <condition> after the completion of the service request procedure. </condition> </control>
<control> <condition> For cases o and p in subclause 5.6.1.1 <condition> <condition> when the MUSIM UE sets the Request type to "NAS signalling connection release" or to "Rejection of paging" <condition> in the UE request type IE </condition> <condition> in the CONTROL PLANE SERVICE REQUEST message </condition> </condition> </condition> and <condition> if the UE requests restriction of paging by including the Paging restriction IE, </condition> </condition> the AMF: <control> <condition> a) if accepts the paging restriction, </condition> <action> shall include the 5GS additional request result IE in the SERVICE ACCEPT message </action> and <action> set the Paging restriction decision to "paging restriction is accepted". </action> <action> The AMF shall store the paging restriction of the UE </action> and <action> enforce these restrictions in the paging procedure as described in clause 5.6.2; </action> </control> or <control> <condition> b) if rejects the paging restriction, </condition> <action> shall include the 5GS additional request result IE in the SERVICE ACCEPT message </action> and <action> set the Paging restriction decision to "paging restriction is rejected", </action> and <action> shall discard the received paging restriction. </action> <action> The AMF shall delete any stored paging restriction for the UE </action> and <action> stop restricting paging; </action> and <action> the AMF shall send the SERVICE ACCEPT message </action> </control> and <control> <action> initiate the release of the N1 NAS signalling connection as follows: </action> <condition> c) <condition> for case o in subclause 5.6.1.1, <condition> after the completion of the service request procedure; </condition> </condition> d) <condition> for case p in subclause 5.6.1.1, <condition> after the completion of the generic UE configuration update procedure <condition> that is triggered after the completion of the service request procedure. </condition> </condition> </condition> </condition> </control> </control>
<control> <condition> Upon successful completion of the procedure, </condition> <action> the UE shall reset the service request attempt counter, </action> <action> stop the timer T3517 </action> and <end_state> enter the state 5GMM-REGISTERED. </end_state> </control>
<control> <condition> If the PDU session status information element is included in the CONTROL PLANE SERVICE REQUEST message, </condition> then the AMF: </control>
<control> a) <action> shall perform a local release of all those PDU sessions </action> <condition> which are not in 5GSM state PDU SESSION INACTIVE on the AMF side <condition> associated with the access type the CONTROL PLANE SERVICE REQUEST message is sent over, </condition> </condition> <condition> but are indicated by the UE as being inactive, </condition> and </control>
<control> b) <action> request the SMF to perform a local release of all those PDU sessions. </action> <condition> If any of those PDU sessions is associated with one or more MBS sessions, </condition> <action> the SMF shall consider the UE as removed from the associated MBS sessions. </action> </control>
<control> <condition> If the PDU session status information element is included in the SERVICE ACCEPT message, </condition> <action> then the UE shall perform a local release of all those PDU sessions </action> <condition> which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING on the UE side associated with the 3GPP access </condition> <condition> but are indicated by the AMF as being inactive. </condition> </control> <control> <condition> If a locally released PDU session is associated with one or more MBS sessions, </condition> <action> the UE shall locally leave the associated MBS sessions. </action> </control>
<control> <condition> If the user-plane resources cannot be established for a PDU session, </condition> <action> the AMF shall include the PDU session reactivation result IE in the SERVICE ACCEPT message </action> <condition> indicating that user-plane resources for the corresponding PDU session cannot be re-established, </condition> and: </control>
<control> <condition> a) if the user-plane resources cannot be established <condition> because the SMF indicated to the AMF that the UE is located out of the LADN service area (see 3GPP TS 29.502 ), </condition> </condition> <action> the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #43 "LADN not available"; </action> </control>
<control> <condition> b) if the user-plane resources cannot be established <condition> because the SMF indicated to the AMF that only prioritized services are allowed (see 3GPP TS 29.502 ), </condition> </condition> <action> the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #28 "restricted service area"; </action> </control> or
<control> <condition> c) if the user-plane resources cannot be established because: </condition> </control>
<control> 1) <condition> the SMF indicated to the AMF that the resource is not available in the UPF (see 3GPP TS 29.502 ); </condition> or </control>
<control> 2) <condition> <condition> the UE is in NB-N1 mode </condition> and <condition> the result will lead to user-plane resources established for more than two PDU sessions (see 3GPP TS 23.502 ) </condition> </condition> </control>
<control> <action> the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #92"insufficient user-plane resources for the PDU session" </action> </control>
NOTE 3: <control> <condition> For a UE that is not in NB-N1 mode, </condition> it is up to UE implementation when to re-send a request for user- plane re-establishment for the associated PDU session <condition> after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to #92 "insufficient user-plane resources for the PDU session". </condition> </control>
<control> <condition> If the PDU session reactivation result IE is included in the SERVICE ACCEPT message <condition> indicating that the user-plane resources cannot be established for a PDU session <condition> that was requested by the UE in the Allowed PDU session status IE, </condition> </condition> </condition> <action> the UE considers the corresponding PDU session to be associated with the non-3GPP access. </action> </control>
<control> <condition> For case d) in subclause 5.6.1.1, </condition> <action> the UE shall also treat the indication from the lower layers that the RRC connection has been released as successful completion of the procedure. </action> <action> The UE shall reset the service request attempt counter, </action> <action> stop the timer T3517 </action> and <end_state> enter the state 5GMM-REGISTERED. </end_state> </control>
<control> <condition> Upon receipt of the CONTROL PLANE SERVICE REQUEST message with uplink data: </condition> <control> <condition> <condition> a) if the DDX field of the Release assistance indication IE or the DDX field of the CIoT small data container IE is set to "No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected" in the message; </condition> b) <condition> if the AMF decides to forward the uplink data piggybacked <condition> in the CONTROL PLANE SERVICE REQUEST message; </condition> </condition> and c) <condition> if the AMF decides to activate the congestion control for transport of user data via the control plane, </condition> </condition> <action> then the AMF shall send SERVICE ACCEPT message with the T3448 value IE included. </action> </control> </control>
<control> <condition> If the AMF decides to deactivate the congestion control for transport of user data via the control plane, </condition> <action> then the AMF shall delete the stored control plane data back-off time for the UE </action> and <action> the AMF shall not include timer T3448 value IE in the SERVICE ACCEPT message. </action> </control>
<control> <condition> <condition> If the T3448 value IE is present in the received SERVICE ACCEPT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> the UE shall: </control>
<control> a) <action> stop timer T3448 </action> <condition> if it is running; </condition> </control>
<control> b) <action> consider the transport of user data via the control plane as successful; </action> and </control>
<control> c) <action> start timer T3448 with the value provided in the T3448 value IE. </action> </control>
<control> <condition> <condition> If the UE is using 5GS services <condition> with control plane CIoT 5GS optimization, </condition> </condition> <condition> the T3448 value IE is present in the SERVICE ACCEPT message </condition> and <condition> the value indicates that this timer is either zero or deactivated, </condition> </condition> <action> the UE shall ignore the T3448 value IE </action> and <action> proceed as if the T3448 value IE was not present. </action> </control>
<control> <condition> <condition> If the UE in 5GMM-IDLE mode initiated the service request procedure by sending a CONTROL PLANE SERVICE REQUEST message </condition> and <condition> the SERVICE ACCEPT message does not include the T3448 value IE </condition> and <condition> if timer T3448 is running, </condition> </condition> <action> then the UE shall stop timer T3448. </action> </control>
<control> <condition> For case h) in subclause 5.6.1.1, </condition> </control>
<control> a) <action> the UE shall treat the indication from the lower layers </action> <condition> when the UE has changed to S1 mode as successful completion of the procedure </condition> and <action> stop timer T3517; </action> </control>
<control> <condition> b) if a UE <condition> operating in single-registration mode </condition> has changed to S1 mode, </condition> <action> it shall disable the N1 mode capability for 3GPP access (see subclause 4.9.2); </action> </control> and
<control> c) <action> the AMF shall not check for CAG restrictions. </action> </control>
<control> <condition> If the CONTROL PLANE SERVICE REQUEST message is for emergency services fallback, </condition> <action> the AMF triggers the emergency services fallback procedure as specified in subclause 4.13.4.2 of 3GPP TS 23.502 . </action> </control>
5.6.1.5 Service request procedure not accepted by the network
<control> <condition> If the service request cannot be accepted, </condition> <action> the network shall return a SERVICE REJECT message to the UE including an appropriate 5GMM cause value. </action> </control>
<control> <condition> If the SERVICE REJECT message <condition> with 5GMM cause #76 or #78 </condition> was received <condition> without integrity protection, </condition> </condition> <action> then the UE shall discard the message. </action> </control>
<control> <condition> <condition> If the AMF needs to initiate PDU session status synchronisation </condition> or <condition> a PDU session status IE was included in the SERVICE REQUEST message, </condition> </condition> <action> the AMF shall include a PDU session status IE in the SERVICE REJECT message </action> <condition> to indicate which PDU sessions <condition> associated with the access type the SERVICE REJECT message is sent over </condition> are active in the AMF. </condition> </control> <control> <condition> <condition> If the PDU session status IE is included in the SERVICE REJECT message </condition> and <condition> if the message is integrity protected, </condition> </condition> then: </control>
<control> <condition> a) for single access PDU sessions, </condition> <action> the UE shall perform a local release of all those PDU sessions </action> <start_state> which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING on the UE side </start_state> <condition> associated with the access type the SERVICE REJECT message is sent over, </condition> <start_state> but are indicated by the AMF as being in 5GSM state PDU SESSION INACTIVE; </start_state> </control> and
<control> <condition> b) for MA PDU sessions, for all those PDU sessions <start_state> which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING </start_state> and <condition> have user plane resources established on the UE side <condition> associated with the access the SERVICE REJECT message is sent over, </condition> </condition> <condition> but are indicated by the AMF as no user plane resources established: </condition> </condition> </control>
1) <control> for MA PDU sessions having user plane resources established <condition> only on the access type the SERVICE REJECT message is sent over, </condition> </control> <control> <action> the UE shall perform a local release of those MA PDU sessions; </action> </control> and
2) <control> <condition> for MA PDU sessions having user plane resources established on both accesses, </condition> <action> the UE shall perform a local release on the user plane resources </action> <condition> on the access type the SERVICE REJECT message is sent over. </condition> </control>
<control> <condition> If the service request for mobile originated services is rejected <condition> due to general NAS level mobility management congestion control, </condition> </condition> <action> the network shall set the 5GMM cause value to #22 "congestion" </action> and <action> assign a value for back-off timer T3346. </action> </control>
<control> <condition> In NB-N1 mode, <condition> if the service request for mobile originated services is rejected <condition> due to operator determined barring (see 3GPP TS 29.503 ), </condition> </condition> </condition> <action> the network shall set the 5GMM cause value to #22 "congestion" </action> and <action> assign a value for back-off timer T3346. </action> </control>
<control> <condition> If the service request from a UE supporting CAG is rejected <condition> due to CAG restrictions, </condition> </condition> <action> the network shall set the 5GMM cause value to #76 "Not authorized for this CAG or authorized for CAG cells only" </action> and <action > should include the "CAG information list" in the CAG information list IE or the Extended CAG information list IE in the SERVICE REJECT message </action> </control>
NOTE 1: The network cannot be certain that "CAG information list" stored in the UE is updated as result of sending of the SERVICE REJECT message with the CAG information list IE or the Extended CAG information list IE, as the SERVICE REJECT message is not necessarily delivered to the UE (e.g., due to abnormal radio conditions).
NOTE 2: <control> The "CAG information list" can be provided by the AMF and include no entry <condition> if no "CAG information list" exists in the subscription. </condition> </control>
NOTE 2A: <control> <condition> If the UE supports extended CAG information list, </condition> the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE. </control>
<control> <condition> If the UE does not support extended CAG information list, </condition> <action> the CAG information list shall not be included in the Extended CAG information list IE. </action> </control>
<control> <condition> If the service request from a UE not supporting CAG is rejected <condition> due to CAG restrictions, </condition> </condition> <action> the network shall operate as described in bullet h) of subclause 5.6.1.8. </action> </control>
<control> <condition> Upon receipt of the CONTROL PLANE SERVICE REQUEST message with uplink data: </condition> <condition> <condition> a) if the AMF decides to not forward the uplink data piggybacked <condition> in the CONTROL PLANE SERVICE REQUEST message; </condition> </condition> and b) <condition> if the AMF decides to activate the congestion control for transport of user data via the control plane, </condition> </condition> then <action> the AMF shall send a SERVICE REJECT message </action> and <action> set the 5GMM cause value to #22 "congestion" </action> and <action> assign a value for control plane data back-off timer T3448. </action> </control>
<control> <condition> If the AMF determines that the UE is in a non-allowed area or is not in an allowed area as specified in subclause 5.3.5, </condition> then: </control>
<control> <condition> a) if the service type IE in the SERVICE REQUEST message is set to "signalling" or "data", </condition> <action> the AMF shall send a SERVICE REJECT message with the 5GMM cause value set to #28 "Restricted service area"; </action> </control>
<control> <condition> b) otherwise, <condition> if the service type IE in the SERVICE REQUEST message is set to "mobile terminated services", "emergency services", "emergency services fallback", "high priority access" or "elevated signalling", </condition> </condition> <action> the AMF shall continue the process as specified in subclause 5.6.1.4 </action> <condition> unless for other reasons the service request cannot be accepted. </condition> </control>
<control> <condition> If the service request for mobile originated services is rejected <condition> due to service gap control as specified in subclause 5.3.17, i.e. the T3447 timer is running in AMF, </condition> </condition> <action> the network shall set the 5GMM cause value to #22 "Congestion" </action> and <action> may include T3346 value IE in the SERVICE REJECT message set to the remaining time of the running T3447 timer. </action> </control>
<control> <condition> Based on operator policy, <condition> if the service request procedure is rejected <condition> due to core network redirection for CIoT optimizations, </condition> </condition> </condition> <action> the network shall set the 5GMM cause value to #31 "Redirection to EPC required". </action> </control>
NOTE 3: The network can take into account the UE's S1 mode capability, the EPS CIoT network behaviour supported by the UE or the EPS CIoT network behaviour supported by the EPC to determine the rejection with the 5GMM cause value #31 "Redirection to EPC required".
<control> <condition> <condition> If the service request is via a satellite NG-RAN cell, </condition> and <condition> the network determines that the UE is in a location <condition> where the network is not allowed to operate, see 3GPP TS 23.502 , </condition> </condition> </condition> <action> the network shall set the 5GMM cause value in the SERVICE REJECT message to #78 "PLMN not allowed to operate at the present UE location". </action> </control>
<control> <condition> If the service request from a UE supporting MINT is rejected <condition> due to a disaster condition no longer being applicable in the current location of the UE, </condition> </condition> <action> the network shall set the 5GMM cause value to #11 "PLMN not allowed" or #13 "Roaming not allowed in this tracking area" </action> and <action> may include a disaster return wait range in the Disaster return wait range IE in the SERVICE REJECT message. </action> </control>
<control> <condition> On receipt of the SERVICE REJECT message, <start_state> if the UE is in state 5GMM-SERVICE-REQUEST-INITIATED, </start_state> </condition> <action> the UE shall reset the service request attempt counter and stop timer T3517 </action> <condition> if running. </condition> </control>
<control> Regardless of the 5GMM cause value received in the SERVICE REJECT message, <control> <condition> a) <condition> if the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for roaming" IE in the SERVICE REJECT message </condition> and <condition> if the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for roaming", </condition> </condition> <action> the UE shall store the TAI(s) included in the IE, <condition> if not already stored, </condition> into the list of "5GS forbidden tracking areas for roaming" </action> and <action> remove the TAI(s) from the stored TAI list </action> <condition> if present; </condition> </control> and <control> <condition> b) <condition> if the UE receives the Forbidden TAI(s) for the list of "5GS forbidden tracking areas for regional provision of service" IE in the SERVICE REJECT message </condition> and <condition> if the TAI(s) included in the IE is not part of the list of "5GS forbidden tracking areas for regional provision of service", </condition> </condition> <action> the UE shall store the TAI(s) included in the IE, <condition> if not already stored, </condition> into the list of "5GS forbidden tracking areas for regional provision of service" </action> and <action> remove the TAI(s) from the stored TAI list </action> <condition> if present. </condition> </control> </control>
<control> Furthermore, the UE shall take the following actions depending on the 5GMM cause value received in the SERVICE REJECT message. </control>
<control> <condition> #3 (Illegal UE); #6 (Illegal ME); </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> In case of PLMN, </condition> <action> the UE shall consider the USIM as invalid for 5GS services </action> <condition> <condition> until switching off, </condition> <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in clause 5.3.19a.1; </condition> </condition> </control>
<control> <condition> In case of SNPN, <condition> <condition> if the UE is not registered for onboarding services in SNPN </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid </action> <condition> <condition> until the UE is switched off, </condition> <condition> the entry is updated </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.2. </condition> </control> <control> <condition> In case of SNPN, <condition> <condition> if the UE is not registered for onboarding services in SNPN </condition> and <condition> the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid for 3GPP access </action> <condition> <condition> until the UE is switched off, </condition> <condition> the entry is updated </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.2. </condition> </control>
<control> Additionally, <condition> if EAP based primary authentication and key agreement procedure using EAP-AKA' or 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, </condition> <action> the UE shall consider the USIM as invalid for the current SNPN </action> <condition> <condition> until switching off, </condition> <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in clause 5.3.19a.2. </condition> </condition> </control>
<control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> <action> the UE shall delete the list of equivalent PLMNs </action> <condition> (if any) </condition> and <end_state> shall enter the state 5GMM-DEREGISTERED.NO-SUPI. </end_state> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> then the UE shall: </control>
<control> 1) <action> set the counter for "SIM/USIM considered invalid for GPRS services" events and the counter for "USIM considered invalid for 5GS services over non-3GPP access" events to UE implementation-specific maximum value </action> <condition> in case of PLMN </condition> <condition> if the UE maintains these counters; </condition> </control>
<control> 2) <action> set the counter for "the entry for the current SNPN considered invalid for 3GPP access" events and the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events to UE implementation-specific maximum value </action> <condition> in case of SNPN </condition> <condition> if the UE maintains these counters; </condition> and </control>
<control> 3) <action> delete the 5GMM parameters stored in non-volatile memory of the ME as specified in annex C. </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in the single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the service request procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> <action> The USIM shall be considered as invalid also for non-EPS services </action> <condition> <condition> until switching off, </condition> <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.7a in 3GPP TS 24.301 . </condition> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control>
<control> <condition> If the UE is registered for onboarding services in SNPN, </condition> <action> the UE shall store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN- SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter to the UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
<control> <condition> #7 (5GS services not allowed). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and <action> shall store it according to subclause 5.1.3.2.2 </action> ) and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> In case of PLMN, </condition> <action> the UE shall consider the USIM as invalid for 5GS services </action> <condition> <condition> > until switching off, </condition> <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in clause 5.3.19a.1; </condition> </condition> </control>
<control> <condition> In case of SNPN, <condition> <condition> if the UE is not registered for onboarding services in SNPN </condition> and <condition> the UE does not support access to an SNPN using credentials from a credentials holder, </condition> </condition> </condition> <action> the UE shall consider the entry of the "list of subscriber data" with the SNPN identity of the current SNPN as invalid for 5GS services </action> <condition> <condition> until the UE is switched off, </condition> <condition> the entry is updated </condition> or <condition> the timer T3245 expires as described in clause 5.3.19a.2. </condition> </condition> </control> <control> <condition> In case of SNPN, <condition> <condition> if the UE is not registered for onboarding services in SNPN </condition> and <condition> the UE supports access to an SNPN using credentials from a credentials holder, </condition> </condition> <action> the UE shall consider the selected entry of the "list of subscriber data" as invalid for 3GPP access </action> <condition> <condition> until the UE is switched off, </condition> <condition> the entry is updated </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.2. </condition> </condition> </control> <control> <condition> Additionally, if EAP based primary authentication and key agreement procedure <condition> using EAP- AKA' or 5G AKA based primary authentication </condition> and key agreement procedure was performed in the current SNPN, </condition> <action> the UE shall consider the USIM as invalid for the current SNPN </action> <condition> <condition> until switching off, </condition> <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in clause 5.3.19a.2. </condition> </control>
<control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> <end_state> the UE shall enter the state 5GMM- DEREGISTERED.NO-SUPI. </end_state> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> then the UE shall: </control>
<control> 1) <action> set the counter for "SIM/USIM considered invalid for GPRS services" events and the counter for "USIM considered invalid for 5GS services over non-3GPP access" events to UE implementation-specific maximum value </action> <condition> in case of PLMN </condition> <condition> if the UE maintains these counters; </condition> or </control>
<control> 2) <action> set the counter for "the entry for the current SNPN considered invalid for 3GPP access" events and the counter for "the entry for the current SNPN considered invalid for non-3GPP access" events to UE implementation-specific maximum value </action> <condition> in case of SNPN </condition> <condition> if the UE maintains these counters; </condition> and </control>
<control> 3) <action> delete the 5GMM parameters stored in non-volatile memory of the ME as specified in annex C. </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the service request procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> If the UE is registered for onboarding services in SNPN, </condition> <action> the UE shall store the SNPN identity in the "permanently forbidden SNPNs" list for onboarding services, </action> <end_state> enter state 5GMM-DEREGISTERED.PLMN- SEARCH, </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter to the UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
NOTE 4: The possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is outside the scope of the present document.
<control> <condition> #9 (UE identity cannot be derived by the network). </condition> </control>
<action> The UE shall set the 5GS update status to 5U2 NOT UPDATED </action> (and <action> shall store it according to subclause 5.1.3.2.2 </action> ) and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <end_state> The UE shall enter the state 5GMM-DEREGISTERED. </end_state>
<control> <condition> If the service request was initiated for emergency services fallback, </condition> <action> the UE shall attempt to select an E-UTRA cell connected to EPC or 5GCN according to the domain priority and selection rules specified in 3GPP TS 23.167 . </action> <control> <condition> If the UE finds a suitable E-UTRA cell, </condition> <action> it then proceeds with the appropriate EMM or 5GMM procedures. </action> </control> <control> </control> <condition> If the UE <condition> operating in single-registration mode </condition> has changed to S1 mode, </condition> <action> it shall disable the N1 mode capability for 3GPP access. </action> </control>
<control> <condition> If the service request was initiated for any reason other than emergency services fallback or initiating an emergency PDU session, </condition> <action> the UE shall perform a new initial registration procedure. </action> </control>
NOTE 5: <control> User interaction is necessary in some cases <condition> when the UE cannot re-establish the PDU session(s) </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in the single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the service request procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> #10 (Implicitly de-registered). </condition> </control>
<control> <end_state> The UE shall enter the state 5GMM-DEREGISTERED.NORMAL-SERVICE. </end_state> <action> The UE shall delete any mapped 5G NAS security context or partial native 5G NAS security context. </action> </control>
<control> <condition> If the service request was initiated for emergency services fallback, </condition> <action> the UE shall attempt to select an E-UTRA cell connected to EPC or 5GCN according to the domain priority and selection rules specified in 3GPP TS 23.167 . </action> <control> <condition> If the UE finds a suitable E-UTRA cell, </condition> <action> it then proceeds with the appropriate EMM or 5GMM procedures. </action> </control> </control> <control> <condition> If the UE <condition> operating in single-registration mode </condition> has changed to S1 mode, </condition> <action> it shall disable the N1 mode capability for 3GPP access. </action> </control>
<control> <condition> If the rejected request was neither for initiating an emergency PDU session nor for emergency services fallback, </condition> <condition> the UE shall perform a new initial registration procedure. </condition> </control>
NOTE 6: <control> User interaction is necessary in some cases <condition> when the UE cannot re-establish the PDU session(s) </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in the single-registration mode, </condition> </condition> <action> the UE shall handle the EMM state as specified in 3GPP TS 24.301 </action> <condition> for the case when the service request procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> #11 (PLMN not allowed). </condition> </control>
This cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.7.
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and <action> shall store it according to subclause 5.1.3.2.2 </action> ) and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall delete the list of equivalent PLMNs </action> and <action> store the PLMN identity in the forbidden PLMN list as specified in subclause 5.3.13A </action> and <control> <condition> if the UE is configured to use timer T3245 </condition> then <action> the UE shall start timer T3245 and proceed as described in clause 5.3.19a.1. </action> </control> <control> <condition> For 3GPP access, </condition> <end_state> the UE shall enter the state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform a PLMN selection according to 3GPP TS 23.122 , </action> </control> and <control> <condition> for non-3GPP access </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE </end_state> and <action> perform network selection as defined in 3GPP TS 24.502 . </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE mantains the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN, </condition> </condition> <action> the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN to the UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the service request procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access to the same PLMN, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
<control> <condition> <condition> If the UE receives the Disaster return wait range IE in the SERVICE REJECT message </condition> and <condition> the UE supports MINT, </condition> </condition> <action> the UE shall delete the disaster return wait range stored in the ME, </action> <condition> if any, </condition> and <action> store the disaster return wait range included in the Disaster return wait range IE in the ME. </action> </control>
<control> <condition> #12 (Tracking area not allowed). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and <action> shall store it according to subclause 5.1.3.2.2 </action> ) and <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
If 1) <control> <condition> the UE is not operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for regional provision of service" </action> and <end_state> enter the state 5GMM- DEREGISTERED.LIMITED-SERVICE. </end_state> </control> <control> <condition> If the SERVICE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message; </action> </control> or
2) <control> <condition> the UE is operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for regional provision of service" for the current SNPN </action> and, <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> and <end_state> enter the state 5GMM-DEREGISTERED.LIMITED- SERVICE. </end_state> </control> </control> <control> <condition> If the SERVICE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for regional provision of service" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, <condition> for non-integrity protected NAS reject message. </condition> </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the service request procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> #13 (Roaming not allowed in this tracking area). </condition> </control>
<control> <end_state> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED </end_state> (and <action> shall store it according to subclause 5.1.3.2.2 </action> ). <control> <condition> For 3GPP access </condition> <end_state> the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH, </end_state> </control> and <control> <condition> for non-3GPP access </condition> <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE. </end_state> </control> </control>
If 1) <control> <condition> the UE is not operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" </action> and <action> remove the current TAI from the stored TAI list if present. </action> </control> <control> <condition> If the SERVICE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for non-integrity protected NAS reject message; </action> </control> or
2) <control> <condition> the UE is operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> and <action> remove the current TAI from the stored TAI list </action> <condition> if present. </condition> </control> </control> <control> <condition> If the SERVICE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, <condition> for non-integrity protected NAS reject message. </condition> </condition> </control>
<control> <condition> For 3GPP access </condition> <action> the UE shall perform a PLMN selection or SNPN selection according to 3GPP TS 23.122 , </action> </control> and <control> <condition> for non-3GPP access </condition> <action> the UE shall perform network selection as defined in 3GPP TS 24.502 . </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP TS 24.301 </action> <condition> for the case when the service request procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> <condition> If the UE receives the Disaster return wait range IE in the SERVICE REJECT message </condition> and <condition> the UE supports MINT, </condition> </condition> <action> the UE shall delete the disaster return wait range stored in the ME, </action> <condition> if any, </condition> and <action> store the disaster return wait range included in the Disaster return wait range IE in the ME. </action> </control>
<control> <condition> #15 (No suitable cells in tracking area) </condition> </control>
<control> <end_state> The UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE. </end_state> </control>
If 1) <control> <condition> the UE is not operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" </action> and <action> remove the current TAI from the stored TAI list </action> <condition> if present </condition> . </control> <control> <condition> If the SERVICE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for non-integrity protected NAS reject message; </action> </control> or
2) <control> <condition> the UE is operating in SNPN access operation mode, </condition> <action> the UE shall store the current TAI in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <control> <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, </condition> and <action> remove the current TAI from the stored TAI list </action> <condition> if present. </condition> </control> </control> <control> <condition> If the SERVICE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "5GS forbidden tracking areas for roaming" for the current SNPN </action> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription, <condition> for non-integrity protected NAS reject message. </condition> </condition> </control>
<control> <condition> If the UE initiated service request for emergency services fallback, </condition> <action> the UE shall attempt to select an E-UTRA cell connected to EPC or 5GC according to the emergency services support indicator (see 3GPP TS 36.331 ). </action> <control> <condition> If the UE finds a suitable E-UTRA cell, </condition> <action> it then proceeds with the appropriate EMM or 5GMM procedures. </action> </control> </control> <control> <condition> If the UE <condition> operating in single-registration mode </condition> has changed to S1 mode, </condition> <action> it shall disable the N1 mode capability for 3GPP access. </action> </control>
<control> <condition> If the service request was not initiated for emergency services fallback, </condition> <action> the UE shall search for a suitable cell in another tracking area according to 3GPP TS 38.304 or 3GPP TS 36.304 . </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in the single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP TS 24.301 </action> <condition> for the case when the service request procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> If received over non-3GPP access </condition> <action> the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.6.1.7. </action> </control>
<control> <condition> #22 (Congestion). </condition> </control>
<control> <condition> <condition> If the T3346 value IE is present in the SERVICE REJECT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> <action> the UE shall proceed as described below, </action> </control> <control> <condition> otherwise </condition> <action> it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.6.1.7. </action> </control>
<control> <condition> If the rejected request was not for initiating an emergency PDU session, </condition> <action> the UE shall abort the service request procedure </action> and <end_state> enter state 5GMM-REGISTERED </end_state> and <action> stop timer T3517 </action> <condition> if still running. </condition> </control>
<control> <action> The UE shall stop timer T3346 </action> <condition> if it is running. </condition> </control>
<control> <condition> If the SERVICE REJECT message is integrity protected, </condition> <action> the UE shall start timer T3346 with the value provided in the T3346 value IE. </action> </control>
<control> <condition> If the SERVICE REJECT message is not integrity protected, </condition> <action> the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 . </action> </control>
<control> <condition> <condition> For all other cases the UE stays in the current serving cell </condition> and <condition> applies normal cell reselection process. </condition> </condition> <action> The service request procedure is started, </action> <condition> if still necessary, </condition> <condition> when timer T3346 expires or is stopped. </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in the single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP TS 24.301 </action> <condition> for the case when the service request procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> <condition> If the service request procedure was initiated for an MO MMTEL voice call (i.e. access category 4), </condition> or <condition> for an MO MMTEL video call (i.e. access category 5) </condition> or <condition> for an MO IMS registration related signalling (i.e. access category 9), </condition> </condition> <action> a notification that the service request was not accepted due to congestion shall be provided to the upper layers. </action> </control>
<control> <condition> <condition> If the UE is using 5GS services with control plane CIoT 5GS optimization </condition> and <condition> if the T3448 value IE is present in the SERVICE REJECT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> the UE shall: </control>
<control> a) <action> stop timer T3448 </action> <condition> if it is running; </condition> </control>
<control> <condition> b) consider the transport of user data via the control plane as unsuccessful; </condition> and </control>
<control> c) <action> start timer T3448: </action> </control>
<control> 1) <condition> with the value provided in the T3448 value IE <condition> if the SERVICE REJECT message is integrity protected; </condition> </condition> or </control>
<control> 2) <condition> with a random value from the default range specified in 3GPP TS 24.301 table 10.2.1 <condition> if the SERVICE REJECT message is not integrity protected. </condition> </condition> </control>
<control> <condition> <condition> If the UE is using 5GS services with control plane CIoT 5GS optimization, </condition> <condition> the T3448 value IE is present in the SERVICE REJECT message </condition> and <condition> the value indicates that this timer is either zero or deactivated, </condition> </condition> <action> the UE shall ignore the T3448 value IE </action> and: </control>
<control> a) <action> stop timer T3448 if it is running; </action> and </control>
<control> b) <action> consider the transport of user data via the control plane as unsuccessful. </action> </control>
<control> <condition> <condition> If the UE is using 5GS services with control plane CIoT 5GS optimization </condition> and <condition> if the T3448 value IE is not present in the SERVICE REJECT message, </condition> </condition> <action> it shall be considered as an abnormal case and the behaviour of UE for this case is specified in subclause 5.6.1.7. </action> </control>
<control> <condition> #27 (N1 mode not allowed). </condition> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and <action> shall store it according to subclause 5.1.3.2.2 </action> ) and <end_state> shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE. </end_state> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> the UE shall set: </control> </control>
<control> <action> 1) the PLMN-specific N1 mode attempt counter for 3GPP access and the PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN in case of PLMN; or </action> </control>
<control> <action> 2) the SNPN-specific attempt counter for 3GPP access for the current SNPN and the SNPN-specific attempt counter for non-3GPP access for the current SNPN in case of SNPN to the UE implementation-specific maximum value. </action> </control>
<control> <action> The UE shall disable the N1 mode capability for the specific access type </action> <condition> for which the message was received (see subclause 4.9). </condition> </control>
<control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall disable the N1 mode capability also for the other access type (see subclause 4.9). </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED </action> and <end_state> enter the state EMM- REGISTERED. </end_state> </control>
<control> <condition> #28 (Restricted service area). </condition> </control>
<control> <end_state> The UE shall enter the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE, </end_state> <action> wait for the release of the N1 NAS signalling connection </action> and <action> perform the registration procedure for mobility and periodic registration update </action> <condition> <condition> if the service type IE <condition> in the SERVICE REQUEST message </condition> was not set to "elevated signalling" </condition> and <condition> the SERVICE REJECT message is received over 3GPP access (see subclause 5.3.5 and 5.5.1.3). </condition> </condition> </control>
<control> <condition> If the service type IE <condition> in the SERVICE REQUEST message </condition> was set to "elevated signalling", </condition> <action> the UE shall not re- initiate service request procedure </action> <condition> until the UE enters an allowed area or leaves a non-allowed area, <condition> except for emergency services, high priority access or responding to paging or notification. </condition> </condition> </control>
<control> <condition> #31 (Redirection to EPC required). </condition> </control>
<control> 5GMM cause #31 <condition> <condition> received by a UE that has not indicated support for CIoT optimizations </condition> or <condition> received by a UE over non-3GPP access </condition> </condition> <action> is considered an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.7. </action> </control>
<control> This cause value <condition> received from a cell belonging to an SNPN </condition> <action> is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.7. </action> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and <action> shall store it according to subclause 5.1.3.2.2 </action> ). <action> The UE shall reset the service request attempt counter </action> and <end_state> enter the state 5GMM- REGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <action> The UE shall enable the E-UTRA capability </action> <condition> if it was disabled and disable the N1 mode capability for 3GPP access (see subclause 4.9.2). </condition> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters, EMM state, and EPS update status as specified in 3GPP TS 24.301 </action> <condition> for the case when the service request procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
<control> <condition> #72 (Non-3GPP access to 5GCN not allowed). </condition> </control>
<control> <condition> If the UE initiated the service request procedure over non-3GPP access, </condition> <action> the UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) </action> and <action> shall delete 5G- GUTI, last visited registered TAI, TAI list and ngKSI for non-3GPP access. </action> Additionally, <end_state> the UE shall enter the state 5GMM-DEREGISTERED for non-3GPP access. </end_state> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> the UE shall set: </control>
<control> 1) <action> the PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN </action> <condition> in case of PLMN; </condition> or </control>
<control> 2) <action> the SNPN-specific attempt counter for non-3GPP access for that SNPN </action> <condition> in case of SNPN; </condition> to the UE implementation-specific maximum value. </control>
NOTE 7: The 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses 4.7.2 and 5.1.3).
<control> <action> The UE shall disable the N1 mode capability for non-3GPP access (see subclause 4.9.3). </action> </control>
<control> As an implementation option, <condition> if the UE is not currently registered over 3GPP access, </condition> <end_state> the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> <condition> in order to perform a PLMN selection according to 3GPP TS 23.122 . </condition> </control>
<control> <condition> If received over 3GPP access </condition> <action> the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.6.1.7. </action> </control>
<control> <condition> #73 (Serving network not authorized). </condition> </control>
<control> This cause value <condition> received from a cell belonging to an SNPN </condition> <action> is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.7. </action> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and <action> shall store it according to subclause 5.1.3.2.2 </action> ) and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall delete the list of equivalent PLMNs, </action> <action> store the PLMN identity in the forbidden PLMN list as specified in subclause 5.3.13A. </action> <control> <condition> For 3GPP access </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> <condition> in order to perform a PLMN selection according to 3GPP TS 23.122 , </condition> </control> and <control> <condition> for non-3GPP access </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE </end_state> <condition> in order to perform network selection as defined in 3GPP TS 24.502 . </condition> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN to the UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED, </action> <end_state> enter the state EMM- DEREGISTERED </end_state> and <action> shall delete any 4G-GUTI, last visited registered TAI, TAI list and eKSI. </action> </control>
<control> <condition> #74 (Temporarily not authorized for this SNPN). </condition> </control>
<control> 5GMM cause #74 is only applicable <condition> when received from a cell belonging to an SNPN. </condition> 5GMM cause #74 <condition> received from a cell not belonging to an SNPN </condition> is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.7. </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and <action> shall store it according to subclause 5.1.3.2.2 </action> ) and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall store the SNPN identity in the "temporarily forbidden SNPNs" list for the specific access type </action> <condition> for which the message was received </condition> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription. </condition> <control> <condition> If the UE is not registered for onboarding services in SNPN, </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the UE is registered for onboarding services in SNPN, </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access to the same SNPN, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
NOTE 8: <control> <condition> When 5GMM cause #74 is received over 3GPP access, </condition> the term "other access" in "the UE also supports the registration procedure over the other access to the same SNPN" is used to express access to SNPN services via a PLMN. </control>
NOTE 9: The term "non-3GPP access" in an SNPN refers to the case where the UE is accessing SNPN services via a PLMN.
<control> <condition> #75 (Permanently not authorized for this SNPN). </condition> </control>
<control> 5GMM cause #75 is only applicable <condition> when received from a cell belonging to an SNPN with a globally-unique SNPN identity. </condition> 5GMM cause #75 <condition> received from a cell not belonging to an SNPN or a cell belonging to an SNPN with a non-globally-unique SNPN identity </condition> is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.7. </control>
<action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> ( and <action> shall store it according to subclause 5.1.3.2.2 </action> ) and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> <action> The UE shall store the SNPN identity in the "permanently forbidden SNPNs" list for the specific access type </action> <condition> for which the message was received </condition> and, <condition> if the UE supports access to an SNPN using credentials from a credentials holder, the selected entry of the "list of subscriber data" or the selected PLMN subscription. </condition> <control> <condition> If the UE is not registered for onboarding services in SNPN, > </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the UE is registered for onboarding services in SNPN, </condition> <end_state> the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP TS 23.122 . </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE also supports the registration procedure over the other access to the same SNPN, </condition> </condition> <action> the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value. </action> </control>
NOTE 10: <control> <condition> When 5GMM cause #75 is received over 3GPP access, </condition> the term "other access" in "the UE also supports the registration procedure over the other access to the same SNPN" is used to express access to SNPN services via a PLMN. </control>
NOTE 11: The term "non-3GPP access" in an SNPN refers to the case where the UE is accessing SNPN services via a PLMN.
<control> <condition> #76 (Not authorized for this CAG or authorized for CAG cells only). </condition> </control>
<control> This cause value <condition> received via non-3GPP access or from a cell belonging to an SNPN </condition> <action> is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.7. </action> </control>
<control> <action> The UE shall set the 5GS update status to 5U3.ROAMING NOT ALLOWED, </action> <action> store the 5GS update status according to clause 5.1.3.2.2. </action> </control>
<control> <condition> If 5GMM cause #76 is received from: </condition> </control>
1) <control> <condition> a CAG cell, </condition> and <control> <condition> if the UE receives a "CAG information list" in the CAG information list IE or the Extended CAG information list IE <condition> included in the SERVICE REJECT message, </condition> </condition> the UE shall: </control> </control>
<control> i) <action> replace the "CAG information list" stored in the UE with the received "CAG information list" </action> <condition> when received in the HPLMN or EHPLMN; </condition> </control>
<control> ii) <action> replace the serving VPLMN's entry of the "CAG information list" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE </action> <condition> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN; </condition> </condition> or NOTE 12: <condition> <condition> When the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN, </condition> <condition> entries of a PLMN other than the serving VPLMN, <condition> if any, </condition> in the received CAG information list IE </condition> or <condition> the Extended CAG information list IE are ignored. </condition> </condition> </condition> </condition> </control>
<control> iii) <action> remove the serving VPLMN's entry of the "CAG information list" stored in the UE </action> <condition> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or </condition> </condition> <condition> the Extended CAG information list IE does not contain the serving VPLMN's entry. </condition> </condition> </control>
<control> <condition> Otherwise, </condition> <action> the UE shall delete the CAG-ID from the "allowed CAG list" for the current PLMN. </action> </control> <control> <condition> In the case the "allowed CAG list" for the current PLMN only contains a range of CAG-IDs, </condition> how the UE deletes the CAG- ID(s) of the cell from the "allowed CAG list" for the current PLMN is up to UE implementation. </control> In addition:
<control> <condition> i) <condition> if the entry <condition> in the "CAG information list" </condition> for the current PLMN does not include an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> or <condition> if the entry <condition> in the "CAG information list" for the current PLMN </condition> includes an "indication that the UE is only allowed to access 5GS via CAG cells" </condition> and <condition> the updated "allowed CAG list" <condition> for the current PLMN </condition> includes one or more CAG-IDs, </condition> </condition> then <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list"; </action> </control>
<control> ii) <condition> <condition> if the entry <condition> in the "CAG information list" </condition> for the current PLMN includes an "indication that the UE is only allowed to access 5GS via CAG cells" and <condition> the updated "allowed CAG list" <condition> for the current PLMN </condition> does not include any CAG-ID, </condition> </condition> </condition> <end_state> then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list"; </action> </control> or
<control> iii) <condition> if the "CAG information list" does not include an entry for the current PLMN, </condition> then <end_state> the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 or 3GPP TS 36.304 with the updated "CAG information list". </action> </control>
2) <control> <condition> a non-CAG cell, </condition> and <control> <condition> if the UE receives a "CAG information list" in the CAG information list IE or the Extended CAG information list IE <condition> included in the SERVICE REJECT message, </condition> </condition> the UE shall: </control> </control>
<control> i) <action> replace the "CAG information list" stored in the UE with the received "CAG information list" </action> <condition> when received in the HPLMN or EHPLMN; </condition> </control>
<control> ii) <action> replace the serving VPLMN's entry of the "CAG information list" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE </action> <condition> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN; </condition> </condition> or NOTE 13: <condition> <condition> When the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN, </condition> <condition> entries of a PLMN other than the serving VPLMN, </condition> <condition> if any, </condition> in the received CAG information list IE </condition> or <condition> the Extended CAG information list IE are ignored. </condition> </condition> </condition> </control>
<control> iii) <action> remove the serving VPLMN's entry of the "CAG information list" stored in the UE </action> <condition> <condition> when the UE receives the CAG information list IE or the Extended CAG information list IE <condition> in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE </condition> or <condition> the Extended CAG information list IE does not contain the serving VPLMN's entry. </condition> </condition> </condition> </control>
<control> <condition> Otherwise, </condition> <action> the UE shall store an "indication that the UE is only allowed to access 5GS via CAG cells" in the entry of the "CAG information list" for the current PLMN, </action> <condition> if any. </condition> </control> <control> <condition> If the "CAG information list" stored in the UE does not include the current PLMN's entry, </condition> <action> the UE shall add an entry for the current PLMN to the "CAG information list" </action> and <action> store an "indication that the UE is only allowed to access 5GS via CAG cells" in the entry of the "CAG information list" for the current PLMN. </action> </control> <control> <condition> If the UE does not have a stored "CAG information list", </condition> <action> the UE shall create a new "CAG information list" </action> and <action> add an entry with an "indication that the UE is only allowed to access 5GS via CAG cells" for the current PLMN. </action> </control>
In addition:
<control> <condition> i) if the "allowed CAG list" for the current PLMN includes one or more CAG-IDs, </condition> <end_state> then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE </end_state> and <action> shall search for a suitable cell according to 3GPP TS 38.304 with the updated CAG information; </action> </control> or
<control> ii) <condition> if the "allowed CAG list" for the current PLMN does not include any CAG-ID, </condition> <end_state> then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH </end_state> and <action> shall apply the PLMN selection process defined in 3GPP TS 23.122 with the updated "CAG information list". </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED, </action> <action> reset the service request attempt counter </action> and <end_state> enter the state EMM-REGISTERED. </end_state> </control>
<control> <condition> #77 (Wireline access area not allowed). </condition> </control>
<control> 5GMM cause #77 is only applicable <condition> when received from a wireline access network by the 5G-RG or the W-AGF <condition> acting on behalf of the FN-CRG (or on behalf of the N5GC device). </condition> </condition> </control> <control> 5GMM cause #77 <condition> <condition> received from a 5G access network other than a wireline access network </condition> and 5GMM cause #77 <condition> received by the W-AGF <condition> acting on behalf of the FN-BRG </condition> </condition> </condition> <action> are considered as abnormal cases and the behaviour of the UE is specified in subclause 5.6.1.7. </action> </control>
<control> <condition> When received over wireline access network, </condition> <action> the 5G-RG and the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and <action> shall store it according to subclause 5.1.3.2.2 </action> ), </action> <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI, </action> <end_state> shall enter the state 5GMM-DEREGISTERED </end_state> and <action> shall act as specified in subclause 5.3.23. </action> </control>
NOTE 14: The 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses 4.7.2 and 5.1.3).
#78 <control> <condition> (PLMN not allowed to operate at the present UE location). </condition> </control>
<control> This cause value <condition> received from a non-satellite NG-RAN cell </condition> <action> is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.7. </action> </control>
<control> <action> The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED </action> (and <action> shall store it according to subclause 5.1.3.2.2 </action> ) and <action> shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> Additionally, <action> the UE shall reset the registration attempt counter. </action> <action> The UE shall store the PLMN identity </action> and, <condition> if it is known, </condition> <action> the current geographical location in the list of "PLMNs not allowed to operate at the present UE location" </action> and <action> shall start a corresponding timer instance (see subclause 4.23.2). </action> <end_state> The UE shall enter state 5GMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> <condition> If the message was received via 3GPP access </condition> and <condition> the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 </action> <condition> for the case when the service request procedure is rejected <condition> with the EMM cause with the same value. </condition> </condition> </control>
5.6.1.6 Service request procedure for initiating an emergency PDU session not accepted by the network
<control> <condition> If the service request for initiating an emergency PDU session cannot be accepted by the network, </condition> <action> the UE shall perform the procedures as described in subclause 5.6.1.5. </action> <control> <condition> Then if the UE is in the same selected PLMN <condition> where the last service request was attempted, </condition> </condition> the UE shall: </control> </control>
<control> a) <action> inform the upper layers of the failure of the procedure; </action> </control> or NOTE 1: This can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP TS 23.167 .
<control> b) <action> de-register locally, <condition> if not de-registered already, </condition> attempt initial registration for emergency services. </action> </control>
<control> <condition> If the service request for initiating an emergency PDU session fails <condition> due to abnormal cases a) in subclause 5.6.1.7, </condition> </condition> <action> the UE shall perform the procedures as described in subclause 5.6.1.7. </action> <control> <condition> Then if the UE is in the same selected PLMN <condition> where the last SERVICE REQUEST message was attempted, </condition> </condition> the UE shall: </control> </control>
<control> a) <action> inform the upper layers of the failure of the procedure; </action> </control> or NOTE 2: This can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP TS 23.167 and 3GPP TS 24.229 .
<control> b) <action> de-register locally, <condition> if not de-registered already, </condition> attempt initial registration for emergency services. </action> </control>
5.6.1.6A Service request procedure for an emergency services fallback not accepted by the network
<control> <condition> If the service request for initiating an emergency services fallback cannot be accepted by the network, </condition> <action> the UE shall perform the procedures as described in subclause 5.6.1.5 </action> and <control> <condition> <condition> if the UE does not attempt to select an E-UTRA cell connected to EPC or 5GCN as described in subclause 5.6.1.5 </condition> and <condition> is camped on NR or E-UTRA cell connected to 5GCN in the same PLMN <condition> where the last service request was attempted, </condition> </condition> </condition> <action> the UE shall inform the upper layers of the failure of the procedure. </action> </control> </control>
NOTE 1: This can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP TS 23.167 .
<control> <condition> If the service request for initiating an emergency services fallback fails <condition> due to abnormal cases a) in subclause 5.6.1.7, </condition> </condition> <action> the UE shall inform the upper layers of the failure of the emergency services fallback. </action> </control>
NOTE 2: This can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP TS 23.167 .
<control> <condition> If the service request procedure for initiating an emergency services fallback fails <condition> due to abnormal cases other than a) in subclause 5.6.1.7, </condition> </condition> <action> the UE may abort the service request procedure, </action> <condition> <condition> if not aborted already </condition> and <condition> attempt to select an E- UTRA cell connected to EPC or 5GCN according to the domain priority and selection rules specified in 3GPP TS 23.167 . </condition> </condition> </control> <control> <condition> If the UE finds a suitable E-UTRA cell, </condition> <action> it then proceeds with the appropriate EMM or 5GMM procedures. </action> </control>
<control> <condition> If the UE <condition> operating in single-registration mode </condition> has changed to S1 mode, </condition> <action> it shall disable the N1 mode capability for 3GPP access. </action> </control>
5.6.1.7 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> The UE shall <end_state> enter the state 5GMM-REGISTERED. </end_state> </control>
<control> <condition> <condition> If the UE triggered the service request procedure in 5GMM-IDLE mode sending a: </condition> <condition> 1) SERVICE REQUEST message and the service type of the SERVICE REQUEST message was not set to "emergency services fallback"; or </condition> <condition> 2) CONTROL PLANE SERVICE REQUEST message and the control plane service type of the CONTROL PLANE SERVICE REQUEST message was not set to "emergency services fallback"; </condition> </condition> then the 5GMM sublayer shall <action> increment the service request attempt counter, </action> <action> abort the procedure </action> and <action> release locally any resources allocated for the service request procedure. </action> </control> <control> The service request attempt counter shall <action> not be incremented, </action> if: <condition> <condition> 1) the service request procedure is initiated to establish an emergency PDU session; </condition> <condition> 2) the UE has an emergency PDU session established; </condition> </condition> </control>
<control> <condition> <condition> 3) the UE is a UE configured for high priority access in selected PLMN; </condition> <condition> 4) the service request procedure is initiated in response to paging or notification from the network; or </condition> <condition> 5) the UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ). </condition> </condition> </control>
NASCONFIG
<control> <condition> If the service request attempt counter is greater than or equal to 5, </condition> the UE shall <action> start timer T3525. </action> </control> <control> Additionally, <condition> <condition> if the service request procedure was initiated for an MO MMTEL voice call </condition> or <condition> for an MO MMTEL video call or for an MO IMS registration related signalling, </condition> </condition> a notification that the service request was not initiated due to the UE having started timer T3525 shall <action> be provided to the upper layers. </action> </control>
NOTE 1: This can result in the upper layers requesting implementation specific mechanisms, e.g. the MMTEL voice call being attempted to another IP-CAN, or establishment of a CS voice call (if supported and not already attempted in the CS domain).
<control> The UE shall <action> not attempt service request </action> <condition> <condition> until expiry of timer T3525 </condition> <condition> unless: 1) the service request procedure is initiated in response to paging or notification from the network; </condition> 2) <condition> the UE is a UE configured for high priority access in selected PLMN; </condition> 3) <condition> the service request procedure is initiated to establish an emergency PDU session; </condition> 4) <condition> the UE has an emergency PDU session established; </condition> 5) <condition> the service request procedure is initiated for emergency services fallback; </condition> 6) <condition> the UE is registered in a new PLMN; or NOTE 2: According to Table 10.2.1, when "UE camped on a new PLMN other than the PLMN on which timer started", timer T3525 is stopped, hence this check may be skipped. </condition> 7) <condition> the UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ). </condition> </condition> </control>
NASCONFIG NOTE 3: <control> The NAS signalling connection can also <action> be released </action> <condition> if the UE deems that the network has failed the authentication check as specified in subclause 5.4.1.3.7. </condition> </control>
<control> <condition> <condition> If the UE triggered the service request procedure in 5GMM-CONNECTED mode sending a: 1) SERVICE REQUEST message and the service type of the SERVICE REQUEST message was not set to "emergency services fallback"; </condition> or 2) <condition> CONTROL PLANE SERVICE REQUEST message and the control plane service type of the CONTROL PLANE SERVICE REQUEST message was not set to "emergency services fallback", </condition> </condition> the 5GMM sublayer shall <action> abort the procedure, </action> . and <action> stay in 5GMM-CONNECTED mode. </action> </control>
<control> <condition> <condition> If the service type of the SERVICE REQUEST message was set to "emergency services fallback" </condition> or <condition> the control plane service type of the CONTROL PLANE SERVICE REQUEST message was set to "emergency services fallback" </condition> </condition> and: <control> 1) <condition> the service request procedure was triggered in 5GMM-IDLE mode, </condition> the 5GMM sublayer shall <action> abort the procedure, </action> <action> release locally any resources allocated for the service request procedure; </action> </control> or <control> 2) <condition> the service request procedure was triggered in 5GMM-CONNECTED mode, </condition> the 5GMM sublayer shall <action> abort the procedure, </action> <action> stay in 5GMM-CONNECTED mode. </action> </control> </control>
<control> <condition> b) The lower layers indicate that the access attempt is barred. </condition> </control>
<control> The UE shall <action> not start the service request procedure. </action> </control> <control> The UE <action> stays in the current serving cell and applies the normal cell reselection process. </action> </control> <control> Receipt of the access barred indication shall <action> not trigger the selection of a different core network type (EPC or 5GCN). </action> </control>
<control> The service request procedure <action> is started, </action> <condition> <condition> if still needed, </condition> <condition> when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated. </condition> </condition> </control>
ba) The lower layers indicate that:
1) access barring is applicable for all access categories except categories 0 and 2 and the access category with which the access attempt was associated is other than 0 and 2; or
2) access barring is applicable for all access categories except category 0 and the access category with which the access attempt was associated is other than 0.
<control> <condition> If the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST has not been sent, </condition> the UE shall <action> proceed as specified for case b. </action> </control>
<control> <condition> If the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST has been sent: </condition> 1) the UE shall <action> abort the service request procedure </action> and <action> stop timer T3517. </action> The UE <action> stays in the current serving cell </action> and <action> applies the normal cell reselection process; </action> and <control> 2) the service request procedure <action> is started, </action> <condition> <condition> if still needed, </condition> <condition> when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated. </condition> </condition> </control> </control>
For additional UE requirements for both cases see subclause 4.5.5.
<control> The UE shall <action> not start the service request procedure </action> <condition> unless: <condition> 1) the UE receives a paging; </condition> <condition> 2) the UE receives a NOTIFICATION message over non-3GPP access when the UE is in 5GMM- CONNECTED mode over non-3GPP access and in 5GMM-IDLE mode over 3GPP access; </condition> <condition> 3) the UE receives a NOTIFICATION message over 3GPP access when the UE is in 5GMM-CONNECTED mode over 3GPP access and in 5GMM-IDLE mode over non-3GPP access; </condition> <condition> 4) the UE is a UE configured for high priority access in selected PLMN; </condition> <condition> 5) the UE has an emergency PDU session established or is establishing an emergency PDU session; </condition> <condition> 6) the service request procedure is initiated for emergency services fallback; </condition> <condition> 7) the service request procedure is initiated for elevated signalling; </condition> <condition> 8) the UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event </condition> and: <condition> a) the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ); </condition> NASCONFIG and <condition> b) timer T3346 was not started when N1 NAS signalling connection was established with RRC establishment cause set to "mo-ExceptionData"; </condition> or <condition> 9) the MUSIM UE is in 5GMM-CONNECTED mode and requests the network to release the NAS signalling connection (see case o in subclause 5.6.1.1). </condition> </condition> </control>
<control> <condition> If the UE is in 5GMM-IDLE mode, </condition> the UE <action> stays in the current serving cell </action> and <action> applies normal cell reselection process. </action> </control> <control> The service request procedure <action> is started, </action> <condition> <condition> if still necessary, </condition> <condition> when timer T3346 expires or is stopped. </condition> </condition> </control>
<control> <condition> If the service request procedure was triggered for an MO MMTEL voice call (i.e. access category 4), or for an MO MMTEL video call (i.e. access category 5) or for an MO IMS registration related signalling (i.e. access category 9), </condition> a notification that the service request procedure was not initiated due to congestion shall <action> be provided to the upper layers. </action> </control>
<control> <condition> <condition> If the UE receives a paging with access type set to "Non-3GPP access" </condition> and <condition> the non-3GPP access is available </condition> and <start_state> UE is in 5GMM-REGISTERED.NORMAL SERVICE over non-3GPP access, </start_state> </condition> the UE shall <action> stop timer T3346 </action> and <action> send the SERVICE REQUEST message over non-3GPP access. </action> </control>
<control> <condition> d) Registration procedure for mobility and periodic registration update is triggered. </condition> </control>
<control> The UE shall <action> abort the service request procedure, </action> <action> stop timer T3517, </action> <condition> if running and perform the registration procedure for mobility and periodic registration update. </condition> </control> <control> The Follow-on request indicator in the REGISTRATION REQUEST message shall <action> be handled as specified in clause 5.5.1.3.2. </action> </control>
<control> If <start_state> the UE is in state 5GMM-SERVICE-REQUEST-INITIATED at switch off, </start_state> the de-registration procedure shall <action> be performed. </action> </control>
<control> If the UE <condition> receives a DEREGISTRATION REQUEST message from the network </condition> <start_state> in state 5GMM-SERVICE- REQUEST-INITIATED, </start_state> the UE shall <action> progress the DEREGISTRATION REQUEST message </action> and the service request procedure shall <action> be aborted. </action> </control>
NOTE 4: The above collision case is valid if the DEREGISTRATION REQUEST message indicates the access type over which the service request procedure is attempted otherwise both the procedures are progressed.
<control> <condition> g) Transmission failure of SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message indication with change in the current TAI. </condition> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> UE shall <action> abort the service request procedure to perform the registration procedure for mobility and periodic registration update as specified in subclause 5.5.1.3.2. </action> </control>
<control> <condition> If the current TAI is part of the TAI list, </condition> the UE shall <action> restart the service request procedure </action> <condition> unless the service request procedure is initiated for case o) or p) in subclause 5.6.1.1. </condition> </control> <control> <condition> For case o) and p) in subclause 5.6.1.1 </condition> the UE shall <action> abort the service request procedure, </action> <end_state> enters state 5GMM-REGISTERED, </end_state> <action> locally release the N1 NAS signalling connection, </action> <action> stop timer T3517 </action> and <action> locally release any resources allocated for the service request </action> </control>
<control> <condition> h) Transmission failure of SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message indication without change in the current TAI. </condition> </control>
<control> The UE shall <action> restart the service request procedure </action> <condition> unless the service request procedure is initiated for case o) </condition> or </control>
<control> <condition> p) <condition> in subclause 5.6.1.1. </condition> <condition> For case o) and p) in subclause 5.6.1.1 </condition> </condition> the UE shall <action> abort the service request procedure, </action> <end_state> enters state 5GMM-REGISTERED, </end_state> <action> locally release the N1 NAS signalling connection, </action> <action> stop timer T3517 </action> and <action> locally release any resources allocated for the service request procedure. </action> </control>
<control> The UE shall <end_state> enter state 5GMM-REGISTERED. </end_state> </control>
<control> The UE shall <action> abort the service request procedure, </action> <action> stop timer T3517 </action> and <action> locally release any resources allocated for the service request procedure. </action> </control>
<control> <condition> j) <condition> The UE in 5GMM-CONNECTED mode with RRC inactive indication over the 3GPP access, </condition> and <condition> in 5GMM- CONNECTED mode over non-3GPP access, </condition> </condition> <action> receives a NOTIFICATION message over the non-3GPP access with access type indicating 3GPP access. </action> </control>
<control> The UE <action> shall transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode over 3GPP access </action> and <action> initiate the service request procedure over the 3GPP access. </action> </control>
<control> <condition> k) Timer T3447 is running </condition> </control>
<control> The UE shall <action> not start any service request procedure </action> <condition> unless: 1) <condition> the UE in 5GMM-IDLE receives a paging request; </condition> 2) <condition> the UE is a UE configured for high priority access; </condition> 3) <condition> the UE has a PDU session for emergency services established or is establishing a PDU session for emergency services; </condition> 4) <condition> the service request procedure is initiated for emergency services fallback; </condition> 5) <condition> the UE in 5GMM-CONNECTED mode receives mobile terminated signalling or downlink data over the user-plane; </condition> 6) <condition> the service request procedure is initiated for elevated signalling; or </condition> 7) <condition> the MUSIM UE requests the network to release the NAS signalling connection (see case o in subclause 5.6.1.1). </condition> </condition> </control>
<control> The UE <action> stays in the current serving cell and applies the normal cell reselection process. </action> </control> <control> The service <action> request procedure is started, </action> <condition> <condition> if still necessary, </condition> <condition> when timer T3447 expires </condition> or <condition> timer T3447 is stopped. </condition> </condition> </control>
l) Lower layer failure, release of the N1 signalling connection received from lower layers or the lower layers indicate that the RRC connection has been suspended before the service request procedure is completed or SERVICE REJECT message is received.
<control> The UE shall <action> abort the service request procedure, </action> <action> stop timer T3517, </action> <action> locally release any resources allocated for the service request procedure </action> and <end_state> enters state 5GMM-REGISTERED. </end_state> </control> <control> <condition> For case m) in subclause 5.6.1.1 </condition> the UE may <action> retry the service request procedure a certain number of times (maximum re-attempts 5). </action> </control>
<control> <condition> m) Timer T3448 is running </condition> </control>
<control> <condition> The UE in 5GMM-IDLE mode </condition> shall <action> not initiate the service request procedure for transport of user data via the control plane </action> <condition> unless: <condition> 1) the UE is a UE configured for high priority access in selected PLMN; </condition> <condition> 2) the UE which is only using 5GS services with control plane CIoT 5GS optimization received a paging request; </condition> <condition> 3) the UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ); or NASCONFIG </condition> <condition> 4) the UE is initiating the service request procedure to request emergency services or emergency services </condition> </condition> </control>
<control> The UE <action> stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> </control> <control> The service request procedure <action> is started, </action> <condition> <condition> if still necessary, </condition> <condition> when timer T3448 expires. </condition> </condition> </control>
5.6.1.8 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) Lower layer failure. </condition> </control>
<control> <condition> <condition> If a lower layer failure occurs before a SERVICE REJECT message has been sent to the UE </condition> or <condition> the service request procedure has been completed by the AMF, </condition> </condition> the AMF <action> enters/stays in 5GMM-IDLE. </action> </control>
<control> <condition> If the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message is received with a protocol error, </condition> the AMF shall <action> return a SERVICE REJECT message with one of the following 5GMM cause values: </action> </control>
#96 invalid mandatory information; #99 information element non-existent or not implemented; #100 conditional IE error; or #111 protocol error, unspecified.
<control> The AMF <action> stays in the current 5GMM mode. </action> </control>
<control> <condition> c) More than one SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message received before the procedure has been completed (i.e., before SERVICE REJECT message has been sent or service request procedure has been completed). </condition> <control> a) <condition> <condition> If one or more of the information elements in the SERVICE REQUEST message </condition> or <condition> CONTROL PLANE SERVICE REQUEST message differs from the ones received within the previous SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message, </condition> </condition> the previously initiated service request procedure shall <action> be aborted, </action> and the new service request procedure shall <action> be progressed; </action> </control> <control> b) <condition> If the information elements do not differ, </condition> then the AMF shall <action> continue with the previous service request procedure </action> and shall <action> not treat any further this SERVICE REQUEST message or this CONTROL PLANE SERVICE REQUEST message. </action> </control> </control>
<control> <condition> d) REGISTRATION REQUEST message received with "initial registration" or "emergency registration" in the 5GS registration type IE before a SERVICE REJECT message has been sent or the service request procedure has been completed. </condition> </control>
<control> <condition> <condition> If a REGISTRATION REQUEST message with "initial registration" </condition> or <condition> "emergency registration" in the 5GS registration type IE is received </condition> and <condition> the service request procedure has not been completed or a SERVICE REJECT message has not been sent, </condition> </condition> the AMF <action> may initiate the 5GMM common procedures, </action> e.g. the primary authentication and key agreement procedure. </control> <control> The AMF may e.g. <condition> after a successful primary authentication and key agreement procedure execution, </condition> <action> abort the service request procedure, </action> <action> delete the 5GMM context, </action> <action> indicate towards the SMF that the 5GMM context has been deleted </action> and <action> progress the new REGISTRATION REQUEST </action> </control>
<control> <condition> e) REGISTRATION REQUEST message received with "mobility registration updating" or "periodic registration updating" in the 5GS registration type IE received before the service request procedure has been completed or a SERVICE REJECT message has been sent. </condition> </control>
<control> <condition> <condition> If a REGISTRATION REQUEST message with "mobility registration updating" </condition> or <condition> "periodic registration updating" in the 5GS registration type IE is received </condition> and <condition> the service request procedure has not been completed </condition> or <condition> a SERVICE REJECT message has not been sent, </condition> </condition> the AMF may <action> initiate the 5GMM common procedures, </action> e.g. the primary authentication and key agreement procedure. </control> <control> The AMF may e.g. <condition> after a successful primary authentication and key agreement procedure execution, </condition> <action> abort the service request procedure </action> and <action> progress the new REGISTRATION REQUEST message. </action> </control>
<control> f) <condition> If a CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile originating request" is received after the AMF initiated a paging procedure, </condition> the AMF shall <action> treat this CONTROL PLANE SERVICE REQUEST as a paging response and handle the message according to subclauses 5.6.1.4 </action> and </control>
<control> <condition> g) CONTROL PLANE SERVICE REQUEST message received with the Data type field indicates "control plane user data" in the CIoT small data container IE or received with Payload container type IE set to "CIoT user data container" and: </condition> </control>
<control> <condition> 1) the AMF does not have a PDU session routing context for the PDU session ID and the UE; or </condition> </control>
<control> <condition> 2) the AMF unsuccessfully attempted to forward the user data container and the PDU session ID, </condition> then the AMF may <action> send back to the UE the CIoT user data container or control plane user data which was not forwarded as specified in subclause 5.4.5.3.1 case l1) or case l2). </action> </control>
<control> h) Based on operator policy, <condition> if the service request from a UE not supporting CAG is rejected due to CAG restrictions, </condition> the network shall <action> reject the service request with a 5GMM cause value other than the 5GMM cause </action> </control>
#76 (Not authorized for this CAG or authorized for CAG cells only).
NOTE: 5GMM cause #7 (5GS services not allowed), 5GMM cause #11 (PLMN not allowed), 5GMM cause #27 (N1 mode not allowed), 5GMM cause #73 (Serving network not authorized) can be used depending on the subscription of the UE and whether the UE roams or not.
5.6.2 Paging procedure
5.6.2.1 General
The paging procedure is performed only in 3GPP access and used by the network to request the establishment of a NAS signalling connection to the UE. <control> The paging procedure <action> is also used by the network to request the UE to re-establish the user-plane resources of PDU sessions for downlink user data transport. </action> </control> Another purpose of the paging procedure is to request the UE to re-establish the user-plane resources of PDU session(s) associated with non-3GPP access over 3GPP
<control> Additionally, the network <action> can use the paging procedure to initiate the mobile terminating SMS. </action> </control>
<control> <condition> For the UE using eDRX, </condition> the network <action> initiates the paging procedure </action> <condition> when NAS signalling messages or user data is pending to be sent to the UE within the paging time window and requests the lower layers to include the eDRX cycle length and paging time window length in the paging message. </condition> </control> <control> <condition> If NAS signalling messages or user data is pending to be sent to the UE outside the paging time window and the eDRX value that the network provides to the UE in the Negotiated extended DRX parameters IE during the last registration procedure indicates: </condition> </control>
<control> <condition> a) the eDRX cycle length duration of the E-UTRA cell connected to 5GCN, is higher than 5.12 seconds; or </condition> </control>
<control> <condition> b) the eDRX cycle length duration of the NR cell connected to 5GCN, is higher than 10.24 seconds, the network initiates the paging procedure at T time ahead of the beginning of the next paging time window. </condition> </control>
NOTE: T time is a short time period based on implementation. The operator can take possible imperfections in the synchronization between the 5GCN and the UE into account when choosing T time.
<control> <condition> <condition> If the network detects that the pending user data to be sent to the UE is related to the voice service as specified in 3GPP TS 23.502 </condition> and <condition> the network decides to initiate the paging procedure based on the stored paging restriction information, </condition> </condition> if any, the AMF should <action> request the lower layer to include the Voice Service Indication in the paging message </action> <condition> when the UE and the network support the paging indication for voice services. </condition> </control>
5.6.2.2 Paging for 5GS services
5.6.2.2.1 General
<control> The network shall <action> initiate the paging procedure </action> for 5GS services <condition> <condition> when NAS signalling messages or user data is pending to be sent to the UE in 5GMM-IDLE mode over 3GPP access </condition> (see example in figure 5.6.2.2.1.1) and <condition> there is no paging restriction applied in the network for that paging. </condition> </condition> </control>
<control> To initiate the procedure the 5GMM entity in the AMF <action> requests the lower layer to start paging </action> and shall <action> start timer T3513. </action> </control>
<control> <condition> If downlink signalling or user data is pending to be sent over non-3GPP access, </condition> the 5GMM entity in the AMF shall <action> indicate to the lower layer that the paging is associated to non-3GPP access. </action> </control>
<control> The network shall <action> not page the UE to re-establish user-plane resources of PDU session(s) associated with non-3GPP access over 3GPP access </action> <condition> if all the PDU sessions of the UE that are established over the 3GPP access are associated with control plane only indication. </condition> </control>
<control> <condition> If the network has downlink user data pending for a UE, </condition> the AMF has stored paging restriction of the UE and the Paging restriction type in the stored paging restriction <action> is set to: </action> </control>
<control> <action> a) "All paging is restricted", </action> the network should <action> not page the UE; </action> </control>
<control> b) <action> "All paging is restricted except for voice service", </action> the network should <action> page the UE </action> <condition> only when: <condition> 1) the pending downlink user data for the UE is considered as voice service related by the network; </condition> </condition> </control>
<control> <action> c) "All paging is restricted except for specified PDU session(s)", </action> the network should <action> page the UE </action> <condition> only when: 1) for PDU session(s) that paging is not restricted based on the stored paging restriction, the network has downlink user data pending; or </condition> </control>
<control> d) <action> "All paging is restricted except for voice service and specified PDU session(s)", </action> the network should <action> page the UE </action> <condition> only when: <condition> 1) the pending downlink user data for the UE is considered as voice service related by the network; or </condition> <condition> 2) for PDU session(s) that paging is not restricted based on the stored paging restriction, the network has downlink user data pending. </condition> </condition> </control>
<control> <condition> <condition> If the network has downlink signalling pending for a UE </condition> and <condition> the AMF has stored paging restriction of the UE </condition> and <condition> the Paging restriction type in the stored paging restriction is set to: </condition> </condition> </control>
<control> <condition> a) "All paging is restricted", </condition> the network should <action> not page the UE; </action> </control>
<control> <condition> b) "All paging is restricted except for voice service", </condition> the network should <action> page the UE only when: </action> </control>
<control> <condition> 1) the pending downlink signalling for the UE is 5GMM signalling or 5GSM signalling of the PDU session of voice service; </condition> </control>
<control> <condition> c) "All paging is restricted except for specified PDU session(s)", </condition> the network should <action> page the UE only when: </action> </control>
<control> <condition> 1) the pending downlink signalling for the UE is 5GMM signalling; or </condition> </control>
<control> <condition> <condition> 2) for PDU session(s) that paging is not restricted based on the stored paging restriction, </condition> <condition> the network has downlink 5GSM signalling pending; or </condition> </condition> </control>
<control> <condition> d) "All paging is restricted except for voice service and specified PDU session(s)", </condition> the network should <action> page the UE </action> only when: </control>
<control> <condition> 1) the pending downlink signalling for the UE is 5GMM signalling or 5GSM signalling of the PDU session of voice service; </condition> or </control>
<control> <condition> <condition> 2) for PDU session(s) that paging is not restricted based on the stored paging restriction, </condition> <condition> the network has downlink 5GSM signalling pending. </condition> </condition> </control>
NOTE 1: <control> <condition> If the network pages the UE due to downlink signalling pending, </condition> the network <action> initiates the release of the N1 NAS signalling connection </action> <condition> after network-requested procedure is completed. </condition> </control>
<control> The 5GMM entity in the AMF may <action> provide the lower layer with the "allowed CAG list" and an "indication that the UE is only allowed to access 5GS via CAG cells" for the current PLMN, </action> if available, and with the "allowed CAG list" and an "indication that the UE is only allowed to access 5GS via CAG cells" per equivalent PLMN, if available. </control> <control> <condition> If there is an active emergency PDU session, </condition> the 5GMM entity in the AMF shall <action> not provide the lower layer with the "allowed CAG list" </action> and an "indication that the UE <action> is only allowed to access 5GS via CAG cells" for the current PLMN, </action> even if available, or with the "allowed CAG list" and an "indication that the UE is only allowed to access 5GS via CAG cells" per equivalent PLMN, even if available. </control>
<control> <condition> Upon reception of a paging indication, </condition> the UE shall <action> stop the timer T3346, </action> if running, and: </control>
<control> a) <condition> if control plane CIoT 5GS optimization is not used by the UE, </condition> the UE shall: <control> 1) <action> initiate a service request procedure over 3GPP access to respond to the paging as specified in subclauses 5.6.1.2.1 </action> if <start_state> the UE is in 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM- REGISTERED.NON-ALLOWED-SERVICE (as described in subclause 5.3.5.2) state </start_state> and <condition> the UE is in the 5GMM-IDLE mode without suspend indication; </condition> </control> </control>
<control> 2) <action> initiate a service request procedure over non-3GPP access to respond to the paging as specified in subclauses 5.6.1; </action> </control>
<control> 3) <action> initiate a registration procedure for mobility and periodic registration update over 3GPP access to respond to the paging as specified in subclauses 5.5.1.3.2; or </action> </control>
<control> 4) <action> proceed as specified in subclause 5.3.1.5 </action> <condition> if the UE is in the 5GMM-IDLE mode with suspend indication; or </condition> </control>
<control> b) <condition> if control plane CIoT 5GS optimization is used by the UE, </condition> the UE shall: <control> 1) <action> initiate a service request procedure as specified in subclause 5.6.1.2.2 </action> <condition> if the UE is in the 5GMM-IDLE mode without suspend indication; </condition> </control> 2) <action> initiate a registration procedure for mobility and periodic registration update over 3GPP access as specified in subclauses 5.5.1.3.2; or </action> 3) <action> proceed as specified in subclause 5.3.1.5 if the UE is in the 5GMM-IDLE mode with suspend indication. </action> </control>
NOTE 2: If the UE is in the 5GMM-IDLE mode without suspend indication and has an uplink user data to be sent to the network using control plane CIoT 5GS optimization when receiving the paging indication, the UE can piggyback the uplink user data during the service request procedure initiated to respond to the paging, as specified in subclause 5.6.1.2.2.
The MUSIM UE based on implementation may use the paging cause indicated by lower layers (see 3GPP TS 38.331 ), if any, to accept the paging, reject the paging or ignore the paging indication.
<control> <condition> <condition> Upon reception of a paging indication, </condition> <condition> if the network supports the rejection of paging request </condition> and <condition> if a MUSIM UE decides not to accept the paging, </condition> </condition> the UE <action> may initiate a service request procedure to reject the paging as specified in clause 5.6.1.1. </action> </control>
NOTE 3: As an implementation option, MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.
<control> <condition> <condition> If TMGI is used as paging identity </condition> and <condition> the TMGI matches with MBS multicast session which the has UE joined, </condition> </condition> the UE shall <action> respond to the paging. </action> </control> <control> <condition> Otherwise, </condition> the UE shall <action> not respond to the paging. </action> </control>
<control> The network shall stop timer T3513 for the paging procedure when an integrity-protected response is received from the UE and successfully integrity checked by the network or when the 5GMM entity in the AMF receives an indication from the lower layer that it has received the NGAP UE context resume request message as specified in 3GPP TS 38.413 . </control> <control> <condition> <condition> If the response received is not integrity protected, </condition> or <condition> the integrity check is unsuccessful, </condition> </condition> timer T3513 for the paging procedure shall <action> be kept running </action> unless: </control>
<control> <condition> a) the UE is registered for emergency services; </condition> </control>
<control> <condition> b) the UE has an emergency PDU session; or </condition> </control>
<control> <condition> <condition> c) the response received is a REGISTRATION REQUEST message for mobility </condition> and <condition> periodic registration update </condition> and <condition> the security mode control procedure or authentication procedure performed during mobility </condition> and <condition> periodic registration update has completed successfully. </condition> </condition> </control>
<control> <condition> Upon expiry of timer T3513, </condition> the network may <action> reinitiate paging. </action> </control>
<control> <condition> If the network, <condition> while waiting for a response to the paging sent without paging priority, </condition> <condition> receives downlink signalling or downlink data associated with priority user-plane resources for PDU sessions, </condition> </condition> the network shall <action> stop timer T3513, </action> and then <action> initiate the paging procedure with paging priority. </action> </control>
5.6.2.2.2 Abnormal cases on the network side
The following abnormal case can be identified:
5.6.2.2.3 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) Paging message received with access type set to non-3GPP access while the UE is in 5GMM-CONNECTED mode over non-3GPP access. </condition> </control>
<control> The UE shall <action> not respond to paging message. </action> </control>
<control> <condition> b) <condition> Paging message received with access type set to 3GPP access </condition> <condition> when UE-initiated 5GMM specific procedure </condition> or <condition> service request procedure is ongoing. </condition> </condition> </control>
<control> The UE shall <action> proceed with 5GMM specific procedure or service request procedure. </action> </control> <control> <condition> If for these procedures lower layers indicate that the access attempt is barred, </condition> then the UE shall <action> handle the pending paging message as specified in subclause 5.6.2.2.1. </action> </control> <control> <condition> Otherwise, </condition> the UE shall <action> ignore the paging once lower layers confirm the establishment of the signalling connection. </action> </control>
5.6.3 Notification procedure
5.6.3.1 General
The notification procedure is used by the network:
a) to request the UE, by sending the NOTIFICATION message over 3GPP access, to re-establish the user-plane resources of PDU session(s) associated with non-3GPP access over 3GPP access or to deliver 5GSM downlink signalling messages associated with non-3GPP access over 3GPP access when the UE is in 5GMM-IDLE mode over non-3GPP access and in 5GMM-CONNECTED mode over 3GPP access; or
b) to request the UE, by sending the NOTIFICATION message over non-3GPP access, to re-establish user-plane resources of the PDU session(s) or to deliver downlink signalling associated with 3GPP access over 3GPP access when the UE is in 5GMM-CONNECTED mode over non-3GPP access and:
<control> 1) <condition> <condition> in 5GMM-IDLE mode over 3GPP access </condition> <condition> when the UE is not in MICO mode; </condition> </condition> or </control>
<control> 2) <condition> <condition> in 5GMM-IDLE mode with suspend indication over 3GPP access </condition> <condition> when the UE is not in MICO mode. </condition> </condition> </control>
<control> The network shall <action> not use the NOTIFICATION message to re-establish user-plane resources of PDU session(s) associated with non-3GPP access over 3GPP access </action> <condition> if all the PDU sessions of the UE that are established over the 3GPP access are associated with control plane only indication. </condition> </control>
<control> The network shall <action> not use the NOTIFICATION message over non-3GPP access, </action> <condition> if: <condition> a) the MUSIM UE supports the paging indication for voice services; </condition> <condition> b) the network has indicated "paging indication for voice services supported" to the UE; </condition> and <condition> c) the AMF detects that the downlink data is related to voice service (see 3GPP TS 23.501 ). </condition> </condition> </control>
5.6.3.2 Notification procedure initiation
<control> The network shall <action> initiate the notification procedure by sending the NOTIFICATION message to the UE </action> and <action> start timer T3565 (see example in figure 5.6.3.2.1). </action> </control>
<control> <condition> For case a) in subclause 5.6.3.1, </condition> the NOTIFICATION message <action> is sent from the network to the UE via 3GPP access with access type indicating non-3GPP access. </action> </control>
<control> <condition> For case b) in subclause 5.6.3.1, </condition> the NOTIFICATION message <action> is sent from the network to the UE via non-3GPP access with access type indicating 3GPP access </action> <condition> when the UE is not in MICO mode. </condition> </control>
UE AMF NOTIFICATION
Start T3565 SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST or REGISTRATION REQUEST
Stop T3565 OR NOTIFICATION
Start T3565 NOTIFICATION RESPONSE
Stop T3565
<control> <condition> Upon reception of a NOTIFICATION message, </condition> the UE shall <action> stop the timer T3346, </action> <condition> if running. </condition> </control>
<control> <condition> <condition> For case a) in subclause 5.6.3.1, </condition> <condition> upon reception of NOTIFICATION message, </condition> </condition> the UE shall <action> initiate a service request procedure over 3GPP access as specified in subclauses 5.6.1. </action> </control>
NOTE: For a UE in NB-NI mode, if there is DL user data pending for a PDU session associated with non-3GPP access then the AMF notifies the SMF that reactivation of user plane resources cannot be performed if the number of PDU sessions that currently has user-plane resources established equals to the UE's maximum number of supported user-plane resources.
<control> <condition> <condition> For case b) in subclause 5.6.3.1, </condition> <condition> upon reception of NOTIFICATION message: </condition> </condition> </control>
<control> a) <condition> if control plane CIoT 5GS optimization is not used by the UE, </condition> the UE shall: <control> 1) <action> initiate a service request procedure over 3GPP access as specified in subclause 5.6.1.2.1, </action> if <start_state> the UE is in 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE (as described in subclause 5.3.5.2) state </start_state> over 3GPP access or <start_state> 5GMM-REGISTERED.NON-ALLOWED- SERVICE state </start_state> (see subclause 5.3.5.2), and <condition> the UE is in the 5GMM-IDLE mode without suspend indication; </condition> </control> <control> 2) <action> initiate a registration procedure for mobility and periodic registration update over 3GPP access as specified in subclause 5.5.1.3.2, </action> if <start_state> the UE is in 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE state over 3GPP access; </start_state> or </control> <control> 3) <action> proceed as specified in subclause 5.3.1.5 </action> <condition> if the UE is in the 5GMM-IDLE mode with suspend indication; </condition> </control> </control>
<control> b) <condition> if control plane CIoT 5GS optimization is used by the UE, </condition> the UE shall: </control>
<control> 1) <action> initiate a service request procedure over 3GPP access as specified in subclause 5.6.1.2.2, </action> if <start_state> the UE is in 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE (as described in subclause 5.3.5.2) state </start_state> and <condition> the UE is in the 5GMM-IDLE mode without suspend indication; </condition> </control>
<control> 2) <action> initiate a registration procedure for mobility and periodic registration update over 3GPP access as specified in subclause 5.5.1.3.2, </action> if the UE <start_state> is in 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE state; </start_state> or </control>
<control> 3) <action> proceed as specified in subclause 5.3.1.5 </action> <condition> if the UE is in the 5GMM-IDLE mode with suspend indication; </condition> or </control>
<control> 1) the UE <start_state> is in 5GMM-REGISTERED.NO-CELL-AVAILABLE state, 5GMM-REGISTERED.PLMN- SEARCH state, 5GMM-REGISTERED.LIMITED-SERVICE state or 5GMM-REGISTERED.UPDATE- NEEDED state </start_state> over 3GPP access; or </control>
<control> <condition> 2) the MUSIM UE is not able to respond the NOTIFICATION message as specified in case a) and b) above, e.g., due to UE implementation constraints; </condition> </control>
<control> the UE shall <action> respond with NOTIFICATION RESPONSE message over non-3GPP access indicating inability of the UE to initiate a service request procedure or a registration procedure over 3GPP access </action> and may <action> include the PDU session status information element to indicate: </action> </control>
<control> <condition> 1) the single access PDU session(s) not in 5GSM state PDU SESSION INACTIVE in the UE associated with the 3GPP access type; and </condition> </control>
<control> <condition> 2) the MA PDU session(s) not in 5GSM state PDU SESSION INACTIVE in the UE and having user plane resources established associated with the 3GPP access type. </condition> </control>
<control> <condition> Upon reception of NOTIFICATION message: </condition> </control>
<control> <condition> <condition> For case b) in subclause 5.6.3.1, </condition> if the UE <start_state> is in 5GMM-REGISTERED.NO-CELL-AVAILABLE state or 5GMM-REGISTERED.PLMN-SEARCH state </start_state> and <condition> a local release was performed in the UE for the single access PDU sessions associated with the 3GPP access or for user plane resources on the 3GPP access of MA PDU sessions; </condition> </condition> then the UE shall <action> respond with NOTIFICATION RESPONSE message over non-3GPP access </action> indicating with the PDU session status information element that: a) the local release of its single access PDU sessions associated with the 3GPP access was performed; and b) the local release of its 3GPP access user plane resources of MA PDU sessions was performed. </control>
5.6.3.3 Notification procedure completion
<control> <condition> Upon reception of SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or REGISTRATION REQUEST message, </condition> the AMF shall <action> stop timer T3565 </action> and <action> proceed service request procedure as specified in subclauses 5.6.3.1 or registration procedure for mobility </action> and <action> periodic registration update as specified in subclauses 5.5.1.3. </action> </control> <control> <condition> If no user-plane resources of PDU session(s) need to be re-established, </condition> the AMF should <action> notify the SMF that the UE was reachable but did not accept to re-establish the user-plane resources of PDU session(s). </action> </control>
<control> <condition> When the 5GMM entity in the AMF receives an indication from the lower layer that it has received the NGAP UE context resume request message as specified in 3GPP TS 38.413 , </condition> the AMF shall <action> stop timer T3565. </action> </control>
<control> <condition> Upon reception of NOTIFICATION RESPONSE message over non-3GPP access, </condition> the AMF shall <action> stop timer T3565 </action> and should <action> notify the SMF that the UE is unreachable. </action> </control>
<control> <condition> If the NOTIFICATION RESPONSE message includes the PDU session status information element, </condition> then: </control>
<control> <condition> a) for single access PDU sessions, </condition> the AMF shall: </control>
<control> <action> 1) perform a local release of all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE on the AMF side associated with 3GPP access, </action> but <action> are indicated by the UE in the PDU session status information element in the NOTIFICATION RESPONSE message as being in 5GSM state PDU SESSION INACTIVE; </action> and </control>
<control> 2) shall <action> request the SMF to perform a local release of all those PDU sessions associated with 3GPP access. </action> <control> <condition> If any of those PDU sessions is associated with one or more MBS sessions, </condition> the SMF shall <action> consider the UE as removed from the associated MBS sessions; and </action> </control> </control>
<control> <condition> b) For MA PDU sessions, </condition> the AMF shall: </control>
<control> <condition> <condition> 1) for MA PDU sessions having user plane resources established only on the 3GPP access in the AMF side, </condition> <condition> but are indicated by the UE in the PDU session status information element in the NOTIFICATION RESPONSE message as no user plane resources established on the 3GPP access: </condition> </condition> </control>
<control> <action> i) perform a local release of all those MA PDU sessions; and </action> </control>
<control> <action> ii) request the SMF to perform a local release of all those MA PDU sessions. </action> <control> <condition> If the MA PDU session is associated with one or more MBS sessions, </condition> the SMF shall <action> consider the UE as removed from the associated MBS sessions; and </action> </control> </control>
<control> <condition> 2) for MA PDU sessions having user plane resources established on both accesses in the AMF side, but are indicated by the UE in the PDU session status information element in the NOTIFICATION RESPONSE message as no user plane resources established on the 3GPP access: </condition> </control>
<control> <action> i) perform a local release of 3GPP access user plane resources of all those MA PDU sessions; </action> and </control>
<control> <action> ii) request the SMF to perform a local release of 3GPP access user plane resources of all those MA PDU sessions. </action> <control> <condition> If the MA PDU session is associated with one or more MBS sessions, </condition> the SMF shall <action> consider the UE as removed from the associated MBS sessions. </action> </control> </control>
5.6.3.4 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) Expiry of timer T3565. </condition> </control>
<control> The network shall, <condition> on the first expiry of the timer T3565, </condition> <action> retransmit the NOTIFICATION message </action> and shall <action> reset and start timer T3565. </action> </control> <control> This retransmission <action> is repeated four times, </action> <control> i.e. <condition> on the fifth expiry of timer T3565, </condition> the procedure shall <action> be aborted. </action> </control> </control> <control> In addition, <condition> upon the fifth expiry of timer T3565: </condition> </control>
<control> <condition> For case a) in subclause 5.6.3.1, </condition> the AMF should <action> notify the SMF that the UE is unreachable. </action> </control> <control> The AMF may <action> enter 5GMM-IDLE mode over 3GPP access. </action> </control>
<control> <condition> For case b) in subclause 5.6.3.1, </condition> the AMF may either: </control>
<control> <action> 1) perform the paging procedure over the 3GPP access; </action> or </control>
<control> <action> 2) notify the SMF that the UE is unreachable. </action> </control>
NOTE: Whether the AMF performs the paging procedure or notifies the SMF is up to operator's policies.
<control> <condition> b) De-registration procedure collision </condition> </control>
<control> <condition> <condition> If the network receives a DEREGISTRATION REQUEST message </condition> <condition> before it receives a SERVICE REQUEST message or REGISTRATION REQUEST message, </condition> </condition> the AMF shall <action> stop timer T3565 </action> and <action> proceed de-registration procedure as specified in subclause 5.5.2. </action> </control>
5.6.3.5 Abnormal cases on the UE side
The following abnormal cases can be identified:
<control> <condition> a) NOTIFICATION message received via non-3GPP access with access type indicating 3GPP access when UE- initiated 5GMM specific procedure or service request procedure over 3GPP access is ongoing. </condition> </control>
<control> The UE shall <action> proceed with 5GMM specific procedure or service request procedure. </action> </control> <control> <condition> If for these procedures lower layers indicate that the access attempt is barred, </condition> then the UE shall <action> handle the pending NOTIFICATION message as specified in subclause 5.6.3.2. </action> </control> <control> <condition> Otherwise, </condition> the UE shall <action> ignore the NOTIFICATION message once lower layers confirms the establishment of the signalling connection. </action> </control>
6 Elementary procedures for 5GS session management
6.1 Overview
6.1.1 General
This clause describes the procedures used for 5GS session management (5GSM) performed over an N1 NAS signalling
The main function of the 5GSM sublayer is to support the PDU session handling in the UE and in the SMF (transferred via the AMF).
The 5GSM comprises procedures for: a) the authentication and authorization, establishment, modification and release of PDU sessions; and b) request for performing handover of an existing PDU session between 3GPP access and non-3GPP access, or to transfer an existing PDN connection in the EPS to the 5GS.
<control> Each PDU session represents a PDU session established between the UE and an SMF. PDU sessions can remain established <condition> even if the radio and network resources constituting the corresponding PDU session between the UE and the SMF are temporarily released. </condition> </control>
<control> 5GSM procedures can be performed <condition> <condition> only if a 5GMM context has been established between the UE and the AMF, </condition> and <condition> the secure exchange of NAS messages has been initiated by the AMF by use of the 5GMM procedures described in clause 5. </condition> </condition> </control> <control> <condition> Once the UE is successfully registered to a PLMN, a PDU session can be established. </condition> </control> <control> <condition> If no 5GMM context has been established, </condition> the 5GMM sublayer has to initiate the establishment of a 5GMM context by use of the 5GMM procedures as described in clause 5. </control>
The UE can request the network to modify or release PDU sessions. The network can fulfil such a request from the UE by modifying a PDU session or releasing a PDU session using network-requested procedures (see subclause 6.3).
6.1.2 Types of 5GSM procedures
Three types of 5GSM procedures can be distinguished: a) Procedures related to PDU sessions: These procedures are initiated by the network and are used for authentication and authorization or manipulation of PDU sessions: 1) PDU authentication and authorization; 2) network-requested PDU session modification; and This procedure is initiated by the UE and to request for establishment of PDU sessions or to perform handover of an existing PDU session between 3GPP access and non-3GPP access, or to transfer an existing PDN connection in the EPS to the 5GS: UE-requested PDU session establishment.
b) Transaction related procedures: These procedures are initiated by the UE to request for handling of PDU sessions, i.e. to modify a PDU session, or to release a PDU session: 1) UE-requested PDU session modification; and This procedure is initiated by the 5G ProSe UE-to-network relay UE and is used for the manipulation of PDU sessions: a) remote UE report.
A successful transaction related procedure initiated by the UE triggers the network to execute one of the following procedures related to PDU session; network-requested PDU session modification procedure or network-requested PDU session release procedure. The UE treats the start of the procedure related to the PDU session as completion of the transaction related procedure.
The following 5GSM procedure can be related to a PDU session or to a procedure transaction:
6.1.3 5GSM sublayer states
6.1.3.1 General
In the following subclauses, the possible states of a PDU session in the UE and the network side are described.
6.1.3.2 5GSM sublayer states in the UE
6.1.3.2.1 Overview
In the following subclauses, the possible 5GSM sublayer states of the UE are described and shown in figure 6.1.3.2.1.1.
PDU SESSION
INACTIVE PENDING PDU SESSION ESTABLISHMENT REQUEST or PDU SESSION MODIFICATION COMPLETE or PDU SESSION MODIFICATION COMMAND REJECT including cause value /= 43 PDU SESSION RELEASE COMMAND or PDU SESSION MODIFICATION COMMAND REJECT PDU SESSION including cause value = 43 PDU SESSION ACTIVE INACTIVE PDU SESSION MODIFICATION PDU SESSION REJECT including cause value = 43 MODIFICATION REQUEST PDU SESSION MODIFICATION COMMAND or PDU SESSION MODIFICATION REJECT including cause value /= 43 PDU SESSION PDU SESSION MODIFICATION
ACTIVE PENDING PENDING NOTE 1: Not all possible transitions are shown in this figure.
NOTE 2: Some transitions shown in this figure are not applicable to the MA PDU session.
6.1.3.2.2 PDU SESSION INACTIVE
No PDU session exists.
6.1.3.2.3 PDU SESSION ACTIVE PENDING
The UE has initiated a PDU session establishment procedure towards the network and is waiting for a response from the network.
6.1.3.2.4 PDU SESSION ACTIVE
The PDU session is active in the UE.
6.1.3.2.5 PDU SESSION INACTIVE PENDING
The UE has initiated a PDU session release procedure towards the network and is waiting for a response from the network.
6.1.3.2.6 PDU SESSION MODIFICATION PENDING
The UE has initiated a PDU session modification procedure towards the network and is waiting for a response from the network.
6.1.3.2.7 PROCEDURE TRANSACTION INACTIVE
No procedure transaction exists.
6.1.3.2.8 PROCEDURE TRANSACTION PENDING
The UE has initiated a procedure transaction towards the network.
UE initiated 5GSM procedure request PROCEDURE TRANSACTION PROCEDURE TRANSACTION INACTIVE PENDING UE initiated 5GSM procedure reject by network
Or
Network initiated 5GSM procedure
6.1.3.3 5GSM sublayer states in the network side
6.1.3.3.1 Overview
In the following subclauses, the possible 5GSM sublayer states of the network are described and shown in PDU SESSION MODIFICATION PENDING PDU SESSION ESTABLISHMENT ACCEPT PDU SESSION PDU SESSION ACTIVE INACTIVE PDU SESSION MODIFICATION REJECT including cause value = 43 PDU SESSION ESTABLISHMENT REJECT PDU SESSION ESTABLISHMENT ACCEPT or PDU SESSION ESTABLISHMENT REJECT or PDU SESSION MODIFICATION REJECT including cause value /= 43 or PDU SESSION RELEASE REJECT PDU SESSION INACTIVE PENDING NOTE 1: Not all possible transitions are shown in this figure.
NOTE 2: Some transitions shown in this figure are not applicable to the MA PDU session.
6.1.3.3.2 PDU SESSION INACTIVE
No PDU session exists.
6.1.3.3.3 PDU SESSION ACTIVE
The PDU session is active in the network.
6.1.3.3.4 PDU SESSION INACTIVE PENDING
The network has initiated a PDU session release procedure towards the UE and is waiting for a response from the UE.
6.1.3.3.5 PDU SESSION MODIFICATION PENDING
The network has initiated a PDU session modification procedure towards the UE and is waiting for a response from the UE.
6.1.3.3.6 PROCEDURE TRANSACTION INACTIVE
No procedure transaction exists.
6.1.3.3.7 PROCEDURE TRANSACTION PENDING
The network has initiated a procedure transaction towards the UE.
network initiated 5GSM procedure command PROCEDURE TRANSACTION PROCEDURE TRANSACTION INACTIVE PENDING 5GSM procedure response by the UE
6.1.4 Coordination between 5GSM and ESM
> 6.1.4.1 Coordination between 5GSM and ESM with N26 interface
<control> Interworking with EPS is supported for a PDU session, <condition> <condition> <condition> if the PDU session includes the mapped EPS bearer context(s) </condition> or <condition> <condition> has association(s) between QoS flow and mapped EPS bearer </condition> <condition> after inter-system change from S1 mode to N1 mode. </condition> </condition> </condition> </condition> </control>
<control> <action> The SMF shall not include any mapped EPS bearer contexts associated with a PDU session for LADN and with a PDU session which is a multi-homed IPv6 PDU session. </action> See coding of the Mapped EPS bearer contexts IE in subclause 9.11.4.8. </control> <control> <condition> In an MA PDU session, </condition> <action> the UE shall have one set of the mapped EPS bearer contexts. </action> <control> <action> The network can provide the set of the mapped EPS bearer contexts of the MA PDU session via either access of the MA PDU session. </action> </control> <control> <condition> In an MA PDU session, </condition> <action> the UE shall support modification or deletion via an access of a mapped EPS bearer context of the MA PDU session created via the same or the other access. </action> </control> </control>
<control> <condition> Upon inter-system change from N1 mode to S1 mode, </condition> <action> the UE shall create the default EPS bearer context and the dedicated EPS bearer context(s) based on the parameters of the mapped EPS bearer contexts or the associations between QoS flow </action> and <action> mapped EPS bearer in the PDU session, </action> <condition> if available. </condition> </control> <control> <action> The EPS bearer identity assigned for the QoS flow of the default QoS rule becomes the EPS bearer identity of the default bearer </action> <condition> in the corresponding PDN connection. </condition> <control> <condition> <condition> If there is no EPS bearer identity assigned to the QoS flow of the default QoS rule of a PDU session associated with 3GPP access, </condition> or <condition> if there is no corresponding mapped EPS bearer contexts associated with the EPS bearer identity assigned to the QoS flow of the default QoS rule of a PDU session associated with 3GPP access: </condition> </condition> </control> </control>
<control> <condition> a) the PDU session is not an MA PDU session established over both 3GPP access and non-3GPP access, </condition> <action> the UE shall perform a local release of the PDU session; </action> </control> or
<control> <condition> b) the PDU session is an MA PDU session established over both 3GPP access and non-3GPP access, </condition> <action> the UE shall perform a local release of the PDU session over 3GPP access </action> and <action> consider that the MA PDU session is established over non-3GPP access only. </action> </control>
<control> <condition> <condition> <condition> <condition> If there is no EPS bearer identity assigned to the QoS flow(s) of a PDU session associated with 3GPP access </condition> <condition> which is not associated with the default QoS rule, </condition> </condition> or <condition> if there is no corresponding mapped EPS bearer contexts associated with the EPS bearer identity assigned to the QoS flow of the non-default QoS rule of a PDU session associated with 3GPP access, </condition> </condition> <condition> unless the PDU session is an MA PDU session established over 3GPP access and over non-3GPP access, </condition> </condition> <action> the UE shall locally delete the QoS rules and the QoS flow description(s). </action> </control> <control> <action> The UE uses the parameters from each PDU session for which interworking with EPS is supported to create corresponding default EPS bearer context and optionally dedicated EPS bearer context(s) as follows: </action> </control>
<control> a) <action> the PDU session type of the PDU session shall be mapped to the PDN type of the default EPS bearer context as follows: </action> </control>
<control> 1) <action> the PDN type shall be set to "non-IP" </action> <condition> if the PDU session type is "Unstructured"; </condition> </control> <control> 2) <action> the PDN type shall be set to "IPv4" </action> <condition> if the PDU session type is "IPv4"; </condition> </control> <control> 3) <action> the PDN type shall be set to "IPv6" </action> <condition> if the PDU session type is "IPv6"; </condition> </control> <control> 4) <action> the PDN type shall be set to "IPv4v6" </action> <condition> if the PDU session type is "IPv4v6"; </condition> </control> <control> 5) <action> the PDN type shall be set to "non-IP" </action> <condition> <condition> if the PDU session type is "Ethernet", </condition> and <condition> the UE and the network or both of them do not support Ethernet PDN type in S1 mode; </condition> </condition> </control> and <control> 6) <action> the PDN type shall be set to "Ethernet" </action> <condition> <condition> if the PDU session type is "Ethernet" </condition> and <condition> the UE and the network support Ethernet PDN type in S1 mode; </condition> </condition> </control> <control> b) <action> the PDU address of the PDU session shall be mapped to the PDN address of the default EPS bearer context as follows: </action> </control>
<control> 1) <action> the PDN address of the default EPS bearer context is set to the PDU address of the PDU session, </action> <condition> if the PDU session type is "IPv4", "IPv6" or "IPv4v6"; </condition> </control> and <control> 2) <action> the PDN address of the default EPS bearer context is set to zero, </action> , <condition> if the PDU session type is "Ethernet" or "Unstructured"; </condition> </control>
<control> c) <action> the DNN of the PDU session shall be mapped to the APN of the default EPS bearer context, </action> <condition> unless the PDU session is an emergency PDU session; </condition> </control> <control> d) <action> <condition> the APN-AMBR and extended APN-AMBR received in the parameters of the default EPS bearer context of the mapped EPS bearer contexts </condition> shall be mapped to the APN-AMBR and extended APN-AMBR of the default EPS bearer context; </action> </control> <control> e) for each PDU session <start_state> in state PDU SESSION ACTIVE, </start_state> <start_state> PDU SESSION MODIFICATION PENDING </start_state> or <start_state> PDU SESSION INACTIVE PENDING: </start_state> </control>
<control> 1) <condition> if the UE is performing an inter-system change from N1 mode to WB-S1 mode, </condition> <action> the UE shall set the state of the mapped EPS bearer context(s) to BEARER CONTEXT ACTIVE; </action> </control> or <control> 2) <condition> <condition> if the UE is performing an inter-system change from N1 mode to NB-S1 mode, </condition> <condition> for the mapped EPS bearer context corresponding to the default EPS bearer, </condition> </condition> <action> the UE shall set the state of the mapped EPS bearer context to BEARER CONTEXT ACTIVE. </action> </control>
<control> Additionally, <condition> <condition> if the UE is performing an inter-system change from WB- N1 mode to NB-S1 mode, </condition> <condition> for the mapped EPS bearer context corresponding to a dedicated EPS bearer, </condition> <condition> if any, </condition> </condition> <action> the UE shall set the state of the mapped EPS bearer context to BEARER CONTEXT INACTIVE; </action> </control>
<control> <condition> f) for any other PDU session </condition> <action> the UE shall set the state of the mapped EPS bearer context(s) to BEARER CONTEXT INACTIVE. </action> </control>
<control> additionally, <condition> for each mapped EPS bearer context or the association between QoS flow and mapped EPS bearer in the PDU session: </condition> </control>
<control> a) <action> the EPS bearer identity shall be set to the EPS bearer identity <condition> received in the mapped EPS bearer context, </condition> or the EPS bearer identity associated with the QoS flow; </action> </control> <control> b) <action> the EPS QoS parameters shall be set to the mapped EPS QoS parameters of the EPS bearer <condition> received in the mapped EPS bearer context, </condition> or the EPS QoS parameters associated with the QoS flow; </action> </control> <control> c) <action> the extended EPS QoS parameters shall be set to the mapped extended EPS QoS parameters of the EPS bearer <condition> received in the mapped EPS bearer context, </condition> or the extended EPS QoS parameters associated with the QoS flow; </action> </control> and <control> d) <action> the traffic flow template shall be set to the mapped traffic flow template of the EPS bearer <condition> received in the mapped EPS bearer context, </condition> or the stored traffic flow template associated with the QoS flow, </action> <condition> if available. </condition> </control>
<control> <condition> After inter-system change from N1 mode to S1 mode, </condition> <action> the UE shall associate the PDU session identity, the S-NSSAI, and the session-AMBR with the default EPS bearer context, </action> and <condition> for each EPS bearer context mapped from one or more QoS flows, </condition> <action> associate the QoS rule(s) for the QoS flow(s) and the QoS flow description(s) for the QoS flow(s) with the EPS bearer context. </action> </control>
<control> <condition> <condition> If the PDU session is associated with the control plane only indication and supports interworking with EPS, </condition> <condition> after inter-system change from N1 mode to S1 mode, </condition> </condition> <action> the UE shall associate the EPS bearer context(s) of the PDN connection corresponding to the PDU session with the control plane only indication. </action> </control>
<control> <condition> <condition> If the PDU session is associated with a PDU session pair ID, </condition> <condition> after inter-system change from N1 mode to S1 mode, </condition> </condition> <action> the UE shall associate the default EPS bearer context of the PDN connection corresponding to the PDU session with the PDU session pair ID. </action> </control> <control> <condition> <condition> If the PDU session is associated with an RSN, </condition> <condition> after inter-system change from N1 mode to S1 mode, </condition> </condition> <action> the UE shall associate the default EPS bearer context of the PDN connection corresponding to the PDU session with the RSN. </action> </control>
<control> <condition> After inter-system change from N1 mode to S1 mode, </condition> <action> the UE </action> and <action> the SMF shall maintain the PDU session type of the PDU session </action> <condition> <condition> until the PDN connection corresponding to the PDU session is released </condition> <condition> if the UE supports non-IP PDN type and the PDU session type is "Ethernet" or "Unstructured". </condition> </condition> </control>
<control> <condition> After inter-system change from N1 mode to S1 mode, </condition> <action> the UE and the SMF shall maintain the following 5GSM attributions and capabilities associated with the PDU session </action> <condition> until the PDN connection corresponding to the PDU session is released: </condition> </control>
<control> <condition> a) the always-on PDU session indication; </condition> </control> <control> <condition> b) the maximum number of supported packet filters; </condition> </control> <control> <condition> c) the support of reflective QoS; </condition> </control> <control> <condition> d) <condition> the maximum data rate per UE for user-plane integrity protection supported by the UE for uplink </condition> and <condition> the maximum data rate per UE for user-plane integrity protection supported by the UE for downlink; </condition> </condition> </control>
<control> <condition> f) if the PDU session is an MA PDU session established over 3GPP access, </condition> <action> the PDN connection of the default EPS bearer corresponding to the MA PDU session shall be considered as a user-plane resource of the MA PDU </action> </control>
<control> <condition> After inter-system change from N1 mode to S1 mode, </condition> <action> the UE operating in single-registration mode in a network supporting N26 interface shall deem that the following features are supported by the network on the PDN connection corresponding to the PDU session: </action> </control>
<control> <condition> a) PS data off; </condition> </control> and <control> <condition> b) Local address in TFT. </condition> </control>
<control> <condition> <condition> If there is a QoS flow used for IMS signalling, </condition> <condition> after inter-system change from N1 mode to S1 mode, </condition> </condition> <action> the EPS bearer associated with the QoS flow for IMS signalling becomes the EPS bearer for IMS signalling. </action> </control>
<control> <condition> When the UE is provided with a new session-AMBR in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, </condition> <action> the UE shall discard the corresponding association(s) and associate the new value(s) with the EPS bearer context. </action> </control>
<control> <action> The network may provide the UE with one or more QoS rules </action> <action> by including either one QoS rules parameter, or one QoS rules with the length of two octets parameter, </action> <condition> <condition> but not both, </condition> <condition> in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message. </condition> </condition> </control> <control> <action> The network may provide the UE with one or more QoS flow descriptions corresponding to the EPS bearer context being modified, </action> <action> by including either one QoS flow descriptions parameter, or one QoS flow descriptions with the length of two octets parameter, </action> <condition> <condition> but not both, </condition> <condition> > in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message. </condition> </condition> </control>
<control> <condition> <condition> When the UE is provided with one or more QoS flow descriptions </condition> or <condition> the EPS bearer identity of an existing QoS flow description is modified in the Protocol configuration options IE </condition> or <condition> Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, </condition> </condition> <action> the UE shall check the EPS bearer identity included in the QoS flow description; </action> and: </control>
<control> <condition> a) <condition> if the EPS bearer identity corresponds to the EPS bearer context being modified </condition> or <condition> the EPS bearer identity is not included, </condition> </condition> <action> the UE shall store the QoS flow description and all the associated QoS rules, </action> <condition> <condition> if any, </condition> <condition> for the EPS bearer context being modified for use during inter-system change from S1 mode to N1 mode; </condition> </condition> </control> and <control> <condition> b) otherwise </condition> <action> the UE shall locally delete the QoS flow description and all the associated QoS rules, </action> <condition> if any, </condition> and <action> include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 "syntactical error in the QoS operation" in the MODIFY EPS BEARER CONTEXT ACCEPT message. </action> </control>
<control> <condition> <condition> When the UE is provided with one or more QoS rules, </condition> or <condition> one or more QoS flow descriptions in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, </condition> </condition> <action> the UE shall process the QoS rules sequentially starting with the first QoS rule </action> and <action> shall process the QoS flow descriptions sequentially starting with the first QoS flow description. </action> </control> <control> <action> The UE shall check the QoS rules and QoS flow descriptions for different types of errors as follows: </action> </control>
NOTE 1: <control> <condition> <condition> If an error is detected in a QoS rule or a QoS flow description </condition> <condition> which requires sending a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause value, </condition> </condition> <action> then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message are discarded, </action> <condition> if any. </condition> </control>
NOTE 2: <control> <condition> If the EPS bearer context modification procedure is rejected, </condition> <action> then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE </action> or </control>
<control> <action> Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message are discarded, </action> <condition> if any. </condition> </control>
<control> <condition> a) Semantic errors in QoS operations: </condition> </control>
<control> 1) <condition> <condition> When the rule operation is "Modify existing QoS rule and add packet filters", "Modify existing QoS rule and replace all packet filters", "Modify existing QoS rule and delete packet filters" or "Modify existing QoS rule without modifying packet filters" on the default QoS rule </condition> and <condition> the DQR bit is set to "the QoS rule is not the default QoS rule". </condition> </condition> </control> <control> 2) <condition> <condition> When the rule operation is "Modify existing QoS rule and add packet filters", "Modify existing QoS rule and replace all packet filters", "Modify existing QoS rule and delete packet filters" or "Modify existing QoS rule without modifying packet filters" on a QoS rule </condition> <condition> which is not the default QoS rule and the DQR bit is set to "the QoS rule is the default QoS rule". </condition> </condition> </control> <control> 3) <condition> <condition> When the rule operation is "Create new QoS rule" </condition> and <condition> <condition> the DQR bit is set to "the QoS rule is the default QoS rule" </condition> <condition> when there's already a default QoS rule with different QoS rule identifier. </condition> </condition> </condition> </control> <control> 4) <condition> When the rule operation is "Delete existing QoS rule" on the default QoS rule. </condition> </control> <control> 5) <condition> When the rule operation is "Create new QoS rule", "Modify existing QoS rule and add packet filters", "Modify existing QoS rule and replace all packet filters", "Modify existing QoS rule and delete packet filters", or "Modify existing QoS rule without modifying packet filters" </condition> and <action> two or more QoS rules associated with this PDU session would have identical precedence values. </action> </control> <control> 6) <condition> When the rule operation is "Modify existing QoS rule and delete packet filters", </condition> <condition> <condition> the QoS rule is a QoS rule of a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, </condition> and <condition> the packet filter list in the resultant QoS rule is empty. </condition> </condition> </control> <control> 7) <condition> <condition> When the rule operation is "Create new QoS rule", </condition> and <condition> there is already an existing QoS rule with the same QoS rule identifier </condition> and <condition> <condition> the existing QoS rule is associated with a QoS flow description stored for the EPS bearer context being modified </condition> or <condition> the existing QoS rule is not associated with any QoS flow description. </condition> </condition> </condition> </control> <control> 8) <condition> When the rule operation is "Modify existing QoS rule and add packet filters", "Modify existing QoS rule and replace all packet filters", "Modify existing QoS rule and delete packet filters", or "Modify existing QoS rule without modifying packet filters" </condition> and <condition> there is no existing QoS rule with the same QoS rule identifier associated with a QoS flow description stored for the EPS bearer context being modified. </condition> </control> <control> 9) <condition> <condition> When the rule operation is "Delete existing QoS rule" </condition> and <condition> there is no existing QoS rule with the same QoS rule identifier associated with a QoS flow description stored for the EPS bearer context being modified. </condition> </condition> </control> <control> 10) <condition> When the flow description operation is "Create new QoS flow description" </condition> and <condition> there is already an existing QoS flow description with the same QoS flow identifier stored for the EPS bearer context being modified. </condition> </control> <control> 11) <condition> <condition> When the flow description operation is "Modify existing QoS flow description" </condition> and <condition> there is no existing QoS flow description with the same QoS flow identifier stored for the EPS bearer context being modified. </condition> </condition> </control> <control> 12) <condition> <condition> When the flow description operation is "Delete existing QoS flow description" </condition> and <condition> there is no existing QoS flow description with the same QoS flow identifier stored for the EPS bearer context being modified. </condition> </condition> </control> <control> 13) <condition> When the UE determines that: <condition> </condition> </condition> </control>
<control> <condition> i) <condition> the default EPS bearer context is associated with one or more QoS flows </condition> <condition> but the default EPS bearer context is not associated with the default QoS rule. </condition> </condition> </control> <control> ii) <condition> <condition> a dedicated EPS bearer context is associated with one or more QoS flows </condition> <condition> but the dedicated EPS bearer context is associated with the default QoS rule. </condition> </condition> </control>
<control> 14) <condition> <condition> When the rule operation is "Create new QoS rule" </condition> and <condition> there is already an existing QoS rule with the same QoS rule identifier associated with a QoS flow description stored for an EPS bearer context different from the EPS bearer context being modified </condition> and <condition> belonging to the same PDN connection as the EPS bearer context being modified. </condition> </condition> </control> <control> 15) <condition> <condition> When the flow description operation is "Create new QoS flow description", </condition> and <condition> there is already an existing QoS flow description with the same QoS flow identifier stored for an EPS bearer context different from the EPS bearer context being modified </condition> and <condition> belonging to the same PDN connection as the EPS bearer context being modified. </condition> </condition> </control> <control> 16) <condition> <condition> When the rule operation is "Create new QoS rule", "Modify existing QoS rule and add packet filters", "Modify existing QoS rule and replace all packet filters", "Modify existing QoS rule and delete packet filters", or "Modify existing QoS rule without modifying packet filters" </condition> and <condition> the resultant QoS rule is associated with a QoS flow description stored for an EPS bearer context different from the EPS bearer context being modified. </condition> </condition> </control> <control> 17) <condition> <condition> When the rule operation is "Create new QoS rule", </condition> <condition> the DQR bit is set to "the QoS rule is not the default QoS rule", </condition> <condition> the QoS rule is provided for a PDN connection of PDN type "non-IP" </condition> and <condition> there is locally available information associated with the PDN connection that is set to "Unstructured". </condition> </condition> </control> <control> 18) <condition> <condition> When the flow description operation is "Create new QoS flow description" or "Modify existing QoS flow description", </condition> <condition> the QFI associated with the QoS flow description is not the same as the QFI of the default QoS rule, </condition> <condition> the QoS flow description is provided for a PDN connection of PDN type "non-IP" </condition> and <condition> there is locally available information associated with the PDN connection that is set to "Unstructured". </condition> </condition> </control>
<control> <condition> <condition> In case 5, </condition> <condition > if the old QoS rule (i.e. the QoS rule that existed before the MODIFY EPS BEARER CONTEXT REQUEST message was received) is not the default QoS rule </condition> and <condition> the old QoS rule is associated with a QoS flow description stored for the EPS bearer context being modified, </condition> </condition> <action> the UE shall not diagnose an error, </action> <action> shall further process the new request </action> and, <condition> if it was processed successfully, </condition> <action> shall delete the old QoS rule which has identical precedence value. </action> <control> <condition> Otherwise, </condition> <action> the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 "semantic error in the QoS operation" in the MODIFY EPS BEARER CONTEXT ACCEPT message. </action> </control> </control>
<control> <condition> <condition> In case 6, </condition> <condition> if the QoS rule is not the default QoS rule, </condition> </condition> <action> the UE shall delete the QoS rule. If the QoS rule is the default QoS rule, </action> <action> the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 "semantic error in the QoS operation" in the MODIFY EPS BEARER CONTEXT ACCEPT message. </action> </control>
<control> <condition> <condition> In case 7, </condition> <condition> <condition> if the existing QoS rule is not the default QoS rule </condition> and <condition> the DQR bit of the new QoS rule is set to "the QoS rule is not the default QoS rule", </condition> </condition> </condition> <action> the UE shall not diagnose an error, </action> <action> further process the create request </action> and, <condition> if it was processed successfully, </condition> <action> delete the old QoS rule (i.e. the QoS rule that existed before the MODIFY EPS BEARER CONTEXT REQUEST message was received). </action> <control> <condition> <condition> If the existing QoS rule is the default QoS rule </condition> or <condition> the DQR bit of the new QoS rule is set to "the QoS rule is the default QoS rule", </condition> </condition> <action> the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 "semantic error in the QoS operation" in the MODIFY EPS BEARER CONTEXT ACCEPT </action> </control> </control>
<control> <condition> In case 9, </condition> <action> the UE shall not diagnose an error, </action> <action> further process the delete request </action> and, <condition> if it was processed successfully, </condition> <action> consider the respective QoS rule as successfully deleted. </action> </control>
<control> <condition> In case 10, </condition> <action> the UE shall not diagnose an error, </action> <action> further process the create request </action> and, <condition> if it was processed successfully, </condition> <action> delete the old QoS flow description (i.e. the QoS flow description that existed before the MODIFY EPS BEARER CONTEXT REQUEST message was received). </action> </control>
<control> <condition> In case 12, </condition> <action> the UE shall not diagnose an error, </action> <action> further process the delete request </action> and, <condition> if it was processed successfully, </condition> <action> consider the respective QoS flow description as successfully deleted. </action> </control>
<control> <condition> Otherwise, </condition> <action> the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 "semantic error in the QoS operation" in the MODIFY EPS BEARER CONTEXT ACCEPT message. </action> </control>
<control> <condition> b) Syntactical errors in QoS operations: </condition> </control>
<control> 1) <condition> <condition> When the rule operation is "Create new QoS rule", "Modify existing QoS rule and add packet filters", "Modify existing QoS rule and replace all packet filters" or "Modify existing QoS rule and delete packet filters", </condition> <condition> the packet filter list in the QoS rule is empty, </condition> and <condition> <condition> the QoS rule is provided for a PDN connection of PDN type IPv4, IPv6, IPv4v6 or Ethernet, or for a PDN connection of PDN type "non-IP" </condition> and <condition> there is locally available information associated with the PDN connection that is set to "Ethernet". </condition> </condition> </condition> </control> <control> 2) <condition> <condition> When the rule operation is "Delete existing QoS rule" or "Modify existing QoS rule without modifying packet filters" </condition> <condition> with a non-empty packet filter list in the QoS rule. </condition> </condition> </control> <control> 3) <condition> <condition> When the rule operation is "Modify existing QoS rule and delete packet filters" </condition> and <condition> the packet filter to be deleted does not exist in the original QoS rule. </condition> </condition> </control> <control> 4) <condition> Void. </condition> </control> <control> 5) <condition> <condition> When there are other types of syntactical errors in the coding of the QoS rules parameter, </condition> <condition> the QoS rules with the length of two octets parameter, </condition> <condition> the QoS flow descriptions parameter or the QoS flow descriptions with the length of two octets parameter, </condition> such as a mismatch between the number of packet filters subfield, and <condition> the number of packet filters in the packet filter list when the rule operation is "delete existing QoS rule" or "create new QoS rule", </condition> or <condition> the number of packet filters subfield is larger than the maximum possible number of packet filters in the packet filter list (i.e., there is no QoS rule precedence subfield included in the QoS rule IE), the QoS Rule Identifier is set to "no QoS rule identifier assigned", or the QoS flow identifier is set to "no QoS flow identifier assigned". </condition> </condition> </control> <control> 6) <condition> When, <control> <condition> the <condition> a) rule operation is "Create new QoS rule", "Modify existing QoS rule and add packet filters", "Modify existing QoS rule and replace all packet filters", "Modify existing QoS rule and delete packet filters" or "Modify existing QoS rule without modifying packet filters", </condition> <condition> the UE determines, </condition> <condition> by using the QoS rules QFI as the 5QI, that there is a resulting QoS rule for a GBR QoS flow (as described in 3GPP TS 23.501 table 5.7.4-1), </condition> and <condition> there is no QoS flow description with a QFI corresponding to the QFI of the resulting QoS rule. </condition> </condition> </control> <control> <condition> b) <condition> flow description operation is "Delete existing QoS flow description", </condition> and <condition> the UE determines, </condition> <condition> by using the QoS rules QFI as the 5QI, that there is a resulting QoS rule for a GBR QoS flow (as described in 3GPP TS 23.501 table 5.7.4-1) with a QFI corresponding to the QFI of the QoS flow description that is deleted (i.e. there is no associated QoS flow description with the same QFI). </condition> </condition> </control> </condition> </control> <control> 7) <condition> <condition> When the flow description operation is "Create new QoS flow description" or "Modify existing QoS flow description", </condition> and <condition> the UE determines that there is a QoS flow description of a GBR QoS flow (as described in 3GPP TS 23.501 table 5.7.4-1) </condition> <condition> which lacks at least one of the mandatory parameters (i.e., GFBR uplink, GFBR downlink, MFBR uplink and MFBR downlink). </condition> </condition> <control> <condition> If the QoS flow description does not include a 5QI, </condition> <action> the UE determines this by using the QFI as the 5QI. </action> </control> </control>
<control> <condition> In case 3 </condition> <action> the UE shall not diagnose an error, </action> <action> further process the deletion request </action> and, <condition> if no error according to items c and d was detected, </condition> <action> consider the respective packet filter as successfully deleted. </action> </control>
<control> <condition> Otherwise </condition> <action> the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 "syntactical error in the QoS operation" in the MODIFY EPS BEARER CONTEXT ACCEPT message. </action> </control>
NOTE 3: <control> It is not considered an error if the UE determines that <condition> after processing all QoS operations on QoS rules and QoS flow descriptions </condition> there is a QoS flow description that is not associated with any QoS rule and the UE is not in NB-N1 mode. </control>
<control> <condition> c) Semantic errors in packet filters: </condition> </control>
<control> 1) <condition> <condition> When a packet filter consists of conflicting packet filter components <condition> which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. </condition> </condition> </condition> </control> How the UE determines a semantic error in a packet filter is outside the scope of the present document.
<control> <action> The UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #44 "semantic errors in packet filter(s)" in the MODIFY EPS BEARER CONTEXT ACCEPT message. </action> </control> <control> <condition> d) Syntactical errors in packet filters: </condition> </control>
<control> 1) <condition> When the rule operation is "Modify existing QoS rule and add packet filters" or "Modify existing QoS rule and replace all packet filters", </condition> and <action> two or more packet filters in the resultant QoS rule would have identical packet filter identifiers. </action> </control> <control> 2) <condition> When the rule operation is "Create new QoS rule", </condition> and <action> two or more packet filters in the resultant QoS rule would have identical packet filter identifiers. </action> </control> <control> 3) <condition> When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier. </condition> </control> <control> 4) <condition> <condition> When the rule operation is "Create new QoS rule", "Modify existing QoS rule and add packet filters" or "Modify existing QoS rule and replace all packet filters" with a non-empty packet filter list in the QoS rule, </condition> and <condition> the DQR bit is set to "the QoS rule is the default QoS rule", </condition> <condition> the QoS rule is provided for a PDN connection of PDN type "non-IP" </condition> and <condition> there is locally available information associated with the PDN connection that is set to "Unstructured". </condition> </condition> </control>
<control> <condition> <condition> In case 1, </condition> <condition> if two or more packet filters with identical packet filter identifiers are contained in the MODIFY EPS BEARER CONTEXT REQUEST message, </condition> </condition> <action> the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #45 "syntactical error in packet filter(s)" in the MODIFY EPS BEARER CONTEXT ACCEPT message. </action> <condition> Otherwise, </condition> <action> the UE shall not diagnose an error, </action> <action> further process the MODIFY EPS BEARER CONTEXT REQUEST message </action> and, <condition> if it was processed successfully, </condition> <action> delete the old packet filters <condition> which have the identical packet filter identifiers. </condition> </action> </control>
<control> <condition> Otherwise </condition> <action> the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #45 "syntactical error in packet filter(s)" in the MODIFY EPS BEARER CONTEXT ACCEPT message. </action> <control> <condition> <condition> If the UE detects different errors in the QoS rules </condition> and <condition> <condition> QoS flow descriptions as described in this subclause </condition> <condition> which requires sending a 5GSM cause parameter in the MODIFY EPS BEARER CONTEXT ACCEPT message, </condition> </condition> </condition> <action> the UE shall include a single 5GSM cause parameter in the MODIFY EPS BEARER CONTEXT ACCEPT message. </action> </control> </control>
NOTE 4: The 5GSM cause to use cannot be different from #44 "semantic error in packet filter(s)", #45 "syntactical errors in packet filter(s)", #83 "semantic error in the QoS operation" or #84 "syntactical error in the QoS operation". The selection of a 5GSM cause is up to UE implementation.
<control> <condition> <condition> Upon successful completion of an EPS attach procedure or tracking area updating procedure </condition> <condition> after inter-system change from N1 mode to S1 mode (see 3GPP TS 24.301 ), </condition> <condition> unless the PDU session is an MA PDU session established over 3GPP access and over non-3GPP access, </condition> </condition> </control>
<control> a) <action> the UE shall delete any UE derived QoS rules of each PDU session </action> <condition> which has been transferred to EPS; </condition> </control> <control> b) <action> the UE and the SMF shall perform a local release of the PDU session(s) associated with 3GPP access </action> <condition> which have not been transferred to EPS; </condition> </control> and <control> c) <action> the UE and the SMF shall perform a local release of QoS flow(s) </action> <condition> <condition> which have not been transferred to EPS, </condition> <condition> of the PDU session(s) which have been transferred to EPS. </condition> </condition> <control> <action> The UE and the SMF shall also perform a local release of any QoS flow description not associated with any QoS rule and not associated with any mapped EPS bearer context. </action> <control> <condition> <condition> If there is a QoS flow description not associated with any QoS rule, </condition> <condition> but associated with a mapped EPS bearer context, </condition> and <condition> after the inter-system change from N1 mode to S1 mode the respective EPS bearer context is active, </condition> </condition> <action> then the UE shall associate the QoS flow description with the EPS bearer context. </action> </control> </control> </control>
<control> <condition> <condition> For PDU session(s) associated with non-3GPP access in 5GS, </condition> <condition> if present, </condition> the UE may: </condition> </control>
<control> a) <action> keep some or all of these PDU sessions still associated with non-3GPP access in 5GS, </action> <condition> if supported; </condition> </control> <control> b) <action> release some or all of these PDU sessions explicitly by initiating the UE requested PDU session release procedure(s); </action> </control> or <control> c) <action> attempt to transfer some or all of these PDU sessions from N1 mode to S1 mode </action> <action> by initiating the UE requested PDN connectivity procedure(s) with the PDN CONNECTIVITY REQUEST message created as follows: </action> </control> <control> 1) <condition> if the PDU session is an emergency PDU session, </condition> <action> the request type shall be set to "handover of emergency bearer services". </action> </control> <control> <condition> Otherwise </condition> <action> the request type shall be set to "handover"; </action> </control> <control> 2) <action> the PDU session type of the PDU session shall be mapped to the PDN type of the default EPS bearer context as follows: </action> </control>
<control> i) <action> the PDN type shall be set to "non-IP" </action> <condition> if the PDU session type is "Unstructured"; </condition> </control> <control> ii) <action> the PDN type shall be set to "IPv4" </action> <condition> if the PDU session type is "IPv4"; </condition> </control> <control> iii) <action> the PDN type shall be set to "IPv6" </action> <condition> if the PDU session type is "IPv6"; </condition> </control> <control> iv) <action> the PDN type shall be set to "IPv4v6" </action> <condition> if the PDU session type is "IPv4v6"; </condition> </control> <control> v) <action> the PDN type shall be set to "non-IP" </action> <condition> <condition> if the PDU session type is "Ethernet" </condition> and <condition> the UE, the network or both of them do not support Ethernet PDN type in S1 mode; </condition> </condition> </control> and <control> vi) <action> the PDN type shall be set to "Ethernet" </action> <condition> <condition> if the PDU session type is "Ethernet" </condition> and <condition> the UE and the network support Ethernet PDN type in S1 mode; </condition> </condition> </control> <control> 3) <action> the DNN of the PDU session shall be mapped to the APN of the default EPS bearer context, </action> <condition> unless the PDN connection is an emergency PDN connection; </condition> </control> and <control> 4) <action> the PDU session ID parameter in the Protocol configuration options IE or the Extended protocol configuration options IE shall be set to the PDU session identity of the PDU session. </action> <control> <condition> If a PDU session associated with non-3GPP access is transferred to EPS, </condition> <action> the UE shall associate the PDU session identity with the default EPS bearer context </action> and <action> shall delete any UE derived QoS rules of such PDU session. </action> </control> </control>
Interworking to 5GS is supported for a PDN connection, if the corresponding default EPS bearer context includes a PDU session identity, an S-NSSAI, if the PDN connection is a non-emergency PDN connection, session AMBR and one or more QoS flow descriptions received in the Protocol configuration options IE or Extended protocol configuration options IE (see 3GPP TS 24.301 ), or the default EPS bearer context has association with the PDU session identity, the S-NSSAI, if the PDU session is a non-emergency PDU session, the session-AMBR and one or more QoS flow descriptions after inter-system change from N1 mode to S1 mode.
<control> <condition> <condition> For a PDN connection established in S1 mode, </condition> <condition> to enable the UE to attempt to transfer the PDN connection from S1 mode to N1 mode </condition> <condition> in case of inter-system change, </condition> </condition> <action> the UE shall allocate a PDU session identity, </action> <action> indicate the allocated PDU session identity in the PDU session ID parameter in the Protocol configuration options IE of the PDN CONNECTIVITY REQUEST message </action> and <action> associate the allocated PDU session identity with the default EPS bearer context of the PDN connection. </action> <control> <condition> <condition> If an N5CW device supports 3GPP access </condition> and <condition> establishes a new PDN connection in S1 mode, </condition> </condition> <action> the N5CW device shall refrain from allocating "PDU session identity value 15". </action> </control> </control>
<control> <condition> For a PDN connection established in S1 mode, </condition> <action> the SMF assigning the QoS rules shall consider that the UE supports 16 packet filters for the corresponding PDU session </action> <condition> until the UE indicates a higher number (as specified in subclause 6.4.2.2). </condition> </control>
<control> <action> The network may provide the UE with one or more QoS rules </action> <action> by including either one QoS rules parameter, or one QoS rules with the length of two octets parameter, </action> <condition> <condition> but not both, </condition> <condition> <condition> in the Protocol configuration options IE </condition> or <condition> Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST </condition> or <condition> ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. </condition> </condition> </condition> <control> <action> The network may provide the UE with one or more QoS flow descriptions corresponding to the EPS bearer context being activated, by including either one QoS flow descriptions parameter, or one QoS flow descriptions with the length of two octets parameter, </action> <condition> <condition> but not both, </condition> <condition> <condition> in the Protocol configuration options IE </condition> or <condition> Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST </condition> or <condition> ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. </condition> </condition> </condition> </control> </control>
<control> <condition> <condition> When the UE is provided with one or more QoS flow descriptions in the Protocol configuration options IE </condition> or <condition> Extended protocol configuration options IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST </condition> or <condition> ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> </condition> <action> the UE shall check the EPS bearer identity included in the QoS flow description; </action> and: </control>
<control> <condition> a) <condition> if the EPS bearer identity corresponds to the EPS bearer context being activated </condition> or <condition> the EPS bearer identity is not included, </condition> </condition> <action> the UE shall store the QoS flow description and all the associated QoS rules, </action> <condition> <condition> if any, </condition> <condition> for the EPS bearer context being activated for use during inter-system change from S1 mode to N1 mode; </condition> </condition> </control> and <control> <condition> b) otherwise </condition> <action> the UE shall locally delete the QoS flow description and all the associated QoS rules, </action> <condition> if any, </condition> and <action> include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 "syntactical error in the QoS operation" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. </action> </control>
<control> <condition> <condition> When the UE is provided with one or more QoS rules, </condition> or <condition> one or more QoS flow descriptions in the Protocol configuration options IE </condition> or <condition> Extended protocol configuration options IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST </condition> or <condition> ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> </condition> <action> the UE shall process the QoS rules sequentially starting with the first QoS rule </action> and <action> shall process the QoS flow descriptions sequentially starting with the first QoS flow description. </action> <control> <action> The UE shall check QoS rules and QoS flow descriptions for different types of errors as follows: </action> </control> </control>
NOTE 5: <control> <condition> If an error is detected in a QoS rule or a QoS flow description which requires sending a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause value, </condition> <action> then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message are discarded, </action> <condition> if any. </condition> </control>
NOTE 6: <control> <condition> <condition> If the default EPS bearer context activation procedure </condition> or <condition> the dedicated EPS bearer context activation procedure is rejected, </condition> </condition> <action> then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message are discarded, </action> <condition> if any. </condition> </control>
<control> <condition> a) Semantic errors in QoS operations: </condition> </control>
<control> 1) <condition> <condition> When the rule operation is "Create new QoS rule" </condition> and <condition> <condition> the DQR bit is set to "the QoS rule is the default QoS rule" </condition> <condition> when there's already a default QoS rule. </condition> </condition> </condition> </control> <control> 2) <condition> <condition> When the rule operation is received in an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> <condition> the rule operation is "Create new QoS rule", </condition> and <condition> there is no rule with the DQR bit set to "the QoS rule is the default QoS rule". </condition> </condition> </control> <control> 3) <condition> <condition> When the rule operation is "Create new QoS rule" </condition> and <condition> two or more QoS rules associated with this PDU session would have identical precedence values. </condition> </condition> </control> <control> 4) <condition> When the rule operation is an operation other than "Create new QoS rule". </condition> </control> <control> 5) <condition> When the flow description operation is an operation other than "Create new QoS flow description". </condition> </control> <control> 6) <condition> When the UE determines that: <control> <condition> i) <condition> the default EPS bearer context is associated with one or more QoS flows </condition> <condition> but the default EPS bearer context is not associated with the default QoS rules. </condition> </condition> </control> <control> ii) <condition> <condition> a dedicated EPS bearer context is associated with one or more QoS flows </condition> <condition> but the dedicated EPS bearer context is associated with the default QoS rule. </condition> </condition> </control> </condition> </control> <control> 7) <condition> <condition> When the flow description operation is received in an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> <condition> the flow description operation is "Create new QoS flow description" </condition> and <condition> there is already an existing QoS flow description with the same QoS flow identifier stored for an EPS bearer context different from the EPS bearer context being activated </condition> and <condition> belonging to the same PDN connection as the EPS bearer context being activated. </condition> </condition> </control> <control> 8) <condition> <condition> When the rule operation is received in an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> <condition> the rule operation is "Create new QoS rule" and there is already an existing QoS rule with the same QoS rule identifier stored for an EPS bearer context different from the EPS bearer context being activated </condition> and <condition> belonging to the same PDN connection as the EPS bearer context being activated. </condition> </condition> </control> <control> 9) <condition> <condition> When the rule operation is received in an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> <condition> the rule operation is "Create new QoS rule" </condition> and <condition> the resultant QoS rule is associated with a QoS flow description stored for an EPS bearer context different from the EPS bearer context being activated </condition> and <condition> belonging to the same PDN connection as the EPS bearer context being activated. </condition> </condition> </control>
<control> <condition> <condition> In case 4, </condition> <condition> if the rule operation is for a non-default QoS rule, </condition> </condition> <action> the UE shall delete the QoS rule. </action> </control> <control> <condition> If the QoS rule is the default QoS rule, </condition> <action> the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 "semantic error in the QoS operation" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. </action> </control>
<control> <condition> <condition> Otherwise </condition> <condition> for all the cases above, </condition> <action> the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 "semantic error in the QoS operation" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. </action> </condition> </control>
<control> <condition> b) Syntactical errors in QoS operations: </condition> </control>
<control> 1) <condition> <condition> When the rule operation is "Create new QoS rule", </condition> <condition> the packet filter list in the QoS rule is empty, </condition> and <condition> the QoS rule is provided for a PDN connection of PDN type IPv4, IPv6, IPv4v6 or Ethernet, </condition> or <condition> for a PDN connection of PDN type "non-IP" </condition> and <condition> there is locally available information associated with the PDN connection that is set to "Ethernet". </condition> </condition> </control> <control> 2) <condition> Void. </condition> </control> <control> 3) <condition> <condition> When there are other types of syntactical errors in the coding of the QoS rules parameter, </condition> <condition> the QoS rules with the length of two octets parameter, </condition> <condition> <condition> the QoS flow descriptions parameter </condition> or <condition> the QoS flow descriptions with the length of two octets parameter, such as a mismatch between the number of packet filters subfield, </condition> and <condition> <condition> the number of packet filters in the packet filter list </condition> <condition> when the rule operation is "delete existing QoS rule" </condition> or <condition> "create new QoS rule",c </condition> or <condition> the number of packet filters subfield is larger than the maximum possible number of packet filters in the packet filter list (i.e., there is no QoS rule precedence subfield included in the QoS rule IE), </condition> <condition> the QoS Rule Identifier is set to "no QoS rule identifier assigned", </condition> or <condition> the QoS flow identifier is set to "no QoS flow identifier assigned. </condition> </condition> </condition> </condition> </control> <control> 4) <condition> When, <control> the A) rule operation is "Create new QoS rule", the UE determines, by using the QoS rules QFI as the 5QI, </control> <condition> that there is a resulting QoS rule for a GBR QoS flow (as described in 3GPP TS 23.501 table 5.7.4-1), </condition> and <condition> there is no QoS flow description with a QFI corresponding to the QFI of the resulting QoS rule. </condition> </condition> </control> <control> 5) <condition> <condition> When the flow description operation is "Create new QoS flow description", </condition> and <condition> the UE determines that there is a QoS flow description of a GBR QoS flow (as described in 3GPP TS 23.501 table 5.7.4-1) </condition> <condition> which lacks at least one of the mandatory parameters (i.e., GFBR uplink, GFBR downlink, MFBR uplink and MFBR downlink). </condition> </condition> <control> <condition> If the QoS flow description does not include a 5QI, </condition> <action> the UE determines this by using the QFI as the 5QI. </action> </control> </control>
<control> <condition> <condition> In case 1, case 3 or case 4, </condition> <condition> if the QoS rule is not the default QoS rule, </condition> </condition> <action> the UE shall delete the QoS rule. </action> <control> <condition> If the QoS rule is the default QoS rule, </condition> <action> the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 "syntactical error in the QoS operation" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. </action> </control> </control>
<control> <condition> In case 5, </condition> <action> the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 "syntactical error in the QoS operation" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. </action> </control>
NOTE 7: It is not considered an error if the UE determines that after processing all QoS operations on QoS rules and QoS flow descriptions there is a QoS flow description that is not associated with any QoS rule and the UE is not in NB-N1 mode.
<control> <condition> c) Semantic errors in packet filters: </condition> </control>
<control> 1) <condition> <condition> When a packet filter consists of conflicting packet filter components </condition> <condition> which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. </condition> </condition> How the UE determines a semantic error in a packet filter is outside the scope of the present document. </control>
<control> <action> The UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #44 "semantic errors in packet filter(s)" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. </action> </control> <control> <condition> d) Syntactical errors in packet filters: </condition> </control>
<control> 1) <condition> <condition> When the rule operation is "Create new QoS rule" </condition> and <condition> two or more packet filters in the resultant QoS rule would have identical packet filter identifiers. </condition> </condition> </control> <control> 2) <condition> When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier. </condition> </control>
<control> <action> The UE shall delete the QoS rule and include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #45 "syntactical error in packet filter(s)" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE detects different errors in the QoS rules and QoS flow descriptions as described in this subclause </condition> <condition> which requires sending a 5GSM cause parameter in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message, </condition> </condition> <action> the UE shall include a single 5GSM cause parameter in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. </action> </control>
NOTE 8: The 5GSM cause to use cannot be different from #44 "semantic error in packet filter(s)", #45 "syntactical errors in packet filter(s)", #83 "semantic error in the QoS operation" or #84 "syntactical error in the QoS operation". The selection of a 5GSM cause is up to UE implementation.
<control> <condition> Upon inter-system change from S1 mode to N1 mode, </condition> <action> the UE uses the parameters from the default EPS bearer context of each PDN connection for which interworking to 5GS is supported to create a corresponding PDU session associated with 3GPP access as follows, </action> <condition> unless the PDN connection is a user-plane resource of an MA PDU session: </condition> </control>
<control> a) <action> the PDN type of the default EPS bearer context shall be mapped to the PDU session type of the PDU session as follows: </action> </control>
<control> 1) <condition> if the PDN type is "non-IP": </condition> <control> a) <action> the PDU session type is set to the locally available information associated with the PDN connection (either "Ethernet" or "Unstructured"), </action> <condition> if available; </condition> or <control> <condition> b) otherwise, </condition> <action> the PDU session type is set to "Unstructured"; </action> </control> </control> </control> <control> 2) <condition> if the PDN type is "IPv4" </condition> <action> the PDU session type is set to "IPv4"; </action> </control> <control> 3) <condition> if the PDN type is "IPv6", </condition> <action> the PDU session type is set to "IPv6"; </action> </control> <control> 4) <condition> if the PDN type is "IPv4v6", </condition> <action> the PDU session type is set to "IPv4v6"; </action> </control> and <control> 5) <condition> if the PDN type is "Ethernet", </condition> <action> the PDU session type is "Ethernet"; </action> </control> <control> b) <action> the PDN address of the default EPS bearer context shall be mapped to PDU address of the PDU session, </action> <condition> if the PDN type is "IPv4", "IPv6" or "IPv4v6"; </condition> </control> <control> c) <action> the APN of the default EPS bearer context shall be mapped to the DNN of the PDU session, </action> <condition> unless the PDN connection is an emergency PDN connection; </condition> </control> <control> <condition> d) for each default EPS bearer context </condition> <start_state> in state BEARER CONTEXT ACTIVE </start_state> <action> the UE shall set the state of the mapped PDU session to PDU SESSION ACTIVE; </action> </control> and <control> <condition> e) for any other default EPS bearer context </condition> <action> the UE shall set the state of the mapped PDU session to PDU SESSION INACTIVE. </action> </control>
<control> Additionally, <action> the UE shall set: </action> </control>
<control> a) <action> the PDU session identity of the PDU session to the PDU session identity included by the UE in the Protocol configuration options IE or Extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST message, or the PDU session identity associated with the default EPS bearer context; </action> </control> <control> b) <action> the S-NSSAI of the PDU session to the S-NSSAI included by the network in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, or the S-NSSAI associated with the default EPS bearer context, </action> <condition> if the PDN connection is a non- emergency PDN connection; </condition> </control> <control> c) <action> the session-AMBR of the PDU session to the session-AMBR included by the network in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message or the MODIFY EPS BEARER CONTEXT REQUEST message, or the session- AMBR associated with the default EPS bearer context; </action> </control> <control> d) <action> the SSC mode of the PDU session to "SSC mode 1"; </action> </control> and <control> e) <action> the always-on PDU session indication to the always-on PDU session indication maintained in the UE, </action> <condition> if any. </condition> </control>
<control> <condition> <condition> Upon inter-system change from S1 mode to N1 mode, </condition> <condition> <condition> for each PDN connection </condition> <condition> <condition> which is a user-plane resource of MA PDU session </condition> and <condition> for which interworking to 5GS is supported, </condition> </condition> </condition> </condition> <action> the UE shall consider that the MA PDU session is established over 3GPP access </action> and, <condition> unless the MA PDU session is established over non-3GPP access too, </condition> <action> the UE shall set the session-AMBR of the PDU session to the session-AMBR included by the network in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message or the MODIFY EPS BEARER CONTEXT REQUEST message, or the session-AMBR associated with the default EPS bearer context of the PDN connection. </action> </control>
<control> Additionally, <condition> for each EPS bearer context of the PDN connection, </condition> <action> the UE shall create QoS flow(s) each of which is associated with the QoS flow description received in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, ACTIVATE DEDICATED EPS BEARER REQUEST message, and/or MODIFY EPS BEARER REQUEST message (see 3GPP TS 24.301 ), or the QoS flow description associated with EPS bearer context, </action> unless: </control>
<control> <condition> a) the PDU session is an MA PDU session which: </condition> </control>
<control> <condition> 1) is established over non-3GPP access; </condition> and </control>
<control> <condition> 2) has a PDN connection as a user-plane resource; </condition> and </control>
<control> <condition> b) the QoS flow already exists over the non-3GPP access. </condition> </control>
<control> Additionally, <condition> for each EPS bearer context of the PDN connection, </condition> <action> the UE shall create QoS rules(s), </action> <condition> <condition> if any, </condition> each of which is associated with the QoS rule received in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, ACTIVATE DEDICATED EPS BEARER REQUEST message, or MODIFY EPS BEARER CONTEXT REQUEST message (see 3GPP TS 24.301 ), or the QoS rules associated with EPS bearer context, </condition> </control> unless:
<control> <condition> a) the PDU session is an MA PDU session which: </condition> </control>
<control> <condition> 1) is established over non-3GPP access; </condition> and </control>
<control> <condition> 2) has a PDN connection as a user-plane resource; </condition> and </control>
<control> <condition> b) the QoS rule already exists over the non-3GPP access. </condition> </control>
NOTE 9: <control> <condition> For a QoS rule which does not exist over non-3GPP access, </condition> <action> the UE does not create the QoS rule </action> <condition> <condition> if the QoS rule is the default QoS rule, </condition> or <condition> the precedence value of the QoS rule equals to the precedence value of a QoS rule exists over the non-3GPP access. </condition> </condition> </control>
<control> Additionally, <condition> for each PDU session which was created at inter-system change from S1 mode to N1 mode from a corresponding PDN connection of the "Ethernet" PDN type, </condition> <action> the UE shall consider that Ethernet PDN type in S1 mode is supported by the network </action> and <action> the SMF shall consider that Ethernet PDN type in S1 mode is supported by the UE. </action> </control>
<control> <action> The UE and the network shall locally release the PDN connection(s) and EPS bearer context(s) associated with the 3GPP access </action> <condition> which have not been transferred to 5GS. </condition> </control>
<control> <condition> <condition> After inter-system change from S1 mode to N1 mode, </condition> <condition> for each QoS flow mapped from an EPS bearer context </condition> </condition> <action> the UE shall associate the EPS bearer identity, the EPS QoS parameters, the extended EPS QoS parameters, and the traffic flow template, if available, of the EPS bearer context with the QoS flow. </action> </control>
<control> <condition> <condition> After inter-system change from S1 mode to N1 mode, </condition> <condition> for each QoS flow of an MA PDU session which: </condition> </condition> </control>
<control> <condition> a) is established over non-3GPP access; </condition> and </control>
<control> <condition> b) has a PDN connection as a user-plane resource; </condition> <condition> <condition> such that the QoS flow was received in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, ACTIVATE DEDICATED EPS BEARER REQUEST message, MODIFY EPS BEARER CONTEXT REQUEST message, (see 3GPP TS 24.301 ), </condition> or <condition> associated with EPS bearer context, </condition> </condition> <action> the UE shall associate the EPS bearer identity, the EPS QoS parameters, the extended EPS QoS parameters, and the traffic flow template, if available, of the EPS bearer context with the QoS flow. </action> </control>
<control> <condition> <condition> If the EPS bearer context(s) of the PDN connection are associated with the control plane only indication, </condition> and <condition> the PDN connection supports interworking to 5GS, </condition> <condition> after inter-system change from S1 mode to N1 mode, </condition> </condition> <action> the UE shall associate the PDU session corresponding to the PDN connection with the control plane only indication. </action> </control>
<control> <condition> <condition> If the default EPS bearer context of the PDN connection is associated with the PDU session pair ID, </condition> and <condition> the PDN connection supports interworking to 5GS, </condition> <condition> after inter-system change from S1 mode to N1 mode, </condition> </condition> <action> the UE shall associate the PDU session corresponding to the PDN connection with the PDU session pair ID. </action> </control> <control> <condition> <condition> If the default EPS bearer context of the PDN connection is associated with the RSN, </condition> and <condition> the PDN connection supports interworking to 5GS, </condition> <condition> after inter- system change from S1 mode to N1 mode, </condition> </condition> <action> the UE shall associate the PDU session corresponding to the PDN connection with the RSN. </action> </control>
<control> <condition> <condition> If there is an EPS bearer used for IMS signalling, </condition> <condition> after inter-system change from S1 mode to N1 mode, </condition> </condition> <action> the QoS flow of the default QoS rule in the corresponding PDU session is used for IMS signalling. </action> </control>
<control> <condition> <condition> For a PDN connection established when in S1 mode, </condition> <condition> upon the first inter-system change from S1 mode to N1 mode, </condition> </condition> <action> the SMF shall determine the PDU session indication as specified in subclause 6.3.2.2. </action> </control>
<control> <condition> When the UE is provided with one or more mapped EPS bearer contexts in the Mapped EPS bearer contexts IE of the PDU SESSION MODIFICATION COMMAND message, </condition> <action> the UE shall process the mapped EPS bearer contexts sequentially starting with the first mapped EPS bearer context. </action> </control>
<control> <condition> When the UE is provided with a new EPS bearer identity, a new EPS QoS parameters, a new extended EPS QoS parameters, a new APN-AMBR or a new extended APN-AMBR in the Mapped EPS bearer context IE of the PDU SESSION MODIFICATION COMMAND message for a QoS flow, </condition> <action> the UE shall discard the corresponding association(s) </action> and <action> associate the new value(s) with the QoS flow. </action> </control>
<control> <condition> When the UE is provided with a new traffic flow template in the Mapped EPS bearer contexts IE of the PDU SESSION MODIFICATION COMMAND message for a QoS flow, </condition> <action> the UE shall check the traffic flow template for different types of TFT IE errors as specified in subclause 6.3.2.3. </action> </control>
<control> <condition> When a QoS flow is deleted, </condition> <action> the associated EPS bearer context information that are mapped from the deleted QoS flow shall be deleted from the UE and the network </action> <condition> if there is no other existing QoS flow associated with this EPS bearer context. </condition> </control> <control> <condition> When the EPS bearer identity of a QoS flow is deleted, </condition> <action> the associated EPS bearer context information that are mapped from the deleted EPS bearer identity shall be deleted from the UE and the network </action> <condition> if there is no other existing QoS flow associated with this EPS bearer context. </condition> </control> <control> <condition> When an EPS bearer is released, </condition> <action> all the associated QoS flow descriptions and QoS rules that are mapped from the released EPS bearer shall be deleted from the UE and the network. </action> </control>
NOTE 10: <control> <condition> If T3584 is running or deactivated for the S-NSSAI and optionally the DNN combination, </condition> <action> the UE is allowed to initate ESM procedures in EPS with or without APN corresponding to that DNN, </action> and <condition> if the APN is congested in EPS, </condition> <action> the MME can send a back-off timer for the APN to the UE as specified in 3GPP TS 24.301 . </action> </control>
<control> <condition> <condition> Upon inter-system change from N1 mode to S1 mode, </condition> <condition> if the UE has any PDU sessions associated with one or more MBS multicast sessions, </condition> </condition> <action> the UE shall locally leave the associated MBS multicast sessions </action> and <action> the network shall consider the UE as removed from the associated MBS sessions. </action> </control>
<control> <condition> <condition> For the case of handover of an existing PDU session from 3GPP access to non-3GPP access, </condition> <condition> a) upon receipt of the PDU SESSION ESTABLISHMENT ACCEPT message, </condition> <action> the UE locally deletes the EPS bearer identities for the PDU session, </action> <condition> if any (see subclause 6.4.1.3); </condition> and <control> b) after successful handover, </control> <action> the network shall locally delete the EPS bearer identities for the PDU session, </action> <condition> if any. </condition> </condition> </control>
6.1.4.2 Coordination between 5GSM and ESM without N26 interface
<control> <condition> When the network does not support N26 interface, </condition> <action> the SMF does not provide the UE with the mapped EPS bearer context for a PDU session. </action> </control>
NOTE 1: Since the SMF does not provide the UE with the mapped EPS bearer context for a PDU session, the UE does not know whether interworking with EPS is supported for a PDU session before attempting to transfer the PDU session from N1 mode to S1 mode.
NOTE 2: It is up to UE implementation to decide which PDU session(s) to be attempted to transfer from N1 mode to S1 mode, e.g. based on UE policy or UE local configuration.
<control> <condition> Upon inter-system change from N1 mode to S1 mode in EMM-IDLE mode, </condition> <action> the UE shall not transfer a PDU session for LADN to EPS. </action> </control>
<control> <condition> Upon inter-system change from N1 mode to S1 mode in EMM-IDLE mode, </condition> <action> the UE shall not transfer a multi-homed IPv6 PDU session to EPS. </action> </control>
<control> <condition> Upon inter-system change from N1 mode to S1 mode in EMM-IDLE mode, </condition> <action> the UE shall use the parameters from each PDU session which the UE intends to transfer to EPS to create the contents of a PDN CONNECTIVITY REQUEST message as follows: </action> </control>
<control> <condition> a) if the PDU session is an emergency PDU session, </condition> <action> the request type shall be set to "handover of emergency bearer services". Otherwise the request type shall be set to "handover"; </action> </control> <control> b) <action> the PDU session type of the PDU session shall be mapped to the PDN type of the default EPS bearer context as follows: </action> </control>
<control> 1) <action> the PDN type shall be set to "non-IP" </action> <condition> if the PDU session type is "Unstructured"; </condition> </control> <control> 2) <action> the PDN type shall be set to "IPv4" </action> <condition> if the PDU session type is "IPv4"; </condition> </control> <control> 3) <action> the PDN type shall be set to "IPv6" </action> <condition> if the PDU session type is "IPv6"; </condition> </control> <control> 4) <action> the PDN type shall be set to "IPv4v6" </action> <condition> if the PDU session type is "IPv4v6"; </condition> </control> <control> 5) <action> the PDN type shall be set to "non-IP" </action> <condition> <condition> if the PDU session type is "Ethernet" </condition> and <condition> the UE, the network or both of them do not support Ethernet PDN type in S1 mode; </condition> </condition> </control> and <control> 6) <action> the PDN type shall be set to "Ethernet" </action> <condition> <condition> if the PDU session type is "Ethernet" </condition> and <condition> the UE and the network support Ethernet PDN type in S1 mode; </condition> </condition> </control> <control> c) <action> the DNN of the PDU session shall be mapped to the APN of the default EPS bearer context, </action> <condition> unless the PDU session is an emergency PDU session; </condition> </control> <control> d) <action> the PDU session ID parameter in the Protocol configuration options IE or Extended protocol configuration options IE shall be set to the PDU session identity of the PDU session; </action> </control> and <control> <condition> e) if the PDU session is an MA PDU session established over 3GPP access, </condition> <action> the ATSSS request parameter shall be included in the Protocol configuration options IE or Extended protocol configuration options IE. </action> </control>
<control> <condition> After inter-system change from N1 mode to S1 mode, </condition> <action> the UE shall associate the PDU session identity with the default EPS bearer context. </action> <control> <condition> If the PDU session being transferred is a non-emergency PDU session, </condition> <action> the UE shall in addition associate the S-NSSAI and the PLMN ID of the current PLMN with the default EPS bearer context. </action> </control> </control>
<control> <condition> <condition> Upon successful completion of an EPS attach procedure </condition> <condition> after inter-system change from N1 mode to S1 mode (see 3GPP TS 24.301 ), </condition> </condition> <action> the UE shall delete any UE derived QoS rules <condition> except when the PDU session is an MA PDU session established over 3GPP access and non-3GPP access. </condition> </action> </control>
<control> <action> The UE shall perform a local release of the PDU session(s) and QoS flow(s) associated with the 3GPP access which have not been transferred to EPS. </action> <action> The UE shall also perform a local release of any QoS flow description not associated with any QoS rule. </action> </control>
<control> <condition> <condition> For PDU session(s) associated with non-3GPP access in 5GS, </condition> <condition> if present, </condition> the UE may: </condition> </control>
<control> <action> a) keep some or all of these PDU sessions still associated with non-3GPP access in 5GS, </action> <condition> if supported; </condition> </control>
<control> <action> b) release some or all of these PDU sessions explicitly by initiating the UE requested PDU session release procedure(s); </action> or </control>
<control> <action> c) attempt to transfer some or all of these PDU sessions from N1 mode to S1 mode by initiating the UE requested PDN connectivity procedure(s) with the PDN CONNECTIVITY REQUEST message created as above. </action> </control>
<control> <condition> When the network does not support N26 interface, </condition> <action> the MME does not provide the UE with the mapped PDU session for a PDN connection </action> <action> but provides the UE with an S-NSSAI </action> <condition> if the PDN connection is not for emergency bearer services. </condition> </control> <control> <condition> <condition> When establishing a new PDN connection in S1 mode, </condition> <condition> to enable the UE to attempt to transfer the PDN connection from S1 mode to N1 mode in case of inter-system change, </condition> </condition> <action> the UE shall allocate a PDU session identity, </action> <action> indicate the allocated PDU session identity in the PDU session ID parameter in the Protocol configuration options IE of the PDN CONNECTIVITY REQUEST message </action> and <action> associate the allocated PDU session identity with the default EPS bearer context of the PDN connection. </action> <control> <condition> If an N5CW device supports 3GPP access and establishes a new PDN connection in S1 mode, </condition> <action> the N5CW device shall refrain from allocating "PDU session identity value 15". </action> <control> The network provides the UE with an S-NSSAI and the related PLMN ID in the Protocol configuration options IE or Extended protocol configuration options IE of the ACTIVATE DEFAULT EPS BEARER REQUEST message, <action> the UE shall delete the stored S-NSSAI and the related PLMN ID, </action> <condition> if any, </condition> and <action> shall store the S-NSSAI and the related PLMN ID provided in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. </action> </control> </control> </control>
NOTE 3: Since the MME does not provide the UE with the mapped PDU session for a PDN connection, the UE does not know whether interworking to 5GS is supported for a PDN connection for which the UE assigned a PDU Session identity before attempting to transfer the PDN connection from S1 mode to N1 mode.
NOTE 4: It is up to UE implementation to decide which PDN connection(s) to be attempted to transfer from S1 mode to N1 mode, e.g. based on UE policy or UE local configuration.
NOTE 5: <control> <condition> If the PDN connection has been transferred from a PDN connection established via non-3GPP access to EPC, </condition> it is possible that the network provided the S-NSSAI already during the establishment via non- 3GPP access (see 3GPP TS 24.302 ). </control>
<control> <condition> Upon inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, </condition> <action> the UE uses the parameters from the default EPS bearer context of each PDN connection which the UE intends to transfer to 5GS </action> and <condition> for which the UE has allocated a PDU session identity to create a PDU SESSION ESTABLISHMENT REQUEST message as follows: </condition> </control>
<control> <condition> a) if the PDN connection is for emergency bearer services, </condition> <action> the request type shall be set to "existing emergency PDU session". Otherwise the request type shall be set to: </action> </control>
<control> <action> 1) "MA PDU request", </action> <condition> if the PDN connection to be transferred is a user-plane resource of an MA PDU session; </condition> or </control>
<control> <action> 2) "existing PDU session"; </action> </control>
<control> <action> b) the PDN type of the default EPS bearer context shall be mapped to the PDU session type of the PDU session as follows: </action> </control>
<control> 1) <condition> if the PDN type is "non-IP": </condition> <control> <action> a) the PDU session type is set to the locally available information associated with the PDN connection (either "Ethernet" or "Unstructured"), </action> <condition> if available; </condition> </control> or <control> <condition> b) otherwise, </condition> <action> the PDU session type is set to "Unstructured"; </action> </control> </control> <control> 2) <condition> if the PDN type is "IPv4" </condition> <action> the PDU session type is set to "IPv4"; </action> </control> <control> 3) <condition> if the PDN type is "IPv6", </condition> <action> the PDU session type is set to "IPv6"; </action> </control> <control> 4) <condition> if the PDN type is "IPv4v6", </condition> <action> the PDU session type is set to "IPv4v6"; </action> </control> and <control> 5) <condition> if the PDN type is "Ethernet", </condition> <action> the PDU session type is set to "Ethernet"; </action> </control> and
<control> <action> c) the APN of the default EPS bearer context shall be mapped to the DNN of the PDU session, </action> <condition> unless the PDN connection is an emergency PDN connection; </condition> </control>
<control> <action> d) the PDU session ID shall be set to the PDU session identity included by the UE in the Protocol configuration options IE or Extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST message, or to the PDU session ID associated with the default EPS bearer context; </action> and </control>
<control> <condition> e) if the PDU session is not an emergency PDU session, </condition> <action> the S-NSSAI of the PDU session shall be set to the S- NSSAI included by the network in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, </action> <condition> <condition> if provided by the network, </condition> or <condition> the S-NSSAI associated with the default EPS bearer context, </condition> <condition> if available. </condition> </condition> </control>
NOTE 6: <control> <condition> If T3584 is running or deactivated for the S-NSSAI and optionally the DNN combination, </condition> <action> the UE is allowed to initiate ESM procedures in EPS with or without APN corresponding to that DNN, </action> and <condition> if the APN is congested in EPS, </condition> <action> the MME can send a back-off timer for the APN to the UE as specified in 3GPP TS 24.301 . </action> </control>
<control> <action> The UE shall locally release the PDN connection(s) and EPS bearer(s) associated with the 3GPP access </action> <condition> which have not been transferred to 5GS. </condition> </control>
<control> <condition> <condition> Upon inter-system change from N1 mode to S1 mode, </condition> <condition> if the UE has any PDU sessions associated with one or more MBS multicast sessions, </condition> </condition> <action> the UE shall locally leave the associated MBS multicast sessions </action> and <action> the network shall consider the UE as removed from the associated MBS sessions. </action> </control>
6.1.4a Coordination between 5GSM and SM
Coordination between 5GSM and SM states is not required.
<control> <condition> After the 5G-SRVCC handover from NG-RAN to UTRAN (see 3GPP TS 23.216 ), </condition> <action> all the PDU sessions of the UE are locally released at the UE and the network. </action> <control> <condition> If the UE has any PDU sessions associated with one or more MBS multicast sessions, </condition> <action> the UE shall locally leave the associated MBS multicast sessions </action> and <action> the network shall consider the UE as removed from the associated MBS sessions. </action> </control> </control>
6.1.5 Coordination for interworking with ePDG connected to EPC
<control> <condition> <condition> When the UE establishes a new PDN connection via an ePDG connected to EPC, </condition> <condition> to enable the transfer of the PDN connection to N1 mode in case of inter-system change, </condition> </condition> <action> the UE allocates a PDU session identity and indicates its value in the PDU session ID field in the N1_MODE_CAPABILITY Notify payload of the IKE_AUTH request message (see 3GPP TS 24.302 ). </action> <control> <action> The network provides the UE with an S-NSSAI in the N1_MODE_INFORMATION Notify payload of the IKE_AUTH response message (see 3GPP TS 24.302 ). </action> </control> </control>
<control> <condition> <condition> Upon inter-system change to N1 mode, for PDN connection(s) established via an ePDG connected to EPC, </condition> <condition> if present, </condition> </condition> the UE may: </control>
<control> <action> a) keep some or all of these PDN connections still via ePDG connected to EPC, </action> <condition> if supported; </condition> </control>
<control> <action> b) release some or all of these PDN connections explicitly by initiating the UE initiated tunnel disconnection procedure(s) as specified in 3GPP TS 24.302 ; </action> or </control>
<control> <action> c) attempt to transfer some or all of these PDN connections to N1 mode using the parameters of the PDN connection for which the UE has allocated a PDU session identity by initiating the PDU session establishment procedure(s) with the PDU SESSION ESTABLISHMENT REQUEST message created. </action> </control>
<control> <condition> In that case, </condition> <condition> for each and every PDN connection to be transferred: </condition> </control>
<control> <condition> 1) if the PDN connection is for emergency bearer services, </condition> <action> the request type shall be set to "existing emergency PDU session". </action> <condition> Otherwise </condition> <action> the request type shall be set to "existing PDU session"; </action> </control>
<control> <condition> 2) if the previously allocated home address information for a PDN connection consists of an IPv4 address only for an ePDG connected to EPC according to 3GPP TS 24.302 , </condition> <action> the PDU session type shall be set to "IPv4"; </action> </control>
<control> <condition> 3) if the previously allocated home address information for a PDN connection consists of an IPv6 prefix only for an ePDG connected to EPC according to 3GPP TS 24.302 , </condition> <action> the PDU session type shall be set to "IPv6"; </action> </control>
<control> <condition> 4) if the previously allocated home address information for a PDN connection consists of both an IPv4 address and an IPv6 prefix for an ePDG connected to EPC according to 3GPP TS 24.302 , </condition> <action> the PDU session type shall be set to "IPv4v6"; </action> </control>
<control> <action> 5) the APN of the PDN connection shall be mapped to the DNN of the PDU session; </action> </control>
<control> <action> 6) the PDU session ID shall be set to the PDU session identity in the N1_MODE_CAPABILITY Notify payload of the IKE_AUTH request message establishing IPsec tunnel of the PDN connection; </action> and </control>
<control> <condition> 7) if the PDN connection is not for emergency bearer services, </condition> <action> the S-NSSAI of the PDU session shall be set to the S-NSSAI associated with the PDN connection as specified in 3GPP TS 24.302 . </action> <action> The UE shall not request to perform handover of an existing PDN connection to N1 mode </action> <condition> if the associated S-NSSAI is not included in the allowed NSSAI for the target access. </condition> </control>
<control> <condition> If an existing PDU session is transferred from 3GPP access to an ePDG connected to EPC connection </condition> and <condition> that existing PDU session is associated with one or more MBS sessions, </condition> <action> the UE shall locally leave the associated MBS sessions </action> and <action> the SMF shall consider the UE as removed from the associated MBS sessions. </action> </control>
6.2 General on elementary 5GSM procedures
6.2.1 Principles of PTI handling for 5GSM procedures
<control> <condition> When the UE or the network initiates a transaction related procedure (i.e. a procedure consisting of more than one message and the messages are related), </condition> <action> it shall include a valid PTI value in the message header of the request message or of the command message. </action> </control>
<control> <condition> If a response message is sent as result of a received request message or a received command message, </condition> <action> the sending entity shall include in the response message the PTI value received within the request message or within the command message (see examples in figure 6.2.1.1, figure 6.2.1.2, and figure 6.2.1.3). </action> </control>
<control> <condition> If a command message is sent as result of a received request message, </condition> <action> the sending entity shall include in the command message the PTI value received with the request message (see examples in figure 6.2.1.3). </action> </control>
<control> <condition> If a command message is not sent as result of a received request message, </condition> <action> the sending entity shall include in the command message the PTI value set to "no procedure transaction identity assigned" (see examples in figure 6.2.1.4). </action> </control>
UE SMF transaction related request (PTI = a) transaction related accept (PTI = a) UE SMF transaction related request (PTI = a) transaction related reject (PTI = a) UE SMF transaction related request (PTI = a) transaction related command (PTI = a) transaction related response (PTI = a) transaction related procedure UE SMF transaction related command (PTI = unassigned) transaction related response (PTI = unassigned) transaction related procedure
6.2.2 PDU session types
The following PDU Session types are supported:
a) IPv4;
b) IPv6;
c) IPv4v6;
d) Ethernet (EtherType as defined in IEEE Std 802.3 ); and
IP address allocation for IPv4, IPv6 and IPv4v6 PDU session types is described in subclause 6.2.4.
Neither a MAC nor an IP address is allocated by the 5GCN to the UE for Ethernet PDU session type.
6.2.3 PDU session management
The SMF is responsible for the session management functions to provide the PDU connectivity service to the UE via the 5GSM signalling between UE and SMF. The session management procedures includes: a) the UE-requested PDU session establishment procedure; b) the PDU session authentication and authorization procedure; c) the UE-requested PDU session modification procedure; d) the network-requested PDU session modification procedure; e) the UE-requested PDU session release procedure; and f) the network-requested PDU session release procedure.
<control> <action> A UE may establish multiple PDU sessions, to the same data network or to different data networks, via 3GPP and via and Non-3GPP access networks at the same time. </action> </control>
The session management messages between UE and SMF are transferred via AMF as specified in subclause 8.3.
6.2.4 IP address allocation
6.2.4.1 General
This clause specifies IP address allocation for the PDU session.
In this release of specification, PDU session can be initiated with one IP version, i.e. IPv4 PDU session type or IPv6 PDU session type, or with both IP versions, i.e. IPv4v6 PDU session type.
<control> <action> IP address allocation to the UE shall be performed by SMF based on one or both the selected IP versions and operator policies. </action> <control> <condition> If IPv4 PDU session type is selected, </condition> <action> an IPv4 address is allocated to the UE. </action> </control> <control> <condition> If IPv6 PDU session type is selected, </condition> <action> an IPv6 prefix except when the SMF acts according to subclause 6.2.4.3, and an interface identifier for the IPv6 link local address are allocated to the UE. </action> </control> <control> <condition> If IPv4v6 PDU session type is selected, </condition> <action> an IPv4 address, an IPv6 prefix except when the SMF acts according to subclause 6.2.4.3 or 6.2.4.4, and an interface identifier for the IPv6 link local address are allocated to the UE. </action> </control> <control> <condition> If IPv6 or IPv4v6 PDU session type is selected in a PDU session established by the W- AGF acting on behalf of the FN-RG and the PDU SESSION ESTABLISHMENT REQUEST message contains the Suggested interface identifier IE, </condition> <action> the SMF shall allocate to the UE the interface identifier for the IPv6 link local address indicated in the Suggested interface identifier IE. </action> </control> </control>
<control> <condition> <condition> For IPv4 PDU session type </condition> and <condition> for IPv4v6 PDU session type, </condition> the UE: </condition> </control>
<control> <action> a) shall obtain an IPv4 address via: 1) NAS signalling as specified in subclause 6.2.4.2; or 2) DHCPv4; </action> and </control>
<control> <action> b) may obtain IPv4 configuration parameters (e.g. DNS server address) via DHCPv4 </action> or <action> may receive IPv4 configuration parameters (e.g. DNS server address) as specified in subclause 6.4.1 and subclause 6.3.2. </action> </control>
<control> <condition> <condition> For IPv6 PDU session type </condition> and <condition> for IPv4v6 PDU session type, </condition> </condition> the UE: </control>
<control> <action> a) shall build an IPv6 link local address based on the allocated interface identifier for the IPv6 link local address; </action> </control>
<control> b) <action> shall obtain /64 IPv6 prefix via IPv6 stateless address autoconfiguration as specified in 3GPP TS 23.501 and IETF RFC 4862 , </action> <condition> except when the 5G-RG or the W-AGF act according to subclause 6.2.4.3; </condition> </control> and
<control> c) <action> may obtain IPv6 configuration parameters via stateless DHCPv6 as specified in IETF RFC 8415 , </action> <condition> except when the 5G-RG or the W-AGF act according to subclause 6.2.4.3, </condition> <action> may receive IPv6 configuration parameters (e.g. DNS server address) as specified in subclause 6.4.1 and subclause 6.3.2, </action> or <action> may receive DNS server IPv6 addresses in a Router Advertisement Message as specified in IETF RFC 4861 with recursive DNS server option as specified in IETF RFC 8106 . </action> </control>
6.2.4.2 IP address allocation via NAS signalling
<control> <action> The UE shall set the PDU session type IE in the PDU SESSION ESTABLISHMENT REQUEST message, </action> <condition> based on its IP stack capabilities if the UE requests IP connectivity as follows: </condition> </control>
<control> <condition> a) A UE: </condition> </control>
<control> <condition> 1) which is IPv6 and IPv4 capable, </condition> <action> shall set the PDU session type IE to IPv4, IPv6 or IPv4v6 according to UE configuration or received policy. </action> </control>
<control> <condition> 2) which is only IPv6 capable, </condition> <action> shall set the PDU session type IE to IPv6. </action> </control>
<control> <condition> 3) which is only IPv4 capable, </condition> <action> shall set the PDU session type IE to IPv4. </action> </control>
<control> b) When the IP version capability of the UE is unknown in the UE (as in the case when the MT and TE are separated and the capability of the TE is not known in the MT), <action> the UE shall set the PDU session type IE to IPv4v6. </action> </control>
<control> <condition> If the UE wants to use DHCPv4 for IPv4 address assignment, </condition> <action> it shall indicate that to the network within the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST. </action> </control>
<control> <condition> On receipt of the PDU SESSION ESTABLISHMENT REQUEST message sent by the UE, </condition> the network <condition> when allocating an IP address </condition> shall <action> take into account the PDU session type IE, the operator's policies of the network, and the user's subscription data </action> and: </control>
<control> <condition> a) if the network sets the Selected PDU session type IE to IPv4, </condition> <action> the network shall include an IPv4 address in the PDU address IE; </action> </control> <control> <condition> b) if the network sets the Selected PDU session type IE to IPv6, </condition> <action> the network shall include an interface identifier for the IPv6 link local address in the PDU address IE; </action> </control> and <control> <condition> c) if the network sets the Selected PDU session type IE to IPv4v6, </condition> <action> the network shall include an IPv4 address and an interface identifier for the IPv6 link local address in the PDU address IE. </action> </control>
6.2.4.3 Additional RG related requirements for IP address allocation
<control> <condition> If IPv6 PDU session type or IPv4v6 PDU session type is selected, </condition> <action> an IPv6 address, one or more IPv6 prefixes or both are allocated to the 5G-RG or the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device). </action> </control>
<control> <condition> If the 5G-RG or the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) receives a Router Advertisement Message as specified in IETF RFC 4861 with the "Managed address configuration" flag set to zero, </condition> <action> the 5G-RG and the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device): </action> </control>
<control> <action> a) shall obtain /64 IPv6 prefix via IPv6 stateless address autoconfiguration as specified in 3GPP TS 23.501 and IETF RFC 4862 ; </action> </control>
<control> <action> b) may obtain IPv6 configuration parameters via stateless DHCPv6 as specified in IETF RFC 8415 ; </action> and </control>
<control> <action> c) may request additional IPv6 prefixes using DHCPv6. </action> <condition> If the 5G-RG and the W-AGF acting on behalf of the FN- RG (or on behalf of the N5GC device) request IPv6 prefixes using DHCPv6, </condition> <action> the 5G-RG and the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) shall act as a "Requesting Router" as described in IETF RFC 3633 , </action> <action> shall obtain IPv6 prefixes using the DHCPv6 Identity association for prefix delegation option as specified in IETF RFC 8415 , </action> <action> may include DHCPv6 Rapid commit option as specified in IETF RFC 8415 in a DHCP message, </action> and <action> may include DHCPv6 OPTION_ORO option with the OPTION_PD_EXCLUDE option code as specified in IETF RFC 6603 in the DHCP message. </action> </control>
NOTE 1: The 5G-RG and the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) can include several DHCP options in a DHCP message.
<control> <condition> If the 5G-RG or the W-AGF acting on behalf of the FN-RG receives a Router Advertisement Message as specified in IETF RFC 4861 with the "Managed address configuration" flag set to one, </condition> <action> the 5G-RG and the W-AGF acting on behalf of the FN-RG: </action> </control>
<control> <action> a) shall obtain an IPv6 address via DHCPv6 and the DHCPv6 Identity association for non-temporary addresses option as specified in IETF RFC 8415 ; </action> </control>
<control> <action> b) may obtain IPv6 configuration parameters via DHCPv6 as specified in IETF RFC 8415 ; </action> and </control>
<control> <action> c) may request IPv6 prefixes using DHCPv6. </action> <condition> If the 5G-RG and the W-AGF acting on behalf of the FN-RG requests IPv6 prefixes using DHCPv6, </condition> <action> the 5G-RG and the W-AGF acting on behalf of the FN-RG shall act as a "Requesting Router" as described in IETF RFC 8415 , </action> <action> shall obtain IPv6 prefixes using the DHCPv6 Identity association for prefix delegation option as specified in IETF RFC 8415 , </action> <action> may include DHCPv6 Rapid commit option as specified in IETF RFC 8415 in a DHCP message, </action> and <action> may include DHCPv6 OPTION_ORO option with the OPTION_PD_EXCLUDE option code as specified in IETF RFC 6603 in the DHCP message. </action> </control>
NOTE 2: The 5G-RG and the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) can include several DHCP options in a DHCP message.
<control> <action> The 5G-RG may obtain ACS information via DHCP as specified in clause 3.1 of BBF TR-069 or in BBF TR-369 R-DIS.1 and R-DIS.2. </action> </control>
6.2.4.4 Additional requirements of the UE acting as 5G ProSe layer-3 UE-to-network relay UE for IP address allocation
<control> <condition> If a UE acting as 5G ProSe layer-3 UE-to-network relay needs to indicate "IPv6 Router" or "DHCPv4 Server &amp; IPv6 Router" in the IP address configuration IE as specified in 3GPP 24.554 , </condition> <action> the UE shall support acting as a "Requesting Router" as described in IETF RFC 8415 to request additional IPv6 prefixes (i.e. prefixes in addition to the /64 default prefix which was allocated via stateless IPv6 address autoconfiguration as specified in subclause 6.2.4.1) from the SMF as specified in subclause 5.5.2 of 3GPP TS 23.304 . </action> </control>
<control> <condition> When the UE acting as 5G ProSe layer-3 UE-to-network relay UE requests additional prefixes using DHCPv6, </condition> the UE: </control>
<control> <action> a) shall include the OPTION_ORO option with the OPTION_PD_EXCLUDE option code as specified in IETF RFC 6603 in the DHCP message; </action> and </control>
<control> <action> b) may include the Rapid Commit Option as specified in IETF RFC 8415 in the DHCP message. </action> </control>
6.2.5 Quality of service
6.2.5.1 General
6.2.5.1.1 QoS rules
6.2.5.1.1.1 General
<control> <condition> <condition> In a PDU session of IPv4, IPv6, IPv4v6 </condition> and <condition> Ethernet PDU session type, </condition> </condition> <action> the NAS protocol enables different forwarding treatments of UL user data packets in one or more QoS flows based on signalled QoS rules, derived QoS rules or any combination of them. </action> </control>
<control> <condition> In a PDU session of Unstructured PDU session type, </condition> <action> all UL user data packets are associated with the same QoS flow. </action> </control>
6.2.5.1.1.2 Signalled QoS rules
<control> <action> The NAS protocol enables the network to provide the UE with signalled QoS rules associated with a PDU session. </action> </control>
<control> <action> The network can provide the UE with one or more signalled QoS rules associated with a PDU session at the PDU session establishment or at the PDU session modification. </action> </control>
Each signalled QoS rule contains: a) an indication of whether the QoS rule is the default QoS rule; b) a QoS rule identifier (QRI); c) a QoS flow identifier (QFI); d) optionally, a set of packet filters; and e) a precedence value.
NOTE 1: The default QoS rule indication (DQR) of a signalled QoS rule cannot be changed.
<control> <condition> For case d) above: </condition> </control>
<control> <condition> 1) If the QoS rule is the default QoS rule of a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, </condition> <action> the set of packet filters contains zero or more packet filters for DL direction, </action> and <action> may additionaly contain one of the following: </action> </control>
<control> <condition> A) a match-all packet filter for UL direction; </condition> <condition> B) a match-all packet filter for UL and DL directions; </condition> <condition> C) zero or more packet filters for UL direction (other than the match-all packet filter for UL direction); </condition> <condition> D) zero or more packet filters for UL and DL directions (other than the match-all packet filter for UL and DL directions); </condition> or <condition> E) <condition> one or more packet filters for UL direction (other than the match-all packet filter for UL direction) </condition> and <condition> one or more packet filters for UL and DL directions (other than the match-all packet filter for UL and DL directions). </condition> </condition> </control>
<control> <action> The set of packet filters for the default QoS rule shall not be empty. </action> <condition> If the default QoS rule contains a match- all packet filter, </condition> <action> then the highest precedence value shall be used for the default QoS rule. </action> </control>
<control> <condition> 2) <condition> If the QoS rule is a QoS rule of a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type </condition> and <condition> is not the default QoS rule, </condition> </condition> <action> the set of packet filters contains zero or more packet filters for the DL direction, </action> and <action> may additionally contain one of the following: </action> </control>
<control> <condition> A) zero or more packet filters for UL direction (other than the match-all packet filter for UL direction); </condition> and <condition> B) zero or more packet filters for both UL and DL directions (other than the match-all packet filter for UL and DL directions). </condition> </control>
<control> <condition> 3) For PDU session of unstructured PDU session type, </condition> <action> there is only one QoS rule associated with it and the set of packet filters of that QoS rule is empty. </action> </control>
<control> <condition> If the UE requests a new QoS rule, </condition> <action> it shall assign a precedence value for the signalled QoS rule </action> <condition> which is not in the range from 70 to 99 (decimal). </condition> </control>
NOTE 2: In this release of the specification, there is no support for a match-all packet filter for DL direction.
NOTE 3: In order to support QoS differentiation in case of access to PLMN services via an SNPN, the UE, within the SNPN, can construct packet filters based on the destination IP address to reach the N3IWF in the PLMN and the security parameters index (SPI) for the IPsec SA.
NOTE 4: <control> <condition> In order to support QoS differentiation in case of access to SNPN services via a PLMN, </condition> the UE, <condition> within the PLMN, </condition> <action> can construct packet filters based on the destination IP address to reach the N3IWF in the SNPN and the security parameters index (SPI) for the IPsec SA. </action> </control>
NOTE 5: <control> The above described condition of assigning a precedence value for the signalled QoS rule is applied to the UE <condition> when the UE requests a QoS rule for network to bind service data flows described by the QoS rule to a dedicated QoS flow by setting the segregation bit to 1. </condition> </control>
<control> <condition> In NB-N1 mode, </condition> there is only one QoS rule associated with a PDU session and that is the default QoS rule. </control> <control> As described in 3GPP TS 23.501 , <condition> when the SMF determines that the UE has: </condition> </control>
<control> <condition> a) moved from a tracking area in WB-N1 mode into a tracking area in NB-N1 mode; </condition> </control>
<control> <condition> b) moved from a tracking area in WB-S1 mode into a tracking area in NB-N1 mode; </condition> or </control>
<control> <condition> c) moved from a tracking area in NR connected to 5GCN into a tracking area in NB-N1 mode; </condition> the SMF shall, <condition> for each PDU session that is kept active, </condition> <action> initiate the PDU session modification procedure (see subclause 6.3.3.2) to delete every QoS rule that is not the default QoS rule, </action> <condition> if any. </condition> </control>
<control> <condition> Within a PDU session: </condition> a) each signalled QoS rule has a unique QRI; b) there is at least one signalled QoS rule; c) one signalled QoS rule is the default QoS rule; and d) there can be zero, one or more signalled QoS rules associated with a given QFI. </control>
6.2.5.1.1.3 Derived QoS rules
Derived QoS rules are applicable only for PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type.
The reflective QoS in the UE creates derived QoS rules associated with a PDU session based on DL user data packets received via the PDU session.
Each derived QoS rule contains: a) a QoS flow identifier (QFI); b) a packet filter for UL direction; and c) a precedence value of 80 (decimal).
NOTE: On the network side, the corresponding QoS rule can be associated with a different precedence value in the range from 70 to 99 (decimal).
<control> Within a PDU session: <condition> a) there can be zero, one or more derived QoS rules associated with a given QFI; </condition> and <condition> b) there can be up to one derived QoS rule associated with a given packet filter for UL direction. </condition> </control>
In the UE, a timer T3583 runs for each derived QoS rule.
Reflective QoS is not supported in NB-N1 mode. Reflective QoS is not applicable for a PDU session with control plane only indication.
6.2.5.1.1.4 QoS flow descriptions
<control> <action> The network can also provide the UE with one or more QoS flow descriptions associated with a PDU session at the PDU session establishment or at the PDU session modification. </action> </control>
Each QoS flow description contains: a) a QoS flow identifier (QFI); b) if the flow is a GBR QoS flow: 1) Guaranteed flow bit rate (GFBR) for UL; 2) Guaranteed flow bit rate (GFBR) for DL; 3) Maximum flow bit rate (MFBR) for UL; 4) Maximum flow bit rate (MFBR) for DL; and 5) optionally averaging window, applicable for both UL and DL; c) 5QI, if the QFI is not the same as the 5QI of the QoS flow identified by the QFI; and d) optionally, an EPS bearer identity (EBI) if the QoS flow can be mapped to an EPS bearer as specified in subclause 4.11.1 of 3GPP TS 23.502 .
<control> <condition> If the averaging window is not included in a QoS flow description for a GBR QoS flow with a 5QI indicated in 3GPP TS 23.501 table 5.7.4-1, </condition> <action> the averaging window associated with the 5QI in 3GPP TS 23.501 table 5.7.4-1 applies for the averaging window. </action> </control>
<control> <condition> If the averaging window is not included in a QoS flow description for a GBR QoS flow with a 5QI not indicated in 3GPP TS 23.501 table 5.7.4-1, </condition> the standardized value of two seconds is used as the averaging window. </control>
The NAS protocol enables the network to provide the UE with the session-AMBR associated with a PDU session.
The standardized value of two seconds is used as the averaging window for the UE's enforcement of the UL rate limitation indicated by the session-AMBR.
6.2.5.1.2A Void
6.2.5.1.3 UL user data packet matching
<control> <condition> <condition> For PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, </condition> <condition> upon receiving an UL user data packet from the upper layers for transmission via a PDU session, </condition> </condition> <action> the UE shall attempt to associate the UL user data packet with: </action> </control>
<control> <action> a) the QFI of a signalled QoS rule associated with the PDU session which has a set of packet filters containing a packet filter for UL direction matching the UL user data packet or containing a packet filter for both UL and DL directions matching the UL user data packet; </action> or </control>
<control> <action> b) the QFI of a derived QoS rule associated with the PDU session which has the packet filter for UL direction matching the UL user data packet; </action> <action> by evaluating the QoS rules in increasing order of their precedence values </action> <condition> until the UL user data packet is associated with a QFI or all QoS rules are evaluated. </condition> </control>
<control> <condition> <condition> For PDU session of unstructured PDU session type, </condition> <condition> upon receiving an UL user data packet from the upper layers for transmission via a PDU session, </condition> </condition> <action> the UE shall associate the UL user data packet with the QFI of the default QoS rule associated with the PDU session. </action> </control>
<control> <condition> If the UL user data packet is associated with a QFI, </condition> <action> the UE shall pass the QFI along the UL user data packet to the lower layers for transmission. </action> </control>
NOTE: Marking of the UL user data packet with the QFI is performed by the lower layers.
<control> <condition> <condition> If all QoS rules are evaluated </condition> and <condition> the UL user data packet is not associated with a QFI, </condition> </condition> <action> the UE shall discard the UL user data packet. </action> </control>
6.2.5.1.4 Reflective QoS
6.2.5.1.4.1 General
<control> <action> The UE may support reflective QoS. </action> </control>
If the UE supports the reflective QoS, the UE shall support the procedures in the following subclauses.
<control> <action> The reflective QoS is applicable in a PDU session of IPv4, IPv6, IPv4v6 and Ethernet PDU session type. </action> <control> <action> The reflective QoS is not applicable in a PDU session of Unstructured PDU session type. </action> <control> <action> Reflective QoS is not applicable for a PDU session with control plane only indication. </action> </control> </control> </control>
<control> <action> The UE may request to revoke the usage of reflective QoS for an existing PDU session </action> <condition> for which the UE had previously indicated support for reflective QoS. </condition> </control>
6.2.5.1.4.2 Derivation of packet filter for UL direction from DL user data packet
<control> <condition> If the UE needs to derive a packet filter for UL direction from the DL user data packet (see subclause 6.2.5.1.4.3 and </condition> </control>
<control> 6.2.5.1.4.4), <action> the UE shall proceed as follows: </action> </control>
<control> <condition> a) <condition> if the received DL user data packet belongs to a PDU session of IPv4 or IPv4v6 PDU session type </condition> and <condition> is an IPv4 packet </condition> </condition> and: </control>
<control> <condition> 1) the protocol field of the received DL user data packet indicates TCP as specified in IETF RFC 793 ; </condition> </control>
<control> <condition> 2) the protocol field of the received DL user data packet indicates UDP as specified in IETF RFC 768 ; </condition> or </control>
<control> <condition> 3) <condition> the protocol field of the received DL user data packet indicates ESP as specified in IETF RFC 4303 </condition> and <condition> an uplink IPSec SA corresponding to a downlink IPSec SA indicated in the security parameters index field of the received DL user data packet exists; </condition> </condition> </control>
<control> <action> then the packet filter for UL direction contains the following packet filter components: 1) an IPv4 remote address component set to the value of the source address field of the received DL user data packet; 2) an IPv4 local address component set to the value of the destination address field of the received DL user data packet; 3) a protocol identifier/next header type component set to the value of the protocol field of the received DL user data packet; </action> </control>
<control> <condition> 4) if the protocol field of the received DL user data packet indicates TCP as specified in IETF RFC 793 or UDP as specified in IETF RFC 768 : </condition> </control>
i) a single local port type component set to the value of the destination port field of the received DL user data packet; and
ii) a single remote port type component set to the value of the source port field of the received DL user data packet;
<control> <condition> 5) if the protocol field of the received DL user data packet indicates ESP as specified in IETF RFC 4303 : </condition> </control>
i) a security parameter index type component set to the security parameters index of the uplink IPSec SA corresponding to the downlink IPSec SA indicated in the security parameters index field of the received DL user data packet; and
<control> <condition> 6) if the protocol field of the received DL user data packet indicates UDP and the received DL user data packet contains a UDP-encapsulated ESP header as specified in IETF RFC 3948 : </condition> </control>
i) a security parameter index type component set to the security parameters index of the uplink IPSec SA corresponding to the downlink IPSec SA indicated in the security parameters index field of the ESP header field of the UDP-encapsulated ESP header as specified in IETF RFC 3948 of the received DL user data packet;
<control> <condition> otherwise </condition> <action> it is not possible to derive a packet filter for UL direction from the DL user data packet; </action> </control>
<control> <condition> b) <condition> if the received DL user data packet belongs to a PDU session of IPv6 or IPv4v6 PDU session type </condition> and <condition> is an IPv6 packet </condition> and: </condition> </control>
<control> <condition> 1) the last next header field of the received DL user data packet indicates TCP as specified in IETF RFC 793 ; </condition> </control>
<control> <condition> 2) the last next header field of the received DL user data packet indicates UDP as specified in IETF RFC 768 ; </condition> or </control>
<control> <condition> 3) <condition> the last next header field of the received DL user data packet indicates ESP as specified in IETF RFC 4303 </condition> and <condition> an uplink IPSec SA corresponding to a downlink IPSec SA indicated in the security parameters index field of the received DL user data packet exists; </condition> </condition> </control>
<control> <action> then the packet filter for UL direction contains the following packet filter components: </action> </control>
1) an IPv6 remote address/prefix length component set to the value of the source address field of the received DL user data packet;
2) an IPv6 local address/prefix length component set to the value of the destination address field of the received DL user data packet;
3) a protocol identifier/next header type component set to the value of the last next header field of the received DL user data packet;
<control> <condition> 4) <condition> if the last next header field of the received DL user data packet indicates TCP as specified in IETF RFC 793 </condition> or <condition> UDP as specified in IETF RFC 768 </condition> : </condition> </control>
i) a single local port type component set to the value of the destination port field of the received DL user data packet; and
<control> <condition> ii) a single remote port type component set to the value of the source port field of the received DL user data packet; </condition> </control>
<control> <condition> 5) if the last next header field of the received DL user data packet indicates ESP as specified in IETF RFC 4303 : </condition> </control>
i) a security parameter index type component set to the security parameters index of the uplink IPSec SA corresponding to the downlink IPSec SA indicated in the security parameters index field of the received DL user data packet; and
<control> <condition> 6) <condition> if the protocol field of the received DL user data packet indicates UDP, </condition> and <condition> the received DL user data packet contains a UDP-encapsulated ESP header as specified in IETF RFC 3948 : </condition> </condition> </control>
i) a security parameter index type component set to the security parameters index of the uplink IPSec SA corresponding to the downlink IPSec SA indicated in the security parameters index field of the ESP header field of the UDP-encapsulated ESP header as specified in IETF RFC 3948 of the received DL user data packet;
<control> <condition> otherwise </condition> <action> it is not possible to derive a packet filter for UL direction from the DL user data packet; </action> </control>
<control> <condition> c) if the received DL user data packet belongs to a PDU session of Ethernet PDU session type, </condition> <action> the packet filter for UL direction contains the following packet filter components: </action> </control>
1) a destination MAC address component set to the source MAC address of the received DL user data packet;
2) a source MAC address component set to the destination MAC address of the received DL user data packet;
<control> <condition> 3) if one or more 802.1Q C-TAG is included in the received DL user data packet, </condition> an 802.1Q C-TAG VID component set to the 802.1Q C-TAG VID of the received DL user data packet and an 802.1Q C-TAG PCP/DEI component set to the 802.1Q C-TAG PCP/DEI of the received DL user data packet; </control>
<control> <condition> 4) if one or more 802.1Q S-TAG is included in the received DL user data packet, </condition> an 802.1Q S-TAG VID component set to the 802.1Q S-TAG VID of the received DL user data packet and an 802.1Q S-TAG PCP/DEI component set to the 802.1Q S-TAG PCP/DEI of the received DL user data packet; </control>
<control> <condition> 5) If the Ethertype field of the received DL user data packet is set to a value of 1536 or above, </condition> an Ethertype component set to the Ethertype of the received DL user data packet; </control>
<control> <condition> 6) if the Ethertype field of the Ethernet frame header indicates that the data carried in the Ethernet frame is IPv4 data, </condition> <action> the UE shall also add to the packet filter for UL direction the IP-specific components based on the contents of the IP header of the received DL user data packet as described in bullet a) above; </action> and </control>
<control> <condition> 7) if the Ethertype field of the Ethernet frame header indicates that the data carried in the Ethernet frame is IPv6 data, </condition> <action> the UE shall also add to the packet filter for UL direction the IP-specific components based on the contents of the IP header of the received DL user data packet as described in bullet b) above; </action> and </control>
<control> <condition> d) if the received DL user data packet belongs to a PDU session of PDU session type other than Ethernet, IPv4, IPv6 and IPv4v6, </condition> <action> it is not possible to derive a packet filter for UL direction from the DL user data packet. </action> </control>
6.2.5.1.4.3 Creating a derived QoS rule by reflective QoS in the UE
<control> <condition> <condition> If the UE receives a DL user data packet marked with a QFI and an RQI, </condition> <condition> the DL user data packet belongs to a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, </condition> and <condition> the UE does not have a derived QoS rule with the same packet filter for UL direction as the packet filter for UL direction derived from the DL user data packet as specified in subclause 6.2.5.1.4.2, </condition> </condition> <action> then the UE shall create a new derived QoS rule as follows: </action> </control>
<control> <action> a) the QFI of the derived QoS rule is set to the received QFI; </action> </control>
<control> <action> b) the precedence value of the derived QoS rule is set to 80 (decimal); </action> and </control>
<control> <action> c) the packet filter for UL direction of the derived QoS rule is set to the derived packet filter for UL direction; </action> and <action> the UE shall start the timer T3583 associated with the derived QoS rule with the RQ timer value last received during the UE-requested PDU session establishment procedure of the PDU session (see subclause 6.4.1) or the network- requested PDU session modification procedure of the PDU session (see subclause 6.4.2). </action> <condition> <condition> If the RQ timer value was received neither in the UE-requested PDU session establishment procedure of the PDU session </condition> nor <condition> in any network-requested PDU session modification procedure of the PDU session, </condition> </condition> <action> the default standardized RQ timer value is used. </action> </control>
6.2.5.1.4.4 Updating a derived QoS rule by reflective QoS in the UE
<control> <condition> <condition> If the UE receives a DL user data packet associated with a QFI and an RQI, </condition> <condition> the DL user data packet belongs to a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, </condition> and <condition> the UE has a derived QoS rule with the same packet filter for UL direction as the packet filter for UL direction derived from the DL user data packet as specified in subclause 6.2.5.1.4.2: </condition> </condition> </control>
<control> a) <action> the UE shall re-start the timer T3583 associated with the derived QoS rule with the RQ timer value last received during the UE-requested PDU session establishment procedure of the PDU session (see subclause 6.4.1) or the network-requested PDU session modification procedure of the PDU session (see subclause 6.4.2). </action> <control> <condition> <condition> If the RQ timer value was received neither in the UE-requested PDU session establishment procedure of the PDU session </condition> nor <condition> in any network-requested PDU session modification procedure of the PDU session, </condition> ， </condition> <action> the default standardized RQ timer value is used; </action> </control> </control> and
<control> <condition> b) if the QFI value associated with the DL user data packet is different from the QFI value stored for the derived QoS rule, </condition> <action> the UE shall replace the QFI value stored for the derived QoS rule with the new QFI value for the derived QoS rule. </action> </control>
6.2.5.1.4.5 Deleting a derived QoS rule in the UE
<control> <condition> Upon expiry of timer T3583 associated with a derived QoS rule, </condition> <action> the UE shall remove the derived QoS rule. </action> </control>
<control> <condition> Upon release of the PDU session, </condition> <action> the UE shall remove the derived QoS rule(s) associated with the PDU session. </action> </control>
<control> <condition> <condition> If the network accepts the request from the UE to revoke the usage of reflective QoS </condition> and <condition> sets the value of the RQ timer to "deactivated" or zero, </condition> </condition> <action> the UE shall remove the derived QoS rule(s) associated with the PDU session. </action> </control>
<control> <condition> <condition> Upon inter-system mobility from WB-N1 mode to NB-N1 mode </condition> or <condition> from NR connected to 5GCN to NB-N1 mode, </condition> </condition> <action> the UE shall remove the derived QoS rule(s) associated with the PDU session that is kept active. </action> </control>
<control> <condition> When a derived QoS rule is deleted, </condition> <action> the timer T3583 associated with the derived QoS rule shall be stopped. </action> </control>
6.2.5.1.4.6 Ignoring RQI in the UE
<control> <condition> <condition> If the UE receives a DL user data packet marked with a QFI and an RQI </condition> and <condition> it is not possible to derive a packet filter for UL direction from the DL user data packet as specified in subclause 6.2.5.1.4.2, </condition> </condition> <action> the UE shall ignore the RQI and shall handle the received DL user data packet. </action> </control>
6.2.5.2 QoS in MA PDU session
<control> <condition> In an MA PDU session, </condition> <condition> unless it : </condition> </control>
<control> <condition> a) is established over non-3GPP access; </condition> and </control>
<control> <condition> b) has a PDN connection as a user-plane resource; </condition> <action> the UE shall have one set of QoS rules, one set of QoS flow descriptions and one session-AMBR. </action> <action> The network can provide the set of QoS rules, the set of QoS flow descriptions and the session-AMBR of the MA PDU session via either access of the MA PDU session. </action> <condition> In an MA PDU session, </condition> <action> the UE shall support:- a) modification or deletion via an access of a QoS rule or a QoS flow description; and b) modification via an access of the session-AMBR; </action> <condition> of the MA PDU session created via the same or the other access. </condition> </control>
<control> <condition> In an MA PDU session: </condition> </control>
<control> <condition> a) established over non-3GPP access; </condition> and </control>
<control> <condition> b) with a PDN connection as a user-plane resource; </condition> <action> the UE shall have two sets of QoS rules, two sets of QoS flow descriptions and two session-AMBR values - one is maintained via non-3GPP access and the other is associated with EPS bearer contexts of the PDN connection and maintained via extended protocol configuration options IE parameters received via the PDN connection. </action> </control>
6.2.6 Local area data network (LADN)
<control> <action> The UE can receive the local area data network (LADN) information consisting of LADN DNNs and LADN service area information (a set of tracking areas that belong to the current registration area) </action> <condition> during the registration procedure or the generic UE configuration update procedure (see subclause 5.5.1 and subclause 5.4.4). </condition> </control>
<control> <condition> If the UE is not operating in SNPN access operation mode, </condition> <action> the UE considers the received LADN information to be valid only in the TAIs of the registered PLMN that are in the LADN service area information, and in the TAIs of the equivalent PLMNs if the LADN service area information includes TAIs for the equivalent PLMNs. </action> <condition> When the AMF provides the UE with LADN service area information containing TAIs for the equivalent PLMNs, </condition> <action> the AMF shall include these TAIs of the equivalent PLMNs in the UE's registration area. </action> </control>
<control> <condition> If the UE is operating in SNPN access operation mode, </condition> <action> the UE considers the received LADN information to be valid only in the TAIs of the registered SNPN that are in the LADN service area information. </action> </control>
<control> <action> The LADN DNN(s) received by the UE is also considered as LADN DNN(s) in the equivalent PLMNs. </action> </control>
<control> <action> The UE shall consider itself to be located inside the LADN service area based on the LADN service area information. </action> <control> <condition> If the UE does not have a LADN service area information for the LADN DNN, </condition> <action> the UE shall consider itself to be located outside the LADN service area. </action> </control> </control>
<control> <condition> <condition> When the UE is located in the LADN service area </condition> and <condition> the UE is <start_state> in substate 5GMM-REGISTERED.NORMAL- SERVICE, </start_state> </condition> </condition> <action> the UE may initiate: a) the UE-requested PDU session establishment procedure with a LADN DNN to establish a PDU session for LADN; b) the UE-requested PDU session modification procedure to modify the PDU session for LADN; and c) the service request procedure to re-establish the user-plane resources for the PDU session for LADN. </action> </control>
NOTE 1: <control> <condition> If both the Service area list IE and the LADN information IE were received by the UE, </condition> <action> the Service area list IE is evaluated first. </action> </control>
<control> <condition> When the UE is located outside the LADN service area, </condition> <action> the UE is allowed: <action> a) to initiate the UE-requested PDU session release procedure to release a PDU session for LADN; </action> or <action> b) to initiate the UE-requested PDU session modification procedure to indicate a change of 3GPP PS data off UE status. </action> </action> </control>
<control> <condition> If the UE has moved out of the LADN service area, </condition> the SMF shall: </control>
<control> <action> a) release the PDU session for LADN; </action> or </control>
<control> <action> b) release the user-plane resources for the PDU session for LADN </action> and <action> maintain the PDU session for LADN; </action> according to operator's policy. </control>
<control> <condition> In case b): <condition> a) <condition> if the UE has returned to the LADN service area, </condition> and <condition> the network has downlink user data pending, </condition> </condition> <action> the network re-establishes the user-plane resources for the PDU session for LADN; </action> and. <condition> b) if the UE has not returned to the LADN service area after a period of time according to operator's policy, </condition> <action> the SMF may release the PDU session for LADN. </action> </condition> </control>
<control> <condition> When the UE moves to 5GMM-DEREGISTERED state, </condition> <action> the UE shall delete the stored LADN information, </action> <condition> if any. </condition> </control>
NOTE 2: In this release, LADNs apply only to 3GPP access.
<control> <condition> Upon inter-system change from N1 mode to S1 mode in EMM-IDLE mode, </condition> <action> the UE shall not transfer a PDU session for LADN to EPS. </action> </control>
6.2.7 Handling of DNN based congestion control
<control> <action> The network may detect and start performing DNN based congestion control </action> <condition> when one or more DNN congestion criteria as specified in 3GPP TS 23.501 are met. </condition> <control> <condition> If the UE does not provide a DNN for a non-emergency PDU session, </condition> <action> then the network uses the selected DNN. </action> </control> </control>
<control> <condition> In the UE, </condition> <action> 5GS session management timers T3396 for DNN based congestion control are started </action> and <action> stopped on a per DNN basis </action> <condition> except for an LADN DNN in case of PLMN. </condition> <control> <condition> For an LADN DNN, </condition> <action> 5GS session management timers T3396 for DNN based congestion control is applied to the registered PLMN and its equivalent PLMNs. </action> <control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE does not support access to an SNPN using credentials from a credentials holder, </condition> <condition> in the UE, </condition> </condition> <action> 5GS session management timers T3396 for DNN based congestion control are started and stopped on a per DNN and SNPN basis. </action> <control> <condition> <condition> If the UE supports access to an SNPN using credentials from a credentials holder, </condition> <condition> in the UE 5GS session management </condition> </condition> <action> timers T3396 for DNN based congestion control are started and stopped on a per DNN, SNPN and selected entry of the "list of subscriber data" or selected PLMN subscription basis. </action> <control> <condition> Upon receipt of a 5GMM message or 5GSM message from the network <condition> for which the UE needs to stop the running timers T3396 associated with an LADN DNN as specified in subclause 6.3.2.3, 6.3.3.3, 6.4.1.4.2 and 6.4.2.4.2, </condition> </condition> <action> only the running timer T3396 which is associated with the PLMN and equivalent PLMNs where the timer was started is stopped. </action> </control> </control> </control> </control> </control>
<control> The DNN associated with T3396 is the DNN provided by the UE during the PDU session establishment. <condition> If no DNN is provided by the UE along the PDU SESSION ESTABLISHMENT REQUEST, </condition> <action> then T3396 is associated with no DNN. </action> </control> <control> For this purpose, <action> the UE shall memorize the DNN provided to the network during the PDU session establishment. </action> <control> The timer T3396 associated with no DNN will never be started due to any 5GSM procedure related to an emergency PDU session. </control> </control> <control> <condition> If the timer T3396 associated with no DNN is running, </condition> it does not affect the ability of the UE to request an emergency PDU session. </control>
<control> <condition> If T3396 is running or is deactivated, </condition> <action> then the UE is not allowed to initiate the: </action> </control>
a) PDU session establishment procedure;
b) PDU session modification procedure; or
<control> c) NAS transport procedure for sending CIoT user data; <condition> <condition> for the respective DNN or without a DNN unless the UE is a UE configured for high priority access in selected PLMN </condition> or <condition> to report a change of 3GPP PS data off UE status. </condition> </condition> </control>
6.2.8 Handling of S-NSSAI based congestion control
<control> <action> The network may detect and start performing S-NSSAI based congestion control </action> <condition> when one or more S-NSSAI congestion criteria as specified in 3GPP TS 23.501 are met. </condition> <control> <condition> If the UE does not provide a DNN for a non-emergency PDU session, </condition> <action> then the network uses the selected DNN. </action> </control> <control> <condition> If the UE does not provide an S-NSSAI for a non-emergency PDU session, </condition> <action> then the network uses the selected S-NSSAI. </action> </control> </control>
<control> <condition> <condition> In case of PLMN, </condition> <condition> in the UE, </condition> </condition> <action> 5GS session management timers T3584 for the S-NSSAI based congestion control are started and stopped on a per S-NSSAI, DNN and PLMN basis. </action> <control> <condition> If the 5GSM congestion re-attempt indicator IE with the ABO bit set to "The back-off timer is applied in all PLMNs" is included in the 5GSM message with the 5GSM cause value #67 "insufficient resources for specific slice and DNN", </condition> <action> then the UE applies the timer T3584 for all the PLMNs. </action> </control> </control>
<control> <condition> Otherwise, </condition> <action> the UE applies the timer T3584 for the registered PLMN. </action> <control> <condition> If the timer T3584 applies for all the PLMNs, </condition> <action> the timer T3584 starts </action> <condition> when the UE is registered in a VPLMN and the S-NSSAI is provided by the UE during the PDU session establishment, </condition> the timer T3584 <action> is associated with the [mapped S-NSSAI, DNN] combination of the PDU session. </action> </control> </control>
<control> <condition> In case of PLMN, </condition> <condition> in the UE, </condition> <action> 5GS session management timers T3585 for the S-NSSAI based congestion control are started and stopped on a per S-NSSAI and PLMN basis. </action> <control> <condition> If the 5GSM congestion re-attempt indicator IE with the ABO bit set to "The back-off timer is applied in all PLMNs" is included in the 5GSM message with the 5GSM cause value #69 "insufficient resources for specific slice", </condition> <action> then the UE applies the timer T3585 for all the PLMNs. </action> </control> <control> <condition> Otherwise, </condition> <action> the UE applies the timer T3585 for the registered PLMN. </action> </control> <control> <condition> If the timer T3585 applies for all the PLMNs, </condition> <action> the timer T3585 starts when the UE is registered in a VPLMN and the S-NSSAI is provided by the UE during the PDU session establishment, </action> <action> the timer T3585 is associated with the mapped S-NSSAI of the PDU session. </action> </control> <control> Additionally, <condition> if the 5GSM congestion re-attempt indicator IE with the CATBO bit set to "The back-off timer is applied in the current access type" is included in the 5GSM message with the 5GSM cause value #69 "insufficient resources for specific slice", </condition> <action> then the UE applies the timer T3585 for the current access type. </action> </control> <control> <condition> Otherwise, </condition> <action> the UE applies the timer T3585 for both 3GPP access type and non-3GPP access type. </action> </control> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE does not support access to an SNPN using credentials from a credentials holder, </condition> <condition> in the UE 5GS session management </condition> </condition> <action> timers T3584 for the S-NSSAI based congestion control are started and stopped on a per S- NSSAI, DNN and SNPN basis. </action> <control> <condition> <condition> If the UE supports access to an SNPN using credentials from a credentials holder, </condition> <condition> in the UE 5GS session management </condition> </condition> <action> timers T3584 for the S-NSSAI based congestion control are started and stopped on a per S-NSSAI, DNN, SNPN and selected entry of the "list of subscriber data" or selected PLMN subscription basis. </action> </control> </control>
<control> <condition> <condition> In case of SNPN, </condition> <condition> if the UE does not support access to an SNPN using credentials from a credentials holder, </condition> <condition> in the UE 5GS session management </condition> </condition> <action> timers T3585 for the S-NSSAI based congestion control are started and stopped on a per S- NSSAI and SNPN basis. </action> <control> <condition> <condition> If the UE supports access to an SNPN using credentials from a credentials holder, </condition> <condition> in the UE 5GS session management </condition> </condition> <action> timers T3585 for the S-NSSAI based congestion control are started and stopped on a per S- NSSAI, SNPN and selected entry of the "list of subscriber data" or selected PLMN subscription basis. </action> </control> </control>
<control> <action> The 5GSM congestion re-attempt indicator IE shall not be applicable in an SNPN. </action> </control>
<control> <condition> If the timer T3584 or timer T3585 was provided during the PDU session establishment procedure, </condition> <action> the S-NSSAI associated with T3584 or T3585, respectively is the S-NSSAI, including no S-NSSAI, provided by the UE during the PDU session establishment. </action> </control>
<control> <condition> If the timer T3584 is provided during the PDU session modification or PDU session release procedure, </condition> <control> the UE behaves as follows: <action> The DNN associated with T3584 is the DNN provided by the UE during the PDU session establishment. </action> <control> <condition> If no S-NSSAI but DNN is provided by the UE along the PDU SESSION ESTABLISHMENT REQUEST message, </condition> <action> then T3584 is associated with no S-NSSAI and the DNN provided to the network during the PDU session establishment. </action> </control> <control> <condition> If the PDN connection was established when in the S1 mode, </condition> <action> then T3584 is associated with no S-NSSAI. </action> </control> <control> <condition> If no DNN but S-NSSAI is provided by the UE along the PDU SESSION ESTABLISHMENT REQUEST message, </condition> <action> then T3584 is associated with no DNN and the S-NSSAI of the PDU session. </action> </control> <control> <condition> If no DNN and no S-NSSAI is provided by the UE along the PDU SESSION ESTABLISHMENT REQUEST message, </condition> <action> then T3584 is associated with no DNN and no S- NSSAI. </action> </control> <control> For this purpose, <action> the UE shall memorize the DNN and the S-NSSAI provided to the network during the PDU session establishment. </action> <action> The timer T3584 associated with no DNN and an S-NSSAI will never be started due to any 5GSM procedure related to an emergency PDU session. </action> <control> <condition> If the timer T3584 associated with no DNN and an S-NSSAI is running, </condition> <action> it does not affect the ability of the UE to request an emergency PDU session. </action> </control> </control> </control> </control>
<control> <condition> If the timer T3585 was provided <condition> during the PDU session modification </condition> or <condition> PDU session release procedure, </condition> </condition> <action> the UE behaves as follows: <condition> if an S-NSSAI was provided by the UE during the PDU session establishment, </condition> <action> then T3585 is associated with the S-NSSAI of the PDU session. </action> <condition> If no S-NSSAI is provided by the UE along the PDU SESSION ESTABLISHMENT REQUEST message, </condition> <action> then T3585 is associated with no S-NSSAI . </action> <condition> If the PDN connection was established when in the S1 mode, </condition> <action> then T3585 is associated with no S-NSSAI. </action> </action> </control>
<control> <condition> If T3584 is running or is deactivated, </condition> <action> then the UE is not allowed to initiate the: </action> </control>
a) PDU session establishment procedure;
b) PDU session modification procedure; or
<control> <action> c) NAS transport procedure for sending CIoT user data; </action> <condition> <condition> for the respective [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination unless the UE is a UE configured for high priority access in selected PLMN </condition> or <condition> to report a change of 3GPP PS data off UE status. </condition> </condition> </control>
<control> <condition> <condition> <condition> If the timer T3584 is running </condition> or <condition> is deactivated for all the PLMNs </condition> </condition> and <condition> is associated with an S-NSSAI other than no S- NSSAI, </condition> </condition> then </control> c
<control> a) <action> the UE registered in the HPLMN is not allowed to initiate the: 1) PDU session establishment procedure; 2) PDU session modification procedure; or 3) NAS transport procedure for sending CIoT user data; </action> <condition> <condition> when the [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination provided by the UE during the PDU session establishment is the same as the [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination associated with the timer T3584 </condition> <condition> <condition> unless the UE is a UE configured for high priority access in selected PLMN </condition> or <condition> to report a change of 3GPP PS data off UE status; </condition> </condition> </condition> </control> and <control> <condition> b) the UE registered in a VPLMN </condition> <action> is not allowed to initiate the: 1) PDU session establishment procedure; 2) PDU session modification procedure; or 3) NAS transport procedure for sending CIoT user data; </action> <condition> <condition> when the [mapped S-NSSAI, no DNN] or [mapped S-NSSAI, DNN] combination provided by the UE during the PDU session establishment is the same as the [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination associated with the timer T3584 </condition> <condition> unless the UE is a UE configured for high priority access in selected PLMN </condition> or <condition> to report a change of 3GPP PS data off UE status. </condition> </condition> </control>
<control> <condition> <condition> <condition> If the timer T3584 is running </condition> or <condition> is deactivated for all the PLMNs </condition> </condition> and <condition> is associated with [no S-NSSAI, no DNN] or [no S-NSSAI, DNN] combination, </condition> </condition> <action> then the UE is not allowed to initiate the: a) PDU session establishment procedure; b) PDU session modification procedure; or c) NAS transport procedure for sending CIoT user data; </action> <condition> <condition> for [no S-NSSAI, no DNN] or [no S-NSSAI, DNN] combination in any PLMN </condition> <condition> <condition> unless the UE is a UE configured for high priority access in selected PLMN </condition> or <condition> to report a change of 3GPP PS data off UE status. </condition> </condition> </condition> </control>
<control> <condition> If T3585 is running or is deactivated, </condition> <action> then the UE is neither allowed to initiate the PDU session establishment procedure nor the PDU session modification procedure for the respective S-NSSAI </action> <condition> <condition> unless the UE is a UE configured for high priority access in selected PLMN </condition> or <condition> to report a change of 3GPP PS data off UE status. </condition> </condition> </control>
<control> <condition> <condition> <condition> If the timer T3585 is running </condition> or <condition> is deactivated for all the PLMNs </condition> </condition> and <condition> is associated with an S-NSSAI other than no S- NSSAI, </condition> </condition> then <control> <action> a) the UE registered in the HPLMN is not allowed to initiate the: 1) PDU session establishment procedure; 2) PDU session modification procedure; or 3) NAS transport procedure for sending CIoT user data; </action> <condition> <condition> when the S-NSSAI provided by the UE during the PDU session establishment is the same as the S-NSSAI associated with timer T3585 </condition> <condition> <condition> unless the UE is a UE configured for high priority access in selected PLMNs </condition> or <condition> to report a change of 3GPP PS data off UE status; </condition> </condition> </condition> </control> and <control> <action> b) the UE registered in a VPLMN is not allowed to initiate the: 1) PDU session establishment procedure; 2) PDU session modification procedure; or 3) NAS transport procedure for sending CIoT user data; </action> <condition> <condition> when the mapped S-NSSAI provided by the UE during the PDU session establishment is the same as the S- NSSAI associated the timer T3585 </condition> <condition> unless the UE is a UE configured for high priority access in selected PLMN </condition> or <condition> to report a change of 3GPP PS data off UE status. </condition> </condition> </control> </control>
<control> <condition> <condition> <condition> If the timer T3585 is running </condition> or <condition> is deactivated for all the PLMNs </condition> </condition> and <condition> is associated with no S-NSSAI, </condition> </condition> <action> then the UE is not allowed to initiate the: a) PDU session establishment procedure; b) PDU session modification procedure; c) NAS transport procedure for sending CIoT user data; </action> <condition> <condition> for no S-NSSAI in any PLMN </condition> <condition> <condition> unless the UE is a UE configured for high priority access in selected PLMN </condition> or <condition> to report a change of 3GPP PS data off UE status. </condition> </condition> </condition> </control>
