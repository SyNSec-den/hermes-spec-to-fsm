3 Definitions and abbreviations
3.1 Definitions
For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 .
The term "mobile station" (MS) in the present document is synonymous with the term "user equipment" (UE) as defined in 3GPP TR 21.905 .
1x CS fallback capable UE: A UE that uses a CS infrastructure for a voice call and other CS-domain services by falling back to cdma2000 1x access network if the UE is served by E-UTRAN when a CS service is requested.
5G-EA: 5GS encryption algorithms. The term 5G-EA, 5G-EA0, 128-5G-EA1-3 and 5G-EA4-7 used in the present document corresponds to the term NEA, NEA0, NEA1-3 and NEA4-7 defined in 3GPP TS 33.501 .
5G-IA: 5GS integrity algorithms. The term 5G-IA, 5G-IA0, 128-5G-IA1-3 and 5G-IA4-7 used in the present document corresponds to the term NIA, NIA0, NIA1-3 and NIA4-7 defined in 3GPP TS 33.501 .
Aggregate maximum bit rate: The maximum bit rate that limits the aggregate bit rate of a set of non-GBR bearers of a UE. Definition derived from 3GPP TS 23.401 .
APN based congestion control: Congestion control in session management where the network can reject session management requests from UEs or deactivate PDN connections when the associated APN is congested.
Attached for emergency bearer services: <control> A UE is attached for emergency bearer services <condition> if it has only a PDN connection for emergency bearer services established. </condition> </control>
Attached for access to RLOS: A UE is attached for access to RLOS if the UE requested access to RLOS during the attach procedure and has a PDN connection for RLOS established after completion of attach procedure.
Chosen PLMN: The same as selected PLMN as specified in 3GPP TS 23.122 .
Control plane CIoT EPS optimization: signalling optimizations to enable efficient transport of user data (IP, non-IP, Ethernet or SMS) over control plane via the MME including optional header compression of IP data.
User plane CIoT EPS optimization: signalling optimizations to enable efficient transport of user data (IP, non-IP or Ethernet) over the user plane.
UE supporting CIoT EPS optimizations: A UE that supports control plane CIoT EPS optimization or user plane CIoT EPS optimization and one or more other CIoT EPS optimizations when the UE is in S1 mode.
Attached for EPS services with CP-CIoT EPS optimization: A UE supporting CIoT EPS optimizations is attached for EPS services, and control plane CIoT EPS optimization along with one or more other CIoT EPS optimizations have been accepted by the network.
Attached for EPS services with User plane CIoT EPS optimization: A UE supporting CIoT EPS optimizations is attached for EPS services, and user plane CIoT EPS optimization along with one or more other CIoT EPS optimizations have been accepted by the network.
Attached for EPS services with CIoT EPS optimization: A UE is attached for EPS services with CP-CIoT EPS optimization or attached for EPS services with user plane CIoT EPS optimization.
CS fallback cancellation request: A request received from the MM sublayer to cancel a mobile originating CS fallback.
CS fallback capable UE: A UE that uses a CS infrastructure for a voice call and other CS-domain services by falling back to A/Gb or Iu mode if the UE is served by E-UTRAN when a CS service is requested.
CSG cell: A cell in which only members of the CSG can get normal service. Depending on local regulation, the CSG cell can provide emergency bearer services also to subscribers who are not member of the CSG. Definition derived from 3GPP TS 23.401 .
CSG ID: A CSG ID is a unique identifier within the scope of one PLMN defined in 3GPP TS 23.003 which identifies a Closed Subscriber Group (CSG) in the PLMN associated with a cell or group of cells to which access is restricted to members of the CSG.
CSG selection: A UE supporting CSG selection selects CSG cell either automatically based on the list of allowed CSG identities or manually based on user selection of CSG on indication of list of available CSGs. Definition derived from 3GPP TS 23.122 .
Dedicated bearer: An EPS bearer that is associated with uplink packet filters in the UE and downlink packet filters in the PDN GW where the filters only match certain packets. Definition derived from 3GPP TS 23.401 .
Default bearer: An EPS bearer that gets established with every new PDN connection. Its context remains established throughout the lifetime of that PDN connection. A default EPS bearer is a non-GBR bearer. Definition derived from 3GPP TS 23.401 .
Emergency EPS bearer context: A default EPS bearer context which was activated with request type "emergency" or "handover of emergency bearer services", or any dedicated EPS bearer context associated to this default EPS bearer context.
EMM context: <control> <action> An EMM context is established in the UE and the MME </action> <condition> when an attach procedure is successfully completed. </condition> </control>
EMM-CONNECTED mode: <control> <action> A UE is in EMM-CONNECTED mode </action> <condition> when a NAS signalling connection between UE and network is established. </condition> </control> The term EMM-CONNECTED mode used in the present document corresponds to the term ECM-CONNECTED state used in 3GPP TS 23.401 .
EMM-IDLE mode: <control> <action> A UE is in EMM-IDLE mode </action> <condition> <condition> when no NAS signalling connection between UE and network exists </condition> or <condition> when RRC connection suspend has been indicated by lower layers. </condition> </condition> </control> The term EMM-IDLE mode used in the present document corresponds to the term ECM-IDLE state used in 3GPP TS 23.401 .
EPS security context: In the present specification, EPS security context is used as a synonym for EPS NAS security context specified in 3GPP TS 33.401 .
EPS services: Services provided by PS domain. Within the context of this specification, EPS services is used as a synonym for GPRS services in 3GPP TS 24.008 .
Evolved packet core network: The successor to the 3GPP Release 7 packet-switched core network, developed by 3GPP within the framework of the 3GPP System Architecture Evolution (SAE).
Evolved packet system: The evolved packet system (EPS) or evolved 3GPP packet-switched domain consists of the evolved packet core network and the evolved universal terrestrial radio access network. Definition derived from 3GPP TS 23.401 .
GBR bearer: An EPS bearer that uses dedicated network resources related to a guaranteed bit rate (GBR) value, which are permanently allocated at EPS bearer establishment/modification. Definition derived from 3GPP TS 23.401 .
General NAS level mobility management congestion control: The type of congestion control that is applied at a general overload or congestion situation in the network, e.g. lack of processing resources.
Group specific session management congestion control: Type of congestion control at session management level that is applied to reject session management requests from UEs belonging to a particular group when one or more group congestion criteria as specified in 3GPP TS 23.401 are met.
Highest ranked ACDC category: The ACDC category with the lowest value as defined in 3GPP TS 24.105 .
Initial NAS message: A NAS message is considered as an initial NAS message, if this NAS message can trigger the establishment of a NAS signalling connection. For instance, the ATTACH REQUEST message is an initial NAS message.
IPv4v6 capability: Capability of the IP stack associated with a UE to support a dual stack configuration with both an IPv4 address and an IPv6 address allocated.
Last Visited Registered TAI: A TAI which is contained in the TAI list that the UE registered to the network and which identifies the tracking area last visited by the UE.
Linked Bearer Identity: This identity indicates to which default bearer the additional bearer resource is linked.
LIPA PDN connection: A PDN connection, for which the default EPS bearer context or default PDP context was activated with an APN authorized to use LIPA. The network authorizes an APN for using LIPA based on the subscription profile (see 3GPP TS 29.272 ) and subsequently the network considers this PDN connection a LIPA PDN connection.
Lower layer failure: A failure reported by the AS to the NAS that cannot be corrected on AS level. <control> <condition> When the AS indicates a lower layer failure to NAS, </condition> <action> the NAS signalling connection is not available. </action> </control>
Mapped EPS security context: A mapped security context to be used in EPS. Definition derived from 3GPP TS 33.401 .
Mapped GUTI: A GUTI which is mapped from a P-TMSI and an RAI allocated previously by an SGSN. Mapping rules are defined in 3GPP TS 23.003 . Definition derived from 3GPP TS 23.401 .
Message header: A standard L3 message header as defined in 3GPP TS 24.007 .
MME area: An area containing tracking areas served by an MME.
MO MMTEL voice call is started: the MO-MMTEL-voice-started indication was received from upper layers (see 3GPP TS 24.173 ) and after reception of the MO-MMTEL-voice-started indication, the MO-MMTEL-voice- ended indication has not been received.
MO MMTEL video call is started: the MO-MMTEL-video-started indication was received from upper layers (see 3GPP TS 24.173 ) and after reception of the MO-MMTEL-video-started indication, the MO-MMTEL-video- ended indication has not been received.
MO SMSoIP is started: the MO-SMSoIP-attempt-started indication was received from upper layers (see 3GPP TS 24.341 ) and after reception of the MO-SMSoIP-attempt-started indication, the MO-SMSoIP-attempt- ended indication has not been received.
NAS level mobility management congestion control: Congestion control mechanism in the network in mobility management. "NAS level mobility management congestion control" consists of "subscribed APN based congestion control" and "general NAS level mobility management congestion control".
NAS signalling connection: A peer to peer S1 mode connection between UE and MME. A NAS signalling connection consists of the concatenation of an RRC connection via the "LTE-Uu" interface and an S1AP connection via the S1 interface. Additionally, for the purpose of optimized handover or idle mode mobility from cdma2000 HRPD access to E-UTRAN (see 3GPP TS 23.402 ), the NAS signalling connection can consist of a concatenation of an S101-AP connection and a signalling tunnel over a cdma2000 HRPD access network.
NOTE 1: cdma2000 is a registered trademark of the Telecommunications Industry Association (TIA-USA).
NAS signalling connection recovery: A mechanism initiated by the NAS to restore the NAS signalling connection on indication of "RRC connection failure" by the lower layers.
Native GUTI: A GUTI previously allocated by an MME. Definition derived from 3GPP TS 23.401 .
Non-access stratum protocols: The protocols between UE and MSC or SGSN that are not terminated in the UTRAN, and the protocols between UE and MME that are not terminated in the E-UTRAN. Definition derived from 3GPP TR 21.905 .
Non-emergency EPS bearer context: Any EPS bearer context which is not an emergency EPS bearer context.
Non-EPS services: Services provided by CS domain. Within the context of this specification, non-EPS services is used as a synonym for non-GPRS services in 3GPP TS 24.008 . A UE which camps on E-UTRAN can attach to both EPS services and non-EPS services.
Non-GBR bearer: An EPS bearer that uses network resources that are not related to a guaranteed bit rate (GBR) value.
Definition derived from 3GPP TS 23.401 .
PDN address: An IP address assigned to the UE by the Packet Data Network Gateway (PDN GW).
PDN connection for emergency bearer services: A PDN connection for which the default EPS bearer context or default PDP context was activated with request type "emergency" or "handover of emergency bearer services".
PDN connection for RLOS: A PDN connection for which the default EPS bearer context was activated with request type "RLOS".
Plain NAS message: A NAS message with a header including neither a message authentication code nor a sequence number.
Persistent EPS bearer context: either a non-emergency EPS bearer context representing a GBR bearer with QoS equivalent to QoS of teleservice 11 and where there is a radio bearer associated with that context, or an emergency EPS bearer context where there is a radio bearer associated with that context.
NOTE 2: An example of a persistent EPS bearer context is a non-emergency EPS bearer context with QCI = 1 where there is a radio bearer associated with that context.
<control> Procedure Transaction Identity: An identity which is dynamically allocated by the UE for the UE requested ESM procedures. <action> The procedure transaction identity is released </action> <condition> when the procedure is completed. </condition> </control>
RAT-related TMSI: <control> <condition> When the UE is camping on an E-UTRAN cell, </condition> <action> the RAT-related TMSI is the GUTI; </action> </control> <control> <condition> when it is camping on a GERAN or UTRAN cell, </condition> <action> the RAT-related TMSI is the P-TMSI. </action> </control>
Registered PLMN: The PLMN on which the UE is registered. The identity of the registered PLMN is provided to the UE within the GUTI.
Relay node: A network element in the E-UTRAN, wirelessly connected to an eNode B and providing relaying function to UEs served by the E-UTRAN. Definition derived from 3GPP TS 23.401 .
Removal of eCall only mode restriction: All the limitations as described in 3GPP TS 22.101 for the eCall only mode do not apply any more.
RLOS EPS bearer context: A default RLOS EPS bearer context which was activated with request type "RLOS", or any dedicated EPS bearer context associated to this default EPS bearer context.
The label (S1 mode only) indicates that this subclause or paragraph applies only to a system which operates in S1 mode, i.e. with a functional division that is in accordance with the use of an S1 interface between the radio access network and the core network. The S1 mode includes WB-S1 mode and NB-S1 mode. In a multi-access system this case is determined by the current serving radio access network.
In NB-S1 mode: Indicates this paragraph applies only to a system which operates in NB-S1 mode. For a multi-access system this case applies if the current serving radio access network provides access to network services via E-UTRA by NB-IoT (see 3GPP TS 36.300 , 3GPP TS 36.331 , 3GPP TS 36.306 ).
In WB-S1 mode: Indicates this paragraph applies only to a system which operates in WB-S1 mode. For a multi-access system this case applies if the system operates in S1 mode, but not in NB-S1 mode.
In WB-S1/CE mode: Indicates this paragraph applies only when a UE, which is a CE mode B capable UE (see 3GPP TS 36.306 ), is operating in CE mode A or B in WB-S1 mode.
SCEF PDN Connection: A PDN connection established between the UE and the Service Capability Exposure Function (SCEF) for transmitting the UE's non-IP data related to a specific application.
SGi PDN Connection: A PDN connection established between the UE and the Packet Gateway (P-GW) for transmitting the UE's IP, non-IP or Ethernet data related to a specific application.
S101 mode: Applies to a system that operates with a functional division that is in accordance with the use of an S101 interface. For the definition of the S101 reference point, see 3GPP TS 23.402 .
SIPTO at the local network PDN connection: A PDN connection, for which the default EPS bearer context or default PDP context was activated with an APN authorized to use SIPTO at the local network and it was activated such that the traffic of the PDN connection will be using an L-GW. The network authorizes an APN for using SIPTO at the local network based on the subscription profile (see 3GPP TS 29.272 ) and subsequently the network considers this PDN connection a SIPTO at the local network PDN connection. SIPTO at the local network PDN connection can be of IP, non-IP or Ethernet PDN type.
SIPTO at the local network PDN connection with a collocated L-GW: A SIPTO at the local network PDN connection which is established to a L-GW function collocated with the (H)(e)NodeB. <control> The core-network entity (i.e. the MME or the SGSN) can be aware of whether the SIPTO at the local network PDN connection with a collocated L-GW is used <condition> when the PDN connection is established. </condition> </control>
SIPTO at the local network PDN connection with a stand-alone GW: A SIPTO at the local network PDN connection which is established to a stand-alone GW (with collocated L-GW and S-GW). <control> The core-network entity (i.e. the MME or the SGSN) can be aware of whether the SIPTO at the local network PDN connection with a stand-alone GW is used <condition> when the PDN connection is established. </condition> </control>
"SMS only": A subset of services which includes only Short Message Service. A UE camping on E-UTRAN can attach to both EPS services and "SMS only".
SMS over NAS: refers to SMS in MME or SMS over SGs.
SMS over S102: refers to SMS which uses 1xCS procedures in EPS as defined in 3GPP TS 23.272 .
Subscribed APN based congestion control: Congestion control in mobility management where the network can reject attach requests from UEs with a certain APN in the subscription.
TAI list: A list of TAIs that identify the tracking areas that the UE can enter without performing a tracking area updating procedure. The TAIs in a TAI list assigned by an MME to a UE pertain to the same MME area.
Traffic flow aggregate: A temporary aggregate of packet filters that are included in a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure and that is inserted into a traffic flow template (TFT) for an EPS bearer context by the network once the UE requested bearer resource allocation procedure or UE requested bearer resource modification procedure is completed.
UE configured for dual priority: A UE which provides dual priority supportis configured for NAS signalling low priority and also configured to override the NAS signalling low priority indicator (see 3GPP TS 24.368 , 3GPP TS 31.102 ).
UE configured to use AC11 15 in selected PLMN: A UE configured with at least one access class in the range 11-15 on the USIM, and the access class is applicable in the selected PLMN according to 3GPP TS 22.011 .
<control> UE's availability for voice calls in the IMS: The indication of this availability or non-availability is provided by the upper layers of the UE as specified in 3GPP TS 24.229 in the annex relevant to the IP-Connectivity Access Network in use or determined in the NAS layer, as specified in subclause 4.3.1. <condition> If availability is indicated, </condition> <action> the UE uses the IM CN Subsystem </action> and <action> can terminate or originate requests for SIP sessions including an audio component with codecs suited for voice. </action> </control>
UE's usage setting: This is a UE setting that indicates whether the UE has preference for voice services over data services or vice-versa. <control> <condition> If a UE has preference for voice services, </condition> <action> then the UE's usage setting is "voice centric". </action> </control> <control> <condition> If a UE has preference for data services, </condition> <action> then the UE's usage setting is "data centric". </action> </control> A UE whose setting is "data centric" may still require access to voice services. A UE whose setting is "voice centric" may still require access to data services.
This definition is derived from 3GPP TS 23.221 and it applies to voice capable UEs. <control> <condition> If the UE is capable of both S1 mode and N1 mode, </condition> there is a single UE's usage setting which applies to both 5GS and EPS (see 3GPP TS 24.501 ). </control>
UE using EPS services with control plane CIoT EPS optimization: A UE that is attached for EPS services with the control plane CIOT EPS optimization accepted by the network.
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.221 apply: Restricted local operator services
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.401 apply: APN rate control status
Cellular IoT (CIoT) DCN-ID eCall only mode NarrowBand-IoT
Dedicated core network PDN connection
Service Gap Control UE paging probability information
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.272 apply: CS fallback SMS in MME SMS over SGs
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.682 apply: SCEF
For the purposes of the present document, the following terms and definitions given in 3GPP TS 24.008 apply: A/Gb mode
Access domain selection
Default PDP context
Extended idle-mode DRX cycle
Iu mode
Power saving mode PS signalling connection RR connection TFT
For the purposes of the present document, the following terms and definitions given in 3GPP TS 33.102 apply: UMTS security context
For the purposes of the present document, the following terms and definitions given in 3GPP TS 33.401 apply: Current EPS security context
Full native EPS security context
Mapped security context
Native EPS security context
Non-current EPS security context
Partial native EPS security context
Data via MME
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.122 apply: Country EHPLMN HPLMN
Shared Network
Suitable Cell VPLMN
Limited Service State
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.216 apply: SRVCC vSRVCC
For the purposes of the present document, the following terms and definitions given in 3GPP TS 22.011 apply: Extended Access Barring
Application specific Congestion control for Data Communication (ACDC)
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.003 apply: Local Home Network Identifier
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.303 apply: ProSe direct communication ProSe direct discovery ProSe UE-to-Network Relay
For the purposes of the present document, the following terms and definitions given in 3GPP TS 24.161 apply: Multi-access PDN connection NBIFOM
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.167 apply: eCall over IMS
For the purposes of the present document, the following terms and definitions given in 3GPP TS 24.501 apply: 5GMM-CONNECTED mode
5GMM-IDLE mode
Applicable UE radio capability ID for the current UE radio configuration in the selected network
Control plane CIoT 5GS optimization
N1 mode NB-N1 mode UE operating in single-registration mode in a network supporting N26 interface User plane CIoT 5GS optimization
3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 .
5G-GUTI 5G-Globally Unique Temporary Identifier
5GMM 5GS Mobility Management
5GS 5G System ACDC Application specific Congestion control for Data Communication AKA Authentication and Key Agreement AMBR Aggregate Maximum Bit Rate APN Access Point Name APN-AMBR APN Aggregate Maximum Bit Rate ARP Allocation Retention Priority BCM Bearer Control Mode CIoT Cellular IoT CP-CIoT Control Plane CIoT CP-EDT Control Plane EDTCSG Closed Subscriber Group E-UTRA Evolved Universal Terrestrial Radio Access E-UTRAN Evolved Universal Terrestrial Radio Access Network EAB Extended Access Barring ECM EPS Connection Management eDRX Extended idle-mode DRX cycle EDT Early Data Transmission EENLV Extended Emergency Number List Validity eKSI Key Set Identifier for E-UTRAN EMM EPS Mobility Management eNode B Evolved Node B EPC Evolved Packet Core Network EPS Evolved Packet System ESM EPS Session Management GBR Guaranteed Bit Rate GUMMEI Globally Unique MME Identifier GUTI Globally Unique Temporary Identifier HeNB Home eNode B HRPD High Rate Packet Data IoT Internet of Things IP-CAN IP-Connectivity Access Network ISR Idle mode Signalling Reduction kbps Kilobits per second KSI Key Set Identifier L-GW Local PDN Gateway LHN-ID Local Home Network Identifier LIPA Local IP Access M-TMSI M-Temporary Mobile Subscriber Identity
Mbps Megabits per second MBR Maximum Bit Rate MME Mobility Management Entity MMEC MME Code MT-EDT Mobile Terminated-Early Data Transmission NB-IoT Narrowband IoT NR New Radio NSSAI Network Slice Selection Assistance Information PD Protocol Discriminator PDN GW Packet Data Network Gateway ProSe Proximity-based Services PSM Power Saving Mode PTI Procedure Transaction Identity QCI QoS Class Identifier QoS Quality of Service RACS Radio Capability Signalling Optimisation RLOS Restricted Local Operator Services ROHC RObust Header Compression RRC Radio Resource Control S-NSSAI Single NSSAI S-TMSI S-Temporary Mobile Subscriber Identity S101-AP S101 Application Protocol S1AP S1 Application Protocol SAE System Architecture Evolution SCEF Service Capability Exposure Function SGC Service Gap Control SIPTO Selected IP Traffic Offload TA Tracking Area TAC Tracking Area Code TAI Tracking Area Identity TFT Traffic Flow Template TI Transaction Identifier TIN Temporary Identity used in Next update URN Uniform Resource Name V2X Vehicle-to-Everything WUS Wake-Up Signal
4 General
4.1 Overview
The non-access stratum (NAS) described in the present document forms the highest stratum of the control plane between UE and MME at the radio interface (reference point "LTE-Uu"; see 3GPP TS 23.401 ).
Main functions of the protocols that are part of the NAS are: a) the support of mobility of the user equipment (UE); and b) the support of session management procedures to establish and maintain IP connectivity between the UE and a packet data network gateway (PDN GW).
NAS security is an additional function of the NAS providing services to the NAS protocols, e.g. integrity protection and ciphering of NAS signalling messages.
For the support of the above functions, the following procedures are supplied within this specification: a) elementary procedures for EPS mobility management in clause 5; and b) elementary procedures for EPS session management in clause 6.
Complete NAS transactions consist of specific sequences of elementary procedures. Examples of such specific sequences can be found in 3GPP TS 23.401 .
The NAS for EPS follows the protocol architecture model for layer 3 as described in 3GPP TS 24.007 ; however, due to the objective of EPS to provide the subscriber with a "ready-to-use" IP connectivity and an "always-on" experience, the protocol supports a linkage between mobility management and session management procedures during the attach procedure (see subclause 4.2).
Signalling procedures for the control of NAS security are described as part of the EPS mobility management in clause 5. In addition to that, principles for the handing of EPS security contexts and for the activation of ciphering and integrity protection, when a NAS signalling connection is established, are provided in subclause 4.4.
4.2 Linkage between the protocols for EPS mobility management and EPS session management
<control> <condition> During the EPS attach procedure, </condition> <action> the network can activate a default EPS bearer context </action> <condition> (i.e. if the UE requests PDN connectivity in the attach request). </condition> Additionally, <action> the network can activate one or several dedicated EPS bearer contexts in parallel for PDN connections of IP or Ethernet PDN type. </action> <action> To this purpose the EPS session management messages for the default EPS bearer context activation can be transmitted in an information element in the EPS mobility management messages. </action> </control> In this case, the UE and the network execute the attach procedure, the default EPS bearer context activation procedure, and the dedicated EPS bearer context activation procedure in parallel. <control> <action> The UE and network shall complete the combined default EPS bearer context activation procedure and the attach procedure </action> <condition> before the dedicated EPS bearer context activation procedure is completed. </condition> </control> <control> <condition> If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> then the success of the attach procedure is dependent on the success of the default EPS bearer context activation procedure. </control> <control> <condition> If the attach procedure fails, </condition> <action> then the ESM procedures also fail. </action> </control>
<control> <condition> A UE using EPS services with control plane CIoT EPS optimization </condition> <action> can initiate transport of user data via the control plane. </action> <action> For this purpose a UE in EMM-IDLE mode can initiate the service request procedure </action> and <action> transmit the ESM DATA TRANSPORT message in an information element in the CONTROL PLANE SERVICE REQUEST message. </action> </control>
<control> <condition> Except for the attach procedure and the service request procedure, </condition> <condition> during EMM procedures </condition> <action> the MME shall suspend the transmission of ESM messages. </action> </control> <control> <condition> During the service request procedure </condition> <action> the MME may suspend the transmission of ESM messages. </action> </control>
<control> <condition> Except for the attach procedure and the service request procedure for UE initiated transport of user data via the control plane, </condition> <condition> during EMM procedures </condition> <action> the UE shall suspend the transmission of ESM messages. </action> </control>
4.2A Handling of NAS signalling low priority indication
<control> <condition> A UE configured for NAS signalling low priority </condition> (see 3GPP TS 24.368 , 3GPP TS 31.102 ) <action> indicates this by including the Device properties IE in the appropriate NAS message </action> and <action> setting the low priority indicator to "MS is configured for NAS signalling low priority", </action> </control> <control> <condition> except for the following cases </condition> <action> in which the UE shall set the low priority indicator to "MS is not configured for NAS signalling low priority": </action> <condition> <condition> a) the UE is performing an attach for emergency bearer services; </condition> <condition> b) <condition> <condition> the UE has a PDN connection for emergency bearer services established </condition> and <condition> is performing EPS mobility management procedures, </condition> </condition> or <condition> is establishing a PDN connection for emergency bearer services; </condition> </condition> <condition> c) <condition> the UE configured for dual priority </condition> <condition> is requested by the upper layers to establish a PDN connection </condition> <condition> with the low priority indicator set to "MS is not configured for NAS signalling low priority"; </condition> </condition> <condition> d) <condition> the UE configured for dual priority </condition> <condition> is performing EPS session management procedures </condition> <condition> related to the PDN connection established <condition> </condition> with low priority indicator set to "MS is not configured for NAS signalling low priority"; </condition> </condition> <condition> e) <condition> the UE configured for dual priority </condition> <condition> has a PDN connection established </condition> </condition> by setting the low priority indicator to "MS is not configured for NAS signalling low priority" <condition> and <condition> is performing EPS mobility management procedures; </condition> </condition> <condition> f) <condition> the UE is performing a service request procedure </condition> <condition> for a CS fallback emergency call or 1xCS fallback emergency call; </condition> </condition> <condition> g) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> or <condition> h) the UE is responding to paging. </condition> </condition> </control>
The network may use the NAS signalling low priority indication for NAS level mobility management congestion control and APN based congestion control.
<control> <condition> If the NAS signalling low priority indication is provided in a PDN CONNECTIVITY REQUEST message, </condition> <action> the MME stores the NAS signalling low priority indication within the default EPS bearer context activated due to the PDN connectivity request procedure. </action> </control>
4.3 UE mode of operation
4.3.1 General
<control> <condition> A UE attached for EPS services </condition> <action> shall operate in one of the following operation modes: a) PS mode 1 of operation: the UE registers only to EPS services, and UE's usage setting is "voice centric"; b) PS mode 2 of operation: the UE registers only to EPS services, and UE's usage setting is "data centric"; c) CS/PS mode 1 of operation: the UE registers to both EPS and non-EPS services, and UE's usage setting is "voice centric"; and d) CS/PS mode 2 of operation: the UE registers to both EPS and non-EPS services, and UE's usage setting is "data centric". </action> </control>
<control> <condition> A UE configured to use CS fallback, </condition> <action> shall operate in CS/PS mode 1 or CS/PS mode 2. </action> <control> <condition> Such UE may also be configured to use IMS, </condition> in which case <action> the voice domain preference for E-UTRAN as defined in 3GPP TS 24.167 shall be used </action> <condition> for the selection of the domain for originating voice communication services. </condition> </control> </control>
NOTE 1: The domain selected for originating voice communication services can be ignored by attempting a CS emergency call.
<control> <condition> Upon request from upper layers to establish a CS emergency call: </condition> <control> a) <condition> <condition> if the UE needs to initiate a CS fallback emergency call </condition> <condition> but it is unable to perform CS fallback, </condition> </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology, </action> and <action> a UE with "IMS voice not available" should disable the E-UTRA capability (see subclause 4.5) to allow a potential callback, </action> and <action> then progress the CS emergency call establishment; </action> </control> <control> b) <condition> <condition> if the UE needs to initiate a 1xCS fallback emergency call </condition> <condition> but it is unable to perform 1xCS fallback, </condition> </condition> <action> the UE shall attempt to select cdma2000 1x radio access technology to establish the call. </action> </control> </control>
NOTE 2: Unable to perform CS fallback or 1xCS fallback means that either the UE was not allowed to attempt CS fallback or 1xCS fallback, or CS fallback or 1xCS fallback attempt failed.
<control> <condition> A UE configured to use SMS over SGs </condition> <action> shall operate in CS/PS mode 1 or CS/PS mode 2. </action> </control>
<control> The behaviour of the UE in CS/PS mode 1 of operation, <condition> <condition> upon failure to access the CS domain </condition> or <condition> upon reception of a "CS fallback not preferred" or "SMS only" indication, </condition> </condition> will depend on the availability of voice over IMS. In the present document, "IMS voice not available" refers to one of the following conditions: a) the UE is not configured to use IMS; b) the UE is not configured to use IMS voice, i.e. when the voice domain preference for E-UTRAN, as defined in 3GPP TS 24.167 , indicates that voice communication services are allowed to be invoked only over the CS domain; c) the UE is configured to use IMS voice, but the network indicates in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message that IMS voice over PS sessions are not supported; or d) the UE is configured to use IMS voice, the network indicates in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message that IMS voice over PS sessions are supported, but the upper layers: a) provide no indication that the UE is available for voice call in the IMS within a manufacturer determined period of time; or b) indicate that the UE is not available for voice calls in the IMS. </control>
NOTE 3: <control> <condition> If conditions a, b and c evaluate to false, </condition> the upper layers need time to attempt IMS registration. <condition> In the event an indication from the upper layers that the UE is available for voice calls in the IMS takes longer than the manufacturer determined period of time (e.g. due to delay </condition> <condition> <condition> when attempting IMS registration </condition> or <condition> due to delay obtaining an EPS bearer context for SIP signalling), </condition> </condition> the NAS layer assumes the UE is not available for voice calls in the IMS. </control>
Other conditions may exist but these are implementation specific.
In the present document, "IMS voice available" refers to the conditions a, b, c and d, and other implementation specific conditions for "IMS voice not available" evaluate to false.
4.3.2 Change of UE mode of operation
4.3.2.1 General
The UE mode of operation can change as a result of e.g.: a) a change of UE's usage setting for a CS voice capable UE; b) a change of voice domain preference for E-UTRAN as defined in 3GPP TS 24.167 for a CS voice capable UE; c) a change in the UE's availability for voice calls in the IMS; or d) a change in UE configuration regarding the use of SMS as defined in 3GPP TS 24.167 .
settings, voice domain preference for E-UTRAN or configuration regarding SMS changes.
Voice centric a) Voice Domain Preference for E-UTRAN changed b) from "IMS PS voice only" to "CS voice only"; c) from "IMS PS voice only" to "CS voice preferred, IMS PS Voice as secondary"; d) from "IMS PS voice preferred, CS Voice as secondary" to "CS voice only"; or e) from "IMS PS voice preferred, CS Voice as secondary" to "CS voice preferred, IMS PS Voice as secondary".
a) Unsuccessful IMS registration indication from upper layers and b) Voice Domain Preference for E-UTRAN is "IMS PS voice preferred, CS Voice as secondary"; or c) SMS configuration is set to prefer to use SMS over IP networks
CS/PS mode 1 PS mode 1 a) Voice Domain Preference for E-UTRAN changed from any configuration to "IMS PS voice only", UE is configured to prefer SMS over IP networks and is IMS registered. b) SMS configuration changed to prefer to use SMS over IP networks, UE is IMS registered and Voice
Domain Preference is "IMS PS voice only".
a) Voice Domain Preference for E-UTRAN changed from any configuration to "IMS PS voice only", UE is configured to prefer to use SMS over IP networks and the UE is IMS registered. b) SMS configuration changed to prefer to use SMS over IP networks, UE is IMS registered and Voice Domain Preference for E-UTRAN is "IMS PS voice only".
CS/PS mode 2 PS mode 2 a) Voice Domain Preference for E-UTRAN changed b) from "IMS PS voice only" to "CS voice only"; c) from "IMS PS voice only" to "CS voice preferred, IMS PS Voice as secondary"; d) from "IMS PS voice preferred, CS Voice as secondary" to "CS voice only"; or e) from "IMS PS voice preferred, CS Voice as secondary" to "CS voice preferred, IMS PS Voice as secondary".
a) Unsuccessful IMS registration indication from upper layers and b) Voice Domain Preference for E-UTRAN is "IMS PS voice preferred, CS Voice as secondary"; or c) SMS configuration is set to prefer to use SMS over IP networks. d) SMS configuration changed to not to use SMS over IP networks.
Data centric
NOTE 1: <control> <action> The UE may transit from CS/PS mode 1 to PS mode 1 or from CS/PS mode 2 to PS mode 2 </action> <condition> if "CS domain not available" is received. </condition> <control> <condition> After the transition to PS mode 1 or PS mode 2 due to "CS domain not available", </condition> <action> the UE can transit back to CS/PS mode 1 or CS/PS mode 2, </action> <condition> e.g. due to change of PLMN which is not in the list of the equivalent PLMNs. </condition> </control> </control>
NOTE 2: Not all possible transitions are shown in this figure. a) Unsuccessful IMS registration indication from upper layers.
a) SMS configuration changed to not to use SMS over IP networks.
CS/PS mode 1 PS mode 1 a) SMS configuration changed to prefer to use SMS over IP networks and UE is IMS registered b) Unsuccessful IMS registration indication from upper layers.
a) SMS configuration changed to not to use SMS over IP networks.
CS/PS mode 2 PS mode 2 a) SMS configuration changed to prefer to use SMS over IP networks and UE is IMS registered
NOTE: Not all possible transitions are shown in this figure.
4.3.2.2 Change of UE's usage setting
Whenever the UE's usage setting changes, the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.2.1 and table 4.3.2.2.2: a) The UE is operating in PS mode 1 or PS mode 2
b) The UE is operating in CS/PS mode 1 or CS/PS mode 2
4.3.2.3 Change of voice domain preference for E-UTRAN
Whenever the voice domain preference for E-UTRAN changes, the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.3.1 and table 4.3.2.3.2: a) The UE is operating in PS mode 1 or PS mode 2
b) The UE is operating in CS/PS mode 1 or CS/PS mode 2 mode 2
4.3.2.4 Change or determination of IMS registration status
Whenever the UE's availability for voice calls in the IMS is determined or changes (e.g. whenever the IMS registration status is determined or changes), the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.4.1, 4.3.2.4.2 or 4.3.2.4.3: a) The UE is operating in PS mode 1 NOTE 1: If the UE in PS mode 1 transits to CS/PS mode 1 according to table 4.3.2.4.1, then the UE can return to PS mode 1 when the upper layer indicates the status of being available for voice over PS.
b) The UE is operating in PS mode 2
NOTE 2: If the UE in PS mode 2 transits to CS/PS mode 2 according to table 4.3.2.4.2, then the UE can return to PS mode 2 when the upper layer indicates the status of being available for voice over PS.
c) The UE is operating in CS/PS mode 1
4.3.2.5 Change of configuration regarding the use of SMS.
<control> <condition> Whenever the UE's configuration on use of SMS changes, </condition> the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.5.1 and table 4.3.2.5.2: a) The UE is operating in PS mode 1 or PS mode 2 b) The UE is operating in CS/PS mode 1 or CS/PS mode 2 </control>
4.4 NAS security
4.4.1 General
This clause describes the principles for the handling of EPS security contexts in the UE and in the MME and the procedures used for the security protection of EPS NAS messages between UE and MME. Security protection involves integrity protection and ciphering of the EMM and ESM NAS messages.
The signalling procedures for the control of NAS security are part of the EMM protocol and are described in detail in clause 5.
NOTE: The use of ciphering in a network is an operator option. In this subclause, for the ease of description, it is assumed that ciphering is used, unless explicitly indicated otherwise. Operation of a network without ciphering is achieved by configuring the MME so that it always selects the "null ciphering algorithm", EEA0.
4.4.2 Handling of EPS security contexts
4.4.2.1 General
The security parameters for authentication, integrity protection and ciphering are tied together in an EPS security context and identified by a key set identifier for E-UTRAN (eKSI). The relationship between the security parameters is defined in 3GPP TS 33.401 .
<control> <condition> Before security can be activated, </condition> <action> the MME and the UE need to establish an EPS security context. </action> </control> <control> Usually, <action> the EPS security context is created </action> <condition> as the result of an EPS authentication procedure between MME and UE. </condition> </control> Alternatively: <control> a) <condition> during inter-system handover from A/Gb mode to S1 mode or from Iu mode to S1 mode, </condition> <action> the MME and the UE derive a mapped EPS security context from a UMTS security context that has been established while the UE was in A/Gb mode or Iu mode; </action> </control> or <control> b) <condition> during CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode, </condition> <action> the MME and the UE derive a mapped EPS security context from a CS UMTS security context that has been established while the UE was in A/Gb mode or Iu mode. </action> </control>
The EPS security context is taken into use by the UE and the MME, when the MME initiates a security mode control procedure or during the inter-system handover procedure from A/Gb mode to S1 mode or Iu mode to S1 mode. The EPS security context which has been taken into use by the network most recently is called current EPS security context.
This current EPS security context can be of type native or mapped, i.e. originating from a native EPS security context or mapped EPS security context.
The key set identifier eKSI is assigned by the MME either during the EPS authentication procedure or, for the mapped EPS security context, during the inter-system handover procedure. The eKSI consists of a value and a type of security context parameter indicating whether an EPS security context is a native EPS security context or a mapped EPS security context. <control> <condition> When the EPS security context is a native EPS security context, </condition> <action> the eKSI has the value of KSI , </action> </control> and <control> <condition> when the current EPS security context is of type mapped, </condition> <action> the eKSI has the value of KSI . </action> </control>
<control> The EPS security context which is indicated by an eKSI can be taken into use to establish the secure exchange of NAS messages <condition> when a new NAS signalling connection is established without executing a new EPS authentication procedure (see subclause 4.4.2.3) or when the MME initiates a security mode control procedure. </condition> </control> <control> For this purpose the initial NAS messages (i.e. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, DETACH REQUEST, SERVICE REQUEST, EXTENDED SERVICE REQUEST, and CONTROL PLANE SERVICE REQUEST) and the SECURITY MODE COMMAND message contain an eKSI in the NAS key set identifier IE or the value part of eKSI in the KSI and sequence number IE indicating the current EPS security context used to integrity protect the NAS message. </control>
In the present document, <control> <condition> when the UE is required to delete an eKSI, </condition> <action> the UE shall set the eKSI to the value "no key is available" </action> and <action> consider also the associated keys K or K' , EPS NAS ciphering key and EPS NAS integrity key invalid (i.e. the EPS security context associated with the eKSI as no longer valid). </action> </control>
NOTE: In some specifications the term ciphering key sequence number might be used instead of the term Key Set Identifier (KSI).
The UE and the MME need to be able to maintain two EPS security contexts simultaneously, i.e. a current EPS security context and a non-current EPS security context, since: a) after an EPS re-authentication, the UE and the MME can have both a current EPS security context and a non- current EPS security context which has not yet been taken into use (i.e. a partial native EPS security context); and b) after an inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the UE and the MME can have both a mapped EPS security context, which is the current EPS security context, and a non-current native EPS security context that was created during a previous access in S1 mode or S101 mode.
The number of EPS security contexts that need to be maintained simultaneously by the UE and the MME is limited by the following requirements: <control> a) <condition> <condition> After a successful EPS (re-)authentication, </condition> <condition> which creates a new partial native EPS security context, </condition> </condition> <action> the MME and the UE shall delete the non-current EPS security context, </action> <condition> if any. </condition> </control> <control> b) <condition> When a partial native EPS security context is taken into use through a security mode control procedure, </condition> <action> the MME and the UE shall delete the previously current EPS security context. </action> </control> <control> c) <condition> <condition> When the MME and the UE create an EPS security context using null integrity and null ciphering algorithm </condition> <condition> during an attach procedure for emergency bearer services, or a tracking area updating procedure for a UE that has a PDN connection for emergency bearer services (see subclause 5.4.3.2), </condition> </condition> <action> the MME and the UE shall delete the previous current EPS security context. </action> </control> <control> d) <condition> <condition> When a new mapped EPS security context or EPS security context created using null integrity and null ciphering algorithm is taken into use </condition> <condition> during the inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, </condition> </condition> <action> the MME and the UE shall not delete the previously current native EPS security context, </action> <condition> if any. </condition> <action> Instead, the previously current native EPS security context shall become a non-current native EPS security context, </action> and <action> the MME and the UE shall delete any partial native EPS security context. </action> <control> <condition> If no previously current native EPS security context exists, </condition> <action> the MME and the UE shall not delete the partial native EPS security context , </action> <condition> if any. </condition> </control> </control> <control> e) <condition> When the MME and the UE derive a new mapped EPS security context during inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, </condition> <action> the MME and the UE shall delete any existing current mapped EPS security context. </action> </control> <control> f) <condition> When a non-current full native EPS security context is taken into use by a security mode control procedure, </condition> <action> then the MME and the UE shall delete the previously current mapped EPS security context. </action> </control> <control> g) <condition> When the UE or the MME moves from EMM-REGISTERED to EMM-DEREGISTERED state, </condition> <condition> if the current EPS security context is a mapped EPS security context and a non-current full native EPS security context exists, </condition> <action> then the non-current EPS security context shall become the current EPS security context. </action> <action> Furthermore, the UE and the MME shall delete any mapped EPS security context or partial native EPS security context. </action> </control>
<control> <action> The UE shall mark the EPS security context on the USIM or in the non-volatile memory as invalid </action> <condition> <condition> when the UE initiates an attach procedure as described in subclause 5.5.1 </condition> or <condition> when the UE leaves state EMM-DEREGISTERED for any other state except EMM-NULL. </condition> </condition> </control>
<control> <action> The UE shall store the current native EPS security context as specified in annex C and mark it as valid </action> <condition> <condition> only when the UE enters state EMM-DEREGISTERED from any other state except EMM-NULL </condition> or <condition> when the UE aborts the attach procedure without having left EMM-DEREGISTERED. </condition> </condition> </control>
4.4.2.2 Establishment of a mapped EPS security context during intersystem handover
<control> <condition> In order for the UE to derive a mapped EPS security context for an inter-system change from A/Gb mode or Iu mode to S1 mode in EMM-CONNECTED mode, </condition> <action> the MME shall generate a KSI , </action> <action> create a nonce </action> and <action> generate the K' using the created nonce as indicated in 3GPP TS 33.401 . </action> <action> The MME shall include the selected NAS algorithms, MME nonce and generated KSI (associated with the K' ) in the NAS security transparent container for handover to E-UTRAN. </action> <action> The MME shall derive the EPS NAS keys from K' . </action> </control>
<control> <condition> When the UE receives the command to perform handover to E-UTRAN, </condition> <action> the UE shall derive K' as indicated in 3GPP TS 33.401 , using the nonce received in the NAS security transparent container. </action> <action> Furthermore, the UE MME shall associate the derived K' with the received KSI and derive the EPS NAS keys from K' . </action> </control>
<control> <condition> <condition> When the UE has a PDN connection for emergency bearer services </condition> and <condition> has no current UMTS security context, </condition> </condition> <action> the MME shall set EIA0 and EEA0 as the selected NAS security algorithms in the NAS security transparent container for handover to E-UTRAN. </action> <action> The MME shall create a locally generated K' . </action> <action> The MME shall set the KSI value of the associated security context to "000" and the type of security context flag to "mapped security context" in the NAS security transparent container for handover to E-UTRAN. </action> </control>
<control> <condition> <condition> When the UE receives the command to perform handover to E-UTRAN </condition> and <condition> has a PDN connection for emergency bearer services, </condition> <condition> if EIA0 and EEA0 as the selected NAS security algorithms are included in the NAS security transparent container for handover to E-UTRAN, </condition> </condition> <action> the UE shall create a locally generated K' . </action> <action> The UE shall set the KSI value of the associated security context to the KSI value received. </action> </control>
<control> <condition> If the inter-system change from A/Gb mode or Iu mode to S1 mode in EMM-CONNECTED mode is not completed successfully, </condition> <action> the MME and the UE shall delete the new mapped EPS security context. </action> </control>
The establishment of a mapped EPS security context during inter-system change from N1 mode to S1 mode in EMM- CONNECTED mode is specified in 3GPP TS 24.501 subclause 4.4.2.4.
4.4.2.3 Establishment of secure exchange of NAS messages
Secure exchange of NAS messages via a NAS signalling connection is usually established by the MME during the attach procedure by initiating a security mode control procedure. <control> <condition> After successful completion of the security mode control procedure, </condition> <action> all NAS messages exchanged between the UE and the MME are sent integrity protected using the current EPS security algorithms, </action> and <control> <condition> except for the messages specified in subclause 4.4.5, </condition> <action> all NAS messages exchanged between the UE and the MME are sent ciphered using the current EPS security algorithms. </action> </control> </control>
<control> <condition> During inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, </condition> <action> secure exchange of NAS messages is established between the MME and the UE </action> by: <control> a) <condition> the transmission of NAS security related parameters encapsulated in the AS signalling from the MME to the UE triggering the inter-system handover (see 3GPP TS 33.401 ). </condition> <action> The UE uses these parameters to generate the mapped EPS security context; </action> </control> and, <control> b) <condition> after the handover, the transmission of a TRACKING AREA UPDATE REQUEST message from the UE to the MME. </condition> <action> The UE shall send this message integrity protected using the mapped EPS security context, but unciphered. </action> <action> From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected using the mapped EPS security context, </action> and <control> <condition> except for the messages specified in subclause 4.4.5, </condition> <action> all NAS messages exchanged between the UE and the MME are sent ciphered using the mapped EPS security context. </action> </control> </control> </control>
<control> <condition> During inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode, </condition> <action> secure exchange of NAS messages is established between the MME and the UE </action> by: <condition> a) the transmission of NAS security related parameters encapsulated in the AS signalling from the AMF to the UE triggering the inter-system handover (see 3GPP TS 33.501 ). The UE uses these parameters to generate the mapped EPS security context (see subclause 8.6.1 of 3GPP TS 33.501 ); </condition> and <control> b) <condition> after the handover, the transmission of a TRACKING AREA UPDATE REQUEST message from the UE to the MME. </condition> <action> The UE shall send this message integrity protected using the mapped EPS security context, but unciphered. </action> <action> From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected using the mapped EPS security context, </action> <action> and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the mapped EPS security context. </action> </control> </control>
<control> <condition> During inter-system change from N1 mode to S1 mode in EMM-IDLE mode, </condition> <condition> if the UE is operating in the single- registration mode </condition> and: <control> 1) <control> <condition> if the tracking area updating procedure is initiated as specified in 3GPP TS 24.501 , </condition> <action> the UE shall transmit a TRACKING AREA UPDATE REQUEST message integrity protected with the current 5G NAS security context </action> and <action> the UE shall derive a mapped EPS security context (see subclause 8.6.1 of 3GPP TS 33.501 ). </action> <action> The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively. </action> <action> The UE shall include the eKSI indicating the 5G NAS security context value in the TRACKING AREA UPDATE REQUEST message. </action> </control> <control> <condition> <condition> After receiving the TRACKING AREA UPDATE REQUEST message </condition> <condition> including the eKSI, </condition> </condition> <action> the MME forwards the TRACKING AREA UPDATE REQUEST message to the source AMF, <condition> if possible, </condition> <condition> to obtain the mapped EPS security context from the AMF as specified in 3GPP TS 33.501 . </condition> </action> <action> The MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. </action> <action> The MME re-establishes the secure exchange of NAS messages </action> by either: <action> a) replying with a TRACKING AREA UPDATE ACCEPT message that is integrity protected and ciphered using the mapped EPS security context. </action> <control> <condition> From this time onward, </condition> <action> all NAS messages exchanged between the UE and the MME are sent integrity protected </action> and <action> <condition> except for the messages specified in subclause 4.4.5, </condition> all NAS messages exchanged between the UE and the MME are sent ciphered; </action> </control> or <action> b) initiating a security mode control procedure. </action> This can be used by the MME to take a non-current EPS security context into use or to modify the current EPS security context by selecting new NAS security algorithms; </control> </control> or <control> 2) <condition> if the attach procedure is initiated as specified in 3GPP TS 24.501 </condition> and: <control> a) <control> <condition> <condition> if the UE has received an "interworking without N26 interface not supported" indication from the network </condition> and <condition> the UE has a valid 5G NAS security context, </condition> </condition> <action> the UE shall send an ATTACH REQUEST message integrity protected with the current 5G NAS security context </action> and <action> the UE shall derive a mapped EPS security context (see subclause 8.6.1 of 3GPP TS 33.501 ). </action> <action> The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively. </action> <action> The UE shall include the eKSI indicating the 5G NAS security context value in the ATTACH REQUEST message. </action> </control> <control> <condition> After receiving the ATTACH REQUEST message including the eKSI, </condition> <action> the MME forwards the ATTACH REQUEST message to the source AMF, <condition> if possible, </condition> <condition> to obtain the mapped EPS security context from the AMF as specified in 3GPP TS 33.501 . </condition> </action> <action> The MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. </action> <action> The MME re- establishes the secure exchange of NAS messages </action> by either: <action> a) replying with an ATTACH ACCEPT message that is integrity protected and ciphered using the mapped EPS NAS security context. </action> <condition> From this time onward, </condition> <action> all NAS messages exchanged between the UE and the MME are sent integrity protected </action> and <action> <condition> except for the messages specified in subclause 4.4.5, </condition> all NAS messages exchanged between the UE and the MME are sent ciphered; </action> or <action> b) initiating a security mode control procedure. </action> This can be used by the MME to modify the current EPS security context by selecting new NAS security algorithms; </control> </control> or <control> b) <condition> otherwise: </condition> <control> i) <control> <condition> if the UE has a valid native EPS security context, </condition> <action> the UE shall send an ATTACH REQUEST message integrity protected with the native EPS security context. </action> <action> The UE shall include the eKSI indicating the native EPS security context value in the ATTACH REQUEST message. </action> </control> <control> <condition> After receiving the ATTACH REQUEST message including the eKSI, </condition> <action> the MME shall check whether the eKSI included in the initial NAS message belongs to an EPS security context available in the MME, </action> and <action> shall verify the MAC of the NAS message. </action> <control> <condition> If the verification is successful, </condition> <action> the MME re-establishes the secure exchange of NAS messages </action> by either: <action> a) replying with an ATTACH ACCEPT message that is integrity protected and ciphered using the current EPS security context. </action> <condition> From this time onward, </condition> <action> all NAS messages exchanged between the UE and the MME are sent integrity protected </action> and <action> <condition> except for the messages specified in subclause 4.4.5, </condition> all NAS messages exchanged between the UE and the MME are sent ciphered; </action> or <action> b) initiating a security mode control procedure. </action> This can be used by the MME to modify the current EPS security context by selecting new NAS security algorithms; </control> </control> </control> or <control> ii) <condition> if the UE has no valid native EPS security context, </condition> <action> the UE shall send an ATTACH REQUEST message without integrity protection and encryption. </action> </control> </control> </control> </control>
<control> <action> The secure exchange of NAS messages shall be continued </action> <condition> after S1 mode to S1 mode handover. </condition> </control> <control> <action> It is terminated </action> <condition> <condition> after inter-system handover from S1 mode to A/Gb mode or Iu mode </condition> or <condition> when the NAS signalling connection is released. </condition> </condition> </control> <control> <condition> <condition> <condition> When a UE in EMM-IDLE mode </condition> <condition> establishes a new NAS signalling connection </condition> </condition> and <condition> has a valid current EPS security context, </condition> </condition> <action> secure exchange of NAS messages can be re-established </action> <control> in the following ways: <control> 1) <condition> Except for the cases described in items 3 and 4 below, </condition> <action> the UE shall transmit the initial NAS message integrity protected with the current EPS security context, but unciphered. </action> <action> The UE shall include the eKSI indicating the current EPS security context value in the initial NAS message. </action> <action> The MME shall check whether the eKSI included in the initial NAS message belongs to an EPS security context available in the MME, </action> and <action> shall verify the MAC of the NAS message. </action> <control> <condition> If the verification is successful, </condition> <action> the MME re-establishes the secure exchange of NAS messages </action> by either: <action> a) replying with an ATTACH ACCEPT message that is integrity protected and ciphered using the current EPS security context. </action> <condition> From this time onward, </condition> <action> all NAS messages exchanged between the UE and the MME are sent integrity protected </action> and <action> <condition> except for the messages specified in subclause 4.4.5, </condition> all NAS messages exchanged between the UE and the MME are sent ciphered; </action> or <action> b) initiating a security mode control procedure. </action> This can be used by the MME to modify the current EPS security context by selecting new NAS security algorithms; </control> </control> or <control> 2) <condition> If the initial NAS message was a SERVICE REQUEST message or EXTENDED SERVICE REQUEST message, </condition> <action> secure exchange of NAS messages is triggered by the indication from the lower layers that the user plane radio bearers are successfully set up. </action> <control> <condition> After successful completion of the procedure, </condition> <action> all NAS messages exchanged between the UE and the MME are sent integrity protected </action> and <action> <condition> except for the messages specified in subclause 4.4.5, </condition> all NAS messages exchanged between the UE and the MME are sent ciphered; </action> </control> </control> <control> 3) <condition> <condition> If the UE has no current EPS security context </condition> and <condition> <condition> performs a tracking area updating procedure </condition> <condition> after an inter- system change in idle mode from A/Gb mode to S1 mode or Iu mode to S1 mode, </condition> </condition> </condition> <action> the UE shall send the TRACKING AREA UPDATE REQUEST message without integrity protection and encryption. </action> <action> The UE shall include a nonce and a GPRS ciphering key sequence number for creation of a mapped EPS security context. </action> <action> The MME creates a fresh mapped EPS security context </action> and <action> takes this context into use by initiating a security mode control procedure </action> and <action> this context becomes the current EPS security context in both the UE and the MME. </action> <action> This re-establishes the secure exchange of NAS messages. </action> </control> <control> 4) <condition> If the initial NAS message is a CONTROL PLANE SERVICE REQUEST message, </condition> <action> the UE shall send the message integrity protected. </action> <control> <condition> If an ESM message container information element or a NAS message container information element is included </condition> <action> the message shall be sent partially ciphered (see subclause 4.4.5), </action> </control> <control> <condition> otherwise </condition> <action> the message shall be sent unciphered. </action> </control> <control> <action> Secure exchange of NAS messages is re-established in the UE: </action> <condition> <condition> a) by the indication from the lower layers that the user plane radio bearers are successfully set up; </condition> <condition> b) <condition> upon receipt of a NAS message (e.g. a SERVICE ACCEPT message or ESM DATA TRANSPORT message) </condition> <condition> that is integrity protected and ciphered </condition> <condition> using the current EPS security context; </condition> or <condition> c) <condition> upon receipt of a SECURITY MODE COMMAND message </condition> <condition> that has successfully passed the integrity check. </condition> </condition> </condition> </condition> </control> </control> </control> </control>
4.4.2.4 Change of security keys
<control> <condition> When the MME initiates a re-authentication to create a new EPS security context, </condition> <action> the messages exchanged during the authentication procedure are integrity protected and ciphered using the current EPS security context, </action> <condition> if any. </condition> </control>
<control> <action> Both UE and MME shall continue to use the current EPS security context, </action> <condition> until the MME initiates a security mode control procedure. </condition> The SECURITY MODE COMMAND message sent by the MME includes the eKSI of the new EPS security context to be used. <action> The MME shall send the SECURITY MODE COMMAND message integrity protected with the new EPS security context, but unciphered. </action> </control> <control> <condition> When the UE responds with a SECURITY MODE COMPLETE, </condition> <action> it shall send the message integrity protected and ciphered with the new EPS security context. </action> </control>
<control> <condition> The MME can also modify the current EPS security context or take the non-current native EPS security context, if any, into use, </condition> <action> by sending a SECURITY MODE COMMAND message including the eKSI of the EPS security context to be modified and including a new set of selected NAS security algorithms. </action> <action> In this case the MME shall send the SECURITY MODE COMMAND message integrity protected with the modified EPS security context, but unciphered. </action> <control> <condition> When the UE replies with a SECURITY MODE COMPLETE message, </condition> <action> it shall send the message integrity protected and ciphered with the modified EPS security context. </action> </control> </control>
4.4.2.5 Derivation of keys at CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode
<control> <condition> At change from A/Gb mode to S1 mode or from Iu mode to S1 mode due to CS to PS SRVCC handover (see 3GPP TS 23.216 ), </condition> <action> the UE shall derive a mapped EPS security context for the PS domain from the UMTS security context for the CS domain. </action> </control>
<control> <condition> At change from A/Gb mode to S1 mode due to CS to PS SRVCC handover, </condition> <action> ciphering may be started </action> and <action> integrity protection shall be started </action> (see 3GPP TS 36.331 ) <condition> without any new authentication procedure. </condition> </control>
NOTE 1: CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode is not supported if the current CS security context is a GSM security context.
NOTE 2: For emergency calls, CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode is not supported.
<control> <condition> When the UE receives the command to perform CS to PS SRVCC handover to S1 mode, </condition> <action> the ME shall generate the CK' and IK' using the CS UMTS integrity key, the CS UMTS ciphering key and the received NONCE value in PS PS MSC the transparent container in the CS to PS SRVCC handover command as specified in annex B.6 in 3GPP TS 33.102 . </action> <action> The ME shall ignore the NONCE value received in the NAS Security Transparent Container MME in the CS to PS SRVCC handover command. </action> </control>
NOTE 3: The NONCE value received in the NAS Security Transparent Container for the handover to E- MME UTRAN is not used by the ME or MME in any key derivation in this handover.
The ME shall associate the derived key K' with a KSI . The ME shall set the KSI associated to K' to the KSI value received in the NAS Security Transparent Container from the network.
NOTE 4: Although this case is related to the MSC server enhanced for SRVCC, the name KSI is kept to avoid introducing a new name for the same domain.
<control> <action> The ME shall derive the EPS NAS keys (CK' and IK') from the K' as specified in 3GPP TS 33.401 . </action> <action> The ME shall apply these derived EPS NAS security keys (CK' and IK'), </action> <action> reset the uplink and downlink NAS COUNT values for the mapped EPS security context (i.e. to the value 0), </action> and <control> <action> replace an already established mapped EPS security context for the PS domain, </action> <condition> <condition> if any, </condition> <condition> in the ME, </condition> <condition> when the CS to PS SRVCC handover from A/Gb mode or Iu mode has been completed successfully. </condition> </condition> </control> </control> <control> <condition> If the already established current EPS security context is of type native, </condition> <action> then it shall become the non-current native EPS security context </action> and <action> overwrite any existing non-current native EPS security context in the ME. </action> </control>
<control> <action> The network shall replace an already established mapped EPS security context for the PS domain, </action> <condition> if any, </condition> <condition> when the CS to PS SRVCC handover from A/Gb mode or Iu mode has been completed successfully. </condition> <control> <condition> If the already established current EPS security context is of type native, </condition> <action> then it shall become the non-current native EPS security context </action> and <action> overwrite any existing non-current native EPS security context in the MME. </action> </control> </control>
<control> <condition> If the CS to PS SRVCC handover from A/Gb mode or Iu mode has not been completed successfully, </condition> <action> the UE and the network shall delete the new derived mapped EPS security context for the PS domain. </action> <control> <action> Additionally, the network shall delete an already established mapped EPS security context for the PS domain, </action> <condition> <condition> if any, </condition> <condition> if the eKSI of the already established EPS security context is equal to the KSI of the new derived EPS security context for the PS domain. </condition> </condition> </control> </control>
4.4.3 Handling of NAS COUNT and NAS sequence number
4.4.3.1 General
Each EPS security context shall be associated with two separate counters NAS COUNT: one related to uplink NAS messages and one related to downlink NAS messages. The NAS COUNT counters use 24 bit internal representation and are independently maintained by UE and MME. The NAS COUNT shall be constructed as a NAS sequence number (8 least significant bits) concatenated with a NAS overflow counter (16 most significant bits).
<control> <condition> When NAS COUNT is input to NAS ciphering or NAS integrity algorithms </condition> <action> it shall be considered to be a 32-bit entity which shall be constructed by padding the 24-bit internal representation with 8 zeros in the most significant bits. </action> </control>
The value of the uplink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex C, is the value that shall be used in the next NAS message.
The value of the downlink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex C, is the largest downlink NAS COUNT used in a successfully integrity checked NAS message.
The NAS sequence number part of the NAS COUNT shall be exchanged between the UE and the MME as part of the NAS signalling. <control> <condition> After each new or retransmitted outbound security protected NAS message, </condition> <action> the sender shall increase the NAS COUNT number by one, </action> <condition> <condition> except for the initial NAS messages </condition> <condition> if the lower layers indicated the failure to establish the RRC connection (see 3GPP TS 36.331 ). </condition> </condition> <action> Specifically, on the sender side, the NAS sequence number shall be increased by one, </action> and <control> <condition> if the result is zero (due to wrap around), </condition> <action> the NAS overflow counter shall also be incremented by one (see subclause 4.4.3.5). </action> </control> <action> The receiving side shall estimate the NAS COUNT used by the sending side. </action> <control> Specifically, <condition> if the estimated NAS sequence number wraps around, </condition> <action> the NAS overflow counter shall be incremented by one. </action> </control> </control>
<control> <condition> <condition> After the derivation of a NAS token </condition> <condition> due to an inter-system change from S1 mode to A/Gb mode or Iu mode in idle mode </condition> as specified in 3GPP TS 24.008 , </condition> <action> the UE shall increase the uplink NAS COUNT by one. </action> </control>
<control> <condition> When the MME receives a NAS token via SGSN during an idle mode inter-system change from S1 mode to A/Gb mode or Iu mode, </condition> <action> the MME shall check the NAS token as specified in 3GPP TS 33.401 , subclause 9.1.1, </action> and <action> update its uplink NAS COUNT with the uplink NAS COUNT value used for the successful check of the NAS token. </action> </control>
NOTE 1: The MME does not check the NAS token if it is received via SGSN during a connected mode inter- system change from S1 mode to A/Gb mode or Iu mode.
<control> <condition> <condition> During the handover from UTRAN/GERAN to E-UTRAN, </condition> <condition> <condition> when a mapped EPS security context is derived </condition> and <condition> taken into use, </condition> </condition> </condition> <action> the MME shall set both the uplink and downlink NAS COUNT counters of this EPS security context to zero. </action> <action> The UE shall set both the uplink and downlink NAS COUNT counters to zero. </action> </control>
<control> <condition> <condition> When a mapped EPS security context is derived as specified in 3GPP TS 33.501 </condition> and <condition> taken into use in the following cases: <condition> a) during the inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode; </condition> or <condition> b) during the inter-system change from N1 mode to S1 mode in EMM-IDLE mode for the UE operating in single- registration mode in a network supporting N26 interface, </condition> </condition> </condition> <action> the MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K' key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. </action> <action> The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively. </action> </control>
<control> <condition> During the handover from E-UTRAN to UTRAN/GERAN </condition> <action> the MME signals the current downlink NAS COUNT value in a NAS security transparent container (see subclause 9.9.2.6). </action> </control>
<control> <condition> During handover to or from E-UTRAN, </condition> <action> the MME shall increment downlink NAS COUNT by one </action> <condition> after it has created a NAS security transparent container (see subclause 9.9.2.6 and 9.9.2.7). </condition> </control>
NOTE 2: During the handover from UTRAN/GERAN to E-UTRAN, the NAS security transparent container (see subclause 9.9.2.7) is treated as an implicit SECURITY MODE COMMAND message for the UE and the MME, and therefore the MME regards the sending of the NAS security transparent container as the sending of an initial SECURITY MODE COMMAND message in order to derive and take into use a mapped EPS security context for the purpose of the NAS COUNT handling.
<control> <condition> In some NAS messages only 5 of the 8 NAS sequence number bits are transmitted. When this is the case, </condition> <action> the receiver shall estimate the remaining 3 most significant bits of the sequence number. </action> </control>
4.4.3.2 Replay protection
<control> <action> Replay protection shall be supported for received NAS messages both in the MME and the UE. </action> However, since the realization of replay protection does not affect the interoperability between nodes, no specific mechanism is required for implementation. </control>
<control> <action> Replay protection must assure that one and the same NAS message is not accepted twice by the receiver. </action> <action> Specifically, for a given EPS security context, a given NAS COUNT value shall be accepted at most one time and only if message integrity verifies correctly. </action> </control>
<control> <action> Replay protection is not applicable </action> <condition> when EIA0 is used. </condition> </control>
4.4.3.3 Integrity protection and verification
<control> <action> The sender shall use its locally stored NAS COUNT as input to the integrity protection algorithm. </action> </control>
<control> <action> The receiver shall use the NAS sequence number included in the received message (or estimated from the 5 bits of the NAS sequence number received in the message) and an estimate for the NAS overflow counter as defined in subclause 4.4.3.1 to form the NAS COUNT input to the integrity verification algorithm. </action> </control>
The algorithm to calculate the integrity protection information is specified in 3GPP TS 33.401 , and the integrity protection shall include octet 6 to n of the security protected NAS message, i.e. the sequence number IE and the NAS message IE. The integrity protection of the SERVICE REQUEST message is defined in subclause 9.9.3.28. In addition to the data that is to be integrity protected, the constant BEARER ID, DIRECTION bit, NAS COUNT and NAS integrity key are input to the integrity protection algorithm. These parameters are described in 3GPP TS 33.401 .
<control> <condition> After successful integrity protection validation, </condition> <action> the receiver shall update its corresponding locally stored NAS COUNT with the value of the estimated NAS COUNT for this NAS message. </action> </control>
<control> <action> Integrity verification is not applicable </action> <condition> when EIA0 is used. </condition> </control>
4.4.3.4 Ciphering and deciphering
<control> <action> The sender shall use its locally stored NAS COUNT as input to the ciphering algorithm. </action> </control>
<control> <action> The receiver shall use the NAS sequence number included in the received message (or estimated from the 5 bits of the NAS sequence number received in the message) and an estimate for the NAS overflow counter as defined in subclause 4.4.3.1 to form the NAS COUNT input to the deciphering algorithm. </action> </control>
The input parameters to the NAS ciphering algorithm are the constant BEARER ID, DIRECTION bit, NAS COUNT, NAS encryption key and the length of the key stream to be generated by the encryption algorithm. <control> <condition> When an initial plain NAS message for transport of user data via control plane (i.e. CONTROL PLANE SERVICE REQUEST message) is to be partially ciphered, </condition> <action> the length of the key stream is set to the length of the part of the initial plain NAS message (i.e. the value part of the ESM message container IE or the value part of the NAS message container) that is to be ciphered. </action> </control>
4.4.3.5 NAS COUNT wrap around
<control> <condition> If, <condition> when increasing the NAS COUNT as specified above, </condition> <condition> the MME detects that either its downlink NAS COUNT or the UE's uplink NAS COUNT is "close" to wrap around, (close to 224), </condition> </condition> the MME shall take the following actions: <control> a) <condition> If there is no non-current native EPS security context with sufficiently low NAS COUNT values, </condition> <action> the MME shall initiate a new AKA procedure with the UE, leading to a new established EPS security context and the NAS COUNT being reset to 0 in both the UE and the MME when the new EPS security context is activated; </action> </control> <control> b) <condition> Otherwise, </condition> <action> the MME can activate a non-current native EPS security context with sufficiently low NAS COUNT values or initiate a new AKA procedure as specified above. </action> </control> </control>
<control> <condition> <condition> If for some reason a new K has not been established </condition> <condition> using AKA </condition> <condition> before the NAS COUNT wraps around, </condition> </condition> <action> the node (MME or UE) in need of sending a NAS message shall instead release the NAS signalling connection. </action> <control> <condition> Prior to sending the next uplink NAS message, </condition> <action> the UE shall delete the eKSI indicating the current EPS security context. </action> </control> </control>
<control> <condition> When the EIA0 is used as the NAS integrity algorithm, </condition> <action> the UE and the MME shall allow NAS COUNT wrap around. </action> </control> <control> <condition> If NAS COUNT wrap around occurs, </condition> the following requirements apply: <action> a) the UE and the MME shall continue to use the current security context; </action> <action> b) the MME shall not initiate the EPS AKA procedure; </action> <action> c) the MME shall not release the NAS signalling connection; </action> <action> and d) the UE shall not perform a local release of the NAS signalling connection. </action> </control>
4.4.4 Integrity protection of NAS signalling messages
4.4.4.1 General
<control> For the UE, <action> integrity protected signalling is mandatory for the NAS messages </action> <condition> once a valid EPS security context exists and has been taken into use. </condition> <control> For the network, <action> integrity protected signalling is mandatory for the NAS messages </action> <condition> once a secure exchange of NAS messages has been established for the NAS signalling connection. </condition> </control> </control> Integrity protection of all NAS signalling messages is the responsibility of the NAS. It is the network which activates integrity protection.
<control> <action> The use of "null integrity protection algorithm" EIA0 (see subclause 9.9.3.23) in the current security context is only allowed </action> <condition> for an unauthenticated UE for which establishment of emergency bearer services or access to RLOS is allowed. </condition> </control>
For setting the security header type in outbound NAS messages, the UE and the MME shall apply the same rules irrespective of whether the "null integrity protection algorithm" or any other integrity protection algorithm is indicated in the security context.
<control> <condition> If the "null integrity protection algorithm" EIA0 has been selected as a integrity protection algorithm, </condition> <action> the receiver shall regard the NAS messages with the security header indicating integrity protection as integrity protected. </action> </control>
Details of the integrity protection and verification of NAS signalling messages are specified in 3GPP TS 33.401 .
<control> <condition> When a NAS message needs to be sent both ciphered and integrity protected, </condition> <action> the NAS message is first ciphered </action> and <action> then the ciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC. </action> <control> <action> The same applies </action> <condition> when an initial NAS message needs to be sent partially ciphered and integrity protected. </condition> </control> </control>
NOTE: NAS messages that are ciphered or partially ciphered with the "null ciphering algorithm" EEA0 are regarded as ciphered or partially ciphered, respectively (see subclause 4.4.5).
<control> <condition> When a NAS message needs to be sent only integrity protected and unciphered, </condition> <action> the unciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC. </action> </control>
<control> <condition> When <condition> during the EPS attach procedure or service request procedure </condition> <condition> an ESM message is piggybacked in an EMM message, </condition> </condition> there is only one sequence number IE and one message authentication code IE, if any, for the combined NAS message. </control>
4.4.4.2 Integrity checking of NAS signalling messages in the UE
<control> <action> Except the messages listed below, no NAS signalling messages shall be processed by the receiving EMM entity in the UE or forwarded to the ESM entity, <condition> unless the network has established secure exchange of NAS messages for the NAS signalling connection </condition> : a) EMM messages: b) IDENTITY REQUEST (if requested identification parameter is IMSI); c) AUTHENTICATION REQUEST; d) AUTHENTICATION REJECT; e) ATTACH REJECT (if the EMM cause is not #25); f) DETACH ACCEPT (for non switch off); g) TRACKING AREA UPDATE REJECT (if the EMM cause is not #25); h) SERVICE REJECT (if the EMM cause is not #25). </action> </control>
NOTE: These messages are accepted by the UE without integrity protection, as in certain situations they are sent by the network before security can be activated.
All ESM messages are integrity protected.
<control> <condition> Once the secure exchange of NAS messages has been established, </condition> <control> <action> the receiving EMM or ESM entity in the UE shall not process any NAS signalling messages </action> <condition> unless they have been successfully integrity checked by the NAS. </condition> </control> <control> <condition> If NAS signalling messages, <condition> having not successfully passed the integrity check, </condition> are received, </condition> <action> then the NAS in the UE shall discard that message. </action> </control> The processing of the SECURITY MODE COMMAND message that has not successfully passed the integrity check is specified in subclause 5.4.3.5. <control> <condition> <condition> If any NAS signalling message is received as not integrity protected </condition> <condition> even though the secure exchange of NAS messages has been established by the network, </condition> </condition> <action> then the NAS shall discard this message. </action> </control> </control>
4.4.4.3 Integrity checking of NAS signalling messages in the MME
<control> <action> Except the messages listed below, no NAS signalling messages shall be processed by the receiving EMM entity in the MME or forwarded to the ESM entity, <condition> unless the secure exchange of NAS messages has been established for the NAS signalling connection </condition> :a) EMM messages: b) ATTACH REQUEST; c) IDENTITY RESPONSE (if requested identification parameter is IMSI); d) AUTHENTICATION RESPONSE; e) AUTHENTICATION FAILURE; f) SECURITY MODE REJECT; g) DETACH REQUEST; h) DETACH ACCEPT; i) TRACKING AREA UPDATE REQUEST. </action> </control>
NOTE 1: <control> <action> The TRACKING AREA UPDATE REQUEST message is sent by the UE without integrity protection, </action> <condition> <condition> if the tracking area updating procedure is initiated due to an inter-system change in idle mode </condition> and <condition> no current EPS security context is available in the UE. </condition> </condition> </control> The other messages are accepted by the MME without integrity protection, as in certain situations they are sent by the UE before security can be activated.
NOTE 2: <control> <action> The DETACH REQUEST message can be sent by the UE without integrity protection, </action> <condition> e.g. <condition> if the UE is attached for emergency bearer services or access to RLOS </condition> and <condition> there is no shared EPS security context available, </condition> or <condition> if due to user interaction an attach procedure is cancelled before the secure exchange of NAS messages has been established. </condition> </condition> </control> For these cases the network can attempt to use additional criteria (e.g. whether the UE is subsequently still performing periodic tracking area updating or still responding to paging) before marking the UE as EMM-DEREGISTERED.
<control> <action> All ESM messages are integrity protected except a PDN CONNECTIVITY REQUEST message </action> <condition> if it is sent piggybacked in ATTACH REQUEST message and NAS security is not activated. </condition> </control>
<control> <condition> Once a current EPS security context exists, </condition> <condition> until the secure exchange of NAS messages has been established for the NAS signalling connection, </condition> <action> the receiving EMM entity in the MME shall process the following NAS signalling messages, <condition> <condition> even if the MAC included in the message fails the integrity check </condition> or <condition> cannot be verified, </condition> </condition> as the EPS security context is not available in the network: a) ATTACH REQUEST; b) IDENTITY RESPONSE (if requested identification parameter is IMSI); c) AUTHENTICATION RESPONSE; d) AUTHENTICATION FAILURE; e) SECURITY MODE REJECT; f) DETACH REQUEST; g) DETACH ACCEPT; h) TRACKING AREA UPDATE REQUEST; i) SERVICE REQUEST; j) EXTENDED SERVICE REQUEST; k) CONTROL PLANE SERVICE REQUEST. </action> </control>
NOTE 3: These messages are processed by the MME even when the MAC that fails the integrity check or cannot be verified, as in certain situations they can be sent by the UE protected with an EPS security context that is no longer available in the network.
<control> <condition> <condition> <condition> If an ATTACH REQUEST message is received </condition> <condition> <condition> without integrity protection </condition> or <condition> fails the integrity check </condition> </condition> </condition> and <condition> it is not an attach request for emergency bearer services </condition> and <condition> it is not an attach request for access to RLOS, </condition> </condition> <action> the MME shall authenticate the subscriber before processing the attach request any further. </action> <control> Additionally, <condition> if the MME initiates a security mode control procedure, </condition> <action> the MME shall include a HASH IE in the SECURITY MODE COMMAND MME message as specified in subclause 5.4.3.2. </action> </control> For the case when the attach procedure is for emergency bearer services see subclause 5.5.1.2.3 and subclause 5.4.2.5. </control>
<control> <condition> If a DETACH REQUEST message fails the integrity check, </condition> the MME shall proceed as follows: <control> a) <condition> <condition> If it is not a detach request due to switch off, </condition> and <condition> the MME can initiate an authentication procedure, </condition> </condition> <action> the MME should authenticate the subscriber </action> <condition> before processing the detach request any further. </condition> </control> <control> b) <condition> <condition> If it is a detach request due to switch off, </condition> or <condition> the MME does not initiate an authentication procedure for any other reason, </condition> </condition> <action> the MME may ignore the detach request </action> and <action> remain in state EMM-REGISTERED. </action> </control> </control>
NOTE 4: The network can attempt to use additional criteria (e.g. whether the UE is subsequently still performing periodic tracking area updating or still responding to paging) before marking the UE as EMM- DEREGISTERED.
<control> <condition> <condition> <condition> If a TRACKING AREA UPDATE REQUEST message is received without integrity protection </condition> or <condition> fails the integrity check </condition> </condition> and <condition> the UE provided a nonce , GPRS ciphering key sequence number, P-TMSI and RAI in the TRACKING UE AREA UPDATE REQUEST message, </condition> </condition> <action> the MME shall initiate a security mode control procedure to take a new mapped EPS security context into use; </action> </control> <control> <condition> otherwise, <condition> if the UE has only a PDN connection for non-emergency bearer services established </condition> and <condition> the PDN connection is not for RLOS, </condition> </condition> <action> the MME shall initiate an authentication procedure. </action> <control> Additionally, <condition> if the MME initiates a security mode control procedure, </condition> <action> the MME shall include a HASH IE in the SECURITY MME MODE COMMAND message as specified in subclause 5.4.3.2. </action> </control> For the case when the UE has a PDN connection for emergency bearer services or for RLOS see subclause 5.5.3.2.3 and subclause 5.4.2.5. </control>
<control> <condition> <condition> If a SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message fails the integrity check </condition> and <condition> the UE has only PDN connections for non-emergency bearer services established </condition> and <condition> the PDN connections are not for RLOS, </condition> </condition> <action> the MME shall send the SERVICE REJECT message with EMM cause #9 "UE identity cannot be derived by the network" </action> and <action> keep the EMM-context and EPS security context unchanged. </action> </control> <control> <condition> <condition> For the case when the UE has a PDN connection for emergency bearer services </condition> or <condition> RLOS and integrity check fails, </condition> </condition> <action> the MME may skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in subclause 5.4.3. </action> </control> <control> <condition> After successful completion of the service request procedure, </condition> <action> the network shall deactivate all non-emergency EPS bearers locally which are not EPS bearers for RLOS. </action> <action> The emergency EPS bearers shall not be deactivated. </action> <action> The network may deactivate the EPS bearers for RLOS. </action> </control>
<control> <condition> Once the secure exchange of NAS messages has been established for the NAS signalling connection, </condition> <control> <action> the receiving EMM or ESM entity in the MME shall not process any NAS signalling messages </action> <condition> unless they have been successfully integrity checked by the NAS. </condition> </control> <control> <condition> If any NAS signalling message, <condition> having not successfully passed the integrity check, </condition> is received, </condition> <action> then the NAS in the MME shall discard that message. </action> </control> <control> <condition> <condition> If any NAS signalling message is received, </condition> <condition> as not integrity protected </condition> <condition> even though the secure exchange of NAS messages has been established, </condition> </condition> <action> then the NAS shall discard this message. </action> </control> </control>
4.4.5 Ciphering of NAS signalling messages
The use of ciphering in a network is an operator option subject to MME configuration. <control> <condition> When operation of the network without ciphering is configured, </condition> <action> the MME shall indicate the use of "null ciphering algorithm" EEA0 (see subclause 9.9.3.23) in the current security context for all UEs. </action> <action> For setting the security header type in outbound NAS messages, the UE and the MME shall apply the same rules irrespective of whether the "null ciphering algorithm" or any other ciphering algorithm is indicated in the security context. </action> </control>
<control> <condition> When the UE establishes a new NAS signalling connection, </condition> <action> it shall send the initial NAS message </action> <control> a) <action> partially ciphered, </action> <condition> <condition> if it is a CONTROL PLANE SERVICE REQUEST message </condition> <condition> including an ESM message container information element or a NAS message container information element; </condition> </condition> </control> and <control> b) <condition> unciphered, </condition> <action> if it is any other initial NAS message. </action> </control> </control>
The UE shall partially cipher the CONTROL PLANE SERVICE REQUEST message by ciphering the value part of the ESM message container IE or the value part of the NAS message container, using the ciphering algorithm of the current EPS security context.
The UE shall send the ATTACH REQUEST message always unciphered.
The UE shall send the TRACKING AREA UPDATE REQUEST message always unciphered.
<control> <condition> <condition> Except for the CONTROL PLANE SERVICE REQUEST message </condition> <condition> including an ESM message container information element or a NAS message container information element, </condition> </condition> <action> the UE shall start the ciphering and deciphering of NAS messages </action> <condition> when the secure exchange of NAS messages has been established for a NAS signalling connection. </condition> <control> <condition> From this time onward, unless explicitly defined, </condition> <action> the UE shall send all NAS messages ciphered </action> <condition> until <condition> the NAS signalling connection is released, </condition> or <condition> the UE performs intersystem handover to A/Gb mode or Iu mode. </condition> </condition> </control> </control>
<control> <action> The MME shall start ciphering and deciphering of NAS messages </action> <condition> as described in subclause 4.4.2.3. </condition> <control> <condition> From this time onward, except for the SECURITY MODE COMMAND message, </condition> <action> the MME shall send all NAS messages ciphered </action> <condition> until <condition> the NAS signalling connection is released, </condition> or <condition> the UE performs intersystem handover to A/Gb mode or Iu mode. </condition> </condition> </control> </control>
<control> <condition> Once the encryption of NAS messages has been started between the MME and the UE, </condition> <action> the receiver shall discard the unciphered NAS messages which shall have been ciphered according to the rules described in this specification. </action> <control> <action> The MME shall discard any CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element </action> <condition> which has not been partially ciphered according to the rules described above. </condition> </control> </control>
<control> <condition> If the "null ciphering algorithm" EEA0 has been selected as a ciphering algorithm, </condition> the NAS messages with the security header indicating ciphering are regarded as ciphered. </control>
Details of ciphering and deciphering of NAS signalling messages are specified in 3GPP TS 33.401 .
4.5 Disabling and re-enabling of UE's E-UTRA capability
<control> <action> The UE shall only disable the E-UTRA capability </action> <condition> when in EMM-IDLE mode. </condition> </control>
<control> <condition> When the UE supports both N1 mode and S1 mode </condition> then the UE's capability to access the 5GCN via E-UTRA shall not be affected, <condition> if the UE's E-UTRA capability is disabled or enabled. </condition> </control>
<control> <condition> When the UE is disabling the E-UTRA capability not due to redirection to 5GCN required, </condition> it should proceed as follows: <action> a) select another RAT (GERAN, UTRAN, or NG-RAN if the UE has not disabled its N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 ) of the registered PLMN or a PLMN from the list of equivalent PLMNs; </action> <control> b) <condition> <condition> if another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, </condition> or <condition> the UE does not have a registered PLMN, </condition> </condition> <action> then perform PLMN selection as specified in 3GPP TS 23.122 . </action> As an implementation option, instead of performing PLMN selection, the UE may select another RAT of the chosen PLMN. </control> <control> <condition> If disabling of E-UTRA capability was not due to UE initiated detach procedure for EPS services only, </condition> <action> the UE may re-enable the E-UTRA capability for this PLMN selection; </action> </control> or <control> c) <condition> if no other allowed PLMN and RAT combinations are available, </condition> <action> then the UE may re-enable the E-UTRA capability </action> and <action> remain registered for EPS services in E-UTRAN of the registered PLMN. </action> </control> <control> <condition> If the UE chooses this option, </condition> <action> then it may periodically attempt to select another PLMN and RAT combination that can provide non-EPS services. </action> How this periodic scanning is done, is UE implementation dependent. </control> </control>
<control> <condition> <condition> When the UE is disabling the E-UTRA capability </condition> <condition> upon receiving reject cause #31 "Redirection to 5GCN required" as specified in subclauses 5.5.1.2.5, 5.5.1.3.5, 5.5.3.2.5, 5.5.3.3.5 and 5.6.1.5, </condition> </condition> it should proceed as follows: <control> i) <condition> If the UE is in NB-S1 mode: </condition> <control> 1) <condition> <condition> if lower layers do not provide an indication that the current E-UTRA cell is connected to 5GCN </condition> or <condition> lower layers do not provide an indication that the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE, </condition> </condition> <action> search for a suitable NB-IoT cell connected to 5GCN according to 3GPP TS 36.304 ; </action> </control> <control> 2) <condition> <condition> if lower layers provide an indication that the current E-UTRA cell is connected to 5GCN </condition> and <condition> the current E- UTRA cell supports CIoT 5GS optimizations that are supported by the UE </condition> </condition> <action> then perform a core network selection to select 5GCN as specified in 3GPP TS 24.501 subclause 4.8.4A.1; </action> </control> or <control> 3) <condition> <condition> if lower layers cannot find a suitable NB-IoT cell connected to 5GCN </condition> or <condition> there is no suitable NB-IoT cell connected to 5GCN which supports CIoT 5GS optimizations that are supported by the UE, </condition> </condition> <action> the UE may re- enable the E-UTRA capability, and indicate to lower layers to remain camped in E-UTRA connected to EPC of the previously registered PLMN and proceed with the appropriate EMM procedure. </action> </control> </control> <control> ii) <condition> If the UE is in WB-S1 mode: </condition> <control> 1) <condition> <condition> if lower layers do not provide an indication that the current E-UTRA cell is connected to 5GCN </condition> or <condition> lower layers do not provide an indication that the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE, </condition> </condition> <action> search for a suitable E-UTRA cell connected to 5GCN according to 3GPP TS 36.304 ; </action> </control> <control> 2) <condition> <condition> if lower layers provide an indication that the current E-UTRA cell is connected to 5GCN </condition> and <condition> the current E- UTRA cell supports CIoT 5GS optimizations that are supported by the UE, </condition> </condition> <action> then perform a core network selection to select 5GCN as specified in 3GPP TS 24.501 subclause 4.8.4A.1; </action> </control> or <control> 3) <condition> <condition> if lower layers cannot find a suitable E-UTRA cell connected to 5GCN </condition> or <condition> there is no suitable E-UTRA cell connected to 5GCN which supports CIoT 5GS optimizations that are supported by the UE, </condition> </condition> <action> the UE may re- enable the E-UTRA capability, and indicate to lower layers to remain camped in E-UTRA connected to EPC of the previously registered PLMN and proceed with the appropriate EMM procedure. </action> </control> </control> </control>
<control> <action> The UE shall re-enable the E-UTRA capability </action> <condition> when performing a PLMN selection unless: <condition> a) the disabling of E-UTRA capability was due to UE initiated detach procedure for EPS services only; </condition> or <condition> b) the UE has already re-enabled the E-UTRA capability when performing bullets b) or c) above. </condition> </condition> </control>
<control> <condition> <condition> <condition> If due to handover, the UE moves to a new PLMN in A/Gb, Iu, or N1 mode </condition> <condition> which is <condition> not in the list of equivalent PLMNs </condition> and <condition> not a PLMN memorized by the UE for which E-UTRA capability was disabled, </condition> </condition> </condition> <condition> and the disabling of E- UTRA capability was not due to UE initiated detach procedure for EPS services only, </condition> </condition> <action> the UE shall re-enable the E- UTRA capability </action> <condition> after the RR/RRC connection is released. </condition> </control>
<control> <condition> If UE <condition> that has disabled its E-UTRA capability due to <condition> IMS voice not available </condition> and <condition> CS fallback not available </condition> </condition> <condition> re-enables it when PLMN selection is performed, </condition> </condition> <action> then it should memorize the identity of the PLMNs where E-UTRA capability was disabled </action> and <action> use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 . </action> </control>
<control> <action> The UE may support "E-UTRA Disabling for EMM cause #15" </action> and implement the following behaviour: <control> a) <condition> if the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 or 3GPP TS 31.102 is present and set to enabled; </condition> and b) <condition> if the UE <condition> receives an ATTACH REJECT or TRACKING AREA UPDATE REJECT message </condition> <condition> including both EMM cause #15 "no suitable cells in tracking area" and an Extended EMM cause IE with value "E-UTRAN not allowed"; </condition> </condition> <action> then the UE shall disable the E-UTRA capability, </action> <action> memorize the identity of the PLMN where the E-UTRA capability was disabled </action> and <action> use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 . </action> </control> </control>
<control> <condition> When the UE supporting the A/Gb and/or Iu mode together with the S1 mode needs to stay in A/Gb or Iu mode, <condition> in order to prevent unwanted handover or cell reselection from UTRAN/GERAN to E-UTRAN, </condition> </condition> <action> the UE shall disable the E-UTRA capability </action> and: <action> a) The UE shall not set the E-UTRA support bits of the MS Radio Access capability IE (see 3GPP TS 24.008 , subclause 10.5.5.12a), the E-UTRA support bits of Mobile Station Classmark 3 IE (see 3GPP TS 24.008 , subclause 10.5.1.7), the PS inter-RAT HO from GERAN to E-UTRAN S1 mode capability bit and the ISR support bit of the MS network capability IE (see 3GPP TS 24.008 , subclause 10.5.5.12) in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message after it selects GERAN or UTRAN; </action> <action> b) the UE shall use the same value of the EPC capability bit of the MS network capability IE (see 3GPP TS 24.008 , subclause 10.5.5.12) in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message; </action> and <action> c) the UE NAS layer shall indicate the access stratum layer(s) of disabling of the E-UTRA capability. </action> </control>
<control> <condition> When the UE supporting N1 mode together with S1 mode needs to stay in N1 mode, <condition> in order to prevent unwanted handover or cell reselection from NG-RAN to E-UTRAN, </condition> </condition> <action> the UE shall disable the E-UTRA capability </action> and: <action> a) the UE shall set the S1 mode bit to "S1 mode not supported" in the 5GMM Capability IE of the REGISTRATION REQUEST message (see 3GPP TS 24.501 ); </action> <action> b) the UE shall not include the S1 UE network capability IE in the REGISTRATION REQUEST message (see 3GPP TS 24.501 ); and c) the UE NAS layer shall indicate the access stratum layer(s) of disabling of the E-UTRA capability. </action> </control>
<control> <condition> If the UE is disabling its E-UTRA capability before selecting to GERAN, UTRAN or NG-RAN radio access technology, </condition> <action> the UE shall not perform the detach procedure of subclause 5.5.2.1. </action> </control>
<control> <condition> <condition> If the UE is required to <condition> disable the E-UTRA capability </condition> and <condition> select GERAN, UTRAN or NG-RAN radio access technology, </condition> </condition> and <condition> the UE is in the EMM-CONNECTED mode: </condition> </condition> <control> a) <condition> <condition> if the UE has a persistent EPS bearer context </condition> and <condition> the ongoing prodedure is not a detach procedure, </condition> </condition> <action> then the UE shall wait until the radio bearer associated with the persistent EPS bearer context has been released; </action> </control> <control> b) <condition> otherwise, </condition> <action> the UE shall locally release the established NAS signalling connection </action> and <action> enter the EMM-IDLE mode before selecting GERAN, UTRAN or NG-RAN radio access technology. </action> </control> </control>
<control> <condition> If the E-UTRA capability was disabled <condition> due to the attempt to select GERAN or UTRAN radio access technology progressing the CS emergency call establishment (see subclause 4.3.1), </condition> </condition> the criteria to enable the E-UTRA capability again is UE implementation specific. </control>
<control> <condition> If the E-UTRA capability was disabled due to the UE initiated detach procedure for EPS services only (see subclause 5.5.2.2.2), </condition> <condition> upon request of the upper layers to re-attach for EPS services </condition> <action> the UE shall enable the E-UTRA capability again. </action> </control> <control> <condition> If the E-UTRA capability was disabled due to receipt of EMM cause #14 "EPS services not allowed in this PLMN", </condition> <action> then the UE shall enable the E-UTRA capability </action> <condition> <condition> <condition> when the UE powers off </condition> and <condition> powers on again </condition> </condition> or <condition> the USIM is removed. </condition> </condition> </control> <control> <condition> If E-UTRA capability was disabled for any other reason, </condition> <action> the UE shall enable the E-UTRA capability </action> <condition> in the following cases: <condition> a) the UE mode of operation changes from CS/PS mode 1 of operation to CS/PS mode 2 of operation; </condition> <condition> b) the UE mode of operation changes from PS mode 1 of operation to PS mode 2 of operation; </condition> or <condition> c) the UE powers off and powers on again or the USIM is removed; </condition> </condition> </control>
<control> <condition> If the UE attempts to establish an emergency bearer service in a PLMN </condition> <condition> where the E-UTRA capability was disabled <condition> <condition> due to the UE's attach attempt counter </condition> or <condition> tracking area updating attempt counter have reached 5, </condition> </condition> </condition> <action> the UE may enable the E- UTRA capability for that PLMN memorized by the UE. </action> </control>
For other cases, it is up to the UE implementation when to enable the E-UTRA capability.
NOTE: <control> <condition> If the UE is not operating in CS/PS mode 1 operation, </condition> the value of the timer for enabling E-UTRA capability is recommended to be not larger than the default value of T3402. </control>
4.6 Applicability of procedures
4.6.1 Relay nodes
A relay node shall support all procedures that are mandatory for a UE supporting S1 mode only.
There is also functionality which is only applicable to a relay node, in which case the specification uses the term "relay node" instead of "UE".
4.7 EPS mobility management and EPS session management in NB-S1 mode
A UE in NB-S1 mode (see 3GPP TS 36.331 ) shall calculate the value of the applicable NAS timer: a) indicated in table 10.2.1 plus 240s; and b) indicated in table 10.3.1 plus 180s.
The timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.
<control> <condition> When an MME <condition> that supports NB-S1 mode </condition> performs NAS signaling with a UE, <condition> which is using NB-S1 mode, </condition> </condition> the MME shall calculate the value of the applicable NAS timer: a) indicated in table 10.2.2 plus 240s; and b) indicated in table 10.3.2 plus 180s. </control>
The timer value obtained is used as described in the appropriate procedure subclause of this specification. <control> <action> The NAS timer value shall be calculated at start of a NAS procedure </action> and <control> <action> shall not re-calculate the use of the NAS timer value </action> <condition> until the NAS procedure is completed, restarted or aborted. </condition> </control> </control>
NOTE: <control> <condition> If the tracking area updating procedure is initiated in EMM-CONNECTED mode, </condition> <action> the MME can stop any running implementation specific supervision timer </action> <condition> if it is started when sending an ESM DATA TRANSPORT message to the UE. </condition> </control>
4.8 EPS mobility management and EPS session management in WB-S1 mode for IoT
In WB-S1 mode, a UE operating in category CE can operate in either CE mode A or CE mode B (see 3GPP TS 36.306 ). <control> <condition> If a UE that supports CE mode B and operates in WB-S1 mode </condition> <action> the UE's usage setting is not set to "voice centric" (see 3GPP TS 23.401 ), </action> and <action> a) the use of enhanced coverage is not restricted for the UE; </action> or <action> b) CE mode B is not restricted for the UE (see 3GPP TS 23.401 ); </action> the UE shall apply the value of the applicable NAS timer indicated in tables 10.2.1 and indicated in table 10.3.1 for WB-S1/CE mode. </control>
A UE that supports CE mode B and operates in WB-S1 mode shall not apply the value of the applicable NAS timer indicated in table 10.2.1 and table 10.3.1 for WB-S1/CE mode before receiving an indication from the network that the use of enhanced coverage is not restricted as described in this subclause.
The NAS timer value obtained is used as described in the appropriate procedure subclause of this specification. <control> <action> The NAS timer value shall be calculated at start of a NAS procedure, </action> and <control> <action> shall not be re-calculated </action> <condition> until the NAS procedure is completed, restarted or aborted. </condition> </control> </control>
The support of CE mode B by a UE is indicated to the MME by lower layers and shall be stored by the MME. When an MME that supports WB-S1 mode performs NAS signaling with a UE, which supports CE mode B and operates in WB- S1 mode and the MME determines that a) the use of enhanced coverage is not restricted for the UE; or b) CE mode B is not restricted for the UE (see 3GPP TS 23.401 ) the MME shall calculate the value of the applicable NAS timer indicated in tables 10.2.2 and indicated in table 10.3.2 for WB-S1/CE mode.
The NAS timer value obtained is used as described in the appropriate procedure subclause of this specification. <control> <action> The NAS timer value shall be calculated </action> <condition> at start of a NAS procedure </condition> and <control> <action> shall not be re-calculated </action> <condition> until the NAS procedure is completed, restarted or aborted. </condition> </control> </control>
4.9 Disabling and re-enabling of UE's NB-IoT capability
<control> <condition> <condition> If the UE supports disabling and re-enabling of UE's NB-IoT capability </condition> and <condition> the UE in NB-S1 mode is disabling the NB- IoT capability, </condition> </condition> it should proceed as follows: <action> a) select E-UTRAN of the registered PLMN or a PLMN from the list of equivalent PLMNs; </action> <control> b) <condition> if E-UTRAN of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, </condition> <action> select another RAT (GERAN, UTRAN, or NG-RAN if the UE has not disabled its N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 ) of the registered PLMN or a PLMN from the list of equivalent PLMNs; </action> </control> <control> c) <condition> <condition> if another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, </condition> or <condition> the UE does not have a registered PLMN, </condition> </condition> <action> then perform PLMN selection as specified in 3GPP TS 23.122 . </action> <action> As an implementation option, instead of performing PLMN selection, the UE may select another RAT of the chosen PLMN; </action> </control> or <control> d) <condition> if no other allowed PLMN and RAT combinations are available, </condition> <action> then the UE may re-enable the NB-IoT capability and remain registered for EPS services in NB-IoT of the registered PLMN. </action> <control> <condition> If the UE chooses this option, </condition> <action> then it may periodically attempt to select another PLMN and RAT combination that can provide non-EPS services. </action> How this periodic scanning is done, is UE implementation dependent. </control> </control> </control>
<control> <condition> If the the NB-IoT capability is disabled, </condition> <action> the UE shall re-enable the NB-IoT capability </action> <condition> when: <condition> a) performing a PLMN selection unless the UE has already re-enabled the NB-IoT capability when performing bullets c) or d) above; </condition> or <condition> b) the UE powers off and powers on again or the USIM is removed. </condition> </condition> </control>
<control> <condition> <condition> If the UE in NB-S1 mode </condition> <condition> receives an ATTACH REJECT or TRACKING AREA UPDATE REJECT message </condition> <condition> including both EMM cause #15 "no suitable cells in tracking area" and an Extended EMM cause IE with value "NB-IoT not allowed" </condition> <condition> after the UE requests access to the NB-IoT, </condition> <condition> in order to prevent unwanted cell reselection from GERAN, UTRAN, E-UTRAN or NG-RAN to NB-IoT, </condition> </condition> the UE may: <action> a) disable the NB-IoT capability: </action> <action> b) indicate the access stratum layer(s) of disabling of the NB-IoT capability; </action> and <action> c) memorize the identity of the PLMN where the NB-IoT capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 . </action> </control>
NOTE: The UE can only disable the NB-IoT capability when in EMM-IDLE mode.
<control> <condition> If the UE in NB-S1 mode is required to <condition> <condition> disable the NB-IoT capability </condition> and <condition> select E-UTRAN radio access technology, </condition> </condition> and <condition> the UE is in the EMM-CONNECTED mode, </condition> </condition> <action> the UE shall locally release the established NAS signalling connection </action> and <action> enter the EMM-IDLE mode before selecting E-UTRAN radio access technology. </action> </control>
As an implementation option, the UE may start a timer for enabling the NB-IoT capability. On expiry of this timer, the UE may enable the NB-IoT capability.
5 Elementary procedures for EPS mobility management
5.1 Overview
5.1.1 General
This clause describes the procedures used for mobility management for EPS services (EMM) at the radio interface
The main function of the mobility management sublayer is to support the mobility of a user equipment, such as informing the network of its present location and providing user identity confidentiality.
A further function of the mobility management sublayer is to provide connection management services to the session management (SM) sublayer and the short message services (SMS) entity of the connection management (CM) sublayer.
<control> All the EMM procedures described in this clause can only be performed <condition> if a NAS signalling connection has been established between the UE and the network. </condition> Else, the EMM sublayer has to initiate the establishment of a NAS signalling connection (see 3GPP TS 36.331 ). </control>
5.1.2 Types of EMM procedures
Depending on how they can be initiated, three types of EMM procedures can be distinguished: 1) EMM common procedures: An EMM common procedure can always be initiated whilst a NAS signalling connection exists. The procedures belonging to this type are: Initiated by the network: a) GUTI reallocation; b) authentication; c) security mode control; d) identification; e) EMM information.
2) EMM specific procedures: At any time only one UE initiated EMM specific procedure can be running. The procedures belonging to this type are:
Initiated by the UE and used to attach the IMSI in the network for EPS services and/or non-EPS services, and to establish an EMM context and if requested by the UE, a default bearer: a) attach and combined attach.
Initiated by the UE and used to attach the IMSI or IMEI for emergency bearer services, and to establish an EMM context and a default bearer to a PDN that provides emergency bearer services: a) attach.
Initiated by the UE and used to attach the IMSI or IMEI for access to RLOS, and to establish an EMM context and a default bearer to a PDN connection for RLOS: a) attach.
Initiated by the UE or the network and used to detach the IMSI in the network for EPS services and/or non- EPS services and to release an EMM context and all bearers, if any: a) detach and combined detach.
Initiated by the UE and used to detach the IMSI in the network for EPS services or non-EPS services and to release an EMM context and all bearers, if any: a) eCall inactivity procedure.
Initiated by the UE when an EMM context has been established: a) normal tracking area updating and combined tracking area updating (S1 mode only); b) periodic tracking area updating (S1 mode only).
The tracking area updating procedure can be used to request also the resource reservation for sending data.
3) EMM connection management procedures (S1 mode only): Initiated by the UE and used to establish a secure connection to the network or to request the resource reservation for sending data, or both: a) service request. <control> <action> The service request procedure can only be initiated </action> <condition> if no UE initiated EMM specific procedure is ongoing. </condition> </control>
Initiated by the network and used to request the establishment of a NAS signalling connection or to prompt the UE to re-attach if necessary as a result of a network failure: a) paging procedure.
Initiated by the UE or the network and used to transport NAS messages: a) transport of NAS messages; b) generic transport of NAS messages. The transport of NAS messages procedure and the generic transport of NAS messages procedure cannot be initiated while an EMM specific procedure or a service request procedure is ongoing.
5.1.3 EMM sublayer states
5.1.3.1 General
In the following subclauses, the EMM protocol of the UE and the network is described by means of two different state machines. In subclause 5.1.3.2, the states of the EMM entity in the UE are introduced. The behaviour of the UE depends on an EPS update status that is described in subclause 5.1.3.3. The states for the MME side are described in subclause 5.1.3.4.
5.1.3.2 EMM sublayer states in the UE
5.1.3.2.1 General
In the following subclauses, the possible EMM states of an EMM entity in the UE are described. Subclause 5.1.3.2.2 summarizes the main states of an EMM entity. The substates that have been defined are described in subclause 5.1.3.2.3 and subclause 5.1.3.2.4.
It should be noted, however, that this subclause does not include a description of the detailed behaviour of the UE in the single states and does not cover abnormal cases. A detailed description of the behaviour of the UE is given in subclause 5.2. For the behaviour of the UE in abnormal cases refer to the description of the elementary EMM procedures in subclauses 5.4, 5.5, 5.6 and 5.7.
5.1.3.2.2 Main states
5.1.3.2.2.1 EMM-NULL EPS services are disabled in the UE. No EPS mobility management function shall be performed in this state.
<control> <start_state> In the state EMM-DEREGISTERED, </start_state> <action> no EMM context has been established </action> and <action> the UE location is unknown to an MME </action> and <action> hence it is unreachable by an MME. </action> <control> <condition> In order to establish an EMM context, </condition> <action> the UE shall start the attach or combined attach procedure (see subclause 5.5.1). </action> </control> </control>
<control> <end_state> A UE enters the state EMM-REGISTERED-INITIATED </end_state> <condition> <condition> after it has started the attach or the combined attach procedure </condition> and <condition> is waiting for a response from the MME (see subclause 5.5.1). </condition> </condition> </control>
<control> <start_state> In the state EMM-REGISTERED </start_state> <action> an EMM context has been established. </action> <control> <action> Additionally a default EPS bearer context has been activated in the UE: </action> <condition> a) <condition> if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; </condition> or b) <condition> <condition> if EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> <condition> the UE has requested connectivity to a PDN </condition> and <condition> a default EPS bearer context is successfully established. </condition> </condition> </condition> </control> </control>
<control> <condition> When the UE is in EMM-IDLE mode, </condition> <action> the UE location is known to the MME with an accuracy of a list of tracking areas containing a certain number of tracking areas. </action> </control> <control> <condition> When the UE is in EMM-CONNECTED mode, </condition> <action> the UE location is known to the MME with an accuracy of a serving eNodeB. </action> <action> The UE may initiate sending and receiving user data and signalling information and reply to paging. </action> <action> Additionally, tracking area updating or combined tracking area updating procedure is performed (see subclause 5.5.3). </action> </control>
<control> <end_state> A UE enters the state EMM-DEREGISTERED-INITIATED </end_state> <condition> after it has <condition> requested release of the EMM context <condition> by starting the detach or combined detach procedure </condition> </condition> and <condition> is waiting for a response from the MME (see subclause 5.5.2). </condition> </condition> </control>
<control> <end_state> A UE enters the state EMM-TRACKING-AREA-UPDATING-INITIATED </end_state> <condition> <condition> after it has started the tracking area updating or combined tracking area updating procedure </condition> and <condition> is waiting for a response from the MME (see subclause 5.5.3). </condition> </condition> </control>
<control> <end_state> A UE enters the state EMM-SERVICE-REQUEST-INITIATED </end_state> <condition> after it has started the service request procedure and is waiting for a response from the MME (see subclause 5.6.1). </condition> </control>
EMM-TRACKING- a) TAU rejected EMM-NULL (other causes) AREA-UPDATING- INITIATED EMM- DEREGISTERED- INITIATED b) DETACH accepted c) Lower layer failure d) DETACH requested
( not power off) a) Network init. DETACH requested EMM- - local DETACH EMM- DEREGISTERED - intersystem change to cdma2000 REGISTERED HRPD completed b) ATTACH - ATTACH rejected requested c) Network init. DETACH requested d) Lower layer failure - ATTACH - e) accepted f)
NOTE: Not all possible transitions are shown in this figure.
5.1.3.2.3 Substates of state EMM-DEREGISTERED
5.1.3.2.3.1 General
The state EMM-DEREGISTERED is subdivided into a number of substates as described in this subclause. Valid subscriber data are available for the UE before it enters the substates, except for the substate EMM- DEREGISTERED.NO-IMSI.
<control> <end_state> The substate EMM-DEREGISTERED.NORMAL-SERVICE is chosen in the UE </end_state> <condition> when <condition> a suitable cell has been found </condition> and <condition> the PLMN or tracking area is not in the forbidden list. </condition> </condition> </control>
<control> <end_state> The substate EMM-DEREGISTERED.LIMITED-SERVICE is chosen in the UE, </end_state> <condition> when it is known that a selected cell is unable to provide normal service (e.g. <condition> the selected cell is in a forbidden PLMN, </condition> <condition> is in a forbidden tracking area </condition> or <condition> the selected cell is a CSG cell whose CSG ID and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG List </condition> ). </condition> </control>
<control> <end_state> The substate EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH is chosen in the UE </end_state> <condition> if the attach or combined attach procedure failed <condition> <condition> due to a missing response from the network </condition> or <condition> due to the circumstances described in subclauses 5.5.1.2.5, 5.5.1.2.6, 5.5.1.3.5 and 5.5.2.3.4. </condition> </condition> </condition> </control>
<control> <end_state> The substate EMM-DEREGISTERED.PLMN-SEARCH is chosen in the UE, </end_state> <condition> if the UE is searching for PLMNs. </condition> </control> <control> This substate is left either <control> <condition> when a cell has been selected </condition> <end_state> (the new substate is NORMAL-SERVICE or LIMITED-SERVICE) </end_state> </control> or <control> <condition> when it has been concluded that no cell is available at the moment </condition> <end_state> (the new substate is NO-CELL-AVAILABLE). </end_state> </control> </control>
<control> <end_state> The substate EMM-DEREGISTERED.NO-IMSI is chosen in the UE, </end_state> <condition> <condition> if the UE has no valid subscriber data available <condition> ( <condition> SIM/USIM not available, </condition> or <condition> the SIM/USIM is considered invalid by the UE </condition> ) </condition> </condition> and <condition> a cell has been selected. </condition> </condition> </control>
<control> <end_state> EMM-DEREGISTERED.ATTACH-NEEDED. Valid subscriber data are available for the UE and for some reason an attach must be performed as soon as possible. This substate can be entered </end_state> <condition> <condition> if the access class is blocked due to access class control, </condition> or <condition> if the network rejects the NAS signalling connection establishment. </condition> </condition> </control>
<control> <end_state> EMM-DEREGISTERED.NO-CELL-AVAILABLE. No E-UTRAN cell can be selected. This substate is entered </end_state> <condition> after a first intensive search failed </condition> <start_state> when in substate EMM- DEREGISTERED.PLMN-SEARCH. </start_state> Cells are searched for at a low rhythm. No EPS services are offered. </control>
<control> <end_state> The substate EMM-DEREGISTERED.eCALL-INACTIVE is chosen in the UE </end_state> <condition> when: <condition> a) the UE is configured for eCall only mode as specified in 3GPP TS 31.102 ; </condition> <condition> b) timer T3444 and timer T3445 have expired or are not running; </condition> <condition> c) a PLMN has been selected as specified in 3GPP TS 23.122 ; </condition> <condition> d) the UE does not need to perform an eCall over IMS; </condition> and <condition> e) the UE does not need to perform a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service. </condition> </condition> <control> <action> In this substate, the UE shall not initiate any signalling towards the network, </action> <condition> except to o <condition> riginate an eCall over IMS, </condition> or <condition> a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service. </condition> </condition> </control> </control>
5.1.3.2.4 Substates of state EMM-REGISTERED
5.1.3.2.4.1 General
The state EMM-REGISTERED is subdivided into a number of substates as described in this subclause.
<control> <end_state> The substate EMM-REGISTERED.NORMAL-SERVICE is chosen by the UE </end_state> <condition> as the primary substate when the UE enters the state EMM-REGISTERED. </condition> </control>
<control> <end_state> The substate EMM-REGISTERED.LIMITED-SERVICE is chosen in the UE, </end_state> <condition> if the cell the UE selected is known not to be able to provide normal service. </condition> </control>
<control> <end_state> The substate EMM-REGISTERED.PLMN-SEARCH is chosen in the UE, </end_state> <condition> while the UE is searching for PLMNs. </condition> </control>
<control> <end_state> EMM-REGISTERED.UPDATE-NEEDED. </end_state> <condition> <condition> The UE has to perform a tracking area updating or combined tracking area updating procedure, </condition> but <condition> access to the current cell is barred. </condition> </condition> <condition> This state can be entered <condition> if the access class is blocked due to access class control, </condition> or <condition> if the network rejects the NAS signalling connection establishment. </condition> </condition> <condition> No EMM procedure except: a) tracking area updating; b) combined tracking area updating; or c) service request as a response to paging shall be initiated by the UE in this substate. </condition> </control>
<control> <end_state> EMM-REGISTERED.NO-CELL-AVAILABLE </end_state> <condition> E-UTRAN coverage has been lost or PSM is active in the UE. </condition> <control> <condition> If PSM is active, </condition> <action> the UE can deactivate PSM at any time by activating the AS layer when the UE needs to send mobile originated signalling or user data. </action> </control> <control> <condition> Otherwise, </condition> <action> the UE shall not initiate any EMM procedure except for cell and PLMN reselection. </action> </control> </control>
<control> <end_state> EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. </end_state> <condition> A combined attach procedure or a combined tracking area updating procedure was successful for EPS services only. </condition> <action> User data and signalling information may be sent and received. </action> </control>
<control> <end_state> EMM-REGISTERED.IMSI-DETACH-INITIATED. </end_state> The UE performs a combined detach procedure for non-EPS services only (detach type "IMSI detach"). <condition> This substate is entered <condition> if the UE is attached for EPS and non-EPS services </condition> and <condition> wants to detach for non-EPS services only. </condition> </condition> <action> User data and signalling information may be sent and received. </action> </control>
5.1.3.3 EPS update status
In order to describe the detailed UE behaviour, the EPS update (EU) status pertaining to a specific subscriber is defined.
The EPS update status is stored in a non-volatile memory in the USIM if the corresponding file is present in the USIM, else in the non-volatile memory in the ME, as described in annex C.
<control> <action> The EPS update status value is changed </action> <condition> <condition> only after the execution of an attach or combined attach, network initiated detach, authentication, tracking area update or combined tracking area update, service request or paging for EPS services using IMSI procedure </condition> or <condition> due to change in TAI which is not part of TAI list while timer T3346 is running. </condition> </condition> </control>
EU1: UPDATED
The last attach or tracking area updating attempt was successful.
EU2: NOT UPDATED
The last attach, service request or tracking area updating attempt failed procedurally, e.g. no response or reject message was received from the MME.
EU3: ROAMING NOT ALLOWED
The last attach, service request or tracking area updating attempt was correctly performed, but the answer from the MME was negative (because of roaming or subscription restrictions).
5.1.3.4 EMM sublayer states in the MME
<control> <start_state> In the state EMM-DEREGISTERED, </start_state> <action> the MME has no EMM context or the EMM Context is marked as detached. </action> <action> The UE is detached. </action> <action> The MME may answer to an attach or a combined attach procedure initiated by the UE (see subclause 5.5.1). </action> <control> <action> The MME may also answer to a tracking area updating procedure or combined tracking area updating procedure initiated by a UE </action> <condition> if the EMM context is marked as detached. </condition> </control> <action> The MME may also answer to a detach procedure initiated by the UE (see subclause 5.5.1.2.7). </action> </control>
<control> <condition> <condition> If ISR is not activated </condition> or <condition> ISR is deactivated <condition> during a routing area updating or combined routing area updating procedure or an inter-system handover to A/Gb mode or Iu mode, </condition> </condition> </condition> <action> the MME enters the state EMM-DEREGISTERED after the successful completion of the procedure. </action> </control>
<control> <end_state> The MME enters the state EMM-COMMON-PROCEDURE-INITIATED, </end_state> <condition> after it has started a common EMM procedure (see subclause 5.4) and is waiting for a response from the UE. </condition> </control>
<control> <start_state> In the state EMM-REGISTERED, </start_state> <action> an EMM context has been established. </action> <control> Additionally <action> a default EPS bearer context has been activated in the MME: </action> a) <condition> if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; </condition> or b) <condition> <condition> if EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> <condition> the UE has requested connectivity to a PDN </condition> and <condition> a default EPS bearer context is successfully established. </condition> </condition> </control> </control>
<control> <end_state> The MME enters the state EMM-DEREGISTERED-INITIATED </end_state> <condition> <condition> after it has started a detach procedure </condition> and <condition> is waiting for a response from the UE (see subclause 5.5.2). </condition> </condition> </control>
EMM- DEREGISTERED- INITIATED a) DETACH accepted - Network initiated
a) Lower layer failure DETACH requested
a) EMM- EMM- DEREG ISTERED REGISTERED
a) COMMON procedure
a) COMMON procedure successful b) Lfaoilweder layer failure - AsuTcTceAsCsfHul proc edur e
5.1.4 Coordination between EMM and GMM
<control> <condition> If GMM and EMM are both enabled, </condition> a UE <condition> capable of S1 mode and A/Gb mode or Iu mode or both </condition> <action> shall maintain one common registration for GMM and EMM indicating whether the UE is registered for packet services or not. </action> </control>
<control> <condition> A UE that is not registered </condition> <end_state> shall be in state GMM-DEREGISTERED </end_state> and <end_state> in state EMM-DEREGISTERED. </end_state> </control>
<control> <condition> <condition> If the UE performs a successful attach or combined attach procedure </condition> <condition> in S1 mode </condition> , </condition> <end_state> it shall enter substates GMM- REGISTERED.NO-CELL-AVAILABLE and EMM-REGISTERED.NORMAL-SERVICE. </end_state> <action> The UE resets the attach attempt counter and the GPRS attach attempt counter (see 3GPP TS 24.008 ). </action> </control>
<control> <condition> If the UE performs a successful GPRS attach or combined GPRS attach procedure <condition> in A/Gb or Iu mode, </condition> </condition> <end_state> it shall enter substates GMM-REGISTERED.NORMAL-SERVICE and EMM-REGISTERED.NO-CELL-AVAILABLE. </end_state> <action> The UE resets the attach attempt counter and the GPRS attach attempt counter (see 3GPP TS 24.008 ). </action> </control>
<control> <condition> <condition> At intersystem change from A/Gb or Iu mode to S1 mode </condition> <condition> when no PDP context is active, </condition> </condition> <control> <condition> if EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> <end_state> the UE shall move to state EMM-DEREGISTERED and state GMM-DEREGISTERED </end_state> and <action> then initiate an attach procedure. </action> </control> <control> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> <end_state> the UE shall enter substates EMM-REGISTERED.NORMAL- SERVICE and GMM-REGISTERED.NO-CELL-AVAILABLE </end_state> and <action> initiate a tracking area updating procedure. </action> </control> </control>
<control> <condition> After successful completion of routing area updating or combined routing area updating and tracking area updating or combined tracking area updating procedures <condition> in both S1 mode and A/Gb or Iu mode, </condition> </condition> <condition> if the network has indicated that ISR is activated, </condition> <action> the UE shall maintain registration and related periodic update timers in both GMM and EMM. </action> </control>
NOTE: <control> As specified in subclause 5.5.3.2.4 of this document or subclause 4.7.5.1.3 of 3GPP TS 24.008 , <action> the UE does not activate the ISR </action> <condition> even if the network has indicated that the ISR is activated e.g. in the tracking area updating procedure triggered due to a change in UE network capability. </condition> In these scenarios, <action> the UE only maintains one registration and related periodic update timer in GMM or EMM. </action> </control>
5.1.5 Coordination between EMM and MM
UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation shall use the combined EPS/IMSI attach procedure in order to attach to both EPS and non-EPS services.
UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation and are already attached to both EPS and non-EPS services shall use the combined tracking area updating and periodic tracking area updating procedures.
UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation and are already attached to both EPS and non-EPS services shall perform a combined detach procedure in order to detach for non-EPS services.
<control> <condition> <condition> If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 </condition> and <condition> moves from GERAN/UTRAN to E-UTRAN, </condition> </condition> the UE shall: <control> a) <condition> if timer T3242 is running, </condition> <action> start timer T3444 with the time left on T3242 </action> and <action> stop timer T3242; </action> </control> <control> b) <condition> if timer T3243 is running, </condition> <action> start timer T3445 with the time left on T3243 </action> and <action> stop timer T3243; </action> </control> <control> c) <condition> <condition> if the UE is attached for both EPS services and non-EPS services </condition> and <condition> timer T3242 or timer T3243 is running, </condition> </condition> <action> perform a combined tracking area updating procedure; </action> </control> and <control> d) <condition> <condition> if the UE is attached for non-EPS services only </condition> and <condition> timer T3242 or timer T3243 is running, </condition> </condition> <action> perform a combined attach procedure. </action> </control> </control>
NOTE 1: <control> A UE configured for eCall only mode as specified in 3GPP TS 31.102 being attached for both EPS services and non-EPS services upon moving from GERAN/UTRAN to E-UTRAN is only possible <condition> in the case when <condition> the UE has performed a combined attach in E-UTRAN, </condition> <condition> subsequently moved to GERAN/UTRAN </condition> and <condition> returned to E-UTRAN <condition> before timer T3242 or timer T3243 expires. </condition> </condition> </condition> </control>
NOTE 2: Timers T3242 and T3243 are specified in 3GPP TS 24.008 .
5.2 Behaviour of the UE in state EMM-DEREGISTERED and state EMM-REGISTERED
5.2.1 General
In this subclause, the detailed behaviour of the UE in the states EMM-DEREGISTERED and EMM-REGISTERED is described.
5.2.2 UE behaviour in state EMM-DEREGISTERED
5.2.2.1 General
<control> <end_state> The state EMM-DEREGISTERED is entered in the UE, </end_state> <condition> when: <condition> a) the detach or combined detach is performed either by the UE or by the MME (see subclause 5.5.2); </condition> <condition> b) the attach request is rejected by the MME (see subclause 5.5.1); </condition> <condition> c) the tracking area update request is rejected by the MME (see subclause 5.5.3); </condition> <condition> d) the service request procedure is rejected by the MME (see subclause 5.6.1); </condition> <condition> e) the UE deactivates all EPS bearer contexts locally (see subclause 6.4.4.6); </condition> <condition> f) the UE is switched on; </condition> <condition> g) <condition> an inter-system change from S1 mode to non-3GPP access is completed </condition> and <condition> the non-3GPP access network provides PDN connectivity to the same EPC; </condition> </condition> or <condition> h) <condition> the UE attached for emergency bearer services is in EMM-IDLE mode </condition> and <condition> its periodic tracking area update timer expires (see subclause 5.3.5). </condition> </condition> </condition> </control>
In state EMM-DEREGISTERED, the UE shall behave according to the substate as explained in subclause 5.2.2.3.
5.2.2.2 Primary substate selection
5.2.2.2.1 Selection of the substate after power on
<control> <condition> For a UE configured for eCall only mode as specified in 3GPP TS 31.102 , </condition> <action> timers T3444 and T3445 are considered to have expired at power on. </action> <control> <condition> When the UE is switched on, </condition> <end_state> the substate shall be PLMN-SEARCH </end_state> <condition> if the USIM is available and valid. </condition> </control> </control> See 3GPP TS 23.122 for further details.
<control> <start_state> The substate chosen after PLMN-SEARCH, </start_state> <condition> following power on </condition> is: <control> a) <condition> if no cell can be selected, </condition> <end_state> the substate shall be NO-CELL-AVAILABLE; </end_state> </control> <control> b) <condition> if no USIM is present, </condition> <end_state> the substate shall be NO-IMSI; </end_state> </control> <control> c) <condition> <condition> if a suitable cell has been found </condition> and <condition> the PLMN or tracking area is not in the forbidden list, </condition> </condition> <end_state> then the substate shall be NORMAL-SERVICE; </end_state> </control> <control> d) <condition> if the selected cell is known not to be able to provide normal service, </condition> <end_state> then the UE shall enter the substate LIMITED-SERVICE; </end_state> </control> <control> e) <condition> <condition> if the UE is in manual network selection mode </condition> and <condition> no cell of the selected PLMN has been found, </condition> </condition> <end_state> the UE shall enter the substate NO-CELL-AVAILABLE; </end_state> </control> <control> f) <condition> if the selected cell is a non-3GPP cell, </condition> <end_state> the substate shall be NO-CELL-AVAILABLE; </end_state> </control> and <control> g) <condition> if the UE is configured for eCall only mode as specified in 3GPP TS 31.102 , </condition> <end_state> the substate shall be eCALL-INACTIVE. </end_state> </control> </control>
5.2.2.3 Detailed description of UE behaviour in state EMM-DEREGISTERED
<control> <start_state> EMM-DEREGISTERED.NORMAL-SERVICE. </start_state> <control> <action> The UE shall initiate an attach or combined attach procedure </action> <condition> if timer T3346 is not running. </condition> </control> <control> <condition> If timer T3346 is running, </condition> <action> the UE shall initiate an attach or combined attach procedure </action> <condition> on the expiry of timer T3346. </condition> </control> <control> <action> The UE may initiate attach for emergency bearer services </action> <condition> even if timer T3346 is running. </condition> </control> </control>
<control> <start_state> EMM-DEREGISTERED.LIMITED-SERVICE. </start_state> <control> <action> The UE shall initiate an attach or combined attach procedure </action> <condition> when entering a cell which provides normal service. </condition> </control> <action> The UE may initiate attach for emergency bearer services. </action> <action> The UE may initiate attach for access to RLOS. </action> </control>
<control> <start_state> EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. </start_state> The UE: <control> a) <action> shall initiate an attach or combined attach procedure </action> <condition> on the expiry of timers T3411, T3402 or T3346 (see 3GPP TS 24.008 ); </condition> </control> <control> b) <action> may initiate an attach for emergency bearer services </action> <condition> even if timer T3346 is running; </condition> </control> <control> c) <action> shall initiate an attach or combined attach procedure when entering a new PLMN, </action> <condition> <condition> if timer T3346 is running </condition> and <condition> <condition> the new PLMN is not equivalent to the PLMN </condition> <condition> where the UE started timer T3346, </condition> </condition> <condition> the PLMN identity of the new cell is not in one of the forbidden PLMN lists </condition> and <condition> the tracking area is not in one of the lists of forbidden tracking areas; </condition> </condition> </control> <control> d) <action> shall initiate an attach or combined attach procedure when the tracking area of the serving cell has changed, </action> <condition> <condition> if timer T3346 is not running, </condition> <condition> the PLMN identity of the new cell is not in one of the forbidden PLMN lists </condition> and <condition> the tracking area of the new cell is not in one of the lists of forbidden tracking areas; </condition> </condition> </control> <control> e) <action> shall use requests for non-EPS services for non-emergency call from CM layers to trigger a combined attach procedure, </action> <condition> <condition> if timer T3346 is not running (see subclause 5.5.1.3), </condition> or <condition> <condition> to attempt to select GERAN or UTRAN radio access technology </condition> and <condition> proceed with the appropriate MM and CC specific procedures; </condition> </condition> </condition> </control> <control> f) <action> shall use requests for non-EPS services for emergency call from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures; </action> </control> <control> g) <action> may initiate an attach procedure upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 ) </action> <condition> <condition> if timer T3346 is not already running for "MO exception data" </condition> and <condition> even if timer T3402 or timer T3411 is running; </condition> </condition> </control> <control> h) <action> may initiate an attach procedure upon request of the upper layers to establish a PDN connection for emergency bearer services; </action> </control> <control> and i) <action> may initiate an attach procedure upon request of the upper layers to establish a PDN connection for RLOS, </action> <condition> if timer T3346 is not running. </condition> </control> </control>
<control> <start_state> EMM-DEREGISTERED.PLMN-SEARCH. </start_state> <action> The UE shall perform PLMN selection. </action> <control> <condition> If a new PLMN is selected, </condition> <action> the UE shall reset the attach attempt counter </action> and <action> initiate the attach or combined attach procedure (see subclause 5.5.1). </action> </control> </control>
<control> <condition> If the selected cell is known not to be able to provide normal service: </condition> <action> a) the UE may initiate attach NO-IMSIfor emergency bearer services; </action> or <action> b) the UE may initiate attach for access to RLOS. </action> </control>
<control> <start_state> EMM-DEREGISTERED.NO-IMSI. </start_state> <action> The UE shall perform cell selection according to 3GPP TS 36.304 . </action> <action> The UE may initiate attach for emergency bearer services. </action> <action> The UE may initiate attach for access to RLOS. </action> </control>
<control> <start_state> EMM-DEREGISTERED.ATTACH-NEEDED. </start_state> <control> <action> The UE shall initiate the attach or combined attach procedure, </action> <condition> if still needed, </condition> <condition> as soon as the access is allowed in the selected cell for one of the access classes of the UE. </condition> </control> <action> The UE may initiate attach for emergency bearer services. </action> <action> The UE may initiate attach for access to RLOS. </action> </control>
<control> <start_state> EMM-DEREGISTERED.NO-CELL-AVAILABLE. </start_state> <action> The UE shall perform cell selection according to 3GPP TS 36.304 </action> and <control> <action> choose an appropriate substate </action> <condition> when a cell is found. </condition> </control> <control> <condition> <condition> When the lower layers indicate to prepare for an S101 mode to S1 mode handover </condition> and <condition> the PLMN identity of the target cell provided with this indication is not in one of forbidden PLMN lists, </condition> </condition> <end_state> the UE shall enter substate NORMAL-SERVICE. </end_state> </control> </control>
NOTE: It is assumed that the UE can determine the PLMN identity of networks supporting cdma2000 HRPD access from the information broadcast over the radio interface. For the purpose of S101 mode to S1 mode handover, the UE can use the PLMN identity of the visited cdma2000 HRPD network also as PLMN identity of the target cell.
<control> <start_state> EMM-DEREGISTERED.eCALL-INACTIVE. </start_state> <action> The UE camps on a suitable cell or an acceptable cell in a PLMN selected as specified in 3GPP TS 23.122 but initiates no EMM signalling with the network and ignores any paging requests. </action> </control>
<control> <start_state> The UE shall leave substate EMM-DEREGISTERED.eCALL-INACTIVE state </start_state> only when one of the following events occur: <control> a) <condition> if the USIM is removed, </condition> <end_state> the UE enters substate EMM-DEREGISTERED.NO-IMSI; </end_state> </control> <control> b) <condition> if coverage is lost, </condition> <end_state> the UE enters substate EMM-DEREGISTERED.PLMN-SEARCH; c) if the UE is deactivated (e.g. powered off) by the user, the UE enters state EMM-NULL; </end_state> </control> <control> d) <condition> if the UE receives a request from upper layers to establish an eCall over IMS, </condition> <end_state> the UE enters state EMM- DEREGISTERED.ATTEMPTING-TO-ATTACH. </end_state> The UE then uses the relevant EMM and ESM procedures to establish the eCall over IMS at the earliest opportunity; </control> or <control> e) <condition> if the UE receives a request from upper layers to establish a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service, </condition> <end_state> the UE enters state EMM- DEREGISTERED.ATTEMPTING-TO-ATTACH. </end_state> <control> <condition> Once the attach procedure is completed, </condition> <action> the UE uses the relevant EMM and ESM procedures to establish the non-emergency call. </action> </control> </control> </control>
5.2.2.4 Substate when back to state EMM-DEREGISTERED from another EMM state
When returning to state EMM-DEREGISTERED, the UE shall select a cell as specified in 3GPP TS 36.304 .
The substate depends on the result of the cell selection procedure, the outcome of the previously performed EMM specific procedures, on the EPS update status of the UE, on the tracking area data stored in the UE, on the presence of the USIM, on the UE configuration and on the reason for moving to EMM-DEREGISTERED: a) <control> <condition> If no cell has been found, </condition> <end_state> the substate is NO-CELL-AVAILABLE, </end_state> <condition> until a cell is found. </condition> </control> b) <control> <condition> <condition> If no USIM is present </condition> or <condition> if the inserted USIM is considered invalid by the UE, </condition> </condition> <end_state> the substate shall be NO-IMSI. </end_state> </control> c) <control> <condition> <condition> If a suitable cell has been found </condition> and <condition> the PLMN or tracking area is not in the forbidden list, </condition> </condition> <end_state> the substate shall be NORMAL-SERVICE. </end_state> </control> d) <control> <condition> If an attach shall be performed (e.g. network requested re-attach), </condition> <end_state> the substate shall be ATTEMPTING-TO- ATTACH. </end_state> </control> e) <control> <condition> If a PLMN reselection (according to 3GPP TS 23.122 ) is needed, </condition> <end_state> the substate shall be PLMN-SEARCH. </end_state> </control> f) <control> <condition> If the selected cell is known not to be able to provide normal service, </condition> <end_state> the substate shall be LIMITED-SERVICE; </end_state> </control> g) <control> <condition> If the selected cell is a non-3GPP cell, </condition> <end_state> the substate shall be NO-CELL-AVAILABLE; and </end_state> </control> h) <control> <condition> <condition> If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 , </condition> <condition> T3444 and T3445 have expired or are not running, </condition> and <condition> substate PLMN-SEARCH is not required, </condition> </condition> <end_state> the substate shall be eCALL- INACTIVE. </end_state> </control>
5.2.3 UE behaviour in state EMM-REGISTERED
5.2.3.1 General
<control> <end_state> The state EMM-REGISTERED is entered at the UE, </end_state> when: <condition> a) the attach or combined attach procedure is performed by the UE </condition> (see subclause 5.5.1). </control>
In state EMM-REGISTERED, the UE shall behave according to the substate as explained in subclause 5.2.3.2.
5.2.3.2 Detailed description of UE behaviour in state EMM-REGISTERED
<control> <start_state> EMM-REGISTERED.NORMAL-SERVICE. </start_state> The UE: <action> a) shall initiate normal and combined tracking area updating (according to conditions given in subclause 5.5.3); </action> <control> b) <action> shall perform periodic tracking area updating (see subclause 5.5.3) </action> <condition> except when attached for emergency bearer services (see subclause 5.3.5); </condition> </control> <action> c) shall initiate a tracking area updating on the expiry of timer T3411; </action> <action> d) shall respond to paging; </action> and <control> e) <condition> if configured for eCall only mode as specified in 3GPP TS 31.102 , </condition> <action> shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4). </action> </control> </control>
<control> <start_state> EMM-REGISTERED.ATTEMPTING-TO-UPDATE. </start_state> The UE: <action> a) shall not send any user data; </action> <action> b) shall initiate tracking area updating on the expiry of timers T3411, T3402 or T3346; </action> <control> c) <action> shall initiate tracking area updating when entering a new PLMN, </action> <condition> <condition> if timer T3346 is running </condition> and <condition> <condition> the new PLMN is not equivalent to the PLMN </condition> <condition> where the UE started timer T3346, </condition> </condition> <condition> the PLMN identity of the new cell is not in one of the forbidden PLMN lists, </condition> and <condition> the tracking area is not in one of the lists of forbidden tracking areas; </condition> </condition> </control> <control> d) <action> shall initiate tracking area updating when the tracking area of the serving cell has changed, </action> <condition> <condition> if timer T3346 is not running, </condition> <condition> the PLMN identity of the new cell is not in one of the forbidden PLMN lists </condition> and <condition> the tracking area is not in one of the lists of forbidden tracking areas; </condition> </condition> </control> <control> e) <action> may initiate a tracking area updating procedure </action> <condition> upon request of the upper layers to establish a PDN connection for emergency bearer services; </condition> </control> <control> f) <action> shall initiate tracking area updating procedure upon request of the upper layers to establish a PDN connection without the NAS signalling low priority indication as specified in subclause 5.5.3.2.6, item l), </action> <condition> <condition> if timer T3346 is running </condition> <condition> due to a NAS request message (TRACKING AREA UPDATE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST) </condition> <condition> which contained the low priority indicator set to "MS is configured for NAS signalling low priority </condition> <condition> "and timer T3402 and timer T3411 are not running; </condition> </condition> </control> <control> g) <action> may detach locally </action> and <action> initiate an attach for emergency bearer services </action> <condition> even if timer T3346 is running; </condition> </control> <control> h) <action> shall use requests for non-EPS services from CM layers to trigger a combined tracking area updating procedure, </action> <condition> <condition> if timer T3346 is not running (see subclause 5.5.3.3), </condition> or <condition> to attempt to select GERAN, UTRAN or cdma2000 1xRTT radio access technology and proceed with the appropriate MM and CC specific procedures; </condition> </condition> </control> <control> i) <action> may use requests for an MMTEL voice call or MMTEL video call from the upper layers to initiate tracking area updating, </action> <condition> if timer T3346 is not running; </condition> </control> <action> j) shall initiate tracking area updating in response to paging with S-TMSI or paging with IMSI and domain indicator set to CS ; </action> <control> k) <action> shall initiate tracking area updating </action> <condition> <condition> if the EPS update status is set to EU2 NOT UPDATED, </condition> and <condition> timers T3411, T3402 and T3346 are not running; </condition> </condition> </control> <control> l) <condition> if configured for eCall only mode as specified in 3GPP TS 31.102 , </condition> <action> shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4); </action> </control> <control> m) <action> may initiate tracking area updating upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 ) </action> <condition> if timer T3346 is not already running for "MO exception data" and even if timer T3402 or timer T3411 is running; </condition> </control> and <action> n) shall not initiate the detach signalling procedure unless timer T3346 is running and the current TAI is part of the TAI list. </action> </control>
<control> <start_state> EMM-REGISTERED.LIMITED-SERVICE. </start_state> The UE: <action> a) shall perform cell selection/reselection according to 3GPP TS 36.304 ; </action> <action> b) may respond to paging (with IMSI); </action> <action> c) may detach locally and initiate attach for emergency bearer services; </action> <action> d) may detach locally and may initiate attach for access to RLOS; </action> and <control> e) <condition> if configured for eCall only mode as specified in 3GPP TS 31.102 , </condition> <action> shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4). </action> </control> </control>
<control> <end_state> EMM-REGISTERED.LIMITED-SERVICE. The UE may enter this substate </end_state> <condition> <condition> when it is in automatic network selection mode </condition> and <condition> the maximum allowed number of subsequently unsuccessful tracking area updating have been performed. </condition> <condition> The UE may also enter this substate as a result of a tracking area update rejected by the network (see subclause 5.5.3) </condition> or <condition> as a result of a service request rejected by the network (see subclause 5.6.1). </condition> </condition> </control> <control> <condition> If a new PLMN is selected, </condition> <action> the UE shall reset the tracking area updating attempt counter </action> and <action> initiate the tracking area updating or combined tracking area updating procedure (see subclause 5.5.3). </action> </control>
<control> <condition> If the selected cell is known not to be able to provide normal service: </condition> <action> a) the UE may detach locally and initiate attach for emergency bearer services; </action> or <action> b) the UE may detach locally and initiate attach for access to RLOS. </action> </control>
<control> <start_state> EMM-REGISTERED.UPDATE-NEEDED. </start_state> The UE: <action> a) shall not send any user data; </action> <control> b) <action> shall not send signalling information, </action> <condition> <condition> unless it is a service request as a response to paging or a tracking area updating or combined tracking area updating procedure </condition> <condition> <condition> upon request by the upper layers to establish a PDN connection for emergency bearer services </condition> or <condition> upon a request from the upper layers for an MMTEL voice call, MMTEL video call, SMSoIP, SMS over NAS or SMS over S102; </condition> </condition> </condition> </control> <action> c) shall perform cell selection/reselection according to 3GPP TS 36.304 ; </action> <action> d) shall enter the appropriate new substate as soon as the access is allowed in the selected cell for one of the access classes of the UE; </action> <control> and e) <condition> if configured for eCall only mode as specified in 3GPP TS 31.102 , </condition> <action> shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4). </action> </control> </control>
EMM-REGISTERED.NO-CELL-AVAILABLE. The UE shall perform cell selection/reselection according to 3GPP TS 36.304 .
<control> <start_state> EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. </start_state> The UE: <action> a) shall perform cell selection/reselection according to 3GPP TS 36.304 ; </action> <action> b) shall be able to receive and transmit user data and signalling information; </action> <control> c) <action> shall initiate combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" </action> <condition> <condition> on the expiry of timers T3411 or T3402 </condition> or <condition> <condition> when the UE enters a tracking area not in the list of registered tracking areas </condition> and <condition> not in one of the lists of forbidden tracking areas; </condition> </condition> </condition> </control> <action> d) shall respond to paging with IMSI or S-TMSI for the PS domain; </action> <control> e) <action> shall use requests for non-EPS services from CM layers to attempt to select GERAN or UTRAN radio access technology </action> and <action> proceed with the appropriate MM and CC specific procedures, </action> <condition> unless T3402 is running due to receipt of an ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message with EMM cause #22 "congestion"; </condition> </control> <control> f) <action> shall use requests for non-EPS services due to emergency call from CM layers to attempt to select GERAN or UTRAN radio access technology </action> and <action> proceed with the appropriate MM and CC specific procedures, </action> <condition> even if <condition> T3402 is running </condition> <condition> due to receipt of an ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message </condition> <condition> with EMM cause #22 "congestion"; </condition> </condition> </control> and <control> g) <condition> if configured for eCall only mode as specified in 3GPP TS 31.102 , </condition> <action> shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4). </action> </control> </control>
<control> <start_state> EMM-REGISTERED.IMSI-DETACH-INITIATED. </start_state> The UE: <action> a) shall be able to receive and transmit user data and signalling information; </action> <action> b) shall initiate combined tracking area updating procedure (according to conditions given in subclause 5.5.3.3 or subclause 5.5.2.2.4); </action> and <control> c) <condition> if configured for eCall only mode as specified in 3GPP TS 31.102 , </condition> <action> shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4). </action> </control> </control>
5.3 General on elementary EMM procedures
5.3.1 EMM modes and NAS signalling connection
5.3.1.1 Establishment of the NAS signalling connection
<control> <condition> <condition> When the UE is in EMM-IDLE mode </condition> <condition> without suspend indication </condition> and <condition> needs to transmit an initial NAS message, </condition> </condition> <action> the UE shall request the lower layer to establish a RRC connection. </action> <action> In this request to the lower layer the NAS shall provide to the lower layer the RRC establishment cause and the call type as specified in annex D of this specification and, </action> <control> <condition> for the case specified in subclause 5.6.1.2.2, </condition> <action> shall also provide the initial NAS message, </action> </control> <control> <condition> otherwise </condition> <action> NAS may also provide the initial NAS message. </action> </control> </control>
Initial NAS messages are: a) ATTACH REQUEST; b) DETACH REQUEST; c) TRACKING AREA UPDATE REQUEST; d) SERVICE REQUEST; e) EXTENDED SERVICE REQUEST; and f) CONTROL PLANE SERVICE REQUEST.
<control> <condition> <condition> When the UE is in EMM-IDLE mode </condition> <condition> with suspend indication, </condition> </condition> <action> the UE shall proceed the behaviour as specified in subclauses 5.3.1.3. </action> </control>
<control> <condition> For the routing of the initial NAS message to the appropriate MME, </condition> <action> the UE NAS provides the lower layers with either the S-TMSI, the registered globally unique MME identifier (GUMMEI) that consists of the PLMN ID, the MME group ID, and the MME code (see 3GPP TS 23.003 ), </action> or <control> <action> none of them according to the following rules: </action> <control> a) <condition> If the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network, </condition> <condition> the UE holds a valid 5G-GUTI </condition> and: <condition> <condition> a) <condition> the UE performs an initial EPS attach procedure </condition> or <condition> tracking area updating procedure following an inter- system change from N1 mode to S1 mode; </condition> </condition> or <condition> b) the UE which was previously registered in N1 mode before entering state 5GMM-DEREGISTERED, performs an initial EPS attach procedure, </condition> </condition> <action> then the UE NAS shall provide the lower layers with the MME identifier part of the mapped GUTI, which is generated from the 5G-GUTI as specified in 3GPP TS 23.003 , an indication that the identifier is a native GUMMEI and an indication that the identifier is mapped from 5GS; </action> </control> <control> b) <condition> If the TIN indicates "GUTI" or "RAT-related TMSI", </condition> or <condition> <condition> the TIN is not available, </condition> and <condition> the UE holds a valid GUTI: </condition> </condition> <control> a) <condition> When the UE in EMM-IDLE mode initiates a tracking area updating or combined tracking area updating procedure for load balancing purposes, </condition> <action> the UE NAS shall provide the lower layers with neither S-TMSI nor registered MME identifier; </action> </control> <control> b) <condition> When the tracking area of the current cell is in the list of tracking areas that the UE previously registered in the MME during the NAS signalling connection establishment, </condition> <action> the UE NAS shall provide the lower layers with the S-TMSI, but shall not provide the registered MME identifier to the lower layers; </action> </control> or <control> c) <condition> When the tracking area of the current cell is not in the list of tracking areas that the UE previously registered in the MME during the NAS signalling connection establishment, </condition> <action> the UE NAS shall provide the lower layers with the MME identifier part of the valid GUTI with an indication that the identifier is a native GUMMEI. </action> </control> <control> c) <condition> <condition> If the TIN indicates "P-TMSI", </condition> or <condition> the TIN is not available, </condition> and <condition> the UE holds a valid P-TMSI and RAI, </condition> </condition> <action> the UE NAS shall provide the lower layers with the MME identifier part of the mapped GUTI, which is generated from the P-TMSI and RAI with an indication that the identifier is a mapped GUMMEI; </action> </control> or <control> d) <condition> Otherwise, </condition> the UE NAS does not provide the lower layers with the S-TMSI, the registered GUMMEI and the mapped GUMMEI. </control> </control> </control> </control>
<control> <action> The UE NAS also provides the lower layers with the identity of the selected PLMN (see 3GPP TS 36.331 ). </action> </control> <control> <condition> In a shared network, </condition> <action> the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 . </action> </control>
<control> <condition> When an ATTACH REQUEST message, or a TRACKING AREA UPDATE REQUEST message, <condition> when the TAI of the current cell is not included in the TAI list, </condition> is sent to establish a signalling connection, </condition> <action> the UE NAS also provides the lower layers with the DCN-ID according to the following rules: </action> <control> a) <condition> if a DCN-ID for the PLMN code of the selected PLMN is available in the UE, </condition> <action> the UE NAS shall provide this DCN-ID to the lower layers; </action> </control> or <control> b) <condition> if no DCN-ID for the PLMN code of the selected PLMN is available but a Default_DCN_ID value is avaialble in the UE, as specified in 3GPP TS 24.368 or in USIM file NAS as specified in 3GPP TS 31.102 , </condition> <action> CONFIG the UE NAS shall provide this DCN-ID to the lower layers. </action> </control> </control>
<control> <condition> If a relay node is attaching for relay node operation (see 3GPP TS 23.401 ), </condition> <action> the NAS in the relay node shall indicate to the lower layers that the establishment of the NAS signalling connection is for a relay node. </action> </control>
<control> <condition> <condition> In S1 mode, </condition> <condition> when the RRC connection has been established successfully, </condition> </condition> <action> the UE shall enter EMM-CONNECTED mode </action> and <action> consider the NAS signalling connection established. </action> </control>
<control> <condition> <condition> In S101 mode, </condition> <condition> when the cdma2000 HRPD access network resources are available for tunnelled NAS signalling, </condition> </condition> <action> the UE shall enter EMM-CONNECTED mode </action> and <action> consider the S101 mode NAS signalling connection established. </action> </control>
5.3.1.2 Release of the NAS signalling connection
5.3.1.2.1 General
The signalling procedure for the release of the NAS signalling connection is initiated by the network.
<control> <condition> <condition> In S1 mode, </condition> <condition> when the RRC connection has been released, </condition> </condition> <action> the UE shall enter EMM-IDLE mode </action> and <action> consider the NAS signalling connection released. </action> </control>
<control> <condition> If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 then: </condition> <control> a) <condition> if the NAS signalling connection that was released had been established for eCall over IMS, </condition> <action> the UE shall start timer T3444; </action> </control> and <control> b) <condition> <condition> if the NAS signalling connection that was released </condition> <condition> had been established for a call to an HPLMN designated non- emergency MSISDN </condition> or <condition> URI for test or terminal reconfiguration service, </condition> </condition> <action> the UE shall start timer T3445. </action> </control> </control>
<control> <action> The UE shall start the SGC timer T3447 with the service gap time value available in the UE </action> <condition> when the NAS signalling connection is released </condition> <condition> if: a) <condition> the UE supports SGC feature, </condition> and </condition> <condition> <condition> the service gap timer value is available in the UE </condition> and <condition> does not indicate zero; </condition> </condition> and <condition> b) the NAS signalling connection that was released had been established for mobile originated request for transfer of uplink data. </condition> </control>
<control> <condition> If the UE receives the "Extended wait time" from the lower layers when no attach, tracking area updating or service request procedure is ongoing, </condition> <action> the UE shall ignore the "Extended wait time". </action> </control>
<control> <condition> To allow the network to release the NAS signalling connection, </condition> the UE: <control> a) <action> shall start the timer T3440 </action> <condition> if the UE receives any of the EMM cause values #11, #12, #13, #14 (not applicable to the service request procedure), #15, #25, #31 or #35; </condition> </control> <control> b) <action> shall start the timer T3440 </action> <condition> if: <condition> <condition> the UE receives a TRACKING AREA UPDATE ACCEPT message </condition> <condition> which does not include a UE radio capability ID deletion indication IE; </condition> <condition> <condition> the UE has not set the "active" flag in the TRACKING AREA UPDATE REQUEST message; </condition> <condition> the UE has not set the "signalling active" flag in the TRACKING AREA UPDATE REQUEST message; </condition> <condition> the tracking area updating or combined tracking area updating procedure has been initiated in EMM-IDLE mode; </condition> and <condition> the user plane radio bearers have not been set up; </condition> </condition> </condition> </condition> </control> <control> c) <action> shall start the timer T3440 </action> <condition> <condition> if the UE receives a DETACH ACCEPT message </condition> and <condition> the UE has set the detach type to "IMSI detach" in the DETACH REQUEST message </condition> and <condition> user plane radio bearers have not been set up; </condition> </condition> </control> <control> d) <action> shall start the timer T3440 </action> <condition> <condition> if the UE receives a TRACKING AREA UPDATE REJECT message </condition> <condition> indicating: any of the EMM cause values #9 or #10 and the UE has no CS fallback emergency call, CS fallback call, 1xCS fallback emergency call, or 1xCS fallback call pending; </condition> or <condition> <condition> the EMM cause values #40, the TRACKING AREA UPDATE message was not triggered due to receiving a paging for CS fallback or a paging for 1xCS fallback, </condition> and <condition> the UE has no CS fallback emergency call, CS fallback call, 1xCS fallback emergency call, or 1xCS fallback call pending; </condition> </condition> </condition> </control> <control> e) <action> shall start the timer T3440 </action> <condition> <condition> if the UE receives a SERVICE REJECT message </condition> <condition> indicating any of the EMM cause values #9, #10 or #40 </condition> <condition> as a response to a SERVICE REQUEST message CONTROL PLANE SERVICE REQUEST message, or an EXTENDED SERVICE REQUEST message with service type set to "packet services via S1"; </condition> </condition> </control> <control> f) <action> may start the timer T3440 </action> <condition> <condition> if the UE receives any of the EMM cause values #3, #6, #7 or #8 </condition> or <condition> if it receives an AUTHENTICATION REJECT message; </condition> </condition> </control> <control> g) <action> shall start the timer T3440 </action> <condition> <condition> if the UE receives a SERVICE REJECT message indicating the EMM cause value #39 </condition> and <condition> the UE has initiated EXTENDED SERVICE REQUEST in EMM-IDLE </condition> and <condition> the user plane radio bearers have not been set up; </condition> </condition> </control> or <control> h) <action> shall start the timer T3440 </action> <condition> <condition> if the UE receives a SERVICE REJECT, SERVICE ACCEPT, ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message </condition> <condition> with control plane data back-off timer. </condition> </condition> </control> </control>
<control> <condition> Upon expiry of T3440, </condition> <control> a) <condition> in cases a, b, c, f and h, </condition> <action> the UE shall locally release the established NAS signalling connection; </action> </control> or <control> b) <condition> in cases d and e, </condition> <action> the UE shall locally release the established NAS signalling connection </action> and <action> the UE shall initiate the attach procedure as described in subclause 5.5.3.2.5, 5.5.3.3.5 or 5.6.1.5. </action> </control> </control>
<control> <condition> In cases b, c and g, </condition> <control> a) <condition> upon an indication from the lower layers that the user plane radio bearers are set up, </condition> <action> the UE shall stop timer T3440 </action> and <action> may send uplink signalling via the existing NAS signalling connection or user data via the user plane bearers. </action> <control> <condition> If the uplink signalling is for CS fallback for emergency call, or for establishing a PDN connection for emergency bearer services, </condition> <action> the UE shall send the uplink signalling via the existing NAS signalling connection; </action> </control> </control> or <control> b) <condition> upon receipt of a DETACH REQUEST message, </condition> <action> the UE shall stop timer T3440 </action> and <action> respond to the network initiated detach as specified in subclause 5.5.2.3. </action> </control> </control>
<control> <condition> In case b, </condition> <control> a) <condition> <condition> upon receiving a request from upper layers to send NAS signalling </condition> <condition> not associated with establishing either a CS emergency call or a PDN connection for emergency bearer services, </condition> </condition> <action> the UE shall wait for the the local release of the established NAS signalling connection </action> <condition> <condition> upon expiry of timer T3440 </condition> or <condition> T3440 being stopped before proceeding; </condition> </condition> </control> <control> b) <condition> upon receiving a request from upper layers to establish either a CS emergency call or a PDN connection for emergency bearer services, </condition> <action> the UE shall stop timer T3440 </action> and <action> shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.6.1; </action> </control> <control> c) <condition> upon receipt of ESM DATA TRANSPORT message, as an implementation option, </condition> <action> the UE may reset and restart timer T3440; </action> </control> <control> d) <condition> upon receipt of a DOWNLINK NAS TRANSPORT or DOWNLINK GENERIC NAS TRANSPORT message, </condition> <condition> the UE which is in EMM-REGISTERED without PDN connections </condition> <action> shall stop timer T3440 </action> and <action> may send uplink signalling via the existing NAS signalling connection; </action> or </control> <control> e) <condition> upon receipt of an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, MODIFY EPS BEARER CONTEXT REQUEST, DEACTIVATE EPS BEARER CONTEXT REQUEST, DOWNLINK NAS TRANSPORT or DOWNLINK GENERIC NAS TRANSPORT message, </condition> <condition> if the UE is using control plane CIoT EPS optimization, </condition> <action> the UE shall stop timer T3440 </action> and <action> may send uplink signalling via the existing NAS signalling connection. </action> </control> </control>
<control> <condition> In case c, </condition> <control> a) <condition> <condition> upon receiving a request from upper layers to send NAS signalling </condition> <condition> not associated with establishing a PDN connection for emergency bearer services, </condition> </condition> <action> the UE shall wait for the the local release of the established NAS signalling connection </action> <condition> <condition> upon expiry of timer T3440 </condition> or <condition> T3440 being stopped before proceeding; </condition> </condition> </control> or <control> b) <condition> upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, </condition> <action> the UE shall stop timer T3440 </action> and <action> shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.6.1. </action> </control> </control>
<control> <condition> In cases d and e, </condition> <control> a) <condition> upon an indication from the lower layers that the RRC connection has been released, </condition> <action> the UE shall stop timer T3440 </action> and <action> perform a new attach procedure as specified in subclause 5.5.3.2.5, 5.5.3.3.5 or 5.6.1.5; </action> </control> or <control> a) <condition> upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, </condition> <action> the UE shall stop timer T3440 </action> and <action> shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.5.1. </action> </control> </control>
<control> <condition> In cases a and f, </condition> <control> a) <condition> upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, </condition> <action> the UE shall stop timer T3440 </action> and <action> shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.5.1. </action> </control> </control>
<control> <condition> In case g, </condition> <control> a) <condition> <condition> upon receiving a request from upper layers to send NAS signalling </condition> <condition> not associated with establishing either a CS emergency call or a PDN connection for emergency bearer services, </condition> </condition> <action> the UE shall wait for the the local release of the established NAS signalling connection </action> <condition> <condition> upon expiry of timer T3440 </condition> or <condition> T3440 being stopped before proceeding; </condition> </condition> </control> or <control> b) <condition> upon receiving a request from upper layers to establish either a CS emergency call or a PDN connection for emergency bearer services, </condition> <action> the UE shall stop timer T3440 </action> and <control> <action> shall locally release the NAS signalling connection, </action> <condition> before proceeding as specified in subclause 5.6.1. </condition> </control> </control> </control>
<control> <condition> In case h, </condition> <control> a) <condition> <condition> upon an indication from the lower layers that the user plane radio bearers are set up </condition> or <condition> <condition> upon receiving a request from upper layers to send NAS signalling </condition> <condition> not associated with ESM DATA TRANSPORT, </condition> </condition> </condition> <action> the UE shall stop timer T3440; </action> </control> or <control> b) <action> the UE shall not send ESM DATA TRANSPORT message </action> <condition> <condition> until expiry of timer T3440 </condition> or <condition> times T3440 being stopped. </condition> </condition> </control> </control>
<control> <condition> <condition> In EMM-CONNECTED mode, </condition> <condition> if the UE moves to EMM-SERVICE-REQUEST-INITIATED state </condition> <condition> upon receipt of a CS SERVICE NOTIFICATION message, </condition> </condition> <action> the UE shall stop timer T3440. </action> </control>
<control> <condition> <condition> In S101 mode, </condition> <condition> when the cdma2000 HRPD radio access connection has been released, </condition> </condition> <action> the UE shall enter EMM-IDLE mode and consider the S101 mode NAS signalling connection released. </action> </control>
5.3.1.2.2 UE is using EPS services with control plane CIoT EPS optimization
<control> <condition> Upon receipt of the indication from the ESM layer to release the NAS signalling connection (see subclause 6.6.4.2), </condition> <condition> unless the MME has additional downlink user data or signalling pending, </condition> <action> the MME shall initiate release of the NAS signalling connection. </action> </control>
5.3.1.3 Suspend and resume of the NAS signalling connection
<control> Suspend of the NAS signalling connection can be initiated by the network in EMM-CONNECTED mode <condition> when user plane CIoT EPS optimization is used. </condition> Resume of the suspended NAS signalling connection is initiated by the UE. </control>
<control> <condition> In the UE, when user plane CIoT EPS optimization is used: </condition> <control> a) <condition> Upon indication from the lower layers that the RRC connection has been suspended, </condition> <action> the UE shall enter EMM- IDLE mode with suspend indication, </action> <action> shall not consider the NAS signalling connection released </action> and <action> shall not consider the secure exchange of NAS messages terminated (see subclause 4.4.2.3 and 4.4.5). </action> <action> Based on further indications provided by the lower layers, the UE shall update the status of the suspend indication for the EMM- IDLE mode; </action> </control> <control> b) <condition> <condition> Upon trigger of a procedure using an initial NAS message </condition> <condition> when in EMM-IDLE mode with suspend indication, </condition> </condition> the UE shall: <control> i) <condition> <condition> if the initial NAS message is a TRACKING AREA UPDATE REQUEST message </condition> <condition> which includes a UE radio capability information update needed IE, </condition> </condition> <action> enter EMM-IDLE mode without suspend indication </action> and <action> proceed with the tracking area updating procedure; </action> </control> and <control> ii) <condition> otherwise, </condition> <action> request the lower layer to resume the RRC connection. In this request to the lower layer the NAS shall provide to the lower layer the RRC establishment cause and the call type according to annex D of this document; </action> </control> NOTE 1: In NB-S1 mode, in the request to the lower layer the data volume information of the initial NAS message is provided to the lower layers. Interactions between the NAS and the lower layers in order to obtain the data volume information of the initial NAS message (see 3GPP TS 36.321 , 3GPP TS 36.331 ) is left to implementations. </control> <control> c) <condition> <condition> Upon indication from the lower layers that the RRC connection has been resumed </condition> <condition> when in EMM-IDLE mode with suspend indication, </condition> </condition> <action> the UE shall enter EMM-CONNECTED mode. </action> <control> <condition> <condition> <condition> If the pending NAS message is: i) a SERVICE REQUEST message; ii) a CONTROL PLANE SERVICE REQUEST message, </condition> and <condition> the UE did not include any ESM message container, NAS message container or EPS bearer context status information elements; </condition> </condition> or <condition> iii) <condition> an EXTENDED SERVICE REQUEST message, </condition> and <condition> the Service type information element indicates "packet services via S1" </condition> and <condition> the UE did not include any EPS bearer context status information element, </condition> </condition> </condition> <action> the message shall not be sent. </action> </control> <control> <condition> Otherwise </condition> <action> the UE shall cipher the message as specified in subclause 4.4.5 </action> and <action> send the pending initial NAS message upon entering EMM-CONNECTED mode; </action> </control> NOTE 2: If a NAS message is discarded and not sent to the network, the uplink NAS COUNT value corresponding to that message is reused for the next uplink NAS message to be sent. </control> <control> d) <condition> <condition> Upon fallback indication from the lower layers at RRC connection resume </condition> <condition> when in EMM-IDLE mode with suspend indication, </condition> </condition> <action> the UE shall enter EMM-IDLE mode without suspend indication, </action> <action> send any pending initial NAS message </action> and <action> proceed as if RRC connection establishment had been requested; </action> </control> <control> e) <condition> <condition> Upon indication from the lower layers that the RRC connection resume has failed </condition> and <condition> indication from the lower layers that the RRC connection is suspended, </condition> </condition> <action> the UE shall enter EMM-IDLE mode with suspend indication </action> and <action> restart the ongoing NAS procedure if required; </action> </control> and <control> f) <condition> <condition> Upon indication from the lower layers that the RRC connection resume has failed </condition> and <condition> indication from the lower layers that the RRC connection is not suspended, </condition> </condition> <action> the UE shall enter EMM-IDLE mode without suspend indication </action> and <action> restart the ongoing NAS procedure if required. </action> </control> </control>
<control> <condition> In the network, when user plane CIoT EPS optimization is used: </condition> <control> a) <condition> Upon indication from the lower layers that the RRC connection has been suspended, </condition> <action> the network shall enter EMM-IDLE mode with suspend indication, </action> <action> shall not consider the NAS signalling connection released </action> and <action> shall not consider the secure exchange of NAS messages terminated; </action> </control> and <control> b) <condition> <condition> Upon indication from the lower layers that the RRC connection has been resumed </condition> <condition> when in EMM-IDLE mode with suspend indication, </condition> </condition> <action> the network shall enter EMM-CONNECTED mode. </action> </control> </control>
For the case that not all suspended bearers are resumed, see subclause 6.4.4.6.
5.3.2 Lists of forbidden tracking areas
<control> <action> The UE shall store a list of "forbidden tracking areas for roaming", as well as a list of "forbidden tracking areas for regional provision of service". </action> </control> <control> <action> These lists shall be erased </action> <condition> <condition> when the UE is switched off </condition> or <condition> <condition> when the UICC containing the USIM is removed, </condition> and <condition> periodically (with a period in the range 12 to 24 hours). </condition> </condition> </condition> </control> <control> <condition> When the lists are erased, </condition> <action> the UE performs cell selection according to 3GPP TS 36.304 . </action> </control> <control> <action> One or more tracking areas is removed from the list of "forbidden tracking areas for roaming" in the UE, as well as the list of "forbidden tracking areas for regional provision of service" </action> <condition> if, <condition> after a subsequent procedure e.g. attach procedure, tracking area updating procedure and GUTI reallocation procedure, </condition> <condition> one or more tracking areas in the lists is received from the network. </condition> </condition> <control> <condition> <condition> If the UE has only one PDN connection established </condition> <condition> which is for emergency bearer services, </condition> </condition> <action> the tracking areas shall not be removed from these lists </action> <condition> if one or more tracking areas in the lists are received from the network. </condition> </control> </control>
<control> <condition> In S1 mode, </condition> <action> the UE shall update the suitable list </action> <condition> <condition> whenever an ATTACH REJECT, TRACKING AREA UPDATE REJECT, SERVICE REJECT or DETACH REQUEST message is received </condition> <condition> with the EMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking area". </condition> </condition> </control>
<control> <action> Each list shall accommodate 40 or more TAIs. </action> </control> <control> <condition> <condition> When the list is full </condition> and <condition> a new entry has to be inserted, </condition> </condition> <action> the oldest entry shall be deleted. </action> </control>
5.3.3 List of forbidden PLMNs for attach in S101 mode
<control> <condition> A UE supporting S101 mode </condition> <action> shall store a list of "forbidden PLMNs for attach in S101 mode". </action> </control> <control> <action> The UE shall erase this list </action> <condition> <condition> when the UE is switched off </condition> or <condition> when the USIM is removed. </condition> </condition> </control>
<control> <condition> In S101 mode, </condition> <action> the UE shall add to the "forbidden PLMNs for attach in S101 mode" list the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover </action> <condition> <condition> whenever an ATTACH REJECT message is received </condition> <condition> with the EMM cause #11 "PLMN not allowed", #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", #14 "EPS services not allowed in this PLMN", #15 "no suitable cells in tracking area", or #35 "Requested service option not authorized in this PLMN" </condition> as specified in subclause 5.5.1.2.5. </condition> </control>
The maximum number of possible entries in the "forbidden PLMNs for attach in S101 mode" list is implementation dependent, but the list shall accommodate at least one PLMN identity. <control> <condition> <condition> When the list is full </condition> and <condition> a new PLMN identity has to be inserted, </condition> </condition> <action> the UE shall delete the oldest PLMN identity. </action> </control>
5.3.3a Forbidden PLMNs for EPS services
The forbidden PLMNs for EPS services are contained in the "forbidden PLMNs for GPRS service" list, as defined in 3GPP TS 24.008 . The UE updates this list as part of the attach procedure, tracking area updating procedure and network initiated detach procedure as described respectively in subclauses 5.5.1, 5.5.3 and 5.5.2.3.2.
5.3.4 Equivalent PLMNs list
The UE shall store a list of equivalent PLMNs. These PLMNs shall be regarded by the UE as equivalent to each other for PLMN selection and cell selection/re-selection. The same list is used by EMM, GMM and MM.
<control> <action> The UE shall update or delete this list </action> <condition> at the end of each attach or combined attach or tracking area updating or combined tracking area updating procedure. </condition> </control> The stored list consists of a list of equivalent PLMNs as downloaded by the network plus the PLMN code of the registered PLMN that downloaded the list. <control> <condition> When the UE is switched off, </condition> <action> it shall keep the stored list </action> so that it can be used for PLMN selection after switch on. </control> <control> <action> The UE shall delete the stored list </action> <condition> <condition> if the USIM is removed </condition> or <condition> <condition> when the UE attached for emergency bearer services </condition> or <condition> access to RLOS enters the state EMM- DEREGISTERED. </condition> </condition> </condition> </control> The maximum number of possible entries in the stored list is 16.
5.3.5 Handling of the periodic tracking area update timer and mobile reachable timer (S1 mode only)
The periodic tracking area updating procedure is used to periodically notify the availability of the UE to the network.
<control> The procedure is controlled in the UE by timer T3412. The value of timer T3412 is sent by the network to the UE in the ATTACH ACCEPT message and can be sent in the TRACKING AREA UPDATE ACCEPT message. The UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE <condition> until a new value is received. </condition> </control>
<control> <condition> <condition> If <condition> timer T3412 received by the UE <condition> </condition> in an ATTACH ACCEPT </condition> </condition> or <condition> TRACKING AREA UPDATE ACCEPT message contains an indication that the timer is deactivated or the timer value is zero, </condition> </condition> <action> then timer T3412 is deactivated </action> and <action> the UE shall not perform the periodic tracking area updating procedure. </action> </control>
<control> <action> Timer T3412 is reset and started with its initial value, </action> <condition> when the UE changes from EMM-CONNECTED to EMM-IDLE mode. </condition> </control> <control> <action> Timer T3412 is stopped </action> <condition> when the UE enters EMM-CONNECTED mode or the EMM-DEREGISTERED state. </condition> </control>
<control> <condition> <condition> If the UE is attached for emergency bearer services, </condition> and <condition> timer T3412 expires, </condition> </condition> <action> the UE shall not initiate a periodic tracking area updating procedure, </action> but <action> shall locally detach from the network. </action> <control> <condition> When the UE is camping on a suitable cell, </condition> <action> it may re-attach to regain normal service. </action> </control> </control>
<control> <condition> <condition> When a UE is not attached for emergency bearer services, </condition> and <condition> timer T3412 expires, </condition> </condition> <action> the periodic tracking area updating procedure shall be started </action> and <action> the timer shall be set to its initial value for the next start. </action> </control>
<control> <condition> <condition> If the UE is not attached for emergency bearer services, </condition> and <condition> <condition> is in a state other than EMM-REGISTERED.NORMAL-SERVICE <condition> </condition> when timer T3412 expires, </condition> </condition> </condition> <action> the periodic tracking area updating procedure is delayed </action> <condition> until the UE returns to EMM-REGISTERED.NORMAL-SERVICE. </condition> </control>
NOTE 1: <control> <condition> <condition> When the UE returns to EMM-REGISTERED.NORMAL-SERVICE </condition> and <condition> it needs to initiate other EMM procedure than the periodic TAU procedure then, </condition> </condition> based on UE implementation, the EMM procedure can take precedence. </control>
<control> <action> The UE shall initiate the tracking area updating procedure </action> and <action> stop timer T3423 </action> <condition> <condition> when it enters state EMM- REGISTERED.NORMAL-SERVICE <condition> </condition> before timer T3423 expires. </condition> </condition> </control> <control> <condition> After expiry of timer T3423 </condition> <action> the UE shall set its TIN to "P-TMSI". </action> </control>
<control> <condition> If timer T3423 expires </condition> <action> the UE shall memorize that it has to initiate a tracking area updating procedure </action> <condition> when it returns to state EMM-REGISTERED.NORMAL-SERVICE. </condition> </control>
<control> <condition> If the UE is attached to both EPS and non-EPS services, </condition> and <condition> <condition> if timer T3412 expires </condition> or <condition> timer T3423 expires </condition> </condition> <start_state> when the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE state, </start_state> <action> then the UE shall initiate the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" </action> <condition> when the UE returns to EMM- REGISTERED.NORMAL-SERVICE state. </condition> </control>
<control> <condition> When the network includes T3412 extended value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message, </condition> <action> the network uses timer T3412 extended value IE as the value of timer T3412. </action> </control>
The network supervises the periodic tracking area updating procedure of the UE by means of the mobile reachable timer.
<control> <condition> If the UE is not attached for emergency bearer services, </condition> <action> the mobile reachable timer shall be longer than T3412. </action> <action> In this case, by default, the mobile reachable timer is 4 minutes greater than timer T3412. </action> </control>
<control> <condition> If ISR is not activated, </condition> the network behaviour upon expiry of the mobile reachable timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions. </control>
<control> <condition> If the UE is attached for emergency bearer services, </condition> <action> the MME shall set the mobile reachable timer with a value equal to timer T3412. </action> </control> <control> <condition> When the mobile reachable timer expires, </condition> <action> the MME shall locally detach the UE. </action> </control>
<control> <action> The mobile reachable timer shall be reset and started with the value as indicated above, </action> <condition> when the MME releases the NAS signalling connection for the UE. </condition> </control> <control> <action> The mobile reachable timer shall be stopped </action> <condition> when a NAS signalling connection is established for the UE. </condition> </control>
<control> <condition> Upon expiry of the mobile reachable timer </condition> <action> the network shall start the implicit detach timer. </action> </control> The value of the implicit detach timer is network dependent. <control> <condition> If ISR is activated, </condition> <action> the default value of the implicit detach timer is 4 minutes greater than timer T3423. </action> </control> <control> <condition> If the implicit detach timer expires before the UE contacts the network, </condition> <action> the network shall implicitly detach the UE. </action> </control> <control> <condition> <condition> If the MME includes timer T3346 in the TRACKING AREA UPDATE REJECT message or the SERVICE REJECT message </condition> and <condition> timer T3346 is greater than timer T3412, </condition> </condition> <action> the MME sets the mobile reachable timer and the implicit detach timer such that the sum of the timer values is greater than timer T3346. </action> </control>
<control> <condition> If the network includes the T3324 value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message, </condition> and <condition> <condition> if the UE is not attached for emergency bearer services </condition> and <condition> has no PDN connection for emergency bearer services </condition> </condition> <action> the MME shall set the active timer to a value equal to the value of timer T3324. </action> </control>
NOTE 2: Timer T3324 is specified in 3GPP TS 24.008 .
<control> <condition> <condition> If the UE has established a PDN connection for emergency services </condition> <condition> after receiving the timer T3324 value IE in the ATTACH ACCEPT message or the last TRACKING AREA UPDATE ACCEPT message, </condition> </condition> <action> the active timer shall not be started. </action> </control>
<control> <action> The active timer shall be reset </action> and <action> started with the value as indicated above, </action> <condition> when the MME releases the NAS signalling connection for the UE. </condition> </control> <control> <action> The active timer shall be stopped </action> <condition> when an NAS signalling connection is established for the UE. </condition> </control>
The network behaviour upon expiry of the active timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions.
NOTE 3: <control> <action> ISR is not activated </action> <condition> when the network includes the T3324 value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message. </condition> </control>
<control> <action> The implicit detach timer shall be stopped </action> <condition> when a NAS signalling connection is established for the UE. </condition> </control>
5.3.6 Handling of timer T3402
The value of timer T3402 can be sent by the network to the UE in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message. <control> <condition> If the value is different from "deactivated", </condition> <action> the UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE, </action> <condition> until a new value is received. </condition> </control>
The value of timer T3402 can be sent by the network to the UE in the ATTACH REJECT message. <control> <condition> If an ATTACH REJECT message <condition> including timer T3402 value different from "deactivated", </condition> was received integrity protected, </condition> <action> the UE shall apply this value </action> <condition> until <condition> a new value is received with integrity protection </condition> or <condition> a new PLMN is selected. </condition> </condition> </control> <control> <condition> Otherwise, </condition> <action> the default value of this timer is used. </action> </control>
<control> <action> The default value of this timer is also used by the UE in the following cases: </action> <condition> <condition> a) ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message is received without a value specified; </condition> <condition> b) the network indicates that the timer is "deactivated"; </condition> <condition> c) the UE does not have a stored value for this timer; </condition> <condition> d) <condition> a new PLMN which is not in the list of equivalent PLMNs has been entered, </condition> <condition> the tracking area updating fails </condition> and <condition> the tracking area updating attempt counter is equal to 5; </condition> </condition> or <condition> e) <condition> a new PLMN which is not in the list of equivalent PLMNs has been entered, </condition> <condition> the attach procedure fails, </condition> <condition> the attach attempt counter is equal to 5 </condition> ` <condition> no ATTACH REJECT message was received from the new PLMN. </condition> </condition> </condition> </control>
5.3.7 Handling of the Local Emergency Numbers List and the Extended
Local Emergency Numbers List
The Local Emergency Numbers List and the Extended Local Emergency Numbers list contain additional local emergency numbers used by the serving network. These lists can be downloaded by the network to the UE at successful registration and subsequent registration updates. There is only one Local Emergency Numbers List and only one Extended Local Emergency Numbers list in the UE. <control> <action> The Local Emergency Numbers List can be updated with EMM procedures </action> <condition> <condition> <condition> if the UE is in S1 mode, </condition> <condition> with GMM and MM procedures <condition> </condition> <condition> <condition> if the UE is in A/Gb or Iu mode, </condition> and <condition> with 5GMM procedures, </condition> as specified in 3GPP TS 24.501 , </condition> </condition> if UE is in N1 mode. </condition> </condition> </control> <control> <action> The Extended Local Emergency Numbers List can be updated with EMM procedures </action> <condition> <condition> <condition> if the UE is in S1 mode </condition> and <condition> with 5GMM procedures, </condition> </condition> as specified in 3GPP TS 24.501 , <condition> if UE is in N1 mode. </condition> </condition> </control>
The UE shall use the stored Local Emergency Numbers List and the stored Extended Local Emergency Numbers List received from the network in addition to the emergency numbers stored on the USIM or user equipment to detect that the number dialled is an emergency number.
<control> <condition> If the UE determines that the number dialled is an emergency number, </condition> <action> the procedures specified in 3GPP TS 23.167 and 3GPP TS 24.229 are utilised to select a domain for the emergency session attempt. </action> </control>
<control> <condition> If the domain selected for the emergency session attempt is the PS domain, </condition> <action> then the UE shall perform the session establishment procedures specified in 3GPP TS 24.229 to initiate an emergency session. </action> </control>
<control> <condition> If the domain selected for the emergency session attempt is the CS domain (e.g. the UE has selected GERAN or UTRAN radio access technology), </condition> <action> then the UE shall use the stored Local Emergency Numbers List, in addition to the emergency numbers stored on the USIM and the ME, to determine if: a) the UE is to send an EXTENDED SERVICE REQUEST message: 1) for CS fallback, indicating "mobile originating CS fallback or 1xCS fallback"; or 2) for CS fallback for emergency call, indicating "mobile originating CS fallback emergency call or 1xCS fallback emergency call"; and a) the call control entity of the UE specified in 3GPP TS 24.008 is to send an EMERGENCY SETUP message or a SETUP message to the network. </action> </control>
NOTE 1: The checking of whether the dialled number is an emergency number and the determination of whether an emergency call is to be initiated in the CS domain, can end once a match is found. The Extended Local Emergency Numbers List does not apply when the CS domain is selected.
NOTE 2: The user equipment can use the emergency numbers in each of the stored lists to assist the end user in determining whether the dialled number is intended for an emergency service or for another destination, e.g. a local directory service. The possible interactions with the end user are implementation specific.
NOTE 3: A UE that supports procedures specified in 3GPP TS 24.302 , can get additional local emergency numbers through those procedures, which can be used based on operator policy, see 3GPP TS 24.302 .
<control> <action> The network may send a Local Emergency Numbers List or an Extended Local Emergency Numbers List or both, in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT messages, by including the Emergency number list IE and the Extended emergency number list IE, respectively. </action> <action> The user equipment shall store the Local Emergency Numbers List and the Extended Local Emergency Numbers List, as provided by the network. </action> <action> The Local Emergency Numbers List stored in the user equipment shall be replaced on each receipt of the Emergency number list IE. </action> </control> <control> <action> The Extended Local Emergency Numbers List stored in the user equipment shall be replaced </action> <condition> on each receipt of the Extended emergency number list IE. </condition> <action> The received Local Emergency Numbers List or the received Extended Local Emergency Numbers list or both shall be provided to the upper layers. </action> </control>
<control> <action> The emergency number(s) received in the Emergency number list IE are valid </action> <condition> only in networks in the same country as the PLMN from which this IE is received. </condition> </control> <control> <condition> If no Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, </condition> <action> then the stored Local Emergency Numbers List in the user equipment shall be kept, </action> <condition> except if the user equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the list. </condition> </control>
<control> <action> The emergency number(s) received in the Extended emergency number list IE are valid only </action> <condition> in: <condition> a) <condition> networks in the same country as the PLMN from which this IE is received, </condition> <condition> if the Extended Emergency Number List Validity (EENLV) field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received"; </condition> </condition> and <condition> b) <condition> the PLMN from which this IE is received, </condition> <condition> if the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received". </condition> </condition> </condition> </control>
<control> <condition> <condition> If no Extended Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, </condition> and <condition> the registered PLMN has not changed, </condition> </condition> <action> then the stored Extended Local Emergency Numbers List in the user equipment shall be kept. </action> </control> <control> <condition> <condition> If no Extended Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, </condition> but <condition> the registered PLMN has changed, </condition> </condition> then: <control> a) <condition> if the last received indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received", </condition> <action> the stored Extended Local Emergency Numbers List in the user equipment shall be deleted; </action> </control> and <control> b) <condition> if the last received indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received" </condition> <action> the list shall be kept except </action> <condition> if the user equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the list. </condition> </control> </control>
NOTE: To prevent the misrouting of emergency calls, all operators within a country need to follow the regulation or agree on the setting of the Extended emergency number list IE in accordance to national agreement either to indicate validity within a country or to indicate validity only within the PLMN.
<control> <action> The Local Emergency Numbers List and the Extended Local Emergency Numbers List shall be deleted </action> <condition> <condition> at switch off </condition> and <condition> removal of the USIM. </condition> </condition> </control> The user equipment shall be able to store up to ten entries in the Local Emergency Numbers List and up to twenty entries in the Extended Local Emergency Numbers List, received from the network.
5.3.7a Specific requirements for UE configured to use timer T3245
<control> The following requirement applies for <condition> an UE that is configured to use timer T3245 </condition> (see 3GPP TS 24.368 or 3GPP TS 31.102 ): <control> <condition> <condition> <condition> When the UE adds a PLMN identity to the "forbidden PLMN list", the "forbidden PLMNs for attach in S101 mode" list, or the "forbidden PLMNs for GPRS service" list </condition> or <condition> sets the USIM as invalid for non-EPS services or EPS services or both, </condition> and <condition> timer T3245 (see 3GPP TS 24.008 ) is not running, </condition> </condition> </condition> <action> the UE shall start timer T3245 as specified in 3GPP TS 24.008 , subclause 4.1.1.6. </action> </control> </control>
<control> <condition> Upon expiry of the timer T3245, </condition> <action> the UE shall erase the "forbidden PLMN list", the "forbidden PLMNs for GPRS service" list, andthe "forbidden PLMNs for attach in S101 mode" list </action> and <action> set the USIM to valid for non-EPS and EPS services. </action> </control> <control> <condition> When the lists are erased, </condition> <action> the UE performs cell selection according to 3GPP TS 36.304 . </action> </control>
<control> <condition> <condition> If the UE is switched off </condition> <condition> when the timer T3245 is running, </condition> </condition> <control> the UE shall behave as follows: <condition> <condition> when the UE is switched on </condition> and <condition> the USIM in the UE remains the same: </condition> </condition> <action> a) let t1 be the time remaining for T3245 timeout at switch off and let t be the time elapsed between switch off and switch on. </action> <control> <condition> If t1 is greater than t, </condition> <action> then the timer shall be restarted with the value t1 t. </action> </control> <control> <condition> If t1 is equal to or less than t, </condition> <action> then the UE will follow the behaviour as defined in the paragraph above upon expiry of the timer T3245. </action> </control> <control> <condition> If the UE is not capable of determining t, </condition> <action> then the UE shall restart the timer with the value t1. </action> </control> </control> </control>
5.3.7b Specific requirements for UE when receiving non-integrity protected reject messages
<control> This subclause specifies the requirements <condition> <condition> for a UE that is not configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> and <condition> <condition> receives an ATTACH REJECT, TRACKING AREA UPDATE REJECT or SERVICE REJECT message </condition> <condition> without integrity protection with specific EMM causes. </condition> </condition> </condition> NOTE 1: Additional UE requirements for this case, requirements for other EMM causes, and requirements for the case when the UE receives an integrity protected reject message are specified in subclauses 5.5.1, 5.5.3 and 5.6.1. <action> The UE may maintain a list of PLMN-specific attempt counters and a list of PLMN-specific PS-attempt counters (see 3GPP TS 24.008 ). </action> The maximum number of possible entries in each list is implementation dependent. <action> Additionally, the UE may maintain one counter for "SIM/USIM considered invalid for non-GPRS services" events and one counter for "SIM/USIM considered invalid for GPRS services" events (see 3GPP TS 24.008 ). </action> </control>
<control> <condition> <condition> If the UE receives an ATTACH REJECT, TRACKING AREA UPDATE REJECT or SERVICE REJECT message <condition> </condition> without integrity protection </condition> <condition> with EMM cause value #3, #6, #7, #8, #11, #12, #13, #14, #15, #31 or #35 </condition> <condition> before the network has established secure exchange of NAS messages for the NAS signalling connection, </condition> </condition> <action> the UE shall start timer T3247 (see 3GPP TS 24.008 [13]) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, </action> <condition> if the timer is not running, </condition> and take the following actions: </control>
<control> <condition> 1) if the EMM cause value received is #3, #6, #7 or #8, and </condition> <control> a) <condition> <condition> if the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events </condition> and <condition> the counter has a value less than a UE implementation-specific maximum value, </condition> </condition> the UE shall: i) <action> set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according tosubclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI; </action> <action> delete the list of equivalent PLMNs; </action> <action> increment the counter for "SIM/USIM considered invalid for GPRS services" events; </action> <control> <condition> <condition> if the EMM cause value received is #3, #6 or #8, </condition> and <condition> if the UE maintains a counter for "SIM/USIMconsidered invalid for non-GPRS services" </condition> and <condition> the counter has a value less than a UE implementationspecific maximum value, </condition> </condition> <action> increment the counter; </action> </control> <control> <condition> if an attach or tracking area updating procedure was performed, </condition> <action> reset the attach attempt counter or the tracking area updating attempt counter, respectively; </action> </control> <control> <condition> if A/Gb mode or Iu mode is supported by the UE, </condition> <action> handle the GMM parameters GPRS attach attemptcounter or routing area updating attempt counter, GMM state, GPRS update status, P-TMSI, P-TMSIsignature, RAI, GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the casewhen the GPRS attach or routing area updating procedure is rejected with the GMM cause of the samevalue in a NAS message without integrity protection; </action> </control> <control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, TAI list, ngKSI as specified in 3GPP TS 24.501 for the case </action> <condition> <condition> when the registration request procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value in a NAS message without integrity protection. </condition> </condition> </control> <action> store the current TAI in the list of "forbidden tracking areas for roaming", memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message </action> and <end_state> enter the state EMM-DEREGISTERED.LIMITED-SERVICE; </end_state> and <action> search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 ; </action> or ii) <action> proceed as specified in subclauses 5.5.1, 5.5.3 and 5.6.1; </action> c) <action> increment the counter for "SIM/USIM considered invalid for GPRS services" events; </action> and <action> d) if the EMM cause value received is #3, #6 or #8, and if the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" and the counter has a value less than a UE implementation specific maximum value, increment the counter; </action> </control> and <control> b) <condition> else </condition> <action> the UE shall proceed as specified in subclauses 5.5.1, 5.5.3 and 5.6.1; </action> </control> </control>
<control> 2) <condition> if the EMM cause value received is #12, #13 or #15, </condition> <action> the UE shall additionally proceed as specified in subclauses 5.5.1, 5.5.3 and 5.6.1; </action> </control>
<control> 3) <condition> <condition> if the EMM cause value received is #11, #14 or #35 </condition> and <condition> the UE is in its HPLMN or EHPLMN, </condition> </condition> <action> a) the UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> The UE shall delete the list of equivalent PLMNs. </action> <control> Additionally, <condition> if an attach or tracking area updating procedure was performed, </condition> <action> the UE shall reset the attach attempt counter or the tracking area updating attempt counter, respectively. </action> </control> <control> b) <condition> if A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter or routing area updating attempt counter as specified in 3GPP TS 24.008 [13] </action> <condition> for the case <condition> when the procedure is rejected </condition> <condition> with the GMM cause with the same value in a NAS message without integrity protection; </condition> </condition> </control> <control> c) <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, TAI list, ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the registration request procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value in a NAS message without integrity protection. </condition> </condition> </control> <action> d) the UE shall store the current TAI in the list of "forbidden tracking areas for roaming", </action> <action> memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message </action> and <end_state> enter the state EMM-DEREGISTERED.LIMITED-SERVICE; </end_state> and <action> e) the UE shall search for a suitable cell in another tracking area or in another location area in the same PLMN according to 3GPP TS 36.304 ; </action> </control>
<control> 4) <condition> <condition> if the EMM cause value received is #11 or #35 </condition> and <condition> the UE is not in its HPLMN or EHPLMN, </condition> </condition> in addition to the UE requirements specified in subclause 5.5.1, 5.5.3 and 5.6.1, <condition> <condition> if the UE maintains a list of PLMN-specific attempt counters </condition> and <condition> the PLMN-specific attempt counter for the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, </condition> </condition> <action> the UE shall increment the PLMN-specific attempt counter for the PLMN; </action> </control> and
<control> 5) <condition> <condition> if the EMM cause value received is #14 </condition> and <condition> the UE is not roaming in its HPLMN or EHPLMN, </condition> </condition> in addition to the UE requirements specified in subclause5.5.1, 5.5.3 and 5.6.1, <condition> <condition> if the UE maintains a list of PLMN-specific PS-attempt counter </condition> and <condition> the PLMN-specific PS-attempt counter of the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, </condition> </condition> <action> the UE shall increment the PS-attempt counter of the PLMN. </action> </control>
<control> 6) <condition> <condition> if the EMM cause value received is #31 </condition> <condition> for a UE that has indicated support for CIoT optimizations, </condition> </condition> <action> the UE may discard the message </action> or alternatively the UE should: <action> a) set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3); </action> b) <action> store the current TAI in the list of "forbidden tracking areas for roaming", </action> <action> memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message; </action> and <action> c) search for a suitable cell in another tracking area according to 3GPP TS 36.304 . </action> </control>
<control> <condition> Upon expiry of timer T3247, </condition> the UE shall <action> a) remove all tracking areas from the list of "forbidden tracking areas for regional provision of service" and the list of "forbidden tracking areas for roaming", </action> <condition> which were stored in these lists for non-integrity protected NAS reject message; </condition> <control> b) <action> set the USIM to valid for EPS services, </action> <condition> <condition> if the UE does not maintain a counter for "SIM/USIM considered invalid for GPRS services" events; </condition> or <condition> <condition> the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events </condition> and <condition> this counter has a value less than a UE implementation-specific maximum value; </condition> </condition> </condition> </control> <control> c) <action> set the USIM to valid for non-EPS services, </action> <condition> <condition> if the UE does not maintain a counter for "SIM/USIM considered invalid for non-GPRS services" events; </condition> or <condition> <condition> the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events </condition> and <condition> this counter has a value less than a UE implementation-specific maximum value; </condition> </condition> </condition> </control> <control> d) <condition> if the UE maintains a list of PLMN-specific attempt counters, </condition> <condition> for each PLMN-specific attempt counter that has a value greater than zero and less than a UE implementation-specific maximum value, </condition> <action> remove the respective PLMN from the forbidden PLMN list; </action> </control> <control> e) <condition> if the UE maintains a list of PLMN-specific PS-attempt counters, </condition> <condition> for each PLMN-specific PS-attempt counter that has a value greater than zero and less than a UE implementation-specifc maximum value, </condition> <action> remove the respective PLMN from the "forbidden PLMNs for GPRS service" list. </action> </control> <control> <action> If the resulting "forbidden PLMNs for GPRS service" list is empty, </action> <condition> the UE shall re-enable the E-UTRA capability (see subclause 4.5); </condition> </control> <control> f) <condition> if the UE is supporting A/Gb mode or Iu mode, </condition> <action> handle the list of "forbidden location areas for regional provision of service" and the list of "forbidden location areas for roaming" as specified in 3GPP TS 24.008 for the case when timer T3247 expires; </action> </control> <control> g) <condition> <condition> if the UE is supporting A/Gb mode or Iu mode </condition> and <condition> maintains a list of "forbidden location areas for non-GPRS services" and a list of "forbidden location areas for GPRS services", </condition> </condition> <action> handle these lists as specified in 3GPP TS 24.008 for the case </action> <condition> when timer T3247 expires; </condition> </control> and <control> h) <action> initiate an EPS attach procedure or tracking area updating procedure, <condition> if still needed, </condition> dependent on EMM state and EPS update status, </action> or <action> perform PLMN selection according to 3GPP TS 23.122 . </action> </control> </control>
<control> <condition> If the UE maintains a list of PLMN-specific attempt counters and PLMN-specific PS-attempt counters, </condition> <condition> when the UE is switched off, </condition> the UE shall, <condition> for each PLMN-specific attempt counter that has a value greater than zero and less than the UE implementation-specific maximum value, </condition> <action> remove the respective PLMN from the forbidden PLMN list. </action> <condition> When the USIM is removed, </condition> <action> the UE should perform this action. </action> </control>
<control> <action> The PLMN-specific attempt counter and the PLMN-specific PS-attempt counter shall be reset </action> <condition> <condition> when the UICC containing the USIM is removed </condition> or <condition> the PLMN is added to a list of "forbidden PLMNs" in the USIM as specified in 3GPP TS 23.122 . </condition> </condition> </control>
NOTE 2: <control> <condition> If the respective PLMN was stored in the extension of the "forbidden PLMNs" list, </condition> <action> then according to 3GPP TS 23.122 the UE will delete the contents of this extension when the USIM is removed. </action> </control>
5.3.8 Abnormal cases in the UE
The following abnormal case can be identified: a) EMM uplink message transmission failure indication by lower layers
<control> <condition> When it is specified in the relevant procedure that it is up to the UE implementation to rerun the ongoing procedure that triggered that procedure, </condition> <action> the procedure can typically be re-initiated using a retransmission mechanism of the uplink message (the one that has previously failed to be transmitted) with new sequence number and message authentication code information thus avoiding to restart the whole procedure. </action> </control>
5.3.9 Handling of NAS level mobility management congestion control
<control> <condition> The network may detect EMM signalling congestion </condition> and <action> perform NAS level mobility management congestion control. </action> </control> NAS level mobility management congestion control consists of general NAS level mobility management congestion control and subscribed APN based congestion control.
<control> <condition> Under general overload conditions </condition> <action> the network may reject mobility management signalling requests from UEs as specified in 3GPP TS 23.401 . </action> <action> The network should not reject the following requests: a) requests for emergency bearer services; b) DETACH REQUEST message; c) service request or tracking area update request triggered by paging ; d) requests from UEs that were received via NAS signalling connections established with RRC establishment cause "High priority access AC 11 15"; and e) requests for CS fallback emergency call or 1xCS fallback emergency call. </action> </control>
<control> <condition> When subscribed APN based mobility management congestion control is active for a particular APN, </condition> <action> the network may reject attach requests from UEs </action> <condition> with a subscription to this APN. </condition> </control>
<control> In mobility management <action> the network may detect NAS signalling congestion </action> and <action> start or stop performing the subscribed APN based congestion control </action> <condition> based on mobility management level criteria such as: <condition> a) rate of mobility management NAS messages from a group of UEs with a subscription to a particular APN exceeds or falls below certain thresholds; </condition> and/or <condition> b) setting in network management. </condition> </condition> </control>
<control> <condition> When the NAS level mobility management congestion control is active, </condition> <action> the network may include a value for the mobility management back-off timer T3346 in the reject messages. </action> <action> The UE starts the timer T3346 with the value received in the mobility management reject messages. </action> <control> <condition> To avoid that large numbers of UEs simultaneously initiate deferred requests, </condition> <action> the network should select the value for the timer T3346 for the rejected UEs so that timeouts are not synchronised. </action> </control> </control>
For subscribed APN based congestion control the value of timer T3346 for a particular APN may be APN dependent.
<control> <condition> <condition> If the timer T3346 is running </condition> <condition> when the UE enters state EMM-DEREGISTERED, </condition> </condition> <action> the UE remains switched on, </action> and <action> the USIM in the UE remains the same, </action> <control> <action> then timer T3346 is kept running </action> <condition> until it expires or it is stopped. </condition> </control> </control>
<control> <condition> <condition> If the UE is switched off <condition> </condition> when the timer T3346 is running, </condition> </condition> the UE shall behave as follows <condition> <condition> when the UE is switched on </condition> and <condition> the USIM in the UE remains the same: </condition> </condition> <control> a) let t1 be the time remaining for T3346 timeout at switch off and let t be the time elapsed between switch off and switch on. <control> <condition> If t1 is greater than t, </condition> <action> then the timer shall be restarted with the value t1 t. </action> </control> <control> <condition> If t1 is equal to or less than t, </condition> <action> then the timer need not be restarted . </action> </control> <control> <condition> If the UE is not capable of determining t, </condition> <action> then the UE shall restart the timer with the value t1; </action> </control> </control> and <control> b) <condition> <condition> if prior to switch off, </condition> <condition> timer T3346 was started </condition> <condition> due to a NAS request message (ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST) </condition> <condition> which contained the low priority indicator set to "MS is configured for NAS signalling low priority", </condition> <condition> then if timer T3346 is restarted at switch on, </condition> <condition> <condition> the UE configured for dual priority </condition> </condition> </condition> <action> shall handle mobility management requests as indicated in subclauses 5.5.1.2.6, 5.5.3.2.6 and 5.6.1.6. </action> </control> </control>
<control> <condition> <condition> <condition> If the UE enters a new PLMN </condition> <condition> while timer T3346 is running, </condition> </condition> and <condition> <condition> the new PLMN is not equivalent to the PLMN <condition> </condition> where the UE started timer T3346, </condition> </condition> </condition> <action> the UE shall stop timer T3346 when initiating mobility management procedures in the new PLMN. </action> </control>
<control> <condition> After change in TAI which is not part of TAI list, </condition> <condition> <condition> if the timer T3346 is running </condition> and <condition> EMM update status is EU1 UPDATED </condition> </condition> <action> then UE shall set the EMM update status to EU2 NOT UPDATED </action> and <end_state> enter state EMM- REGISTERED.ATTEMPTING-TO-UPDATE. </end_state> </control>
5.3.9A Handling of congestion control for transport of user data via the control plane
<control> <action> The network may activate congestion control for transport of user data via the control plane, </action> <condition> as specified in 3GPP TS 23.401 . </condition> </control>
<control> <condition> <condition> If the congestion control for transport of user data via the control plane is active </condition> and <condition> if the UE has indicated support for the control plane data back-off timer, </condition> </condition> <action> the network shall include a value for the control plane data back-off timer T3448 in ATTACH ACCEPT, TRACKING AREA UPDATE ACCEPT, SERVICE ACCEPT or SERVICE REJECT message, </action> and <action> shall store an control plane data back-off time on a per UE basis. </action> <action> The UE starts the timer T3448 with the value informed in the message. </action> <control> <condition> To avoid that large numbers of UEs simultaneously initiate deferred requests, </condition> <action> the network should select the value for the timer T3448 for the informed UEs so that timeouts are not synchronised. </action> </control> </control>
<control> <action> The network sends TRACKING AREA UPDATE ACCEPT message or SERVICE ACCEPT message without T3448 value IE </action> <condition> to stop the timer T3448 running in the UE </condition> <condition> as specified in subclause 5.5.3.2.4 and subclause 5.6.1.4.2. </condition> </control>
<control> <condition> Based on the stored control plane data back-off time for the UE, </condition> <action> the network may reject the transfer of user data via the control plane initiated by the UE. </action> </control>
<control> <condition> <condition> While the timer T3448 is running, </condition> <condition> the UE in EMM-IDLE mode </condition> </condition> <action> shall not initiate the transport of user data via the control plane procedure (see subclause 6.6.4), </action> <condition> <condition> except if the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 </condition> or <condition> the USIM file EF in 3GPP TS 31.102 ) and the user data is related to an exceptional event. </condition> </condition> </control>
<control> <condition> <condition> Upon entering the state EMM-DEREGISTERED </condition> or <condition> a new PLMN which is not equivalent to the PLMN where the UE started the timer T3448, </condition> or <condition> <condition> upon being switched off </condition> <condition> while the timer T3448 is running, </condition> </condition> </condition> <action> the UE shall stop the timer T3448. </action> For further criteria to stop of timer T3448, refer to subclause 5.5.3.2.4 and subclause 5.6.1.4.2. </control>
5.3.10 Access class control
The network can restrict the access for certain groups of UEs by means of barring their access class.
<control> <action> The UE shall evaluate the access control information as specified in 3GPP TS 36.331 for: a) Access Class Barring; b) Access Control for CSFB and Extended Access Barring (EAB); c) Access Control for Application specific Congestion control for Data Communication (ACDC), if the UE supports ACDC; and d) Access Barring. </action> </control>
5.3.11 Power saving mode
<control> <action> The UE can request the use of power saving mode (PSM) during an attach or tracking area updating procedure (see 3GPP TS 23.682 and 3GPP TS 23.401 ). </action> </control> <control> <action> The UE shall not request the use of PSM </action> <condition> during: a) an attach for emergency bearer services procedure; b) an attach procedure for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach"; c) a tracking area updating procedure for initiating a PDN connection for emergency bearer services; d) a tracking area updating procedure when the UE has a PDN connection established for emergency bearer services; or e) an attach for access to RLOS. </condition> </control>
<control> <action> The network accepts the use of PSM by providing a specific value for timer T3324 </action> <condition> when accepting the attach or tracking area updating procedure. </condition> </control> <control> <action> The UE may use PSM only </action> <condition> if the network has provided the T3324 value IE during the last attach or tracking area updating procedure with a value different from "deactivated". </condition> </control>
NOTE: Timer T3324 is specified in 3GPP TS 24.008 .
<control> <condition> Upon expiry of the timer T3324 </condition> or <condition> if the T3324 value provided by the network is zero, </condition> <action> the UE may deactivate the AS layer </action> and <action> activate PSM </action> <end_state> by entering the state EMM-REGISTERED.NO-CELL-AVAILABLE </end_state> <condition> if: <condition> a) the UE is not attached for emergency bearer services; </condition> <condition> b) the UE has no PDN connection for emergency bearer services; </condition> <condition> c) the UE is in EMM-IDLE mode; </condition> <condition> d) in the EMM-REGISTERED.NORMAL-SERVICE state; </condition> and <condition> e) the UE is not attached for access to RLOS. </condition> </condition> </control>
<control> <condition> If conditions a, b, c and e are fulfilled, </condition> <start_state> but the UE is in a state other than EMM-REGISTERED.NORMAL-SERVICE </start_state> <condition> when timer T3324 expires </condition> , <action> the UE may activate PSM </action> <end_state> when the MS returns to state EMM-REGISTERED.NORMAL-SERVICE. </end_state> </control>
<control> <condition> A UE that has already been allocated timer T3324 with a value different from "deactivated" </condition> and <condition> the timer T3324 has expired, </condition> <action> may activate PSM </action> <condition> if it receives an "Extended wait time" from lower layers. </condition> </control>
<control> <condition> When PSM is activated </condition> <action> all NAS timers are stopped </action> and <action> associated procedures aborted </action> <condition> except for T3412, T3346, T3396, T3447, any backoff timers, and the timer T controlling the periodic search for HPLMN or EHPLMN or higher prioritized PLMNs (see 3GPP TS 23.122 ). </condition> </control>
<control> <condition> <condition> If the UE is attached for emergency bearer services </condition> or <condition> has a PDN connection for emergency bearer services, </condition> </condition> <action> the UE shall not activate PSM. </action> </control>
<control> <condition> If the UE is attached for access to RLOS, </condition> <action> the UE shall not activate PSM. </action> </control>
<control> <action> The UE may deactivate PSM and activate the AS layer at any time. </action> </control> <control> <condition> Upon deactivating PSM, </condition> <action> the UE may initiate EMM procedures (e.g. for the transfer of mobile originated signalling or user data). </action> </control>
5.3.12 Extended idle-mode DRX cycle
<control> <action> The UE may request the use of extended idle-mode DRX cycle (eDRX) </action> <condition> during an attach or tracking area updating procedure </condition> <action> by including the extended DRX parameters IE (see 3GPP TS 23.682 and 3GPP TS 23.401 ). </action> </control> <control> <action> The UE shall not request the use of eDRX </action> <condition> during: a) an attach for emergency bearer services procedure; b) a tracking area updating procedure for the UE attached for emergency bearer services; or c) an attach for access to RLOS. </condition> </control>
<control> <action> The UE and the network may negotiate eDRX parameters </action> <condition> during a tracking area updating procedure </condition> <condition> when the UE has a PDN connection for emergency bearer services. </condition> </control>
<control> <action> The network accepts the request to use the eDRX by providing the extended DRX parameters IE </action> <condition> when accepting the attach or the tracking area updating procedure. </condition> </control> <control> <action> The UE shall use eDRX only </action> <condition> <condition> if it received the extended DRX parameters IE during the last attach or tracking area updating procedure </condition> and <condition> the UE does not have a PDN connection for emergency bearer services. </condition> </condition> </control>
NOTE: <control> <condition> If the UE wants to keep using eDRX, </condition> <action> the UE includes the extended DRX parameters IE in each attach or tracking area updating procedure. </action> </control>
<control> <condition> If the UE received the extended DRX parameters IE during the last attach or tracking area updating procedure, </condition> <condition> upon successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, </condition> <action> the UE shall resume eDRX. </action> </control>
<control> <condition> If the network has provided the extended DRX parameters IE during the last attach or tracking area updating procedure, </condition> <condition> upon successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, </condition> <action> the network shall resume eDRX. </action> </control>
<control> <condition> If the UE or the network locally releases the PDN connection for emergency bearer service, </condition> <action> the UE or the network shall not use eDRX until the UE receives eDRX parameters </action> <condition> <condition> during a tracking area updating procedure with EPS bearer context synchronization </condition> or <condition> upon successful completion of a service request procedure. </condition> </condition> </control>
<control> <condition> <condition> If the UE did not receive the extended eDRX parameters IE, </condition> or <condition> if the UE has a PDN connection for emergency bearer services, </condition> </condition> <action> the UE shall use the stored UE specific DRX parameter, </action> <condition> if available. </condition> </control>
<control> <condition> <condition> If the network did not accept the request to use eDRX, </condition> or <condition> if the UE has a PDN connection for emergency bearer services, </condition> </condition> <action> the network shall use the stored UE specific DRX parameter, </action> <condition> if available. </condition> </control>
<control> <condition> <condition> <condition> If the network provided the extended DRX parameters IE </condition> <condition> which was different from the one requested by the UE </condition> </condition> and <condition> <condition> also assigned a new GUTI for the UE <condition> as described in subclause 5.5.3.2.4 <condition> during the last tracking area updating procedure, </condition> </condition> </condition> </condition> </condition> <action> the network shall use the stored UE specific DRX parameter, <condition> if available </condition> , with the old GUTI </action> and <action> use the eDRX provided by the network with the new GUTI until the old GUTI can be considered as invalid by the network (see subclause 5.4.1.4). </action> </control>
5.3.13 Interaction between power saving mode and extended idle mode DRX cycle
<control> <action> The UE can request the use of both PSM and eDRX </action> <condition> during an attach or tracking area updating procedure </condition> but it is up to the network to decide to enable none, one of them or both (see 3GPP TS 23.682 and 3GPP TS 23.401 ). </control>
<control> <condition> If the network accepts the use of both PSM (see subclause 5.3.11) and eDRX (see subclause 5.3.12), </condition> <action> the extended DRX parameters IE provided to the UE should allow for multiple paging occasions </action> <condition> before the active timer expires. </condition> </control>
5.3.14 Dedicated core network
<control> <action> The network may reject mobility management signalling requests from UEs </action> <condition> due to dedicated core network as specified in 3GPP TS 23.401 . </condition> </control> <control> <condition> <condition> When the network rejects mobility management signalling requests </condition> <condition> due to dedicated core network, </condition> </condition> <action> the mechanism for general NAS level mobility management congestion control as specified in subclause 5.3.9 shall be followed. </action> </control>
5.3.15 CIoT EPS optimizations
CIoT EPS optimizations provide improved support of small data and SMS transfer. <control> <condition> A UE supporting CIoT EPS optimizations </condition> <action> can indicate the CIoT network behaviour the UE can support and prefers to use during attach or tracking area updating procedure (see 3GPP TS 23.401 ). </action> <action> The UE may indicate the support for control plane CIoT EPS optimization, user plane CIoT EPS optimization, EMM-REGISTERED without PDN connection, S1-U data transfer and header compression (see subclause 9.9.3.34). </action> <action> The UE may also request to use SMS transfer without combined attach procedure during the attach procedure. </action> <action> Furthermore, the UE may, separately from the indication of support, indicate preference for control plane CIoT EPS optimization or user plane CIoT EPS optimization (see subclause 9.9.3.0B). </action> The indication of preference is also considered as the request to use. <control> <condition> A UE supporting CIoT 5GS optimizations </condition> <action> can also indicate the 5GS CIoT network behaviour the UE can support <condition> during attach or tracking area updating procedure. </condition> </action> <action> Furthermore, the UE may, separately from the indication of support, indicate preference for control plane CIoT 5GS optimization or user plane CIoT 5GS optimization. </action> </control> </control>
NOTE 1: <control> <condition> The UE supporting control plane CIoT EPS optimization and S1-U data transfer but not user plane CIoT EPS optimization </condition> <action> does not indicate preference for user plane CIoT EPS optimization. </action> </control>
<control> <action> The UE can be in NB-S1 mode or WB-S1 mode </action> <condition> <condition> when requesting the use of CIoT EPS optimizations </condition> <condition> during an attach or tracking area updating procedure. </condition> </condition> </control> <control> <condition> A UE in NB-S1 mode </condition> <action> always indicates support for control plane CIoT EPS optimization. </action> </control> <control> <condition> A UE in NB-S1 mode </condition> <action> can also request SMS transfer </action> <condition> without combined procedure by using the normal attach or tracking area updating procedure </condition> (see subclause 5.5.1 and 5.5.3). </control>
<control> <condition> <condition> In NB-S1 mode </condition> , <condition> the UE, when requesting the use of CIoT EPS optimization, </condition> </condition> <action> does not: a) request an attach for emergency bearer services procedure; b) request an attach procedure for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach"; c) indicate voice domain preference and UE's usage setting; or d) request an attach for access to RLOS. </action> </control>
The network does not indicate to the UE support of emergency bearer services when the UE is in NB-S1 mode (see subclause 5.5.1.2.4 and 5.5.3.2.4).
The control plane CIoT EPS optimization enables support of efficient transport of user data (IP, non-IP, Ethernet) or SMS messages over control plane via the MME without triggering data radio bearer establishment. The support of control plane CIoT EPS optimization is mandatory for the network in NB-S1 mode and optional in WB-S1 mode.
Optional header compression of IP data can be applied to IP PDN type PDN connections that are configured to support header compression.
<control> <condition> The user plane CIoT EPS optimization </condition> <action> enables support for change from EMM-IDLE mode to EMM-CONNECTED mode without the need for using the service request procedure (see subclause 5.3.1.3). </action> </control>
<control> <condition> If the UE indicates support of EMM-REGISTERED without PDN connection in the attach request, </condition> <action> the UE may include an ESM DUMMY MESSAGE instead of a PDN CONNECTIVITY REQUEST message as part of the attach procedure. </action> </control>
<control> <condition> If the EMM-REGISTERED without PDN connection is supported by the network, </condition> <action> the UE and the network can at any time release all the PDN connections and the UE still remains EPS attached. </action> </control>
NOTE 2: For both the UE and the network, the term "EMM-REGISTERED without PDN connection" is equivalent to the term "EPS attach without PDN connectivity" as specified in 3GPP TS 23.401 .
<control> <condition> <condition> In NB-S1 mode, </condition> <condition> if the UE indicates "SMS only" </condition> <condition> during a normal attach or tracking area updating procedure, </condition> </condition> <condition> the MME supporting CIoT EPS optimisations </condition> <action> provides SMS </action> so that the UE is not required to perform a combined attach or tracking area updating procedure. </control>
<control> <condition> If the UE supports user plane CIoT EPS optimization, </condition> <action> it shall also support S1-U data transfer. </action> </control>
<control> <condition> <condition> If the UE indicates support of one or more CIoT EPS optimizations </condition> and <condition> the network supports one or more CIoT EPS optimizations </condition> and <condition> decides to accept the attach or tracking area update request, </condition> </condition> <action> the network indicates the supported CIoT EPS optimizations to the UE per TAI list <condition> when accepting the UE request. </condition> </action> <action> Network indication of support is interpreted by the UE as the acceptance to use the respective feature. </action> <control> <condition> After completion of the attach or tracking area updating procedure, </condition> <action> the UE and the network can then use the accepted CIoT EPS optimizations for the transfer of user data (IP, non-IP, Ethernet and SMS). </action> </control> </control>
<control> <condition> The UE supporting control plane CIoT EPS optimization </condition> <action> may indicate support for control plane MT-EDT during the attach or tracking area updating procedure. </action> </control> <control> <condition> <condition> For a UE that supports control plane MT-EDT </condition> and <condition> for which the network has accepted the use of control plane CIoT EPS optimization, </condition> </condition> <action> the network may trigger the delivery of downlink data to the UE, when available, using procedures for control plane MT-EDT as specified in 3GPP TS 23.401 . </action> </control>
<control> <condition> The UE supporting user plane CIoT EPS optimization </condition> <action> may indicate support for user plane MT-EDT during the attach or tracking area updating procedure. </action> </control> <control> <condition> <condition> For a UE that supports user plane MT-EDT </condition> and <condition> for which the network has accepted the use of user plane CIoT EPS optimization, </condition> </condition> <action> the network may trigger the delivery of downlink data to the UE, when available, using procedures for user plane MT-EDT as specified in 3GPP TS 23.401 . </action> </control>
<control> <condition> If the UE and the network support both the control plane CIoT EPS optimization and S1-U data transfer, </condition> <condition> then when receiving the UE's request for a PDN connection, </condition> <action> the MME decides whether the PDN connection should be SCEF PDN connection or SGi PDN connection as specified in 3GPP TS 23.401 </action> : <control> a) <condition> if SCEF PDN connection is to be established for non-IP data type, </condition> <action> the MME shall include Control plane only indication for the requested PDN connection; </action> </control> <control> b) <condition> <condition> if SGi PDN connection is to be established </condition> and <condition> existing SGi PDN connections for this UE were established with Control plane only indication, </condition> </condition> <action> the MME shall include Control plane only indication for the newly requested SGi PDN connection; </action> </control> <control> c) <condition> <condition> if SGi PDN connection is to be established </condition> and <condition> existing SGi PDN connections for this UE were established without Control plane only indication, </condition> </condition> <action> the MME shall not include Control plane only indication for the newly requested SGi PDN connection; </action> </control> and <control> d) <condition> <condition> if SGi PDN connection is to be established </condition> and <condition> no SGi PDN connection for this UE exists, </condition> </condition> <action> the MME determine whether to include Control plane only indication for the requested SGi PDN connection based on local policies, the UE's preferred CIoT network behaviour and the supported CIoT network behaviour. </action> </control> </control>
<control> <condition> If the network supports user plane CIoT EPS optimization, </condition> <action> it shall also support S1-U data transfer. </action> </control>
Broadcast system information may provide information about support of CIoT EPS optimizations (see 3GPP TS 36.331 ). <control> <condition> At reception of new broadcast system information, </condition> <action> the lower layers deliver it to the EMM layer in the UE. </action> </control> The information provided by lower layers is per PLMN and used by the UE to determine whether certain CIoT EPS optimizations are supported in the cell.
<control> <action> The UE shall not attempt to use CIoT EPS optimizations which are indicated as not supported. </action> </control>
<control> <condition> <condition> In NB-S1 mode, </condition> <condition> when the UE requests the lower layer to establish a RRC connection </condition> and <condition> the UE requests the use of EMM-REGISTERED without PDN connection or user plane CIoT EPS optimization, </condition> </condition> <action> the UE shall pass an indication of the requested CIoT EPS optimizations to the lower layers. </action> </control> <control> <condition> <condition> If the UE requests the use of S1-U data transfer </condition> <condition> without user plane CIoT optimization, </condition> </condition> <action> then the UE shall also pass an indication of user plane CIoT EPS optimization to lower layers. </action> </control>
<control> <condition> <condition> In WB-S1 mode, </condition> <condition> when the UE requests the lower layer to establish a RRC connection </condition> and <condition> the UE requests the use of EMM-REGISTERED without PDN connection, control plane CIoT EPS optimization or user plane CIoT EPS optimization, </condition> </condition> <action> the UE shall pass an indication of the requested CIoT EPS optimizations to the lower layers. </action> </control>
5.3.16 Restriction on use of enhanced coverage
<control> <condition> In order to deal with use of extensive resources from the network, </condition> <action> the operator may prevent specific subscribers from using enhanced coverage (see 3GPP TS 23.401 ). </action> </control> <control> <condition> When in NB-S1 mode, </condition> <action> the UE shall indicate support for restriction on use of enhanced coverage. </action> </control> <control> <condition> When in WB-S1 mode, the UE supporting either CE mode A or CE mode B </condition> <action> shall indicate support for restriction on use of enhanced coverage. </action> </control> <control> <condition> The UE supporting restriction on use of enhanced coverage </condition> <action> indicates its support for restriction on use of enhanced coverage in the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST message. </action> </control> <control> <condition> If the UE supports restriction on use of enhanced coverage, </condition> <action> the MME indicates whether the use of enhanced coverage is restricted or not in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message (see subclause 5.5.1.2 and subclause 5.5.3.2). </action> </control> <control> <condition> If the use of enhanced coverage is restricted, </condition> <action> the UE shall not use enhanced coverage in the registered PLMN and in any PLMN which is in the list of equivalent PLMNs. </action> </control>
<control> <condition> <condition> If the UE supports CE mode B </condition> and <condition> the network determines that a) <condition> the use of enhanced coverage is not restricted for the UE; </condition> or <condition> b) CE mode B is not restricted for the UE; </condition> </condition> </condition> <action> the applicable NAS timer values shall be calculated by the network as described in subclause 4.8. </action> </control>
5.3.17 Service Gap Control
<control> <action> The network may control the frequency UEs can transit from EMM-IDLE mode to EMM-CONNECTED mode via the service gap control (SGC) as specified in 3GPP TS 23.401 . </action> </control> <control> <condition> <condition> If the network supports service gap control (SGC) feature </condition> and <condition> the service gap time value is available in the EMM context of the UE, </condition> </condition> <action> the MME shall consider SGC as active for the UE. </action> </control>
<control> <action> The UE and the network negotiate usage of the service gap control (SGC) feature </action> <condition> during the attach and tracking area updating procedures: </condition> <control> a) <condition> the UE supporting service gap control </condition> <action> indicates its support for service gap control in the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST message. </action> <control> <condition> <condition> If the UE supports service gap control </condition> and <condition> the the SGC is active for the UE, </condition> </condition> <action> the MME shall include service gap timer T3447 value in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message (see subclause 5.5.1.2 and subclause 5.5.3.2). </action> </control> <action> The UE shall store the service gap time value; </action> </control> and <control> b) <condition> <condition> for UEs that do not support the optional SGC feature </condition> <condition> when the network rejects mobility management signalling requests </condition> <condition> due to service gap control is active in the network, </condition> </condition> <action> the mechanism for general NAS level mobility management congestion control as specified in subclause 5.3.9 applies. </action> </control> </control>
<control> <action> The UE shall start the SGC timer T3447 </action> <condition> when the NAS signalling connection is released </condition> and <condition> if: <condition> a) <condition> the UE supports SGC feature, </condition> and <condition> the service gap timer value is available in the UE </condition> and <condition> does not indicate zero; </condition> </condition> and <condition> b) <condition> the NAS signalling connection released </condition> <condition> was not established for: paging; attach requests without PDN connection request; or tracking area update requests </condition> <condition> without "active" or "signalling active" flag set. </condition> </condition> </condition> </control>
<control> <condition> If the SGC is active in the network, </condition> <condition> <condition> <condition> after the UE transitions from EMM-CONNECTED mode to EMM-IDLE mode </condition> <condition> <condition> except when the UE was in EMM-CONNECTED mode </condition> <condition> due to: a) paging; b) attach requests without PDN connection request; or c) tracking area update requests without "active" or "signalling active" flag set, </condition> </condition> </condition> </condition> <action> the network shall start the SGC timer T3447: </action> <control> a) <action> with the service gap time value available in the EMM context minus 4 minutes, </action> <condition> <condition> if the UE supports SGC feature </condition> and <condition> the service gap time value has been sent to the UE with a non-zero value; </condition> </condition> </control> or <control> b) <action> with the service gap time value available in the EMM context </action> <condition> if the UE does not support SGC feature. </condition> </control> </control>
<control> <condition> When the SGC timer T3447 is running, </condition> <action> the network allows: a) requests for emergency bearer services; b) requests for exception data reporting;- attach requests without PDN connection request; c) tracking area update requests without "active" or "signalling active" flag set; d) requests from UEs that were received via NAS signalling connections established with RRC establishment cause "High priority access AC 11 15"; and e) mobile terminated service requests triggered by paging and subsequent MO signalling or MO data, if any, until the UE enters EMM-IDLE mode. </action> </control>
<control> <condition> If the MME determines that the UE operating in single-registration mode has performed an inter-system change from S1 mode to N1 mode and the timer T3447 is running in the MME, </condition> <action> the MME stops the T3447. </action> </control>
<control> <condition> Upon inter-system change from N1 mode to S1 mode, </condition> <condition> <condition> if the UE supports service gap control, </condition> <condition> T3447 is running in the UE, </condition> and <condition> the T3447 value is included in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message received from the MME (see subclause 5.5.1.2 and subclause 5.5.3.2), </condition> </condition> <action> the UE shall keep T3447 running. </action> </control>
<control> Additionally, <action> the UE shall store and replace the currently stored T3447 value with the received T3447 value. </action> </control> <control> <condition> Upon expiry of the running T3447 timer, </condition> <action> the UE shall use the new value when starting T3447 again. </action> </control>
<control> <action> The UE or the network with a running service gap timer shall keep the timer running </action> <condition> when the UE transits from EMM- IDLE mode to EMM-CONNECTED mode. </condition> </control>
NOTE: <control> <condition> <condition> If the UE transitions from EMM-IDLE mode to EMM-CONNECTED mode </condition> <condition> due to attach request without PDN connection request or tracking area update request </condition> <condition> without "active" or "signalling active" flag set, </condition> </condition> <action> the UE initiates no further MO signalling </action> <condition> except for tracking area update request </condition> <condition> without "active" or "signalling active" flag set </condition> <condition> until the UE receives network-initiated signalling (e.g. DOWNLINK NAS TRANSPORT message for MT SMS) or MT data over user plane, or after the UE has moved to EMM- IDLE state and the service gap timer is not running. </condition> </control>
<control> <condition> If the timer T3447 is running </condition> <end_state> when the UE enters state EMM-DEREGISTERED, </end_state> <action> the UE remains switched on, </action> and <action> the USIM in the UE remains the same, </action> <control> <action> then timer T3447 is kept running </action> <condition> until it expires. </condition> </control> </control>
<control> <condition> <condition> If the UE is switched off </condition> <condition> when the timer T3447 is running, </condition> </condition> <action> the UE shall behave as follows </action> <condition> when the UE is switched on and the USIM in the UE remains the same: </condition> <control> a) let t1 be the time remaining for T3447 timeout at switch off and let t be the time elapsed between switch off and switch on. <control> <condition> If t1 is greater than t, </condition> <action> then the timer shall be restarted with the value t1 t. </action> </control> <control> <condition> If t1 is equal to or less than t, </condition> <action> then the timer need not be restarted. </action> </control> <control> <condition> If the UE is not capable of determining t, </condition> <action> then the UE shall restart the timer with the value t1. </action> </control> </control> </control>
5.3.18 Restricted local operator services
Restricted local operator services (RLOS) is an optional feature that enables operators to offer access to restricted local operator services to the unauthenticated UEs in limited service state (see 3GPP TS 23.401 ). Authenticated UEs in limited service state may also be able to access restricted local operator services. <control> <action> The UE requests access to RLOS </action> <condition> during the attach procedure </condition> <action> by setting the attach type to "EPS RLOS attach" in the ATTACH REQUEST message. </action> </control>
<control> <condition> <condition> Subject to regulation and local operator policy, </condition> <condition> if the MME is configured to support access to RLOS, </condition> </condition> <action> the MME accepts the UE's attach request </action> regardless of the authentication result or <action> skips the authentication procedure. </action> </control>
<control> <condition> When the UE requests the lower layer to establish an RRC connection for access to RLOS, </condition> <action> the UE indicates in the RRC signalling that the RRC connection is for access to RLOS to the lower layers. </action> </control>
<control> <action> Broadcast system information may provide information about support of access to RLOS (see 3GPP TS 36.331 ). </action> </control>
<control> <condition> At reception of new broadcast system information, </condition> <action> the lower layers deliver it to the EMM layer in the UE. </action> <action> The information provided by lower layers is per PLMN and used by the UE to determine the PLMN is configured to support access to RLOS. </action> <action> The UE shall not attempt to request access to RLOS if the serving PLMN does not support access to RLOS. </action> <control> <condition> If the serving PLMN supports access to RLOS and the UE is in limited service state, </condition> <action> the UE shall verify that the MCC of the PLMN ID of the serving PLMN is present in the list of access to RLOS allowed MCCs configured in the UE before requesting access to RLOS. </action> </control> <control> <condition> If the UE has a valid USIM, </condition> <action> the UE shall additionally verify that the MCC part of the IMSI configured in the USIM is present in the list of RLOS allowed MCCs before requesting access to RLOS. </action> </control> </control>
NOTE: Only authorized applications on the UE are allowed to trigger the initiation of RLOS connection (see 3GPP TS 33.401 ).
<control> <condition> For UE attached for access to RLOS, </condition> <action> only UE originated access to RLOS requests are supported. </action> </control> <action> Mobile terminated access to RLOS request and network triggered service request are not allowed. </action> <control> <action> The UE is not allowed to initiate UE requested PDN connectivity for any additional PDN connection. </action> <action> In addition, intersystem change to other RAT including GERAN and UTRAN and handover between 3GPP and non-3GPP accesses are not supported. </action> </control>
<control> <action> Access to RLOS is applicable </action> <condition> to the UEs in WB-S1 mode only. </condition> </control> <control> <condition> The UEs in NB-S1 mode </condition> <action> shall not request access to RLOS. </action> </control>
<control> <action> Location service does not apply to access to RLOS. </action> </control>
<control> <condition> <condition> If a UE attached for access to RLOS </condition> <condition> needs to initiate an emergency call, </condition> </condition> <action> the UE shall first perform a local detach prior to initiating an attach procedure for emergency bearer services. </action> </control>
5.3.19 Core Network selection and redirection for UEs using CIoT optimizations
5.3.19.1 Core network selection
<control> <condition> A UE that supports CIoT optimizations </condition> <action> performs core network selection as specified in subclause 4.8.4A.1 of 3GPP TS 24.501 . </action> </control>
5.3.19.2 Redirection of the UE by the core network
<control> <condition> The network that supports CIoT optimizations </condition> <action> can redirect a UE between EPC and 5GCN as specified in subclause 5.31.3 of 3GPP TS 23.501 . </action> <action> The network can take into account the UEs N1 mode capability or S1 mode capability, the CIoT network behaviour supported and preferred by the UE or the CIoT network behaviour supported by the network to determine the redirection. </action> </control>
NOTE: It is assumed that the network would avoid redirecting the UE back and forth between EPC and 5GCN.
<control> <condition> The network redirects the UE to 5GCN </condition> <action> by rejecting the attach request, or tracking area update request, or service request with the EMM cause #31 "Redirection to 5GCN required" </action> as specified in subclause 5.5.1.2.5, 5.5.1.3.5, 5.5.3.2.5, 5.5.3.3.5 and 5.6.1.5. </control> <control> <condition> Upon receipt of reject message, </condition> <action> the UE disables the E- UTRA capability </action> as specified in subclause 4.5 and <action> enables the N1 mode capability <condition> if it was disabled in order to move to 5GCN. </condition> </action> </control>
<control> <action> The network that supports CIoT optimizations can also redirect a UE from 5GCN to EPC as specified in subclause 4.8.4A.2 of 3GPP TS 24.501 . </action> </control>
5.3.20 UE radio capability signalling optimisation
UE radio capability signalling optimisation (RACS) is a feature that is optional at both the UE and the network and which aims to optimise the transmission of UE radio capability over the radio interface (see 3GPP TS 23.401 ).
RACS works by assigning an identifier to represent a set of UE radio capabilities. This identifier is called the UE radio capability ID. A UE radio capability ID can be either manufacturer-assigned or network-assigned. The UE radio capability ID is an alternative to the signalling of the radio capabilities container over the radio interface.
In this release of the specification, RACS is not applicable to NB-S1 mode.
<control> <condition> If the UE supports RACS: </condition> <action> a) the UE shall indicate support for RACS by setting the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST messages; </action> <control> b) <condition> <condition> if the UE performs an attach procedure </condition> and <condition> the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected network, </condition> </condition> <action> the UE shall include the UE radio capability ID availability IE in the ATTACH REQUEST message </action> and <action> set the IE to "UE radio capability ID available"; </action> </control> <control> c) <condition> <condition> if the UE performs a tracking area updating procedure </condition> and <condition> the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected network, </condition> </condition> <action> the UE shall include the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message </action> and <action> set the IE to "UE radio capability ID available"; </action> </control> <control> d) <condition> <condition> If the UE is requested to provide its UE radio capability ID by the network </condition> <condition> during a security mode control procedure, </condition> </condition> <action> the UE shall include its UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message. </action> <control> <condition> If both a network-assigned UE radio capability ID and a manufacturer-assigned UE radio capability ID are applicable, </condition> <action> the UE shall include the network-assigned UE radio capability ID in the SECURITY MODE COMPLETE message; </action> </control> </control> <control> e) <condition> if the radio configuration at the UE changes (for instance because the UE has disabled a specific radio capability) </condition> then: <control> a) <condition> if the UE has an applicable UE radio capability ID for the new UE radio configuration, </condition> <action> the UE shall initiate a tracking area updating procedure, </action> <action> include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message </action> and <action> include a UE radio capability ID availability IE set to "UE radio capability ID available" in the TRACKING AREA UPDATE REQUEST message. </action> <control> <condition> If both a network-assigned UE radio capability ID and a manufacturer-assigned UE Radio Capability ID are applicable, </condition> <action> the UE shall include the network-assigned UE radio capability ID in the TRACKING AREA UPDATE REQUEST message; </action> </control> </control> and <control> b) <condition> if the UE does not have an applicable UE radio capability ID for the new UE radio configuration, </condition> <action> the UE shall initiate a tracking area updating procedure </action> and <action> shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message; </action> </control> NOTE: Performing the tracking area updating procedure with the UE radio capability information update needed IE included in the TRACKING AREA UPDATE REQUEST message and without the UE radio capability ID availability IE set to "UE radio capability ID available" in the TRACKING AREA UPDATE REQUEST message as specified in b) above can trigger the network to assign a new UE radio capability ID to the UE. </control> <control> f) <condition> upon receiving a network-assigned UE radio capability ID in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the UE shall store the network-assigned UE radio capability ID and the PLMN ID of the serving network along with a mapping to the current UE radio configuration in its non-volatile memory as specified in annex C. </action> <action> The UE shall be able to store at least the last 16 received network- assigned UE radio capability IDs with the associated PLMN ID and the mapping to the corresponding UE radio configuration; </action> </control> <action> g) the UE shall not use a network-assigned UE radio capability ID in PLMNs equivalent to the PLMN which assigned it; </action> and <control> h) <condition> upon receiving a UE radio capability ID deletion indication IE set to "delete network-assigned UE radio capability IDs" in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the UE shall delete all network-assigned UE radio capability IDs stored at the UE for the serving network and initiate a tracking area updating procedure. </action> <control> <condition> If the UE has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration in the selected network, </condition> <action> the UE shall include a UE radio capability ID availability IE set to "UE radio capability ID available" in the TRACKING AREA UPDATE REQUEST message. </action> </control> </control> </control>
<control> <condition> If the network supports RACS: </condition> <control> a) <condition> <condition> if the UE has included the UE radio capability ID availability IE in the ATTACH REQUEST message </condition> and <condition> set the IE to "UE radio capability ID available", </condition> </condition> <action> the network shall initiate a security mode control procedure to retrieve the UE radio capability ID from the UE; </action> </control> <control> b) <condition> <condition> if the UE has included the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message </condition> and <condition> set the IE to "UE radio capability ID available", </condition> </condition> <action> the network may initiate a security mode control procedure to retrieve the UE radio capability ID from the UE; </action> </control> <control> c) <condition> <condition> if the UE has included the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message, </condition> <condition> set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE </condition> and <condition> no UE radio capability ID is available in the UE context in the MME, </condition> </condition> <action> the network shall initiate a security mode control procedure to retrieve the UE radio capability ID from the UE; </action> </control> <control> d) <action> the network may assign a network-assigned UE radio capability ID to a UE </action> <condition> which supports RACS by including a UE radio capability ID IE in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message; </condition> </control> and <action> e) the network may trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving network by including a UE radio capability ID deletion indication IE set to "delete network-assigned UE radio capability IDs" in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message. </action> </control>
5.3.21 Wake-up signal assistance
<control> <condition> A UE supporting wake-up signal (WUS) assistance </condition> <action> can indicate its WUS assistance capability during attach or tracking area updating procedure (see 3GPP TS 23.401 ). </action> </control> <control> <condition> The UE supporting WUS assistance </condition> <action> may include its UE paging probability information in the Requested WUS assistance information IEduring an attach or tracking area updating procedure (see 3GPP TS 23.401 ). </action> <control> <action> The UE shall not include its UE paging probability information </action> <condition> during: a) an attach for emergency bearer services procedure; or b) a tracking area updating procedure for the UE attached for emergency bearer services. </condition> </control> </control>
<control> The UE is not attached for emergency bearer services and <action> the network may negotiate the UE paging probability information during an attach or tracking area updating procedure </action> <condition> when the UE is not attached for emergency bearer services. </condition> </control> The UE paging probability information is an assistance information used to determine the WUS group for paging UE (see 3GPP TS 23.401 , 3GPP TS 36.300 ).
NOTE: The determination of UE paging probability information is up to UE implementation.
<control> <condition> <condition> If the UE is not attached for emergency bearer services </condition> and <condition> the network accepts the use of the WUS assistance for the UE, </condition> </condition> <action> the network determines the negotiated UE paging probability information for the UE based on the requested UE paging probability information, if any, local configuration or previous statistical information for the UE , </action> and <action> then indicates the negotiated UE paging probability information in the Negotiated WUS assistance information IE to the UE when accepting the attach or the tracking area updating procedure. </action> <action> The network shall store the negotiated UE paging probability information in the EMM context of the UE for paging. </action> </control>
<control> <action> The UE shall use WUS assistance </action> <condition> only if it received the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure. </condition> </control> <control> <condition> If the UE did not receive the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure, </condition> <action> the UE shall not use WUS assistance. </action> </control>
<control> <condition> If the network did not accept the request to use WUS assistance, </condition> <action> the network shall delete the stored negotiated UE paging probability information for the UE, </action> <condition> if available. </condition> </control>
<control> <condition> <condition> When a PDN connection for emergency bearer service is successfully established </condition> <condition> after the UE received the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure, </condition> </condition> <action> the UE and the network shall not use WUS assistance information </action> <condition> until: <condition> a) the successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, </condition> or <condition> b) <condition> the UE receives WUS assistance information </condition> <condition> <condition> during a tracking area updating procedure </condition> <condition> with EPS bearer context synchronization </condition> </condition> or <condition> <condition> upon successful completion of a service request procedure, </condition> <condition> if the UE or the network locally releases the PDN connection for emergency bearer service. </condition> </condition> </condition> </condition> </control>
5.4 EMM common procedures
5.4.1 GUTI reallocation procedure
5.4.1.1 General
The purpose of the GUTI reallocation procedure is to allocate a GUTI and optionally to provide one or more of the following to a particular UE: a) a new TAI list; b) a new DCN-ID; and c) in WB-S1 mode, if the UE supports RACS, either a UE radio capability ID deletion indication or a UE radio capability ID.
The reallocation of a GUTI is performed by the unique procedure defined in this subclause. <control> <action> This procedure can only be initiated </action> <start_state> by the MME in state EMM-REGISTERED. </start_state> </control>
<control> <action> The GUTI can also be implicitly reallocated </action> <condition> at attach or tracking area updating procedures. </condition> </control> The implicit reallocation of a GUTI is described in the subclauses which specify these procedures (see subclause 5.5.1 and 5.5.3).
<control> <action> The PLMN identity in the GUTI indicates the current registered PLMN. </action> </control>
NOTE 1: <control> <action> The GUTI reallocation procedure is usually performed </action> <condition> in ciphered mode. </condition> </control>
NOTE 2: <control> <action> Normally, the GUTI reallocation will take place </action> <condition> in conjunction with another mobility management procedure, e.g. as part of tracking area updating. </condition> </control>
5.4.1.2 GUTI reallocation initiation by the network
<control> <condition> The MME shall initiate the GUTI reallocation procedure </condition> <action> by sending a GUTI REALLOCATION COMMAND message to the UE </action> and <action> starting the timer T3450 (see example in figure 5.4.1.2.1). </action> </control>
<control> <action> TThe GUTI REALLOCATION COMMAND message shall include a GUTI </action> and <action> may include one or more of the following: a) a TAI list; b) a DCN-ID; and c) in WB-S1 mode, if the UE supports RACS, either a UE radio capability ID deletion indication or a UE radio capability ID. </action> </control>
5.4.1.3 GUTI reallocation completion by the UE
<control> <condition> Upon receipt of the GUTI REALLOCATION COMMAND message, </condition> the UE shall: <action> a) store the GUTI; </action> <control> <action> b) store the TAI list, </action> <condition> if provided; </condition> </control> <control> c) <action> store the DCN-ID, </action> <condition> if provided; </condition> </control> <control> d) <condition> <condition> in WB-S1 mode, </condition> <condition> if the UE supports RACS </condition> and <condition> the GUTI REALLOCATION COMMAND message includes: a) a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", </condition> </condition> <action> delete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE, </action> <control> <condition> then the UE shall, after the completion of the ongoing GUTI reallocation procedure, </condition> <action> initiate a tracking area updating procedure as specified in subclause 5.5.3. </action> </control> </control> <control> <condition> If the UE has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration, </condition> <action> the UE shall include the UE radio capability ID availability IE set to "UE radio capability ID available" in the TRACKING AREA UPDATE REQUEST message; </action> </control> and <action> b) a UE radio capability ID IE, store the UE radio capability ID as specified in annex C; </action> and <action> c) send a GUTI REALLOCATION COMPLETE message to the MME. </action> <control> <action> The UE considers the new GUTI as valid and the old GUTI as invalid. </action> </control> </control>
<control> <condition> If the UE receives a new TAI list in the GUTI REALLOCATION COMMAND message, </condition> <action> the UE shall consider the new TAI list as valid and the old TAI list as invalid; </action> </control> <control> <condition> otherwise, </condition> <action> the UE shall consider the old TAI list as valid. </action> </control>
<control> <condition> If the GUTI REALLOCATION COMMAND message contains the DCN-ID IE, </condition> <action> then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C. </action> </control>
5.4.1.4 GUTI reallocation completion by the network
<control> <condition> Upon receipt of the GUTI REALLOCATION COMPLETE message, </condition> <action> the MME shall stop the timer T3450 </action> and <action> consider the new GUTI as valid and the old GUTI as invalid. </action> <control> <condition> If a new TAI list is provided in the GUTI REALLOCATION COMMAND message, </condition> <action> the MME shall consider the new TAI list as valid and the old TAI list as invalid. </action> </control> </control>
5.4.1.5 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> a) <condition> <condition> Transmission failure of GUTI REALLOCATION COMPLETE message indication </condition> <condition> with TAI change from lower layers: </condition> </condition> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> <action> the GUTI reallocation procedure shall be aborted and a tracking area updating procedure shall be initiated. </action> </control>
<control> <condition> If the current TAI is still part of the TAI list, </condition> <action> it is up to the UE implementation how to re-run the ongoing procedure that triggered the GUTI reallocation procedure. </action> </control>
<control> b) <condition> <condition> Transmission failure of GUTI REALLOCATION COMPLETE message indication </condition> <condition> without TAI change from lower layers: </condition> </condition> </control>
<control> <action> It is up to the UE implementation how to re-run the ongoing procedure that triggered the GUTI reallocation procedure. </action> </control>
5.4.1.6 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) Lower layer failure </condition> </control>
<control> <condition> <condition> If a lower layer failure is detected </condition> <condition> before the GUTI REALLOCATION COMPLETE message is received, </condition> </condition> <action> the old and the new GUTI shall be considered as valid </action> <condition> until the old GUTI can be considered as invalid by the network. </condition> </control>
<control> <condition> If a new TAI list was provided in the GUTI REALLOCATION COMMAND message, </condition> <action> the old and new TAI list shall also be considered as valid </action> <condition> until the old TAI list can be considered as invalid by the network. </condition> </control>
<control> <condition> During this period </condition> the network: <control> a) <action> may first use the old S-TMSI from the old GUTI for paging within the area defined by the old TAI list for an implementation dependent number of paging attempts for network originated transactions. </action> <control> <condition> If a new TAI list was provided with old GUTI in the GUTI REALLOCATION COMMAND message, </condition> <action> the new TAI list should also be used for paging. </action> </control> <control> <condition> Upon response from the UE, </condition> <action> the network may re-initiate the GUTI reallocation. </action> </control> <control> <condition> If the response is received from a tracking area within the old and new TAI list, </condition> <action> the network shall re-initiate the GUTI reallocation. </action> </control> <control> <condition> If no response is received to the paging attempts, </condition> <action> the network may use the new S-TMSI from the new GUTI for paging for an implementation dependent number of paging attempts. </action> <control> <condition> In this case, if a new TAI list was provided with new GUTI in the GUTI REALLOCAITON COMMAND message, </condition> <action> the new TAI list shall be used instead of the old TAI list. </action> </control> </control> <control> <condition> Upon response from the UE </condition> <action> the network shall consider the new GUTI as valid and the old GUTI as invalid. </action> </control> <control> <condition> If no response is received to the paging attempts, </condition> <action> the network may use the IMSI for paging for an implementation dependent number of paging attempts; </action> </control> </control> NOTE 1: Paging with IMSI causes the UE to re-attach as described in subclause 5.6.2.2.2.b) <control> <action> shall consider the new GUTI as valid </action> <condition> if it is used by the UE and, </condition> </control> additionally, <control> <action> the new TAI list as valid </action> <condition> if it was provided with this GUTI in the GUTI REALLOCATION COMMAND message; </condition> </control> <control> c) <action> may use the identification procedure followed by a new GUTI reallocation </action> <condition> if the UE uses the old GUTI; </condition> </control> and <control> d) <condition> if the network accepted to use eDRX for the UE, </condition> <action> may determine the next paging window from both old GUTI and new GUTI, </action> and <action> may first use the S-TMSI from the GUTI which led the first eDRX for paging. </action> <control> <condition> If no response is received to the paging attempts for the first eDRX, </condition> <action> the network may use the other S-TMSI from the other GUTI which led the second eDRX for paging. </action> <action> For this paging procedure, the network shall start timer T3415 long enough to care the paging attempts for both eDRXs. </action> </control> </control> </control>
NOTE 2: <control> <condition> If the second eDRX comes during the first eDRX ongoing, </condition> <action> the paging attempts for the second eDRX can be initiated with stopping further paging attempts for the first eDRX. </action> </control>
<control> b) <condition> Expiry of timer T3450: </condition> </control>
The GUTI reallocation procedure is supervised by the timer T3450. <control> The network shall, <condition> on the first expiry of timer T3450 </condition> , <action> reset and restart timer T3450 </action> and <action> shall retransmit the GUTI REALLOCATION COMMAND. </action> <action> This retransmission is repeated four times, </action> i.e. <control> <condition> on the fifth expiry of timer T3450, </condition> , <action> the network shall abort the reallocation procedure </action> and <action> shall follow the rules described for case a above. </action> </control> </control>
<control> c) <condition> GUTI reallocation and attach procedure collision: </condition> </control>
<control> <condition> <condition> If the network receives an ATTACH REQUEST message </condition> <condition> before the ongoing GUTI reallocation procedure has been completed </condition> </condition> <action> the network shall proceed with the attach procedure after deletion of the EMM context. </action> </control>
<control> d) <condition> GUTI reallocation and UE initiated detach procedure collision: </condition> </control>
<control> <condition> <condition> If the network receives a DETACH REQUEST message </condition> <condition> before the ongoing GUTI reallocation procedure has been completed, </condition> </condition> <action> the network shall abort the GUTI reallocation procedure and shall progress the detach procedure. </action> </control>
<control> e) <condition> GUTI reallocation and tracking area updating procedure collision: </condition> </control>
<control> <condition> <condition> If the network receives a TRACKING AREA UPDATE REQUEST message </condition> <condition> before the ongoing GUTI reallocation procedure has been completed, </condition> </condition> <action> the network shall abort the GUTI reallocation procedure </action> and <action> shall progress the tracking area updating procedure. </action> <action> The network may then perform a new GUTI reallocation. </action> </control>
<control> f) <condition> GUTI reallocation and service request procedure collision: </condition> </control>
<control> <condition> <condition> If the network receives an EXTENDED SERVICE REQUEST message for CS fallback or 1xCS fallback </condition> <condition> before the ongoing GUTI reallocation procedure has been completed, </condition> </condition> <action> the network shall progress both procedures. </action> </control>
<control> g) <condition> Lower layer indication of non-delivered NAS PDU due to handover: </condition> </control>
<control> <condition> <condition> If the GUTI REALLOCATION COMMAND message could not be delivered </condition> <condition> <condition> due to an intra MME handover </condition> and <condition> the target TA is included in the TAI list, </condition> </condition> </condition> <condition> then upon successful completion of the intra MME handover </condition> <action> the MME shall retransmit the GUTI REALLOCATION COMMAND message. </action> </control> <control> <condition> <condition> If a failure of the handover procedure is reported by the lower layer </condition> and <condition> the S1 signalling connection exists, </condition> </condition> <action> the MME shall retransmit the GUTI REALLOCATION COMMAND message. </action> </control>
<control> <condition> If there is a different new GUTI and optionally a new TAI list included in a subsequent GUTI REALLOCATION COMMAND message, </condition> <action> the UE always regards the newest GUTI and the newest TAI list as valid for the recovery time. </action> </control>
5.4.2 Authentication procedure
5.4.2.1 General
The purpose of the EPS authentication and key agreement (AKA) procedure is to provide mutual authentication between the user and the network and to agree on a key K (see 3GPP TS 33.401 ). The cases when the EPS AKA procedure should be used are defined in 3GPP TS 33.401 .
<control> <action> The EPS AKA procedure is always initiated and controlled by the network. </action> <action> However, the UE can reject the EPS authentication challenge sent by the network. </action> </control>
<control> <action> TThe UE shall proceed with an EPS authentication challenge </action> <condition> only if a USIM is present. </condition> </control>
<control> <action> A partial native EPS security context is established in the UE and the network </action> <condition> when an EPS authentication is successfully performed. </condition> </control> <control> <condition> During a successful EPS authentication procedure, </condition> <action> the CK and IK are computed by the USIM. </action> </control>
<control> <action> CK and IK are then used by the ME as key material to compute a new key, K . </action> <action> K is stored in the EPS security contexts (see 3GPP TS 33.401 ) of both the network and in the volatile memory of the ME while attached to the network, </action> and <action> is the root for the EPS integrity protection and ciphering key hierarchy. </action> </control>
5.4.2.2 Authentication initiation by the network
<control> <condition> When a NAS signalling connection exists, </condition> <action> the network can initiate an authentication procedure at any time. </action> </control> For restrictions applicable after handover or inter-system handover to S1 mode see subclause 5.5.3.2.3.
<control> <condition> The network initiates the authentication procedure </condition> <action> by sending an AUTHENTICATION REQUEST message to the UE </action> and <action> starting the timer T3460 (see example in figure 5.4.2.2.1). </action> <action> The AUTHENTICATION REQUEST message contains the parameters necessary to calculate the authentication response (see 3GPP TS 33.401 ). </action> </control>
<control> <condition> If an eKSI is contained in an initial NAS message during an EMM procedure, </condition> <action> the network shall include a different eKSI value in the AUTHENTICATION REQUEST message </action> <condition> when it initiates an authentication procedure. </condition> </control>
UE MME AUTHENTICATION REQUEST
Start T3460 AUTHENTICATION RESPONSE
Stop T3460 AUTHENTICATION REJECT if authentication failed
5.4.2.3 Authentication response by the UE
<control> <action> The UE shall respond to an AUTHENTICATION REQUEST message. </action> <control> <condition> With the exception of the cases described in subclauses 5.4.2.6 and 5.4.2.7 case k, </condition> <action> the UE shall process the authentication challenge data </action> and <action> respond with an AUTHENTICATION RESPONSE message to the network. </action> </control> </control>
<control> <condition> Upon a successful EPS authentication challenge, </condition> <action> the UE shall determine the PLMN identity to be used for the calculation of the new K from the authentication challenge data according to the following rules: </action> <control> a) <condition> <condition> When the UE moves from EMM-IDLE mode to EMM-CONNECTED mode, </condition> <condition> until the first handover, </condition> </condition> <action> the UE shall use the PLMN identity of the selected PLMN; </action> </control> and <control> b) <condition> After handover or inter-system handover to S1 mode, </condition> <control> a) <condition> if the target cell is not a shared network cell, </condition> <action> the UE shall use the PLMN identity received as part of the broadcast system information; </action> </control> <control> b) <condition> <condition> if the target cell is a shared network cell </condition> and <condition> the UE has a valid GUTI, </condition> </condition> <action> the UE shall use the PLMN identity that is part of the GUTI; </action> </control> and <control> c) <condition> <condition> if the target cell is a shared network cell, </condition> <condition> the UE does not have a valid GUTI and, </condition> </condition> <control> a) <condition> <condition> <condition> the EPS authentication challenge is performed </condition> <condition> after inter-system handover from A/Gb mode to S1 mode or from Iu mode to S1 mode </condition> </condition> and <condition> the UE has a valid P-TMSI and RAI, </condition> </condition> <action> the UE shall use the PLMN identity that is part of the RAI; </action> </control> or <control> b) <condition> <condition> <condition> the EPS authentication challenge is performed </condition> <condition> after inter-system handover from N1 mode to S1 mode </condition> </condition> and <condition> the UE has a valid 5G-GUTI, </condition> </condition> <action> the UE shall use the PLMN identity that is part of the 5G-GUTI. </action> </control> </control> </control> </control>
<control> <condition> Upon a successful EPS authentication challenge, </condition> <action> the new K calculated from the authentication challenge data shall be stored in a new EPS security context in the volatile memory of the ME. </action> </control>
<control> <action> The USIM will compute the authentication response (RES) using the authentication challenge data received from the ME, </action> and <action> pass RES to the ME. </action> </control>
<control> In order to avoid a synchronisation failure, <condition> when the UE receives an AUTHENTICATION REQUEST message, </condition> <action> the UE shall store the received RAND together with the RES returned from the USIM in the volatile memory of the ME. </action> </control> <control> <condition> <condition> When the UE receives a subsequent AUTHENTICATION REQUEST message, </condition> <condition> if the stored RAND value is equal to the new received value in the AUTHENTICATION REQUEST message, </condition> </condition> <action> then the ME shall not pass the RAND to the USIM, </action> <action> but shall send the AUTHENTICATION RESPONSE message with the stored RES. </action> </control> <control> <condition> <condition> If there is no valid stored RAND in the ME </condition> or <condition> the stored RAND is different from the new received value in the AUTHENTICATION REQUEST message, </condition> </condition> <action> the ME shall pass the RAND to the USIM, </action> <action> shall override any previously stored RAND and RES with the new ones and start, </action> or <action> reset and restart timer T3416. </action> </control>
<control> <action> The RAND and RES values stored in the ME shall be deleted </action> and <action> timer T3416, if running, shall be stopped: </action> <condition> <condition> a) upon receipt of a SECURITY MODE COMMAND, SERVICE REJECT, SERVICE ACCEPT, TRACKING AREA UPDATE REJECT, TRACKING AREA UPDATE ACCEPT, or AUTHENTICATION REJECT message; </condition> <condition> b) upon expiry of timer T3416; </condition> <condition> c) if the UE enters the EMM state EMM-DEREGISTERED or EMM-NULL; </condition> or <condition> j) if the UE enters EMM-IDLE mode. </condition> </condition> </control>
5.4.2.4 Authentication completion by the network
<control> <condition> Upon receipt of an AUTHENTICATION RESPONSE message, </condition> <action> the network stops the timer T3460 </action> and <action> checks the correctness of RES (see 3GPP TS 33.401 ). </action> </control>
<control> <condition> <condition> If the authentication procedure has been completed successfully </condition> and <condition> the related eKSI is stored in the EPS security context of the network, </condition> </condition> <action> the network shall include a different eKSI value in the AUTHENTICATION REQUEST message </action> <condition> when it initiates a new authentication procedure. </condition> </control>
<control> <condition> Upon receipt of an AUTHENTICATION FAILURE message, </condition> <action> the network stops the timer T3460. </action> <control> <condition> In the case where the EMM cause #21 "synch failure" is received, </condition> <action> the core network may renegotiate with the HSS/AuC </action> and <action> provide the UE with new authentication parameters. </action> </control> </control>
5.4.2.5 Authentication not accepted by the network
<control> <condition> If the authentication response (RES) returned by the UE is not valid, </condition> <action> the network response depends upon the type of identity used by the UE in the initial NAS message, </action> <condition> that is: <condition> a) if the GUTI was used; </condition> or <condition> b) if the IMSI was used. </condition> </condition> </control>
<control> <condition> If the GUTI was used, </condition> <action> the network should initiate an identification procedure. </action> </control> <control> <condition> If the IMSI given by the UE during the identification procedure differs from the IMSI the network had associated with the GUTI, </condition> <action> the authentication should be restarted with the correct parameters. </action> </control> <control> <condition> <condition> Otherwise, </condition> <condition> if the IMSI provided by the UE is the same as the IMSI stored in the network (i.e. <condition> authentication has really failed </condition> ), </condition> </condition> <action> the network should send an AUTHENTICATION REJECT message to the UE. </action> </control>
<control> <condition> <condition> If the IMSI was used for identification in the initial NAS message, </condition> or <condition> <condition> the network decides not to initiate the identification procedure </condition> <condition> after an unsuccessful authentication procedure, </condition> </condition> </condition> <action> the network should send an AUTHENTICATION REJECT message to the UE. </action> </control>
<control> <condition> Upon receipt of an AUTHENTICATION REJECT message, </condition> <control> a) <condition> if the message has been successfully integrity checked by the NAS, </condition> <action> the UE shall set the update status to EU3 ROAMING NOT ALLOWED, </action> <action> delete the stored GUTI, TAI list, last visited registered TAI and KSI . </action> <control> <action> The USIM shall be considered invalid </action> <condition> until <condition> switching off the UE </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control> <control> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> <control> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> <control> <condition> If A/Gb or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case when the authentication and ciphering procedure is not accepted by the network; </condition> </control> </control> and <control> b) <condition> if the message is received without integrity protection, </condition> <control> <action> the UE shall start timer T3247 (see 3GPP TS 24.008 ) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, </action> <condition> if the timer is not running (see subclause 5.3.7b). </condition> </control> Additionally, the UE shall: <control> a) <condition> <condition> if the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events </condition> and <condition> the counter has a value less than a UE implementation-specific maximum value, </condition> </condition> <action> proceed as specified in subclause 5.3.7b, list item 1a for the case that the EMM cause value received is #3; </action> </control> <control> and b) <condition> otherwise </condition> <action> proceed as specified under list item a above for the case that the message has been successfully integrity checked. </action> </control> </control> </control>
<control> <condition> If the AUTHENTICATION REJECT message is received by the UE, </condition> <action> the UE shall abort any EMM signalling procedure, </action> <action> stop any of the retransmission timers that are running (e.g. T3410, T3416, T3417, T3430, T3421, T3418 or T3420) </action> and <end_state> enter state EMM-DEREGISTERED. </end_state> </control>
<control> <condition> <condition> Depending on local requirements or operator preference for emergency bearer services, </condition> <condition> <condition> if the UE has a PDN connection for emergency bearer services established </condition> or <condition> is establishing a PDN connection for emergency bearer services, </condition> </condition> </condition> <action> the MME need not follow the procedures specified for the authentication failure in the present subclause. </action> <action> The MME may continue a current EMM specific procedure or PDN connectivity request procedure. </action> </control> <control> <condition> Upon completion of the authentication procedure, </condition> <condition> if not initiated as part of another procedure, </condition> or <condition> upon completion of the EMM procedure or PDN connectivity request procedure, </condition> <control> <action> the MME shall deactivate all non-emergency EPS bearers, </action> <condition> if any, </condition> <action> by initiating an EPS bearer context deactivation procedure. </action> <action> The network shall consider the UE to be attached for emergency bearer services only. </action> </control> </control>
<control> <condition> <condition> Depending on local regulation and operator policy, </condition> <condition> if the UE is requesting attach for access to RLOS, </condition> </condition> <action> the MME need not follow the procedures specified for the authentication failure in the present subclause. </action> <action> The MME may continue a current EMM specific procedure. </action> </control>
5.4.2.6 Authentication not accepted by the UE
<control> <condition> In an EPS authentication challenge, </condition> <action> the UE shall check the authenticity of the core network by means of the AUTN parameter received in the AUTHENTICATION REQUEST message. </action> </control> This enables the UE to detect a false network.
<control> <condition> During an EPS authentication procedure, </condition> <action> the UE may reject the core network </action> <condition> due to an incorrect AUTN parameter </condition> (see 3GPP TS 33.401 ). This parameter contains three possible causes for authentication failure: </control>
<control> a) MAC code failure: <condition> If the UE finds the MAC code (supplied by the core network in the AUTN parameter) to be invalid, </condition> <action> the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #20 "MAC failure". </action> <action> The UE shall then follow the procedure described in subclause 5.4.2.7, item c. </action> </control>
<control> b) <condition> <condition> Non-EPS authentication unacceptable: </condition> <condition> If the UE finds that the "separation bit" in the AMF field of AUTN supplied by the core network is 0, </condition> </condition> <action> the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #26 "non-EPS authentication unacceptable" (see subclause 6.1.1 in 3GPP TS 33.401 ). </action> <action> The UE shall then follow the procedure described in subclause 5.4.2.7, item d. </action> </control>
<control> c) <condition> <condition> SQN failure: </condition> <condition> If the UE finds the SQN (supplied by the core network in the AUTN parameter) to be out of range, </condition> </condition> <action> the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #21 "synch failure" and a re-synchronization token AUTS provided by the USIM (see 3GPP TS 33.102 ). </action> <action> The UE shall then follow the procedure described in subclause 5.4.2.7, item e. </action> </control>
<control> <condition> If the UE returns an AUTHENTICATION FAILURE message to the network, </condition> <action> the UE shall delete any previously stored RAND and RES </action> and <control> <action> shall stop timer T3416, </action> <condition> if running. </condition> </control> </control>
<control> <condition> <condition> If the UE has a PDN connection for emergency bearer services established </condition> or <condition> is establishing such a PDN connection, </condition> </condition> additional UE requirements are specified in subclause 5.4.2.7, under "for items c, d, e". </control>
<control> <condition> <condition> If the UE is attached for access to RLOS </condition> and <condition> has a PDN connection for RLOS established or is establishing such a PDN connection, </condition> </condition> additional UE requirements are specified in subclause 5.4.2.7, under "for items c, d, e". </control>
5.4.2.7 Abnormal cases
<control> a) <condition> Lower layer failure: </condition> </control>
<control> <condition> <condition> Upon detection of lower layer failure </condition> <condition> before the AUTHENTICATION RESPONSE message is received, </condition> </condition> <action> the network shall abort the procedure. </action> </control>
<control> b) <condition> Expiry of timer T3460: </condition> </control>
<control> <condition> The network shall, on the first expiry of the timer T3460, </condition> <action> retransmit the AUTHENTICATION REQUEST message </action> <action> and shall reset and start timer T3460. </action> <action> This retransmission is repeated four times , </action> <control> i.e. <condition> on the fifth expiry of timer T3460, </condition> <action> the network shall abort the authentication procedure </action> and <action> any ongoing EMM specific procedure and release the NAS signalling connection. </action> </control> </control>
<control> c) <condition> Authentication failure (EMM cause #20 "MAC failure"): </condition> </control>
<control> <action> The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #20 "MAC failure" according to subclause 5.4.2.6, to the network </action> and <action> start timer T3418 (see example in figure 5.4.2.7.1). </action> <action> Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). </action> </control> <control> <condition> <condition> Upon the first receipt of an AUTHENTICATION FAILURE message from the UE </condition> <condition> with EMM cause #20 "MAC failure", </condition> </condition> <action> the network may initiate the identification procedure described in subclause 5.4.4. </action> This is to allow the network to obtain the IMSI from the UE. <action> The network may then check that the GUTI originally used in the authentication challenge corresponded to the correct IMSI. </action> </control> <control> <condition> Upon receipt of the IDENTITY REQUEST message from the network, </condition> <action> the UE shall send the IDENTITY RESPONSE message. </action> </control>
NOTE 1: <control> <condition> <condition> Upon receipt of an AUTHENTICATION FAILURE message from the UE </condition> <condition> with EMM cause #20 "MAC failure", </condition> </condition> <action> the network may also terminate the authentication procedure (see subclause 5.4.2.5). </action> </control>
<control> <condition> If the GUTI/IMSI mapping in the network was incorrect, </condition> <action> the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. </action> </control> <control> <condition> Upon receiving the new AUTHENTICATION REQUEST message from the network, </condition> <control> <action> the UE shall stop the timer T3418, </action> <condition> if running, </condition> </control> and <action> then process the challenge information as normal. </action> </control> <control> <condition> If the GUTI/IMSI mapping in the network was correct, </condition> <action> the network should terminate the authentication procedure </action> <action> by sending an AUTHENTICATION REJECT message (see subclause 5.4.2.5). </action> </control>
<control> <condition> <condition> If the network is validated successfully </condition> ( <condition> an AUTHENTICATION REQUEST message that contains a valid SQN and MAC is received </condition> ), </condition> <action> the UE shall send the AUTHENTICATION RESPONSE message to the network </action> and <control> <action> shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) </action> <condition> if they were running </condition> </control> and <control> <action> stopped </action> <condition> when the UE received the first failed AUTHENTICATION REQUEST message. </condition> </control> </control>
<control> <condition> <condition> <condition> If the UE receives the second AUTHENTICATION REQUEST message </condition> <condition> while T3418 is running, </condition> </condition> and <condition> the MAC value cannot be resolved, </condition> </condition> <action> the UE shall follow the procedure specified in this subclause, item c, starting again from the beginning, </action> </control> or <control> <condition> if the message contains a UMTS authentication challenge, </condition> <action> the UE shall follow the procedure specified in item d. </action> </control> <control> <condition> If the SQN is invalid, </condition> <action> the UE shall proceed as specified in item e. </action> </control>
<control> <action> The authentication challenges shall be considered as consecutive only, </action> <condition> <condition> if the authentication challenges causing the second and third authentication failure are received by the UE, </condition> <condition> while the timer T3418 or T3420 started after the previous authentication failure is running. </condition> </condition> </control>
<control> <action> The UE shall stop timer T3418, </action> <condition> <condition> if the timer is running </condition> and <condition> the UE enters EMM-IDLE mode, </condition> e.g. <condition> <condition> upon detection of a lower layer failure, </condition> <condition> release of the NAS signalling connection, </condition> or <condition> as the result of an inter-system handover to A/Gb mode or Iu mode. </condition> </condition> </condition> </control>
<control> <condition> <condition> When it has been deemed by the UE that the source of the authentication challenge is not genuine </condition> (i.e. <condition> authentication not accepted by the UE </condition> ), </condition> <action> the UE shall proceed as described in item f. </action> </control>
UE MME AUTHENTICATION REQUEST
Start T3418 Stop T3460 IDENTITY REQUEST
Start T3470 IDENTITY RESPONSE (IMSI)
Stop T3470 AUTHENTICATION REQUEST
Stop T3418 Start T3460 AUTHENTICATION RESPONSE
Stop T3460
#26 "non-EPS authentication unacceptable")
<control> d) <condition> Authentication failure (EMM cause #26 "non-EPS authentication unacceptable"): </condition> </control>
<control> <action> The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #26 "non-EPS authentication unacceptable", to the network </action> and <action> start the timer T3418 (see example in figure 5.4.2.7.1). </action> <action> Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). </action> </control> <control> <condition> <condition> Upon the first receipt of an AUTHENTICATION FAILURE message from the UE </condition> <condition> with EMM cause #26 "non-EPS authentication unacceptable", </condition> </condition> <action> the network may initiate the identification procedure described in subclause 5.4.4. </action> </control> This is to allow the network to obtain the IMSI from the UE. <control> <action> The network may then check that the GUTI originally used in the authentication challenge corresponded to the correct IMSI. </action> </control> <control> <condition> Upon receipt of the IDENTITY REQUEST message from the network, </condition> <action> the UE shall send the IDENTITY RESPONSE message. </action> </control>
NOTE 2: <control> <condition> <condition> Upon receipt of an AUTHENTICATION FAILURE message from the UE </condition> <condition> with EMM cause #26 "non- EPS authentication unacceptable", </condition> </condition> <action> the network may also terminate the authentication procedure (see subclause 5.4.2.5). </action> </control>
<control> <condition> If the GUTI/IMSI mapping in the network was incorrect, </condition> <action> the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. </action> </control> <control> <condition> Upon receiving the new AUTHENTICATION REQUEST message from the network, </condition> <control> <action> the UE shall stop the timer T3418, </action> <condition> if running, </condition> </control> and <action> then process the challenge information as normal. </action> </control> <control> <condition> If the GUTI/IMSI mapping in the network was correct, </condition> <action> the network should terminate the authentication procedure by sending an AUTHENTICATION REJECT message (see subclause 5.4.2.5). </action> </control>
<control> <action> The authentication challenges shall be considered as consecutive only, </action> <condition> <condition> if the authentication challenges causing the second and third authentication failure are received by the UE, </condition> <condition> <condition> while the timer T3418 </condition> </condition> or <condition> T3420 started after the previous authentication failure is running. </condition> </condition> </control>
<control> <control> <action> The UE shall stop timer T3420, </action> <condition> if the timer is running </condition> </control> and <action> the UE enters EMM-IDLE mode , </action> e.g. <condition> <condition> upon detection of a lower layer failure, </condition> <condition> release of the NAS signalling connection, </condition> or <condition> as the result of an inter-system handover to A/Gb mode or Iu mode. </condition> </condition> </control>
<control> <condition> <condition> When it has been deemed by the UE that the source of the authentication challenge is not genuine </condition> (i.e. <condition> authentication not accepted by the UE </condition> ), </condition> <action> the UE shall proceed as described in item f. </action> </control>
<control> e) <condition> Authentication failure (EMM cause #21 "synch failure"): </condition> </control>
<control> <action> The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #21 "synch failure", to the network </action> and <action> start the timer T3420 (see example in figure 5.4.2.7.2). </action> <action> Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). </action> </control> <control> <condition> <condition> Upon the first receipt of an AUTHENTICATION FAILURE message from the UE </condition> <condition> with the EMM cause #21 "synch failure", </condition> </condition> <action> the network shall use the returned AUTS parameter from the authentication failure parameter IE in the AUTHENTICATION FAILURE message, to re-synchronise. </action> <action> The re-synchronisation procedure requires the MME to delete all unused authentication vectors for that IMSI and obtain new vectors from the HSS. </action> </control> <control> <condition> When re-synchronisation is complete, </condition> <action> the network shall initiate the authentication procedure. </action> </control> <control> <condition> Upon receipt of the AUTHENTICATION REQUEST message, </condition> <action> the UE shall stop the timer T3420, </action> <condition> if running. </condition> </control>
NOTE 3: <control> <condition> <condition> Upon receipt of two consecutive AUTHENTICATION FAILURE messages from the UE </condition> <condition> with EMM cause #21 "synch failure", </condition> </condition> <action> the network may terminate the authentication procedure </action> <action> by sending an AUTHENTICATION REJECT message. </action> </control>
<control> <condition> <condition> If the network is validated successfully </condition> ( <condition> a new AUTHENTICATION REQUEST message is received which contains a valid SQN and MAC </condition> ) <condition> while T3420 is running, </condition> </condition> <action> the UE shall send the AUTHENTICATION RESPONSE message to the network </action> and <action> shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430), <condition> if they were running </condition> </action> and <control> <action> stopped </action> <condition> when the UE received the first failed AUTHENTICATION REQUEST message. </condition> </control> </control>
<control> <condition> <condition> <condition> If the UE receives the second AUTHENTICATION REQUEST message </condition> <condition> while T3420 is running, </condition> </condition> and <condition> the MAC value cannot be resolved, </condition> </condition> <action> the UE shall follow the procedure specified in item c </action> </control> or <control> <condition> if the message contains a UMTS authentication challenge, </condition> <action> the UE shall proceed as specified in item d; </action> </control> <control> <condition> if the SQN is invalid, </condition> <action> the UE shall follow the procedure specified in this subclause, item e, starting again from the beginning. </action> </control>
<control> <action> The authentication challenges shall be considered as consecutive </action> <condition> <condition> <condition> only if the authentication challenges causing the second and third authentication failure are received by the UE </condition> <condition> while the timer T3418 </condition> </condition> or <condition> T3420 started after the previous authentication failure is running. </condition> </condition> </control>
<control> <condition> <condition> When it has been deemed by the UE that the source of the authentication challenge is not genuine </condition> (i.e. <condition> authentication not accepted by the UE </condition> ), </condition> <action> the UE shall proceed as described in item f. </action> </control>
<control> <condition> Upon receipt of an AUTHENTICATION REJECT message, </condition> <action> the UE shall perform the actions as specified in subclause 5.4.2.5. </action> </control>
<control> f) <condition> Network failing the authentication check: </condition> </control>
<control> <condition> If the UE deems that the network has failed the authentication check, </condition> <action> then it shall request RRC to locally release the RRC connection </action> and <action> treat the active cell as barred (see 3GPP TS 36.304 ). </action> <control> <action> The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430), </action> <condition> if they were running </condition> </control> and <control> <action> stopped </action> <condition> when the UE received the first AUTHENTICATION REQUEST message containing an incorrect authentication challenge data causing the authentication failure. </condition> </control> </control>
<control> g) <condition> <condition> Transmission failure of AUTHENTICATION RESPONSE message </condition> or <condition> <condition> AUTHENTICATION FAILURE message indication from lower layers </condition> ( <condition> if the authentication procedure is triggered by a tracking area updating procedure </condition> ) </condition> : </condition> </control>
<control> <control> <action> The UE shall stop any of the timers T3418 and T3420, </action> <condition> if running, </condition> </control> and <action> re-initiate the tracking area updating procedure. </action> </control>
<control> h) <condition> <condition> Transmission failure of AUTHENTICATION RESPONSE message </condition> or <condition> <condition> AUTHENTICATION FAILURE message indication with TAI change from lower layers </condition> ( <condition> if the authentication procedure is triggered by a service request procedure </condition> ) </condition> : </condition> </control>
<control> <action> The UE shall stop any of the timers T3418 and T3420, </action> <condition> if running. </condition> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> <action> the authentication procedure shall be aborted </action> and <action> a tracking area updating procedure shall be initiated. </action> </control> <control> <condition> If the current TAI is still part of the TAI list, </condition> <action> it is up to the UE implementation how to re-run the ongoing procedure that triggered the authentication procedure. </action> </control>
<control> i) <condition> <condition> Transmission failure of AUTHENTICATION RESPONSE message </condition> or <condition> <condition> AUTHENTICATION FAILURE message indication without TAI change from lower layers </condition> ( <condition> if the authentication procedure is triggered by a service request procedure </condition> ): </condition> </condition> </control>
<control> <control> <action> The UE shall stop any of the timers T3418 and T3420, </action> <condition> if running. </condition> </control> <action> It is up to the UE implementation how to re- run the ongoing procedure that triggered the authentication procedure. </action> </control>
<control> j) <condition> Lower layers indication of non-delivered NAS PDU due to handover: </condition> </control>
<control> <condition> <condition> If the AUTHENTICATION REQUEST message could not be delivered </condition> <condition> due to an intra MME handover and the target TA is included in the TAI list, </condition> </condition> <condition> then upon successful completion of the intra MME handover </condition> <action> the MME shall retransmit the AUTHENTICATION REQUEST message. </action> </control> <control> <condition> <condition> If a failure of handover procedure is reported by the lower layer </condition> and <condition> the S1 signalling connection exists, </condition> </condition> <action> the MME shall retransmit the AUTHENTICATION REQUEST message. </action> </control>
<control> k) <condition> Change of cell into a new tracking area: </condition> </control>
<control> <condition> <condition> If a cell change into a new tracking area that is not in the TAI list occurs </condition> <condition> before the AUTHENTICATION RESPONSE message is sent, </condition> </condition> <action> the UE may discard sending the AUTHENTICATION RESPONSE message to the network </action> and <action> continue with the initiation of tracking area updating procedure as described in subclause 5.5.3. </action> </control>
For items c, d, and e:
1) <control> <condition> <condition> Depending on local requirements or operator preference for emergency bearer services, </condition> <condition> <condition> if the UE has a PDN connection for emergency bearer services established </condition> or <condition> is establishing a PDN connection for emergency bearer services, </condition> </condition> </condition> <action> the MME need not follow the procedures specified for the authentication failure specified in the present subclause. </action> <action> The MME may respond to the AUTHENTICATION FAILURE message </action> <action> by initiating the security mode control procedure </action> <action> selecting the "null integrity protection algorithm" EIA0, "null ciphering algorithm" EEA0 </action> or <action> may abort the authentication procedure </action> and <control> <action> continue using the current security context, </action> <condition> if any. </condition> </control> <control> <action> The MME shall deactivate all non-emergency EPS bearer contexts, </action> <condition> if any, </condition> <action> by initiating an EPS bearer context deactivation procedure. </action> </control> <control> <condition> If there is an ongoing PDN connectivity procedure, </condition> <action> the MME shall deactivate all non- emergency EPS bearer contexts upon completion of the PDN connectivity procedure. </action> <action> The network shall consider the UE to be attached for emergency bearer services only. </action> </control> </control>
<control> <condition> <condition> <condition> If a UE has a PDN connection for emergency bearer services established </condition> or <condition> is establishing a PDN connection for emergency bearer services </condition> and <condition> <condition> sends an AUTHENTICATION FAILURE message to the MME </condition> <condition> with the EMM cause appropriate for these cases (#20, #21, or #26, respectively) </condition> </condition> and <condition> <condition> receives the SECURITY MODE COMMAND message </condition> <condition> before the timeout of timer T3418 or T3420, </condition> </condition> </condition> </condition> <action> the UE shall deem that the network has passed the authentication check successfully, </action> <action> stop timer T3418 or T3420, respectively, </action> and <action> execute the security mode control procedure. </action> </control>
<control> <condition> <condition> If a UE has a PDN connection for emergency bearer services established </condition> or <condition> <condition> is establishing a PDN connection for emergency bearer services </condition> <condition> when timer T3418 or T3420 expires, </condition> </condition> </condition> <action> the UE shall not deem that the network has failed the authentication check </action> and <action> not behave as described in item f. </action> <control> <action> Instead the UE shall continue using the current security context, </action> <condition> if any, </condition> </control> <control> <action> deactivate all non-emergency EPS bearer contexts, </action> <condition> if any, </condition> <action> by initiating UE requested PDN disconnect procedure. </action> </control> <control> <condition> If there is an ongoing PDN connectivity procedure, </condition> <action> the UE shall deactivate all non-emergency EPS bearer contexts </action> <condition> upon completion of the PDN connectivity procedure. </condition> </control> <control> <action> The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) </action> <condition> if: <condition> a) <condition> they were running </condition> and <condition> <condition> stopped when the UE received the AUTHENTICATION REQUEST message </condition> and <condition> detected an authentication failure; </condition> </condition> </condition> <condition> b) the procedures associated with these timers have not yet been completed. </condition> </condition> </control> <action> The UE shall consider itself to be attached for emergency bearer services only. </action> </control>
2) <control> <condition> <condition> Depending on local regulation and operator policy, </condition> <condition> <condition> if the UE has a PDN connection for RLOS established </condition> or <condition> is establishing a PDN connection for RLOS, </condition> </condition> </condition> <action> the MME need not follow the procedures specified for the authentication failure specified in the present subclause. </action> <action> The MME may respond to the AUTHENTICATION FAILURE message </action> <action> by initiating the security mode control procedure selecting the "null integrity protection algorithm" EIA0, "null ciphering algorithm" EEA0 </action> or <action> may abort the authentication procedure </action> and <control> <action> continue using the current security context, </action> <condition> if any. </condition> </control> <action> The network shall consider the UE to be attached for access to RLOS. </action> </control>
<control> <condition> <condition> <condition> If a UE has a PDN connection for RLOS established </condition> or <condition> is establishing a PDN connection for RLOS </condition> </condition> and <condition> <condition> sends an AUTHENTICATION FAILURE message to the MME </condition> <condition> with the EMM cause appropriate for these cases (#20, #21, or #26, respectively) </condition> and <condition> <condition> receives the SECURITY MODE COMMAND message </condition> <condition> before the timeout of timer T3418 or T3420, </condition> </condition> </condition> </condition> <action> the UE shall deem that the network has passed the authentication check successfully, </action> <action> stop timer T3418 or T3420, respectively, </action> and <action> execute the security mode control procedure. </action> </control>
<control> <condition> <condition> If a UE has a PDN connection for RLOS established </condition> or <condition> <condition> is establishing a PDN connection for RLOS </condition> <condition> when timer T3418 or T3420 expires, </condition> </condition> </condition> <action> the UE shall not deem that the network has failed the authentication check </action> and <action> not behave as described in item f. </action> <control> <action> Instead the UE shall continue using the current security context, </action> <condition> if any. </condition> </control> <control> <action> The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) </action> <condition> if: <condition> a) <condition> they were running </condition> and <condition> <condition> stopped when the UE received the AUTHENTICATION REQUEST message </condition> and <condition> detected an authentication failure; </condition> </condition> </condition> <condition> b) the procedures associated with these timers have not yet been completed. </condition> </condition> </control> <action> The UE shall consider itself to be attached for access to RLOS. </action> </control>
5.4.3 Security mode control procedure
5.4.3.1 General
The purpose of the NAS security mode control procedure is to take an EPS security context into use, and initialise and start NAS signalling security between the UE and the MME with the corresponding EPS NAS keys and EPS security algorithms.
<control> <action> Furthermore, the network may also initiate the security mode control procedure in the following cases: </action> <condition> a) in order to change the NAS security algorithms for a current EPS security context already in use; b) in order to change the value of uplink NAS COUNT used in the latest SECURITY MODE COMPLETE message as described in 3GPP TS 33.401 , subclause 7.2.9.2; and c) in order to request the UE radio capability ID from the UE. </condition> </control>
For restrictions concerning the concurrent running of a security mode control procedure with other security related procedures in the AS or inside the core network see 3GPP TS 33.401 , subclause 7.2.10.
5.4.3.2 NAS security mode control initiation by the network
<control> <condition> The MME initiates the NAS security mode control procedure </condition> <action> by sending a SECURITY MODE COMMAND message to the UE </action> and <action> starting timer T3460 (see example in figure 5.4.3.2.1). </action> </control>
<control> <action> The MME shall reset the downlink NAS COUNT counter </action> and <action> use it to integrity protect the initial SECURITY MODE COMMAND message </action> <condition> <condition> if the security mode control procedure is initiated </condition> : <condition> a) <condition> <condition> to take into use the EPS security context created </condition> <condition> after a successful execution of the EPS authentication procedure; </condition> </condition> <condition> b) <condition> <condition> upon receipt of TRACKING AREA UPDATE REQUEST message </condition> <condition> including a GPRS ciphering key sequence number IE, </condition> </condition> <condition> <condition> if the MME wishes to create a mapped EPS security context </condition> (i.e. <condition> the type of security context flag is set to "mapped security context" in the NAS key set identifier IE included in the SECURITY MODE COMMAND message </condition> ). </condition> </condition> </condition> </condition> <action> The MME shall send the SECURITY MODE COMMAND message unciphered, </action> <action> but shall integrity protect the message with the NAS integrity key </action> <condition> based on K or mapped K' indicated by the eKSI included in the message. </condition> <action> The MME shall set the security header type of the message to "integrity protected with new EPS security context". </action> </control>
<control> <action> The MME shall create a locally generated K </action> and <action> send the SECURITY MODE COMMAND message including a KSI value in the NAS key set identifier IE set to "000" and EIA0 and EEA0 as the selected NAS security algorithms </action> <condition> <condition> only when the security mode control procedure is initiated: </condition> <condition> <condition> a) <condition> during an attach procedure for emergency bearer services </condition> <condition> if no shared EPS security context is available; </condition> </condition> <condition> b) <condition> during an attach procedure for access to RLOS </condition> <condition> if no valid EPS security context is available; </condition> </condition> <condition> c) <condition> during a tracking area updating procedure </condition> <condition> for a UE that has a PDN connection for emergency bearer services </condition> <condition> if no shared EPS security context is available; </condition> </condition> <condition> d) <condition> during a tracking area updating procedure </condition> <condition> for a UE that has a PDN connection for access to RLOS </condition> <condition> if no valid EPS security context is available; </condition> </condition> <condition> e) <condition> during a service request procedure </condition> <condition> for a UE that has a PDN connection for emergency bearer services </condition> <condition> if no shared EPS security context is available; </condition> </condition> <condition> f) <condition> during a service request procedure </condition> <condition> for a UE that has a PDN connection for access to RLOS </condition> <condition> if no valid EPS security context is available; </condition> </condition> <condition> g) <condition> after a failed authentication procedure </condition> <condition> <condition> for a UE that has a PDN connection for emergency bearer services </condition> or <condition> that is establishing a PDN connection for emergency bearer services, </condition> </condition> <condition> if continued usage of a shared security context is not possible; </condition> </condition> or <condition> h) <condition> after a failed authentication procedure </condition> <condition> <condition> for a UE that has a PDN connection for access to RLOS </condition> or <condition> that is establishing a PDN connection for access to RLOS, </condition> </condition> <condition> if continued usage of a valid security context is not possible. </condition> </condition> </condition> </condition> </control>
<control> <action> The UE shall process a SECURITY MODE COMMAND message </action> <condition> including a KSI value in the NAS key set identifier IE set to "000" and EIA0 and EEA0 as the selected NAS security algorithms </condition> and, <control> <condition> if accepted, </condition> <action> create a locally generated K </action> <condition> when the security mode control procedure is initiated: </condition> </control> <condition> <condition> a) during an attach procedure for emergency bearer services; </condition> <condition> b) during an attach procedure for access to RLOS; </condition> <condition> c) <condition> during a tracking area updating procedure </condition> <condition> when the UE has a PDN connection for emergency bearer services; </condition> </condition> <condition> d) <condition> during a tracking area updating procedure </condition> <condition> when the UE has a PDN connection for access to RLOS; </condition> </condition> <condition> e) <condition> during a service request procedure </condition> <condition> when the UE has a PDN connection for emergency bearer services; </condition> </condition> <condition> f) <condition> during a service request procedure </condition> <condition> when the UE has a PDN connection for access to RLOS; </condition> </condition> <condition> g) <condition> after an authentication procedure </condition> <condition> <condition> when the UE has a PDN connection for emergency bearer services </condition> or <condition> is establishing a PDN connection for emergency bearer services; </condition> </condition> </condition> or <condition> h) <condition> after an authentication procedure </condition> <condition> <condition> when the UE has a PDN connection for access to RLOS </condition> or <condition> is establishing a PDN connection for access to RLOS. </condition> </condition> </condition> </condition> </control>
NOTE 1: The process for creation of the locally generated K by the MME and the UE is implementation dependent.
<control> <condition> <condition> Upon receipt of a TRACKING AREA UPDATE REQUEST message </condition> <condition> including a GPRS ciphering key sequence number IE, </condition> <condition> if the MME does not have the valid current EPS security context indicated by the UE, </condition> </condition> the MME shall either: <action> a) indicate the use of the new mapped EPS security context to the UE by setting the type of security context flag in the NAS key set identifier IE to "mapped security context" </action> and <action> the KSI value related to the security context of the source system; </action> or <control> b) <action> set the KSI value "000" in the NAS key set identifier IE </action> <condition> <condition> if the MME sets EIA0 and EEA0 as the selected NAS security algorithms </condition> <condition> for a UE that has a PDN connection for emergency bearer services. </condition> </condition> </control> </control>
<control> <condition> <condition> While having a current mapped EPS security context with the UE, </condition> <condition> if the MME wants to take the native EPS security context into use, </condition> </condition> <action> the MME shall include the eKSI that indicates the native EPS security context in the SECURITY MODE COMMAND message. </action> </control>
<control> <action> The MME shall include the replayed security capabilities of the UE (including the security capabilities with regard to NAS, RRC and UP (user plane) ciphering as well as NAS and RRC integrity, and other possible target network security capabilities, i.e. UTRAN/GERAN if the UE included them in the message to network),the replayed nonce </action> <condition> when UE creating a mapped EPS security context </condition> and <condition> if the UE included it in the message to the network, the selected NAS ciphering and integrity algorithms and the Key Set Identifier (eKSI). </condition> </control> <control> <condition> <condition> If the MME supports handling of UE additional security capabilities </condition> and <condition> the UE included a UE additional security capability IE in the message to the network, </condition> </condition> <action> the MME shall include the replayed additional security capabilities of the UE. </action> </control>
<control> <action> The MME shall include both the nonce and the nonce </action> <condition> <condition> when creating a mapped EPS security context </condition> <condition> during inter- MME UE system change from A/Gb mode to S1 mode or Iu mode to S1 mode </condition> <condition> in EMM-IDLE mode. </condition> </condition> </control>
<control> <action> The MME may initiate a SECURITY MODE COMMAND </action> <condition> in order to change the NAS security algorithms for a current EPS security context already in use. </condition> <action> The MME re-derives the NAS keys from K with the new NAS algorithm identities as input </action> and <action> provides the new NAS algorithm identities within the SECURITY MODE COMMAND message. </action> <action> The MME shall set the security header type of the message to "integrity protected with new EPS security context". </action> </control>
<control> <condition> If, <condition> during an ongoing attach or tracking area updating procedure, </condition> <condition> <condition> the MME is initiating a SECURITY MODE COMMAND </condition> (i.e. <condition> after receiving the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message, </condition> but <condition> before sending a response to that message </condition> ) </condition> and <condition> <condition> the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message is received without integrity protection </condition> or <condition> does not successfully pass the integrity check at the MME, </condition> </condition> </condition> <action> the MME shall calculate the HASH of the entire plain ATTACH REQUEST or TRACKING AREA UPDATE REQUEST MME message as described in 3GPP TS 33.401 </action> and <action> shall include the HASH in the SECURITY MODE COMMAND MME message. </action> <action> Additionally, the MME may request the UE to include its IMEISV in the SECURITY MODE COMPLETE message. </action> </control>
NOTE 2: The AS and NAS security capabilities will be the same, i.e. if the UE supports one algorithm for NAS, the same algorithm is also supported for AS.
<control> <condition> If: <condition> a) <condition> the NAS security mode control procedure is initiated during an ongoing attach procedure </condition> <condition> in WB-S1 mode; </condition> </condition> <condition> b) the network supports RACS; </condition> <condition> c) the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message; </condition> and <condition> d) the UE has set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the ATTACH REQUEST message, </condition> </condition> <action> then the MME shall request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message. </action> </control>
<control> <condition> If: <condition> a) <condition> the NAS security mode control procedure is initiated </condition> <condition> during an ongoing tracking area updating procedure </condition> <condition> in WB-S1 mode; </condition> </condition> <condition> b) the network supports RACS; </condition> <condition> c) the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message; </condition> and <condition> d) the UE has set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message, </condition> </condition> <action> then the MME may request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message. </action> </control>
<control> <condition> If: <condition> a) <condition> the NAS security mode control procedure is initiated </condition> <condition> during an ongoing tracking area updating procedure </condition> <condition> in WB-S1 mode; </condition> </condition> <condition> b) the network supports RACS; </condition> <condition> c) the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UDPATE REQUEST message; </condition> <condition> d) the UE has set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message; </condition> and <condition> e) no UE radio capability ID is available in the UE context in the MME, </condition> </condition> <action> then the MME shall request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message. </action> </control>
5.4.3.3 NAS security mode command accepted by the UE
<control> <condition> Upon receipt of the SECURITY MODE COMMAND message, </condition> <action> the UE shall check whether the security mode command can be accepted or not. </action> <condition> This is done <condition> by performing the integrity check of the message </condition> and <condition> by checking that the received replayed UE security capabilities, the received replayed UE additional security capabilities, if included in the SECURITY MODE COMMAND message, and the received nonce have not been altered compared to the latest UE values that the UE sent to the network. </condition> </condition> <control> <action> However, the UE is not required to perform the checking of the received nonce </action> <condition> if the UE does not want to re-generate the K' </condition> (i.e. the SECURITY MODE COMMAND message is to UE derive and take into use a mapped EPS security context and the eKSI matches the current EPS security context, if it is a mapped EPS security context). </control> <control> <condition> <condition> When the UE has a PDN connection for emergency bearer services established </condition> or <condition> the UE is establishing a PDN connection for emergency bearer services </condition> or <condition> the UE is requesting attach for access to RLOS, </condition> </condition> <action> the UE is not required to locally re-generate the K (i.e. the SECURITY MODE COMMAND message is used to derive and take into use a native EPS security context where the KSI value "000" is included in the NAS key set identifier IE and the EIA0 and EEA0 are included as the selected NAS security algorithms). </action> </control> </control>
<control> <action> The UE shall accept a SECURITY MODE COMMAND message </action> <condition> indicating the "null integrity protection algorithm" EIA0 as the selected NAS integrity algorithm </condition> <condition> only if <condition> the message is received for a UE that has a PDN connection for emergency bearer services established, </condition> or <condition> a UE that is attached for access to RLOS, </condition> or <condition> a UE that is establishing a PDN connection for emergency bearer services </condition> or <condition> a UE that is requesting attach for access to RLOS. </condition> </condition> </control>
<control> <condition> <condition> If the type of security context flag included in the SECURITY MODE COMMAND message is set to "native security context" </condition> and <condition> if the KSI matches a valid non-current native EPS security context held in the UE while the UE has a mapped EPS security context as the current EPS security context, </condition> </condition> <action> the UE shall take the non-current native EPS security context into use which then becomes the current native EPS security context <action> and </action> delete the mapped EPS security context. </action> </control>
<control> <condition> If the SECURITY MODE COMMAND message can be accepted, </condition> <action> the UE shall take the EPS security context indicated in the message into use. </action> <control> <action> The UE shall in addition reset the uplink NAS COUNT counter </action> <condition> if: <condition> a) <condition> the SECURITY MODE COMMAND message is received in order to take an EPS security context into use created </condition> <condition> after a successful execution of the EPS authentication procedure; </condition> </condition> <condition> b) <condition> the SECURITY MODE COMMAND message received includes the type of security context flag set to "mapped security context" in the NAS key set identifier IE </condition> <condition> the eKSI does not match the current EPS security context, </condition> <condition> if it is a mapped EPS security context. </condition> </condition> </condition> </control> </control>
<control> <condition> <condition> If the SECURITY MODE COMMAND message can be accepted </condition> and <condition> a new EPS security context is taken into use </condition> and <condition> SECURITY MODE COMMAND message does not indicate the "null integrity protection algorithm" EIA0 as the selected NAS integrity algorithm, </condition> </condition> the UE shall: <control> a) <condition> if the SECURITY MODE COMMAND message has been successfully integrity checked using an estimated downlink NAS COUNT equal 0, </condition> <action> then the UE shall set the downlink NAS COUNT of this new EPS security context to 0; </action> </control> <control> b) <condition> otherwise </condition> <action> the UE shall set the downlink NAS COUNT of this new EPS security context to the downlink NAS COUNT that has been used for the successful integrity checking of the SECURITY MODE COMMAND message. </action> </control> </control>
<control> <condition> If the SECURITY MODE COMMAND message can be accepted, </condition> <action> the UE shall send a SECURITY MODE COMPLETE message integrity protected with the selected NAS integrity algorithm and the EPS NAS integrity key </action> <condition> <condition> based on the K or mapped K' </condition> <condition> if the type of security context flag is set to "mapped security context" indicated by the eKSI. </condition> </condition> </control> <control> <condition> When the SECURITY MODE COMMAND message includes the type of security context flag set to "mapped security context" in the NAS key set identifier IE, the nonce and the nonce , </condition> then the UE shall either: <action> a) generate K' from both the nonce and the nonce as indicated in 3GPP TS 33.401 ;or </action> <control> b) <action> check whether the SECURITY MODE COMMAND message indicates the eKSI of the current EPS security context, </action> <condition> if it is a mapped EPS security context, in order not to re-generate the K' . </condition> </control> </control>
<control> <condition> Furthermore, if the SECURITY MODE COMMAND message can be accepted, </condition> <action> the UE shall cipher the SECURITY MODE COMPLETE message with the selected NAS ciphering algorithm and the EPS NAS ciphering key based on the K or mapped K' indicated by the eKSI. </action> <action> The UE shall set the security header type of the message to "integrity protected and ciphered with new EPS security context". </action> <action> From this time onward the UE shall cipher and integrity protect all NAS signalling messages with the selected NAS ciphering and NAS integrity algorithms. </action> </control>
<control> <condition> If the MME indicated in the SECURITY MODE COMMAND message that the IMEISV is requested, </condition> <action> the UE shall include its IMEISV in the SECURITY MODE COMPLETE message. </action> </control>
<control> <condition> <condition> In WB-S1 mode, </condition> <condition> if the MME indicated in the SECURITY MODE COMMAND message that the UE radio capability ID is requested, </condition> </condition> the UE shall: <control> a) <condition> if the UE has an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN, </condition> <action> include the applicable network-assigned UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message; </action> </control> and <control> b) <condition> if the UE: <condition> a) does not have an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN; </condition> and <condition> b) has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration, </condition> </condition> <action> include the applicable manufacturer-assigned UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message. </action> </control> </control>
<control> <condition> If, <condition> during an ongoing attach or tracking area updating procedure, </condition> <condition> the SECURITY MODE COMMAND message includes a HASH , </condition> </condition> <action> the UE shall compare HASH with a hash value locally calculated as described in 3GPP TS 33.401 from the entire plain ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message that the UE had sent to initiate the procedure. </action> </control> <control> <condition> If HASH and the locally calculated hash value are different, </condition> <action> the UE shall include the complete ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message which the UE had previously sent in the Replayed NAS message container IE of the SECURITY MODE COMPLETE message. </action> </control>
5.4.3.4 NAS security mode control completion by the network
<control> <condition> The MME shall, upon receipt of the SECURITY MODE COMPLETE message, </condition> <action> stop timer T3460. </action> From this time onward <action> the MME shall integrity protect and encipher all signalling messages with the selected NAS integrity and ciphering algorithms. </action> </control>
<control> <condition> <condition> If the SECURITY MODE COMPLETE message contains a Replayed NAS container message IE </condition> <condition> with an ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message, </condition> </condition> <action> the MME shall complete the ongoing attach or tracking area updating procedure by considering the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message contained in the Replayed NAS message container IE as the message that triggered the procedure. </action> </control>
5.4.3.5 NAS security mode command not accepted by the UE
<control> <condition> If the security mode command cannot be accepted, </condition> <action> the UE shall send a SECURITY MODE REJECT message. </action> <action> The SECURITY MODE REJECT message contains an EMM cause that typically indicates one of the following cause values: #23: UE security capabilities mismatch; #24: security mode rejected, unspecified. </action> </control>
<control> <condition> Upon receipt of the SECURITY MODE REJECT message, </condition> <action> the MME shall stop timer T3460. </action> <action> The MME shall also abort the ongoing procedure that triggered the initiation of the NAS security mode control procedure. </action> </control>
<control> <action> Both the UE and the MME shall apply the EPS security context in use </action> <condition> <condition> before the initiation of the security mode control procedure, if any, </condition> <condition> to protect the SECURITY MODE REJECT message and any other subsequent messages according to the rules in subclauses 4.4.4 and 4.4.5. </condition> </condition> </control>
5.4.3.6 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> a) <condition> <condition> Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication from lower layers </condition> ( <condition> if the security mode control procedure is triggered by a tracking area updating procedure </condition> ): </condition> </control>
<control> <action> The UE shall abort the security mode control procedure and re-initiate the tracking area updating procedure. </action> </control>
<control> b) <condition> <condition> Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication with TAI change from lower layers </condition> ( <condition> if the security mode control procedure is triggered by a service request procedure </condition> ): </condition> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> <action> the security mode control procedure shall be aborted and a tracking area updating procedure shall be initiated. </action> </control>
<control> <condition> If the current TAI is still part of the TAI list, </condition> <action> the security mode control procedure shall be aborted </action> and <action> it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure. </action> </control>
<control> c) <condition> <condition> Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication without TAI change from lower layers </condition> ( <condition> if the security mode control procedure is triggered by a service request procedure </condition> ): </condition> </control>
<control> <action> The security mode control procedure shall be aborted </action> and <action> it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure. </action> </control>
5.4.3.7 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> a) <condition> Lower layer failure before the SECURITY MODE COMPLETE or SECURITY MODE REJECT message is received: </condition> </control>
<control> <action> The network shall abort the security mode control procedure. </action> </control>
<control> b) <condition> Expiry of timer T3460: </condition> </control>
<control> <condition> The network shall, on the first expiry of the timer T3460, </condition> <action> retransmit the SECURITY MODE COMMAND message </action> and <action> shall reset </action> and <action> start timer T3460. </action> </control> <control> <action> This retransmission is repeated four times, </action> <control> <condition> i.e. on the fifth expiry of timer T3460, </condition> <action> the procedure shall be aborted. </action> </control> </control>
NOTE: <control> <condition> <condition> If the SECURITY MODE COMMAND message was sent to create a mapped EPS security context </condition> <condition> during inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode, </condition> </condition> <action> then the network does not generate new values for the nonce and the nonce , </action> but <action> includes the same values in the MME UE SECURITY MODE COMMAND message (see the subclause 7.2.4.4 in 3GPP TS 33.401 ). </action> </control>
<control> c) <condition> Collision between security mode control procedure and attach, service request, tracking area updating procedure or detach procedure not indicating switch off: </condition> </control>
<control> <action> The network shall abort the security mode control procedure </action> and <action> proceed with the UE initiated procedure. </action> </control>
<control> d) <condition> Collision between security mode control procedure and other EMM procedures than in item c: </condition> </control>
<control> <action> The network shall progress both procedures. </action> </control>
<control> e) <condition> Lower layers indication of non-delivered NAS PDU due to handover: </condition> </control>
<control> <condition> <condition> <condition> If the SECURITY MODE COMMAND message could not be delivered </condition> <condition> due to an intra MME handover </condition> </condition> and <condition> the target TA is included in the TAI list, </condition> <condition> then upon successful completion of the intra MME handover </condition> </condition> <action> the MME shall retransmit the SECURITY MODE COMMAND message. </action> </control> <control> <condition> If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, </condition> <action> the MME shall retransmit the SECURITY MODE COMMAND message. </action> </control>
5.4.4 Identification procedure
5.4.4.1 General
The identification procedure is used by the network to request a particular UE to provide specific identification parameters, e.g. the International Mobile Subscriber Identity (IMSI) or the International Mobile Equipment Identity (IMEI). IMEI and IMSI definition and structure are specified in 3GPP TS 23.003 .
For mobile device supporting both 3GPP access and cdma2000 access a single IMEI is used to identify the device as specified in 3GPP TS 22.278 .
5.4.4.2 Identification initiation by the network
<control> <condition> The network initiates the identification procedure </condition> <action> by sending an IDENTITY REQUEST message to the UE </action> and <action> starting the timer T3470 (see example in figure 5.4.4.2.1). </action> <action> The IDENTITY REQUEST message specifies the requested identification parameters in the Identity type information element. </action> </control>
5.4.4.3 Identification response by the UE
<control> <action> A UE shall be ready to respond to an IDENTITY REQUEST message </action> <condition> at any time whilst in EMM-CONNECTED mode. </condition> </control>
<control> <condition> Upon receipt of the IDENTITY REQUEST message </condition> <action> the UE shall send an IDENTITY RESPONSE message to the network. </action> <action> The IDENTITY RESPONSE message shall contain the identification parameters as requested by the network. </action> </control>
5.4.4.4 Identification completion by the network
<control> <condition> Upon receipt of the IDENTITY RESPONSE </condition> <action> the network shall stop the timer T3470. </action> </control>
5.4.4.5 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a)Requested identity is not available: </condition> </control>
<control> <condition> <condition> If the UE cannot encode the requested identity in the IDENTITY RESPONSE message, </condition> <condition> e.g. because no valid USIM is available, </condition> </condition> <action> then it shall encode the identity type as "no identity". </action> </control>
<control> <condition> b) Transmission failure of IDENTITY RESPONSE message indication from lower layers </condition> </control>
<control> <condition> (if the identification procedure is triggered by a tracking area updating procedure): </condition> <action> The UE shall abort the identification procedure </action> and <action> re-initiate the tracking area updating procedure. </action> </control>
<control> <condition> c) <condition> Transmission failure of IDENTITY RESPONSE message indication <condition> with TAI change </condition> from lower layers </condition> <condition> (if the identification procedure is triggered by a service request procedure): </condition> </condition> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> <action> the identification procedure shall be aborted </action> and <action> a tracking area updating procedure shall be initiated. </action> </control>
<control> <condition> If the current TAI is still part of the TAI list, </condition> <action> the identification procedure shall be aborted </action> and <action> it is up to the UE implementation how to re-run the ongoing procedure that triggered the identification procedure. </action> </control>
<control> <condition> d) <condition> Transmission failure of IDENTITY RESPONSE message indication <condition> without TAI change </condition> from lower layers </condition> <condition> (if the identification procedure is triggered by a service request procedure): </condition> </condition> </control>
<control> <action> The identification procedure shall be aborted </action> and <action> it is up to the UE implementation how to re-run the ongoing procedure that triggered the identification procedure. </action> </control>
5.4.4.6 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) Lower layer failure: </condition> </control>
<control> <condition> <condition> Upon detection of a lower layer failure </condition> <condition> before the IDENTITY RESPONSE is received, </condition> </condition> <action> the network shall abort any ongoing EMM procedure. </action> </control>
<control> <condition> b) Expiry of timer T3470: </condition> </control>
<control> The identification procedure is supervised by the network by the timer T3470. <control> The network shall, <condition> on the first expiry of the timer T3470, </condition> <action> retransmit the IDENTITY REQUEST message </action> and <action> reset </action> and <action> restart the timer T3470. </action> </control> <action> This retransmission is repeated four times, </action> <control> <condition> i.e. on the fifth expiry of timer T3470, </condition> <action> the network shall abort the identification procedure and any ongoing EMM procedure. </action> </control> </control>
<control> <condition> c) Collision of an identification procedure with an attach procedure: </condition> </control>
<control> <condition> <condition> If the network receives an ATTACH REQUEST message </condition> <condition> before the ongoing identification procedure has been completed </condition> and <condition> no attach procedure is pending on the network </condition> (i.e. <condition> no ATTACH ACCEPT/REJECT message has still to be sent as an answer to an ATTACH REQUEST message </condition> ), </condition> <action> the network shall proceed with the attach procedure. </action> </control>
<control> <condition> d)Collision of an identification procedure with an attach procedure </condition> </control>
<control> <condition> when the identification procedure has been caused by an attach procedure: </condition> <condition> <condition> If the network receives an ATTACH REQUEST message </condition> <condition> before the ongoing identification procedure has been completed </condition> and <condition> an attach procedure is pending </condition> (i.e. <condition> an ATTACH ACCEPT/REJECT message has to be sent as an answer to an earlier ATTACH REQUEST message </condition> ), </condition> then: <control> <condition> a) If one or more of the information elements in the ATTACH REQUEST message differ from the ones received within the previous ATTACH REQUEST message, </condition> <action> the network shall proceed with the new attach procedure; </action> </control> or <control> <condition> b) If the information elements do not differ, </condition> <action> then the network shall not treat any further this new ATTACH REQUEST. </action> </control> </control>
<control> <condition> e) Collision of an identification procedure with a UE initiated detach procedure: </condition> </control>
<control> <condition> <condition> Detach containing cause "switch off" within the Detach type IE: </condition> <condition> If the network receives a DETACH REQUEST message </condition> <condition> before the ongoing identification procedure has been completed, </condition> </condition> <action> the network shall abort the identification procedure </action> and <action> shall progress the detach procedure. </action> </control> <control> <condition> <condition> Detach containing other causes than "switch off" within the Detach type IE: </condition> <condition> If the network receives a DETACH REQUEST message </condition> <condition> before the ongoing identification procedure has been completed, </condition> </condition> <action> the network shall complete the identification procedure </action> and <action> shall respond to the detach procedure as described in subclause 5.5.2. </action> </control>
<control> <condition> f) Collision of an identification procedure with a tracking area updating procedure: </condition> </control>
<control> <condition> <condition> If the network receives a TRACKING AREA UPDATE REQUEST message </condition> <condition> before the ongoing identification procedure has been completed, </condition> </condition> <action> the network shall progress both procedures. </action> </control>
<control> <condition> g) Collision of an identification procedure with a service request procedure: </condition> </control>
<control> <condition> <condition> If the network receives an EXTENDED SERVICE REQUEST message </condition> <condition> for CS fallback or 1xCS fallback </condition> <condition> before the ongoing identification procedure has been completed, </condition> </condition> <action> the network shall progress both procedures. </action> </control>
<control> <condition> h)Lower layers indication of non-delivered NAS PDU due to handover: </condition> </control>
<control> <condition> <condition> If the IDENTITY REQUEST message could not be delivered </condition> <condition> due to an intra MME handover </condition> <condition> and </condition> <condition> the target TA is included in the TAI list, </condition> <condition> then upon successful completion of the intra MME handover </condition> </condition> <action> the MME shall retransmit the IDENTITY REQUEST message. </action> </control> <control> <condition> <condition> If a failure of the handover procedure is reported by the lower layer </condition> and <condition> the S1 signalling connection exists, </condition> </condition> <action> the MME shall retransmit the IDENTITY REQUEST message. </action> </control>
5.4.5 EMM information procedure
5.4.5.1 General
The purpose of sending the EMM INFORMATION message is to allow the network to provide information to the UE.
The message implementation is optional in the network. The UE may use the received information if the UE supports implementing this message.
<control> <action> The EMM information procedure may be invoked by the network </action> <condition> at any time during an established EMM context. </condition> </control>
5.4.5.2 EMM information procedure initiation by the network
The EMM information procedure consists only of the EMM INFORMATION message sent from the network to the UE (see example in figure 5.4.5.2.1). <control> <condition> During an established EMM context, </condition> <action> the network may send none, one, or more EMM INFORMATION messages to the UE. </action> </control> <control> <condition> If more than one EMM INFORMATION message is sent, </condition> <action> the messages need not have the same content. </action> </control>
5.4.5.3 EMM information procedure in the UE
<control> <condition> <condition> When the UE (supporting the EMM information message) </condition> <condition> receives an EMM INFORMATION message , </condition> </condition> <action> it shall accept the message </action> and <action> optionally use the contents to update appropriate information stored within the UE. </action> </control>
<control> <condition> If the UE does not support the EMM information message </condition> <action> the UE shall ignore the contents of the message </action> and <action> return an EMM STATUS message with EMM cause #97 "message type non-existent or not implemented". </action> </control>
5.4.5.4 Abnormal cases on the network side
The following abnormal case can be identified:
<control> <condition> a)Lower layers indication of non-delivered NAS PDU due to handover: </condition> </control>
<control> <condition> <condition> If the EMM INFORMATION message could not be delivered </condition> <condition> due to an intra MME handover </condition> and <condition> the target TA is included in the TAI list, </condition> <condition> then upon successful completion of the intra MME handover </condition> </condition> <action> the MME shall retransmit the EMM INFORMATION message. </action> </control> <control> <condition> <condition> If a failure of the handover procedure is reported by the lower layer </condition> and <condition> the S1 signalling connection exists, </condition> </condition> <action> the MME shall retransmit the EMM INFORMATION message. </action> </control>
5.5 EMM specific procedures
5.5.1 Attach procedure
5.5.1.1 General
The attach procedure is used to attach to an EPC for packet services in EPS.
The attach procedure is used for the following purposes: a) by a UE in PS mode of operation to attach for EPS services only; b) by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for both EPS and non-EPS services; c) by a UE supporting NB-S1 mode only in PS mode of operation to attach for EPS services and "SMS only"; d) to attach for emergency bearer services; or e) an attach for access to RLOS.
The lower layers indicate to NAS that the network does not support emergency bearer services for the UE in limited service state (3GPP TS 36.331 ). This information is taken into account when deciding whether to initiate attach for emergency bearer services in WB-S1 mode.
<control> <condition> If the MME does not support an attach for emergency bearer services, </condition> <action> the MME shall reject any request to attach </action> <condition> with an attach type set to "EPS emergency attach". </condition> </control>
The lower layers may indicate to NAS whether the network supports access to RLOS (3GPP TS 36.331 ). This information is taken into account when deciding whether to initiate attach for access to RLOS in WB-S1 mode.
<control> <condition> With a successful attach procedure, </condition> <action> a context is established for the UE in the MME. </action> <control> Furthermore, <condition> if the UE requested PDN connectivity, </condition> <action> a default bearer is established between the UE and the PDN GW, </action> <action> thus enabling always-on IP connectivity to the UE. </action> </control> <control> <condition> In WB-S1 mode, </condition> <action> the network may also initiate the activation of dedicated bearers as part of the attach procedure. </action> </control> <control> <condition> In NB-S1 mode </condition> <action> the network shall not initiate the activation of dedicated bearers. </action> </control> </control>
<control> <condition> <condition> With a successful attach procedure </condition> <condition> in NB-S1 mode, </condition> </condition> <action> a context is established for the UE in the MME. </action> <control> <condition> If the attach request included information to request PDN connectivity, </condition> <action> a default bearer is also established between the UE and the PDN. </action> </control> </control>
<control> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> <action> a default bearer need not be requested by the UE during the attach procedure. </action> </control> <control> <condition> If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> <action> then the UE shall request establishment of a default bearer. </action> </control>
<control> <condition> <condition> During the attach procedure </condition> <condition> with default bearer establishment, </condition> </condition> <action> the UE may also obtain the home agent IPv4 or IPv6 address or both. </action> </control>
<control> <condition> In a shared network, </condition> <action> the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 . </action> <action> The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received for this PLMN identity as part of the broadcast system information. </action> <action> The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP TS 36.331 ). </action> <control> <condition> Whenever an ATTACH REJECT message with the EMM cause #11 "PLMN not allowed" is received by the UE, </condition> <action> the chosen PLMN identity shall be stored in the "forbidden PLMN list" </action> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. </action> </control> </control> <control> <condition> Whenever an ATTACH REJECT message with the EMM cause #14 "EPS services not allowed in this PLMN" is received by the UE, </condition> <action> the chosen PLMN identity shall be stored in the "forbidden PLMNs for GPRS service" </action> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. </action> </control> </control> <control> <condition> Whenever an ATTACH REJECT message is received by the UE with the EMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking area", </condition> <action> the constructed TAI shall be stored in the suitable list. </action> </control> </control>
<control> <action> Additionally the attach attempt counter shall be reset </action> <start_state> when the UE is in substate EMM- DEREGISTERED.ATTEMPTING-TO-ATTACH </start_state> and: <condition> <condition> a) a new tracking area is entered; </condition> <condition> b) timer T3402 expires; </condition> or <condition> c) timer T3346 is started. </condition> </condition> </control>
5.5.1.2 Attach procedure for EPS services
5.5.1.2.1 General
<control> This procedure can be used by a UE to attach for: a) EPS services only; or b) EPS services and "SMS only" <condition> if the UE supports NB-S1 mode only. </condition> </control>
<control> <condition> When the UE initiates the attach procedure for normal service, </condition> <action> the UE shall indicate "EPS attach" in the EPS attach type IE. </action> </control>
<control> <condition> When the UE initiates the attach procedure for emergency bearer services, </condition> <action> the UE shall indicate "EPS emergency attach" in the EPS attach type IE. </action> </control> <control> <action> The attach procedure for emergency bearer services is not applicable </action> <condition> for NB-S1 mode </condition> </control>
<control> This procedure can also be used by <condition> a UE in limited service state </condition> to attach for access to RLOS. </control>
<control> <condition> When the UE initiates the attach procedure for access to RLOS, </condition> <action> the UE shall indicate "EPS RLOS attach" in the EPS attach type IE. </action> </control> <control> <action> The attach procedure for access to RLOS is not applicable </action> <condition> for NB-S1 mode (see 3GPP TS 23.401 ). </condition> </control>
5.5.1.2.2 Attach procedure initiation
<control> <start_state> In state EMM-DEREGISTERED, </start_state> <condition> the UE initiates the attach procedure </condition> <action> by sending an ATTACH REQUEST message to the MME, </action> <action> starting timer T3410 </action> and <end_state> entering state EMM-REGISTERED-INITIATED </end_state> (see example in figure 5.5.1.2.2.1). <control> <condition> If timer T3402 is currently running, </condition> <action> the UE shall stop timer T3402. </action> </control> <control> <condition> If timer T3411 is currently running, </condition> <action> the UE shall stop timer T3411. </action> </control> </control>
<control> <action> The UE shall include the IMSI in the EPS mobile identity IE in the ATTACH REQUEST message </action> <condition> <condition> if the selected PLMN is neither the registered PLMN nor in the list of equivalent PLMNs </condition> and: <condition> <condition> a) the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 or 3GPP TS 31.102 ; </condition> or <condition> b) the UE is in NB-S1 mode. </condition> </condition> </condition> </control>
<control> <condition> For all other cases, </condition> <action> the UE shall handle the EPS mobile identity IE in the ATTACH REQUEST message </action> as follows: </control>
<control> <condition> a) <condition> if the UE operating in the single-registration mode </condition> <condition> <condition> is performing an inter-system change from N1 mode to S1 mode </condition> or <condition> <condition> the UE was previously registered in N1 mode </condition> <condition> before entering state 5GMM-DEREGISTERED </condition> </condition> </condition> </condition> and: </control>
<control> 1) <condition> the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface supported" from the network and: </condition> <control> i) <condition> if the UE holds a valid GUTI, </condition> <action> the UE shall include the valid GUTI into the EPS mobile identity IE, </action> <action> include Old GUTI type IE with GUTI type set to "native GUTI" </action> and <action> include the UE status IE with a 5GMM registration status </action> set to: <control> <action> a) "UE is in 5GMM-REGISTERED state" </action> <start_state> if the UE is in 5GMM-REGISTERED state; </start_state> </control> or <control> b) <action> "UE is in 5GMM-DEREGISTERED state" </action> <start_state> if the UE is in 5GMM-DEREGISTERED state; </start_state> </control> </control> or <control> ii) <condition> if the UE does not hold a valid GUTI, </condition> <action> the UE shall include the IMSI in the EPS mobile identity IE; </action> </control> </control> or
<control> 2) <condition> the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network </condition> and: <control> <condition> i) if the UE holds a valid 5G-GUTI, </condition> <action> the UE shall include a GUTI, mapped from 5G-GUTI into the EPS mobile identity IE, </action> <action> include Old GUTI type IE with GUTI type set to "native GUTI" </action> and <action> include the UE status IE with a 5GMM registration status set to "UE is in 5GMM-DEREGISTERED state"; </action> </control> <control> <condition> ii) <condition> if the UE holds a valid GUTI </condition> and <condition> does not hold a valid 5G-GUTI, </condition> </condition> <action> the UE shall indicate the GUTI in the EPS mobile identity IE </action> and <action> include Old GUTI type IE with GUTI type set to "native GUTI"; </action> </control> or <control> <condition> iii) if the UE holds neither a valid GUTI nor a vaild 5G-GUTI, </condition> <action> the UE shall include the IMSI in the EPS mobile identity IE; </action> </control> or NOTE 1: The value of the EMM registration status included by the UE in the UE status IE is not used by the MME. </control>
<control> b) otherwise: </control>
<control> <condition> 1) if the UE supports neither A/Gb mode nor Iu mode, </condition> <action> the UE shall include in the ATTACH REQUEST message a valid GUTI together </action> <action> with the last visited registered TAI, <condition> if available. </condition> </action> <action> In addition, the UE shall include Old GUTI type IE with GUTI type set to "native GUTI". </action> <control> <condition> If there is no valid GUTI available, </condition> <action> the UE shall include the IMSI in the ATTACH REQUEST message; </action> </control> </control> or
<control> 2) <condition> If the UE supports A/Gb mode or Iu mode or both </condition> and: <control> <condition> i) <condition> if the TIN indicates "P-TMSI" </condition> and <condition> the UE holds a valid P-TMSI and RAI, </condition> </condition> <action> the UE shall map the P-TMSI and RAI into the EPS mobile identity IE, </action> and <action> include Old GUTI type IE with GUTI type set to "mapped GUTI". </action> <control> <condition> If a P-TMSI signature is associated with the P-TMSI, </condition> <action> the UE shall include it in the Old P-TMSI signature IE. </action> </control> <control> Additionally, <condition> if the UE holds a valid GUTI, </condition> <action> the UE shall indicate the GUTI in the Additional GUTI IE; </action> </control> </control> NOTE 2: The mapping of the P-TMSI and the RAI to the GUTI is specified in 3GPP TS 23.003 . <control> <condition> ii) <condition> if the TIN indicates "GUTI" or "RAT-related TMSI" </condition> and <condition> the UE holds a valid GUTI, </condition> </condition> <action> the UE shall indicate the GUTI in the EPS mobile identity IE, </action> and <action> include Old GUTI type IE with GUTI type set to "native GUTI"; </action> </control> <control> iii) <condition> if the TIN is deleted </condition> and: <control> <condition> a) the UE holds a valid GUTI, </condition> <action> the UE shall indicate the GUTI in the EPS mobile identity IE, </action> and <action> include Old GUTI type IE with GUTI type set to "native GUTI"; </action> </control> <control> <condition> b) <condition> the UE does not hold a valid GUTI </condition> but <condition> holds a valid P-TMSI and RAI, </condition> </condition> <action> the UE shall map the P-TMSI and RAI into the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "mapped GUTI". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE; </action> </control> or <control> <condition> c) the UE does not hold a valid GUTI, P-TMSI or RAI, </condition> <action> the UE shall include the IMSI in the EPS mobile identity IE; </action> </control> </control> or <control> <condition> iv) otherwise </condition> <action> the UE shall include the IMSI in the EPS mobile identity IE. </action> </control> </control>
<control> <condition> If the UE is operating in the dual-registration mode </condition> and <start_state> it is in 5GMM state 5GMM-REGISTERED, </start_state> <action> the UE shall include the UE status IE </action> <action> with the 5GMM registration status set to "UE is in 5GMM-REGISTERED state". </action> </control>
NOTE 3: The value of the EMM registration status included by the UE in the UE status IE is not used by the MME.
<control> <condition> <condition> If the UE is attaching for emergency bearer services </condition> and <condition> does not hold a valid GUTI, P-TMSI or IMSI as described above, </condition> </condition> <action> the IMEI shall be included in the EPS mobile identity IE. </action> </control>
<control> <condition> <condition> If the UE in limited service state is attaching for access to RLOS </condition> and <condition> does not hold a valid GUTI, P-TMSI or IMSI as described above, </condition> </condition> <action> the IMEI shall be included in the EPS mobile identity IE. </action> </control>
<control> <condition> <condition> If the UE supports A/Gb mode or Iu mode </condition> or <condition> if the UE needs to indicate its UE specific DRX parameter to the network, </condition> </condition> <action> the UE shall include the UE specific DRX parameter in the DRX parameter IE in the ATTACH REQUEST message. </action> </control> <control> <condition> <condition> If the UE in NB-S1 mode </condition> <condition> needs to indicate the UE specific DRX parameter in NB-S1 mode to the network, </condition> </condition> <action> it shall include the UE specific DRX parameter in NB-S1 mode in the DRX parameter in NB-S1 mode IE in the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports eDRX and requests the use of eDRX, </condition> <action> the UE shall include the extended DRX parameters IE in the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports WUS assistance, </condition> <action> then the UE shall set the WUSA bit to "WUS assistance supported" in the UE network capability IE, </action> and <control> <condition> if the UE is not attaching for emergency bearer services, </condition> <action> the UE may include its UE paging probability information in the Requested WUS assistance information IE of the ATTACH REQUEST message. </action> </control> </control>
<control> <condition> If the UE supports SRVCC to GERAN/UTRAN, </condition> <action> the UE shall set the SRVCC to GERAN/UTRAN capability bit to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported". </action> </control>
<control> <condition> If the UE supports vSRVCC from S1 mode to Iu mode, </condition> <action> then the UE shall set the H.245 after handover capability bit to "H.245 after SRVCC handover capability supported" </action> and <action> additionally set the SRVCC to GERAN/UTRAN capability bit to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported" in the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports PSM and requests the use of PSM, </condition> <action> then the UE shall include the T3324 value IE with a requested timer value in the ATTACH REQUEST message. </action> <control> <condition> <condition> When the UE includes the T3324 value IE </condition> and <condition> the UE indicates support for extended periodic timer value in the MS network feature support IE, </condition> </condition> <action> it may also include the T3412 extended value IE to request a particular T3412 value to be allocated. </action> </control> </control>
<control> <condition> If the UE supports ProSe direct discovery, </condition> <action> then the UE shall set the ProSe bit to "ProSe supported" </action> and <action> set the ProSe direct discovery bit to "ProSe direct discovery supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports ProSe direct communication, </condition> <action> then the UE shall set the ProSe bit to "ProSe supported" </action> and <action> set the ProSe direct communication bit to "ProSe direct communication supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports acting as a ProSe UE-to-network relay, </condition> <action> then the UE shall set the ProSe bit to "ProSe supported" </action> and <action> set the ProSe UE-to-network relay bit to "acting as a ProSe UE-to-network relay supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> <condition> If the UE supports NB-S1 mode, Non-IP or Ethernet PDN type, N1 mode, </condition> or <condition> if the UE supports DNS over (D)TLS (see 3GPP TS 33.501 ), </condition> </condition> <action> then the UE shall support the extended protocol configuration options IE. </action> </control>
NOTE 4: Support of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.501 .
<control> <condition> If the UE supports the extended protocol configuration options IE, </condition> <action> then the UE shall set the ePCO bit to "extended protocol configuration options supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports the restriction on use of enhanced coverage, </condition> <action> then the UE shall set the RestrictEC bit to "Restriction on use of enhanced coverage supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports the control plane data back-off timer T3448, </condition> <action> the UE shall set the CP backoff bit to "back-off timer for transport of user data via the control plane supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE is in NB-S1 mode, </condition> <action> then the UE shall set the Control plane CIoT EPS optimization bit to "Control plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control> <control> <condition> If the UE is capable of NB-N1 mode, </condition> <action> then the UE shall set the Control plane CIoT 5GS optimization bit to "Control plane CIoT 5GS optimization supported" in the N1 UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> <condition> If the UE is in NB-S1 mode, </condition> <condition> supports NB-S1 mode only, </condition> and <condition> requests to attach for EPS services and "SMS only", </condition> </condition> <action> the UE shall indicate the SMS only requested bit to "SMS only" in the additional update type IE </action> and <action> shall set the EPS attach type IE to "EPS attach" in the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports CIoT EPS optimizations, </condition> <action> it shall indicate in the UE network capability IE of the ATTACH REQUEST message whether it supports EMM-REGISTERED without PDN connection. </action> </control>
<control> <condition> <condition> If the UE supports S1-U data transfer and multiple user plane radio bearers (see 3GPP TS 36.306 , 3GPP TS 36.331 ) </condition> <condition> in NB-S1 mode, </condition> </condition> <action> then the UE shall set the Multiple DRB support bit to "Multiple DRB supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports control plane MT-EDT, </condition> <action> then the UE shall set the CP-MT-EDT bit to "Control plane Mobile Terminated-Early Data Transmission supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports user plane MT-EDT, </condition> <action> then the UE shall set the UP-MT-EDT bit to "User plane Mobile Terminated- Early Data Transmission supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports V2X communication over E-UTRA-PC5, </condition> <action> then the UE shall set the V2X PC5 bit to "V2X communication over E-UTRA-PC5 supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports V2X communication over NR-PC5, </condition> <action> then the UE shall set the V2X NR-PC5 bit to "V2X communication over NR-PC5 supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports service gap control, </condition> <action> then the UE shall set the SGC bit to "service gap control supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports dual connectivity with New Radio (NR), </condition> <action> then the UE shall set the DCNR bit to "dual connectivity with NR supported" in the UE network capability IE of the ATTACH REQUEST message </action> and <action> shall include the UE additional security capability IE in the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports N1 mode, </condition> <action> the UE shall set the N1mode bit to "N1 mode supported" in the UE network capability IE of the ATTACH REQUEST message </action> and <action> shall include the UE additional security capability IE in the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE supports signalling for a maximum number of 15 EPS bearer contexts, </condition> <action> then the UE shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the UE network capability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> <condition> If the UE supports ciphered broadcast assistance data </condition> and <condition> needs to obtain new ciphering keys, </condition> </condition> <action> the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the ATTACH REQUEST message. </action> </control>
<control> <condition> <condition> If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> or <condition> if the UE wants to request PDN connection with the attach procedure, </condition> </condition> <action> the UE shall send the ATTACH REQUEST message together with a PDN CONNECTIVITY REQUEST message contained in the ESM message container IE. </action> </control>
<control> <condition> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> and <condition> the UE does not want to request PDN connection with the attach procedure, </condition> </condition> <action> the UE shall send the ATTACH REQUEST message together with an ESM DUMMY MESSAGE contained in the ESM message container information element. </action> </control>
<control> <condition> <condition> In WB-S1 mode, </condition> <condition> if the UE supports RACS, </condition> </condition> the UE shall: </control>
<control> <action> a) set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message; </action> and </control>
<control> b) <condition> if the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, </condition> <action> set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the ATTACH REQUEST message. </action> </control>
<control> <condition> <condition> <condition> If the attach procedure is initiated </condition> <condition> following an inter-system change from N1 mode to S1 mode </condition> <condition> in EMM-IDLE mode </condition> </condition> or <condition> the UE <condition> which was previously registered in N1 mode </condition> <condition> before entering state 5GMM-DEREGISTERED </condition> <condition> initiates the attach procedure: </condition> </condition> </condition> </control>
<control> a) <condition> <condition> if the UE has received an "interworking without N26 interface not supported" indication from the network </condition> and <condition> a valid 5G NAS security context exists in the UE, </condition> </condition> <action> the UE shall integrity protect the ATTACH REQUEST message </action> <action> combined with the message included in the ESM message container IE </action> <action> using the 5G NAS security context; </action> </control> <control> b) <condition> otherwise: </condition> <control> 1) <condition> if a valid EPS security context exists, </condition> <action> the UE shall integrity protect the ATTACH REQUEST message </action> <action> combined with the message included in the ESM message container IE </action> <action> using the EPS security context; </action> </control> or <control> 2) <condition> if the UE does not have a valid EPS security context, </condition> <action> the ATTACH REQUEST message combined with the message included in the ESM message container IE is not integrity protected. </action> </control> </control>
5.5.1.2.3 EMM common procedure initiation
<control> <action> The network may initiate EMM common procedures, e.g. the identification, authentication and security mode control procedures </action> <condition> <condition> during the attach procedure, </condition> <condition> depending on the information received in the ATTACH REQUEST message </condition> </condition> </control>
<control> <condition> <condition> <condition> If the network receives an ATTACH REQUEST message </condition> <condition> containing the Old GUTI type IE </condition> and <condition> the EPS mobile identity IE with type of identity indicating "GUTI", </condition> </condition> and <condition> the network does not follow the use of the most significant bit of the &lt;MME group id&gt; as specified in 3GPP TS 23.003 , subclause 2.8.2.2.2, </condition> </condition> <action> the network shall use the Old GUTI type IE to determine whether the mobile identity included in the EPS mobile identity IE is a native GUTI or a mapped GUTI. </action> </control>
<control> <condition> During an attach for emergency bearer services or an attach for access to RLOS, </condition> <action> the MME may choose to skip the authentication procedure <condition> even if no EPS security context is available </condition> </action> and <action> proceed directly to the execution of the security mode control procedure as specified in subclause 5.4.3. </action> </control>
5.5.1.2.4 Attach accepted by the network
<control> <condition> During an attach for emergency bearer services, </condition> <control> <condition> if not restricted by local regulations, </condition> <action> the MME shall not check for mobility and access restrictions, regional restrictions, subscription restrictions, or perform CSG access control </action> <condition> when processing the ATTACH REQUEST message. </condition> </control> <control> <action> The network shall not apply subscribed APN based congestion control </action> <condition> during an attach procedure for emergency bearer services. </condition> </control> </control>
<control> <condition> During an attach for access to RLOS, </condition> <action> the MME shall not check for access restrictions, regional restrictions and subscription restrictions </action> <condition> when processing the ATTACH REQUEST message. </condition> </control>
<control> <condition> If the attach request is accepted by the network, </condition> <action> the MME shall send an ATTACH ACCEPT message to the UE </action> and <action> start timer T3450. </action> </control>
<control> <condition> <condition> If the attach request included the PDN CONNECTIVITY REQUEST message </condition> <condition> in the ESM message container information element </condition> <condition> to request PDN connectivity, </condition> </condition> <condition> the MME when accepting the attach request </condition> shall: <control> a) <action> send the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element </action> and <action> discard the ESM message container information element included in the attach request </action> <condition> if: <condition> a) the UE indicated support of EMM-REGISTERED without PDN connection in the UE network capability IE of the ATTACH REQUEST message; </condition> <condition> b) <condition> the MME supports EMM-REGISTERED without PDN connection </condition> and <condition> PDN connection is restricted according to the user's subscription data; </condition> </condition> <condition> c) the attach type is not set to "EPS emergency attach" or "EPS RLOS attach"; </condition> and <condition> d) the request type of the UE requested PDN connection is not set to "emergency" or "RLOS"; </condition> </condition> </control> <control> b) <condition> otherwise, </condition> <action> send the ATTACH ACCEPT message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message contained in the ESM message container information element to activate the default bearer (see subclause 6.4.1). </action> <control> <condition> In WB-S1 mode, </condition> <action> the network may also initiate the activation of dedicated bearers towards the UE by invoking the dedicated EPS bearer context activation procedure (see subclause 6.4.2). </action> </control> </control> </control>
<control> <condition> In NB-S1 mode </condition> <action> the network shall not initiate the activation of dedicated bearers. </action> </control>
<control> <condition> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> and <condition> the UE included an ESM DUMMY MESSAGE in the ESM message container information element of the ATTACH REQUEST message, </condition> </condition> <action> the MME shall send the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element. </action> </control>
<control> <condition> If the attach request is accepted by the network, </condition> <action> the MME shall delete the stored UE radio capability information or the UE radio capability ID, <condition> if any. </condition> </action> </control>
<control> <condition> In NB-S1 mode, </condition> <condition> if the attach request is accepted by the network, </condition> <action> the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the ATTACH ACCEPT message </action> <condition> to indicate that support of emergency bearer services in NB-S1 mode is not available. </condition> </control>
<control> <condition> If the UE has included the UE network capability IE or the MS network capability IE or both in the ATTACH REQUEST message, </condition> <action> the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element. </action> </control>
NOTE 1: This information is forwarded to the new MME during inter-MME handover or to the new SGSN during inter-system handover to A/Gb mode or Iu mode.
NOTE 2: For further details concerning the handling of the MS network capability and UE network capability in the MME see also 3GPP TS 23.401 .
<control> <condition> If the UE specific DRX parameter was included in the DRX Parameter IE in the ATTACH REQUEST message, </condition> <action> the MME shall replace any stored UE specific DRX parameter with the received parameter </action> and <action> use it for the downlink transfer of signalling and user data <condition> in WB-S1 mode. </condition> </action> </control>
<control> <condition> In NB-S1 mode, </condition> <condition> if the DRX parameter in NB-S1 mode IE was included in the ATTACH REQUEST message, </condition> <action> the MME shall provide to the UE the Negotiated DRX parameter in NB-S1 mode IE in the ATTACH ACCEPT message. </action> </control>
<control> <action> The MME shall replace any stored UE specific DRX parameter <condition> in NB-S1 mode </condition> with the negotiated DRX parameter </action> and <action> use it for the downlink transfer of signalling and user data <condition> in NB-S1 mode. </condition> </action> </control>
NOTE 3: <control> <condition> In NB-S1 mode, </condition> <control> <condition> if a DRX parameter was included in the Negotiated DRX parameter in NB-S1 mode IE in the ATTACH ACCEPT message, </condition> <action> then the UE stores and uses the received DRX parameter in NB-S1 mode (see 3GPP TS 36.304 ). </action> </control> <control> <condition> <condition> If the UE did not receive a DRX parameter in the Negotiated DRX parameter in NB-S1 mode IE, </condition> or <condition> if the Negotiated DRX parameter in NB-S1 mode IE was not included in the ATTACH ACCEPT message, </condition> </condition> <action> then the UE uses the cell specific DRX value in NB-S1 mode (see 3GPP TS 36.304 ). </action> </control> </control>
<control> <condition> In NB-S1 mode, </condition> <condition> <condition> if the UE requested "SMS only" in the Additional update type IE, </condition> <condition> supports NB-S1 mode only </condition> and <condition> the MME decides to accept the attach request for EPS services and "SMS only", </condition> </condition> <action> the MME shall indicate "SMS only" in the Additional update result IE </action> and <action> shall set the EPS attach result IE to "EPS only" in the ATTACH ACCEPT message. </action> </control>
<control> <action> The MME shall include the extended DRX parameters IE in the ATTACH ACCEPT message </action> <condition> <condition> only if the extended DRX parameters IE was included in the ATTACH REQUEST message, </condition> and <condition> the MME supports and accepts the use of eDRX. </condition> </condition> </control>
<control> <condition> If a) the UE supports WUS assistance; </condition> and <condition> b) the MME supports and accepts the use of WUS assistance, </condition> <action> then the MME shall determine the negotiated UE paging probability information for the UE, </action> <action> store it in the EMM context of the UE, </action> and <action> <condition> if the UE is not attaching for emergency bearer services, </condition> the MME shall include it in the Negotiated WUS assistance information IE in the ATTACH ACCEPT message. </action> <action> The MME may take into account the UE paging probability information received in the Requested WUS assistance information IE <condition> when determining the negotiated UE paging probability information for the UE. </condition> </action> </control>
NOTE 4: <control> Besides the UE paging probability information requested by the UE, the MME can take local configuration or previous statistical information for the UE into account <condition> when determining the negotiated UE paging probability information for the UE (see 3GPP TS 23.401 ). </condition> </control>
<control> <action> The MME shall assign and include the TAI list </action> <condition> the UE is registered to in the ATTACH ACCEPT message. </condition> <action> The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode. </action> </control>
<control> <condition> The UE, upon receiving an ATTACH ACCEPT message, </condition> <action> shall delete its old TAI list and store the received TAI list. </action> </control>
NOTE 5: <control> <condition> When assigning the TAI list, </condition> <action> the MME can take into account the eNodeB's capability of support of CIoT EPS optimization. </action> </control>
<control> <action> The MME may include T3412 extended value IE in the ATTACH ACCEPT message </action> <condition> only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the ATTACH REQUEST message. </condition> </control>
<control> <action> The MME shall include the T3324 value IE in the ATTACH ACCEPT message </action> <condition> only if the T3324 value IE was included in the ATTACH REQUEST message, and the MME supports and accepts the use of PSM. </condition> </control>
<control> <condition> <condition> If the MME supports and accepts the use of PSM, </condition> and <condition> the UE included the T3412 extended value IE in the ATTACH REQUEST message, </condition> </condition> <action> then the MME shall take into account the T3412 value requested </action> <condition> when providing the T3412 value IE and the T3412 extended value IE in the ATTACH ACCEPT message. </condition> </control>
NOTE 6: Besides the value requested by the UE, the MME can take local configuration or subscription data provided by the HSS into account when selecting a value for T3412 (3GPP TS 23.401 subclause 4.3.17.3).
<control> <condition> <condition> If the UE indicates support for EMM-REGISTERED without PDN connection in the ATTACH REQUEST message </condition> and <condition> the MME supports EMM-REGISTERED without PDN connection, </condition> </condition> <action> the MME shall indicate support for EMM- REGISTERED without PDN connection in the EPS network feature support IE of the ATTACH ACCEPT message. </action> </control>
The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause 5 and in clause 6.
<control> <condition> <condition> If the UE requests "control plane CIoT EPS optimization" in the Additional update type IE, </condition> <condition> indicates support of control plane CIoT EPS optimization in the UE network capability IE </condition> and <condition> the MME decides to accept the requested CIoT EPS optimization and the attach request, </condition> </condition> <action> the MME shall indicate "control plane CIoT EPS optimization supported" in the EPS network feature support IE. </action> </control>
<control> <condition> <condition> If the MME supports NB-S1 mode, Non-IP or Ethernet PDN type, inter-system change with 5GS </condition> or <condition> the network wants to enforce the use of DNS over (D)TLS (see 3GPP TS 33.501 ), </condition> </condition> <action> then the MME shall support the extended protocol configuration options IE. </action> </control>
NOTE 7: Support of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.401
<control> <condition> <condition> If the MME supports the extended protocol configuration options IE </condition> and <condition> the UE indicated support of the extended protocol configuration options IE, </condition> </condition> <action> then the MME shall set the ePCO bit to "extended protocol configuration options supported" in the EPS network feature support IE of the ATTACH ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE indicates support for restriction on use of enhanced coverage in the ATTACH REQUEST message, </condition> and <condition> the network decides to restrict the use of enhanced coverage for the UE, </condition> </condition> <action> then the MME shall set the RestrictEC bit to "Use of enhanced coverage is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE has indicated support for the control plane data back-off timer, </condition> and <condition> the MME decides to activate the congestion control for transport of user data via the control plane, </condition> </condition> <action> then the MME shall include the T3448 value IE in the ATTACH ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE indicates support for dual connectivity with NR in the ATTACH REQUEST message, </condition> and <condition> the MME decides to restrict the use of dual connectivity with NR for the UE, </condition> </condition> <action> then the MME shall set the RestrictDCNR bit to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE indicates support for N1 mode in the ATTACH REQUEST message </condition> and <condition> the MME supports inter-system interworking with 5GS, </condition> </condition> <action> the MME may set the IWK N26 bit to either: a) "interworking without N26 interface not supported" <condition> if the MME supports N26 interface; </condition> </action> or <action> b) "interworking without N26 interface supported" <condition> if the MME does not support N26 interface in the EPS network feature support IE in the ATTACH ACCEPT message. </condition> </action> </control>
<control> <condition> <condition> If the UE requests ciphering keys for ciphered broadcast assistance data in the ATTACH REQUEST message </condition> and <condition> the MME has valid ciphering key data applicable to the UE's subscription, </condition> </condition> <action> then the MME shall include the ciphering key data in the Ciphering key data IE of the ATTACH ACCEPT message. </action> </control>
<control> <condition> <condition> If due to operator policies </condition> <condition> unsecured redirection to a GERAN cell is not allowed in the current PLMN, </condition> </condition> <action> the MME shall set the redir-policy bit to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the ATTACH ACCEPT message. </action> </control>
<control> <action> The MME may include the T3447 value IE set to the service gap time value in the ATTACH ACCEPT message </action> <condition> if: <condition> a) the UE has indicated support for service gap control; </condition> and <condition> b) a service gap time value is available in the EMM context. </condition> </condition> </control>
<control> <condition> <condition> If the network supports signalling for a maximum number of 15 EPS bearer contexts </condition> and <condition> the UE indicated support of signalling for a maximum number of 15 EPS bearer contexts in the ATTACH REQUEST message, </condition> </condition> <action> then the MME shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the EPS network feature support IE of the ATTACH ACCEPT message. </action> </control>
<control> <condition> Upon receiving the ATTACH ACCEPT message, </condition> <action> the UE shall stop timer T3410. </action> </control>
The GUTI reallocation may be part of the attach procedure. <control> <condition> <condition> When the ATTACH REQUEST message includes the IMSI or IMEI, </condition> or <condition> the MME considers the GUTI provided by the UE is invalid, </condition> or <condition> the GUTI provided by the UE was assigned by another MME, </condition> </condition> <action> the MME shall allocate a new GUTI to the UE. </action> <action> The MME shall include in the ATTACH ACCEPT message the new assigned GUTI together with the assigned TAI list. </action> <end_state> In this case the MME shall enter state EMM- COMMON-PROCEDURE-INITIATED as described in subclause 5.4.1. </end_state> </control>
<control> <condition> For a shared network, </condition> <action> the TAIs included in the TAI list can contain different PLMN identities. </action> <action> The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP TS 23.251 ). </action> </control>
<control> <condition> If the ATTACH ACCEPT message contains a GUTI, </condition> <action> the UE shall use this GUTI as the new temporary identity. </action> <action> The UE shall delete its old GUTI </action> and <action> store the new assigned GUTI. </action> </control> <control> <condition> If no GUTI has been included by the MME in the ATTACH ACCEPT message, </condition> <action> the old GUTI, <condition> if any available, </condition> shall be kept. </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported in the UE, </condition> <action> the UE shall set its TIN to "GUTI" </action> <condition> when receiving the ATTACH ACCEPT message. </condition> </control>
<control> <condition> If the ATTACH ACCEPT message contains the T3412 extended value IE, </condition> <action> then the UE shall use the value in T3412 extended value IE as periodic tracking area update timer (T3412). </action> </control> <control> <condition> If the ATTACH ACCEPT message does not contain T3412 extended value IE, </condition> <action> then the UE shall use the value in T3412 value IE as periodic tracking area update timer </action> </control>
<control> <condition> If the ATTACH ACCEPT message contains the T3324 value IE, </condition> <action> then the UE shall use the included timer value for T3324 as specified in 3GPP TS 24.008 , subclause 4.7.2.8. </action> </control>
<control> <condition> If the ATTACH ACCEPT message contains the DCN-ID IE, </condition> <action> then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C. </action> </control>
<control> <action> The MME may also include a list of equivalent PLMNs in the ATTACH ACCEPT message. </action> Each entry in the list contains a PLMN code (MCC+MNC). <action> The UE shall store the list as provided by the network, </action> and <control> <condition> if the attach procedure is neither for emergency bearer services nor for access to RLOS, </condition> <action> the UE shall remove from the list any PLMN code that is already in the list of "forbidden PLMNs" or in the list of "forbidden PLMNs for GPRS service". </action> <action> In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. </action> <action> The UE shall replace the stored list on each receipt of the ATTACH ACCEPT message. </action> </control> </control> <control> <condition> If the ATTACH ACCEPT message does not contain a list, </condition> <action> then the UE shall delete the stored list. </action> </control>
<control> <condition> <condition> If the attach procedure is neither for emergency bearer services nor for access to RLOS, </condition> and <condition> if the PLMN identity of the registered PLMN is a member of the list of "forbidden PLMNs" or the list of "forbidden PLMNs for GPRS service", </condition> </condition> <action> any such PLMN identity shall be deleted from the corresponding list(s). </action> </control>
<control> <action> The network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. . </action> </control> <control> <condition> In a UE with IMS voice over PS capability, </condition> <action> the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. </action> <control> <action> The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP TS 23.221 , subclause 7.2a and subclause 7.2b, </action> <condition> when selecting the access domain for voice sessions or calls. </condition> </control> <control> <condition> When initiating an emergency call, </condition> <action> the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. </action> </control> </control> <control> <condition> In a UE with LCS capability, </condition> <action> location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. . </action> <control> <condition> When MO-LR procedure is triggered by the UE's application, </condition> <action> those indicators are taken into account as specified in 3GPP TS 24.171 . </action> </control> </control>
<control> <condition> If the RestrictDCNR bit is set to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message, </condition> <action> the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers. </action> </control>
<control> <condition> The UE supporting N1 mode </condition> <action> shall operate in the mode for inter-system interworking with 5GS </action> as follows: <control> a) <condition> if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface not supported", </condition> <action> the UE shall operate in single-registration mode; </action> </control> <control> b) <condition> <condition> if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" </condition> and <condition> the UE supports dual-registration mode, </condition> </condition> <action> the UE may operate in dual-registration mode; </action> </control> or NOTE 8: The registration mode used by the UE is implementation dependent. <control> c) <condition> <condition> if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" </condition> and <condition> the UE only supports single-registration mode, </condition> </condition> <action> the UE shall operate in single-registration mode. </action> </control> </control>
The UE shall treat the interworking without N26 interface indicator as valid in the entire PLMN and equivalent PLMNs. The interworking procedures required for coordination between 5GMM and EMM without N26 interface are specified in 3GPP TS 24.501 .
<control> <condition> If the redir-policy bit is set to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the ATTACH ACCEPT message, </condition> <action> the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN not allowed" </action> and <action> indicate to the lower layers that unsecured redirection to a GERAN cell is not allowed. </action> </control> <control> <condition> <condition> If the redir-policy bit is set to "Unsecured redirection to GERAN allowed" </condition> or <condition> if the Network policy IE is not included in the ATTACH ACCEPT message, </condition> </condition> <action> the UE shall set the network policy for the current PLMN to "Unsecured redirection to GERAN allowed" </action> and <action> indicate to the lower layers that unsecured redirection to a GERAN cell is allowed. </action> <control> <action> The UE shall set the network policy on unsecured redirection to GERAN to "Unsecured redirection to GERAN not allowed" </action> and <action> indicate this to the lower layers </action> <condition> when any of the following events occurs: <condition> a) <condition> the UE initiates an EPS attach or tracking area updating procedure </condition> <condition> in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure; </condition> </condition> <condition> b) the UE is switched on; </condition> or <condition> c) the UICC containing the USIM is removed. </condition> </condition> </control> </control>
<control> <condition> <condition> <condition> <condition> If the UE has initiated the attach procedure </condition> <condition> due to manual CSG selection </condition> </condition> and <condition> receives an ATTACH ACCEPT message; </condition> </condition> and <condition> <condition> the UE sent the ATTACH REQUEST message </condition> <condition> in a CSG cell, </condition> </condition> </condition> <action> the UE shall check if the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list. </action> </control> <control> <condition> If not, </condition> <action> the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list </action> and <action> the UE may add the HNB Name <condition> (if provided by lower layers) </condition> to the Allowed CSG list <condition> if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list. </condition> </action> </control>
<control> <condition> When the UE receives the ATTACH ACCEPT message <condition> combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> </condition> and <condition> if the UE has requested PDN connectivity </condition> <action> the UE shall forward the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message to the ESM sublayer. </action> </control> <control> <condition> Upon receipt of an indication from the ESM sublayer that the default EPS bearer context has been activated, </condition> <action> the UE shall send an ATTACH COMPLETE message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message contained in the ESM message container information element to the network. </action> <action> Additionally, the UE shall reset the attach attempt counter, </action> <end_state> enter state EMM-REGISTERED, </end_state> and <action> set the EPS update status to EU1 UPDATED. </action> </control>
<control> <condition> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> and <condition> the UE receives the ATTACH ACCEPT message combined with an ESM DUMMY MESSAGE, </condition> </condition> <action> the UE shall send an ATTACH COMPLETE message together with an ESM DUMMY MESSAGE contained in the ESM message container information element to the network. </action> </control>
<control> <condition> <condition> If the UE receives the ATTACH ACCEPT message </condition> <condition> from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see subclause 5.3.7b), </condition> </condition> <action> then the UE shall reset these counters. </action> <control> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> <action> then the UE shall reset this counter. </action> </control> </control>
<control> <condition> <condition> <condition> When the UE receives any ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST messages </condition> <condition> during the attach procedure, </condition> </condition> and <condition> if the UE has requested PDN connectivity </condition> </condition> <action> the UE shall forward the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) to the ESM sublayer. </action> <control> <action> The UE shall send a response to the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) </action> <condition> after successful completion of the attach procedure. </condition> </control> </control>
<control> <condition> If the attach procedure was initiated in S101 mode, </condition> <action> the lower layers are informed </action> <condition> about the successful completion of the procedure. </condition> </control>
<control> <condition> Upon receiving an ATTACH COMPLETE message, </condition> <action> the MME shall stop timer T3450, </action> <end_state> enter state EMM-REGISTERED </end_state> and <action> consider the GUTI sent in the ATTACH ACCEPT message as valid. </action> </control>
<control> <condition> If the T3448 value IE is present in the received ATTACH ACCEPT message, </condition> the UE shall: <action> a) stop timer T3448 <condition> if it is running; </condition> </action> and <action> b) start timer T3448 with the value provided in the T3448 value IE. </action> </control>
<control> <condition> <condition> If the UE is using EPS services with control plane CIoT EPS optimization, </condition> <condition> the T3448 value IE is present in the ATTACH ACCEPT message </condition> and <condition> the value indicates that this timer is either zero or deactivated, </condition> </condition> <action> the UE shall consider this case as an abnormal case </action> and <action> proceed as if the T3448 value IE is not present. </action> </control>
<control> <condition> If the UE has indicated "service gap control supported" in the ATTACH REQUEST message </condition> and: <control> a) <condition> the ATTACH ACCEPT message contains the T3447 value IE, </condition> <action> then the UE shall store the new T3447 value, </action> <action> erase any previous stored T3447 value if exists </action> and <action> use the new T3447 value with the T3447 timer next time it is started; </action> </control> or <control> b) <condition> the ATTACH ACCEPT message does not contain the T3447 value IE, </condition> <action> then the UE shall erase any previous stored T3447 value if exists </action> and <action> stop the T3447 timer if running. </action> </control> </control>
<control> <condition> In WB-S1 mode, </condition> <condition> if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message, </condition> <action> the MME may include a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the ATTACH ACCEPT message. </action> </control>
<control> <condition> In WB-S1 mode, </condition> <condition> if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message </condition> and the ATTACH ACCCEPT message includes: <control> a) <condition> a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", </condition> <action> the UE shall delete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE, </action> <action> then the UE shall, <condition> after the completion of the ongoing attach procedure, </condition> initiate a tracking area updating procedure as specified in subclause 5.5.3 over the existing NAS signalling connection; </action> </control> and <control> b) <condition> a UE radio capability ID IE, </condition> <action> the UE shall store the UE radio capability ID as specified in annex C. </action> </control> </control>
5.5.1.2.4A Attach successful for EPS services and not accepted for SMS services
Apart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in subclause 5.5.1.2.4 shall be followed. In addition, the following description for attach for SMS services applies.
<control> <condition> In NB-S1 mode, </condition> <condition> <condition> if the UE requested "SMS only" in the Additional update type IE and supports NB-S1 mode only, </condition> <condition> the MME decides to accept the attach request for EPS services only </condition> and: <condition> <condition> a) the location update for non-EPS services is not accepted by the VLR as specified in 3GPP TS 29.118 ; </condition> or <condition> b) the MME decides to not accept the attach request for "SMS only", </condition> </condition> </condition> <action> the MME shall set the EPS attach result IE to "EPS only", </action> <action> shall not indicate "SMS only" in the Additional update result IE in the ATTACH ACCEPT message </action> and <action> shall include an appropriate SMS services status value. </action> </control>
<control> <condition> The UE receiving the ATTACH ACCEPT message </condition> takes one of the following actions <condition> depending on the value included in the SMS services status IE: </condition> </control>
<control> <condition> "SMS services not available" </condition> </control>
<control> <action> The UE shall stop timer T3410 <condition> if still running, </condition> </action> <action> shall reset the tracking area updating attempt counter, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <control> <action> The USIM shall be considered as invalid for SMS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in subclause 5.3.7a. </condition> </condition> </control> </control>
<control> <condition> "SMS services not available in this PLMN" </condition> </control>
<control> <action> The UE shall stop timer T3410 <condition> if still running, </condition> </action> <action> shall reset the tracking area updating attempt counter, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <action> The UE may provide a notification to the user or the upper layers that the SMS services are not available. </action> <control> <action> The UE shall not attempt normal attach or tracking area updating procedures indicating "SMS only" with current PLMN </action> <condition> until <condition> switching off the UE </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control> <action> Additionally, the UE may perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> "Network failure" </condition> </control>
<control> <action> The UE shall stop timer T3410 <condition> if still running. </condition> </action> <action> The tracking area updating attempt counter shall be incremented, <condition> unless it was already set to 5. </condition> </action> </control>
<control> <condition> If the tracking area updating attempt counter is less than 5: </condition> a) <action> the UE shall start timer T3411, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <control> <condition> When timer T3411 expires </condition> <action> the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered. </action> </control> </control>
<control> <condition> If the tracking area updating attempt counter is equal to 5: </condition> a) <action> the UE shall start timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <control> <condition> When timer T3402 expires </condition> <action> the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered. </action> </control> </control>
<control> <condition> "Congestion" </condition> </control>
<control> <action> The UE shall stop the timer T3410 <condition> if still running. </condition> </action> <action> The tracking area updating attempt counter shall be set to 5. </action> <action> The UE shall start the timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED, </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <control> <condition> When timer T3402 expires </condition> <action> the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered. </action> </control> </control>
<control> <condition> Other values and the case that no SMS services status IE was received </condition> <action> are considered as abnormal cases. </action> <action> The attach procedure shall be considered as failed for SMS services. </action> <action> The behaviour of the UE in those cases is specified in subclause 5.5.1.2.6A. </action> </control>
5.5.1.2.5 Attach not accepted by the network
<control> <condition> If the attach request cannot be accepted by the network, </condition> <action> the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value. </action> </control>
<control> <condition> <condition> If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> <condition> the attach request included a PDN CONNECTIVITY REQUEST message, </condition> <condition> the attach procedure fails </condition> <condition> due to: <condition> a) a default EPS bearer setup failure; </condition> <condition> b) an ESM procedure failure; </condition> or <condition> c) operator determined barring is applied on default EPS bearer context activation during attach procedure, </condition> </condition> </condition> the MME shall: <action> a) combine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message contained in the ESM message container information element. </action> <action> In this case the EMM cause value in the ATTACH REJECT message shall be set to #19 "ESM failure"; </action> or <action> b) send the ATTACH REJECT message with the EMM cause set to #15 "No suitable cells in tracking area", <condition> if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP TS 29.274 for further details). </condition> </action> <action> In this case, the network may additionally include the Extended EMM cause IE with value "E- UTRAN not allowed". </action> </control>
<control> <condition> <condition> If the attach request is rejected </condition> <condition> due to NAS level mobility management congestion control, </condition> </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> assign a value for back-off timer T3346. </action> </control>
<control> <condition> In NB-S1 mode, </condition> <condition> <condition> if the attach request is rejected </condition> <condition> due to operator determined barring (see 3GPP TS 29.272 ), </condition> </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> assign a value for back-off timer T3346. </action> </control>
<control> <condition> <condition> If the attach request is rejected </condition> <condition> due to service gap control as specified in subclause 5.3.17 </condition> <condition> i.e. the T3447 timer is running, </condition> </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> may assign a back-off timer T3346 with the remaining time of the running T3447 timer. </action> </control>
<control> <condition> <condition> If the attach request is rejected </condition> <condition> due to incompatibility between the CIoT EPS optimizations supported by the UE </condition> and <condition> what the network supports </condition> and <condition> the network sets the EMM cause value to #15 "no suitable cells in tracking area", </condition> </condition> <action> the network may additionally include the Extended EMM cause IE with value "requested EPS optimization not supported". </action> </control>
NOTE 1: How the UE uses the Extended EMM cause IE with value "requested EPS optimization not supported" is implementation specific. The UE still behaves according to the EMM cause value #15.
<control> <condition> Based on operator policy, <condition> <condition> <condition> if the attach request is rejected </condition> <condition> due to core network redirection for CIoT optimizations, </condition> </condition> </condition> </condition> <action> the network shall set the EMM cause value to #31 "Redirection to 5GCN required". </action> </control>
NOTE 2: The network can take into account the UEs N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 "Redirection to 5GCN required".
<control> <condition> Upon receiving the ATTACH REJECT message, </condition> <condition> <condition> if the message is integrity protected </condition> or <condition> contains a reject cause other than EMM cause value #25, </condition> </condition> <action> the UE shall stop timer T3410. </action> </control>
<control> <condition> <condition> If the ATTACH REJECT message <condition> with EMM cause #25 was received </condition> <condition> without integrity protection, </condition> </condition> </condition> <action> then the UE shall discard the message. </action> </control>
The UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.
<control> <condition> #3 (Illegal UE); #6 (Illegal ME); or #8 (EPS services and non-EPS services not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> The UE shall consider the USIM as invalid for EPS services and non-EPS services <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> </condition> as described in subclause 5.3.7a. </action> <action> Additionally, the UE shall delete the list of equivalent PLMNs </action> and <end_state> enter state EMM-DEREGISTERED.NO-IMSI. </end_state> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal attach procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> For the EMM cause value #3 or #6, </condition> <condition> if the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> For the EMM cause value #8, </condition> <condition> if the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, </end_state> <action> 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
NOTE 3: The possibility to configure a UE so that the radio transceiver for a specific RAT is not active, although it is implemented in the UE, is out of scope of the present specification.
<control> <condition> #7 (EPS services not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> The UE shall consider the USIM as invalid for EPS services <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> </condition> as described in subclause 5.3.7a. </action> <end_state> Additionally, the UE shall enter state EMM- DEREGISTERED. </end_state> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal attach procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> #11 (PLMN not allowed); or #35 (Requested service option not authorized in this PLMN); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> Additionally, the UE shall delete the list of equivalent PLMNs </action> and <action> reset the attach attempt counter. </action> </control>
<control> <condition> In S1 mode, </condition> <action> the UE shall store the PLMN identity in the "forbidden PLMN list" </action> and <end_state> enter state EMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> <action> The UE shall perform a PLMN selection according to 3GPP TS 23.122 . </action> <action> <condition> If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, </condition> then the UE shall set this counter to the UE implementation-specific maximum value. </action> </control>
<control> <condition> In S101 mode, </condition> <action> the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" </action> and <end_state> enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE </end_state> and <action> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control>
<control> <condition> For the EMM cause value #11, </condition> <condition> if the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> For the EMM cause value #35, </condition> <condition> if the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, </end_state> <action> 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #12 (Tracking area not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> Additionally, the UE shall reset the attach attempt counter. </action> </control>
<control> <condition> In S1 mode, </condition> <action> the UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service" </action> and <end_state> enter the state EMM-DEREGISTERED.LIMITED-SERVICE. </end_state> <control> <condition> If the ATTACH REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message. </action> </control> </control>
<control> <condition> In S101 mode, </condition> <action> the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" </action> and <end_state> enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE </end_state> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> #13 (Roaming not allowed in this tracking area); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> The UE shall delete the list of equivalent PLMNs and reset the attach attempt counter. </action> </control>
<control> <condition> In S1 mode, </condition> <action> the UE shall store the current TAI in the list of "forbidden tracking areas for roaming". </action> <control> <condition> If the ATTACH REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. </action> </control> <end_state> Additionally, the UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE or optionally EMM- DEREGISTERED.PLMN-SEARCH. </end_state> <control> <condition> <condition> If the UE is registered in N1 mode </condition> and <condition> operating in dual-registration mode, </condition> </condition> <action> the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 subclause 4.8.3. </action> </control> <condition> Otherwise </condition> <action> the UE shall perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> In S101 mode, </condition> <action> the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" </action> and <end_state> enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE </end_state> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> #14 (EPS services not allowed in this PLMN); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> Additionally, the UE shall delete the list of equivalent PLMNs </action> and <action> reset the attach attempt counter. </action> </control>
<control> <condition> In S1 mode, </condition> <action> the UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list. </action> <end_state> Additionally, the UE shall enter state EMM-DEREGISTERED.PLMN-SEARCH </end_state> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control> <action> The UE shall perform a PLMN selection according to 3GPP TS 23.122 . </action> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a PLMN-specific PS-attempt counter for that PLMN, </condition> </condition> <action> then the UE shall set this counter to the UE implementation- specific maximum value. </action> </control> </control>
<control> <condition> In S101 mode, </condition> <action> the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" </action> and <end_state> enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE </end_state> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> the UE shall in addition <end_state> set the 5GMM state to 5GMM- DEREGISTERED, </end_state> <action> 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #15 (No suitable cells in tracking area); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> Additionally, the UE shall reset the attach attempt counter. </action> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". </action> </control>
<control> <condition> If the ATTACH REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. </action> </control> <end_state> Additionally, the UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE </end_state> and: <control> <condition> a) <condition> if the UE is in WB-S1 mode </condition> and <condition> the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the ATTACH REJECT message, </condition> <condition> the UE supports "E-UTRA Disabling for EMM cause #15", </condition> and <condition> the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 or 3GPP TS 31.102 is present </condition> and <condition> set to enabled; </condition> </condition> <action> then the UE shall disable the E-UTRA capability as specified in subclause 4.5 and search for a suitable cell in GERAN, UTRAN or NG-RAN radio access technology; </action> </control> <control> <condition> b) <condition> <condition> if the UE is in NB-S1 mode </condition> and <condition> the Extended EMM cause IE with value "NB-IoT not allowed" is included in the ATTACH REJECT message, </condition> </condition> </condition> <action> then the UE may disable the NB-IoT capability as specified in subclause 4.9 </action> and <action> search for a suitable cell in E-UTRAN radio access technology; </action> </control> <control> <condition> c) otherwise, </condition> <action> the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 . </action> </control>
<control> <condition> In S101 mode, </condition> <action> the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" </action> and <end_state> enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE </end_state> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control> </control>
<control> <condition> #22 (Congestion); </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> <condition> If the T3346 value IE is present in the ATTACH REJECT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> <action> the UE shall proceed as described below; </action> </control> <control> <condition> otherwise </condition> <action> it shall be considered as an abnormal case </action> and <action> the behaviour of the UE for this case is specified in subclause 5.5.1.2.6. </action> <action> The UE shall abort the attach procedure, </action> <action> reset the attach attempt counter, </action> <action> set the EPS update status to EU2 NOT UPDATED </action> and <end_state> enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. </end_state> <action> The UE shall stop timer T3346 <condition> if it is running. </condition> </action> <control> <condition> If the ATTACH REJECT message is integrity protected, </condition> <action> the UE shall start timer T3346 with the value provided in the T3346 value IE. </action> </control> <control> <condition> If the ATTACH REJECT message is not integrity protected, </condition> <action> the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 . </action> </control> <action> The UE stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> <action> The attach procedure is started <condition> if still needed </condition> <condition> when timer T3346 expires or is stopped. </condition> </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal attach procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 </action> <condition> for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> #25 (Not authorized for this CSG); </condition> </control>
<control> <action> EMM cause #25 is only applicable </action> <condition> when received from a CSG cell. </condition> </control> <control> <condition> EMM cause #25 received from a non-CSG cell </condition> <action> is considered as an abnormal case </action> and <action> the behaviour of the UE is specified in subclause 5.5.1.2.6. </action> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). </action> <action> Additionally, the UE shall reset the attach attempt counter </action> and <end_state> shall enter the state EMM- DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, </condition> <action> the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list. </action> </control>
<control> <condition> If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, </condition> <action> the UE shall apply the procedures defined in 3GPP TS 23.122 subclause 3.1A. </action> </control>
<control> <action> The UE shall search for a suitable cell according to 3GPP TS 36.304 . </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal attach procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED </end_state> and <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED. </action> </control>
<control> <condition> #42 (Severe network failure); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU2 NOT UPDATED, </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, </action> and <action> set the attach attempt counter to 5. </action> <action> The UE shall start an implementation specific timer setting its value to 2 times the value of T as defined in 3GPP TS 23.122 . </action> <control> <condition> While this timer is running, </condition> <action> the UE shall not consider the PLMN + RAT combination that provided this reject cause a candidate for PLMN selection. </action> </control> <end_state> The UE then enters state EMM- DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 . </end_state> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition set the GMM state to GMM- DEREGISTERED, </action> <action> GPRS update status to GU2 NOT UPDATED, </action> and <action> shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED, </end_state> <action> 5GS update status to 5U2 NOT UPDATED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #31 (Redirection to 5GCN required); </condition> </control>
<control> <condition> EMM cause #31 received by a UE that has not indicated support for CIoT optimizations </condition> <action> is considered as an abnormal case </action> and <action> the behaviour of the UE is specified in subclause 5.5.1.2.6. </action> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> Additionally, the UE shall reset the attach attempt counter. </action> </control>
<control> <action> The UE shall enable N1 mode capability for 3GPP access <condition> if it was disabled </condition> </action> and <action> disable the E-UTRA capability (see subclause 4.5) </action> and <end_state> enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE. </end_state> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value. </condition> </control>
Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause 5.5.1.2.6.
5.5.1.2.5A Attach for emergency bearer services not accepted by the network
<control> <condition> If the attach request for emergency bearer services cannot be accepted by the network, </condition> <action> the MME shall send an ATTACH REJECT message to the UE </action> <action> including EMM cause #5 "IMEI not accepted" or one of the EMM cause values as described in subclause 5.5.1.2.5. </action> </control>
NOTE 1: <control> <condition> <condition> If EMM cause #11 is sent to a UE of a roaming subscriber attaching for emergency bearer services </condition> and <condition> the UE is in automatic network selection mode, </condition> </condition> <action> it cannot obtain normal service provided by this PLMN. </action> </control>
<control> <condition> <condition> Upon receiving the ATTACH REJECT message </condition> <condition> including EMM cause #5, </condition> </condition> <end_state> the UE shall enter the state EMM- DEREGISTERED.NO-IMSI. </end_state> </control>
<control> <condition> <condition> Upon receiving the ATTACH REJECT message </condition> <condition> including one of the other EMM cause values, </condition> </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.5 </action> with the following addition: <action> the UE shall inform the upper layers of the failure of the procedure. </action> </control>
NOTE 2: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> If the attach request for emergency bearer services fails due to abnormal case a) in subclause 5.5.1.2.6, </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.6 </action> and <action> inform the upper layers of the failure to access the network. </action> </control>
NOTE 3: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> <condition> If the attach request for emergency bearer services fails </condition> <condition> due to abnormal cases b), c) or d) in subclause 5.5.1.2.6, </condition> </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.6 </action> with the following addition: <action> the UE shall inform the upper layers of the failure of the procedure. </action> </control>
NOTE 4: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> In a shared network, </condition> <condition> upon receiving the ATTACH REJECT message, </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.5, </action> and shall: </control>
<control> a) <action> inform the upper layers of the failure of the procedure; </action> or NOTE 5: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN . </control>
<control> b) <action> attempt to perform a PLMN selection in the shared network </action> and, <condition> if an attach for emergency bearer services was not already attempted with the selected PLMN </condition> and the ATTACH REQUEST message: <control> <condition> a) did not include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", </condition> <action> initiate an attach for emergency bearer services to the selected PLMN; </action> </control> or <control> <condition> b) did include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" </condition> <control> and: i) <condition> the selected PLMN is an equivalent PLMN, </condition> <action> initiate an attach for emergency bearer services to the selected PLMN; </action> </control> and <control> ii) <condition> the selected PLMN is not an equivalent PLMN, </condition> <action> perform a PLMN selection </action> and <action> initiate an attach for emergency bearer services to the selected PLMN <condition> if an attach for emergency bearer services was not already attempted with the selected PLMN. </condition> </action> </control> </control> </control>
<control> <condition> In a shared network, </condition> <condition> <condition> if the attach request for emergency bearer services fails </condition> <condition> due to abnormal case a) in subclause 5.5.1.2.6, </condition> </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.6 </action> and shall: <action> a) inform the upper layers of the failure to access the network; </action> or NOTE 6: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN . b) <action> attempt to perform a PLMN selection in the shared network </action> and, <control> <condition> if an attach for emergency bearer services was not already attempted with the selected PLMN </condition> and <control> the ATTACH REQUEST message: <control> <condition> a) did not include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", </condition> <action> initiate an attach for emergency bearer services to the selected PLMN; </action> </control> or <control> <condition> b) did include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" </condition> and: <control> <condition> i) the selected PLMN is an equivalent PLMN, </condition> <action> initiate an attach for emergency bearer services to the selected PLMN; </action> </control> and <control> <condition> ii) the selected PLMN is not an equivalent PLMN, </condition> <action> perform a PLMN selection </action> and <action> initiate an attach for emergency bearer services to the selected PLMN <condition> if an attach for emergency bearer services was not already attempted with the selected PLMN. </condition> </action> </control> </control> </control> </control> </control>
<control> <condition> In a shared network, </condition> <condition> <condition> if the attach request for emergency bearer services fails </condition> <condition> due to abnormal cases b), c) or d) in subclause 5.5.1.2.6, </condition> </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.6, </action> and shall: <action> a) inform the upper layers of the failure of the procedure; </action> or NOTE 7: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN . b) <action> attempt to perform a PLMN selection in the shared network </action> and, <control> <condition> if an attach for emergency bearer services was not already attempted with the selected PLMN </condition> and <control> the ATTACH REQUEST message: <control> <condition> a) did not include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", </condition> <action> initiate an attach for emergency bearer services to the selected PLMN; </action> </control> or <control> <condition> b) did include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" </condition> and: <control> <condition> i) the selected PLMN is an equivalent PLMN, </condition> <action> initiate an attach for emergency bearer services to the selected PLMN; </action> </control> and <control> <condition> ii) the selected PLMN is not an equivalent PLMN, </condition> <action> perform a PLMN selection </action> and <action> initiate an attach for emergency bearer services to the selected PLMN <condition> if an attach for emergency bearer services was not already attempted with the selected PLMN. </condition> </action> </control> </control> </control> </control> </control>
5.5.1.2.5B Attach for initiating a PDN connection for emergency bearer services not accepted by the network
<control> <condition> <condition> If the network cannot accept an attach request </condition> <condition> <condition> with attach type not set to "EPS emergency attach" </condition> and <condition> <condition> including a PDN CONNECTIVITY REQUEST message </condition> <condition> with request type set to "emergency", </condition> </condition> </condition> </condition> <action> the UE shall perform the procedures as described in subclause 5.5.1.2.5. </action> <control> <condition> Then if the UE is in the same selected PLMN where the last attach request was attempted, </condition> the UE shall: <control> <action> a) inform the upper layers of the failure of the procedure; </action> or NOTE 1: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN. </control> <control> <action> b) attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message. </action> </control> </control> </control>
<control> <condition> <condition> If the network cannot accept an attach request </condition> <condition> <condition> with attach type not set to "EPS emergency attach" </condition> and <condition> <condition> including a PDN CONNECTIVITY REQUEST message </condition> <condition> with request type set to "handover of emergency bearer services", </condition> </condition> </condition> </condition> <action> the UE shall perform the procedures as described in subclause 5.5.1.2.5. </action> <control> <condition> <condition> Then if the UE is in the same selected PLMN </condition> or <condition> equivalent PLMN where the last attach request was attempted, </condition> </condition> <action> the UE shall attempt EPS attach for emergency bearer services </action> <action> including the PDN CONNECTIVITY REQUEST message. </action> </control> </control>
<control> <condition> If the attach request <condition> with attach type not set to "EPS emergency attach" </condition> for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in subclause 5.5.1.2.6, </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.6 </action> and <action> inform the upper layers of the failure to access the network. </action> </control>
NOTE 2: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> If the attach request <condition> <condition> with attach type not set to "EPS emergency attach" </condition> and <condition> <condition> including a PDN CONNECTIVITY REQUEST message </condition> <condition> with request type set to "emergency" </condition> </condition> </condition> fails due to abnormal cases b), c) or d) in subclause 5.5.1.2.6, </condition> <action> the UE shall perform the procedures as described in subclause 5.5.1.2.6. </action> <control> <condition> Then if the UE is in the same selected PLMN where the last attach request was attempted, </condition> the UE shall: <control> <action> a) inform the upper layers of the failure of the procedure; </action> or NOTE 3: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN. </control> <control> <action> b) attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message. </action> </control> </control> </control>
<control> <condition> If the attach request <condition> <condition> with attach type not set to "EPS emergency attach" </condition> and <condition> <condition> including a PDN CONNECTIVITY REQUEST message </condition> <condition> with request type set to "handover of emergency bearer services" </condition> </condition> </condition> fails due to abnormal cases b), c), d) or o) in subclause 5.5.1.2.6, </condition> <action> the UE shall perform the procedures as described in subclause 5.5.1.2.6. </action> <control> <condition> <condition> Then if the UE is in the same selected PLMN </condition> or <condition> equivalent PLMN where the last attach request was attempted, </condition> </condition> <action> the UE shall attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message. </action> </control> </control>
5.5.1.2.5B1 Attach by a UE transferring an emergency PDU session using a standalone PDN CONNECTIVITY REQUEST message
<control> <condition> <condition> <condition> If the network cannot accept attach request </condition> <condition> <condition> including a PDN CONNECTIVITY REQUEST message </condition> <condition> with request type set to "handover" </condition> </condition> </condition> and <condition> the UE also intends to transfer an emergency PDU session, </condition> </condition> <action> the UE shall attempt EPS attach for emergency bearer services </action> <action> including a PDN CONNECTIVITY REQUEST message </action> <action> with request type set to "handover of emergency bearer services" for the emergency PDU session. </action> </control>
<control> <condition> <condition> If the attach request, <condition> <condition> including a PDN CONNECTIVITY REQUEST message </condition> <condition> with request type set "handover", </condition> </condition> fails due to abnormal case a) in subclause 5.5.1.2.6 </condition> and <condition> the UE intends to transfer an emergency PDU session, </condition> </condition> <action> the UE shall attempt EPS attach </action> <action> including a PDN CONNECTIVITY REQUEST message </action> <action> with request type set to "handover of emergency bearer services" for the emergency PDU session. </action> </control>
<control> <condition> <condition> If the attach request <condition> <condition> including a PDN CONNECTIVITY REQUEST message </condition> <condition> with request type set "handover" </condition> </condition> fails due to abnormal cases b), c), d) or o) in subclause 5.5.1.2.6, </condition> <condition> the UE intends to transfer an emergency PDU session: </condition> </condition> <control> a) <condition> if an EMM cause set to #19 "ESM failure" is received, </condition> <action> the UE shall attempt EPS attach; </action> </control> and <control> b) <condition> otherwise, </condition> <action> the UE shall attempt EPS attach for emergency bearer services, </action> <action> with the ATTACH REQUEST message </action> <action> including a PDN CONNECTIVITY REQUEST message </action> <action> with request type set to "handover of emergency bearer services" for the emergency PDU session. </action> </control> </control>
5.5.1.2.5C Attach for access to RLOS not accepted by the network
<control> <condition> <condition> If the attach request for access to RLOS is received by the network </condition> and <condition> the UE requesting attach is not in limited service state, </condition> </condition> <action> the MME shall reject the UE's attach request. </action> </control>
<control> <condition> If the attach request for access to RLOS cannot be accepted by the network, </condition> <action> the MME shall send an ATTACH REJECT message to the UE </action> <action> including EMM cause #35 "Requested service option not authorized in this PLMN" or one of the EMM cause values as described in subclause 5.5.1.2.5. </action> </control>
<control> <condition> <condition> Upon receiving the ATTACH REJECT message </condition> <condition> including EMM cause #35, </condition> </condition> <end_state> the UE shall enter the state EMM- DEREGISTERED.PLMN-SEARCH </end_state> and <action> perform a PLMN selection according to 3GPP TS 23.122 </action> <action> to attempt EPS attach for access to RLOS via another PLMN. </action> </control>
<control> <condition> <condition> Upon receiving the ATTACH REJECT message </condition> <condition> including one of the other EMM cause values, </condition> </condition> <action> the UE shall perform the actions as described in subclause 5.5.1.2.5. </action> along with the following conditions: <control> a) <condition> if the action for the reject involves searching for a suitable cell in E-UTRAN radio access technology, </condition> <action> the UE shall proceed with the action </action> and <action> shall attempt to attach for access to RLOS in the new tracking area, <condition> if found; </condition> </action> </control> and <control> b) <condition> if the action for the reject involves attempting to select GERAN or UTRAN radio access technology or disabling the E-UTRA capability, </condition> <action> the UE shall skip the action for as long as access to RLOS is still needed. </action> </control> </control>
NOTE: How long the UE attempts to access RLOS is up to UE implementation.
<control> <condition> <condition> Then if the UE is in the same selected PLMN where the last attach procedure was attempted and rejected </condition> and <condition> if timer T3346 is not running, </condition> </condition> <action> perform a PLMN selection according to 3GPP TS 23.122 </action> <action> to attempt EPS attach for access to RLOS via another PLMN. </action> </control>
<control> <condition> <condition> If the attach request for access to RLOS fails </condition> <condition> due to abnormal cases b), c) or d) in subclause 5.5.1.2.6, </condition> </condition> <action> the UE shall perform the procedures as described in subclause 5.5.1.2.6 </action> <condition> with the exception that the UE shall skip actions that involve attempting to select GERAN or UTRAN radio access technology and actions that involve disabling the E-UTRA capability, for as long as access to RLOS is still needed. </condition> </control>
5.5.1.2.6 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <action> a) Access barred </action> <condition> </condition> <condition> because of access class barring, EAB, ACDC or <condition> NAS signalling connection establishment rejected by the network </condition> <condition> without "Extended wait time" received from lower layers </condition> </condition> </control>
<control> <condition> In WB-S1 mode, </condition> <condition> <condition> if access is barred </condition> <condition> for "originating signalling" </condition> (see 3GPP TS 36.331 ), </condition> <action> the attach procedure shall not be started. </action> <action> The UE stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> </control> <control> <action> The attach procedure is started as soon as possible, </action> i.e. <condition> <condition> when access for "originating signalling" is granted on the current cell </condition> or <condition> when the UE moves to a cell where access for "originating signalling" is granted. </condition> </condition> </control>
<control> <condition> In NB-S1 mode, </condition> <condition> <condition> if access is barred </condition> <condition> for "originating signalling" </condition> (see 3GPP TS 36.331 ), </condition> <action> the attach procedure shall not be started. </action> <action> The UE stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> </control>
<control> Further UE behaviour is implementation specific, e.g. the attach procedure is started again <condition> after an implementation dependent time. </condition> </control>
<control> <condition> In NB-S1 mode, </condition> <condition> <condition> <condition> if access is barred </condition> <condition> for "originating signalling" </condition> (see 3GPP TS 36.331 ), </condition> <condition> a request for an exceptional event is received from the upper layers, </condition> </condition> <action> then the attach procedure shall be started. </action> </control>
NOTE 1: <control> <condition> In NB-S1 mode, </condition> the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 ). </control>
<control> <condition> <condition> <condition> If access is barred </condition> <condition> because of access class barring for "originating signalling" (see 3GPP TS 36.331 ), </condition> </condition> <condition> ACDC is applicable to the request from the upper layers and the UE supports ACDC, </condition> </condition> <action> then the attach procedure shall be started. </action> </control>
<control> <condition> <condition> <condition> If access is barred </condition> <condition> for a certain ACDC category (see 3GPP TS 36.331 ), </condition> </condition> <condition> a request with a higher ACDC category is received from the upper layers </condition> and <condition> the UE supports ACDC, </condition> </condition> <action> then the attach procedure shall be started. </action> </control>
<control> <condition> <condition> <condition> If an access request for an uncategorized application is barred </condition> <condition> due to ACDC (see 3GPP TS 36.331 ), </condition> </condition> <condition> a request with a certain ACDC category is received from the upper layers </condition> and <condition> the UE supports ACDC, </condition> </condition> <action> then the attach procedure shall be started. </action> </control>
<control> <condition> b) <condition> <condition> Lower layer failure </condition> or <condition> <condition> release of the NAS signalling connection </condition> <condition> <condition> without "Extended wait time" </condition> and <condition> without "Extended wait time CP data" received from lower layers </condition> </condition> </condition> </condition> <condition> before the ATTACH ACCEPT or ATTACH REJECT message is received; </condition> </condition> </control>
<control> <action> The attach procedure shall be aborted, </action> and <action> the UE shall proceed as described below. </action> </control>
<control> <condition> c) T3410 timeout </condition> </control>
<control> <action> The UE shall abort the attach procedure </action> and <action> proceed as described below. </action> <action> The NAS signalling connection, <condition> if any, </condition> shall be released locally. </action> </control>
NOTE 2: <control> <action> The NAS signalling connection can also be released </action> <condition> if the UE deems that the network has failed the authentication check as specified in subclause 5.4.2.7. </condition> </control>
<control> <condition> d) <condition> ATTACH REJECT, </condition> <condition> other EMM cause values than those treated in subclause 5.5.1.2.5, </condition> and <condition> cases of EMM cause values #22, #25 and #31, </condition> <condition> if considered as abnormal cases according to subclause 5.5.1.2.5; </condition> </condition> </control>
<control> <condition> <condition> Upon reception of the EMM cause #19 "ESM failure", </condition> <condition> <condition> if the UE is not configured for NAS signalling low priority </condition> and <condition> the ESM cause value received in the PDN CONNECTIVITY REJECT message is not #54 "PDN connection does not exist", </condition> </condition> </condition> <action> the UE may set the attach attempt counter to 5. </action> <control> <condition> Subsequently, <condition> if the UE needs to retransmit the ATTACH REQUEST message </condition> <condition> to request PDN connectivity towards a different APN, </condition> </condition> <action> the UE may stop T3411 or T3402, <condition> if running, </condition> </action> and <action> send the ATTACH REQUEST message. </action> </control> <control> <condition> <condition> If the UE needs to attempt EPS attach </condition> <condition> to request transfer of a PDN connection for emergency bearer services </condition> <condition> <condition> by including a PDN CONNECTIVITY REQUEST message </condition> <condition> with request type set to "handover of emergency bearer services", </condition> </condition> </condition> <action> the UE shall stop T3411 or T3402, <condition> if running, </condition> </action> and <action> send the ATTACH REQUEST message. </action> </control> </control>
NOTE 3: When receiving EMM cause #19 "ESM failure", coordination is required between the EMM and ESM sublayers in the UE to determine whether to set the attach attempt counter to 5.
<control> <condition> If the attach request is <condition> neither for emergency bearer services </condition> <condition> nor for initiating a PDN connection for emergency bearer services </condition> <condition> with attach type not set to "EPS emergency attach", </condition> </condition> <condition> upon reception of the EMM causes #95, #96, #97, #99 and #111 </condition> <action> the UE should set the attach attempt counter to 5. </action> <action> The UE shall proceed as described below. </action> </control>
<control> <condition> e) Change of cell into a new tracking area </condition> </control>
<control> <condition> <condition> If a cell change into a new tracking area occurs </condition> <condition> before the attach procedure is completed, </condition> </condition> <action> the attach procedure shall be aborted </action> and <action> re-initiated immediately. </action> <control> <condition> <condition> If a tracking area border is crossed </condition> <condition> when the ATTACH ACCEPT message has been received </condition> <condition> but before an ATTACH COMPLETE message is sent, </condition> </condition> <action> the attach procedure shall be re-initiated. </action> </control> <control> <condition> If a GUTI was allocated during the attach procedure, </condition> <action> this GUTI shall be used in the attach procedure. </action> </control> </control>
<control> <condition> f) Mobile originated detach required </condition> </control>
<control> <action> The attach procedure shall be aborted, </action> and <action> the UE initiated detach procedure shall be performed. </action> </control>
<control> <condition> g) Detach procedure collision; </condition> </control>
<control> <condition> If the UE receives a DETACH REQUEST message from the network </condition> <start_state> in state EMM-REGISTERED-INITIATED </start_state> and <condition> <condition> the detach type indicates "re-attach not required" </condition> and <condition> no EMM cause IE, </condition> </condition> or <condition> <condition> "re-attach not required" </condition> and <condition> the EMM cause value is not #2 "IMSI unknown in HSS", </condition> </condition> <action> the detach procedure shall be progressed </action> and <action> the attach procedure shall be aborted. </action> </control> <control> <condition> If the UE receives a DETACH REQUEST message from the network </condition> <start_state> in state EMM- REGISTERED-INITIATED </start_state> and <condition> the detach type indicates "re-attach required", </condition> <action> the detach procedure shall be progressed </action> and <action> the UE shall locally release the NAS signalling connection, <condition> before re-initiating the attach procedure. </condition> </action> <control> <condition> Otherwise </condition> <action> the attach procedure shall be progressed </action> and <action> the DETACH REQUEST message shall be ignored. </action> </control> </control>
<control> <condition> h) Transmission failure of ATTACH REQUEST message indication from lower layers </condition> </control>
<control> <action> The UE shall restart the attach procedure immediately. </action> </control>
<control> <condition> i) Transmission failure of ATTACH COMPLETE message indication from lower layers </condition> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> <action> the UE shall restart the attach procedure. </action> </control>
<control> <condition> If the current TAI is still in the TAI list, </condition> <action> it is up to the UE implementation how to re-run the ongoing procedure. </action> <action> The EMM sublayer notifies the ESM sublayer that the ESM message in the ESM message container IE of the ATTACH COMPLETE has failed to be transmitted. </action> </control>
<control> <condition> j) <condition> If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> and <condition> <condition> the ACTIVATE DEFAULT BEARER CONTEXT REQUEST message combined with the ATTACH ACCEPT is not accepted by the UE </condition> <condition> due to failure in the UE ESM sublayer, </condition> </condition> </condition> <action> then the UE shall initiate the detach procedure </action> <action> by sending a DETACH REQUEST message to the network. </action> <action> Further UE behaviour is implementation specific. </action> </control>
<control> <condition> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> and <condition> <condition> the ACTIVATE DEFAULT BEARER CONTEXT REQUEST message combined with the ATTACH ACCEPT is not accepted by the UE </condition> <condition> due to failure in the UE ESM sublayer, </condition> </condition> </condition> <action> then the UE shall either send an ATTACH COMPLETE message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT contained in the ESM message container information element to the network </action> or <action> initiate the detach procedure by sending a DETACH REQUEST message. </action> <action> Further UE behaviour is implementation specific. </action> </control>
<control> <condition> k) Indication from the lower layers that an S101 mode to S1 mode handover has been cancelled (S101 mode only) </condition> </control>
<control> <action> The UE shall abort the attach procedure </action> and <end_state> enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE. </end_state> </control>
<control> <condition> l) "Extended wait time" from the lower layers </condition> </control>
<control> <condition> If the ATTACH REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", </condition> <action> the UE shall start timer T3346 with the "Extended wait time" value </action> and <action> reset the attach attempt counter. </action> </control>
<control> <condition> <condition> If the ATTACH REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority", </condition> </condition> <condition> <condition> the UE is operating in NB-S1 mode </condition> and <condition> the UE is not a UE configured to use AC11 15 in selected PLMN, </condition> </condition> <action> then the UE shall start timer T3346 with the "Extended wait time" value </action> and <action> reset the attach attempt counter. </action> </control>
<control> <condition> In other cases </condition> <action> the UE shall ignore the "Extended wait time". </action> </control>
<control> <action> The UE shall abort the attach procedure, </action> <action> stay in the current serving cell, </action> <end_state> change the state to EMM- DEREGISTERED.ATTEMPTING-TO-ATTACH </end_state> and <action> apply the normal cell reselection process. </action> </control>
<control> <action> The UE shall proceed as described below. </action> </control>
<control> <condition> la) "Extended wait time CP data" from the lower layers </condition> </control>
<control> <condition> If the UE is operating in NB-S1 mode, </condition> <action> the UE shall start the timer T3346 with the "Extended wait time CP data" value </action> and <action> reset the attach attempt counter. </action> </control>
<control> <condition> In other cases </condition> <action> the UE shall ignore the "Extended wait time CP data". </action> </control>
<control> <action> The UE shall abort the attach procedure, </action> <action> stay in the current serving cell, </action> <end_state> change the state to EMM- DEREGISTERED.ATTEMPTING-TO-ATTACH </end_state> and <action> apply the normal cell reselection process. </action> </control>
<control> <action> The UE shall proceed as described below. </action> </control>
<control> <condition> m) Timer T3346 is running </condition> </control>
<control> <action> The UE shall not start the attach procedure </action> <condition> unless: <condition> a) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> <condition> b) the UE needs to attach for emergency bearer services; </condition> <condition> c) <condition> the UE <condition> in NB-S1 mode </condition> is requested by the upper layer to transmit user data related to an exceptional event </condition> and <condition> <condition> i) the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in NASCONFIG 3GPP TS 31.102 ); </condition> and <condition> ii) <condition> timer T3346 was not started </condition> <condition> when NAS signaling connection was established </condition> <condition> with RRC establishment cause set to "MO exception data"; </condition> </condition> </condition> </condition> or <condition> d) <condition> <condition> the UE needs to attach </condition> <condition> without the NAS signalling low priority indication </condition> </condition> and <condition> <condition> if the timer T3346 was started </condition> <condition> due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST or EXTENDED SERVICE REQUEST) </condition> <condition> which contained the low priority indicator set to "MS is configured for NAS signalling low priority". </condition> </condition> </condition> </condition> <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> </control>
NOTE 4: It is considered an abnormal case if the UE needs to initiate an attach procedure while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non successful case.
<control> <action> The UE shall proceed as described below. </action> </control>
<control> <condition> n) <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> <condition> an ESM DUMMY MESSAGE is included in the ESM message container information element of the ATTACH REQUEST message </condition> and <condition> the UE receives the ATTACH ACCEPT message combined with a PDN CONNECTIVITY REJECT message, </condition> </condition> <action> the UE shall send an ATTACH COMPLETE message </action> <action> together with an ESM DUMMY MESSAGE contained in the ESM message container information element to the network. </action> <action> Further UE behaviour is implementation specific. </action> </control>
<control> <condition> o) Timer T3447 is running; </condition> </control>
<control> <action> The UE shall not start the attach procedure </action> <condition> unless: <condition> a) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> <condition> b) the UE attempts to attach for emergency bearer services; </condition> or <condition> c) the UE attempts to attach without PDN connection request. </condition> </condition> <action> The UE stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> <action> The attach request procedure is started, <condition> if still necessary, </condition> <condition> when timer T3447 expires. </condition> </action> </control>
<control> <condition> For the cases b, c, d, l, la and m: </condition> <action> a) Timer T3410 shall be stopped if still running. </action> <control> b) <condition> <condition> <condition> For the cases b, c, d, l </condition> <condition> when the "Extended wait time" is ignored, </condition> </condition> and <condition> <condition> la </condition> <condition> when the "Extended wait time CP data" is ignored, </condition> </condition> </condition> <condition> <condition> if the attach request is neither for emergency bearer services </condition> <condition> nor for initiating a PDN connection for emergency bearer services </condition> <condition> with attach type not set to "EPS emergency attach", </condition> </condition> <action> the attach attempt counter shall be incremented, <condition> unless it was already set to 5. </condition> </action> </control> <control> c) <condition> If the attach attempt counter is less than 5: </condition> <control> a) <condition> for the cases l, la and m, </condition> <action> the attach procedure is started, <condition> if still necessary, </condition> </action> <condition> <condition> when timer T3346 expires </condition> or <condition> is stopped; </condition> </condition> </control> <control> b) <condition> <condition> <condition> <condition> for the cases b, c, d, l </condition> <condition> when the "Extended wait time" is ignored, </condition> </condition> and <condition> <condition> la </condition> <condition> when the "Extended wait time CP data" is ignore, </condition> </condition> </condition> <condition> if the attach request is neither for emergency bearer services </condition> <condition> nor for initiating a PDN connection for emergency bearer services </condition> <condition> with attach type not set to "EPS emergency attach", </condition> </condition> <action> timer T3411 is started </action> and <end_state> the state is changed to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. </end_state> <control> <condition> When timer T3411 expires </condition> <action> the attach procedure shall be restarted, <condition> if still required by ESM sublayer. </condition> </action> </control> </control> </control> <control> d) <condition> If the attach attempt counter is equal to 5: </condition> a) <action> the UE shall delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs and KSI, </action> <action> shall set the update status to EU2 NOT UPDATED, </action> and <action> shall start timer T3402. </action> <end_state> The state is changed to EMM- DEREGISTERED.ATTEMPTING-TO-ATTACH or optionally to EMM-DEREGISTERED.PLMN- SEARCH </end_state> in order to perform a PLMN selection according to 3GPP TS 23.122 ; and <control> b) <condition> if A/Gb mode, Iu mode or N1 mode is supported by the UE: </condition> <control> a) <condition> if A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the abnormal case </condition> <condition> <condition> when a normal attach procedure fails </condition> and <condition> the attach attempt counter is equal to 5; </condition> </condition> </control> <control> b) <condition> if the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the abnormal case </condition> <condition> <condition> when an initial registration procedure performed over 3GPP access fails </condition> and <condition> the registration attempt counter is equal to 5; </condition> </condition> and c) <action> the UE shall attempt to select GERAN, UTRAN or NG-RAN radio access technology </action> and <action> proceed with appropriate GMM or 5GMM specific procedures. </action> <action> Additionally, the UE may disable the E-UTRA capability as specified in subclause 4.5. </action> </control> </control> </control> </control>
5.5.1.2.6A Abnormal cases in the UE, SMS services not accepted
The UE shall proceed as follows:
<control> <condition> 1) <condition> if the attach was successful for EPS services only </condition> and <condition> <condition> the ATTACH ACCEPT message contained a value included in the SMS services status IE not treated in subclause 5.5.1.2.4A </condition> or <condition> the SMS services status IE is not included in the message, </condition> </condition> </condition> the UE shall proceed as follows: <control> a) <action> The UE shall stop timer T3410 <condition> if still running. </condition> </action> <action> The tracking area updating attempt counter shall be incremented, <condition> unless it was already set to 5; </condition> </action> </control> <control> <condition> b) If the tracking area updating attempt counter is less than 5: </condition> <action> a) the UE shall start timer T3411, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <control> <condition> When timer T3411 expires </condition> <action> the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered; </action> </control> <control> <condition> c) If the tracking area updating attempt counter is equal to 5: </condition> a) <action> the UE shall start timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <control> <condition> When timer T3402 expires </condition> <action> the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered; </action> </control> </control> </control> </control> and
<control> <condition> 2) otherwise, </condition> <action> the abnormal cases specified in subclause 5.5.1.2.6 apply. </action> </control>
5.5.1.2.7 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) Lower layer failure; </condition> </control>
<control> <condition> <condition> If a lower layer failure occurs </condition> <condition> before the message ATTACH COMPLETE has been received from the UE, </condition> </condition> <action> the network shall locally abort the attach procedure, </action> <end_state> enter state EMM-DEREGISTERED </end_state> and <action> shall not resend the message ATTACH ACCEPT. </action> <control> <condition> If a new GUTI was assigned to the UE in the attach procedure, </condition> <action> the MME shall consider both the old and the new GUTI as valid </action> <condition> <condition> until the old GUTI can be considered as invalid by the network </condition> or <condition> the EMM context which has been marked as detached in the network is released. </condition> </condition> </control> </control>
<control> <condition> If the old GUTI was allocated by an MME other than the current MME, </condition> <action> the current MME does not need to retain the old GUTI. </action> </control>
<control> <condition> If the old GUTI is used by the UE in a subsequent attach message, </condition> <action> the network may use the identification procedure to request the UE's IMSI. </action> </control>
<control> <condition> b) Protocol error; </condition> </control>
<control> <condition> If the ATTACH REQUEST message is received with a protocol error, </condition> <action> the network shall return an ATTACH REJECT message </action> <action> with one of the following EMM cause values: #96: invalid mandatory information; #99: information element non-existent or not implemented; #100: conditional IE error; or #111: protocol error, unspecified. </action> </control>
<control> <condition> c) T3450 time-out; </condition> </control>
<control> <condition> On the first expiry of the timer, </condition> <action> the network shall retransmit the ATTACH ACCEPT message </action> and <action> shall reset and restart timer T3450. </action> </control>
<control> <action> This retransmission is repeated four times, </action> </control> i.e. <control> <condition> on the fifth expiry of timer T3450, </condition> <action> the attach procedure shall be aborted </action> and <end_state> the MME enters state EMM-DEREGISTERED. </end_state> <control> <condition> If a new GUTI was allocated in the ATTACH ACCEPT message, </condition> <action> the network shall consider both the old and the new GUTI as valid </action> <condition> until the old GUTI can be considered as invalid by the network or the EMM context which has been marked as detached in the network is released. </condition> </control> <control> <condition> If the old GUTI was allocated by an MME other than the current MME, </condition> <action> the current MME does not need to retain the old GUTI. </action> </control> </control>
<control> <condition> If the old GUTI is used by the UE in a subsequent attach message, </condition> <action> the network acts as specified for case a above. </action> </control>
<control> <condition> d) <condition> ATTACH REQUEST received </condition> <condition> after the ATTACH ACCEPT message has been sent </condition> and <condition> before the ATTACH COMPLETE message is received </condition> </condition> </control>
<control> <condition> a) If one or more of the information elements in the ATTACH REQUEST message differ from the ones received within the previous ATTACH REQUEST message, </condition> <action> the previously initiated attach procedure shall be aborted <condition> if the ATTACH COMPLETE message has not been received </condition> </action> and <action> the new attach procedure shall be progressed; </action> </control> or <control> <condition> b) if the information elements do not differ, </condition> <action> then the ATTACH ACCEPT message shall be resent </action> and <control> <action> the timer T3450 shall be restarted </action> <condition> if an ATTACH COMPLETE message is expected. </condition> <action> In that case, the retransmission counter related to T3450 is not incremented. </action> </control> </control>
<control> <condition> e) <condition> More than one ATTACH REQUEST received </condition> and <condition> no ATTACH ACCEPT or ATTACH REJECT message has been sent </condition> </condition> </control>
<control> <condition> a) If one or more of the information elements in the ATTACH REQUEST message differs from the ones received within the previous ATTACH REQUEST message, </condition> <action> the previously initiated attach procedure shall be aborted </action> and <action> the new attach procedure shall be executed; </action> </control> <control> <condition> b) if the information elements do not differ, </condition> <action> then the network shall continue with the previous attach procedure </action> and <action> shall ignore the second ATTACH REQUEST message. </action> </control>
<control> <condition> f) ATTACH REQUEST received in state EMM-REGISTERED </condition> </control>
<control> <condition> If an ATTACH REQUEST message is received </condition> <start_state> in state EMM-REGISTERED </start_state> <action> the network may initiate the EMM common procedures; </action> <control> <condition> if it turned out that the ATTACH REQUEST message was sent by a genuine UE that has already been attached, </condition> <action> the EMM context, EPS bearer contexts, if any, are deleted </action> and <action> the new ATTACH REQUEST is progressed. </action> </control> </control>
NOTE 1: The network can determine that the UE is genuine by executing the authentication procedure as described in subclause 5.4.2.
<control> <condition> g) TRACKING AREA UPDATE REQUEST message received before ATTACH COMPLETE message. </condition> </control>
<control> <action> Timer T3450 shall be stopped. </action> <action> The allocated GUTI in the attach procedure shall be considered as valid </action> and <action> the tracking area updating procedure shall be rejected </action> <action> with the EMM cause #10 "implicitly detached" as described in subclause 5.5.3.2.5. </action> </control>
<control> <condition> h) DETACH REQUEST message received before ATTACH COMPLETE message. </condition> </control>
<control> <action> The network shall abort the attach procedure </action> and <action> shall progress the detach procedure as described in subclause 5.5.2.2. </action> </control>
<control> <condition> i) <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> <condition> <condition> the MME receives an ATTACH REQUEST message </condition> <condition> with an ESM message included in the ESM message container information element, </condition> </condition> and <condition> the ESM sublayer in the MME detects a message error according to clause 7, </condition> </condition> <action> the MME may decide to proceed with the attach procedure </action> or <action> to reject it. </action> <control> <condition> When sending the ATTACH ACCEPT or ATTACH REJECT message to the UE, </condition> <action> the MME shall include the ESM message provide by the ESM layer in the ESM message container information element. </action> </control> </control>
<control> <condition> j) UE security capabilities invalid or unacceptable </condition> </control>
<control> <condition> <condition> <condition> If the ATTACH REQUEST message is received </condition> <condition> with invalid or unacceptable UE security capabilities (e.g. no EPS encryption algorithms (all bits zero), no EPS integrity algorithms (all bits zero), mandatory EPS encryption algorithms not supported or mandatory EPS integrity algorithms not supported, etc.), </condition> </condition> </condition> <action> the MME shall return an ATTACH REJECT message. </action> </control>
NOTE 2: EMM cause value to be used in ATTACH REJECT message is up to the network implementation.
5.5.1.3 Combined attach procedure for EPS services and non-EPS services
5.5.1.3.1 General
The combined attach procedure is used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for both EPS and non-EPS services, or both EPS services and "SMS only".
The combined attach procedure is also used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for EPS services if it is already IMSI attached for non-EPS services.
<control> <condition> When the UE initiates a combined attach procedure, </condition> <action> the UE shall indicate "combined EPS/IMSI attach" in the EPS attach type IE. </action> </control>
The combined attach procedure follows the attach procedure for EPS described in subclause 5.5.1.2 with exception of subclause 5.5.1.2.4A and subclause 5.5.1.2.6A.
5.5.1.3.2 Combined attach procedure initiation
<control> <start_state> If the UE is in EMM state EMM-DEREGISTERED, </start_state> <condition> the UE initiates the combined attach procedure </condition> <action> by sending an ATTACH REQUEST message to the network, </action> <action> starting timer T3410 </action> and <end_state> entering state EMM-REGISTERED- INITIATED (see example in figure 5.5.1.2.2.1). </end_state> </control>
<control> <action> The UE shall include the TMSI status IE </action> <condition> if no valid TMSI is available. </condition> </control> <control> <condition> Furthermore, if the UE has stored a valid location area identification, </condition> <action> the UE shall include it in the Old location area identification IE in the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE has stored a valid TMSI, </condition> <action> the UE shall include the TMSI based NRI container IE in the ATTACH REQUEST message. </action> </control>
<control> <condition> If the UE initiates a combined attach procedure for EPS services and "SMS only", </condition> <action> the UE shall indicate "SMS only" in the Additional update type IE. </action> </control>
5.5.1.3.3 EMM common procedure initiation
<control> <action> The network may initiate EMM common procedures, e.g. the identification, authentication and security mode control procedures, </action> <condition> depending on the received information such as IMSI, GUTI and KSI. </condition> </control>
5.5.1.3.4 Combined attach accepted by the network
5.5.1.3.4.1 General
<control> <condition> Depending on the value of the EPS attach result IE received in the ATTACH ACCEPT message, </condition> the following different cases can be distinguished: <control> <condition> 1) The EPS attach result IE value indicates "combined EPS/IMSI attach": </condition> <action> attach for EPS and non-EPS services, or for EPS services and "SMS only" have been successful. </action> </control> <control> <condition> 2) The EPS attach result IE value indicates "EPS only": </condition> <action> attach for EPS services has been successful but attach for non-EPS services or "SMS only" has failed. </action> </control> </control>
5.5.1.3.4.2 Combined attach successful
The description for attach for EPS services as specified in subclause 5.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services or "SMS only" applies.
The TMSI reallocation may be part of the combined attach procedure. <control> <condition> The TMSI allocated </condition> <action> is then included in the ATTACH ACCEPT message, </action> <action> together with the location area identification (LAI). </action> <action> In this case the MME shall start timer T3450 as described in subclause 5.4.1.4, </action> and <end_state> enter state EMM-COMMON-PROCEDURE-INITIATED. </end_state> <control> <condition> If the MME does not indicate "SMS only" in the ATTACH ACCEPT message, subject to operator policies </condition> <action> the MME should allocate a TAI list that does not span more than one location area. </action> </control> </control>
<control> <condition> For a shared network in CS domain, </condition> <action> the MME indicates the selected PLMN for CS domain in the LAI to the UE as specified in 3GPP TS 23.272 . </action> </control>
<control> <condition> The UE, receiving an ATTACH ACCEPT message, </condition> <action> stores the received location area identification, </action> <action> stops timer T3410, </action> <action> resets the location update attempt counter </action> and <action> sets the update status to U1 UPDATED. </action> <control> <condition> If the message contains an IMSI, </condition> <action> the UE is not allocated any TMSI, </action> and <action> shall delete any TMSI accordingly. </action> </control> <control> <condition> If the message contains a TMSI, </condition> <action> the UE shall use this TMSI as the new temporary identity. </action> <action> The UE shall delete its old TMSI </action> and <action> shall store the new TMSI. </action> </control> <control> <condition> If neither a TMSI nor an IMSI has been included by the network in the ATTACH ACCEPT message, </condition> <action> the old TMSI, <condition> if any available </condition> , shall be kept. </action> </control> </control>
<control> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events (see subclause 5.3.7b), </condition> <action> then the UE shall reset this counter. </action> </control>
<control> <condition> <condition> If the UE requested "SMS only" in the Additional update type IE, </condition> or <condition> if the UE requested a combined attach for EPS and non-EPS services, </condition> </condition> <condition> but the network decides to accept the attach request for EPS services and "SMS only", </condition> <action> the network shall indicate "SMS only" in the Additional update result IE. </action> <control> <condition> In addition, if the SMS services are provided via SMS in MME, </condition> <action> the network shall provide a non-broadcast LAI in the ATTACH ACCEPT message. </action> </control> <control> <condition> If a TMSI has to be allocated, </condition> <action> then the network shall also provide a TMSI value </action> <condition> which cannot cause any ambiguity with assigned TMSI values. </condition> </control> </control>
<control> <condition> If the ATTACH ACCEPT message includes the Additional update result IE with value "SMS only", </condition> <condition> <condition> a UE operating in CS/PS mode 2 </condition> and <condition> a UE operating in CS/PS mode 1 with "IMS voice available" </condition> </condition> <action> shall not attempt to use CS fallback for mobile originating services. </action> </control>
<control> As an implementation option, <condition> <condition> if the ATTACH ACCEPT message does not include the Additional update result IE with value "SMS only" </condition> and <condition> the UE is not configured for NAS signaling low priority </condition> </condition> <action> then the UE may stop timer T3246 <condition> if running. </condition> </action> </control>
<control> <condition> If the ATTACH ACCEPT message includes the Additional update result IE with value "CS Fallback not preferred", </condition> this indicates to <condition> a UE operating in CS/PS mode 2 </condition> and <condition> <condition> a UE operating in CS/PS mode 1 </condition> <condition> with "IMS voice available" </condition> </condition> that <action> it is attached for EPS and non-EPS services </action> and <action> that it can use CS fallback. </action> </control>
<control> <condition> If the LAI contained in the ATTACH ACCEPT message </condition> <condition> is a member of the list of "forbidden location areas for regional provision of service" or the list of "forbidden location areas for roaming" </condition> <action> then such entry shall be deleted. </action> </control>
<control> <condition> If the PLMN identity for the CS domain which is provided as part of the LAI contained in the ATTACH ACCEPT message differs from the PLMN identity provided as part of the GUTI, the MME shall include the PLMN identity for the CS domain in the list of equivalent PLMNs in the ATTACH ACCEPT message. </condition> <condition> The UE, <condition> when having requested PDN connectivity as contained in the ATTACH REQUEST </condition> and <condition> on receiving the ATTACH ACCEPT message combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> </condition> <action> shall send an ATTACH COMPLETE message combined with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message to the network. </action> </control>
<control> <condition> Upon transmission of the ATTACH COMPLETE message </condition> <end_state> the UE shall enter state EMM-REGISTERED </end_state> and <end_state> MM state MM-IDLE </end_state> and <action> set the EPS update status to EU1 UPDATED. </action> </control>
<control> <condition> If the ATTACH ACCEPT message includes the Additional update result IE with value "SMS only" or "CS Fallback not preferred", </condition> <condition> a UE operating in CS/PS mode 1 with "IMS voice not available" </condition> <action> shall attempt to select GERAN or UTRAN radio access technology </action> and <action> disable the E-UTRA capability (see subclause 4.5). </action> </control>
<control> <condition> Upon receiving an ATTACH COMPLETE message, </condition> <action> the MME shall stop timer T3450, </action> <end_state> enter state EMM- REGISTERED. </end_state> </control>
NOTE: <control> <condition> Upon receiving an ATTACH COMPLETE message, </condition> <action> the MME sends an SGsAP-TMSI- REALLOCATION-COMPLETE message as specified in 3GPP TS 29.118 . </action> </control>
<control> <condition> After the UE performs intersystem change from N1 mode to S1 mode, </condition> <condition> if: <condition> a) the network supports SRVCC for IMS emergency sessions (see 3GPP TS 23.216 ); </condition> <condition> b) the UE has an emergency PDN connection; </condition> <condition> c) the UE has set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported; </condition> and <condition> d) the MME has neither an IMEI nor an IMEISV for the UE; </condition> </condition> <action> then the MME shall initiate the identification procedure (see subclause 5.4.4) or the security mode control procedure (see subclause 5.4.3) with the UE. </action> </control>
5.5.1.3.4.3 Combined attach successful for EPS services only
Apart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in subclause 5.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services applies.
<control> <condition> If, <condition> due to emergency services fallback (see 3GPP TS 23.502 , subclause 4.13.4), </condition> <condition> there is a request for emergency services pending </condition> and <condition> the emergency bearer services indicator in the EPS network feature support IE indicates "emergency bearer services in S1 mode not supported", </condition> </condition> <action> then the UE shall skip the requirements defined below in the present subclause <condition> for the receipt of an ATTACH ACCEPT message including an EMM cause value, </condition> </action> <action> attempt to select GERAN or UTRAN radio access technology, </action> <action> select a setup message as defined in subclause 5.3.7, </action> <action> proceed with appropriate MM specific procedures, </action> and <action> send the setup message. </action> </control>
<control> <condition> The UE receiving the ATTACH ACCEPT message </condition> <action> takes one of the following actions depending on the EMM cause value: </action> </control>
<control> <condition> #2 (IMSI unknown in HSS) </condition> </control>
<control> <action> The UE shall stop T3410 if still running </action> and <action> shall reset the tracking area updating attempt counter. </action> <action> The UE shall set the update status to U3 ROAMING NOT ALLOWED </action> and <action> shall delete any TMSI, LAI and ciphering key sequence number. </action> <end_state> The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <end_state> The new MM state is MM IDLE. </end_state> <control> <action> The USIM shall be considered as invalid for non-EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in subclause 5.3.7a. </condition> </condition> </control> <control> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> If, <condition> due to emergency services fallback (see 3GPP TS 23.502 ), </condition> <condition> there is a request for CS fallback call pending (see subclause 5.3.7), </condition> </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology </action> and <action> attempt emergency call setup. </action> </control>
<control> <condition> #16 (MSC temporarily not reachable); or #17 (Network failure) </condition> </control>
<control> <action> The UE shall stop timer T3410 <condition> if still running, </condition> </action> and <end_state> shall enter state MM IDLE. </end_state> <action> The tracking area updating attempt counter shall be incremented, <condition> unless it was already set to 5. </condition> </action> </control>
<control> <condition> If the tracking area updating attempt counter is less than 5: </condition> <action> a) the UE shall start timer T3411, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. </end_state> <control> <condition> When timer T3411 expires </condition> <action> the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered. </action> </control> </control>
<control> <condition> If the tracking area updating attempt counter is equal to 5: </condition> <control> <condition> a) <condition> a UE operating in CS/PS mode 2 of operation </condition> and <condition> a UE operating in CS/PS mode 1 of operation with "IMS voice available" </condition> </condition> <action> shall start timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. </end_state> <control> <condition> When timer T3402 expires </condition> <action> the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered; </action> </control> </control> <control> <condition> b) <condition> a UE operating in CS/PS mode 1 of operation </condition> <condition> with "IMS voice not available" </condition> </condition> <action> shall attempt to select GERAN or UTRAN radio access technology </action> and <action> proceed with appropriate MM or GMM specific procedures </action> and <action> disable the E-UTRA capability (see subclause 4.5). </action> </control> </control>
<control> <condition> #18 (CS domain not available) </condition> </control>
<control> <action> The UE shall stop timer T3410 <condition> if still running, </condition> </action> <action> shall reset the tracking area updating attempt counter, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and shall <end_state> enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> </control>
<control> <end_state> The UE shall enter state MM IDLE </end_state> and <action> shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <condition> A UE in CS/PS mode 1 of operation with "IMS voice not available" </condition> <action> shall attempt to select GERAN or UTRAN radio access technology </action> and <action> disable the E-UTRA capability (see subclause 4.5). </action> </control>
<control> <condition> <condition> A UE in CS/PS mode 2 of operation </condition> and <condition> a UE operating in CS/PS mode 1 of operation with "IMS voice available" </condition> </condition> <action> may provide a notification to the user or the upper layers that the CS domain is not available. </action> </control>
<control> <action> The UE shall not attempt combined attach or combined tracking area updating procedures with current PLMN </action> <condition> until <condition> switching off the UE </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control>
<control> <condition> #22 (Congestion) </condition> </control>
<control> <action> The UE shall stop the timer T3410 <condition> if still running. </condition> </action> <action> The tracking area updating attempt counter shall be set to 5. </action> <action> The UE shall start the timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED, </action> <end_state> shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, </end_state> and <end_state> shall enter state MM IDLE. </end_state> </control>
<control> <condition> <condition> Other EMM cause values </condition> and <condition> the case that no EMM cause IE was received </condition> </condition> <action> are considered as abnormal cases. </action> <action> The combined attach procedure shall be considered as failed for non-EPS services. </action> <action> The behaviour of the UE in those cases is specified in subclause 5.5.1.3.6. </action> </control>
5.5.1.3.5 Combined attach not accepted by the network
<control> <condition> If the attach request can neither be accepted by the network for EPS nor for non-EPS services, </condition> <action> the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value. </action> <control> <condition> <condition> If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> <condition> the attach request included a PDN CONNECTIVITY REQUEST message, </condition> and <condition> <condition> the attach procedure fails </condition> <condition> due to <condition> a default EPS bearer setup failure, </condition> <condition> an ESM procedure failure </condition> or <condition> operator determined barring, </condition> </condition> </condition> </condition> the MME shall: <control> <action> a) combine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message contained in the ESM message container information element. </action> <action> In this case the EMM cause value in the ATTACH REJECT message shall be set to #19, "ESM failure"; </action> </control> or <control> <action> b) send the ATTACH REJECT message with the EMM cause set to #15 "No suitable cells in tracking area" , </action> <condition> if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP TS 29.274 for further details). </condition> <action> In this case, the network may additionally include the Extended EMM cause IE with value "E- UTRAN not allowed". </action> </control> </control> </control>
<control> <condition> <condition> If the attach request is rejected </condition> <condition> due to NAS level mobility management congestion control, </condition> </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> assign a back-off timer T3346. </action> </control>
<control> <condition> <condition> If the attach request is rejected </condition> <condition> due to <condition> service gap control as specified in subclause 5.3.17 i.e. </condition> <condition> the T3447 timer is running, </condition> </condition> </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> may assign a back-off timer T3346 with the remaining time of the running T3447 timer. </action> </control>
<control> <condition> Based on operator policy, </condition> <condition> <condition> if the attach request is rejected </condition> <condition> due to core network redirection for CIoT optimizations, </condition> </condition> <action> the network shall set the EMM cause value to #31 "Redirection to 5GCN required". </action> </control>
NOTE 1: The network can take into account the UEs N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 "Redirection to 5GCN required".
<control> <condition> Upon receiving the ATTACH REJECT message, </condition> <condition> <condition> if the message is integrity protected </condition> or <condition> contains a reject cause other than EMM cause value #25, </condition> </condition> <action> the UE shall stop timer T3410 </action> and <end_state> enter MM state MM IDLE. </end_state> </control>
<control> <condition> <condition> If the ATTACH REJECT message with EMM cause #25 was received </condition> <condition> without integrity protection, </condition> </condition> <action> then the UE shall discard the message. </action> </control>
The UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.
<control> <condition> #3 (Illegal UE); #6 (Illegal ME); or #8 (EPS services and non-EPS services not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> </control>
<control> <action> The UE shall consider the USIM as invalid for EPS and non-EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in subclause 5.3.7a. </condition> </condition> </control> <control> <action> Additionally, the UE shall delete the list of equivalent PLMNs </action> and <end_state> shall enter the state EMM-DEREGISTERED.NO-IMSI. </end_state> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case when the <condition> combined attach procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> </control>
<control> <condition> For the EMM cause value #3 or #6, </condition> <condition> if the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the initial registration procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> For the EMM cause value #8, </condition> <condition> if the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, </end_state> <action> 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #7 (EPS services not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> </control> <control> <action> The UE shall consider the USIM as invalid for EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in subclause 5.3.7a. </condition> </condition> </control> <control> <end_state> Additionally, the UE shall enter the state EMM- DEREGISTERED. </end_state> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control>
<control> <condition> A UE which is already IMSI attached for non-EPS services </condition> <action> is still IMSI attached for non-EPS services </action> and <action> shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <action> The UE shall attempt to select GERAN or UTRAN radio access technology </action> and <action> shall proceed with the appropriate MM specific procedure <condition> according to the MM service state. </condition> </action> </control> <control> <action> The UE shall not reselect E-UTRAN radio access technology </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the combined attach procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the initial registration procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #11 (PLMN not allowed); or #35 (Requested service option not authorized in this PLMN); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI, </action> and <action> reset the attach attempt counter. </action> <action> The UE shall delete the list of equivalent PLMNs </action> and <end_state> enter the state EMM- DEREGISTERED.PLMN-SEARCH. </end_state> </control>
<control> <action> The UE shall store the PLMN identity in the "forbidden PLMN list" </action> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a PLMN-specific attempt counter for that PLMN, </condition> </condition> <action> then the UE shall set this counter to the UE implementation-specific maximum value. </action> </control> </control>
<control> <action> The UE shall perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> For the EMM cause value #11, </condition> <condition> if the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the initial registration procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> For the EMM cause value #35, </condition> <condition> if the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, </end_state> <action> 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #12 (Tracking area not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> The UE shall reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". </action> <action> delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> If the ATTACH REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the initial registration procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #13 (Roaming not allowed in this tracking area); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> The UE shall delete the list of equivalent PLMNs </action> and <action> reset the attach attempt counter. </action> <end_state> Additionally the UE enter the state EMM- DEREGISTERED.LIMITED-SERVICE </end_state> or <end_state> optionally EMM-DEREGISTERED.PLMN-SEARCH. </end_state> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". </action> </control> <control> <condition> If the ATTACH REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. </action> </control>
<control> <condition> <condition> If the UE is registered in N1 mode </condition> and <condition> operating in dual-registration mode, </condition> </condition> <action> the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 subclause 4.8.3. </action> </control> <control> <condition> Otherwise </condition> <action> the UE shall perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the initial registration procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #14 (EPS services not allowed in this PLMN); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> Additionally the UE shall reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED.PLMN-SEARCH. </end_state> </control>
<control> <action> The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list </action> </control> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a PLMN-specific PS-attempt counter for that PLMN, </condition> </condition> <action> then the UE shall set this counter to the UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <condition> which is already IMSI attached for non-EPS services </condition> </condition> <action> is still IMSI attached for non-EPS services </action> and <action> shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <condition> <condition> A UE operating in CS/PS mode 1 of operation </condition> and <condition> supporting A/Gb or Iu mode </condition> </condition> <action> may select GERAN or UTRAN radio access technology </action> and <action> proceed with the appropriate MM specific procedure according to the MM service state. </action> <action> In this case, the UE shall disable the E-UTRA capability (see subclause 4.5). </action> </control>
<control> <condition> <condition> A UE operating in CS/PS mode 1 of operation </condition> and <condition> supporting A/Gb or Iu mode </condition> </condition> <action> may perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> <condition> <condition> A UE operating in CS/PS mode 1 of operation </condition> and <condition> supporting S1 mode only, </condition> </condition> or <condition> operating in CS/PS mode 2 of operation </condition> </condition> <action> shall delete the list of equivalent PLMNs </action> and <action> shall perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED, </end_state> <action> 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #15 (No suitable cells in tracking area); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> Additionally the UE shall reset the attach attempt counter </action> and <end_state> enter the state EMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". </action> </control> <control> <condition> If the ATTACH REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. </action> Additionally, the UE shall proceed as follows: <control> a) <condition> <condition> if the UE is in WB-S1 mode </condition> and <condition> the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the ATTACH REJECT message, </condition> </condition> <action> the UE supports "E-UTRA Disabling for EMM cause #15", </action> and <action> the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 or 3GPP TS 31.102 is present and set to enabled, </action> <action> then the UE shall disable the E-UTRA capability as specified in subclause 4.5 </action> and <action> search for a suitable cell in another location area or 5GS tracking area; </action> </control> <control> b) <condition> <condition> if the UE is in NB-S1 mode </condition> and <condition> the Extended EMM cause IE with value "NB-IoT not allowed" is included in the ATTACH REJECT message, </condition> </condition> <action> then the UE may disable the NB-IoT capability as specified in subclause 4.9 </action> and <action> search for a suitable cell in E-UTRAN radio access technology; </action> </control> <control> c) <condition> otherwise, </condition> <action> the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 . </action> </control> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the initial registration procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #22 (Congestion); </condition> </control>
<control> <condition> <condition> If the T3346 value IE is present in the ATTACH REJECT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> <action> the UE shall proceed as described below; </action> </control> <control> <condition> otherwise </condition> <action> it shall be considered as an abnormal case </action> and <action> the behaviour of the UE for this case is specified in subclause 5.5.1.3.6. </action> </control>
<control> <action> The UE shall abort the attach procedure, </action> <action> reset the attach attempt counter, </action> <action> set the EPS update status to EU2 NOT UPDATED </action> and <end_state> enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. </end_state> </control>
<control> <action> The UE shall stop timer T3346 if it is running. </action> </control>
<control> <condition> If the ATTACH REJECT message is integrity protected, </condition> <action> the UE shall start timer T3346 with the value provided in the T3346 value IE. </action> </control>
<control> <condition> If the ATTACH REJECT mess age is not integrity protected, </condition> <action> the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 . </action> </control>
<control> <action> The UE stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> <action> The attach procedure is started <condition> if still needed </condition> <condition> <condition> when timer T3346 expires </condition> or <condition> is stopped. </condition> </condition> </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the combined attach procedure is rejected with the GMM cause </condition> <condition> with the same value. </condition> </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the initial registration procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #25 (Not authorized for this CSG); </condition> </control>
<control> <action> EMM cause #25 is only applicable </action> <condition> when received from a CSG cell. </condition> </control> <control> <condition> EMM cause #25 received from a non-CSG cell </condition> <action> is considered as an abnormal case </action> and <action> the behaviour of the UE is specified in subclause 5.5.1.3.6. </action> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). </action> <action> Additionally, the UE shall reset the attach attempt counter </action> and <end_state> shall enter the state EMM- DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, </condition> <action> the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list. </action> </control>
<control> <condition> If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, </condition> <action> the UE shall apply the procedures defined in 3GPP TS 23.122 subclause 3.1A. </action> </control>
<control> <action> The UE shall search for a suitable cell according to 3GPP TS 36.304 . </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the MM parameters update status and location update attempt counter, and GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008. </action> <condition> for the case <condition> when the combined attach procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED </end_state> and <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED. </action> </control>
<control> <condition> #42 (Severe network failure); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU2 NOT UPDATED, </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, </action> and <action> set the attach attempt counter to 5. </action> <action> The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 . </action> <control> <condition> While this timer is running, </condition> <action> the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. </action> <end_state> The UE then enters state EMM- DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 . </end_state> </control> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <end_state> the UE shall in addition set the GMM state to GMM- DEREGISTERED, </end_state> <action> GPRS update status to GU2 NOT UPDATED signature, </action> <action> RAI and GPRS ciphering key sequence number TMSI and ciphering key sequence number. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED, </end_state> <action> 5GS update status to 5U2 NOT UPDATED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #31 (Redirection to 5GCN required); </condition> </control>
<control> <condition> <condition> EMM cause #31 received by a UE </condition> <condition> that has not indicated support for CIoT optimizations </condition> </condition> <action> is considered as an abnormal case </action> and <action> the behaviour of the UE is specified in subclause 5.5.1.3.6. </action> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> Additionally, the UE shall reset the attach attempt counter. </action> </control>
<control> <action> The UE shall enable N1 mode capability for 3GPP access </action> <condition> if it was disabled and disable the E-UTRA capability </condition> (see subclause 4.5) and <end_state> enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE. </end_state> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the initial registration procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <action> Other values are considered as abnormal cases. </action> <action> The behaviour of the UE in those cases is specified in subclause 5.5.1.3.6. </action> </control>
5.5.1.3.6 Abnormal cases in the UE
The UE shall proceed as follows:
<control> 1) <condition> <condition> if the UE requested the combined attach for EPS services and "SMS only" </condition> and <condition> the ATTACH ACCEPT message indicates a combined attach successful for EPS and non-EPS services, </condition> </condition> <action> the UE shall behave as if the combined attach was successful for EPS services and "SMS only"; </action> NOTE: <action> In this case the UE can ignore the CS SERVICE NOTIFICATION message or the Paging with CN domain indicator set to "CS", as specified in subclause 5.6.2.3.2. </action> </control>
<control> 3) <condition> <condition> if the combined attach was successful for EPS services only <condition> and <condition> <condition> the ATTACH ACCEPT message contained an EMM cause value not treated in subclause 5.5.1.3.4.3 </condition> or <condition> the EMM cause IE is not included in the message, </condition> </condition> </condition> </condition> </condition> the UE shall proceed as follows: <control> a) <action> The UE shall stop timer T3410 <condition> if still running, </condition> </action> and <end_state> shall enter state MM IDLE. </end_state> <action> The tracking area updating attempt counter shall be incremented, <condition> unless it was already set to 5; </condition> </action> </control> <control> b) <condition> If the tracking area updating attempt counter is less than 5: </condition> <action> a) the UE shall start timer T3411, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. </end_state> <control> <condition> When timer T3411 expires </condition> <action> the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered; </action> </control> </control> <control> c) <condition> If the tracking area updating attempt counter is equal to 5: </condition> <control> a) <condition> <condition> a UE operating in CS/PS mode 2 of operation </condition> and <condition> a UE operating in CS/PS mode 1 of operation with "IMS voice available" </condition> </condition> <action> shall start timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED. ATTEMPTING-TO-UPDATE-MM. </end_state> <control> <condition> When timer T3402 expires </condition> <action> the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered; </action> </control> </control> and <control> b) <condition> <condition> a UE operating in CS/PS mode 1 of operation </condition> <condition> with "IMS voice not available" </condition> </condition> <action> shall attempt to select GERAN or UTRAN radio access technology </action> and <action> proceed with appropriate MM or GMM specific procedures </action> and <action> disable the E-UTRA capability (see subclause 4.5); </action> </control> </control> and <control> d) <condition> <condition> If there is a CS fallback emergency call pending </condition> or <condition> CS fallback call pending, </condition> </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures; </action> </control> <control> <condition> otherwise </condition> <action> the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer; </action> </control> </control> </control> and
<control> 3) <condition> otherwise, </condition> <action> the abnormal cases specified in subclause 5.5.1.2.6 apply with the following modification. </action> <condition> If the attach attempt counter is incremented according to subclause 5.5.1.2.6 </condition> <action> the next actions depend on the value of the attach attempt counter: </action> <control> <condition> a) if the attach attempt counter is less than 5, </condition> <action> the UE shall set the update status to U2 NOT UPDATED </action> but <action> shall not delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs; </action> </control> or <control> <condition> b) if the attach attempt counter is equal to 5, </condition> <action> then the UE shall delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs </action> and <action> set the update status to U2 NOT UPDATED. </action> <action> The UE shall attempt to select GERAN, UTRAN or NG-RAN radio access technology </action> and <action> proceed with appropriate MM, GMM or 5GMM specific procedures. </action> <action> Additionally, the UE may disable the E-UTRA capability as specified in subclause 4.5. </action> </control> </control>
<control> <condition> If there is a CS fallback emergency call pending or CS fallback call pending, </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> </control> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures; </action> </control> <control> <condition> otherwise </condition> <action> the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer. </action> </control>
5.5.1.3.7 Abnormal cases on the network side
The abnormal cases specified in subclause 5.5.1.2.7 apply.
5.5.2 Detach procedure
5.5.2.1 General
The detach procedure is used: a) by the UE to detach for EPS services only; b) by the UE to disconnect from the last remaining PDN it is connected to if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; c) by the UE in CS/PS mode 1 or CS/PS mode 2 of operation to detach for both EPS services and non-EPS services or for non-EPS services only via a combined detach procedure; d) by the network to inform the UE that it is detached for EPS services or non-EPS services or both; e) by the network to disconnect the UE from the last remaining PDN to which it is connected if EMM- REGISTERED without PDN connection is not supported by the UE or the MME; and f) by the network to inform the UE to re-attach to the network and re-establish all PDN connections.
NOTE 1: <control> <condition> After a successful completion of an inter-system change of the UE from S1 mode to non-3GPP access, </condition> <condition> <condition> if the non-3GPP network provides PDN connectivity to the same EPC </condition> and <condition> EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> </condition> <action> the MME performs a local detach of the UE. </action> </control>
NOTE 2: <control> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> <action> the detach procedure is not triggered </action> <condition> when disconnecting the UE from the last remaining PDN to which it is connected. </condition> </control>
<control> <action> The detach procedure also applies </action> <condition> to the UE which is IMSI attached for "SMS only". </condition> </control>
<control> <action> The detach procedure with appropriate detach type shall be invoked </action> <condition> <condition> by the UE if the UE is switched off, </condition> <condition> the USIM card is removed from the UE, </condition> <condition> the UE wishes to detach for EPS services, </condition> <condition> the UE wishes to detach for non-EPS services </condition> or <condition> as part of the eCall inactivity procedure defined in subclause 5.5.4. </condition> </condition> </control>
<control> <condition> If the detach procedure is triggered due to USIM removal, </condition> <action> the UE shall indicate "switch off" in the detach type IE. </action> </control>
<control> <condition> When upper layers indicates that emergency bearer services are no longer required, </condition> <condition> the UE if still attached for emergency bearer services, </condition> <action> may perform a detach </action> <action> followed by a re-attach to regain normal services, <condition> if the UE is in or moves to a suitable cell. </condition> </action> </control>
<control> <condition> If a detach is requested by the HSS for a UE that has bearers for emergency services, </condition> <action> the MME shall not send a DETACH REQUEST message to the UE, </action> and <action> shall follow the procedures in subclause 6.4.4.1 for a UE that has bearers for emergency services. </action> </control>
<control> <condition> If the detach procedure for EPS services is performed, </condition> <action> the EPS bearer context(s), if any, for this particular UE are deactivated locally without peer-to-peer signalling between the UE and the MME. </action> </control>
<control> <condition> If the UE supports A/Gb mode or Iu mode or both, </condition> <action> the UE shall store the TIN in the non-volatile memory in the ME, as described in annex C, for a subsequent attach procedure. </action> </control>
<control> <action> The UE is allowed to initiate the detach procedure </action> <condition> even if the timer T3346 is running. </condition> </control>
The network proceeds with the detach procedure even if NAS level mobility management congestion control is active.
5.5.2.2 UE initiated detach procedure
5.5.2.2.1 UE initiated detach procedure initiation
<control> <condition> The detach procedure is initiated by the UE </condition> <action> by sending a DETACH REQUEST message (see example in figure 5.5.2.2.1.1). </action> The Detach type IE included in the message indicates whether detach is due to a "switch off" or not. </control>
The Detach type IE also indicates whether the detach is for EPS services only, for non-EPS services only, or for both. <control> <condition> If the UE has a mapped EPS security context as the current EPS security context, </condition> <action> the UE shall set the type of security context flag to "mapped security context". </action> </control> <control> <condition> Otherwise, </condition> <action> the UE shall set the type of security context flag to "native security context". </action> </control>
<control> <condition> If the UE has a valid GUTI, </condition> <action> the UE shall populate the EPS mobile identity IE with the valid GUTI. </action> </control> <control> <condition> If the UE does not have a valid GUTI, </condition> <action> the UE shall populate the EPS mobile identity IE with its IMSI. </action> </control>
<control> <condition> <condition> If the UE does not have a valid GUTI </condition> and <condition> it does not have a valid IMSI, </condition> </condition> <action> then the UE shall populate the EPS mobile identity IE with its IMEI. </action> </control>
NOTE: <control> <condition> During the attach for emergency bearer services or attach for access to RLOS </condition> <start_state> when the UE (with no USIM or invalid USIM) is in EMM-REGISTERED-INITIATED STATE, </start_state> <action> the UE has neither a valid GUTI nor a valid IMSI. </action> </control>
<control> <condition> If the detach is not due to switch off </condition> <start_state> and the UE is in the state EMM-REGISTERED or EMM-REGISTERED- INITIATED, </start_state> <action> timer T3421 shall be started in the UE </action> <condition> after the DETACH REQUEST message has been sent. </condition> <control> <condition> If the detach type indicates that the detach is for non-EPS services only </condition> <end_state> the UE shall enter the state EMM-REGISTERED.IMSI- DETACH-INITIATED, </end_state> </control> <control> <condition> otherwise </condition> <end_state> the UE shall enter the state EMM-DEREGISTERED-INITIATED. </end_state> </control> <control> <condition> If the detach type indicates that the detach is for non-EPS services or both EPS and non-EPS services, </condition> <end_state> the UE shall enter the state MM IMSI DETACH PENDING. </end_state> </control> </control>
<control> <condition> <condition> If the UE to be switched off </condition> <condition> <condition> is not operating in NB-S1 mode </condition> and <condition> not operating in WB-S1 mode in any enhanced coverage CE mode, </condition> </condition> </condition> <action> the UE shall try for a period of 5 seconds to send the DETACH REQUEST message. </action> </control> <control> <condition> If the UE to be switched off:- </condition> <control> <condition> a) is operating in NB-S1 mode, </condition> <action> then the UE should try for at least a period of 85 seconds to send the DETACH REQUEST; </action> </control> or <control> <condition> b) is operating in WB-S1 mode in any enhanced coverage CE mode, </condition> <action> then the UE should try for at least a period of 14 seconds to send the DETACH REQUEST. </action> </control> </control>
<control> <condition> During this period, </condition> <action> the UE may be switched off </action> <condition> as soon as the DETACH REQUEST message has been sent. </condition> </control>
<control> <condition> After the last DETACH REQUEST message is sent, </condition> the UE shall proceed as follows: <control> <condition> a) if the current EPS security context is a native EPS security context, </condition> <action> then the UE shall store the current EPS security context as specified in annex C and mark it as valid; </action> </control> <control> <condition> b) <condition> <condition> else </condition> <condition> </condition> if the current EPS security context is a mapped EPS security context </condition> and <condition> a non-current full native EPS security context exists, </condition> </condition> <action> then the UE shall store the non-current EPS security context as specified in annex C and mark it as valid, </action> and <action> finally the UE shall delete any mapped EPS security context or partial native EPS security context. </action> </control> </control>
5.5.2.2.2 UE initiated detach procedure completion for EPS services only
<control> <condition> When the DETACH REQUEST message is received by the network, </condition> <control> <action> the network shall send a DETACH ACCEPT message to the UE, </action> <condition> if the Detach type IE does not indicate "switch off". </condition> </control> <control> <condition> Otherwise, </condition> <action> the procedure is completed </action> <condition> when the network receives the DETACH REQUEST message. </condition> </control> </control>
<control> <action> The network and the UE shall deactivate the EPS bearer context(s), </action> <condition> if any, </condition> <condition> for this UE locally without peer-to-peer signalling between the UE and the MME. </condition> </control>
<control> <action> The UE is marked as inactive in the network for EPS services. </action> <end_state> The network shall enter the state EMM- DEREGISTERED. </end_state> </control>
<control> <condition> The UE, when receiving the DETACH ACCEPT message, </condition> <action> shall stop timer T3421. </action> <control> <condition> Furthermore, <condition> <condition> if the UE is operating in PS mode of operation, </condition> or <condition> is operating in CS/PS mode of operation </condition> </condition> and <condition> supports S1 mode only </condition> </condition> then: <control> <condition> a) If the detach procedure was performed due to disabling of EPS services, </condition> <end_state> then the UE shall enter the EMM- NULL state. </end_state> </control> <control> <condition> b) Otherwise, </condition> <end_state> the UE shall enter the EMM-DEREGISTERED state. </end_state> </control> </control> </control>
<control> <condition> <condition> <condition> The UE operating in CS/PS mode 1 </condition> or <condition> CS/PS mode 2 of operation, </condition> </condition> and <condition> supporting A/Gb mode or Iu mode, </condition> </condition> <action> shall further set the update status to U2 NOT UPDATED, </action> <action> disable the E-UTRA capability (see subclause 4.5) </action> and <action> attempt to select GERAN or UTRAN access technology. </action> </control>
5.5.2.2.3 UE initiated combined detach procedure completion
<control> <condition> When the DETACH REQUEST message is received by the network, </condition> <action> a DETACH ACCEPT message shall be sent to the UE, </action> <condition> if the Detach type IE does not indicate "switch off". </condition> </control> <control> <condition> Otherwise, </condition> <action> the procedure is completed </action> <condition> when the network receives the DETACH REQUEST message. </condition> </control>
<control> <condition> Depending on the value of the Detach type IE </condition> the following applies: <control> <condition> a) combined EPS/IMSI detach: </condition> <action> The network and the UE shall deactivate the EPS bearer context(s) for this UE locally without peer-to-peer signalling between the UE and the MME. </action> <action> The UE is marked as inactive in the network for EPS and for non-EPS services. </action> <end_state> The states EMM-DEREGISTERED and MM-NULL are entered in both the UE and the network. </end_state> </control> <control> <condition> b) IMSI detach: </condition> <action> The UE is marked as inactive in the network for non-EPS services. </action> <end_state> The states MM-NULL and EMM- REGISTERED are entered in both the UE and the net work. </end_state> </control> </control>
<control> <condition> The UE, when receiving the DETACH ACCEPT message, </condition> <action> shall stop timer T3421. </action> </control>
5.5.2.2.4 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) <condition> Access barred </condition> <condition> because of access class barring, EAB or NAS signalling connection establishment rejected by the network </condition> </condition> </control>
<control> <condition> In WB-S1 mode, </condition> <condition> if access is barred for "originating signalling" (see 3GPP TS 36.331 ), </condition> <action> the detach signalling procedure shall not be started. </action> <action> The UE stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> <control> <action> The detach signalling procedure is started </action> <condition> <condition> as soon as possible </condition> and <condition> if still necessary, </condition> </condition> i.e. <condition> <condition> when access for "originating signalling" is granted on the current cell </condition> or <condition> when the UE moves to a cell where access for "originating signalling" is granted. </condition> </condition> </control> <control> <action> The UE may perform a local detach </action> <condition> either <condition> immediately </condition> or <condition> after an implementation dependent time. </condition> </condition> </control> </control>
<control> <condition> In NB-S1 mode, </condition> <condition> if access is barred for "originating signalling" (see 3GPP TS 36.331 ), </condition> <action> the detach signalling procedure shall not be started. </action> <action> The UE stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> <action> Further UE behaviour is implementation specific, </action> e.g. <control> <action> the detach signalling procedure is started again </action> <condition> after an implementation dependent time. </condition> </control> </control>
NOTE 1: In NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 ).
<control> <condition> b) <condition> <condition> Lower layer failure </condition> or <condition> release of the NAS signalling connection </condition> </condition> <condition> before reception of DETACH ACCEPT message </condition> </condition> </control>
<control> <action> The detach procedure shall be aborted </action> and the UE proceeds as follows: <control> <condition> a) if the detach procedure was performed due to disabling of EPS services, </condition> <end_state> the UE shall enter the EMM-NULL state; </end_state> </control> <control> <condition> b) if "EPS detach" was requested for reasons other than disabling of EPS services, </condition> <end_state> the UE shall enter the EMM- DEREGISTERED state; </end_state> </control> <control> <condition> c) if "IMSI detach" was requested, </condition> <end_state> the UE shall enter the EMM-REGISTERED.NORMAL-SERVICE state and the MM-NULL state; </end_state> </control> or <control> <condition> d) if "combined EPS/IMSI detach" was requested, </condition> <end_state> the UE shall enter the EMM-DEREGISTERED state and the MM-NULL state. </end_state> </control> </control>
<control> <condition> On the first four expiries of the timer, </condition> <action> the UE shall retransmit the DETACH REQUEST message </action> and <action> shall reset and restart timer T3421. </action> </control> <control> <condition> On the fifth expiry of timer T3421, </condition> <action> the detach procedure shall be aborted </action> and the UE proceeds as follows: <control> <condition> a) if the detach procedure was performed due to disabling of EPS services, </condition> <end_state> the UE shall enter the EMM-NULL state; </end_state> </control> <control> <condition> b) if "EPS detach" was requested for reasons other than disabling of EPS services, </condition> <end_state> the UE shall enter the EMM- DEREGISTERED state; </end_state> </control> <control> <condition> c) if "IMSI detach" was requested, </condition> <end_state> the UE shall enter the EMM-REGISTERED.NORMAL-SERVICE state and the MM-NULL state; </end_state> </control> or <control> <condition> d) if "combined EPS/IMSI detach" was requested, </condition> <end_state> the UE shall enter the EMM-DEREGISTERED state and the MM-NULL state. </end_state> </control> </control>
<control> <condition> d) Detach procedure collision </condition> </control>
<control> <condition> Detach containing cause "switch off" within the Detach type IE: </condition> <control> <condition> a) <condition> If the UE receives a DETACH REQUEST message </condition> <condition> before the UE initiated detach procedure has been completed, </condition> </condition> <action> this message shall be ignored </action> and <action> the UE initiated detach procedure shall continue. </action> </control> </control>
<control> <condition> Detach containing other causes than "switch off" within the Detach type IE: </condition> <control> <condition> a) <condition> If the UE receives a DETACH REQUEST message </condition> <condition> before the UE initiated detach procedure has been completed, </condition> </condition> <action> it shall treat the message as specified in subclause 5.5.2.3.2 with the following modifications: </action> <control> <condition> a) <condition> If the DETACH REQUEST message received by the UE contains detach type "re-attach required", </condition> and <condition> the UE initiated detach procedure is with detach type "EPS detach" or "combined EPS/IMSI detach", </condition> </condition> <action> the UE need not initiate the attach or combined attach procedure. </action> </control> <control> <condition> b) <condition> If the DETACH REQUEST message received by the UE contains detach type "IMSI detach", </condition> and <condition> the UE initiated detach procedure is with detach type "IMSI detach", </condition> </condition> <action> the UE need not re-attach to non-EPS services. </action> </control> <control> <condition> c) <condition> If the DETACH REQUEST message received by the UE contains detach type "IMSI detach", </condition> and <condition> the UE initiated detach procedure is with detach type "EPS detach" or "combined EPS/IMSI detach", </condition> </condition> <action> the UE shall progress both procedures. The UE need not re-attach to non-EPS services. </action> </control> </control> </control>
<control> <condition> e) Detach and EMM common procedure collision </condition> </control>
<control> <condition> Detach containing cause "switch off": </condition> <control> <condition> a) <condition> If the UE receives a message used in an EMM common procedure </condition> <condition> before the detach procedure has been completed, </condition> </condition> <action> this message shall be ignored </action> and <action> the detach procedure shall continue. </action> </control> </control>
<control> <condition> <condition> Detach containing other causes than "switch off" </condition> and <condition> containing detach type "IMSI detach": </condition> </condition> <control> <condition> a) <condition> If the UE receives a message used in an EMM common procedure </condition> <condition> before the detach procedure has been completed, </condition> </condition> <action> both the EMM common procedure and the detach procedure shall continue. </action> </control> </control>
<control> <condition> <condition> Detach containing other causes than "switch off" </condition> and <condition> containing other detach types than "IMSI detach": </condition> </condition> <control> <condition> a) <condition> If the UE receives a GUTI REALLOCATION COMMAND, an EMM STATUS or an EMM INFORMATION message </condition> <condition> before the detach procedure is completed, </condition> </condition> <action> this message shall be ignored </action> and <action> the detach procedure shall continue. </action> </control> <control> <condition> b) <condition> If the UE receives an AUTHENTICATION REQUEST, SECURITY MODE COMMAND or IDENTITY REQUEST message </condition> <condition> before the detach procedure has been completed, </condition> </condition> <action> the UE shall respond to it as described in subclause 5.4.2, 5.4.3 and 5.4.4 respectively </action> and <action> the detach procedure shall continue. </action> </control> </control>
<control> <condition> f) Change of cell into a new tracking area </condition> </control>
<control> <condition> <condition> If a cell change into a new tracking area that is not in the stored TAI list </condition> <condition> occurs before the UE initiated detach procedure is completed, </condition> </condition> <action> the detach procedure shall be aborted </action> and <action> re-initiated <condition> after successfully performing a tracking area updating procedure. </condition> </action> <control> <condition> <condition> If the detach procedure was initiated due to removal of the USIM </condition> or <condition> the UE is to be switched off, </condition> </condition> <action> the UE shall abort the detach procedure </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> </control> </control>
<control> <condition> g) <condition> Transmission failure of DETACH REQUEST message indication </condition> <condition> with TAI change from lower layers </condition> </condition> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> <action> the detach procedure shall be aborted </action> and <action> re-initiated <condition> after successfully performing a tracking area updating procedure. </condition> </action> <control> <condition> <condition> If the detach procedure was initiated </condition> <condition> due to <condition> removal of the USIM </condition> or <condition> the UE is to be switched off, </condition> </condition> </condition> <action> the UE shall abort the detach procedure </action> and <end_state> enter the state EMM- DEREGISTERED. </end_state> </control> </control>
<control> <condition> If the current TAI is still part of the TAI list, </condition> <action> the UE shall restart the detach procedure. </action> </control>
<control> <condition> h) <condition> Transmission failure of DETACH REQUEST message indication </condition> <condition> without TAI change from lower layers </condition> </condition> </control>
<control> <action> The UE shall restart the detach procedure. </action> </control>
<control> <condition> i) Detach and paging procedure collision </condition> </control>
<control> <condition> <condition> If the UE receives a CS SERVICE NOTIFICATION message </condition> <condition> before the UE initiated combined detach procedure <condition> with detach type "IMSI detach" or "combined EPS/IMSI detach" </condition> has been completed, </condition> </condition> <action> then this message shall be ignored </action> and <action> the UE initiated combined detach procedure shall continue. </action> </control>
<control> <condition> For the cases b, f and g: </condition> <control> a) <action> Timer T3421 shall be stopped </action> <condition> if still running. </condition> </control> </control>
5.5.2.2.5 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) <condition> Detach request received </condition> <condition> in a CSG cell </condition> <condition> for which the UE has no valid CSG subscription </condition> </condition> </control>
<control> <condition> <condition> <condition> If the UE initiates a detach procedure </condition> <condition> in a CSG cell </condition> <condition> the CSG ID of which is not valid for the UE, </condition> </condition> and <condition> the detach procedure is not due to "switch off", </condition> </condition> the network shall proceed as follows: <control> <condition> a) <condition> if the detach type is "IMSI detach" </condition> and <condition> the UE has a PDN connection for emergency bearer services active, </condition> </condition> <action> the MME shall send a DETACH ACCEPT message </action> and <action> deactivate all non-emergency EPS bearers, if any, </action> <action> by initiating an EPS bearer context deactivation procedure; </action> </control> <control> <condition> b) otherwise, </condition> <action> the network shall initiate the detach procedure. </action> <action> The MME shall send a DETACH REQUEST message </action> <action> including the EMM cause #25,"not authorized for this CSG". </action> </control> </control>
<control> <condition> b) Lower layers indication of non-delivered NAS PDU due to handover </condition> </control>
<control> <condition> <condition> <condition> If the DETACH ACCEPT message could not be delivered </condition> <condition> due to an intra MME handover </condition> </condition> and <condition> the target TA is included in the TAI list, </condition> </condition> <condition> then upon successful completion of the intra MME handover </condition> <action> the MME shall retransmit the DETACH ACCEPT message. </action> <control> <condition> <condition> If a failure of the handover procedure is reported by the lower layer </condition> and <condition> the S1 signalling connection exists, </condition> </condition> <action> the MME shall retransmit the DETACH ACCEPT message. </action> </control> </control>
5.5.2.3 Network initiated detach procedure
5.5.2.3.1 Network initiated detach procedure initiation
<control> <condition> The network initiates the detach procedure </condition> <action> by sending a DETACH REQUEST message to the UE (see example in figure 5.5.2.3.1). </action> </control>
NOTE: <control> <condition> If the MME performs a local detach, </condition> <action> it will inform the UE with an EMM messages (e.g. SERVICE REJECT or TRACKING AREA UPDATE reject) </action> <action> with EMM cause #10 "implicitly detached" </action> <condition> only when the UE initiates an EMM procedure. </condition> </control>
<control> <action> The network may include an EMM cause IE <condition> to specify the reason for the detach request. </condition> </action> <action> The network shall start timer T3422. </action> <control> <condition> <condition> <condition> If the Detach type IE indicates "re-attach required" or "re-attach not required" </condition> and <condition> the EMM cause value is not #2 "IMSI unknown in HSS", </condition> </condition> or <condition> if the MME performs a local detach, </condition> </condition> <action> the MME shall either store the current EPS security context <condition> if it is a native EPS security context, </condition> </action> or <action> the MME shall delete the current EPS security context <condition> if it is a mapped EPS security context. </condition> </action> </control> <control> <condition> <condition> If the detach type IE indicates "re-attach required" or "re-attach not required" </condition> and <condition> the EMM cause value is not #2 "IMSI unknown in HSS", </condition> </condition> <action> the network shall deactivate the EPS bearer context(s), <condition> if any, </condition> for the UE locally </action> and <end_state> enter state EMM-DEREGISTERED-INITIATED. </end_state> </control> </control>
5.5.2.3.2 Network initiated detach procedure completion by the UE
<control> <condition> When receiving the DETACH REQUEST message </condition> and <condition> the detach type indicates "re-attach required", </condition> <action> the UE shall deactivate the EPS bearer context(s), <condition> if any, </condition> including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. </action> <control> <action> The UE shall stop the timer T3346, </action> <condition> if it is running. </condition> </control> <control> <action> The UE shall also stop timer(s) T3396, </action> <condition> if it is running. </condition> </control> <action> The UE shall send a DETACH ACCEPT message to the network </action> and <end_state> enter the state EMM-DEREGISTERED. </end_state> <control> Furthermore, the UE shall, <condition> after the completion of the detach procedure, </condition> and <condition> the release of the existing NAS signalling connection, </condition> <action> initiate an attach or combined attach procedure. </action> <action> The UE should also re- establish any previously established PDN connection(s). </action> </control> </control>
NOTE 1: When the detach type indicates "re-attach required", user interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s), if any, automatically.
<control> <condition> <condition> <condition> A UE which receives a DETACH REQUEST message </condition> <condition> with detach type indicating "re-attach required" or "re-attach not required" </condition> </condition> and <condition> no EMM cause IE, </condition> </condition> <action> is detached only for EPS services. </action> </control>
<control> <condition> <condition> When receiving the DETACH REQUEST message </condition> and <condition> the detach type indicates "IMSI detach", </condition> </condition> <action> the UE shall not deactivate the EPS bearer context(s) including the default EPS bearer context. </action> <action> The UE shall set the MM update status to U2 NOT UPDATED. </action> <action> A UE may send a DETACH ACCEPT message to the network, </action> and <action> shall re-attach to non-EPS services </action> <action> by performing the combined tracking area updating procedure according to subclause 5.5.3.3, </action> <action> sending a TRACKING AREA UPDATE REQUEST message </action> <action> with EPS update type IE indicating "combined TA/LA updating with IMSI attach". </action> </control>
<control> <condition> If the UE is attached for EPS and non-EPS services, </condition> <action> then the UE shall set the update status to U2 NOT UPDATED </action> <condition> if: <condition> a) the Detach type IE indicates "re-attach required"; </condition> or <condition> b) the Detach type IE indicates "re-attach not required" and no EMM cause IE is included. </condition> </condition> </control>
<control> <condition> <condition> When receiving the DETACH REQUEST message </condition> and <condition> <condition> the detach type indicates "re-attach not required" </condition> and <condition> no EMM cause IE, </condition> </condition> or <condition> <condition> "re-attach not required" </condition> and <condition> the EMM cause value is not #2 "IMSI unknown in HSS", </condition> </condition> </condition> <action> the UE shall deactivate the EPS bearer context(s), if any, including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. </action> <action> The UE shall then send a DETACH ACCEPT message to the network </action> and <end_state> enter state EMM-DEREGISTERED. </end_state> </control>
<control> <condition> If the detach type indicates "IMSI detach" or "re-attach required", </condition> <action> then the UE shall ignore the EMM cause IE <condition> if received. </condition> </action> </control>
<control> <condition> If the detach type indicates "re-attach not required", </condition> <action> the UE shall take the following actions depending on the received EMM cause value: </action> </control>
<control> <condition> #2 (IMSI unknown in HSS); </condition> </control>
<control> <action> The UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when a DETACH REQUEST is received </condition> <condition> <condition> with the GMM cause with the same value </condition> and <condition> with detach type set to "re-attach not required". </condition> </condition> </condition> </control> <control> <action> The USIM shall be considered as invalid for non-EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in subclause 5.3.7a. </condition> </condition> </control> <control> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control>
<control> <condition> #2 (IMSI unknown in HSS); </condition> </control>
<control> <action> The UE is still attached for EPS services in the network. </action> </control>
<control> <condition> #3 (Illegal UE); #6 (Illegal ME); or #8 (EPS services and non-EPS services not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and KSI. </action> </control> <control> <action> The UE shall consider the USIM as invalid for EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in subclause 5.3.7a. </condition> </control> <control> <action> The UE shall delete the list of equivalent PLMNs </action> and <end_state> shall enter the state EMM-DEREGISTERED.NO-IMSI. </end_state> </control> <control> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> <control> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control>
<control> <condition> For the EMM cause value #3 or #6, </condition> <condition> if the UE is operating in single-registration mode, </condition> <action> the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when a DEREGISTRATION REQUEST is received over 3GPP access </condition> <condition> <condition> with the 5GMM cause with the same value, </condition> <condition> with de-registration type set to "re-registration not required" </condition> and <condition> with access type set to "3GPP access". </condition> </condition> </condition> </control>
<control> <condition> For the EMM cause value #8, </condition> <condition> if the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, </end_state> <action> 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
NOTE 2: The possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.
<control> <condition> #7 (EPS services not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and KSI. </action> <control> <action> The UE shall consider the USIM as invalid for EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in subclause 5.3.7a. </condition> </control> <control> <end_state> The UE shall enter the state EMM- DEREGISTERED. </end_state> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <condition> which is IMSI attached for non-EPS services </condition> <action> is still IMSI attached for non-EPS services in the network. </action> </control> <control> <condition> The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> shall set the update status to U2 NOT UPDATED, </action> <action> shall attempt to select GERAN or UTRAN access technology </action> and <action> shall proceed with the appropriate MM specific procedure according to the MM service state. </action> </control>
<control> <action> The UE shall not reselect E-UTRAN radio access technology </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when a DEREGISTRATION REQUEST is received over 3GPP access </condition> <condition> <condition> with the 5GMM cause with the same value, </condition> <condition> with de-registration type set to "re-registration not required" </condition> and <condition> with access type set to "3GPP access". </condition> </condition> </condition> </control>
<control> <condition> #11 (PLMN not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and KSI. </action> <action> The UE shall delete the list of equivalent PLMNs, </action> <action> shall reset the attach attempt counter </action> and <end_state> enter the state EMM- DEREGISTERED.PLMN-SEARCH. </end_state> </control>
<control> <action> The UE shall store the PLMN identity in the "forbidden PLMN list" </action> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a PLMN-specific attempt counter for that PLMN, </condition> </condition> <action> then the UE shall set this counter to the UE implementation-specific maximum value. </action> </control> </control>
<control> <action> The UE shall perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when a DEREGISTRATION REQUEST is received over 3GPP access </condition> <condition> <condition> with the 5GMM cause with the same value, </condition> <condition> with de-registration type set to "re-registration not required" </condition> and <condition> with access type set to "3GPP access". </condition> </condition> </condition> </control>
<control> <condition> #12 (Tracking area not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and KSI. </action> <action> The UE shall reset the attach attempt counter </action> and <end_state> shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when a DEREGISTRATION REQUEST is received over 3GPP access </condition> <condition> <condition> with the 5GMM cause with the same value , </condition> <condition> with de-registration type set to "re-registration not required" </condition> and <condition> with access type set to "3GPP access". </condition> </condition> </condition> </control>
<control> <condition> #13 (Roaming not allowed in this tracking area); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and KSI. </action> <action> The UE shall delete the list of equivalent PLMNs, </action> <action> reset the attach attempt counter </action> and <end_state> shall change to state EMM- DEREGISTERED.PLMN-SEARCH. </end_state> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". </action> </control>
<control> <action> The UE shall perform a PLMN selection according to 3GPP TS 23.122 </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when a DEREGISTRATION REQUEST is received over 3GPP access </condition> <condition> <condition> with the 5GMM cause with the same value, </condition> <condition> with de-registration type set to "re-registration not required" </condition> and <condition> with access type set to "3GPP access". </condition> </condition> </condition> </control>
<control> <condition> #14 (EPS services not allowed in this PLMN); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). </action> <action> Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI list and KSI. </action> <action> The UE shall reset the attach attempt counter </action> and <end_state> shall enter the state EMM-DEREGISTERED.PLMN-SEARCH. </end_state> </control>
<control> <action> The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list </action> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a PLMN-specific PS-attempt counter for that PLMN, </condition> </condition> <action> then the UE shall set this counter to the UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> A UE in PS mode 1 or PS mode 2 of operation </condition> <action> shall delete the list of equivalent PLMNs </action> and <action> perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <condition> which is IMSI attached for non-EPS services </condition> <action> is still IMSI attached for non-EPS services </action> and <action> shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <condition> <condition> A UE operating in CS/PS mode 1 of operation </condition> and <condition> supporting A/Gb mode or Iu mode </condition> </condition> <action> may select GERAN or UTRAN radio access technology </action> and <action> proceed with the appropriate MM specific procedure according to the MM service state. </action> <action> In this case, the UE shall disable the E-UTRA capability (see subclause 4.5). </action> </control>
<control> <condition> <condition> A UE operating in CS/PS mode 1 of operation </condition> and <condition> supporting A/Gb mode or Iu mode </condition> </condition> <action> may perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> <condition> <condition> A UE operating in CS/PS mode 1 of operation </condition> and <condition> supporting S1 mode only </condition> </condition> or <condition> operating in CS/PS mode 2 of operation </condition> </condition> <action> shall delete the list of equivalent PLMNs </action> and <action> shall perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED, </end_state> <action> 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #15 (No suitable cells in tracking area); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and KSI. </action> <action> The UE shall reset the attach attempt counter </action> and <end_state> shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". </action> </control>
<control> <action> The UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 . </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when a DEREGISTRATION REQUEST is received over 3GPP access </condition> <condition> <condition> with the 5GMM cause with the same value, </condition> <condition> with de-registration type set to "re-registration not required" </condition> and <condition> with access type set to "3GPP access". </condition> </condition> </condition> </control>
<control> <condition> #25 (Not authorized for this CSG); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). </action> <action> The UE shall reset the attach attempt counter </action> and <end_state> shall enter the state EMM- DEREGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> <condition> If the cell where the UE has received the DETACH REQUEST message is a CSG cell </condition> and <condition> the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list, </condition> </condition> <action> the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list. </action> </control>
<control> <condition> <condition> If the cell where the UE has received the DETACH REQUEST message is a CSG cell </condition> and <condition> the CSG ID and associated PLMN identity of the cell are contained in the Operator CSG list, </condition> </condition> <action> the UE shall apply the procedures defined in 3GPP TS 23.122 subclause 3.1A. </action> </control>
<control> <action> The UE shall search for a suitable cell according to 3GPP TS 36.304 . </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when a DETACH REQUEST is received </condition> <condition> <condition> with GMM cause with the same value </condition> and <condition> with detach type set to "re-attach not required". </condition> </condition> If the UE is IMSI attached for non-EPS services, </condition> <action> the UE shall in addition handle the MM parameters update status and location update attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> a DETACH REQUEST is received </condition> <condition> <condition> with the GMM cause with the same value </condition> and <condition> with detach type set to "re-attach not required". </condition> </condition> </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED </end_state> and <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED. </action> </control>
<control> <condition> Other EMM cause values or if no EMM cause IE is included </condition> <action> is considered as abnormal cases. </action> <action> The behaviour of the UE in those cases is described in subclause 5.5.2.3.4. </action> </control>
5.5.2.3.3 Network initiated detach procedure completion by the network
<control> <action> The network shall stop timer T3422 </action> <condition> upon receipt of the DETACH ACCEPT message. </condition> </control> <control> <condition> <condition> If the Detach type IE indicates "IMSI detach", or "re-attach not required" </condition> and <condition> the EMM cause value is #2 "IMSI unknown in HSS", </condition> </condition> <action> the network shall not change the current EMM state; </action> </control> <control> <condition> otherwise </condition> <end_state> the network shall enter state EMM-DEREGISTERED. </end_state> </control>
5.5.2.3.4 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) Transmission failure of DETACH ACCEPT message indication from lower layers </condition> </control>
<control> <action> The detach procedure shall be progressed </action> and <action> the UE shall send the DETACH ACCEPT message. </action> </control>
<control> <condition> b) <condition> DETACH REQUEST, </condition> <condition> <condition> other EMM cause values than those treated in subclause 5.5.2.3.2 </condition> or <condition> no EMM cause IE is included, </condition> </condition> and <condition> the Detach type IE indicates "re-attach not required" </condition> </condition> </control>
<control> <action> The UE shall delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, KSI, </action> <action> shall set the update status to EU2 NOT UPDATED </action> and <action> shall start timer T3402. </action> </control>
<control> <condition> <condition> A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <condition> which is IMSI attached for non-EPS services </condition> </condition> <action> is still IMSI attached for non-EPS services </action> and <action> shall set the update status to U2 NOT UPDATED. </action> <control> <condition> a) <condition> A UE not supporting A/Gb mode or Iu mode, </condition> or <condition> operating in PS mode of operation </condition> </condition> <end_state> may enter the state EMM- DEREGISTERED.PLMN-SEARCH </end_state> <condition> in order to perform a PLMN selection according to 3GPP TS 23.122 ; </condition> </control> <control> <condition> otherwise </condition> <end_state> the UE shall enter the state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. </end_state> </control> </control>
<control> <condition> <condition> A UE supporting A/Gb mode or Iu mode </condition> and <condition> operating in CS/PS mode 1 of operation or CS/PS mode 2 of operation </condition> </condition> shall <control> <end_state> a) enter the state EMM-DEREGISTERED </end_state> and <action> attempt to select GERAN or UTRAN radio access technology </action> and <action> proceed with the appropriate MM or GMM specific procedures. </action> <action> In this case, the UE may disable the E- UTRA capability (see subclause 4.5); </action> </control> or <control> b) <end_state> enter the state EMM-DEREGISTERED.PLMN-SEARCH </end_state> <condition> in order to perform a PLMN selection according to 3GPP TS 23.122 . </condition> </control> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall set the GPRS update status to GU2 NOT UPDATED </action> and <action> shall delete the GMM parameters P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number </action> and <end_state> shall enter the state GMM-DEREGISTERED. </end_state> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED, </end_state> <action> 5GS update status to 5U2 NOT UPDATED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
5.5.2.3.5 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a) T3422 time-out </condition> </control>
<control> <condition> On the first expiry of the timer, </condition> <action> the network shall retransmit the DETACH REQUEST message </action> and <action> shall start timer T3422. </action> </control> <control> This retransmission is repeated four times, i.e. <condition> on the fifth expiry of timer T3422, </condition> <action> the detach procedure shall be aborted. </action> <control> <condition> <condition> If the detach type is "IMSI detach", or "re-attach not required" </condition> and <condition> the EMM cause value is #2 "IMSI unknown in HSS", </condition> </condition> <action> the network shall not change the current EMM state; </action> </control> <control> <condition> otherwise </condition> <end_state> the network shall change to state EMM-DEREGISTERED. </end_state> </control> </control>
<control> <condition> b) Lower layer failure </condition> </control>
<control> <action> The detach procedure is aborted. </action> <control> <condition> <condition> If the detach type indicates "IMSI detach", or "re-attach not required" </condition> and <condition> the EMM cause value is #2 "IMSI unknown in HSS", </condition> </condition> <action> the network shall not change the current EMM state; </action> otherwise </control> <control> <condition> otherwise </condition> <end_state> the network shall change to state EMM-DEREGISTERED. </end_state> </control> </control>
<control> <condition> c) Detach procedure collision </condition> </control>
<control> <condition> <condition> If the network receives a DETACH REQUEST message </condition> <condition> with "switch off" indication, </condition> </condition> <condition> before the network initiated detach procedure has been completed, </condition> <action> both procedures shall be considered completed. </action> </control>
<control> <condition> <condition> If the network receives a DETACH REQUEST message </condition> <condition> without "switch off" indication, </condition> </condition> <condition> before the network initiated detach procedure has been completed, </condition> <action> the network shall send a DETACH ACCEPT message to the UE. </action> </control>
<control> <condition> d) Detach and attach procedure collision </condition> </control>
<control> <condition> <condition> If the network receives an ATTACH REQUEST message </condition> <condition> before the network initiated detach procedure <condition> <condition> with detach type "re-attach not required" </condition> <condition> with no EMM cause IE, </condition> </condition> or <condition> <condition> "re-attach not required" </condition> and <condition> the EMM cause value not #2 "IMSI unknown in HSS", </condition> </condition> has been completed, </condition> </condition> <action> the network shall ignore the ATTACH REQUEST message. </action> <control> <condition> <condition> If the Detach type IE, <condition> sent in the DETACH REQUEST message, </condition> <condition> indicates "re-attach required" </condition> </condition> </condition> <action> the detach procedure is aborted </action> and <action> the attach procedure shall be progressed <condition> after the EPS bearer context(s) have been deleted. </condition> </action> </control> <control> <condition> If the Detach type IE, <condition> sent in DETACH REQUEST message, </condition> <condition> indicates "IMSI detach", or "re-attach not required" </condition> and <condition> the EMM cause value is #2 "IMSI unknown in HSS", </condition> </condition> <action> the detach procedure is aborted </action> and <action> the attach procedure shall be progressed. </action> </control> </control>
<control> <condition> e) Detach and tracking area updating procedure collision </condition> </control>
<control> <condition> <condition> <condition> If the Detach type IE, </condition> <condition> sent in DETACH REQUEST message, </condition> <condition> <condition> <condition> indicates "re-attach not required" </condition> <condition> with no EMM cause IE, </condition> </condition> or <condition> <condition> "re-attach not required" </condition> <condition> with EMM cause other than #2 "IMSI unknown in HSS" </condition> </condition> or <condition> indicates "re- attach required", </condition> </condition> and <condition> <condition> the network receives a TRACKING AREA UPDATE REQUEST message </condition> <condition> before the network initiated detach procedure has been completed, </condition> </condition> </condition> </condition> <action> the detach procedure shall be progressed, </action> <action> i.e. the TRACKING AREA UPDATE REQUEST message shall be ignored. </action> </control>
<control> <condition> <condition> <condition> If the Detach type IE, </condition> <condition> sent in DETACH REQUEST message, </condition> <condition> <condition> <condition> indicates "re-attach not required" </condition> <condition> with EMM cause #2 "IMSI unknown in HSS" </condition> </condition> or <condition> indicates "IMSI detach" </condition> </condition> and <condition> <condition> the network receives a TRACKING AREA UPDATE REQUEST message </condition> <condition> before the network initiated detach procedure has been completed, </condition> </condition> </condition> </condition> <action> the network shall abort the detach procedure, </action> <action> shall stop T3422 </action> and <action> shall progress the tracking area updating procedure. </action> </control>
<control> <condition> f) Detach and service request procedure collision </condition> </control>
<control> <condition> <condition> <condition> If the network receives a SERVICE REQUEST message or an EXTENDED SERVICE REQUEST message for packet services </condition> <condition> before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) </condition> </condition> and <condition> <condition> the DETACH REQUEST contains detach type "re-attach not required" </condition> <condition> with EMM cause #2 "IMSI unknown in HSS" </condition> or <condition> detach type "IMSI detach", </condition> </condition> </condition> <action> the network shall progress both procedures. </action> </control> <control> <condition> <condition> <condition> <condition> If the DETACH REQUEST message contains detach type "re-attach not required" </condition> <condition> with no EMM cause IE, </condition> </condition> or <condition> <condition> "re-attach not required" </condition> <condition> with EMM cause other than #2 "IMSI unknown in HSS" </condition> </condition> or <condition> detach type "re-attach required", </condition> </condition> </condition> <action> the network shall progress the detach procedure. </action> </control>
<control> <condition> <condition> If the network receives an EXTENDED SERVICE REQUEST message </condition> <condition> <condition> for CS fallback, <condition> but not for CS fallback for emergency call, </condition> </condition> </condition> <condition> before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) </condition> and <condition> /condition> the DETACH REQUEST contains detach type "re- attach not required" </condition> <condition> <condition> with EMM cause #2 "IMSI unknown in HSS" </condition> or <condition> detach type "IMSI detach", </condition> </condition> </condition> <action> the network shall ignore the EXTENDED SERVICE REQUEST message </action> and <action> progress the detach procedure. </action> </control>
<control> <condition> <condition> <condition> <condition> If the network receives an EXTENDED SERVICE REQUEST message </condition> <condition> for CS fallback for emergency call </condition> </condition> <condition> before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) </condition> and <condition> <condition> the DETACH REQUEST contains detach type "re-attach not required" </condition> </condition> <condition> <condition> with EMM cause #2 "IMSI unknown in HSS" </condition> or <condition> detach type "IMSI detach", </condition> </condition> </condition> </condition> <action> the network shall progress both procedures. </action> </control>
<control> <condition> g) Lower layers indication of non-delivered NAS PDU due to handover </condition> </control>
<control> <condition> <condition> <condition> If the DETACH REQUEST message could not be delivered </condition> <condition> due to an intra MME handover </condition> </condition> and <condition> the target TA is included in the TAI list, </condition> </condition> <condition> then upon successful completion of the intra MME handover </condition> <action> the MME shall retransmit the DETACH REQUEST message. </action> <control> <condition> <condition> If a failure of the handover procedure is reported by the lower layer </condition> and <condition> the S1 signalling connection exists, </condition> </condition> <action> the MME shall retransmit the DETACH REQUEST message. </action> </control> </control>
5.5.3 Tracking area updating procedure (S1 mode only)
5.5.3.1 General
<control> <action> The tracking area updating procedure is always initiated by the UE </action> and <condition> is used for the following purposes: <condition> a) normal tracking area updating to update the registration of the actual tracking area of a UE in the network; </condition> <condition> <condition> b)combined tracking area updating to update the registration of the actual tracking area </condition> <condition> for a UE in CS/PS mode 1 or CS/PS mode 2 of operation; </condition> </condition> <condition> c) periodic tracking area updating to periodically notify the availability of the UE to the network; </condition> <condition> d) <condition> IMSI attach for non-EPS services </condition> <condition> when the UE is attached for EPS services. </condition> This procedure is used by <condition> a UE in CS/PS mode 1 or CS/PS mode 2 of operation; </condition> </condition> <condition> e) in various cases of inter-system change from Iu mode to S1 mode or from A/Gb mode to S1 mode; </condition> <condition> f) in various cases of inter-system change from N1 mode to S1 mode if the UE operates in single-registration mode and as described in 3GPP TS 24.501 ; </condition> <condition> g) S101 mode to S1 mode inter-system change; </condition> <condition> h) MME load balancing; </condition> <condition> i) to update certain UE specific parameters in the network; </condition> <condition> j) recovery from certain error cases; </condition> <condition> k) to indicate that the UE enters S1 mode after CS fallback or 1xCS fallback; </condition> <condition> l) <condition> to indicate to the network that the UE has selected a CSG cell </condition> <condition> whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list; </condition> </condition> <condition> m) to indicate the current radio access technology to the network for the support of terminating access domain selection for voice calls or voice sessions; </condition> and <condition> n) to indicate to the network that the UE has locally released EPS bearer context(s). </condition> </condition> </control>
Details on the conditions for the UE to initiate the tracking area updating procedure are specified in subclause 5.5.3.2.2 and subclause 5.5.3.3.2.
<control> <condition> While a UE has a PDN connection for emergency bearer services, </condition> <action> the UE shall not perform manual CSG selection. </action> </control>
<control> <condition> If control plane CIoT EPS optimization is not used by the UE, </condition> <condition> a UE initiating the tracking area updating procedure </condition> <condition> in EMM-IDLE mode </condition> <action> may request the network to re-establish the radio and S1 bearers for all active EPS bearer contexts </action> <condition> during the procedure. </condition> </control> <control> <condition> If control plane CIoT EPS optimization is used by the UE, </condition> <condition> a UE initiating the tracking area updating procedure </condition> <condition> in EMM-IDLE mode </condition> <action> may request the network to re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without control plane only indication </action> <condition> during the procedure. </condition> </control>
<control> <condition> In a shared network, </condition> <action> the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 . </action> <action> The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received for this PLMN identity on the broadcast system information. </action> <action> The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP TS 36.331 ). </action> <control> <condition> Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #11 "PLMN not allowed" is received by the UE, </condition> <action> the chosen PLMN identity shall be stored in the "forbidden PLMN list" </action> and <action> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control> <control> <condition> Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #14 "EPS services not allowed in this PLMN" is received by the UE, </condition> <action> the chosen PLMN identity shall be stored in the "forbidden PLMNs for GPRS service". </action> </control> <control> <condition> <condition> Whenever a TRACKING AREA UPDATE REJECT message is received by the UE </condition> <condition> with the EMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking Area", </condition> </condition> <action> the constructed TAI shall be stored in the suitable list. </action> </control> </control>
<control> <condition> In a shared network, </condition> <condition> if TRACKING AREA UPDATE REJECT is received as a response to a tracking area updating procedure initiated </condition> <condition> in EMM-CONNECTED mode, </condition> <action> the UE need not update forbidden lists. </action> </control>
A tracking area updating attempt counter is used to limit the number of subsequently rejected tracking area update attempts. The tracking area updating attempt counter shall be incremented as specified in subclause 5.5.3.2.6.
<control> <action> Additionally the tracking area updating attempt counter shall be reset </action> <start_state> when the UE is in substate EMM- REGISTERED.ATTEMPTING-TO-UPDATE or EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, </start_state> <condition> and: <condition> a) a new tracking area is entered; </condition> <condition> b) timer T3402 expires; </condition> or <condition> c) timer T3346 is started. </condition> </condition> </control>
5.5.3.2 Normal and periodic tracking area updating procedure
5.5.3.2.1 General
<control> The periodic tracking area updating procedure is controlled in the UE by timer T3412. <condition> When timer T3412 expires, </condition> <action> the periodic tracking area updating procedure is started. </action> Start and reset of timer T3412 is described in subclause 5.3.5. </control>
5.5.3.2.2 Normal and periodic tracking area updating procedure initiation
5.5.3.2.2 Normal and periodic tracking area updating procedure initiation
<control> <start_state> The UE in state EMM-REGISTERED </start_state> shall <condition> initiate the tracking area updating procedure </condition> <action> by sending a TRACKING AREA UPDATE REQUEST message to the MME </action> <condition> <condition> a) <condition> when the UE detects entering a tracking area </condition> <condition> that is not in the list of tracking areas that the UE previously registered in the MME, </condition> <condition> <condition> unless the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 or 3GPP TS 31.102 </condition> and <condition> is entering a tracking area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs; </condition> </condition> </condition> <condition> b) when the periodic tracking area updating timer T3412 expires; </condition> <condition> c) <condition> when the UE enters EMM-REGISTERED.NORMAL-SERVICE </condition> and <condition> the UE's TIN indicates "P-TMSI"; </condition> </condition> <condition> d) <condition> when the UE performs an inter-system change from S101 mode to S1 mode </condition> and <condition> has no user data pending; </condition> </condition> <condition> e) <condition> when the UE receives an indication from the lower layers that the RRC connection was released </condition> <condition> with cause "load balancing TAU required"; </condition> </condition> <condition> f) <condition> <condition> when the UE deactivated EPS bearer context(s) locally </condition> <condition> while in EMM-REGISTERED, </condition> <condition> because it could not establish a NAS signalling connection, </condition> and <condition> then returns to EMM-REGISTERED.NORMAL-SERVICE </condition> </condition> and <condition> no EXTENDED SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or DETACH REQUEST message with detach type is "EPS detach" or "combined EPS/IMSI detach" is pending to be sent by the UE; </condition> </condition> <condition> g) when the UE changes the UE network capability information or the MS network capability information or both; </condition> <condition> h) when the UE changes the UE specific DRX parameter (in WB-S1 mode or NB-S1 mode); </condition> <condition> i) <condition> when the UE receives an indication of "RRC Connection failure" from the lower layers </condition> and <condition> has no signalling or user uplink data pending (i.e when the lower layer requests NAS signalling connection recovery); </condition> </condition> <condition> j) when the UE enters S1 mode after 1xCS fallback or 1xSRVCC; </condition> <condition> k) when <condition> due to manual CSG selection </condition> <condition> the UE has selected a CSG cell </condition> <condition> whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list; </condition> </condition> <condition> l) <condition> when the UE reselects an E-UTRAN cell </condition> <condition> while it was in GPRS READY state or PMM-CONNECTED mode; </condition> </condition> <condition> m) <condition> <condition> when the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN </condition> and <condition> changes the mobile station classmark 2 or the supported codecs, </condition> </condition> or <condition> <condition> the UE supports SRVCC to GERAN </condition> and <condition> changes the mobile station classmark 3; </condition> </condition> </condition> <condition> n) when the UE changes the radio capability for GERAN, or cdma2000 or both; </condition> <condition> o) when the UE's usage setting or the voice domain preference for E-UTRAN change in the UE; </condition> <control> NOTE 1: For the change of UE's usage setting or the voice domain preference for E-UTRAN which results in disabling UE's E-UTRA capability, the UE can skip sending TRACKING AREA UPDATE REQUEST message and directly perform disabling of UE's E-UTRA capability. </control> <condition> p) when the UE activates mobility management for IMS voice termination as specified in 3GPP TS 24.008 , annex P.2, and the TIN indicates "RAT-related TMSI"; </condition> <condition> q) <condition> when the UE performs an inter-system change from A/Gb mode to S1 mode </condition> and <condition> the TIN indicates "RAT-related TMSI", </condition> <condition> but the UE is required to perform tracking area updating for IMS voice termination as specified in 3GPP TS 24.008 , annex P.4; </condition> </condition> <condition> r) <condition> upon reception of a paging indication using S-TMSI </condition> and <condition> the UE is in state EMM- REGISTERED.ATTEMPTING-TO-UPDATE; </condition> </condition> <condition> s) when the UE needs to update the network with EPS bearer context status due to local de-activation of EPS bearer context(s) as specified in subclause 6.5.1.4A; </condition> <condition> t) when the UE needs to request the use of PSM or needs to stop the use of PSM; </condition> <condition> u) when the UE needs to request the use of eDRX or needs to stop the use of eDRX; </condition> <condition> v) when a change in the eDRX usage conditions at the UE requires different extended DRX parameters; </condition> <condition> w) when a change in the PSM usage conditions at the UE requires a different timer T3412 value or different timer T3324 value; </condition> <control> NOTE 2: A change in the PSM or eDRX usage conditions at the UE can include e.g. a change in the UE configuration, a change in requirements from upper layers or the battery running low at the UE. </control> <condition> x) when the CIoT EPS optimizations the UE needs to use, change in the UE; </condition> <condition> y) when the Default_DCN_ID value changes, as specified in 3GPP TS 24.368 or in USIM file NAS as CONFIG specified in 3GPP TS 31.102 ; </condition> <control> NOTE 3: The tracking area updating procedure is initiated after deleting the DCN-ID list as specified in annex C. </control> <condition> z) <condition> when the UE performs inter-system change from N1 mode to S1 mode in EMM-IDLE mode, </condition> <condition> the UE operates in single-registration mode, </condition> and <condition> conditions specified in 3GPP TS 24.501 apply; </condition> </condition> <condition> za) when the UE in EMM-IDLE mode changes the radio capability for E-UTRAN; </condition> <condition> zb) when the UE needs to request new ciphering keys for ciphered broadcast assistance data; </condition> <condition> zc) when the UE in EMM-IDLE mode changes the radio capability for NG-RAN; </condition> <condition> zd) when the UE performs inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode; </condition> <condition> ze) <condition> in WB-S1 mode, </condition> <condition> when the applicable UE radio capability ID for the current UE radio configuration changes </condition> <condition> due to a revocation of the network-assigned UE radio capability IDs by the serving PLMN; </condition> </condition> or <condition> zf) </condition> when the UE needs to use the WUS assistance, </condition> <condition> stop to use the WUS assistance, </condition> or <condition> change the conditions for using the WUS assistance. </condition> </control>
<control> <condition> For all cases except case b, </condition> <action> the UE shall set the EPS update type IE in the TRACKING AREA UPDATE REQUEST message to "TA updating". </action> </control> <control> <condition> For case b, </condition> <action> the UE shall set the EPS update type IE to "periodic updating". </action> </control>
<control> <condition> For cases n, za and zc, </condition> <action> the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> If the UE is in the EMM-CONNECTED mode </condition> and <condition> the UE changes the radio capability for E-UTRAN or for NG-RAN, </condition> </condition> <action> the UE may locally release the established NAS signalling connection </action> and <end_state> enter the EMM-IDLE mode. </end_state> <action> Then, the UE shall initiate the tracking area updating procedure </action> <action> including a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> For case l, </condition> <condition> if the TIN indicates "RAT-related TMSI", </condition> <action> the UE shall set the TIN to "P-TMSI" </action> <condition> before initiating the tracking area updating procedure. </condition> </control>
<control> <condition> For case r, </condition> <action> the "active" flag in the EPS update type IE shall be set to 1. </action> <control> <condition> <condition> If a UE is only using EPS services </condition> <condition> with control plane CIoT EPS optimization, </condition> </condition> <action> the "signalling active" flag in the Additional update type IE shall be set to 1. </action> </control> </control>
<control> <condition> If the UE is using only control plane CIoT EPS optimization, </condition> <action> the case i only applies to </action> the case that <condition> <condition> the UE has indicated to the network that subsequent to the uplink data transmission a downlink data transmission is expected </condition> <condition> during the transport of uplink user data via the control plane procedure (see subclause 6.6.4). </condition> </condition> </control>
<control> <condition> If the UE has to request resources for ProSe direct discovery or Prose direct communication (see 3GPP TS 36.331 ), </condition> <action> then the UE shall set the "active" flag to 1 in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> If the UE does not have any established PDN connection, </condition> and <condition> the inter-system change from N1 mode to S1 mode is not due to emergency services fallback, </condition> </condition> <action> the "active" flag in the EPS update type IE shall be set to 0. </action> </control>
<control> <condition> <condition> When the UE has user data pending </condition> and <condition> performs an inter-system change from S101 mode to S1 mode to a tracking area included in the TAI list stored in the UE, </condition> </condition> <action> the UE shall perform a service request procedure </action> instead of a tracking area updating procedure. </control>
<control> <condition> <condition> When initiating a tracking area updating procedure </condition> <condition> while in S1 mode, </condition> </condition> <action> the UE shall use the current EPS NAS integrity key to integrity protect the TRACKING AREA UPDATE REQUEST message, </action> <condition> unless the UE is performing inter- system change from N1 mode to S1 mode. </condition> </control>
<control> <condition> <condition> In order to indicate its UE specific DRX parameter for WB-S1 mode </condition> <condition> while in E-UTRAN coverage, </condition> </condition> <action> the UE shall send the TRACKING AREA UPDATE REQUEST message </action> <action> containing the UE specific DRX parameter in the DRX parameter IE to the network, </action> <condition> with the exception of the case <condition> if the UE had indicated its DRX parameter for WB-S1 mode (3GPP TS 24.008 ) to the network </condition> <condition> while in GERAN or UTRAN coverage. </condition> </condition> <control> <condition> In this case, <condition> when the UE enters E- UTRAN coverage and initiates a tracking area updating procedure, </condition> </condition> <action> the UE shall not include the UE specific DRX parameter in the DRX parameter IE in the TRACKING AREA UPDATE REQUEST message. </action> </control> </control>
<control> <condition> In NB-S1 mode, </condition> <condition> a UE that wishes to use or change a UE specific DRX parameter in NB-S1 mode </condition> <action> shall include its requested value in every TRACKING AREA UPDATE REQUEST message </action> <condition> except when initiating the periodic tracking area updating procedure. </condition> </control>
<control> <condition> If the UE supports eDRX and requests the use of eDRX, </condition> <action> the UE shall include the extended DRX parameters IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> If the UE supports PSM and requests the use of PSM, </condition> <action> the UE shall include the T3324 value IE with a requested timer value in the TRACKING AREA UPDATE REQUEST message. </action> </control> <control> <condition> <condition> When the UE includes the T3324 value IE </condition> and <condition> the UE indicates support for extended periodic timer value in the MS network feature support IE, </condition> </condition> <action> it may also include the T3412 extended value IE </action> <condition> to request a particular T3412 value to be allocated. </condition> </control>
<control> <condition> <condition> If a UE supporting CIoT EPS optimizations </condition> <condition> in NB-S1 mode </condition> <condition> initiates the tracking area updating procedure </condition> <condition> for EPS services and "SMS only", </condition> </condition> <action> the UE shall indicate "SMS only" in the Additional update type IE </action> and <action> shall set the EPS update type IE to "TA updating". </action> </control>
<control> <condition> <condition> If the UE supports S1-U data transfer and multiple user plane radio bearers (see 3GPP TS 36.306 , 3GPP TS 36.331 ) </condition> <condition> in NB-S1 mode, </condition> </condition> <action> then the UE shall set the Multiple DRB support bit to "Multiple DRB supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> If the UE is in NB-S1 mode, </condition> <action> then the UE shall set the Control plane CIoT EPS optimization bit to "Control plane CIoT EPS optimization supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control> <control> <condition> If the UE is capable of NB-N1 mode, </condition> <action> then the UE shall set the Control plane CIoT 5GS optimization bit to "Control plane CIoT 5GS optimization supported" in the N1 UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> If the UE supports control plane MT-EDT, </condition> <action> then the UE shall set the CP-MT-EDT bit to "Control plane Mobile Terminated-Early Data Transmission supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> If the UE supports user plane MT-EDT, </condition> <action> then the UE shall set the UP-MT-EDT bit to "User plane Mobile Terminated- Early Data Transmission supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> If the UE has to request resources for V2X communication over PC5 (see 3GPP TS 23.285 ), </condition> <action> then the UE shall set the "active" flag to 1 in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> After sending the TRACKING AREA UPDATE REQUEST message to the MME, </condition> <action> the UE shall start timer T3430 </action> and <end_state> enter state EMM-TRACKING-AREA-UPDATING-INITIATED (see example in figure 5.5.3.2.2.1). </end_state> <control> <condition> If timer T3402 is currently running, </condition> <action> the UE shall stop timer T3402. </action> </control> <control> <condition> If timer T3411 is currently running, </condition> <action> the UE shall stop timer T3411. </action> </control> <control> <condition> If timer T3442 is currently running, </condition> <action> the UE shall stop timer T3442. </action> </control> </control>
For all cases except cases z and zd:
<control> 1) <condition> if the UE supports neither A/Gb mode nor Iu mode, </condition> <action> the UE shall include a valid GUTI in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. </action> In addition, <action> the UE shall include Old GUTI type IE with GUTI type set to "native GUTI"; </action> </control> or
<control> 2) <condition> if the UE supports A/Gb mode or Iu mode or both, </condition> <action> the UE shall handle the Old GUTI IE as follows: </action> </control> <control> a) <condition> <condition> If the TIN indicates "P-TMSI" </condition> and <condition> the UE holds a valid P-TMSI and RAI, </condition> </condition> <action> the UE shall map the P-TMSI and RAI into the Old GUTI IE, </action> and <action> include Old GUTI type IE with GUTI type set to "mapped GUTI". </action> </control> <control> <condition> If a P- TMSI signature is associated with the P-TMSI, </condition> <action> the UE shall include it in the Old P-TMSI signature IE. </action> </control>
<control> Additionally, <condition> if the UE holds a valid GUTI, </condition> <action> the UE shall indicate the GUTI in the Additional GUTI IE. </action> </control>
NOTE 5: The mapping of the P-TMSI and RAI to the GUTI is specified in 3GPP TS 23.003. <control> <condition> <condition> a) If the TIN indicates "GUTI" or "RAT-related TMSI" </condition> <condition> and the UE holds a valid GUTI, </condition> </condition> <action> the UE shall indicate the GUTI in the Old GUTI IE, </action> <action> and include Old GUTI type IE with GUTI type set to "native GUTI". </action> </control>
<control> <condition> <condition> If a UE has established PDN connection(s) </condition> and <condition> uplink user data pending to be sent via user plane </condition> <condition> when it initiates the tracking area updating procedure, </condition> </condition> </control> or <control> <condition> <condition> uplink signalling not related to the tracking area updating procedure </condition> <condition> when the UE does not support control plane CIoT EPS optimization, </condition> </condition> <action> it may set the "active" flag in the TRACKING AREA UPDATE REQUEST message to indicate the request to establish the user plane to the network </action> and <action> to keep the NAS signalling connection </action> <condition> after the completion of the tracking area updating procedure. </condition> </control>
<control> <condition> <condition> If a UE is using EPS services with control plane CIoT EPS optimization </condition> and <condition> has user data pending to be sent via control plane over MME </condition> <condition> but no user data pending to be sent via user plane, </condition> or <condition> uplink signalling not related to the tracking area updating procedure, </condition> </condition> <action> the UE may set the "signalling active" flag in the TRACKING AREA UPDATE REQUEST message to indicate the request to keep the NAS signalling connection </action> <condition> after the completion of the tracking area updating procedure. </condition> </control>
<control> <condition> For all cases except cases z and zd, </condition> <condition> if the UE has a current EPS security context, </condition> <action> the UE shall include the eKSI (either KSI or KSI ) in the NAS Key Set Identifier IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
ASME SGSN
<control> <condition> Otherwise, </condition> <action> the UE shall set the NAS Key Set Identifier IE to the value "no key is available". </action> <condition> If the UE has a current EPS security context, </condition> <action> the UE shall integrity protect the TRACKING AREA UPDATE REQUEST message with the current EPS security context. </action> </control> <control> <condition> Otherwise </condition> <action> the UE shall not integrity protect the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> When the tracking area updating procedure is initiated in EMM-IDLE mode to perform an inter-system change from A/Gb mode </condition> or <condition> Iu mode to S1 mode </condition> and <condition> the TIN is set to "P-TMSI", </condition> </condition> <action> the UE shall include the GPRS ciphering key sequence number applicable for A/Gb mode </action> or <action> Iu mode and a nonce in the TRACKING AREA UPDATE REQUEST UE message. </action> </control>
<control> <condition> When the tracking area updating procedure is initiated in EMM-CONNECTED mode to perform an inter-system change from A/Gb mode </condition> or <condition> Iu mode to S1 mode, </condition> <action> the UE shall derive the EPS NAS keys from the mapped K' using ASME the selected NAS algorithms, nonce and KSI (to be associated with the mapped K' ) provided by lower MME SGSN ASME layers as indicated in 3GPP TS 33.401. </action> <action> The UE shall reset both the uplink and downlink NAS COUNT counters of the mapped EPS security context which shall be taken into use. </action> </control> <control> <condition> If the UE has a non-current native EPS security context, </condition> <action> the UE shall include the KSI in the Non-current native NAS key set identifier IE and its associated GUTI, as ASME specified above, either in the Old GUTI IE or in the Additional GUTI IE of the TRACKING AREA UPDATE REQUEST message. </action> <action> The UE shall set the TSC flag in the Non-current native NAS key set identifier IE to "native security context". </action> </control>
<control> <condition> <condition> For the case z, </condition> <condition> if upper layers have indicated that IMS signalling </condition> or <condition> IMS emergency signalling was already ongoing in N1 mode before performing the inter-system change from N1 mode to S1 mode, </condition> or <condition> if the inter-system change from N1 mode to S1 mode is due to emergency services fallback, </condition> </condition> <action> the "active" flag in the EPS update type IE shall be set to 1. </action> </control>
<control> <condition> For the case z, </condition> <action> the TRACKING AREA UPDATE REQUEST message shall be integrity protected using the 5G NAS security context available in the UE. </action> <action> The UE shall include a GUTI, mapped from 5G-GUTI (see 3GPP TS 23.501 and 3GPP TS 23.003 ), in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. </action> <action> In addition, the UE shall include Old GUTI type IE with GUTI set to "Native GUTI", </action> and <action> the UE shall include a UE status IE with a 5GMM registration status set to "UE is in 5GMM-REGISTERED state". </action> </control> <control> Additionally, <condition> if the UE holds a valid GUTI, </condition> <action> the UE shall indicate the GUTI in the Additional GUTI IE. </action> </control>
NOTE 6: The value of the EMM registration status included by the UE in the UE status IE is not used by the MME.
<control> <condition> For the case zd, </condition> <action> the TRACKING AREA UPDATE REQUEST message shall be integrity protected using the mapped EPS security context as derived </action> <condition> when triggering the handover to E-UTRAN (see subclause 4.4.2.2). </condition> </control> <control> <action> The UE shall include a GUTI, mapped from 5G-GUTI (see 3GPP TS 23.501 and 3GPP TS 23.003 ), in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. </action> In addition, <action> the UE shall include Old GUTI type IE with GUTI set to "Native GUTI", </action> and <action> the UE shall include a UE status IE with a 5GMM registration status set to "UE is in 5GMM-REGISTERED state". </action> , <condition> if the UE holds a valid GUTI, </condition> <action> the UE shall indicate the GUTI in the Additional GUTI IE. </action> </control> <control> <condition> If the UE has a non-current native EPS security context, </condition> <action> UE shall include the KSI in the Non-current ASME native NAS key set identifier IE of the TRACKING AREA UPDATE REQUEST message. </action> <action> The UE shall set the TSC flag in the Non-current native NAS key set identifier IE to "native security context". </action> </control>
NOTE 7: The value of the EMM registration status included by the UE in the UE status IE is not used by the MME.
<control> <condition> When the tracking area updating procedure is initiated in EMM-IDLE mode, </condition> <action> the UE may also include an EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message, indicating which EPS bearer contexts are active in the UE. </action> </control> <control> <action> The UE shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message </action> </control> <control> a) <condition> for the case f; </condition> </control> <control> b) <condition> for the case s; </condition> </control> <control> <condition> c) for the case z; </condition> </control> <control> d) <condition> if the UE has established PDN connection(s) of "non IP" or Ethernet PDN type; </condition> </control> and <control> e) <condition> if the UE: 1) locally deactivated at least one dedicated EPS bearer context upon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode; </condition> </control>
<control> 2) <action> locally deactivated at least one dedicated EPS bearer context </action> <condition> upon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode </condition> (see subclause 6.4.2.1); </control> or
<control> 3) <action> locally deactivated at least one default EPS bearer context </action> <condition> upon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see subclause 6.5.0). </condition> </control>
<control> <condition> If the UE initiates the first tracking area updating procedure following an attach in A/Gb mode or Iu mode, </condition> <action> the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> If the UE initiates the first tracking area updating procedure following an initial registration in N1 mode </condition> and <condition> the UE is operating in the single-registration mode, </condition> </condition> <action> the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the UE supports SRVCC to GERAN/UTRAN, </condition> </condition> <action> the UE shall set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported". </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the UE supports vSRVCC from S1 mode to Iu mode, </condition> </condition> <action> then the UE shall set the H.245 after handover capability bit in the UE network capability IE to "H.245 after SRVCC handover capability supported" </action> and <action> additionally set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported" in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the UE supports ProSe direct discovery, </condition> </condition> <action> then the UE shall set the ProSe bit to "ProSe supported" </action> and <action> set the ProSe direct discovery bit to "ProSe direct discovery supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> For all cases except case b, </condition> <condition> if the UE supports ProSe direct communication, </condition> <action> then the UE shall set the ProSe bit to "ProSe supported" </action> and <action> set the ProSe direct communication bit to "ProSe direct communication supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the UE supports acting as a ProSe UE-to-network relay, </condition> </condition> <action> then the UE shall set the ProSe bit to "ProSe supported" </action> and <action> set the ProSe UE-to-network relay bit to "acting as a ProSe UE-to-network relay supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> If the UE supports NB-S1 mode, Non-IP or Ethernet PDN type, N1 mode, </condition> or <condition> if the UE supports DNS over (D)TLS (see 3GPP TS 33.501 ), </condition> <action> then the UE shall support the extended protocol configuration options IE. </action> </control>
NOTE 8: Support of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.501 .
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the UE supports the extended protocol configuration options IE, </condition> </condition> <action> then the UE shall set the ePCO bit to "extended protocol configuration options supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the UE supports V2X communication over E-UTRAN-PC5, </condition> </condition> <action> then the UE shall set the V2X PC5 bit to "V2X communication over E-UTRAN-PC5 supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> For all cases except case b, </condition> <condition> if the UE supports V2X communication over NR-PC5, </condition> <action> then the UE shall set the V2X NR- PC5 bit to "V2X communication over NR-PC5 supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> For all cases except case b, </condition> <condition> if the UE supports the restriction on use of enhanced coverage, </condition> <action> then the UE shall set the RestrictEC bit to "Restriction on use of enhanced coverage supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the UE supports the control plane data back-off timer T3448, </condition> </condition> <action> the UE shall set the CP backoff bit to "backoff timer for transport of user data via the control plane supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the UE supports dual connectivity with NR, </condition> </condition> then <action> the UE shall set the DCNR bit to "dual connectivity with NR supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message </action> and <action> shall include the UE additional security capability IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> For all cases except case b, </condition> <condition> if the UE supports SGC, </condition> then <action> the UE shall set the SGC bit to "service gap control supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the UE supports signalling for a maximum number of 15 EPS bearer contexts, </condition> </condition> <action> then the UE shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except cases b and zb, </condition> <condition> if the UE supports ciphered broadcast assistance data </condition> and <condition> the UE needs to obtain new ciphering keys, </condition> </condition> <action> the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> For case ee, </condition> <action> the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> For case a, </condition> <condition> if the UE supports ciphered broadcast assistance data </condition> and <condition> the UE detects entering a tracking area for which one or more ciphering keys stored at the UE is not applicable, </condition> the <action> UE should include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> For case b, </condition> <condition> if the UE supports ciphered broadcast assistance data and the remaining validity time for one or more ciphering keys stored at the UE is less than timer T3412, </condition> <action> the UE should include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the UE supports N1 mode, </condition> </condition> <action> the UE shall set the N1mode bit to "N1 mode supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message </action> and <action> shall include the UE additional security capability IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> in WB-S1 mode, </condition> <condition> if the UE supports RACS </condition> </condition> the <action> UE shall set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For cases n, za and zc, </condition> <condition> in WB-S1 mode, </condition> <condition> if the UE supports RACS </condition> and <condition> the UE has an applicable UE radio capability ID for the new UE radio configuration in the selected PLMN, </condition> </condition> <action> the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except cases b, n, za and zc, </condition> <condition> in WB-S1 mode, </condition> <condition> if the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, </condition> </condition> <action> the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For all cases except case b, </condition> <condition> if the UE supports WUS assistance, </condition> </condition> <action> then the UE shall set the WUSA bit to "WUS assistance supported" in the UE network capability IE, </action> </control> and <control> <condition> if the UE is not attaching for emergency bearer services, </condition> <action> the UE may include its UE paging probability information in the Requested WUS assistance information IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
5.5.3.2.3 EMM common procedure initiation
<control> <condition> <condition> If the network receives a TRACKING AREA UPDATE REQUEST message containing the Old GUTI type IE, </condition> and <condition> the network does not follow the use of the most significant bit of the &lt;MME group id&gt; to distinguish the node type as specified in 3GPP TS 23.003, subclause 2.8.2.2.2, </condition> </condition> <action> the network shall use the Old GUTI type IE to determine whether the mobile identity included in the Old GUTI IE is a native GUTI or a mapped GUTI. </action> </control>
<control> <condition> During the tracking area updating procedure, </condition> <action> the MME may initiate EMM common procedures, e.g. the EMM authentication and security mode control procedures. </action> </control>
<control> <action> The MME may be configured to skip the authentication procedure </action> <condition> even if no EPS security context is available </condition> and <action> proceed directly to the execution of the security mode control procedure as specified in subclause 5.4.3, </action> </control> <control> <condition> during a tracking area updating procedure for a UE that has only a PDN connection for emergency bearer services or for RLOS. </condition> </control>
<control> <action> The MME shall not initiate an EMM authentication procedure before completion of the tracking area updating procedure, </action> <condition> if the following conditions apply: </condition> </control> <control> a) <condition> the UE initiated the tracking area updating procedure after handover or inter-system handover to S1 mode; </condition> </control> <control> b) <condition> the target cell is a shared network cell; </condition> </control> and <control> a) <condition> <condition> the UE has provided its GUTI in the Old GUTI IE </condition> or <condition> the Additional GUTI IE in the TRACKING AREA UPDATE REQUEST message, </condition> and <condition> the PLMN identity included in the GUTI is different from the selected PLMN identity of the target cell; </condition> </condition> </control> or <control> b) <condition> the UE has mapped the P-TMSI and RAI into the Old GUTI IE </condition> and not included an Additional GUTI IE in the TRACKING AREA UPDATE REQUEST message, and the PLMN identity included in the RAI is different from the selected PLMN identity of the target cell. </control>
5.5.3.2.4 Normal and periodic tracking area updating procedure accepted by the network
<control> <condition> If the tracking area update request has been accepted by the network, </condition> <action> the MME shall send a TRACKING AREA UPDATE ACCEPT message to the UE. </action> <control> <condition> If the MME assigns a new GUTI for the UE, </condition> <action> a GUTI shall be included in the TRACKING AREA UPDATE ACCEPT message. </action> <control> <condition> In this case, </condition> <action> the MME shall start timer T3450 </action> and <end_state> enter state EMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.4.1. </end_state> </control> <action> The MME may include a new TAI list for the UE in the TRACKING AREA UPDATE ACCEPT message. </action> <action> The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode. </action> </control> </control>
NOTE 1: When assigning the TAI list, the MME can take into account the eNodeB's capability of support of CIoT EPS optimization.
<control> <condition> If the UE has included the UE network capability IE or the MS network capability IE or both in the TRACKING AREA UPDATE REQUEST message, </condition> <action> the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element. </action> </control>
NOTE 2: This information is forwarded to the new MME during inter-MME handover or to the new SGSN during inter-system handover to A/Gb mode or Iu mode.
NOTE 3: For further details concerning the handling of the MS network capability and UE network capability in the MME see also 3GPP TS 23.401.
<control> <condition> In NB-S1 mode, </condition> <condition> if the tracking area update request is accepted by the network, </condition> <action> the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the TRACKING AREA UPDATE ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available. </action> </control>
<control> <condition> In NB-S1 mode, </condition> <condition> if the tracking area update request is accepted by the network, </condition> <action> the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the TRACKING AREA UPDATE ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available. </action> </control>
<control> <condition> If a UE radio capability information update needed IE is included in the TRACKING AREA UPDATE REQUEST message, </condition> <action> the MME shall delete the stored UE radio capability information or the UE radio capability ID, if any. </action> </control>
<control> <condition> If the UE specific DRX parameter was included in the DRX Parameter IE in the TRACKING AREA UPDATE REQUEST message, </condition> <action> the network shall replace any stored UE specific DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data in WB-S1 mode. </action> </control>
<control> <condition> <condition> In NB-S1 mode, </condition> <condition> if the DRX parameter in NB-S1 mode IE was included in the TRACKING AREA UPDATE REQUEST message, </condition> </condition> <action> the the MME shall provide to the UE the Negotiated DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE ACCEPT message. </action> <action> The MME shall replace any stored UE specific DRX parameter in NB-S1 mode with the negotiated DRX parameter and use it for the downlink transfer of signalling and user data in NB- S1 mode. </action> </control>
<control> NOTE 4: <condition> <condition> In NB-S1 mode, </condition> <condition> if a DRX parameter was included in the Negotiated DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE ACCEPT message, </condition> </condition> <action> then the UE stores and uses the received DRX parameter in NB- S1 mode (see 3GPP TS 36.304 ). </action> </control> <control> <condition> <condition> If the UE has included the DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE REQUEST message, </condition> <condition> but did not receive a DRX parameter in the Negotiated DRX parameter in NB- S1 mode IE, </condition> or <condition> if the Negotiated DRX parameter in NB-S1 mode IE was not included in the TRACKING AREA UPDATE ACCEPT message, </condition> </condition> <action> then the UE uses the cell specific DRX value in NB-S1 mode (see 3GPP TS 36.304 ). </action> </control> <control> <condition> <condition> If the UE requests "control plane CIoT EPS optimization" in the Additional update type IE, indicates support of control plane CIoT EPS optimization in the UE network capability IE </condition> and <condition> the MME decides to accept the requested CIoT EPS optimization and the tracking area update request, </condition> </condition> <action> the MME shall indicate "control plane CIoT EPS optimization supported" in the EPS network feature support IE. </action> </control>
<control> <condition> <condition> In NB-S1 mode, </condition> <condition> if the UE requested "SMS only" in the Additional update type IE, </condition> <condition> supports NB-S1 mode only </condition> and <condition> the MME decides to accept the tracking area update request for EPS services and "SMS only", </condition> </condition> <action> the MME shall indicate "SMS only" in the Additional update result IE </action> and <action> shall set the EPS update type IE to "TA updating" in the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <action> The MME shall include the extended DRX parameters IE in the TRACKING AREA UPDATE ACCEPT message only </action> <condition> <condition> if the extended DRX parameters IE was included in the TRACKING AREA UPDATE REQUEST message, </condition> and <condition> the MME supports and accepts the use of eDRX. </condition> </condition> </control>
<control> <condition> <condition> If: a) the UE supports WUS assistance; </condition> and b) <condition> the MME supports and accepts the use of WUS assistance, </condition> </condition> then <action> the MME shall determine the negotiated UE paging probability information for the UE, </action> <action> store it in the EMM context of the UE, </action> </control> and <control> <condition> if the UE is not attaching for emergency bearer services, </condition> <action> the MME shall include it in the Negotiated WUS assistance information IE in the TRACKING AREA UPDATE ACCEPT message. </action> <action> The MME may take into account the UE paging probability information received in the Requested WUS assistance information IE </action> <condition> when determining the negotiated UE paging probability information for the UE. </condition> </control>
4: Besides the UE paging probability information requested by the UE, the MME can take local configuration or previous statistical information for the UE into account when determining the negotiated UE paging probability information for the UE (see 3GPP TS 23.401 ).
<control> <condition> <condition> If the UE indicates support for EMM-REGISTERED without PDN connection in the TRACKING AREA UPDATE REQUEST message </condition> and <condition> the MME supports EMM-REGISTERED without PDN connection, </condition> </condition> <action> the MME shall indicate this in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. </action> <action> The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause 5 and in clause 6. </action> </control>
<control> <condition> If an EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST message, </condition> <action> the MME shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the MME and the UE) which are in ESM state BEARER CONTEXT ACTIVE or BEARER CONTEXT MODIFY PENDING on the network side, but are indicated by the UE as being in ESM state BEARER CONTEXT INACTIVE. </action> </control> <control> <condition> <condition> If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE REQUEST message, </condition> and <condition> this default bearer is not associated with the last remaining PDN connection of the UE in the MME, </condition> </condition> <action> the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. </action> </control> <control> <condition> If the default bearer is associated with the last remaining PDN connection of the UE in the MME, </condition> and <condition> EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> <action> the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. </action> </control>
<control> <condition> If the EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST, </condition> <action> the MME shall include an EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message, indicating which EPS bearer contexts are active in the MME except for the case no EPS bearer context exists on the network side. </action> </control>
<control> <condition> If the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates "periodic updating", </condition> and <condition> the UE was previously successfully attached for EPS and non-EPS services, subject to operator policies the MME should allocate a TAI list that does not span more than one location area. </condition> </control>
<control> <condition> If the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates "periodic updating", </condition> and <condition> the UE was previously successfully attached for EPS and non-EPS services, </condition> <action> subject to operator policies the MME should allocate a TAI list that does not span more than one location area. </action> </control>
<control> <action> The MME shall indicate "combined TA/LA updated" or "combined TA/LA updated and ISR activated" in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message, </action> <condition> if the following conditions apply: </condition> </control> <control> a) <condition> <condition> the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates "periodic updating" </condition> and <condition> the UE was previously successfully attached for EPS and non-EPS services; </condition> </condition> </control> and <control> b) <condition> location area updating for non-EPS services as specified in 3GPP TS 29.118 is successful. </condition> </control>
<control> <action> The MME may include T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message </action> <condition> only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the TRACKING AREA UPDATE REQUEST message. </condition> </control>
<control> <action> The MME shall include the T3324 value IE in the TRACKING AREA UPDATE ACCEPT message </action> <condition> <condition> only if the T3324 value IE was included in the TRACKING AREA UPDATE REQUEST message, </condition> <condition> and the MME supports and accepts the use of PSM. </condition> </condition> </control>
<control> <condition> <condition> If the MME supports and accepts the use of PSM, </condition> and <condition> the UE included the T3412extended value IE in the TRACKING AREA UPDATE REQUEST message, </condition> </condition> </control> then <control> <action> the MME shall take into account the T3412 value requested </action> <condition> when providing the T3412 value IE and the T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message. </condition> </control>
NOTE 5: Besides the value requested by the MS, the MME can take local configuration or subscription data provided by the HSS into account when selecting a value for T3412 (see 3GPP TS 23.401 subclause 4.3.17.3).
<control> <condition> If the MME includes the T3324 value IE indicating a value other than deactivated in the TRACKING AREA UPDATE ACCEPT message, </condition> then <action> the MME shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated. </action> </control>
<control> Also, <condition> <condition> during the tracking area updating procedure without the "active" flag set, </condition> <condition> if the MME has deactivated EPS bearer context(s) locally for any reason, </condition> </condition> <action> the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> Also, <condition> <condition> during the tracking area updating procedure with the "active" flag set, </condition> <condition> if the MME has deactivated EPS bearer context(s) associated with control plane only indication locally for any reason, </condition> </condition> <action> the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <condition> If the TRACKING AREA UPDATE ACCEPT message contains the DCN-ID IE, </condition> <action> then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C. </action> </control>
<control> <condition> <condition> If due to regional subscription restrictions </condition> or <condition> access restrictions the UE is not allowed to access the TA, </condition> <condition> but it has a PDN connection for emergency bearer services established, </condition> </condition> <action> the MME may accept the TRACKING AREA UPDATE REQUEST message and deactivate all non-emergency EPS bearer contexts by initiating an EPS bearer context deactivation procedure </action> <condition> when the tracking area updating procedure is initiated in EMM-CONNECTED mode. </condition> <control> <condition> When the tracking area updating procedure is initiated in EMM-IDLE mode, </condition> <action> the MME locally deactivates all non-emergency EPS bearer contexts </action> and <action> informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message. </action> <action> The MME shall not deactivate the emergency EPS bearer contexts. </action> <action> The network shall consider the UE to be attached for emergency bearer services only and shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated. </action> </control> </control>
<control> <condition> <condition> If a TRACKING AREA UPDATE REQUEST message is received from a UE with a LIPA PDN connection, </condition> and <condition> if: a) a GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, </condition> and <condition> the P-GW address included in the EPS bearer context of the LIPA PDN Connection is different from the provided GW Transport Layer Address IE value (see 3GPP TS 36.413 ); </condition> </condition> </control> or <control> b) <condition> no GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer, </condition> then <condition> the MME locally deactivates all EPS bearer contexts associated with the LIPA PDN connection. </condition> </control> <control> Furthermore, the MME takes one of the following actions: c) <condition> if no active EPS bearer contexts remain for the UE, </condition> <action> the MME shall not accept the tracking area update request as specified in subclause 5.5.3.2.5; </action> </control> <control> d) <condition> <condition> if active EPS bearer contexts remain for the UE </condition> and <condition> the TRACKING AREA UPDATE REQUEST message is accepted, </condition> </condition> <action> the MME informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message that EPS bearer contexts were locally deactivated. </action> </control>
<control> <condition> If a TRACKING AREA UPDATE REQUEST message is received from a UE with a SIPTO at the local network PDN connection, is accepted by the network, </condition> <action> the following different cases can be distinguished: </action> <control> 1) <condition> If the PDN connection is a SIPTO at the local network PDN connection with collocated L-GW </condition> </control> and <control> if: a) <condition> <condition> a SIPTO L-GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, </condition> and <condition> the P-GW address included in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address IE value (see 3GPP TS 36.413 ); </condition> </condition> </control> or <control> b) <condition> no SIPTO L-GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer, </condition> </control> </control>
<control> 2) <condition> <condition> If the PDN connection is a SIPTO at the local network PDN connection with stand-alone GW </condition> and <condition> if: a) a LHN-ID value is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, </condition> <condition> and the LHN-ID stored in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP TS 36.413 ); </condition> </condition> </control> or <control> b) <condition> <condition> no LHN-ID value is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer, </condition> then the MME takes one of the following actions: c) <condition> if the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, </condition> and <condition> EMM- REGISTERED without PDN connection is not supported by the UE or the MME, </condition> </condition> then <action> the MME shall upon completion of the tracking area updating procedure detach the UE by using detach type "re-attach required" (see subclause 5.5.2.3.1); </action> </control> <control> d) <condition> <condition> if the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, </condition> and <condition> EMM- REGISTERED without PDN connection is supported by the UE and the MME, </condition> </condition> then <action> the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause #39 "reactivation requested"for the default EPS bearer context of the SIPTO at the local network PDN connection (see subclause 6.4.4.2); </action> </control> and <control> e) <condition> if a PDN connection remains that is not SIPTO at the local network PDN connection, </condition> <action> the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause #39 "reactivation requested"for the default EPS bearer context of each SIPTO at the local network PDN connection (see subclause 6.4.4.2); </action> </control>
For a SIPTO at the local network PDN connection with stand-alone GW, the conditions to deactivate ISR are specified in 3GPP TS 23.401 , subclause 4.3.5.6.
For a shared network, the TAIs included in the TAI list can contain different PLMN identities. The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP TS 23.251 ).
<control> <condition> <condition> If the "active" flag is set in the TRACKING AREA UPDATE REQUEST message </condition> and <condition> control plane CIoT EPS optimization is not used by the MME, </condition> </condition> <action> the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts. </action> </control> <control> If the "active" flag is set in the TRACKING AREA UPDATE REQUEST message </control> and <control> <condition> control plane CIoT EPS optimization is used by the MME, </condition> <action> the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication. </action> </control>
<control> <condition> If the "signalling active" flag is set in the TRACKING AREA UPDATE REQUEST message </condition> and <condition> control plane CIoT EPS optimization is used by the MME, </condition> <action> the MME shall not immediately release the NAS signalling connection after the completion of the tracking area updating procedure. </action> </control>
<control> <condition> <condition> If the "active" flag is not set in the TRACKING AREA UPDATE REQUEST message </condition> and <condition> control plane CIoT EPS optimization is not used by the MME, </condition> </condition> <action> the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts due to downlink pending data or downlink pending signalling. </action> </control> <control> <condition> <condition> If the "active" flag is not set in the TRACKING AREA UPDATE REQUEST message </condition> and <condition> control plane CIoT EPS optimization is used by the MME, </condition> </condition> <action> the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication due to downlink pending data or downlink pending signalling. </action> </control>
<control> <condition> If the MME supports NB-S1 mode, Non-IP or Ethernet PDN type, inter-system change with 5GS, </condition> or <condition> the network wants to enforce the use of DNS over (D)TLS (see 3GPP TS 33.501 ), </condition> then <action> the MME shall support the extended protocol configuration options IE. </action> </control>
NOTE 6: Support of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.401 and it is implemented based on the operator requirement.
<control> <condition> <condition> If the MME supports the extended protocol configuration options IE </condition> and <condition> the UE indicated support of the extended protocol configuration options IE, </condition> </condition> then <action> the MME shall set the ePCO bit to "extended protocol configuration options supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE indicates support for restriction on use of enhanced coverage in the TRACKING AREA UPDATE REQUEST message, </condition> <condition> and the network decides to restrict the use of enhanced coverage for the UE </condition> </condition> , then <action> the MME shall set the RestrictEC bit to "Use of enhanced coverage is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. </action> </control>
The MME may indicate the header compression configuration status IE in the TRACKING AREA UPDATE ACCEPT message for each established EPS bearer context using control plane CIoT EPS optimisation.
<control> <condition> <condition> If the UE has indicated support for the control plane data back-off timer, </condition> and <condition> the MME decides to activate the congestion control for transport of user data via the control plane, </condition> </condition> then <action> the MME shall include the T3448 value IE in the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE indicates support for dual connectivity with NR in the TRACKING AREA UPDATE REQUEST message, </condition> and <condition> the MME decides to restrict the use of dual connectivity with NR for the UE, </condition> </condition> then <action> the MME shall set the RestrictDCNR bit to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <condition> If the UE indicates support for N1 mode in the TRACKING AREA UPDATE REQUEST message </condition> and <condition> the MME supports inter-system interworking with 5GS, </condition> <action> the MME may set the IWK N26 bit to either: a) "interworking without N26 interface not supported" if the MME supports N26 interface; </action> or b) <action> "interworking without N26 interface supported" if the MME does not support N26 interface in the EPS network feature support IE in the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <condition> If due to operator policies unsecured redirection to a GERAN cell is not allowed in the current PLMN, </condition> <action> the MME shall set the redir-policy bit to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <condition> <condition> If the UE has indicated support for service gap control, </condition> <condition> a service gap time value is available in the EMM context, </condition> </condition> <action> the MME may include the T3447 value IE set to the service gap time value in the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <condition> <condition> If the network supports signalling for a maximum number of 15 EPS bearer contexts </condition> and <condition> the UE indicated support of signalling for a maximum number of 15 EPS bearer contexts in the TRACKING AREA UPDATE REQUEST message, </condition> </condition> then <action> the MME shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <condition> If the UE requests ciphering keys for ciphered broadcast assistance data in the TRACKING AREA UPDATE REQUEST message </condition> and <condition> the MME has valid ciphering key data applicable to the UE's subscription, </condition> then <action> the MME shall include the ciphering key data in the Ciphering key data IE of the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <condition> Upon receiving a TRACKING AREA UPDATE ACCEPT message, </condition> <action> the UE shall stop timer T3430, </action> <action> reset the service request attempt counter, tracking area updating attempt counter, </action> <end_state> enter state EMM-REGISTERED </end_state> and <action> set the EPS update status to EU1 UPDATED. </action> </control> <control> <condition> If the message contains a GUTI, </condition> <action> the UE shall use this GUTI as new temporary identity for EPS services </action> and <action> shall store the new GUTI. </action> </control> <control> <condition> If no GUTI was included by the MME in the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the old GUTI shall be used. </action> </control> <control> <condition> If the UE receives a new TAI list in the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the UE shall consider the new TAI list as valid and the old TAI list as invalid; </action> </control> <control> <condition> otherwise, </condition> <action> the UE shall consider the old TAI list as valid. </action> </control>
<control> <condition> If the UE receives the TRACKING AREA UPDATE ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see subclause 5.3.7b), </condition> then <action> the UE shall reset these counters. </action> </control> <control> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> then <action> the UE shall reset this counter. </action> </control>
<control> <condition> If the TRACKING AREA UPDATE ACCEPT message contains the T3412 extended value IE, </condition> then <action> the UE shall use the T3412 extended value IE as periodic tracking area update timer (T3412). </action> </control> <control> <condition> <condition> If the TRACKING AREA UPDATE ACCEPT contains T3412 value IE, </condition> <condition> but not T3412 extended value IE, </condition> </condition> then <action> the UE shall use value in T3412 value IE as periodic tracking area update timer (T3412). </action> </control> <control> <condition> If neither T3412 value IE nor T3412 extended value IE is included, </condition> the <action> UE shall use the value currently stored, e.g. from a prior ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <condition> If the TRACKING AREA UPDATE ACCEPT message contains the T3324 value IE, </condition> then <action> the UE shall use the timer value for T3324 as specified in 3GPP TS 24.008 , subclause 4.7.2.8. </action> </control>
<control> <condition> <condition> If the UE had initiated the tracking area updating procedure in EMM-IDLE mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode </condition> and <condition> the nonce was included in the TRACKING AREA UPDATE UE REQUEST message, </condition> </condition> <action> the UE shall delete the nonce </action> <condition> upon receipt of the TRACKING AREA UPDATE ACCEPT UE message. </condition> </control>
<control> <condition> If an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the UE shall deactivate all those EPS bearers contexts locally (without peer-to-peer signalling between the UE and the MME) which are active in the UE, but are indicated by the MME as being inactive. </action> </control> <control> <condition> <condition> If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE ACCEPT message, </condition> and <condition> this default bearer is not associated with the last remaining PDN connection in the UE, </condition> </condition> <action> the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. </action> </control> <control> <condition> If only the PDN connection for emergency bearer services remains established, </condition> <action> the UE shall consider itself attached for emergency bearer services only. </action> </control> <control> <condition> <condition> If the default bearer is associated with the last remaining PDN connection of the UE in the MME, </condition> and <condition> EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> </condition> <action> the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. </action> </control>
<control> <condition> If an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the UE may choose to ignore all those EPS bearers which are indicated by the MME as being active but are inactive at the UE. </action> </control>
The MME may also include a list of equivalent PLMNs in the TRACKING AREA UPDATE ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and <control> <condition> if there is no PDN connection for emergency bearer services or PDN connection for RLOS established, </condition> <action> the UE shall remove from the list any PLMN code that is already in the list of "forbidden PLMNs" or in the list of "forbidden PLMNs for GPRS service". </action> </control> <control> <condition> <condition> If the UE is not attached for emergency bearer services </condition> and <condition> there is a PDN connection for emergency bearer services established, </condition> </condition> <action> the UE shall remove from the list of equivalent PLMNs any PLMN code present in the list of forbidden PLMNs or in the list of "forbidden PLMNs for GPRS service" </action> <condition> when the PDN connection for emergency bearer services is released. </condition> </control> In addition, <control> <action> the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. </action> <action> The UE shall replace the stored list on each receipt of the TRACKING AREA UPDATE ACCEPT message. </action> <condition> If the TRACKING AREA UPDATE ACCEPT message does not contain a list, </condition> then <action> the UE shall delete the stored list. </action> </control>
<control> <condition> If the UE is neither attached for emergency bearer services nor attached for access to RLOS, </condition> and <condition> if the PLMN identity of the registered PLMN is a member of the list of "forbidden PLMNs" or the list of "forbidden PLMNs for GPRS service", </condition> <action> any such PLMN identity shall be deleted from the corresponding list(s). </action> </control>
<control> The network may also indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is active. <condition> If the UE is attached for emergency bearer services, </condition> <action> the network shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated. </action> </control> <control> <condition> If the TRACKING AREA UPDATE ACCEPT message contains: i) no indication that ISR is activated, </condition> <action> the UE shall set the TIN to "GUTI" </action> and <action> shall stop the periodic routing area update timer T3312 or T3323, </action> </control> if running; <control> ii) <condition> an indication that ISR is activated, </condition> </control> then: <control> a) <condition> if the UE is required to perform routing area updating for IMS voice termination as specified in 3GPP TS 24.008 , annex P.5, </condition> <action> the UE shall set the TIN to "GUTI" </action> and <action> shall stop the periodic routing area update timer T3312 or T3323, if running; </action> </control> <control> b) <condition> if the UE had initiated the tracking area updating procedure due to a change in UE network capability or change in DRX parameters, </condition> <action> the UE shall set the TIN to "GUTI" </action> and <action> shall stop the periodic routing area update timer T3312 or T3323, if running; </action> </control> <control> c) <condition> if the UE had initiated the tracking area updating procedure due to a change in the UE's usage setting or the voice domain preference for E-UTRAN, </condition> the <action> UE shall set the TIN to "GUTI" </action> and <action> shall stop the periodic routing area update timer T3312 or T3323, if running; </action> </control> or <control> d) <action> the UE shall regard a previously assigned P-TMSI and RAI as valid </action> and <action> registered with the network. </action> <condition> If the TIN currently indicates "P-TMSI" and the periodic routing area update timer T3312 is running or is deactivated, </condition> <action> the UE shall set the TIN to "RAT-related TMSI". </action> </control> <control> <condition> If the TIN currently indicates "P-TMSI" and the periodic routing area update timer T3312 has already expired, </condition> <action> the UE shall set the TIN to "GUTI". </action> </control>
The network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. In a UE with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. <control> <action> The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP TS 23.221 , subclause 7.2a and subclause 7.2b, </action> <condition> when selecting the access domain for voice sessions or calls. </condition> </control> <control> <condition> When initiating an emergency call, </condition> <action> the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. </action> </control> <control> <condition> When the UE determines via the IMS voice over PS session indicator that the network does not support IMS voice over PS sessions in S1 mode, </condition> then <action> the UE shall not locally release any persistent EPS bearer context. </action> </control> <control> <condition> When the UE determines via the emergency bearer services indicator that the network does not support emergency bearer services in S1 mode, </condition> then <action> the UE shall not locally release any emergency EPS bearer context if there is a radio bearer associated with that context. </action> </control> <control> <condition> In a UE with LCS capability, </condition> <action> location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. </action> </control> <control> <condition> When MO-LR procedure is triggered by the UE's application, </condition> those indicators are taken into account as specified in 3GPP TS 24.171. </control>
<control> <condition> If the RestrictDCNR bit is set to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers. </action> </control>
<control> <action> The UE supporting N1 mode shall operate in the mode for inter-system interworking with 5GS as follows: </action> </control> <control> a) <condition> if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface not supported", </condition> <action> the UE shall operate in single-registration mode; </action> </control> <control> b) <condition> <condition> if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" </condition> and <condition> the UE supports dual-registration mode, </condition> </condition> <action> the UE may operate in dual-registration mode; </action> </control> or NOTE 7: The registration mode used by the UE is implementation dependent. <control> c) <condition> <condition> if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" </condition> and <condition> the UE only supports single-registration mode, </condition> </condition> <action> the UE shall operate in single-registration mode. </action> </control>
The UE shall treat the interworking without N26 interface indicator as valid in the entire PLMN and equivalent PLMNs.
The interworking procedures required for coordination between 5GMM and EMM without N26 interface are specified in 3GPP TS 24.501 .
<control> <condition> If the redir-policy bit is set to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN not allowed" </action> and <action> indicate to the lower layers that unsecured redirection to a GERAN cell is not allowed. </action> </control> <control> <condition> <condition> If the redir-policy bit is set to "Unsecured redirection to GERAN allowed" </condition> or <condition> if the Network policy IE is not included in the TRACKING AREA UPDATE ACCEPT message, </condition> </condition> <action> the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN allowed" </action> and <action> indicate to the lower layers that unsecured redirection to a GERAN cell is allowed. </action> <action> The UE shall set the network policy on unsecured redirection to GERAN to "Unsecured redirection to GERAN not allowed" </action> and <action> indicate this to the lower layers </action> <condition> when any of the following events occurs: </condition> </control> <control> a) <condition> the UE initiates an EPS attach or tracking area updating procedure in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure; </condition> </control> <control> b) <condition> the UE is switched on; </condition> </control> or <control> c) <condition> the UICC containing the USIM is removed. </condition> </control>
<control> <condition> If the UE has initiated the tracking area updating procedure due to manual CSG selection and receives a TRACKING AREA UPDATE ACCEPT message, </condition> and <condition> the UE sent the TRACKING AREA UPDATE REQUEST message in a CSG cell, </condition> <action> the UE shall check if the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list. </action> </control> <control> <condition> If not, </condition> <action> the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list </action> and <action> the UE may add the HNB Name (if provided by lower layers) to the Allowed CSG list </action> <condition> if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list. </condition> </control>
<control> <condition> If the TRACKING AREA UPDATE ACCEPT message contained a GUTI, </condition> <action> the UE shall return a TRACKING AREA UPDATE COMPLETE message to the MME to acknowledge the received GUTI. </action> </control>
<control> <condition> <condition> If the UE which was previously successfully attached for EPS </condition> and <condition> non-EPS services receives the TRACKING AREA UPDATE ACCEPT message with EPS update result IE indicating "combined TA/LA updated" </condition> or <condition> "combined TA/LA updated and ISR activated" as the response of the TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating "periodic updating", </condition> </condition> <action> the UE shall behave as follows: </action> </control> <control> a) <condition> If the TRACKING AREA UPDATE ACCEPT message contains an IMSI, </condition> <action> the UE is not allocated any TMSI, </action> and <action> shall delete any old TMSI accordingly. </action> </control> <control> b) <condition> If the TRACKING AREA UPDATE ACCEPT message contains a TMSI, </condition> <action> the UE shall use this TMSI as new temporary identity. </action> <action> The UE shall delete its old TMSI </action> and <action> shall store the new TMSI. </action> </control> <control> <condition> In this case, </condition> <action> a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI. </action> </control> <control> c) <condition> If neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the old TMSI, if any is available, shall be kept. </action> </control>
<control> <condition> If the header compression configuration status is included in the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the UE shall stop using header compression and decompression for those EPS bearers using Control plane CIoT EPS optimisation </action> <condition> for which the MME indicated that the header compression configuration is not used. </condition> </control>
<control> <condition> If the T3448 value IE is present in the received TRACKING AREA UPDATE ACCEPT message, </condition> <action> the UE shall: a) stop timer T3448 if it is running; </action> and b) <action> start timer T3448 with the value provided in the T3448 value IE. </action> </control>
<control> <condition> <condition> If the UE is using EPS services with control plane CIoT EPS optimization, </condition> <condition> the T3448 value IE is present in the TRACKING AREA UPDATE ACCEPT message </condition> and <condition> the value indicates that this timer is either zero or deactivated, </condition> </condition> <action> the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present. </action> </control>
<control> <condition> <condition> If the UE in EMM-IDLE mode initiated the tracking area updating procedure </condition> and <condition> the TRACKING AREA UPDATE ACCEPT message does not include the T3448 value IE </condition> and <condition> if timer T3448 is running, </condition> </condition> then <action> the UE shall stop timer T3448. </action> </control>
<control> <condition> <condition> If the UE has indicated "service gap control supported" in the TRACKING AREA UPDATE REQUEST message </condition> and: a) <condition> the TRACKING AREA UPDATE ACCEPT message contains the T3447 value IE, </condition> </condition> then <action> the UE shall store the new T3447 value, </action> <action> erase any previous stored T3447 value if exists </action> and <action> use the the new T3447 value with the T3447 timer next time it is started; </action> </control> or <control> a) <condition> the TRACKING AREA UPDATE ACCEPT message does not contain the T3447 value IE, </condition> then <action> the UE shall erase any previous stored T3447 value if exists </action> and <action> stop the T3447 timer if running. </action> </control>
<control> <condition> Upon receiving a TRACKING AREA UPDATE COMPLETE message, </condition> <action> the MME shall stop timer T3450 </action> and <end_state> change to state EMM-REGISTERED. </end_state> </control> <control> <condition> if sent in the TRACKING AREA UPDATE ACCEPT message, </condition> <action> The GUTI, shall be considered as valid. </action> </control>
<control> NOTE 8: <condition> <condition> Upon receiving a TRACKING AREA UPDATE COMPLETE message, </condition> <condition> if a new TMSI was included in the TRACKING AREA UPDATE ACCEPT message, </condition> </condition> <action> the MME sends an SGsAP-TMSI- REALLOCATION-COMPLETE message as specified in 3GPP TS 29.118. </action> </control>
<control> <condition> <condition> For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, </condition> <condition> if the UE has included an eKSI in the NAS Key Set Identifier IE indicating a current EPS security context in the TRACKING AREA UPDATE REQUEST message by which the TRACKING AREA UPDATE REQUEST message is integrity protected, </condition> </condition> <action> the MME shall take one of the following actions: </action> </control> <control> a) <condition> if the MME retrieves the current EPS security context as indicated by the eKSI and GUTI sent by the UE, </condition> <action> the MME shall integrity check the TRACKING AREA UPDATE REQUEST message using the current EPS security context </action> and <action> integrity protect the TRACKING AREA UPDATE ACCEPT message using the current EPS security context; </action> </control> <control> b) <condition> <condition> if the MME cannot retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, </condition> and <condition> if the UE has included a valid GPRS ciphering key sequence number, </condition> </condition> <action> the MME shall create a new mapped EPS security context as specified in 3GPP TS 33.401, </action> and then <action> perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see subclause 5.4.3.2); </action> </control> or <control> c) <condition> if the UE has not included an Additional GUTI IE, </condition> <action> the MME may treat the TRACKING AREA UPDATE REQUEST message as in the previous item, </action> i.e. <condition> as if it cannot retrieve the current EPS security context. </condition> </control>
NOTE 9: The handling described above at failure to retrieve the current EPS security context or if no Additional GUTI IE was provided does not preclude the option for the MME to perform an EPS authentication procedure and create a new native EPS security context.
<control> <condition> <condition> For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, </condition> <condition> if the UE has not included a valid eKSI in the NAS Key Set Identifier IE </condition> and <condition> has included a valid GPRS ciphering key sequence number in the TRACKING AREA UPDATE REQUEST message, </condition> </condition> <action> the MME shall create a new mapped EPS security context as specified in 3GPP TS 33.401, </action> and <action> then perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see subclause 5.4.3.2). </action> </control>
NOTE 10: This does not preclude the option for the MME to perform an EPS authentication procedure and create a new native EPS security context.
<control> <condition> <condition> For inter-system change from N1 mode to S1 mode in EMM-IDLE mode, </condition> <condition> if the UE has included an eKSI in the NAS Key Set Identifier IE indicating a 5G NAS security context in the TRACKING AREA UPDATE REQUEST message by which the TRACKING AREA UPDATE REQUEST message is integrity protected, </condition> </condition> <action> the MME shall take actions as specified in subclause 4.4.2.3. </action> </control>
<control> <condition> For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-CONNECTED mode, </condition> <action> the MME shall integrity check TRACKING AREA UPDATE REQUEST message using the current K' as derived when ASME triggering the handover to E-UTRAN (see subclause 4.4.2.2). </action> <action> The MME shall verify the received UE security capabilities in the TRACKING AREA UPDATE REQUEST message. </action> <action> The MME shall then take one of the following actions: </action> </control> <control> a) <condition> if the TRACKING AREA UPDATE REQUEST does not contain a valid KSI in the Non-current native ASME NAS key set identifier IE, </condition> <action> the MME shall remove the non-current native EPS security context, if any, for any GUTI for this UE. </action> <action> The MME shall then integrity protect and cipher the TRACKING AREA UPDATE ACCEPT message using the security context based on K' and take the mapped EPS security context into use; </action> </control> or ASME <control> b) <condition> if the TRACKING AREA UPDATE REQUEST contains a valid KSI in the Non-current native NAS key set ASME identifier IE, </condition> <action> the MME may initiate a security mode control procedure to take the corresponding native EPS security context into use. </action> </control>
<control> <condition> For inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode, </condition> <action> the MME shall integrity check TRACKING AREA UPDATE REQUEST message using the current K' as derived when triggering the handover to ASME E-UTRAN (see subclause 4.4.2.2). </action> <action> The MME shall verify the received UE security capabilities in the TRACKING AREA UPDATE REQUEST message. </action> <action> The MME shall then take one of the following actions: </action> </control> <control> a) <condition> if the TRACKING AREA UPDATE REQUEST does not contain a valid KSI in the Non-current native ASME NAS key set identifier IE, </condition> <action> the MME shall remove the non-current native EPS security context, if any, for any GUTI for this UE. </action> <action> The MME shall then integrity protect and cipher the TRACKING AREA UPDATE ACCEPT message using the security context based on K' and take the mapped EPS security context into use; </action> </control> or ASME <control> b) <condition> if the TRACKING AREA UPDATE REQUEST contains a valid KSI in the Non-current native NAS key set ASME identifier IE, </condition> <action> the MME may initiate a security mode control procedure to take the corresponding native EPS security context into use. </action> </control>
<control> <condition> In WB-S1 mode, </condition> <condition> if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message, </condition> <action> the MME may include a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the TRACKING AREA UPDATE ACCEPT message. </action> In this case <end_state> the MME shall enter state EMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.4.1. </end_state> </control>
<control> <condition> <condition> In WB-S1 mode, </condition> <condition> if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and the TRACKING AREA UPDATE ACCEPT message includes: a) a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", </condition> </condition> <action> the UE shall: a) delete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE; </action> </control> <control> b) <action> send a TRACKING AREA UPDATE COMPLETE message to the network to acknowledge the received UE radio capability ID deletion indication IE; </action> </control> and <control> c) <condition> after the completion of the ongoing tracking area updating procedure, </condition> <action> initiate a tracking area updating procedure as specified in subclause 5.5.3 over the existing NAS signalling connection; </action> </control> and <control> a) <condition> a UE radio capability ID IE, </condition> <action> the UE shall: a) store the UE radio capability ID as specified in annex C; </action> and b) <action> send a TRACKING AREA UPDATE COMPLETE message to the network to acknowledge the received UE radio capability ID IE. </action> </control>
5.5.3.2.4A Tracking area updating successful for EPS services and not accepted for SMS services
Apart from the actions on the tracking area updating attempt counter, the description for tracking area update for EPS services as specified in subclause 5.5.3.2.4 shall be followed. In addition, the following description for tracking area updating for SMS services applies.
<control> <condition> In NB-S1 mode, </condition> <condition> if the UE requested "SMS only" in the Additional update type IE and supports NB-S1 mode only, </condition> <action> the MME decides to accept the tracking area update request for EPS services only </action> </control> and: a) the location update for non-EPS services is not accepted by the VLR as specified in 3GPP TS 29.118; or <control> b) <condition> the MME decides to not accept the tracking area update request for "SMS only", </condition> <action> the MME shall set the EPS update result IE to "EPS only", </action> <action> shall not indicate "SMS only" in the Additional update result IE in the TRACKING AREA UPDATE ACCEPT message </action> and <action> shall include an appropriate SMS services status value. </action> </control>
The UE receiving the TRACKING AREA UPDATE ACCEPT message takes one of the following actions depending on the value included in the SMS services status IE: "SMS services not available"
<control> <action> The UE shall stop timer T3430 </action> <condition> if still running, </condition> <action> shall reset the tracking area updating attempt counter, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> </control>
<control> <action> The USIM shall be considered as invalid for SMS services </action> <condition> until <condition> switching off or the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in subclause 5.3.7a. </condition> </condition> </control>
"SMS services not available in this PLMN"
<control> <action> The UE shall stop timer T3430 </action> <condition> if still running, </condition> <action> shall reset the tracking area updating attempt counter, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> </control>
The UE may provide a notification to the user or the upper layers that the SMS services are not available.
<control> <action> The UE shall not attempt normal attach or tracking area updating procedures indicating "SMS only" with current PLMN </action> <condition> until <condition> switching off the UE </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> Additionally, <action> the UE may perform a PLMN selection according to 3GPP TS 23.122. </action> </control>
<control> <action> The UE shall stop timer T3430 if still running. </action> <action> The tracking area updating attempt counter shall be incremented, </action> <condition> unless it was already set to 5. </condition> </control>
<control> <condition> If the tracking area updating attempt counter is less than 5: </condition> a) <action> the UE shall start timer T3411, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED. NORMAL-SERVICE. </end_state> <condition> When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered. </condition> </control>
<control> <condition> If the tracking area updating attempt counter is equal to 5: </condition> a) <action> the UE shall start timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <condition> When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered. </condition> </control>
<control> <action> The UE shall stop the timer T3430 if still running. </action> <action> The tracking area updating attempt counter shall be set to 5. </action> <action> The UE shall start the timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED, </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <condition> When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered. </condition> </control>
Other values and the case that no SMS services status IE was received are considered as abnormal cases. The tracking area updating procedure shall be considered as failed for SMS services. The behaviour of the UE in those cases is specified in subclause 5.5.3.2.6A.
5.5.3.2.5 Normal and periodic tracking area updating procedure not accepted by the network
<control> <condition> If the tracking area updating cannot be accepted by the network, </condition> <action> the MME sends a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value. </action> </control>
<control> <condition> If a tracking area update request from a UE with a LIPA PDN connection is not accepted due to the reasons specified in subclause 5.5.3.2.4, </condition> <action> the MME shall send the TRACKING AREA UPDATE REJECT message with EMM cause value #10 "Implicitly detached". </action> </control>
<control> <condition> If the tracking area update request is rejected due to general NAS level mobility management congestion control, </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> assign a value for back-off timer T3346. </action> </control>
<control> <condition> In NB-S1 mode, </condition> <condition> if the tracking area update request is rejected due to operator determined barring (see 3GPP TS 29.272 ), </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> </action> assign a value for back- off timer T3346. </control>
<control> <condition> If the tracking area request is rejected due to service gap control as specified in subclause 5.3.17 </condition> i.e. the T3447 timer is running, <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> may assign a back-off timer T3346 with the remaining time of the running T3447 timer. </action> </control>
<control> <condition> <condition> If the tracking area update request is rejected due to incompatibility between the CIoT EPS optimizations supported by the UE and what the network supports </condition> and <condition> the network sets the EMM cause value to #15 "no suitable cells in tracking area", </condition> </condition> <action> the network may additionally include the Extended EMM cause IE with value "requested EPS optimization not supported". </action> </control>
NOTE 1: How the UE uses the Extended EMM cause IE with value "requested EPS optimization not supported" is implementation specific. The UE still behaves according to the EMM cause value #15.
<control> Based on operator policy, <condition> if the tracking area update request is rejected due to core network redirection for CIoT optimizations, </condition> <action> the network shall set the EMM cause value to #31 "Redirection to 5GCN required". </action> </control>
NOTE 2: The network can take into account the UEs N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 "Redirection to 5GCN required".
<control> <condition> If the UE initiated the tracking area updating procedure due to inter-system change from N1 mode to S1 mode, </condition> and <condition> the MME does not support N26 interface, </condition> <action> the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 "UE identity cannot be derived by the network". </action> </control>
<control> <condition> <condition> Upon receiving the TRACKING AREA UPDATE REJECT message, </condition> <condition> <condition> if the message is integrity protected </condition> or <condition> contains a reject cause other than EMM cause value #25, </condition> </condition> </condition> <action> the UE shall stop timer T3430 </action> and <action> stop any transmission of user data. </action> </control>
<control> <condition> If the TRACKING AREA UPDATE REJECT message with EMM cause #25 was received without integrity protection, </condition> <action> then the UE shall discard the message. </action> </control>
The UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.
<control> <condition> #3 (Illegal UE); #6 (Illegal ME); or #8 (EPS services and non-EPS services not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> The UE shall consider the USIM as invalid for EPS services </action> <condition> <condition> until switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in subclause 5.3.7a. </condition> </condition> </control> <control> <action> The UE shall delete the list of equivalent PLMNs </action> and <end_state> shall enter the state EMM-DEREGISTERED.NO-IMSI. </end_state> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> </condition> then <action> the UE shall set this counter to UE implementation-specific maximum value. </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control> <control> <action> The USIM shall be considered as invalid also for non-EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. </condition> </condition> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> </condition> then <action> the UE shall set this counter to UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> For the EMM cause value #3 or #6, </condition> <condition> if the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> For the EMM cause value #8, </condition> <condition> if the UE is operating in single-registration mode, </condition> <action> the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> <action> and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
NOTE 3: The possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.
<control> <condition> #7 (EPS services not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> The UE shall consider the USIM as invalid for EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in subclause 5.3.7a. </condition> </condition> <end_state> The UE shall enter the state EMM- DEREGISTERED. </end_state> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> </condition> then <action> the UE shall set this counter to UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the EPS update type is "periodic updating", </condition> <condition> a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services. </condition> </condition> <action> The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, </action> <action> shall attempt to select GERAN or UTRAN radio access technology </action> and <action> shall proceed with appropriate MM specific procedure according to the MM service state. </action> </control> <control> <action> The UE shall not reselect E-UTRAN radio access technology </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
#9 (UE identity cannot be derived by the network);
<control> <action> The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <end_state> The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. </end_state> </control>
<control> <condition> If the rejected request was not for initiating a PDN connection for emergency bearer services, </condition> <action> the UE shall subsequently, automatically initiate the attach procedure. </action> </control>
NOTE 4: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> </control> <control> <condition> for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in the single-registration mode, </condition> <action> the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> If the EPS update type is "periodic updating", </condition> <action> a UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services. </action> </control>
<control> <end_state> The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. </end_state> <action> The UE shall delete any mapped EPS security context or partial native EPS security context. </action> </control> <control> <condition> If the rejected request was not for initiating a PDN connection for emergency bearer services, </condition> <action> the UE shall then perform a new attach procedure. </action> </control>
NOTE 5: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM state as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM state as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
#11 (PLMN not allowed); or #35 (Requested service option not authorized in this PLMN);
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> The UE shall reset the tracking area updating attempt counter, </action> <action> delete the list of equivalent PLMNs and enter the state EMM- DEREGISTERED.PLMN-SEARCH. </action> </control>
<control> <action> The UE shall store the PLMN identity in the "forbidden PLMN list" </action> and <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> then <action> the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS </condition> and <action> the UE maintains a PLMN-specific attempt counter for that PLMN, </action> then <action> the UE shall set this counter to the UE implementation-specific maximum value. </action> </control>
The UE shall perform a PLMN selection according to 3GPP TS 23.122 .
<control> <condition> <condition> For the EMM cause value #11, </condition> <condition> if the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> <condition> For the EMM cause value #35, </condition> <condition> if the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> The UE shall reset the tracking area updating attempt counter </action> and <end_state> shall enter the state EMM-DEREGISTERED.LIMITED- SERVICE. </end_state> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas" for regional provision of service. </action> <condition> If the TRACKING AREA UPDATE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
#13 (Roaming not allowed in this tracking area);
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete the list of equivalent PLMNs. </action> <action> The UE shall reset the tracking area updating attempt counter </action> and <action> shall change to state EMM-REGISTERED PLMN-SEARCH. </action> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" </action> and <action> shall remove the current TAI from the stored TAI list if present. </action> <condition> If the TRACKING AREA UPDATE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. </action> </control>
<control> <condition> If the UE is registered in N1 mode and operating in dual-registration mode, </condition> the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 subclause 4.8.3. </control> <control> <condition> Otherwise </condition> <action> the UE shall perform a PLMN selection according to 3GPP TS 23.122. </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #14 (EPS services not allowed in this PLMN); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). </action> Furthermore, <action> the UE shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> </control>
<control> <action> The UE shall reset the tracking area updating attempt counter </action> and <end_state> shall enter the state EMM- DEREGISTERED.PLMN-SEARCH. </end_state> </control>
<control> <action> The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list </action> and <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> then <action> the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a PLMN-specific PS-attempt counter for that PLMN, </condition> then <action> the UE shall set this counter to the UE implementation-specific maximum value. </action> </control>
<control> <condition> <condition> If the EPS update type is "TA updating", </condition> or <condition> the EPS update type is "periodic updating" </condition> and <condition> the UE is in PS mode 1 or PS mode 2 of operation, </condition> </condition> <action> the UE shall perform a PLMN selection according to 3GPP TS 23.122. </action> <condition> In this case, </condition> <action> the UE supporting S1 mode only shall delete the list of equivalent PLMNs before performing the procedure. </action> </control>
<control> <condition> <condition> If the EPS update type is "periodic updating", </condition> <condition> a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services </condition> </condition> </control> and shall proceed as follows: <control> a) <condition> a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> shall set the update status to U2 NOT UPDATED; </action> </control> <control> b) <condition> <condition> a UE operating in CS/PS mode 1 of operation </condition> and <condition> supporting A/Gb mode or Iu mode </condition> </condition> <action> may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. </action> </control> <control> <condition> In this case, </condition> <action> the UE shall disable the E-UTRA capability (see subclause 4.5); </action> </control> <control> c) <condition> a UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode </condition> <action> may perform a PLMN selection according to 3GPP TS 23.122; </action> </control> <control> d) <condition> a UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation </condition> <action> shall delete the list of equivalent PLMNs </action> and <action> shall perform a PLMN selection according to 3GPP TS 23.122. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #15 (No suitable cells in tracking area); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). </action> <action> The UE shall reset the tracking area updating attempt counter </action> and <end_state> shall enter the state EMM- REGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". </action> <condition> If the TRACKING AREA UPDATE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. </action> </control>
<control> <action> Additionally, the UE shall remove the current TAI from the stored TAI list </action> <condition> if present </condition> </control> <control> and: <condition> <condition> a) if the UE is in WB-S1 mode </condition> and <condition> the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the TRACKING AREA UPDATE REJECT message, </condition> <condition> the UE supports "E-UTRA Disabling for EMM cause #15", </condition> and <condition> the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 or 3GPP TS 31.102 is present and set to enabled; </condition> </condition> then <action> the UE shall disable the E-UTRA capability as specified in subclause 4.5 </action> and <action> search for a suitable cell in another location area or 5GS tracking area; </action> </control> <control> b) <condition> <condition> if the UE is in NB-S1 mode </condition> and <condition> the Extended EMM cause IE with value "NB-IoT not allowed" is included in the TRACKING AREA UPDATE REJECT message, </condition> </condition> then <action> the UE may disable the NB-IoT capability as specified in subclause 4.9 </action> and <action> search for a suitable cell in E-UTRAN radio access technology; </action> </control> <control> c) <condition> otherwise, </condition> <action> the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304. </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> <condition> If the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> <action> the UE shall proceed as described below, </action> </control> <control> <condition> otherwise </condition> it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.3.2.6. </control>
<control> <action> The UE shall abort the tracking area updating procedure, </action> <action> reset the tracking area updating attempt counter </action> and <action> set the EPS update status to EU2 NOT UPDATED. </action> </control> <control> <condition> If the rejected request was not for initiating a PDN connection for emergency bearer services, </condition> <action> the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO- UPDATE. </action> </control>
<control> <action> The UE shall stop timer T3346 </action> <condition> if it is running. </condition> </control>
<control> <condition> If the TRACKING AREA UPDATE REJECT message is integrity protected, </condition> <action> the UE shall start timer with the value provided in the T3346 value IE. </action> </control>
<control> <condition> If the TRACKING AREA UPDATE REJECT message is not integrity protected, </condition> <action> the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008. </action> </control>
<control> <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> <action> The tracking area updating procedure is started, </action> <condition> if still necessary, when timer T3346 expires or is stopped. </condition> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the tracking area updating procedure was initiated for and MO MMTEL voice call is started, </condition> then <action> a notification that the request was not accepted due to network congestion shall be provided to upper layers. </action> </control>
NOTE 6: This can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP TS 24.173 ).
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #25 (Not authorized for this CSG); </condition> </control>
EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.3.2.6.
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). </action> <action> The UE shall reset the tracking area updating attempt counter </action> and <end_state> shall enter the state EMM- REGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, </condition> <action> the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list. </action> </control>
<control> <condition> If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, </condition> <action> the UE shall apply the procedures defined in 3GPP TS 23.122 subclause 3.1A. </action> </control>
he UE shall search for a suitable cell according to 3GPP TS 36.304. T
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition set the 5GMM state to 5GMM- REGISTERED </action> and <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED. </action> </control>
<control> <condition> #40 (No EPS bearer context activated); </condition> </control>
<control> <action> The UE shall deactivate all the EPS bearer contexts locally, </action> <condition> if any, </condition> and <end_state> shall enter the state EMM- DEREGISTERED.NORMAL-SERVICE. </end_state> <action> The UE shall perform a new attach procedure. </action> </control>
NOTE 7: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM state as specified in 3GPP TS 24.008 </action> <condition> for the case when the normal routing area updating procedure is rejected with the GMM cause value #10 "Implicitly detached". </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED. </action> </control>
<control> <condition> #42 (Severe network failure); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU2 NOT UPDATED, </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, </action> and <action> set the tracking area update counter to 5. </action> <action> The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122. </action> <control> <condition> While this timer is running, </condition> <action> the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. </action> </control> <end_state> The UE then enters state EMM- DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122. </end_state> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition set the GMM state to GMM- DEREGISTERED, GPRS update status to GU2 NOT UPDATED, </action> and <action> shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
EMM cause #31 received by a UE that has not indicated support for CIoT optimizations is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.3.2.6.
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). </action> <action> The UE shall reset the tracking area updating attempt counter </action> and <action> shall enter the state EMM- REGISTERED.LIMITED-SERVICE. </action> </control>
<control> <action> The UE shall enable N1 mode capability for 3GPP access </action> <condition> if it was disabled and disable the E-UTRA capability </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
Other values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in subclause 5.5.3.2.6.
5.5.3.2.5A Tracking area updating procedure for initiating a PDN connection for emergency bearer services not accepted by the network
<control> <condition> If the tracking area updating request for initiating a PDN connection for emergency bearer services cannot be accepted by the network, </condition> <action> the UE shall perform the procedures as described in subclause 5.5.3.2.5. </action> </control> <control> <condition> Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, </condition> <action> the UE shall: a) inform the upper layers of the failure of the procedure; </action> </control> or NOTE 1: This can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> b) <action> detach locally, </action> <condition> if not detached already, attempt EPS attach for emergency bearer services. </condition> </control>
<control> <condition> If the tracking area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in subclause 5.5.3.2.6, </condition> <action> the UE shall perform the actions as described in subclause 5.5.3.2.6 </action> and <action> inform the upper layers of the failure to access the network. </action> </control>
NOTE 2: This can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> If the tracking area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal cases b), c) or d) in subclause 5.5.3.2.6, </condition> <action> the UE shall perform the procedures as described in subclause 5.5.3.2.6. </action> </control> <control> <condition> Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, </condition> <action> the UE shall: a) inform the upper layers of the failure of the procedure; </action> </control> or NOTE 3: This can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> b) <action> detach locally, </action> <condition> if not detached already, attempt EPS attach for emergency bearer services. </condition> </control>
5.5.3.2.5B Tracking area updating for access to RLOS not accepted by the network
<control> <condition> If the tracking area updating request for access to RLOS cannot be accepted by the network, </condition> <action> the UE shall perform the procedures as described in subclause 5.5.3.2.5 along with the following conditions: </action> </control> <control> a) <condition> if the action for the reject involves searching for a suitable cell in E-UTRAN radio access technology, </condition> <action> the UE shall proceed with the action and shall attempt to perform a tracking area updating procedure or an attach procedure for access to RLOS in the new tracking area, </action> <condition> if found, depending on the EMM state. </condition> </control>
<control> b) <condition> if the action for the reject involves attempting to select GERAN or UTRAN radio access technology or disabling the E-UTRAN capability, </condition> <action> the UE shall skip the action for as long as access to RLOS is still needed. </action> </control>
NOTE: How long the UE attempts to access RLOS is up to UE implementation.
<control> Then <condition> <condition> if a) the UE is in the same selected PLMN where the last tracking area updating procedure was attempted and rejected; </condition> <condition> b) the tracking area updating procedure was rejected with an EMM cause value other than #9, #10 and #40; </condition> and <condition> c) timer T3346 is not running, </condition> </condition> <action> the UE shall: a) detach locally, </action> <condition> if not detached already, </condition> <action> perform a PLMN selection according to 3GPP TS 23.122 to attempt EPS attach for access to RLOS via another PLMN. </action> </control>
<control> <condition> If the tracking area updating request for access to RLOS fails due to abnormal case a) in subclause 5.5.3.2.6, </condition> <action> the UE shall perform the actions as described in subclause 5.5.3.2.6 </action> and <action> inform the upper layers of the failure to access the network. </action> </control>
<control> <condition> If the tracking area updating request for access to RLOS fails due to abnormal cases b), c) or d) in subclause 5.5.3.2.6, </condition> <action> the UE shall perform the procedures as described in subclause 5.5.3.2.6 with the exception that the UE shall skip actions that involve attempting to select GERAN or UTRAN radio access technology and actions that involve disabling of the E-UTRA capability, for as long as access to RLOS is still needed. </action> </control> <control> <condition> Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, </condition> <action> the UE shall: a) detach locally, </action> <condition> if not detached already, </condition> <action> > perform a PLMN selection according to 3GPP TS 23.122 to attempt EPS attach for access to RLOS via another PLMN. </action> </control>
5.5.3.2.6 Abnormal cases in the UE
The following abnormal cases can be identified: a) Access barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without "Extended wait time" received from lower layers
<control> <condition> <condition> In WB-S1 mode, </condition> <condition> if the tracking area updating procedure is started in response to a paging request from the network, access class barring, EAB or ACDC is not applicable. </condition> </condition> </control>
<control> <condition> In NB-S1 mode, </condition> <condition> if the tracking area updating procedure is started in response to a paging request from the network, access barring is not applicable. </condition> </control>
<control> <condition> <condition> In WB-S1 mode, </condition> <condition> if access is barred for "originating signalling" (see 3GPP TS 36.331 ), </condition> </condition> <action> the tracking area updating procedure shall not be started. </action> <action> The UE stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> <action> The tracking area updating procedure is started as soon as possible and if still necessary, </action> </control> e.g.
when access for "originating signalling" is granted on the current cell or when the UE moves to a cell where access for "originating signalling" is granted.
<control> <condition> In NB-S1 mode, </condition> <condition> if access is barred for "originating signalling" (see 3GPP TS 36.331 ), </condition> <action> the tracking area updating procedure shall not be started. </action> <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> Further UE behaviour is implementation specific, e.g. the tracking area updating procedure is started again after an implementation dependent time. </control>
<control> <condition> <condition> In NB-S1 mode, </condition> <condition> if access is barred for "originating signalling" (see 3GPP TS 36.331 ), </condition> <condition> a request for an exceptional event is received from the upper layers, </condition> </condition> <action> then the tracking area updating procedure shall be started. </action> </control>
NOTE 1: In NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 ).
<control> <condition> <condition> If access is barred because of access class barring for "originating signalling" (see 3GPP TS 36.331 ) </condition> and <condition> if: a) one of the MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions is satisfied; </condition> </condition> </control> <control> b) <condition> the upper layers request to send a mobile originated SMS over NAS or SMS over S102; </condition> </control> or <control> c) <condition> the upper layers request user plane radio resources, ACDC is applicable to the request and the UE supports ACDC. </condition> </control>
<control> then the tracking area updating procedure shall be started according to subclause 5.5.3.2.2. </control> The call type used shall be per annex D of this document.
NOTE 2: If more than one of MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions are satisfied, it is left to UE implementation to determine the call type based on Annex D of this document.
<control> <condition> <condition> If access is barred for a certain ACDC category (see 3GPP TS 36.331 ), </condition> and <condition> if the upper layers request user plane radio resources for a higher ACDC category </condition> and <condition> the UE supports ACDC, </condition> </condition> <action> then the tracking area updating procedure shall be started according to subclause 5.5.3.2.2. </action> </control>
<control> <condition> <condition> If an access request for an uncategorized application is barred due to ACDC (see 3GPP TS 36.331 ), </condition> and <condition> if the upper layers request user plane radio resources for a certain ACDC category </condition> and <condition> the UE supports ACDC, </condition> </condition> <action> then the tracking area updating procedure shall be started according to subclause 5.5.3.2.2. </action> </control>
<control> <condition> If the trigger for the tracking area updating procedure is the response to a paging request from the network and the NAS signalling connection establishment is rejected by the network, </condition> <action> the tracking area updating procedure shall not be started. </action> <action> The UE stays in the current serving cell and applies normal cell reselection process. </action> </control> <control> <action> The tracking area updating procedure may be started </action> <condition> if it is still necessary when access for "terminating calls" is granted or because of a cell change. </condition> </control>
<control> b) <condition> Lower layer failure or release of the NAS signalling connection without "Extended wait time" and without "Extended wait time CP data" received from lower layers before the TRACKING AREA UPDATE ACCEPT or TRACKING AREA UPDATE REJECT message is received. </condition> </control>
<control> <condition> The tracking area updating procedure shall be aborted, </condition> and the UE shall proceed as described below. </control>
<control> <action> The UE shall abort the procedure and proceed as described below. </action> <action> The NAS signalling connection, if any, shall be released locally. </action> </control>
<control> NOTE 3: <action> The NAS signalling connection can also be released </action> <condition> if the UE deems that the network has failed the authentication check as specified in subclause 5.4.2.7. </condition> </control>
<control> d) <condition> <condition> TRACKING AREA UPDATE REJECT, </condition> <condition> other causes than those treated in subclause 5.5.3.2.5, </condition> and <condition> cases of EMM cause values #22, #25 and #31, if considered as abnormal cases according to subclause 5.5.3.2.5 </condition> </condition> </control>
<control> <condition> <condition> If the tracking area updating request is not for initiating a PDN connection for emergency bearer services, </condition> <condition> upon reception of the EMM causes #95, #96, #97, #99 and #111 </condition> </condition> <action> the UE should set the tracking area updating attempt counter to 5. </action> </control>
The UE shall proceed as described below.
<control> e) <action> Change of cell into a new tracking area </action> </control>
<control> <condition> If a cell change into a new tracking area occurs before the tracking area updating procedure is completed, </condition> <action> the tracking area updating procedure shall be aborted and re-initiated immediately. </action> <action> The UE shall set the EPS update status to EU2 NOT UPDATED. </action> </control>
The UE shall proceed as described below.
<control> f) <condition> Tracking area updating and detach procedure collision </condition> </control>
<control> EPS detach containing detach type "re-attach required" or "re-attach not required": <condition> If the UE receives a DETACH REQUEST message before the tracking area updating procedure has been completed, </condition> <action> the tracking area updating procedure shall be aborted </action> and <action> the detach procedure shall be progressed. </action> </control> <control> <condition> <condition> If the DETACH REQUEST message contains detach type "re-attach not required" </condition> and <condition> EMM cause #2 "IMSI unknown in HSS", </condition> </condition> <action> the UE will follow the procedure as described below for the detach type "IMSI detach". </action> </control>
<control> EPS detach containing detach type "IMSI detach": <condition> If the UE receives a DETACH REQUEST message before the tracking area updating procedure has been completed, </condition> <action> the DETACH REQUEST message shall be ignored </action> and <action> tracking area updating procedure shall be progressed. </action> </control>
The UE shall proceed as described below.
<control> <condition> g) Tracking area updating and GUTI reallocation procedure collision </condition> </control>
<control> <condition> If the UE receives a GUTI REALLOCATION COMMAND message before the tracking area updating procedure has been completed, </condition> <action> this message shall be ignored </action> and <action> the tracking area updating procedure shall be progressed. </action> </control>
<control> h) <condition> Transmission failure of TRACKING AREA UPDATE REQUEST message indication from lower layers </condition> </control>
<control> <action> The tracking area updating procedure shall be aborted and re-initiated immediately. </action> <action> The UE shall set the EPS update status to EU2 NOT UPDATED. </action> </control>
<control> <condition> i) Transmission failure of TRACKING AREA UPDATE COMPLETE message indication with TAI change from lower layers </condition> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> <action> the tracking area updating procedure shall be aborted and re-initiated immediately. </action> <action> The UE shall set the EPS update status to EU2 NOT UPDATED. </action> </control>
<control> <condition> If the current TAI is still part of the TAI list, </condition> it is up to the UE implementation how to re-run the ongoing procedure. </control>
<control> <condition> j) Transmission failure of TRACKING AREA UPDATE COMPLETE message indication without TAI change from lower layers </condition> </control>
It is up to the UE implementation how to re-run the ongoing procedure.
<control> <condition> k) "Extended wait time" from the lower layers </condition> </control>
<control> <condition> If the TRACKING AREA UPDATE REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", </condition> <action> the UE shall start timer T3346 with the "Extended wait time" value </action> and <action> reset the tracking area updating attempt counter. </action> </control>
<control> <condition> <condition> If the TRACKING AREA UPDATE REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority", </condition> <condition> the UE is operating in NB-S1 mode </condition> and <condition> the UE is not a UE configured to use AC11 15 in selected PLMN, </condition> </condition> then <action> the UE shall start timer T3346 with the "Extended wait time" value </action> and <action> reset the tracking area updating attempt counter. </action> </control>
<control> <condition> In other cases </condition> <action> the UE shall ignore the "Extended wait time". </action> </control>
<control> <action> The UE shall abort the tracking area updating procedure, </action> <action> stay in the current serving cell, </action> <action> set the EPS update status to EU2 NOT UPDATED, </action> <end_state> change the state to EMM-REGISTERED. </end_state> and <action> apply the normal cell reselection process. </action> </control>
<control> <condition> If the UE had used eDRX before initiating tracking area updating procedure, </condition> then <action> the UE shall continue to use the eDRX with the extended DRX parameters IE received during the last attach or tracking area updating procedure. </action> </control>
The UE shall proceed as described below.
<control> <condition> ka) "Extended wait time CP data" from the lower layers </condition> </control>
<control> <condition> <condition> If the UE is operating in NB-S1 mode </condition> and <condition> supports the timer T3448, </condition> </condition> <action> the UE shall start the timer T3448 with the "Extended wait time CP data" value. </action> </control> <control> <condition> <condition> If the UE is operating in NB-S1 mode </condition> and <condition> does not support the timer T3448, </condition> </condition> <action> the UE shall start the timer T3346 with the "Extended wait time CP data" value </action> and <action> reset the tracking area updating attempt counter. </action> </control>
<control> <condition> In other cases </condition> <action> the UE shall ignore the "Extended wait time CP data". </action> </control>
<control> <action> The UE shall abort the tracking area updating procedure, </action> <action> stay in the current serving cell, </action> <action> set the EPS update status to EU2 NOT UPDATED, </action> <end_state> change the state to EMM-REGISTERED. </end_state> <action> ATTEMPTING-TO-UPDATE and apply the normal cell reselection process. </action> </control>
<control> <condition> If the UE had used eDRX before initiating tracking area updating procedure, </condition> then <action> the UE shall continue to use the eDRX with the extended DRX parameters IE received during the last attach or tracking area updating procedure. </action> </control>
The UE shall proceed as described below.
<control> l) <condition> Timer T3346 is running </condition> </control>
<control> <action> The UE shall not start the tracking area updating procedure </action> <condition> unless: a) the UE is in EMM-CONNECTED mode; </condition> </control> <control> <condition> b) the UE received a paging; </condition> </control> <control> c) <condition> the UE is a UE configured to use AC11 15 in selected PLMN; </condition> </control> <control> d) <condition> the UE has a PDN connection for emergency bearer services established </condition> or <condition> is establishing a PDN connection for emergency bearer services; </condition> </control> <control> e) <condition> the UE is requested by the upper layer for a CS fallback for emergency call or a 1xCS fallback for emergency call; </condition> </control> <control> f) <condition> the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event </condition> </control> and <control> i) <condition> the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in NASCONFIG 3GPP TS 31.102 ); </condition> </control> and <control> ii) <condition> timer T3346 was not started when NAS signaling connection was established with RRC establishment cause set to "MO exception data"; </condition> </control> or <control> g) <condition> <condition> the UE has a PDN connection established without the NAS signalling low priority indication </condition> or <condition> is establishing a PDN connection without the NAS signalling low priority indication, </condition> <condition> the timer T3402 and the timer T3411 are not running </condition> and <condition> the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority". </condition> </condition> </control>
The UE stays in the current serving cell and applies the normal cell reselection process.
<control> NOTE 4: <action> It is considered an abnormal case </action> <condition> if the UE needs to initiate a tracking area updating procedure while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non successful case. </condition> </control>
<control> <condition> <condition> If the TAI of the current serving cell is not included in the TAI list </condition> or <condition> the TIN indicates "P-TMSI", </condition> </condition> <action> the UE shall set the EPS update status to EU2 NOT UPDATED </action> and <end_state> change to state EMM-REGISTERED.ATTEMPTING- TO-UPDATE. </end_state> </control>
<control> <condition> If the tracking area updating procedure needs to be initiated for an MO MMTEL voice call is started, </condition> then <action> a notification that the procedure was not initiated due to network congestion shall be provided to upper layers. </action> </control>
NOTE 5: This can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP TS 24.173 ).
The UE shall proceed as described below.
<control> <condition> la) Timer T3448 is running </condition> </control>
<control> <action> The UE shall not start the tracking area updating procedure with the "signalling active" flag set, </action> <condition> unless: a) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> </control> <control> b) <condition> the UE which is only using EPS services with control plane CIoT EPS optimization received a paging; </condition> </control> or <control> c) <condition> <condition> the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event </condition> and <condition> the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ). </condition> </condition> </control>
The UE stays in the current serving cell and applies the normal cell reselection process.
The UE shall proceed as described below.
<control> <condition> m) Mobile originated detach required </condition> </control>
<control> <condition> Detach due to removal of USIM or due to switch off: </condition> <action> The tracking area updating procedure shall be aborted, </action> and <action> the UE initiated detach procedure shall be performed. </action> </control>
<control> <condition> Detach not due to removal of USIM and not due to switch off: </condition> <action> The UE initiated detach procedure shall be initiated </action> <condition> after successful completion of the tracking area updating procedure. </condition> </control>
<control> <condition> o) Timer T3447 is running </condition> </control>
<control> <action> The UE shall not start the tracking area updating procedure with the "signalling active" flag set or the "active" flag set, </action> <condition> unless: a) the UE received a paging; </condition> </control> <control> b) <condition> the UE is a UE configured to use AC11 15 in selected PLMN; </condition> </control> <control> c) <condition> the UE has a PDN connection for emergency bearer services established </condition> or <condition> is establishing a PDN connection for emergency bearer services; </condition> </control>
<control> <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> <action> The tracking area update request procedure is started, </action> <condition> if still necessary, when timer T3447 expires. </condition> </control>
<control> p) <condition> Tracking area updating and paging procedure collision </condition> </control>
<control> <condition> If the UE receives a CS SERVICE NOTIFICATION message before the tracking area updating procedure has been completed, </condition> <action> the UE shall progress the tracking area updating procedure </action> and <action> respond to the CS SERVICE NOTIFICATION </action> <condition> upon successful completion of the tracking area updating procedure. </condition> </control>
<control> <condition> For the cases b, c, d, e, f with detach type "re-attach required" or "re-attach not required" with EMM cause other than #2 "IMSI unknown in HSS", k and ka, </condition> <action> the UE shall stop any ongoing transmission of user data. </action> </control>
<control> <condition> <condition> For the cases b, c, d, la k </condition> <condition> when the "Extended wait time" is ignored, </condition> and <condition> ka when the "Extended wait time CP data" is ignored, </condition> <condition> if the tracking area updating request is not for initiating a PDN connection for emergency bearer services, </condition> </condition> <action> the tracking area updating attempt counter shall be incremented, </action> <condition> unless it was already set to 5. </condition> </control>
<control> <condition> <condition> If the tracking area updating attempt counter is less than 5, </condition> <condition> the TAI of the current serving cell is included in the TAI list, </condition> <condition> the EPS update status is equal to EU1 UPDATED, </condition> <condition> the TIN does not indicate "P-TMSI" </condition> and <condition> the tracking area updating procedure is performed not due to an inter-system change from N1 mode to S1 mode </condition> and <condition> the tracking area updating procedure is not performed due to cases g, m, n, za, zc in subclause 5.5.3.2.2: </condition> </condition> <action> the UE shall keep the EPS update status to EU1 UPDATED </action> and <end_state> enter state EMM- REGISTERED.NORMAL-SERVICE. </end_state> <action> The UE shall start timer T3411. </action> </control>
<control> <condition> <condition> If in addition the TRACKING AREA UPDATE REQUEST indicated "periodic updating" </condition> or <condition> if tracking area updating procedure was initiated to recover NAS signalling connection due to "RRC Connection failure" from the lower layers, </condition> <condition> none of the other reasons for initiating the tracking area updating procedure listed in subclause 5.5.3.2.2 was applicable, </condition> <condition> and the TRACKING AREA UPDATE REQUEST message did not include T3324 value IE, T3412 extended value IE or Extended DRX parameters IE, </condition> </condition> <action> the timer T3411 may be stopped when the UE enters EMM-CONNECTED mode. </action> </control>
<control> <condition> If timer T3411 expires </condition> <action> the tracking area updating procedure is triggered again. </action> </control>
<control> <condition> <condition> If the tracking area updating attempt counter is less than 5, </condition> and <condition> the TAI of the current serving cell is not included in the TAI list </condition> or <condition> the EPS update status is different to EU1 UPDATED </condition> or <condition> the TIN indicates "P-TMSI" </condition> or <condition> the tracking area updating procedure is performed due to an inter-system change from N1 mode to S1 mode </condition> or <condition> if the tracking area updating procedure is performed due to cases g, m, n, za, zc in subclause 5.5.3.2.2: </condition> a) <condition> for the cases k and l, </condition> </condition> <action> the tracking area updating procedure is started, </action> <condition> if still necessary, when timer T3346 expires or is stopped. </condition> </control> <control> b) <condition> <condition> for the case ka, </condition> <condition> if timer T3346 is started, </condition> </condition> <action> the tracking area updating procedure is started, </action> <condition> if still necessary, when timer T3346 expires or is stopped. </condition> </control> <control> c) <condition> <condition> for the case ka, </condition> <condition> if timer T3448 is started </condition> and <condition> the "signalling active" flag is set in the TRACKING AREA UPDATE REQUEST message, </condition> </condition> <action> the tracking area updating procedure is started, </action> <condition> if still necessary, when timer T3448 expires or is stopped. </condition> </control> <control> <condition> <condition> a) for the case la, </condition> <condition> if the "signalling active" flag is set in the TRACKING AREA UPDATE REQUEST message, </condition> </condition> <action> the tracking area updating procedure is started, </action> <condition> if still necessary, when timer T3448 expires or is stopped. </condition> </control> <control> b) <condition> <condition> for the cases b, c, d, k </condition> <condition> when the "Extended wait time" is ignored, </condition> and <condition> ka when the "Extended wait time CP data" is ignored, </condition> <condition> if the tracking area updating request is not for initiating a PDN connection for emergency bearer services, </condition> </condition> <action> the UE shall start timer T3411, </action> <action> shall set the EPS update status to EU2 NOT UPDATED </action> and <end_state> change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE. </end_state> <condition> When timer T3411 expires the tracking area updating procedure is triggered again. </condition> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GPRS update status as specified in 3GPP TS 24.008 </action> <condition> <condition> for the abnormal case when a normal or periodic routing area updating procedure fails </condition> and <condition> the routing area updating attempt counter is less than 5 </condition> and <condition> the GPRS update status is different from GU1 UPDATED. </condition> </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GS update status as specified in 3GPP TS 24.501 </action> <condition> <condition> for the abnormal cases when a registration procedure for mobility and periodic registration fails </condition> and <condition> the registration attempt counter is less than 5 </condition> and <condition> the 5GS update status is different from 5U1 UPDATED. </condition> </condition> </control>
<control> <condition> If the tracking area updating attempt counter is equal to 5: </condition> <action> a) the UE shall start timer T3402, </action> <action> shall set the EPS update status to EU2 NOT UPDATED; </action> </control> <control> b) <action> the UE shall delete the list of equivalent PLMNs </action> and <action> shall change to state EMM- REGISTERED.ATTEMPTING-TO-UPDATE or optionally to EMM-REGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122; </action> </control> and <control> c) <condition> <condition> if A/Gb mode, Iu mode or N1 mode is supported by the UE: </condition> d) <condition> if A/Gb mode or Iu mode is supported by the UE, </condition> </condition> <action> the UE shall in addition handle the GPRS update status as specified in 3GPP TS 24.008 </action> <condition> for the abnormal case when a normal or periodic routing area updating procedure fails </condition> and <condition> the routing area updating attempt counter is equal to 5; </condition> </control> <control> e) <condition> if the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GS update status as specified in 3GPP TS 24.501 </action> <condition> for the abnormal case when a registration procedure for mobility or periodic registration update performed over 3GPP access fails </condition> and <condition> the registration attempt counter is equal to 5; </condition> </control> and <control> f) <condition> if the UE does not change to state EMM-REGISTERED.PLMN-SEARCH, </condition> <action> the UE shall attempt to select GERAN. UTRAN or NG-RAN radio access technology. </action> </control>
<control> <condition> If a GERAN or UTRAN cell is selected: </condition> </control> <control> a) <condition> a UE in PS mode 1 or PS mode 2 of operation </condition> <action> shall proceed with appropriate GMM specific procedures; </action> </control> <control> b) <condition> a UE in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> shall proceed with appropriate MM or GMM specific procedures. </action> </control>
<control> <condition> If an NG-RAN cell is selected, </condition> <action> the UE shall proceed with appropriate 5GMM specific procedures. </action> </control>
<control> <action> Additionally, the UE may disable the E-UTRA capability as specified in subclause 4.5. </action> </control>
5.5.3.2.6A Abnormal cases in the UE, SMS services not accepted
<control> The UE shall proceed as follows: 1) <condition> <condition> if the tracking area update was successful for EPS services only </condition> and <condition> the TRACKING AREA UPDATE ACCEPT message contained a value included in the SMS services status IE not treated in subclause 5.5.3.2.4A </condition> or <condition> the SMS services status IE is not included in the message, </condition> </condition> <action> the UE shall proceed as follows: a) The UE shall stop timer T3430 if still running. </action> <action> The tracking area updating attempt counter shall be incremented, </action> <condition> unless it was already set to 5; </condition> </control> <control> b) <condition> If the tracking area updating attempt counter is less than 5: </condition> a) <action> the UE shall start timer T3411, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> </control> <control> <condition> <condition> When timer T3411 expires the normal tracking area updating procedure for EPS services </condition> and <condition> "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered; </condition> </condition> </control> <control> c) <condition> If the tracking area updating attempt counter is equal to 5: </condition> b) <action> the UE shall start timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> </control> <control> <condition> When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered; </condition> </control> and
<control> 2) <condition> otherwise, </condition> <action> the abnormal cases specified in subclause 5.5.3.2.6 apply. </action> </control>
5.5.3.2.7 Abnormal cases on the network side
<control> <action> The following abnormal cases can be identified: </action> <condition> <condition> a) If a lower layer failure occurs before the message TRACKING AREA UPDATE COMPLETE has been received from the UE </condition> and <condition> a GUTI has been assigned, </condition> </condition> <action> the network shall abort the procedure, </action> <end_state> enter EMM-IDLE mode </end_state> and <action> shall consider both, the old and new GUTI as valid </action> <condition> until the old GUTI can be considered as invalid by the network (see subclause 5.4.1.4). </condition> </control> <control> <action> During this period the network may use the identification procedure followed by a GUTI reallocation procedure </action> <condition> if the old GUTI is used by the UE in a subsequent message. </condition> </control>
<control> <action> The network may page with IMSI </action> <condition> if paging with old and new S-TMSI fails. </condition> </control> Paging with IMSI causes the UE to re-attach as described in subclause 5.6.2.2.2.
b) Protocol error
<control> <condition> If the TRACKING AREA UPDATE REQUEST message has been received with a protocol error, </condition> <action> the network shall return a TRACKING AREA UPDATE REJECT message with one of the following EMM cause values: #96: invalid mandatory information element error; #99: information element non-existent or not implemented; #100: conditional IE error; </action> </control> or <control> <condition> On the first expiry of the timer, </condition> <action> the network shall retransmit the TRACKING AREA UPDATE ACCEPT message </action> and <action> shall reset and restart timer T3450. </action> </control> <control> The retransmission is performed four times, i.e. <condition> on the fifth expiry of timer T3450, </condition> <action> the tracking area updating procedure is aborted. </action> <action> Both, the old and the new GUTI shall be considered as valid </action> <condition> until the old GUTI can be considered as invalid by the network (see subclause 5.4.1.4). </condition> </control>
During this period the network acts as described for case a above.
<control> d) <condition> <condition> TRACKING AREA UPDATE REQUEST received after the TRACKING AREA UPDATE ACCEPT message has been sent </condition> and <condition> before the TRACKING AREA UPDATE COMPLETE message is received </condition> </condition> </control> <control> a) <condition> If one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differ from the ones received within the previous TRACKING AREA UPDATE REQUEST message, </condition> <action> the previously initiated tracking area updating procedure shall be aborted </action> <condition> if the TRACKING AREA UPDATE COMPLETE message has not been received </condition> and <action> the new tracking area updating procedure shall be progressed; </action> </control> or <control> b) <condition> if the information elements do not differ, </condition> then <action> the TRACKING AREA UPDATE ACCEPT message shall be resent </action> and <action> the timer T3450 shall be restarted </action> <condition> if an TRACKING AREA UPDATE COMPLETE message is expected. </condition> </control> <control> <condition> In that case, </condition> <action> the retransmission counter related to T3450 is not incremented. </action> </control>
<control> e) <condition> <condition> More than one TRACKING AREA UPDATE REQUEST received </condition> and <condition> no TRACKING AREA UPDATE ACCEPT or TRACKING AREA UPDATE REJECT message has been sent </condition> </condition> </control> <control> a) <condition> If one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differs from the ones received within the previous TRACKING AREA UPDATE REQUEST message, </condition> <action> the previously initiated tracking area updating procedure shall be aborted </action> and <action> the new tracking area updating procedure shall be progressed; </action> </control> <control> b) <condition> if the information elements do not differ, </condition> then <action> the network shall continue with the previous tracking area updating procedure </action> and <action> shall not treat any further this TRACKING AREA UPDATE REQUEST message. </action> </control>
f) Lower layers indication of non-delivered NAS PDU due to handover
<control> <condition> <condition> If the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message could not be delivered due to an intra MME handover </condition> and <condition> the TAI of the target cell and the TAI of the source cell are the same, </condition> then <condition> upon successful completion of the intra MME handover </condition> </condition> <action> the MME shall retransmit the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message. </action> </control> <control> <condition> <condition> If a failure of the handover procedure is reported by the lower layer </condition> and <condition> the S1 signalling connection exists, </condition> </condition> <action> the MME shall retransmit the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message. </action> </control>
<control> g) <condition> <condition> DETACH REQUEST message received before the TRACKING AREA UPDATE ACCEPT message is sent </condition> or <condition> before the TRACKING AREA UPDATE COMPLETE message (in case of GUTI and/or TMSI was allocated) is received. </condition> </condition> </control>
<control> <condition> Detach containing cause "switch off": </condition> <action> The network shall abort the signalling for the tracking area updating procedure towards the UE </action> and <action> shall progress the detach procedure as described in subclause 5.5.2.2. </action> </control>
<control> NOTE: <condition> Internally in the network, before processing the detach request, </condition> <action> the MME can perform the necessary signalling procedures for the tracking area updating procedure before progressing the detach procedure. </action> </control>
<control> <condition> Detach containing other causes than "switch off": </condition> <action> The network shall proceed with the tracking area updating procedure </action> and <action> shall progress the detach procedure after successful completion of the tracking area updating procedure. </action> </control>
<control> h) <condition> If the TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating "periodic updating" is received by the new MME which does not have the EMM context data related to the subscription, </condition> <action> the new MME may send the TRACKING AREA UPDATE REJECT message with EMM cause value #10 "Implicitly detached" </action> </control>
5.5.3.3 Combined tracking area updating procedure
5.5.3.3.1 General
Within a combined tracking area updating procedure the messages TRACKING AREA UPDATE ACCEPT and TRACKING AREA UPDATE COMPLETE carry information for the tracking area updating and the location area updating.
The combined tracking area updating procedure follows the normal tracking area updating procedure described in subclause 5.5.3.2 with exception of subclause 5.5.3.2.4A and subclause 5.5.3.2.6A.
5.5.3.3.2 Combined tracking area updating procedure initiation
<control> <condition> The UE operating in CS/PS mode 1 or CS/PS mode 2, </condition> <condition> in state EMM-REGISTERED, </condition> <action> shall initiate the combined tracking area updating procedure: </action> </control> <control> a) <condition> <condition> when the UE that is attached for both EPS and non-EPS services detects entering a tracking area that is not in the list of tracking areas that the UE previously registered in the MME, </condition> <condition> unless the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 or 3GPP TS 31.102 </condition> and <condition> is entering a tracking area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs; </condition> </condition> </control> <control> b) <condition> <condition> when the UE that is attached for EPS services wants to perform an attach for non-EPS services. </condition> <condition> In this case </condition> </condition> <action> the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach"; </action> </control> <control> c) <condition> <condition> when the UE performs an intersystem change from A/Gb mode to S1 mode </condition> and <condition> the EPS services were previously suspended in A/Gb mode; </condition> </condition> </control> <control> d) <condition> <condition> when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, </condition> and <condition> the UE previously either performed a combined GPRS attach procedure, an IMSI attach procedure, a location area updating procedure or a combined routing area updating procedure, in A/Gb or Iu mode, </condition> or <condition> moved to A/Gb or Iu mode from S1 mode through an SRVCC handover </condition> or <condition> moved to Iu mode from S1 mode through an vSRVCC handover. </condition> </condition> <action> In this case the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach"; </action> </control> <control> e) <condition> <condition> when the UE enters EMM-REGISTERED.NORMAL-SERVICE </condition> and <condition> the UE's TIN indicates "P-TMSI"; </condition> </condition> </control> <control> f) <condition> when the UE receives an indication from the lower layers that the RRC connection was released with cause "load balancing TAU required"; </condition> </control> <control> g) <condition> when the UE deactivated EPS bearer context(s) locally while in EMM-REGISTERED, because it was not able or not allowed to establish a NAS signalling connection, </condition> and <action> then returns to EMM-REGISTERED.NORMAL- SERVICE and no EXTENDED SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or DETACH REQUEST message is pending to be sent by the UE; </action> </control> <control> h) <condition> when the UE changes the UE network capability information or the MS network capability information or both; </condition> </control> <control> i) <condition> when the UE changes the UE specific DRX parameter; </condition> </control> <control> j) <condition> <condition> when the UE receives an indication of "RRC Connection failure" from the lower layers </condition> and <condition> has no signalling or user uplink data pending (i.e when the lower layer requests NAS signalling connection recovery); </condition> </condition> </control> <control> k) <condition> <condition> when due to manual CSG selection the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list </condition> or <condition> in the UE's Operator CSG list; </condition> </condition> </control> <control> l) <condition> when the UE reselects an E-UTRAN cell while it was in GPRS READY state or PMM-CONNECTED mode; </condition> </control> <control> m) <condition> <condition> when the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN, </condition> <condition> and changes the mobile station classmark 2 or the supported codecs, </condition> or <condition> the UE supports SRVCC to GERAN and changes the mobile station classmark 3; </condition> </condition> </control> <control> n) <condition> when the UE changes the radio capability for GERAN or cdma2000 or both; </condition> </control> <control> o) <condition> when the UE's usage setting or the voice domain preference for E-UTRAN change in the UE; </condition> </control> <control> p) <condition> <condition> when the UE activates mobility management for IMS voice termination as specified in 3GPP TS 24.008, annex P.2, </condition> and <condition> the TIN indicates "RAT-related TMSI"; </condition> </condition> </control> <control> q) <condition> <condition> when the UE performs an intersystem change from A/Gb mode to S1 mode </condition> and <condition> the TIN indicates "RAT-related TMSI", </condition> <condition> but the UE is required to perform tracking area updating for IMS voice termination as specified in 3GPP TS 24.008 , annex P.4; </condition> </condition> </control> <control> r) <condition> <condition> upon reception of a paging indication, </condition> <condition> if the UE is in state EMM-REGISTERED.ATTEM PTING-TO-UPDATE </condition> and <condition> the paging indication uses S-TMSI or it uses IMSI with domain indicator set to CS ; </condition> </condition> </control> <control> s) <condition> when the UE needs to update the network with EPS bearer context status due to local de-activation of EPS bearer context(s) as specified in subclause 6.5.1.4A; </condition> </control> <control> t) <condition> <condition> when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, </condition> and <condition> the UE has previously performed the MM connection establishment for CS fallback emergency calls (see 3GPP TS 24.008 , subclause 4.5.1.5a) without performing a location area updating procedure or combined routing area updating procedure while camping on a location area which is different from the stored location area. </condition> </condition> <action> In this case, the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach"; </action> </control> <control> u) <condition> <condition> when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, </condition> and <condition> the MM update status is U2 NOT UPDATED. </condition> </condition> <action> In this case the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach"; </action> </control> <control> v) <condition> when the UE needs to request the use of PSM or needs to stop the use of PSM; </condition> </control> <control> w) <condition> when the UE needs to request the use of eDRX or needs to stop the use of eDRX; </condition> </control> <control> x) <condition> when a change in the eDRX usage conditions at the UE requires different extended DRX parameters; </condition> </control> <control> y) <condition> when a change in the PSM usage conditions at the UE requires a different timer T3412 value or different timer T3324 value; </condition> </control> NOTE 1: A change in the PSM or eDRX usage conditions at the UE can include e.g. a change in the UE configuration, a change in requirements from upper layers or the battery running low at the UE.
<control> z) <condition> when the CIoT EPS optimizations the UE needs to use, </condition> <action> change in the UE; </action> </control> <control> za) <condition> <condition> when the Default_DCN_ID value changes, </condition> as specified in 3GPP TS 24.368 or <condition> in USIM file NAS as CONFIG specified in 3GPP TS 31.102 ; </condition> </condition> NOTE 2: <action> The tracking area updating procedure is initiated after deleting the DCN-ID list as specified in annex C. </action> </control>
<control> zb) <condition> when the UE performs inter-system change from N1 mode to S1 mode in EMM-IDLE mode, </condition> <action> the UE operates in single-registration mode, and conditions specified in 3GPP TS 24.501 apply; </action> </control> <control> zc) <condition> when the UE in EMM-IDLE mode changes the radio capability for E-UTRAN; </condition> </control> <control> zd) <condition> when the UE performs inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode; </condition> </control> <control> ze) <condition> when the UE in EMM-IDLE mode changes the radio capability for NG-RAN; </condition> </control> <control> zf) <condition> <condition> in WB-S1 mode, </condition> <condition> when the applicable UE radio capability ID for the current UE radio configuration changes due to a reselection to a new PLMN </condition> or <condition> a revocation of the network-assigned UE radio capability IDs by the serving PLMN; </condition> </condition> </control> or <control> zg) <condition> when the UE needs to use the WUS assistance, </condition> <action> stop to use the WUS assistance, </action> or <action> change the conditions for using the WUS assistance. </action> </control>
<control> <condition> <condition> For case c, </condition> <condition> if the TIN indicates "RAT-related TMSI" </condition> and <condition> the EPS services were not resumed before returning to S1 mode, </condition> </condition> <action> the UE shall set the TIN to "P-TMSI" before initiating the combined tracking area updating procedure. </action> </control>
<control> <condition> For cases n, zc, ze and zf, </condition> <action> the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> If the UE is in the EMM-CONNECTED mode </condition> and <condition> the UE changes the radio capability for E-UTRAN or for NG-RAN, </condition> </condition> <action> the UE may locally release the established NAS signalling connection </action> and <end_state> enter the EMM-IDLE mode. </end_state> Then, <action> the UE shall initiate the combined tracking area updating procedure including a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> For case l, </condition> <condition> if the TIN indicates "RAT-related TMSI", </condition> <action> the UE shall set the TIN to "P-TMSI" before initiating the combined tracking area updating procedure. </action> </control>
<control> <condition> For case r, </condition> <action> the "active" flag in the EPS update type IE shall be set to 1. </action> </control> <control> <condition> If the paging is received for CS fallback, </condition> <action> the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection </action> <condition> after the completion of the tracking area updating procedure. </condition> </control>
<control> <action> To initiate a combined tracking area updating procedure the UE sends the message TRACKING AREA UPDATE REQUEST to the network, </action> <action> starts timer T3430 and changes to state EMM-TRACKING-AREA-UPDATING- INITIATED. </action> <action> The value of the EPS update type IE in the message shall indicate "combined TA/LA updating" unless explicitly specified otherwise. </action> </control>
<control> <condition> If the UE initiates the combined tracking area updating procedure for EPS services and "SMS only", </condition> <action> the UE shall indicate "SMS only" in the additional update type IE. </action> </control>
<control> <action> The UE shall include the TMSI status IE </action> <condition> if no valid TMSI is available. </condition> </control> <control> Furthermore, <condition> if the UE has stored a valid location area identification, </condition> <action> the UE shall include it in the Old location area identification IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> If the UE has stored a valid TMSI, </condition> <action> the UE shall include the TMSI based NRI container IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <action> The UE shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message: </action> <condition> a) for the case g; </condition> </control> <control> <condition> b) for the case s; </condition> </control> <control> <condition> c) for the case zb; </condition> </control> <control> d) <condition> if the UE has established PDN connection(s) of "non IP" or Ethernet PDN type; </condition> </control> and <control> e) <condition> if the UE: 1) locally deactivated at least one dedicated EPS bearer context upon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode; </condition> </control>
<control> 2) <action> locally deactivated at least one dedicated EPS bearer context </action> <condition> upon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see subclause 6.4.2.1); </condition> </control> or <control> 3) <action> locally deactivated at least one default EPS bearer context </action> <condition> upon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see subclause 6.5.0). </condition> </control>
<control> <condition> <condition> In WB-S1 mode, </condition> <condition> if the UE supports RACS </condition> </condition> <action> the UE shall set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> For cases n, zc and ze, </condition> <condition> in WB-S1 mode, </condition> <condition> if the UE supports RACS </condition> and <condition> the UE has an applicable UE radio capability ID for the new UE radio configuration in the selected PLMN, </condition> </condition> <action> the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> For all cases except cases n, zc and ze, </condition> <condition> in WB-S1 mode, </condition> <condition> if the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, </condition> <action> the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message. </action> </control>
5.5.3.3.3 EMM common procedure initiation
<control> <condition> During the combined tracking area updating procedure, </condition> <action> the MME may initiate EMM common procedures, e.g. the EMM authentication and security mode control procedures. </action> For restrictions applicable after handover or inter-system handover to S1 mode see subclause 5.5.3.2.3. </control>
5.5.3.3.4 Combined tracking area updating procedure accepted by the network
5.5.3.3.4.1 General
<control> <condition> Depending on the value of the EPS update result IE received in the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the following different cases can be distinguished: </action> </control> <control> 1) <condition> <condition> The EPS update result IE value indicates "combined TA/LA updated": Tracking and location area updating is successful for EPS and non-EPS services, </condition> or <condition> for EPS services and "SMS only"; </condition> </condition> </control>
<control> 2) <condition> <condition> The EPS update result IE value indicates "TA updated": Tracking area updating is successful, </condition> <condition> but location area updating for non-EPS services or "SMS only" is not successful. </condition> </condition> </control>
<control> <action> A TRACKING AREA UPDATE COMPLETE message shall be returned to the network </action> <condition> if the TRACKING AREA UPDATE ACCEPT message contains a GUTI or a TMSI or both. </condition> </control>
5.5.3.3.4.2 Combined tracking area updating successful
The description for normal tracking area update as specified in subclause 5.5.3.2.4 shall be followed. In addition, the following description for location area updating applies.
<control> The TMSI reallocation may be part of the combined tracking area updating procedure. <action> The TMSI allocated is then included in the TRACKING AREA UPDATE ACCEPT message together with the location area identification (LAI). </action> <condition> In this case </condition> <end_state> the MME shall change to state EMM-COMMON-PROCEDURE-INITIATED </end_state> and <action> shall start the timer T3450 as described in subclause 5.4.1. </action> </control> <control> <action> The LAI may be included in the TRACKING AREA UPDATE ACCEPT message without TMSI. </action> <condition> If the MME does not indicate "SMS only" in the TRACKING AREA UPDATE ACCEPT message, </condition> <action> subject to operator policies the MME should allocate a TAI list that does not span more than one location area. </action> </control>
<control> <condition> For a shared network in CS domain, </condition> <action> the MME indicates the selected PLMN for CS domain in the LAI to the UE as specified in 3GPP TS 23.272. </action> </control>
<control> <condition> The UE, receiving a TRACKING AREA UPDATE ACCEPT message, </condition> <action> stores the received location area identification, </action> <action> resets the location update attempt counter, </action> <action> sets the update status to U1 UPDATED </action> and <end_state> enters MM state MM IDLE. </end_state> </control>
<control> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events (see subclause 5.3.7b), </condition> <action> then the UE shall reset this counter. </action> </control>
<control> <condition> If the LAI contained in the TRACKING AREA UPDATE ACCEPT message is a member of the list of "forbidden location areas for regional provision of service" </condition> or <condition> the list of "forbidden location areas for roaming" </condition> <action> then such entry shall be deleted. </action> </control>
<control> <condition> If the PLMN identity for the CS domain which is provided as part of the LAI contained in the TRACKING AREA UPDATE ACCEPT message differs from the PLMN identity provided as part of the GUTI, </condition> <action> the MME shall include the PLMN identity for the CS domain in the list of equivalent PLMNs in the TRACKING AREA UPDATE ACCEPT message. </action> </control>
<control> <condition> If the UE requested "SMS only" in the Additional update type IE, </condition> or <condition> if the UE requested a combined tracking area updating for EPS and non-EPS services, </condition> <condition> but the network decides to accept the tracking area update request for EPS services and "SMS only", </condition> <action> the network shall indicate "SMS only" in the Additional update result IE. </action> </control> <control> <condition> In addition, if the SMS services are provided via SMS in MME, </condition> <action> the network shall, in the TRACKING AREA UPDATE ACCEPT message, provide a non-broadcast LAI and may indicate in the EPS update result IE that ISR is activated. </action> </control> <control> <condition> If a TMSI has to be allocated, </condition> <action> then the network shall also provide a TMSI which cannot cause any ambiguity with assigned TMSI values. </action> </control>
<control> <condition> If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "SMS only", </condition> <action> a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" shall not attempt to use CS fallback for mobile originating services. </action> </control>
<control> <condition> <condition> As an implementation option, if the TRACKING AREA UPDATE ACCEPT message does not include the Additional update result IE with value "SMS only" </condition> and <condition> the UE is not configured for NAS signaling low priority </condition> </condition> <action> then the UE may stop timer T3246 if running. </action> </control>
<control> <condition> If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "CS Fallback not preferred", </condition> this indicates to a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" that it is attached for EPS and non-EPS services and that it can use CS fallback. </control>
How to handle the old TMSI stored in the UE depends on the mobile identity included in the TRACKING AREA UPDATE ACCEPT message. <control> a) <condition> If the TRACKING AREA UPDATE ACCEPT message contains an IMSI, </condition> <action> > the UE is not allocated any TMSI, </action> and <action> shall delete any old TMSI accordingly. </action> </control> <control> b) <condition> If the TRACKING AREA UPDATE ACCEPT message contains a TMSI, </condition> <action> the UE shall use this TMSI as new temporary identity. </action> <action> The UE shall delete its old TMSI </action> and <action> shall store the new TMSI. </action> </control> <control> <condition> In this case, </condition> <action> a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI. </action> </control> <control> c) <condition> If neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, </condition> <action> the old TMSI, if any is available, shall be kept. </action> </control>
NOTE 1: It is possible for UEs compliant with earlier versions of this specification to send a TRACKING AREA UPDATE COMPLETE message even if TMSI reallocation is not part of the combined tracking area updating procedure.
<control> <condition> If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "SMS only" or "CS Fallback not preferred", </condition> <action> a UE operating in CS/PS mode 1 with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology </action> and <action> disable the E-UTRA capability (see subclause 4.5). </action> </control>
<control> <condition> The network receiving a TRACKING AREA UPDATE COMPLETE message </condition> <action> stops timer T3450, </action> <action> changes to state EMM-REGISTERED. </action> </control>
<control> NOTE 2: <condition> <condition> Upon receiving a TRACKING AREA UPDATE COMPLETE message, </condition> <condition> if a new TMSI was included in the TRACKING AREA UPDATE ACCEPT message, </condition> </condition> <action> the MME sends an SGsAP-TMSI- REALLOCATION-COMPLETE message as specified in 3GPP TS 29.118. </action> </control>
<control> <condition> Unless the MME supporting N26 is in a deployment where it, </condition> <condition> after intersystem change from N1 mode to S1 mode, </condition> <action> has an IMEI or an IMEISV for the UE, </action> </control> <control> <condition> then after the UE performs intersystem change from N1 mode to S1 mode, </condition> <condition> if: a) the network supports SRVCC for IMS emergency sessions (see 3GPP TS 23.216 ); </condition> </control> <control> b) <condition> the UE has an emergency PDN connection; </condition> </control> <control> c) <condition> the UE has set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported; </condition> </control> and <control> d) <condition> the MME has neither an IMEI nor an IMEISV for the UE; </condition> </control> <control> NOTE 3: <action> The AMF can receive an IMEI from the UE </action> and <action> pass it to the MME during the intersystem change </action> <condition> <condition> if the UE is emergency registered </condition> and <condition> the UE doesn't have a valid USIM or the UE's IMSI remains unauthenticated. </condition> </condition> </control> <control> <action> then the MME shall initiate the identification procedure (see subclause 5.4.4) </action> or <action> the security mode control procedure (see subclause 5.4.3) with the UE. </action> </control>
5.5.3.3.4.3 Combined tracking area updating successful for EPS services only
Apart from the actions on the tracking area updating attempt counter, the description for tracking area for EPS services as specified in subclause 5.5.3.2.4 shall be followed. In addition, the following description for location updating for non-EPS services applies.
<control> <condition> <condition> If, due to emergency services fallback (see 3GPP TS 23.502 , subclause 4.13.4), </condition> <condition> there is a request for emergency services pending </condition> and <condition> the emergency bearer services indicator in the EPS network feature support IE indicates "emergency bearer services in S1 mode not supported", </condition> </condition> <action> then the UE shall skip the requirements defined below in the present subclause for the receipt of a TRACKING AREA UPDATE ACCEPT message including an EMM cause value, </action> <action> attempt to select GERAN or UTRAN radio access technology, </action> <action> select a setup message as defined in subclause 5.3.7, </action> <action> proceed with appropriate MM specific procedures, </action> and <action> send the setup message. </action> </control>
<control> <condition> <condition> The UE receiving the TRACKING AREA UPDATE ACCEPT message </condition> <condition> takes one of the following actions depending on the EMM cause value: #2 (IMSI unknown in HSS) </condition> </condition> <action> The UE shall stop T3430 if still running </action> and <action> shall reset the tracking area updating attempt counter. </action> <action> The UE shall set the update status to U3 ROAMING NOT ALLOWED </action> and <action> shall delete any TMSI, LAI and ciphering key sequence number. </action> <end_state> The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. </end_state> The new MM state is MM IDLE. <action> The USIM shall be considered as invalid for non-EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described subclause 5.3.7a. </condition> </condition> </control> <control> <condition> If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control>
<control> <condition> If, due to emergency services fallback (see 3GPP TS 23.502 ), </condition> <condition> there is a request for CS fallback call pending (see subclause 5.3.7), </condition> <condition> the UE shall attempt to select GERAN or UTRAN radio access technology </condition> and <action> attempt emergency call setup. </action> </control>
<control> <action> The UE shall stop timer T3430 if still running, </action> and <action> shall enter state MM IDLE. </action> <action> The tracking area updating attempt counter shall be incremented, </action> <condition> unless it was already set to 5. </condition> </control>
<control> <condition> If the tracking area updating attempt counter is less than 5: </condition> <action> a) the UE shall start timer T3411, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. </end_state> </control> <control> <condition> When timer T3411 expires </condition> <action> the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again. </action> </control>
<control> <condition> If the tracking area updating attempt counter is equal to 5: </condition> <condition> a) a UE operating in CS/PS mode 2 of operation </condition> and <condition> a UE operating in CS/PS mode 1 of operation with "IMS voice available" </condition> <action> shall start timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED. </end_state> </control> <control> <condition> When timer T3402 expires </condition> <action> the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again; </action> </control> <control> b) <condition> a UE operating in CS/PS mode 1 of operation with "IMS voice not available" without a persistent EPS bearer context </condition> <action> shall attempt to select GERAN or UTRAN radio access technology </action> and <action> proceed with appropriate MM or GMM specific procedures </action> and <action> disable the E-UTRA capability (see subclause 4.5); </action> </control> <control> c) <condition> a UE operating in CS/PS mode 1 of operation with "IMS voice not available" and with a persistent EPS bearer context </condition> <action> shall start timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. </end_state> </control> <control> <condition> When timer T3402 expires </condition> <action> the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again. </action> </control> <control> <condition> <condition> When the radio bearer associated with the persistent EPS bearer context has been released </condition> and <condition> the UE is registered for EPS services only, </condition> <condition> operating in CS/PS mode 1 of operation with "IMS voice not available", </condition> </condition> <action> then the UE shall stop timer T3402, if already running, </action> <action> attempt to select GERAN or UTRAN radio access technology </action> and <action> proceed with appropriate MM or GMM specific procedures </action> and <action> disable the E-UTRA capability (see subclause 4.5). </action> </control>
<control> <action> The UE shall stop timer T3430 if still running, </action> <action> shall reset the tracking area updating attempt counter, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <action> shall enter state EMM-REGISTERED.NORMAL-SERVICE. </action> </control>
<control> <end_state> The UE shall enter state MM IDLE </end_state> and <action> shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <condition> A UE in CS/PS mode 1 of operation with "IMS voice not available" without a persistent EPS bearer context </condition> <action> shall attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the registered PLMN or equivalent PLMN </action> and <action> disable the E-UTRA capability (see subclause 4.5). </action> </control>
<control> <condition> A UE in CS/PS mode 1 of operation with "IMS voice not available" and with a persistent EPS bearer context </condition> shall, <condition> after the radio bearer associated with the persistent EPS bearer context has been released, </condition> <action> attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the registered PLMN or equivalent PLMN </action> and <action> disable the E-UTRA capability (see subclause 4.5). </action> </control>
<control> <condition> <condition> A UE in CS/PS mode 2 of operation </condition> and <condition> a UE operating in CS/PS mode 1 of operation with "IMS voice available" </condition> </condition> <action> may provide a notification to the user or the upper layers that the CS domain is not available. </action> </control>
<control> <action> The UE shall not attempt combined attach or combined tracking area updating procedure with current PLMN </action> <condition> until <condition> switching off the UE </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control>
<control> <action> The UE shall stop timer T3430 if still running. </action> <action> The tracking area updating attempt counter shall be set to 5. </action> </control>
<control> <action> The UE shall start timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED, </action> <end_state> shall enter state EMM- REGISTERED.ATTEMPTING-TO-UPDATE-MM, </end_state> <action> shall enter state MM IDLE. </action> </control>
Other EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined tracking area updating procedure shall be considered as failed for non-EPS services. The behaviour of the UE in those cases is specified in subclause 5.5.3.3.6.
5.5.3.3.5 Combined tracking area updating procedure not accepted by the network
<control> <condition> If the combined tracking area updating cannot be accepted by the network, </condition> <action> the MME shall send a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value. </action> </control>
<control> <condition> <condition> If the MME locally deactivates EPS bearer contexts for the UE (see subclause 5.5.3.2.4) </condition> and <condition> no active EPS bearer contexts remain for the UE, </condition> </condition> <action> the MME shall send the TRACKING AREA UPDATE REJECT message including the EMM cause value #10 "implicitly detached". </action> </control>
<control> <condition> If the tracking area update request is rejected due to general NAS level mobility management congestion control, </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> assign a back-off timer T3346. </action> </control>
<control> <condition> <condition> If the UE initiated the tracking area updating procedure due to inter-system change from N1 mode to S1 mode, </condition> and <condition> the MME does not support N26 interface, </condition> </condition> <action> the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 "UE identity cannot be derived by the network". </action> </control>
<control> <condition> If the tracking area request is rejected due to service gap control as specified in subclause 5.3.17 i.e. the T3447 timer is running, </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> may assign a back-off timer T3346 with the remaining time of the running T3447 timer. </action> </control>
<control> Based on operator policy, <condition> if the tracking area update request is rejected due to core network redirection for CIoT optimizations, </condition> <action> the network shall set the EMM cause value to #31 "Redirection to 5GCN required". </action> </control>
NOTE 1: The network can take into account the UEs N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 "Redirection to 5GCN required".
<control> <condition> <condition> Upon receiving the TRACKING AREA UPDATE REJECT message, </condition> <condition> <condition> if the message is integrity protected </condition> or <condition> contains a reject cause other than EMM cause value #25, </condition> </condition> </condition> <action> the UE shall stop timer T3430, </action> <action> stop any transmission of user data </action> and <action> enter state MM IDLE. </action> </control>
<control> <condition> If the TRACKING AREA UPDATE REJECT message with EMM cause #25 was received without integrity protection, </condition> <action> then the UE shall discard the message. </action> </control>
The UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI List and eKSI. </action> </control>
<control> <action> The UE shall consider the USIM as invalid for EPS and non-EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in subclause 5.3.7a. </condition> </condition> </control> <control> <action> Additionally, the UE shall delete the list of equivalent PLMNs </action> and <end_state> shall enter the state EMM-DEREGISTERED.NO-IMSI. </end_state> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> then <action> the UE shall set this counter to UE implementation-specific maximum value. </action> </control> <control> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> then <action> the UE shall set this counter to UE implementation-specific maximum value. </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> For the EMM cause value #3 or #6, </condition> <condition> if the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> <condition> For the EMM cause value #8, </condition> <condition> if the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.#7 (EPS services not allowed); </action> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI List and eKSI. </action> <action> The UE shall consider then USIM as invalid for EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires as described in subclause 5.3.7a. </condition> </condition> </control> <control> <end_state> The UE shall enter the state EMM- DEREGISTERED. </end_state> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> </condition> then <action> the UE shall set this counter to UE implementation-specific maximum value. </action> </control>
A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.
<control> <condition> A UE in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> shall set the update status to U2 NOT UPDATED, </action> <action> shall attempt to select GERAN or UTRAN radio access technology </action> and <action> proceed with appropriate MM specific procedure according to the MM service state. </action> <action> The UE shall not reselect E-UTRAN radio access technology </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure performed over 3GPP access </condition> and <condition> for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #9 (UE identity cannot be derived by the network); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI List and eKSI. </action> <end_state> The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. </end_state> </control>
<control> <condition> If there is a CS fallback emergency call pending </condition> or <condition> CS fallback call pending, </condition> or <condition> a paging for CS fallback, </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> </control> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures; </action> </control> <control> <condition> <condition> otherwise, </condition> <condition> if there is a CS fallback emergency call </condition> or <condition> CS fallback call pending, </condition> </condition> <action> the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer. </action> </control>
<control> <condition> If there is a 1xCS fallback emergency call pending </condition> or <condition> 1xCS fallback call pending, </condition> or <condition> a paging for 1xCS fallback, </condition> <action> the UE shall select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 </action> </control>
<control> <condition> If there is a 1xCS fallback emergency call pending </condition> or <condition> 1xCS fallback call pending, </condition> or <condition> a paging for 1xCS fallback, </condition> and <condition> <condition> the UE has dual Rx/Tx configuration </condition> and <condition> supports enhanced 1xCS fallback, </condition> </condition> <action> the UE shall perform a new attach procedure. </action> </control>
<control> <condition> <condition> If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback </condition> and <condition> the rejected request was not for initiating a PDN connection for emergency bearer services, </condition> </condition> <action> the UE shall subsequently, automatically initiate the attach procedure. </action> </control>
NOTE 2: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.
<control> <condition> A UE in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <condition> If the UE is operating in the single-registration mode, </condition> <action> the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
A UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.
<control> <end_state> The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. </end_state> <action> The UE shall delete any mapped EPS security context or partial native EPS security context. </action> </control>
<control> <condition> If there is a CS fallback emergency call pending </condition> or <condition> CS fallback call pending, </condition> or <condition> a paging for CS fallback, </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> </control> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures; </action> </control> <control> <condition> <condition> otherwise, </condition> <condition> if there is a CS fallback emergency call or CS fallback call pending, </condition> </condition> <action> the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer. </action> </control>
<control> <condition> If there is a 1xCS fallback emergency call pending </condition> or <condition> 1xCS fallback call pending, </condition> or <condition> a paging for 1xCS fallback, </condition> <action> the UE shall select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 </action> </control>
<control> <condition> If there is a 1xCS fallback emergency call pending </condition> or <condition> 1xCS fallback call pending, </condition> or <condition> a paging for 1xCS fallback, </condition> and <condition> the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, </condition> <action> the UE shall perform a new attach procedure. </action> </control>
<control> <condition> If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback </condition> and <condition> the rejected request was not for initiating a PDN connection for emergency bearer services, </condition> <action> the UE shall then perform a new attach procedure. </action> </control>
NOTE 3: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM state as specified in 3GPP TS 24.008 </action> <condition> for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM state as specified in 3GPP TS 24.501 </action> <condition> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #11 (PLMN not allowed); </condition> or <condition> #35 (Requested service option not authorized in this PLMN); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI List and eKSI, </action> and <action> reset the tracking area updating attempt counter. </action> <action> The UE shall delete the list of equivalent PLMNs </action> and <end_state> enter the state EMM-DEREGISTERED.PLMN-SEARCH. </end_state> </control>
<control> <action> The UE shall store the PLMN identity in the "forbidden PLMN list" </action> and <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> then <action> the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a PLMN-specific attempt counter for that PLMN, </condition> </condition> then <action> the UE shall set this counter to the UE implementation-specific maximum value. </action> </control>
<control> <action> The UE shall then perform a PLMN selection according to 3GPP TS 23.122. </action> </control>
<control> <condition> For the EMM cause value #11, </condition> <condition> if the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> <condition> For the EMM cause value #35, </condition> <condition> if the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI List and eKSI. </action> <action> The UE shall reset the tracking area updating attempt counter </action> and <end_state> shall enter the state EMM-DEREGISTERED.LIMITED- SERVICE. </end_state> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". </action> <condition> If the TRACKING AREA UPDATE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> #13 (Roaming not allowed in this tracking area); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete the list of equivalent PLMNs. </action> <action> The UE shall reset the tracking area updating attempt counter </action> and <action> shall change to state EMM-REGISTERED.PLMN-SEARCH. </action> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" </action> and <action> shall remove the current TAI from the stored TAI list if present. </action> </control> <control> <condition> If the TRACKING AREA UPDATE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. </action> </control>
<control> <condition> <condition> If the UE is registered in N1 mode </condition> and <condition> operating in dual-registration mode, </condition> </condition> <action> the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 subclause 4.8.3. </action> </control> <control> <condition> Otherwise </condition> <action> the UE shall perform a PLMN selection according to 3GPP TS 23.122. </action> </control>
<control> <action> The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" </action> <condition> when performing the tracking area updating procedure following the PLMN selection. </condition> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> #14 (EPS services not allowed in this PLMN); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). </action> <action> Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI List and eKSI. </action> </control>
<control> <action> The UE shall reset the tracking area updating attempt counter </action> and <end_state> shall enter the state EMM- DEREGISTERED.PLMN-SEARCH. </end_state> </control>
<control> <action> The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list </action> and <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102) </condition> then <action> the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a PLMN-specific PS-attempt counter for that PLMN, </condition> </condition> then <action> the UE shall set this counter to the UE implementation-specific maximum value. </action> </control>
The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.
<control> <condition> The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <condition> <condition> A UE operating in CS/PS mode 1 of operation </condition> and <condition> supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology </condition> and <condition> proceed with the appropriate MM specific procedure according to the MM service state. </condition> </condition> In this case, <action> the UE shall disable the E-UTRA capability (see subclause 4.5). </action> </control>
<control> <condition> A UE operating in CS/PS mode 1 of operation </condition> and <condition> supporting A/Gb mode or Iu mode </condition> <action> may perform a PLMN selection according to 3GPP TS 23.122. </action> </control>
<control> <condition> <condition> A UE operating in CS/PS mode 1 of operation </condition> and <condition> supporting S1 mode only, </condition> or <condition> operating in CS/PS mode 2 of operation </condition> </condition> <action> shall delete the list of equivalent PLMNs </action> and <action> shall perform a PLMN selection according to 3GPP TS 23.122. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and shall <action> delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #15 (No suitable cells in tracking area); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). </action> <action> The UE shall reset the tracking area updating attempt counter </action> and <end_state> shall enter the state EMM- REGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". </action> <condition> If the TRACKING AREA UPDATE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. </action> </control>
<control> <action> Additionally, the UE shall remove the current TAI from the stored TAI list <condition> if present </condition> </action> </control> and: <control> a) <condition> <condition> if the UE is in WB-S1 mode </condition> and <condition> the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the TRACKING AREA UPDATE REJECT message, </condition> <condition> the UE supports "E-UTRA Disabling for EMM cause #15", </condition> and <condition> the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 or 3GPP TS 31.102 is present and set to enabled; </condition> </condition> then <action> the UE shall disable the E-UTRA capability as specified in subclause 4.5 </action> and <action> search for a suitable cell in another location area or 5GS tracking area; </action> </control> <control> b) <condition> <condition> if the UE is in NB-S1 mode </condition> and <condition> the Extended EMM cause IE with value "NB-IoT not allowed" is included in the TRACKING AREA UPDATE REJECT message, </condition> </condition> <action> then the UE may disable the NB-IoT capability as specified in subclause 4.9 </action> and <action> search for a suitable cell in E-UTRAN radio access technology; </action> </control> <control> c) <condition> otherwise, </condition> <action> the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304. </action> </control>
<control> <action> The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" </action> <condition> when performing the tracking area updating procedure. </condition> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value. </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> If the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> <action> the UE shall proceed as described below, </action> </control> <control> <condition> otherwise </condition> <action> it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.3.3.6. </action> </control>
<control> <action> The UE shall abort the tracking area updating procedure, </action> <action> reset the tracking area updating attempt counter </action> and <action> set the EPS update status to EU2 NOT UPDATED. </action> <condition> If the rejected request was not for initiating a PDN connection for emergency bearer services, </condition> <end_state> the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO- UPDATE. </end_state> </control>
The UE shall stop timer T3346 if it is running.
<control> <condition> If the TRACKING AREA UPDATE REJECT message is integrity protected, </condition> <action> the UE shall start timer with the value provided in the T3346 value IE. </action> </control>
<control> <condition> If the TRACKING AREA UPDATE REJECT message is not integrity protected, </condition> <action> the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008. </action> </control>
<control> <action> The UE stays in the current serving cell and applies the normal cell reselection process. </action> <action> The tracking area updating procedure is started, </action> <condition> if still necessary, when timer T3346 expires or is stopped. </condition> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the tracking area updating procedure was initiated for an MO MMTEL voice call is started, </condition> <action> then a notification that the request was not accepted due to network congestion shall be provided to upper layers. </action> </control>
NOTE 4: This can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP TS 24.173 ).
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 </action> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> #25 (Not authorized for this CSG); </condition> </control>
EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.3.3.6.
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). </action> <action> The UE shall reset the tracking area updating attempt counter </action> and <end_state> shall enter the state EMM- REGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, </condition> <action> the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list. </action> </control>
<control> <condition> If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, </condition> <action> the UE shall apply the procedures defined in 3GPP TS 23.122 subclause 3.1A. </action> </control>
<control> <action> The UE shall search for a suitable cell according to 3GPP TS 36.304. </action> </control>
<control> <action> The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" </action> <condition> when performing the tracking area updating procedure. </condition> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition set the 5GMM state to 5GMM- REGISTERED </action> and <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED. </action> </control>
<control> <condition> #40 (No EPS bearer context activated); </condition> </control>
<control> <action> The UE shall deactivate all the EPS bearer contexts locally, </action> <condition> if any, </condition> and <end_state> shall enter the state EMM- DEREGISTERED.NORMAL-SERVICE. </end_state> </control>
<control> <condition> If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> </control> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures; </action> </control> <control> <condition> otherwise, </condition> <condition> if there is a CS fallback emergency call or CS fallback call pending, </condition> <action> the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer. </action> </control>
<control> <condition> If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, </condition> <action> the UE shall select cdma2000 1x radio access technology. The UE then proceeds with appropriate cdma2000 </action> </control>
<control> <condition> <condition> If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, </condition> and <condition> the UE has dual Rx/Tx configuration </condition> and <condition> supports enhanced 1xCS fallback, </condition> </condition> <action> the UE shall perform a new attach procedure. </action> </control>
<control> <condition> If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback, </condition> <action> the UE shall perform a new attach procedure. </action> </control>
NOTE 5: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition handle the GMM state as specified in 3GPP TS 24.008 </action> <condition> for the case when the combined routing area updating procedure is rejected with the GMM cause value #10 "Implicitly detached". </condition> </control>
A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.
<control> <condition> A UE in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED. </end_state> </control>
<control> <action> The UE shall set the EPS update status to EU2 NOT UPDATED, </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, </action> and <action> set the tracking area updating attempt counter to 5. </action> <action> The UE shall start an implementation specific timer, </action> <action> setting its value to 2 times the value of T as defined in 3GPP TS 23.122. </action> <control> <condition> While this timer is running, </condition> <action> the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. </action> </control> <end_state> The UE then enters state EMM- DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122. </end_state> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall in addition set the GMM state to GMM- DEREGISTERED, GPRS update status to GU2 NOT UPDATED, MM update status to U2 NOT UPDATED, </action> <action> and shall delete the P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number, LAI, TMSI and ciphering key sequence number. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
EMM cause #31 received by a UE that has not indicated support for CIoT optimizations is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.3.3.6.
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). </action> <action> The UE shall reset the tracking area updating attempt counter </action> and <end_state> shall enter the state EMM- REGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <action> The UE shall enable N1 mode capability for 3GPP access </action> <condition> if it was disabled and disable the E-UTRA capability. </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access </condition> and <condition> indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value. </condition> </control>
Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause 5.5.3.3.6.
5.5.3.3.6 Abnormal cases in the UE
<control> <action> The UE shall proceed as follows: </action> </control> <control> 1) <condition> if the UE requested the combined tracking area update for EPS services and "SMS only" </condition> and <condition> the TRACKING AREA UPDATE ACCEPT message indicates a combined tracking area updating procedure successful for EPS and non-EPS services, </condition> <action> the UE shall behave as if the combined tracking area updating procedure was successful for EPS services and "SMS only"; </action> </control> NOTE: In this case the UE can ignore the CS SERVICE NOTIFICATION message or the Paging with CN domain indicator set to "CS", as specified in subclause 5.6.2.3.2.
<control> 2) <condition> if the combined tracking area update was successful for EPS services only </condition> and <condition> the TRACKING AREA UPDATE ACCEPT message contained an EMM cause value not treated in subclause 5.5.3.3.4.3 </condition> or <condition> the EMM Cause IE is not included in the message, </condition> <action> the UE shall proceed as follows: </action> </control> <control> a) <action> The UE shall stop timer T3430 if still running, </action> and <action> shall enter state MM IDLE. </action> <action> The tracking area updating attempt counter shall be incremented, </action> <condition> unless it was already set to 5; </condition> </control> <control> b) <condition> If the tracking area updating attempt counter is less than 5: </condition> a) <action> the UE shall start timer T3411, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. </end_state> <condition> When timer T3411 expires </condition> <action> the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again; </action> </control> <control> c) <condition> If the tracking area updating attempt counter is equal to 5: </condition> b) <condition> a UE operating in CS/PS mode 2 of operation </condition> and <condition> a UE operating in CS/PS mode 1 of operation with "IMS voice available" </condition> <action> shall start timer T3402, </action> <action> shall set the EPS update status to EU1 UPDATED </action> and <end_state> shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. </end_state> <condition> When timer T3402 expires </condition> <action> the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again; </action> </control> and <control> c) <condition> a UE operating in CS/PS mode 1 of operation with "IMS voice not available" </condition> <action> shall attempt to select GERAN, UTRAN or NG-RAN radio access technology, proceed with appropriate MM, GMM or 5GMM specific procedures </action> and <action> disable the E-UTRA capability (see subclause 4.5); </action> </control> and <control> d) <condition> If there is a CS fallback emergency call or CS fallback call pending, or a paging for CS fallback, </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures; </action> </control> <control> <condition> <condition> otherwise, </condition> <condition> if there is a CS fallback emergency call or CS fallback call pending, </condition> </condition> <action> the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer; </action> </control> and
3) otherwise, the abnormal cases specified in subclause 5.5.3.2.6 apply with the following modification.
<control> <condition> If the tracking area updating attempt counter is incremented according to subclause 5.5.3.2.6 </condition> the next actions depend on the value of the tracking area updating attempt counter. <control> a) <condition> If the tracking area updating attempt counter is less than 5, </condition> <action> the UE shall set the update status to U2 NOT UPDATED, </action> <action> but shall not delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs </action> </control> <control> <condition> additionally if the tracking area updating procedure was performed due to cases h, m, n, z, zc in subclause 5.5.3.3.2 </condition> <action> the update status shall be changed to EU2; </action> </control> or <control> b) <control> <condition> if the tracking area updating attempt counter is equal to 5, </condition> <action> the UE shall delete any LAI, TMSI and ciphering key sequence number </action> and <action> set the update status to U2 NOT UPDATED. </action> </control> </control> </control>
<control> <condition> If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> </control> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures; </action> </control> <control> <condition> if there is a CS fallback emergency call or CS fallback call pending, </condition> <action> the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer. </action> </control>
5.5.3.3.7 Abnormal cases on the network side
The abnormal cases specified in subclause 5.5.3.2.7 apply.
5.5.4 eCall inactivity procedure
<control> <action> The eCall inactivity procedure is applicable </action> <condition> only to a UE configured for eCall only mode as specified in 3GPP TS 31.102 . </condition> <condition> The procedure shall be started when: <condition> a) <condition> the UE is in any EMM-REGISTERED substate </condition> <condition> except substates EMM-REGISTERED.PLMN-SEARCH or EMM-REGISTERED.NO-CELL-AVAILABLE; </condition> </condition> <condition> b) the UE is in EMM-IDLE mode; </condition> and <condition> c) one of the following conditions applies: <condition> 1) <condition> <condition> timer T3444 expires </condition> or <condition> is found to have already expired </condition> </condition> and <condition> timer T3445 is not running; </condition> </condition> <condition> 2) <condition> <condition> timer T3445 expires </condition> or <condition> is found to have already expired </condition> </condition> and <condition> timer T3444 is not running; </condition> </condition> or <condition> 3) <condition> timers T3444 and T3445 expire </condition> or <condition> are found to have already expired. </condition> </condition> </condition> </condition> The UE shall then perform the following actions: <action> a) stop other running timers (e.g. T3411, T3412); </action> <action> b) <condition> if the UE is currently registered to EPS services only, </condition> perform a detach procedure for EPS services only; </action> <action> c) <condition> if the UE is currently registered for both EPS services and non-EPS services, </condition> perform a combined detach procedure for EPS services and non-EPS services; </action> <action> d) delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, and eKSI; </action> and <end_state> e) enter EMM-DEREGISTERED.eCALL-INACTIVE state. </end_state> </control>
5.5.5 Tracking area update request message (for N1 mode only)
<control> The tracking area updating procedure is used <condition> to construct a TRACKING AREA UPDATE REQUEST message </condition> <condition> for the inter-system change from S1 mode to N1 mode </condition> <condition> for further security verification by the MME. </condition> <action> The TRACKING AREA UPDATE REQUEST message is created by EMM by request of 5GMM which further includes the message in the REGISTRATION REQUEST message as described in 3GPP TS 24.501 . </action> <action> The TRACKING AREA UPDATE REQUEST message shall contain only mandatory information elements. </action> <action> The UE shall set the EPS update type IE in the TRACKING AREA UPDATE REQUEST message to "TA updating". </action> <action> The UE shall include the eKSI (either KSI or KSI ) in the NAS Key Set Identifier IE in the TRACKING AREA UPDATE REQUEST message. </action> <action> The UE shall integrity protect the TRACKING AREA UPDATE REQUEST message with the current EPS security context </action> and <action> increase the uplink NAS COUNT by one. </action> <action> The UE shall set associated GUTI in the Old GUTI IE. </action> <control> <start_state> When the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE substate </start_state> and <condition> needs to construct the TRACKING AREA UPDATE REQUEST message for inter-system change from S1 mode to N1 mode, </condition> <action> the UE shall consider that the tracking area updating procedure is not initiated </action> and <end_state> the UE shall remain in EMM-REGISTERED.NO-CELL- AVAILABLE state. </end_state> </control> </control>
5.5.6 Attach request message (for N1 mode only)
<control> The attach procedure is used <condition> to construct an ATTACH REQUEST message </condition> <condition> for a UE performing a registration procedure for initial registration </condition> <condition> when <condition> a) the UE: <condition> 1) <condition> previously was registered in S1 mode </condition> <condition> before entering state EMM-DEREGISTERED; </condition> </condition> and <condition> 2) has received an "interworking without N26 interface not supported" indication from the network; </condition> </condition> and <condition> b) EPS security context and a valid 4G-GUTI are available. </condition> </condition> <action> The ATTACH REQUEST message is created by EMM by request of 5GMM which further includes the message in the REGISTRATION REQUEST message as described in 3GPP TS 24.501 . </action> <action> The ATTACH REQUEST message shall contain only mandatory information elements. </action> <action> The UE shall set the EPS attach type IE in the ATTACH REQUEST message to "EPS attach". </action> <action> The UE shall include the eKSI (KSI ) in the NAS Key Set Identifier IE in the ATTACH REQUEST message. </action> <action> The UE shall integrity protect the ATTACH REQUEST message with the current EPS security context </action> and <action> increase the uplink NAS COUNT by one. </action> <action> The UE shall set associated GUTI in the EPS mobile identity IE. </action> <action> The UE shall set the UE network capability IE according to its capabilities. </action> <action> The UE shall include an ESM DUMMY MESSAGE in the ESM message container IE. </action> </control>
5.6 EMM connection management procedures (S1 mode only)
5.6.1 Service request procedure
5.6.1.1 General
<control> The purpose of the service request procedure is to transfer the EMM mode from EMM-IDLE to EMM-CONNECTED mode. </control> <control> <condition> If the <condition> UE is not using EPS services </condition> <condition> with control plane CIoT EPS optimization, </condition> </condition> this procedure is used to establish the radio and S1 bearers when user data or signalling is to be sent. </control> <control> <condition> If the UE is <condition> using EPS services </condition> <condition> with control plane CIoT EPS optimization, </condition> </condition> this procedure can be used for UE initiated transfer of user data via the control plane. </control> <control> Another purpose of this procedure is to invoke MO/MT CS fallback or 1xCS fallback procedures. </control>
<control> <action> This procedure is used </action> <condition> when: <condition> a) the network has downlink signalling pending; </condition> <condition> b) the UE has uplink signalling pending; </condition> <condition> c) <condition> the UE or the network has user data pending </condition> and <condition> the UE is in EMM-IDLE mode; </condition> </condition> <condition> d) <condition> <condition> the UE is in EMM-CONNECTED mode </condition> and <condition> has a NAS signalling connection only; </condition> </condition> <condition> the UE is <condition> using EPS services </condition> <condition> with control plane CIoT EPS optimization, </condition> </condition> and <condition> <condition> it has user data pending </condition> <condition> which is to be transferred via user plane radio bearers; </condition> </condition> </condition> <condition> e) <condition> the UE in EMM-IDLE or EMM-CONNECTED mode </condition> <condition> has requested to perform mobile originating/terminating CS fallback or 1xCS fallback; </condition> </condition> <condition> f) the network has downlink cdma2000 signalling pending; </condition> <condition> g) the UE has uplink cdma2000 signalling pending; </condition> <condition> h) the UE has to request resources for ProSe direct discovery or Prose direct communication; </condition> or <condition> i) the UE has to request resources for V2X communication over PC5. </condition> </condition> </control>
<control> The service request procedure is initiated by the UE, however, <condition> <condition> for the downlink transfer of signalling, cdma2000 signalling or user data </condition> <condition> in EMM-IDLE mode, </condition> </condition> the trigger is given by the network by means of the paging procedure (see subclause 5.6.2). </control>
<control> <action> The UE shall invoke the service request procedure </action> <condition> when: <condition> a) <condition> the UE in EMM-IDLE mode </condition> <condition> receives a paging request </condition> <condition> using S-TMSI </condition> <condition> with CN domain indicator set to "PS" from the network; </condition> </condition> <condition> b) the UE, <condition> in EMM-IDLE mode, </condition> <condition> has pending user data to be sent; </condition> </condition> <condition> c) the UE, <condition> in EMM-IDLE mode, </condition> <condition> has uplink signalling pending; </condition> </condition> <condition> d) <condition> the UE in EMM-IDLE or EMM-CONNECTED mode </condition> <condition> <condition> is configured to use CS fallback </condition> and <condition> has a mobile originating CS fallback request from the upper layer; </condition> </condition> </condition> <condition> e) <condition> <condition> the UE in EMM-IDLE mode </condition> <condition> <condition> is configured to use CS fallback </condition> and <condition> receives a paging request with CN domain indicator set to "CS", </condition> </condition> </condition> or <condition> <condition> the UE in EMM-CONNECTED mode </condition> <condition> <condition> is configured to use CS fallback </condition> and <condition> receives a CS SERVICE NOTIFICATION message; </condition> </condition> </condition> </condition> <condition> f) <condition> the UE in EMM-IDLE or EMM-CONNECTED mode </condition> <condition> <condition> is configured to use 1xCS fallback </condition> and <condition> has a mobile originating 1xCS fallback request from the upper layer; </condition> </condition> </condition> <condition> g) <condition> the UE in EMM-CONNECTED mode </condition> <condition> <condition> is configured to use 1xCS fallback </condition> and <condition> <condition> accepts cdma2000 signalling messages </condition> <condition> containing a 1xCS paging request received over E-UTRAN; </condition> </condition> </condition> </condition> <condition> h) the UE, <condition> in EMM-IDLE mode, </condition> <condition> has uplink cdma2000 signalling pending </condition> <condition> to be transmitted over E-UTRAN; </condition> </condition> <condition> i) the UE, <condition> in EMM-IDLE or EMM-CONNECTED mode, </condition> <condition> <condition> is configured to use 1xCS fallback, </condition> <condition> <condition> accepts cdma2000 signalling messages </condition> <condition> containing a 1xCS paging request </condition> <condition> received over cdma2000 1xRTT, </condition> </condition> and <condition> the network supports dual Rx CSFB or provide CS fallback registration parameters (see 3GPP TS 36.331 ); </condition> </condition> </condition> <condition> j) the UE, <condition> in EMM-IDLE or EMM-CONNECTED mode, </condition> <condition> <condition> has uplink cdma2000 signalling pending </condition> <condition> to be transmitted over cdma2000 1xRTT, </condition> and <condition> the network supports dual Rx CSFB or provide CS fallback registration parameters (see 3GPP TS 36.331 ); </condition> </condition> </condition> <condition> k) <condition> the UE performs an inter-system change from S101 mode to S1 mode </condition> and <condition> has user data pending; </condition> </condition> <condition> l) <condition> the UE in EMM-IDLE mode </condition> <condition> has to request resources for ProSe direct discovery or Prose direct communication (see 3GPP TS 36.331 ); </condition> </condition> or <condition> m) the UE, <condition> <condition> in EMM-CONNECTED mode </condition> and <condition> has a NAS signalling connection only, </condition> </condition> <condition> <condition> is using EPS services </condition> <condition> with control plane CIoT EPS optimization </condition> and <condition> <condition> has pending user data </condition> <condition> to be sent via user plane radio bearers; </condition> </condition> </condition> </condition> or <condition> n) <condition> the UE in EMM-IDLE mode </condition> <condition> has to request resources for V2X communication over PC5 (see 3GPP TS 23.285 ). </condition> </condition> </condition> </control>
<control> <condition> If one of the above criteria to invoke the service request procedure is fulfilled, </condition> <action> then the service request procedure may only be initiated by the UE </action> <condition> when the following conditions are fulfilled: <condition> <condition> a) <condition> its EPS update status is EU1 UPDATED, </condition> and <condition> the TAI of the current serving cell is included in the TAI list; </condition> </condition> and <condition> b) no EMM specific procedure is ongoing. </condition> </condition> </condition> </control>
UE AS MME SERVICE REQUEST
Start T3417 AS indication about bearer establishment for user plane
Stop T3417 OR SERVICE REQUEST
Start T3417 SERVICE ACCEPT
Start T3417 EXTENDED SERVICE REQUEST
(not for CSFB) AS indication about bearer establishment for user plane
Start T3417 EXTENDED SERVICE REQUEST
(not for CSFB) SERVICE ACCEPT
Start T3417ext EXTENDED SERVICE REQUEST
(for CSFB) AS indication about system change
Stop T3417ext OR SERVICE REQUEST
Start T3417 SERVICE REJECT
Stop T3417 OR EXTENDED SERVICE REQUEST
Start T3417ext SERVICE REJECT
Stop T3417ext NOTE 1: AS indications (indications from lower layers) are results of procedures triggered by MME in service request procedure. Triggered procedures could be e.g. RRC connection reconfiguration procedure (see 3GPP TS 36.331 ) and inter system PS handover to GERAN or UTRAN procedure as a result of CSFB procedure (see 3GPP TS 23.272 ).
NOTE 2: <control> <condition> For 1xCS fallback, </condition> <action> the UE sends the EXTENDED SERVICE REQUEST message </action> and <action> starts timer T3417. </action> </control>
<control> <action> The procedure is considered completed </action> <condition> upon receiving indication of system change from AS. </condition> </control>
UE AS MME CONTROL PLANE SERVICE REQUEST
Start T3417
Security Protected NAS message
Stop T3417 OR CONTROL PLANE SERVICE REQUEST
Start T3417 AS indication about release of RRC connection
Start T3417 CONTROL PLANE SERVICE REQUEST AS indication about bearer establishment for user plane
Stop T3417 OR CONTROL PLANE SERVICE REQUEST
Start T3417 SERVICE REJECT
Stop T3417
NOTE 1: Security protected NAS message: this could be e.g. a SECURITY MODE COMMAND, SERVICE ACCEPT, or ESM DATA TRANSPORT message.
NOTE 2: AS indications (indications from lower layers) are results of procedures triggered by MME in service request procedure. Triggered procedures could be e.g. an RRC connection release procedure or RRC connection reconfiguration procedure (see 3GPP TS 36.331 ).
A service request attempt counter is used to limit the number of service request attempts and no response from the network. The service request attempt counter shall be incremented as specified in subclause 5.6.1.6.
<control> <action> The service request attempt counter shall be reset </action> <condition> when: <condition> a) a normal or periodic tracking area updating or a combined tracking area updating procedure is successfully completed; </condition> <condition> b) a service request procedure in order to obtain packet services is successfully completed; </condition> or <condition> c) the UE moves to EMM-DEREGISTERED state. </condition> </condition> </control>
5.6.1.2 Service request procedure initiation
5.6.1.2.1 UE is not using EPS services with control plane CIoT EPS optimization
<control> <condition> For cases a, b, c, h, k and l in subclause 5.6.1.1: </condition> <control> a) <condition> if the UE is not configured for NAS signalling low priority, </condition> <action> the UE initiates the service request procedure by sending a SERVICE REQUEST message to the MME; </action> </control> <control> b) <condition> <condition> if the UE is configured for NAS signalling low priority, </condition> and <condition> the last received ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message from the network </condition> <condition> indicated that the network supports use of EXTENDED SERVICE REQUEST for packet services, </condition> </condition> <action> the UE shall send an EXTENDED SERVICE REQUEST message </action> <action> with service type set to "packet services via S1"; </action> </control> or NOTE: <control> <condition> A UE configured for dual priority </condition> <action> is configured for NAS signalling low priority indicator. </action> </control> <control> c) <condition> <condition> if the UE is configured for NAS signalling low priority </condition> and <condition> <condition> the last received ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message from the network </condition> <condition> did not indicate that the network supports use of EXTENDED SERVICE REQUEST for packet services, </condition> </condition> </condition> <action> the UE shall instead send a SERVICE REQUEST message. </action> </control> </control>
<control> <condition> For cases a, b, c, h, k and l in subclause 5.6.1.1, <condition> after sending the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message </condition> <condition> with service type set to "packet services via S1", </condition> </condition> <action> the UE shall start T3417 </action> and <end_state> enter the state EMM-SERVICE-REQUEST-INITIATED. </end_state> </control>
<control> <condition> For case d in subclause 5.6.1.1, </condition> <action> the UE shall send an EXTENDED SERVICE REQUEST message, </action> <action> start T3417ext </action> and <end_state> enter the state EMM-SERVICE-REQUEST-INITIATED. </end_state> </control>
<control> <condition> For case e in subclause 5.6.1.1: </condition> <control> a) <condition> if the UE is in EMM-IDLE mode, </condition> <action> the UE shall send an EXTENDED SERVICE REQUEST message, </action> <action> start T3417ext-mt </action> and <end_state> enter the state EMM-SERVICE-REQUEST-INITIATED; </end_state> </control> <control> b) <condition> <condition> if the UE is in EMM-CONNECTED mode </condition> and <condition> if the UE accepts the paging, </condition> </condition> <action> the UE shall send an EXTENDED SERVICE REQUEST message </action> <action> with the CSFB response IE indicating "CS fallback accepted by the UE", </action> <action> start T3417ext-mt </action> and <end_state> enter the state EMM-SERVICE-REQUEST-INITIATED; </end_state> </control> or <control> a) <condition> <condition> if the UE is in EMM-CONNECTED mode </condition> and <condition> if the UE rejects the paging, </condition> </condition> <action> the UE shall send an EXTENDED SERVICE REQUEST message </action> <action> with the CSFB response IE indicating "CS fallback rejected by the UE" </action> and <end_state> enter the state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <action> The network shall not initiate CS fallback procedures. </action> </control> </control>
<control> <condition> For cases f, g, i and j in subclause 5.6.1.1, </condition> <action> the UE shall send an EXTENDED SERVICE REQUEST message, </action> <action> start T3417 </action> and <end_state> enter the state EMM-SERVICE-REQUEST-INITIATED. </end_state> </control>
5.6.1.2.2 <control> <condition> <condition> UE is using EPS services </condition> <condition> with control plane CIoT EPS optimization. </condition> </condition> <action> The UE shall send a CONTROL PLANE SERVICE REQUEST message, </action> <action> start T3417 </action> and <end_state> enter the state EMM-SERVICE-REQUEST-INITIATED. </end_state> </control>
<control> <condition> For case a in subclause 5.6.1.1, </condition> <action> the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate "mobile terminating request". </action> <action> The UE may include the ESM DATA TRANSPORT message. </action> <action> The UE shall not include any ESM message other than ESM DATA TRANSPORT message. </action> </control>
<control> <condition> For case b in subclause 5.6.1.1, </condition> <control> a) <condition> <condition> if the UE has pending IP, non-IP or Ethernet user data that </condition> <condition> is to be sent via the control plane radio bearers, </condition> </condition> <action> the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate "mobile originating request". </action> <action> The UE shall include an ESM DATA TRANSPORT message in the ESM message container IE. </action> </control> <control> <condition> If the UE supports the CP-EDT (see 3GPP TS 36.300 ), </condition> <action> the UE shall provide the CONTROL PLANE SERVICE REQUEST message in the NAS request to the lower layer </action> <condition> to establish a RRC connection as specified in subclause 5.3.1.1. </condition> </control> </control>
<control> <condition> For cases b and m in subclause 5.6.1.1, </condition> <control> a) <condition> <condition> if the UE has pending IP, non-IP or Ethernet user data </condition> <condition> thatis to be sent via the user plane radio bearers, </condition> </condition> <action> the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "mobile originating request" </action> and <action> the "active" flag in the Control plane service type IE to 1. </action> <action> The UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message. </action> </control> </control>
<control> <condition> For case c in subclause 5.6.1.1, </condition> <action> the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "mobile originating request". </action> </control> <control> <condition> If the CONTROL PLANE SERVICE REQUEST message </condition> is: <control> <condition> a) for sending SMS , </condition> <action> the UE shall include the SMS message in the NAS message container IE </action> and <action> shall not include any ESM message container IE in the CONTROL PLANE SERVICE REQUEST message ; </action> </control> and <control> b) <condition> for sending signalling different from SMS, </condition> <action> the UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message. </action> </control> </control>
5.6.1.3 EMM common procedure initiation
<control> <condition> Upon receipt of the SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message, </condition> <action> the MME may initiate the EMM common procedures, e.g. the authentication procedure and security mode control procedure. </action> </control>
5.6.1.4 Service request procedure accepted by the network
5.6.1.4.1 UE is not using EPS services with control plane CIoT EPS optimization
<control> <condition> <condition> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME </condition> and <condition> the MME has no active EPS bearer contexts for the UE, </condition> </condition> <condition> for cases a, b and c in subclause 5.6.1.1, </condition> <condition> upon receipt of the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services, </condition> <condition> after completion of the EMM common procedures according to subclause 5.6.1.3, if any, </condition> </condition> <action> the MME shall send a SERVICE ACCEPT message. </action> </control>
<control> <condition> <condition> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME </condition> and <condition> the UE has no active EPS bearer contexts, </condition> </condition> <condition> for cases a, b and c in subclause 5.6.1.1, </condition> </condition> <action> the UE shall treat the <condition> receipt of a SERVICE ACCEPT message </condition> as successful completion of the procedure. </action> </control> <control> <condition> Otherwise, </condition> <condition> for cases a, b, c, h, k and l in subclause 5.6.1.1, </condition> <action> the UE shall treat the indication from the lower layers that the user plane radio bearer is set up as successful completion of the procedure. </action> <action> The UE shall reset the service request attempt counter, </action> <action> stop the timer T3417 </action> <end_state> and enter the state EMM-REGISTERED. </end_state> </control>
<control> <condition> <condition> <condition> If the service type information element in the EXTENDED SERVICE REQUEST message indicates "mobile terminating CS fallback or 1xCS fallback" </condition> and <condition> the CSFB response IE, if included, indicates "CS fallback accepted by the UE", </condition> </condition> or <condition> if the service type information element in the EXTENDED SERVICE REQUEST message indicates "mobile originating CS fallback or 1xCS fallback" or "mobile originating CS fallback emergency call or 1xCS fallback emergency call", </condition> </condition> <action> the network initiates CS fallback or 1xCS fallback procedures. </action> </control>
<control> <condition> If the EPS bearer context status IE is included in the EXTENDED SERVICE REQUEST message, </condition> <action> the network shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the network and the UE) which are active on the network side but are indicated by the UE as being inactive. </action> <control> <condition> <condition> If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the EXTENDED SERVICE REQUEST message, </condition> and <condition> this default bearer is not associated with the last remaining PDN connection of the UE in the MME, </condition> </condition> <action> the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. </action> </control> <control> <condition> <condition> If the default bearer is associated with the last remaining PDN connection of the UE in the MME, </condition> and <condition> EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> </condition> <action> the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. </action> </control> </control>
<control> <condition> <condition> If the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services, was sent in a CSG cell </condition> and <condition> the CSG subscription has expired or was removed for a UE, </condition> <condition> but the UE has a PDN connection for emergency bearer services established, </condition> </condition> <action> the network shall accept the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services </action> and <action> deactivate all non-emergency EPS bearers locally. </action> <action> The emergency EPS bearers shall not be deactivated. </action> </control>
<control> <condition> <condition> For cases d in subclause 5.6.1.1, and for case e in subclause 5.6.1.1 </condition> <condition> when the CSFB response was set to "CS fallback accepted by the UE", </condition> </condition> <action> the UE shall treat the indication from the lower layers that the inter-system change from S1 mode to A/Gb or Iu mode is completed as successful completion of the procedure. </action> <action> The EMM sublayer in the UE shall indicate to the MM sublayer that the CS fallback procedure has succeeded. </action> <action> The UE shall stop the timer T3417ext or T3417ext- mt, respectively, </action> and <end_state> enter the state EMM-REGISTERED.NO-CELL-AVAILABLE. </end_state> </control>
<control> <condition> <condition> If the service request procedure was initiated in EMM-IDLE mode </condition> and <condition> an EXTENDED SERVICE REQUEST message was sent in a CSG cell </condition> and <condition> <condition> the CSG subscription has expired </condition> or <condition> was removed for the UE, </condition> </condition> </condition> <action> the network need not perform CSG access control </action> <condition> if the service type information element indicates "mobile originating CS fallback emergency call or 1xCS fallback emergency call". </condition> </control>
<control> <condition> For cases f and g in subclause 5.6.1.1: </condition> <control> a) <condition> <condition> if the UE receives the indication from the lower layers that the signalling connection is released </condition> <condition> <condition> with the redirection indication to cdma2000 1x access network </condition> </condition> or <condition> the indication from the lower layers that a change to cdma2000 1x access network for 1xCS fallback has started (see 3GPP TS 36.331 ), </condition> </condition> <action> the UE shall consider the service request procedure successfully completed, </action> <action> stop timer T3417 </action> and <end_state> enter the state EMM- REGISTERED.NO-CELL-AVAILABLE; </end_state> </control> <control> b) <condition> if the UE receives the dual Rx/Tx redirection indication from the lower layers (see 3GPP TS 36.331 ), </condition> <action> the UE shall select cdma2000 1x access network for 1xCS fallback, </action> <action> consider the service request procedure successfully completed, </action> <action> stop timer T3417 </action> and <end_state> enter the state EMM-REGISTERED.NORMAL-SERVICE; </end_state> </control> and <control> c) <condition> if the UE receives a cdma2000 signalling message indicating 1xCS fallback rejection by cdma2000 1x access network, </condition> <action> the UE shall abort the service request procedure, </action> <action> stop timer T3417 </action> and <end_state> enter the state EMM- REGISTERED.NORMAL-SERVICE. </end_state> </control> </control>
<control> <condition> <condition> For cases i and j in subclause 5.6.1.1, </condition> <condition> if the UE receives the indication from the lower layers that the signalling connection is released, </condition> </condition> <action> the UE shall consider the service request procedure successfully completed, </action> <action> stop timer T3417 </action> and <end_state> enter the state EMM-REGISTERED.NO-CELL-AVAILABLE. </end_state> </control>
<control> <condition> If the SERVICE REQUEST message or an EXTENDED SERVICE REQUEST message for packet services was used, </condition> <action> the UE shall locally deactivate the EPS bearer contexts that do not have a user plane radio bearer established </action> <condition> upon successful completion of the service request procedure. </condition> </control>
<control> <condition> <condition> If the EXTENDED SERVICE REQUEST message is for CS fallback or 1xCS fallback </condition> and <condition> radio bearer establishment takes place during the procedure, </condition> </condition> <action> the UE shall locally deactivate the EPS bearer contexts </action> that <condition> do not have a user plane radio bearer established </condition> <condition> upon receiving a lower layer indication of radio bearer establishment. </condition> </control> <control> <action> The UE does not perform local deactivation of EPS bearer contexts </action> <condition> upon receiving an indication of inter-system change from lower layers. </condition> </control>
<control> <condition> <condition> If the EXTENDED SERVICE REQUEST message is for CS fallback or 1xCS fallback </condition> and <condition> radio bearer establishment does not take place during the procedure, </condition> </condition> <action> the UE does not perform local deactivation of the EPS bearer context. </action> </control> <control> <action> The UE does not perform local deactivation of EPS bearer contexts </action> <condition> upon receiving an indication of inter-system change from lower layers. </condition> </control>
<control> <condition> <condition> If a service request is received from a UE </condition> <condition> with a LIPA PDN connection, </condition> </condition> and <condition> if: <condition> a) a GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the service request, and the P-GW address included in the EPS bearer context of the LIPA PDN connection is different from the provided GW Transport Layer Address IE value (see 3GPP TS 36.413 ); </condition> or <condition> b) no GW Transport Layer Address is provided together with the service request by the lower layer; </condition> </condition> <action> then the MME shall locally deactivate all EPS bearer contexts associated with any LIPA PDN connection. </action> <control> Furthermore, <condition> if no active EPS bearer contexts remain for the UE, </condition> <action> the MME shall not accept the service request as specified in subclause 5.6.1.5. </action> </control> </control>
<control> <condition> If a service request is received from a UE with a SIPTO at the local network PDN connection, </condition> and <condition> if the PDN connection is a: <condition> 1) <condition> SIPTO at the local network PDN connection with stand-alone GW, </condition> <condition> and <condition> if: <condition> a) <condition> a LHN-ID value is provided by the lower layer together with the service request, </condition> and <condition> the LHN-ID value stored in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP TS 36.413 ); </condition> </condition> or <condition> b) no LHN-ID value is provided together with the service request by the lower layer; </condition> </condition> </condition> </condition> or <condition> 2) <condition> SIPTO at the local network PDN connection with collocated L-GW, </condition> and <condition> if: <condition> a) <condition> a SIPTO L-GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the service request, </condition> and <condition> the P-GW address included in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address IE value (see 3GPP TS 36.413 ); </condition> </condition> or <condition> b) no SIPTO L-GW Transport Layer Address is provided together with the service request by the lower layer; </condition> </condition> </condition> </condition> then, the MME takes one of the following actions: <control> a) <condition> if all the remaining PDN connections are SIPTO at the local network PDN connections, </condition> <action> the MME shall not accept the service request as specified in subclause 5.6.1.5; </action> </control> and <control> b) <condition> <condition> if a PDN connection remains that is not SIPTO at the local network PDN connection </condition> and <condition> the network decides to set up the S1 and radio bearers, </condition> </condition> <action> the MME shall upon completion of the setup of the S1 bearers initiate an EPS bearer context deactivation procedure with ESM cause #39 "reactivation requested" for the default EPS bearer context of each SIPTO at the local network PDN connection (see subclause 6.4.4.2). </action> </control> </control>
NOTE: For some cases of CS fallback or 1x CS fallback the network can decide not to set up any S1 and radio bearers.
<control> <condition> When the E-UTRAN fails to establish radio bearers for one or more EPS bearer contexts, </condition> <action> then the MME shall locally deactivate the EPS bearer contexts </action> <condition> corresponding to the failed radio bearers based on the lower layer indication from the E-UTRAN, </condition> <action> without notifying the UE. </action> </control>
<control> <condition> <condition> If the UE is not using EPS services <condition> </condition> with control plane CIoT EPS optimization, </condition> </condition> <action> the network shall consider the service request procedure successfully completed </action> <condition> in the following cases: <condition> a) <condition> when it receives an indication from the lower layer that the user plane is setup, </condition> <condition> if radio bearer establishment is required; </condition> </condition> <condition> b) <condition> otherwise </condition> <condition> when it receives an indication from the lower layer that the UE has been redirected to the other RAT (GERAN or UTRAN in CS fallback, or cdma2000 1x access network for 1xCS fallback). </condition> </condition> </condition> </control>
5.6.1.4.2 UE is using EPS services with control plane CIoT EPS optimization
<control> <condition> <condition> <condition> For case a in subclause 5.6.1.1, </condition> <condition> <condition> upon receipt of the CONTROL PLANE SERVICE REQUEST message </condition> <condition> with Control plane service type indicating "mobile terminating request", </condition> </condition> <condition> after completion of the EMM common procedures according to subclause 5.6.1.3: </condition> </condition> <condition> 1) <condition> if the MME needs to perform an EPS bearer context status synchronization </condition> <condition> <condition> a) for an EPS bearer context associated with Control plane only indication; </condition> or <condition> b) for an EPS bearer context not associated with Control plane only indication, </condition> </condition> <condition> there is no downlink user data pending to be delivered via the user plane, </condition> and <condition> the UE did not set the "active" flag in the Control plane service type IE to 1; </condition> </condition> or <condition> 2) <condition> if the control plane data back-off time for the UE is stored in MME </condition> and <condition> the MME decides to deactivate congestion control for transport of user data via the control plane, </condition> </condition> </condition> <action> then the MME shall send a SERVICE ACCEPT message . </action> Furthermore the MME may: <action> 1) initiate the transport of user data via the control plane procedure or any other NAS signalling procedure; </action> <control> 2) <condition> if supported by the UE and required by the network, </condition> <action> initiate the setup of the user plane radio bearer(s); </action> </control> or <action> 3) send a NAS signalling message not related to an EMM common procedure to the UE if downlink signalling is pending. </action> </control>
<control> <condition> <condition> For case b in subclause 5.6.1.1, </condition> <condition> <condition> upon receipt of the CONTROL PLANE SERVICE REQUEST message </condition> <condition> with Control plane service type indicating "mobile originating request", </condition> </condition> <condition> after completion of the EMM common procedures according to subclause 5.6.1.3, if any, </condition> <condition> if the MME needs to perform an EPS bearer context status synchronization </condition> <condition> <condition> a) for an EPS bearer context associated with Control plane only indication; </condition> or <condition> b) for an EPS bearer context not associated with Control plane only indication, </condition> </condition> <condition> there is no downlink user data pending to be delivered via the user plane, </condition> and <condition> the UE did not set the "active" flag in the Control plane service type IE to 1, </condition> </condition> <action> then the MME shall send a SERVICE ACCEPT message. </action> Furthermore, the MME may: <control> 1) <action> initiate release of the NAS signalling connection </action> <condition> <condition> upon receipt of an indication from the ESM layer (see subclause 6.6.4.2), </condition> <condition> unless the MME has additional downlink user data or signalling pending; </condition> </condition> </control> <control> 2) <action> initiate the setup of the user plane radio bearer(s), </action> <condition> <condition> if downlink user data is pending to be delivered via the user plane </condition> or <condition> the UE has set the "active" flag in the Control plane service type IE to 1; </condition> </condition> </control> <control> 3) <action> send an ESM DATA TRANSPORT message to the UE, </action> <condition> if downlink user data is pending to be delivered via the control plane; </condition> </control> <control> 4) <action> send a NAS signalling message not related to an EMM common procedure to the UE </action> <condition> if downlink signalling is pending; </condition> </control> or <control> 5) <action> send a SERVICE ACCEPT message to complete the service request procedure, </action> <condition> <condition> if no NAS security mode control procedure was initiated, </condition> <condition> the MME did not send a SERVICE ACCEPT message as specified above to perform an EPS bearer context status synchronization, </condition> and <condition> the MME did not initiate any of the procedures specified in item </condition> </condition> </control> </control>
NOTE 1: <control> <action> The MME can initiate the setup of the user plane radio bearer(s) </action> <condition> if the MME decides to activate the congestion control for transport of user data via the control plane. </condition> </control>
<control> <condition> <condition> For case m in subclause 5.6.1.1, </condition> <condition> <condition> upon receipt of the CONTROL PLANE SERVICE REQUEST message </condition> <condition> with Control plane service type indicating "mobile originating request" </condition> </condition> and <condition> the "active" flag in the Control plane service type IE set to 1: </condition> </condition> <control> 1) <condition> if the MME accepts the request, </condition> <action> the MME shall initiate the setup of the user plane radio bearer(s) for all active EPS bearer contexts of SGi PDN connections that are established without control plane only indication. </action> </control> <control> 2) <condition> if the MME does not accept the request, </condition> <action> the MME shall send a SERVICE ACCEPT message to complete the service request procedure. </action> </control> </control>
NOTE 2: The MME takes into account the maximum number of user plane radio bearers supported by the UE, in addition to local policies and the UE's preferred CIoT network behaviour when deciding whether to accept the request to establish user plane bearer(s) as described in subclause 5.3.15. <control> <condition> If the MME accepts the request, </condition> <action> all SGi PDN connections are considered as established without Control plane only indication. </action> </control>
NOTE 3: In this release of the specification, a UE in NB-S1 mode can support a maximum of 2 user plane radio bearers (see subclause 6.5.0).
<control> <condition> For case c in subclause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile originating request" and without an ESM message container IE, after completion of the EMM common procedures according to subclause 5.6.1.3, if any, </condition> the MME proceeds as follows: <control> <condition> <condition> If the MME needs to perform an EPS bearer context status synchronization </condition> <condition> <condition> a) for an EPS bearer context associated with Control plane only indication; </condition> or <condition> b) for an EPS bearer context not associated with Control plane only indication, </condition> </condition> and <condition> there is no downlink user data pending to be delivered via the user plane, </condition> </condition> <action> then the MME shall send a SERVICE ACCEPT message. </action> </control> Furthermore, the MME may: <control> 1) <action> initiate the setup of the user plane radio bearer(s), </action> <condition> if downlink user data is pending to be delivered via the user plane; </condition> </control> <control> 2) <action> send an ESM DATA TRANSPORT message to the UE, </action> <condition> <condition> if downlink user data is pending </condition> <condition> to be delivered via the control plane; </condition> </condition> </control> <control> 3) <action> send a NAS signalling message not related to an EMM common procedure to the UE, </action> <condition> if downlink signalling is pending; </condition> </control> or <control> 4) <action> send a SERVICE ACCEPT message to complete the service request procedure, </action> <condition> <condition> if no NAS security mode control procedure was initiated, </condition> <condition> the MME did not <condition> send a SERVICE ACCEPT message as specified above </condition> <condition> to perform an EPS bearer context status synchronization, </condition> </condition> and <condition> the MME did not initiate any of the procedures specified in item </condition> </condition> </control> </control>
<control> <condition> <condition> In NB-S1 mode, </condition> <condition> for cases a, b, c and m in subclause 5.6.1.1, </condition> <condition> if the MME needs to initiate the setup of user plane radio bearer(s), </condition> </condition> <action> the MME shall check if the UE can support the establishment of additional user plane radio bearer based on the multiple DRB support indicated by UE in the UE network capability IE. </action> </control>
<control> <condition> <condition> For cases a, b and c in subclause 5.6.1.1, </condition> <condition> if the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST message, </condition> </condition> <action> the network shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the network and the UE) </action> <condition> <condition> which are active on the network side </condition> <condition> but are indicated by the UE as being inactive. </condition> </condition> <control> <condition> <condition> If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the CONTROL PLANE SERVICE REQUEST message, </condition> and <condition> this default bearer is not associated with the last PDN connection of the UE in the MME, </condition> </condition> <action> the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. </action> </control> <control> <condition> <condition> If the default bearer is associated with the last remaining PDN connection of the UE in the MME, </condition> and <condition> EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> </condition> <action> the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. </action> </control> </control>
<control> <condition> <condition> If the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST </condition> and <condition> the MME decides to respond with a SERVICE ACCEPT message, </condition> </condition> <action> the MME shall include an EPS bearer context status IE, indicating which EPS bearer contexts are active in the MME, </action> <condition> except for the case <condition> when no EPS bearer context exists on the network side. </condition> </condition> </control>
<control> <condition> If the MME needs to initiate an EPS bearer context status synchronization, </condition> <action> the MME may include an EPS bearer context status IE in the SERVICE ACCEPT message also </action> <condition> if no EPS bearer context status IE was included in the CONTROL PLANE SERVICE REQUEST message. </condition> </control>
<control> <condition> <condition> If the MME sends a SERVICE ACCEPT message </condition> <condition> upon receipt of the CONTROL PLANE SERVICE REQUEST message piggybacked with the ESM DATA TRANSPORT message: </condition> <condition> <condition> a) if the Release assistance indication IE is set to "No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected" in the message; </condition> <condition> b) if the UE has indicated support for the control plane data back-off timer; </condition> and <condition> c) if the MME decides to activate the congestion control for transport of user data via the control plane, </condition> </condition> </condition> <action> then the MME shall include the T3448 value IE in the SERVICE ACCEPT message. </action> </control>
<control> <condition> <condition> If the MME sends a SERVICE ACCEPT message </condition> and <condition> decides to deactivate congestion control for transport of user data via the control plane </condition> </condition> <action> then the MME shall delete the stored control plane data back-off time for the UE </action> and <action> the MME shall not include timer T3448 value IE in SERVICE ACCEPT message. </action> </control>
<control> <condition> <condition> For cases a, b, c and m in subclause 5.6.1.1, </condition> <condition> <condition> if the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST message </condition> or <condition> the MME needs to initiate an EPS bearer context status synchronization, </condition> </condition> </condition> <action> the MME shall consider the service request procedure successfully completed </action> <condition> when it sends the SERVICE ACCEPT message. </condition> </control> <control> <condition> <condition> If the EPS bearer context status IE is not included in the CONTROL PLANE SERVICE REQUEST message </condition> and <condition> the MME does not need to initiate an EPS bearer context status synchronization, </condition> </condition> <action> the MME shall consider the service request procedure successfully completed </action> <condition> in the following cases: <condition> a) when it successfully completes a NAS security mode control procedure; </condition> <condition> b) <condition> when it receives an indication from the lower layer that the user plane is setup, </condition> <condition> if radio bearer establishment is required; </condition> </condition> <condition> c) <condition> <condition> upon receipt of the CONTROL PLANE SERVICE REQUEST message </condition> and <condition> completion of the EMM common procedures, if any, </condition> </condition> <condition> <condition> if the CONTROL PLANE SERVICE REQUEST message was successfully integrity checked </condition> and <condition> the ESM message container or NAS message container in the CONTROL PLANE SERVICE REQUEST message, if applicable, was successfully deciphered, </condition> </condition> <condition> <condition> radio bearer establishment is not required, </condition> and <condition> the MME has downlink user data or signalling not related to an EMM common procedure pending; </condition> </condition> </condition> and <condition> d) with the transmission of a SERVICE ACCEPT message or with the decision to initiate release of the NAS signalling connection, if the CONTROL PLANE SERVICE REQUEST message was successfully integrity checked and the ESM message container or NAS message container in the CONTROL PLANE SERVICE REQUEST message, if applicable, was successfully deciphered, radio bearer establishment is not required, and the MME does not have any downlink user data or signalling pending. </condition> </condition> </control>
<control> <condition> If the MME considers the service request procedure successfully completed </condition> the MME shall: <action> 1) forward the contents of the ESM message container IE, <condition> if any </condition> , to the ESM layer; </action> and <action> 2) forward the contents of the NAS message container IE, <condition> if any </condition> . </action> </control>
<control> <condition> For cases a, b and c in subclause 5.6.1.1, </condition> <action> the UE shall treat <condition> the receipt of any of the following </condition> as successful completion of the procedure: </action> <condition> a) a SECURITY MODE COMMAND message; b) a security protected EMM message different from a SERVICE REJECT message and not related to an EMM common procedure; c) a security protected ESM message; and d) receipt of the indication from the lower layers that the user plane radio bearers are set up. </condition> <control> <condition> Upon successful completion of the procedure, </condition> <action> the UE shall reset the service request attempt counter, </action> <action> stop the timer T3417 </action> and <end_state> enter the state EMM-REGISTERED. </end_state> </control> </control>
NOTE 4: The security protected EMM message can be e.g. a SERVICE ACCEPT message and the ESM message an ESM DATA TRANSPORT message.
<control> <condition> For case m in subclause 5.6.1.1, </condition> <action> the UE shall treat <condition> the indication from the lower layers that the user plane radio bearers are set up </condition> as successful completion of the procedure. </action> <action> The UE shall treat the <condition> receipt of a SERVICE ACCEPT message </condition> as completion of the procedure <condition> without the establishment of the user plane radio bearers. </condition> </action> <control> <condition> For both cases, </condition> <action> the UE shall reset the service request attempt counter, </action> <action> stop the timer T3417 </action> and <end_state> enter the state EMM-REGISTERED. </end_state> </control> </control>
<control> <condition> For case b in subclause 5.6.1.1, </condition> <action> the UE shall also treat <condition> the indication from the lower layers that the RRC connection has been released </condition> as successful completion of the procedure. </action> <action> The UE shall reset the service request attempt counter, </action> <action> stop the timer T3417 </action> and <end_state> enter the state EMM-REGISTERED. </end_state> </control>
<control> <condition> For cases a, c and m in subclause 5.6.1.1, </condition> <action> the UE shall treat <condition> the indication from the lower layers that the RRC connection has been released </condition> as an abnormal case </action> and <action> shall follow the procedure described in subclause 5.6.1.6, item b. </action> </control>
<control> <condition> For cases a, b and c in subclause 5.6.1.1, </condition> <control> a) <condition> if the MME needs to initiate an EPS bearer context status synchronization, </condition> <action> the UE can receive a SERVICE ACCEPT message </action> <condition> <condition> even after it received a SECURITY MODE COMMAND message </condition> or <condition> <condition> an indication from the lower layers that the user plane radio bearers are set up </condition> and <condition> determined successful completion of the service request procedure. </condition> </condition> </condition> </control> <control> <condition> <condition> Upon receipt of the SECURITY MODE COMMAND message </condition> or <condition> an indication from the lower layers that the user plane radio bearers are set up, </condition> </condition> <action> the UE shall start timer T3449. </action> </control> <control> <condition> If the UE receives a security protected ESM message or a security protected EMM message not related to an EMM common procedure, </condition> <action> the UE shall stop the timer T3449. </action> </control> <control> <condition> <condition> If the UE receives a SERVICE ACCEPT message </condition> <condition> while the timer T3449 is running, </condition> </condition> <action> the UE shall treat the SERVICE ACCEPT message </action> and <action> stop the timer T3449. </action> </control> <control> <condition> <condition> If the UE is not in state EMM-SERVICE-REQUEST-INITIATED </condition> and <condition> timer T3449 is not running, </condition> </condition> <action> the receipt of the SERVICE ACCEPT message is considered as protocol error </action> and <action> the UE shall return EMM STATUS message as specified in subclause 7.4; </action> </control> <control> <condition> otherwise </condition> <action> the UE shall treat the SERVICE ACCEPT message; </action> and <control> a) <condition> <condition> if the UE treats the SERVICE ACCEPT message </condition> and <condition> an EPS bearer context status IE is included in the message, </condition> </condition> <action> the UE shall deactivate all those EPS bearers contexts locally (without peer-to-peer signalling between the UE and the MME) </action> <condition> <condition> which are active in the UE, </condition> <condition> but are indicated by the MME as being inactive. </condition> </condition> </control> <control> <condition> <condition> If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the SERVICE ACCEPT message, </condition> and <condition> this default bearer is not associated with the last remaining PDN connection in the UE, </condition> </condition> <action> the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. </action> </control> <control> <condition> <condition> If the default bearer is associated with the last remaining PDN connection of the UE in the MME, </condition> and <condition> EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> </condition> <action> the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. </action> </control> </control> </control>
<control> <condition> If the T3448 value IE is present in the received SERVICE ACCEPT message, </condition> the UE shall: <control> a) <action> stop timer T3448 </action> <condition> if it is running; </condition> </control> <action> b) consider the transport of user data via the control plane as successful; </action> and <action> c) start timer T3448 with the value provided in the T3448 value IE. </action> </control>
<control> <condition> <condition> If the UE is using EPS services with control plane CIoT EPS optimization, </condition> <condition> the T3448 value IE is present in the SERVICE ACCEPT message </condition> and <condition> the value indicates that this timer is either zero or deactivated, </condition> </condition> <action> the UE shall consider this case as an abnormal case </action> and <action> proceed as if the T3448 value IE is not present. </action> </control>
<control> <condition> <condition> <condition> If the UE in EMM-IDLE mode initiated the service request procedure </condition> <condition> by sending a CONTROL PLANE SERVICE REQUEST message </condition> </condition> and <condition> the SERVICE ACCEPT message does not include the T3448 value IE </condition> and <condition> if timer T3448 is running, </condition> </condition> <action> then the UE shall stop timer T3448. </action> </control>
5.6.1.5 Service request procedure not accepted by the network
<control> <condition> If the service request cannot be accepted, </condition> <action> the network shall return a SERVICE REJECT message to the UE including an appropriate EMM cause value. </action> </control>
NOTE 1: <control> <action> A service request can only be rejected </action> <condition> <condition> before the network has initiated any procedure </condition> <condition> <condition> which will be interpreted by the UE as successful completion of the service request procedure (see subclauses 5.6.1.4.1 and 5.6.1.4.2) </condition> and <condition> which will trigger a transition from state EMM-SERVICE-REQUEST-INITIATED to EMM-REGISTERED on the UE side. </condition> </condition> </condition> </control>
<control> <condition> <condition> Based on local policies or configurations in the MME, </condition> <condition> <condition> if the MME determines to change the periodic tracking area update timer (T3412), </condition> or <condition> if the MME determines to change the PSM usage or the value of timer T3324 in the UE for which PSM is allowed by the MME, </condition> </condition> </condition> <action> the MME may return a SERVICE REJECT with the cause #10 "implicitly detached" to the UE. </action> </control>
<control> <condition> <condition> Based on operator policy, </condition> <condition> if the service request procedure is rejected due to core network redirection for CIoT optimizations, </condition> </condition> <action> the network shall set the EMM cause value to #31 "Redirection to 5GCN required". </action> </control>
NOTE 2: The network can take into account the UEs N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 "Redirection to 5GCN required". The MME may be configured to perform MME-based access control for mobile originating CS fallback calls for a certain area A by rejecting related service request with EMM cause #39 "CS service temporarily not available".
NOTE 3: Dependent on implementation and operator configuration the area A can be configured with the granularity of an MME area, tracking area or eNodeB service area.
<control> <action> The MME may further be configured for a certain area A' to exempt service requests for mobile originating CS fallback calls from this MME-based access control, </action> <condition> if: <condition> a) <condition> the service request is initiated </condition> <condition> in EMM-IDLE mode; </condition> </condition> and <condition> b) <condition> the UE indicated support of eNodeB-based access control for mobile originating CS fallback calls </condition> <condition> during an attach or tracking area updating procedure. </condition> </condition> </condition> </control>
NOTE 4: The operator can use this second option when the eNodeBs in area A' are supporting the eNodeB-based access control for CS fallback calls. The area A' can be part of area A or the whole area A. It is the responsibility of the operator to coordinate the activation of MME-based access control and eNodeB- based access control for mobile originating CS fallback calls.
<control> <condition> When the EMM cause value is #39 "CS service temporarily not available", </condition> <action> the MME shall include a value for timer T3442 in the SERVICE REJECT message. </action> </control> <control> <condition> <condition> If a mobile terminating CS fallback call is aborted by the network </condition> <condition> during call establishment as specified in 3GPP TS 29.118 , </condition> </condition> <action> the MME shall include the EMM cause value #39 "CS service temporarily not available" </action> and <action> set the value of timer T3442 to zero. </action> </control>
<control> <condition> <condition> If a service request from a UE with only LIPA PDN connections is not accepted </condition> <condition> due to the reasons specified in subclause 5.6.1.4, </condition> <condition> depending on the service request received, </condition> </condition> <action> the MME shall include the following EMM cause value in the SERVICE REJECT message: </action> <control> a) <condition> <condition> if the service request received </condition> <condition> isnot due to CS fallback or 1xCS fallback, </condition> </condition> <action> EMM cause value #10 "implicitly detached"; </action> </control> or <control> b) <condition> <condition> if the service request received </condition> <condition> is due to CS fallback or 1xCS fallback, </condition> </condition> <action> EMM cause value #40 "no EPS bearer context activated". </action> </control> </control>
<control> <condition> <condition> If a service request from a UE with only remaining SIPTO at the local network PDN connections is not accepted </condition> <condition> due to the reasons specified in subclause 5.6.1.4, </condition> <condition> depending on the service request received, </condition> </condition> the MME shall: <control> a) <condition> <condition> if the service request received </condition> <condition> is due to CS fallback or 1xCS fallback, </condition> </condition> <action> include the EMM cause value #40 "no EPS bearer context activated" in the SERVICE REJECT message; </action> </control> or <control> b) <condition> <condition> if the service request received </condition> <condition> is not due to CS fallback or 1xCS fallback, </condition> </condition> <action> abort the service request procedure </action> and <action> send a DETACH REQUEST message to the UE </action> <action> with detach type "re-attach required" (see subclause 5.5.2.3.1). </action> </control> </control>
<control> <condition> <condition> If the service request for mobile originated services is rejected </condition> <condition> due to general NAS level mobility management congestion control, </condition> </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> assign a value for back-off timer T3346. </action> </control>
<control> <condition> <condition> In NB-S1 mode, </condition> <condition> <condition> if the service request for mobile originated services is rejected </condition> <condition> due to operator determined barring (see 3GPP TS 29.272 ), </condition> </condition> </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> assign a value for back- off timer T3346. </action> </control>
<control> <condition> <condition> If the service request for mobile originated services is rejected </condition> <condition> due to service gap control as specified in subclause 5.3.17 i.e. </condition> </condition> <condition> the T3447 timer is running, </condition> <action> the network shall set the EMM cause value to #22 "congestion" </action> and <action> may assign a back-off timer T3346 with the remaining time of the running T3447 timer. </action> </control>
<control> <condition> <condition> If the MME sends a SERVICE REJECT message </condition> <condition> upon receipt of the CONTROL PLANE SERVICE REQUEST message </condition> <condition> piggybacked with the ESM DATA TRANSPORT message: </condition> </condition> <condition> <condition> a) if the Release assistance indication IE is not set to "No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected" in the message; </condition> <condition> b) if the UE has indicated a support for the control plane data back-off timer; </condition> and <condition> c) if the MME decides to activate the congestion control for transport of user data via the control plane, </condition> </condition> <action> then the MME shall set the EMM cause value to #22 "congestion" </action> and <action> assign a value for control plane data back-off timer T3448. </action> </control>
<control> <condition> On receipt of the SERVICE REJECT message, </condition> <start_state> if the UE is in state EMM-SERVICE-REQUEST-INITIATED </start_state> and <condition> <condition> the message is integrity protected </condition> or <condition> contains a reject cause other than EMM cause value #25, </condition> </condition> <action> the UE shall reset the service request attempt counter, </action> <control> <action> stop timer T3417, T3417ext or T3417ext-mt, </action> <condition> if running. </condition> </control> </control>
<control> <condition> <condition> If the SERVICE REJECT message with EMM cause #25 or #31 was received </condition> <condition> without integrity protection, </condition> </condition> <action> then the UE shall discard the message. </action> </control>
<control> The UE shall take the following actions <condition> depending on the received EMM cause value in the SERVICE REJECT message. </condition> </control>
<control> <condition> #3 (Illegal UE); #6 (Illegal ME); or #8 (EPS services and non-EPS services not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED ( andshall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <control> <action> The UE shall consider the USIM as invalid for EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in subclause 5.3.7a. </condition> </control> <action> Additionally, the UE shall delete the list of equivalent PLMNs </action> and <end_state> shall enter the state EMM-DEREGISTERED.NO-IMSI. </end_state> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the service request procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> <control> <action> The USIM shall be considered as invalid also for non-EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in subclause 5.3.7a. </condition> </control> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", </condition> </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> </control>
NOTE 5: The possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.
<control> <condition> <condition> For the EMM cause value #3 or #6, </condition> <condition> if the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the service request procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> <condition> For the EMM cause value #8, </condition> <condition> if the UE is operating in single-registration mode, </condition> </condition> the UE shall in addition <end_state> set the 5GMM state to 5GMM-DEREGISTERED, </end_state> <action> 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #7 (EPS services not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED(and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <control> <action> The UE shall consider the USIM as invalid for EPS services </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed </condition> or <condition> the timer T3245 expires </condition> as described in subclause 5.3.7a. </condition> </control> <end_state> The UE shall enter the state EMM- DEREGISTERED. </end_state> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", </condition> </condition> <action> then the UE shall set this counter to UE implementation-specific maximum value. </action> </control> </control>
A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.
<control> <condition> A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> shall set the update status to U2 NOT UPDATED, </action> <action> shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM specific procedure according to the MM service state. </action> <control> <action> The UE shall not reselect E-UTRAN radio access technology </action> <condition> until <condition> switching off </condition> or <condition> the UICC containing the USIM is removed. </condition> </condition> </control> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the service request procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the service request procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #9 (UE identity cannot be derived by the network); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <end_state> The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. </end_state> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback </condition> </condition> and <condition> a CS fallback cancellation request was not received, </condition> </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures </action> and <action> the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer. </action> </control> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback, </condition> </condition> <action> the UE shall select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS procedures. </action> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback </condition> </condition> and <condition> the UE has dual Rx/Tx configuration </condition> and <condition> supports enhanced 1xCS fallback, </condition> </condition> <action> the UE shall perform a new attach procedure. </action> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, </condition> </condition> <action> the UE shall perform a new attach procedure. </action> </control>
NOTE 6: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the service request procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #10 (Implicitly detached); </condition> </control>
A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.
<control> <condition> A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> A UE in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> is IMSI detached for both EPS services and non-EPS services. </action> <end_state> The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. </end_state> <action> The UE shall delete any mapped EPS security context or partial native EPS security context. </action> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback </condition> </condition> and <condition> a CS fallback cancellation request was not received, </condition> </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer. </action> </control> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback, </condition> </condition> <action> the UE shall select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS procedures. </action> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback </condition> </condition> and <condition> the UE has dual Rx/Tx configuration </condition> and <condition> supports enhanced 1xCS fallback, </condition> </condition> <action> the UE shall perform a new attach procedure. </action> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, </condition> </condition> <action> the UE shall perform a new attach procedure. </action> </control>
NOTE 7: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM state as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the service request procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> </control>
<control> <condition> A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM state as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the service request procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #11 (PLMN not allowed); or #35 (Requested service option not authorized in this PLMN); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <action> The UE shall delete the list of equivalent PLMNs </action> and <end_state> shall enter the state EMM-DEREGISTERED.PLMN-SEARCH. </end_state> <action> The UE shall store the PLMN identity in the "forbidden PLMN list" </action> and <control> <condition> if the UE is configured to use timer T3245 (see 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> <action> then the UE shall start timer T3245 </action> and <action> proceed as described in subclause 5.3.7a. </action> <control> <condition> <condition> If the message has been successfully integrity checked by the NAS </condition> and <condition> the UE maintains a PLMN-specific attempt counter for that PLMN, </condition> </condition> <action> then the UE shall set this counter to the UE implementation-specific maximum value. </action> </control> </control> <action> The UE shall perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the service request procedure is rejected </condition> <condition> with the GMM cause value #11. </condition> </condition> </control>
<control> <condition> <condition> For the EMM cause value #11, </condition> <condition> if the UE is operating in single-registration mode, </condition> </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the service request procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> <condition> For the EMM cause value #35, </condition> <condition> if the UE is operating in single-registration mode, </condition> </condition> the UE shall in addition <end_state> set the 5GMM state to 5GMM-DEREGISTERED, </end_state> <action> 5GS update status to 5U3 ROAMING NOT ALLOWED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
<control> <condition> #12 (Tracking area not allowed); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list and eKSI. </action> <end_state> The UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE. </end_state> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". </action> <control> <condition> If the SERVICE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message. </action> </control> </control>
<control> <condition> <condition> If the UE initiated service request for mobile originated CS fallback </condition> and <condition> a CS fallback cancellation request was not received, </condition> </condition> <action> then the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer. </action> </control> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the service request procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the service request procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #13 (Roaming not allowed in this tracking area); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). </action> <end_state> The UE shall enter the state EMM-REGISTERED.PLMN-SEARCH. </end_state> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" </action> and <action> remove the current TAI from the stored TAI list if present. </action> <control> <condition> If the SERVICE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. </action> </control> <action> The UE shall perform a PLMN selection according to 3GPP TS 23.122 . </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the service request procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the service request procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #15 (No suitable cells in tracking area); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). </action> <end_state> The UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE. </end_state> <action> The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" </action> and <action> remove the current TAI from the stored TAI list if present. </action> <control> <condition> If the SERVICE REJECT message is not integrity protected, </condition> <action> the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. </action> </control> </control>
<control> <condition> <condition> If the UE initiated service request for mobile originated CS fallback </condition> and <condition> a CS fallback cancellation request was not received, </condition> </condition> <action> then the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer. </action> </control> </control>
<control> <condition> <condition> If the service request was not initiated </condition> <condition> for mobile originated CS fallback, </condition> </condition> <action> the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 . </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the service request procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 </action> <condition> for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value. </condition> </control>
<control> <condition> #18 (CS domain not available); </condition> </control>
<control> <condition> If the request was related to CS fallback, </condition> <action> the UE shall send an indication to the MM sublayer and shall not attempt CS fallback </action> <condition> until combined tracking area updating procedure has been successfully completed. </condition> <end_state> The UE shall enter the state EMM-REGISTERED.NORMAL-SERVICE. </end_state> <action> The UE shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <condition> <condition> If the UE is in CS/PS mode 1 of operation with "IMS voice not available" </condition> and <condition> the request was related to CS fallback, </condition> </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology </action> and <action> disable the E-UTRA capability (see subclause 4.5). </action> </control>
<control> <condition> If the UE is in CS/PS mode 1 or CS/PS mode 2 mode of operation, </condition> <action> the UE may provide a notification to the user or the upper layers that the CS domain is not available. </action> </control>
<control> <condition> If the request was related to 1xCS fallback, </condition> <action> the UE shall cancel upper layer actions related to 1xCS fallback </action> and <end_state> enter the state EMM-REGISTERED.NORMAL-SERVICE. </end_state> </control>
<control> <condition> #22 (Congestion); </condition> </control>
<control> <condition> <condition> If the T3346 value IE is present in the SERVICE REJECT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> <action> the UE shall proceed as described below, </action> </control> <control> <condition> otherwise </condition> <action> it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.6.1.6. </action> </control>
<control> <condition> If the rejected request was not for initiating a PDN connection for emergency bearer services, </condition> <action> the UE shall abort the service request procedure </action> and <end_state> enter state EMM-REGISTERED, </end_state> and <control> <action> stop timer T3417, T3417ext or T3417ext-mt </action> <condition> if still running. </condition> </control> <control> <action> The UE shall stop timer T3346 </action> <condition> if it is running. </condition> </control> </control>
<control> <condition> If the SERVICE REJECT message is integrity protected, </condition> <action> the UE shall start timer T3346 with the value provided in the T3346 value IE. </action> </control>
<control> <condition> If the SERVICE REJECT message is not integrity protected, </condition> <action> the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 . </action> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback </condition> </condition> and <condition> a CS fallback cancellation request was not received, </condition> </condition> <action> the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer. </action> </control> </control>
NOTE 8: <control> <condition> If the UE disables the E-UTRA capability, </condition> then subsequent mobile terminating calls could fail. </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback for emergency call </condition> </condition> and <condition> a CS fallback cancellation request was not received, </condition> </condition> <action> the UE may attempt to select GERAN or UTRAN radio access technology. </action> <action> It then proceeds with appropriate MM and CC specific procedures. </action> <action> The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback, </condition> </condition> <action> the UE shall select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS procedures. </action> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback for emergency call, </condition> </condition> <action> the UE may select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS procedures. </action> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> in EMM-CONNECTED mode </condition> <condition> <condition> with Control plane service type "mobile originating request" </condition> and <condition> with the "active" flag set to 1, </condition> </condition> </condition> <action> the UE shall abort the procedure. </action> </control>
<control> <condition> <condition> If the service request procedure was initiated </condition> <condition> for an MO MMTEL voice call is started, </condition> </condition> <action> a notification that the service request was not accepted due to congestion shall be provided to the upper layers. </action> </control>
NOTE 9: This can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP TS 24.173 ).
<control> <condition> For all other cases </condition> <action> the UE stays in the current serving cell and applies normal cell reselection process. </action> <control> <action> The service request procedure is started, </action> <condition> <condition> if still necessary, </condition> <condition> <condition> when timer T3346 expires </condition> or <condition> is stopped. </condition> </condition> </condition> </control> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the service request procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> </control>
<control> <condition> <condition> If the UE is using EPS services with control plane CIoT EPS optimization </condition> and <condition> <condition> if the T3448 value IE is present in the SERVICE REJECT message </condition> and <condition> the value indicates that this timer is neither zero nor deactivated, </condition> </condition> </condition> the UE shall: <control> a) <action> stop timer T3448 </action> <condition> if it is running; </condition> </control> <action> b) consider the transport of user data via the control plane as unsuccessful; </action> and <control> c) <action> start timer T3448: </action> <control> <action> with the value provided in the T3448 value IE </action> <condition> if the SERVICE REJECT message is integrity protected; </condition> </control> or <control> <action> with a random value from the default range specified in table 10.2.1 </action> <condition> if the SERVICE REJECT message is not integrity protected. </condition> </control> </control> </control>
<control> <condition> <condition> If the UE is using EPS services with control plane CIoT EPS optimization </condition> and <condition> <condition> if the T3448 value IE is present in the SERVICE REJECT message </condition> and <condition> the value indicates that this timer is either zero or deactivated, </condition> </condition> </condition> <action> the UE shall ignore the T3448 value IE </action> and- <control> <action> stop timer T3448 </action> <condition> if it is running; </condition> </control> and <action> consider the transport of user data via the control plane as unsuccessful. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters, 5GMM state and 5GS update status as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the service request procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #25 (Not authorized for this CSG); </condition> </control>
<control> <action> EMM cause #25 is only applicable </action> <condition> when received from a CSG cell. </condition> </control> <control> <condition> EMM cause #25 received from a non-CSG cell </condition> <action> is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.6. </action> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED </action> (and <action> store it according to subclause 5.1.3.3). </action> <end_state> The UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE. </end_state> </control>
<control> <condition> If the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Allowed CSG list, </condition> <action> the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list. </action> </control>
<control> <condition> If the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Operator CSG list, </condition> <action> the UE shall apply the procedures defined in 3GPP TS 23.122 subclause 3.1A. </action> <action> The UE shall search for a suitable cell according to 3GPP TS 36.304 . </action> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the service request procedure is rejected </condition> <condition> with the GMM cause with the same value. </condition> </condition> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> the UE shall in addition <end_state> set the 5GMM state to 5GMM- REGISTERED </end_state> and <action> set the 5GS update status to 5U3 ROAMING NOT ALLOWED. </action> </control>
<control> <condition> #31 (Redirection to 5GCN required); </condition> </control>
<control> <condition> <condition> EMM cause #31 received by a UE </condition> <condition> that has not indicated support for CIoT optimizations </condition> </condition> <action> is considered as an abnormal case </action> and <action> the behaviour of the UE is specified in subclause 5.6.1.6. </action> <action> The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). </action> <action> The UE shall reset the service request attempt counter </action> and <end_state> shall enter the state EMM- REGISTERED.LIMITED-SERVICE. </end_state> <control> <action> The UE shall enable N1 mode capability for 3GPP access </action> <condition> if it was disabled </condition> </control> and <action> disable the E-UTRA capability </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <action> the UE shall in addition handle the 5GMM parameters, 5GMM state, and 5GS update status as specified in 3GPP TS 24.501 </action> <condition> for the case <condition> when the service request procedure performed over 3GPP access is rejected </condition> <condition> with the 5GMM cause with the same value. </condition> </condition> </control>
<control> <condition> #39 (CS service temporarily not available); </condition> </control>
<control> <condition> If the T3442 value received in the SERVICE REJECT message is not zero, </condition> <action> the UE shall start timer T3442 </action> and <end_state> enter the state EMM-REGISTERED.NORMAL-SERVICE. </end_state> </control> <control> <condition> If the T3442 value received in the SERVICE REJECT message is zero, </condition> <action> the UE shall not start timer T3442. </action> </control>
<control> <action> The UE shall not try to send an EXTENDED SERVICE REQUEST message for mobile originating CS fallback to the network, </action> <condition> except for mobile originating CS fallback for emergency calls, until timer T3442 expires or the UE sends a TRACKING AREA UPDATE REQUEST message. </condition> </control>
<control> <condition> #40 (No EPS bearer context activated); </condition> </control>
<control> <end_state> The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. </end_state> <action> The UE shall delete any mapped EPS security context or partial native EPS security context. </action> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback </condition> </condition> and <condition> a CS fallback cancellation request was not received, </condition> </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures </action> and <action> the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer. </action> </control> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback, </condition> </condition> <action> the UE shall select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS procedures. </action> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback </condition> </condition> and <condition> <condition> the UE has dual Rx/Tx configuration </condition> and <condition> supports enhanced 1xCS fallback, </condition> </condition> </condition> <action> the UE shall perform a new attach procedure. </action> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> for any reason other than CS fallback or 1x CS fallback, </condition> </condition> <action> the UE shall perform a new attach procedure. </action> </control>
NOTE 10: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <action> the UE shall handle the GMM state as specified in 3GPP TS 24.008 </action> <condition> for the case <condition> when the service request procedure is rejected </condition> <condition> with the GMM cause value #10 "Implicitly detached". </condition> </condition> </control>
A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services in the network.
<control> <condition> A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation </condition> <action> shall set the update status to U2 NOT UPDATED. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED. </end_state> </control>
<control> <condition> #42 (Severe network failure); </condition> </control>
<control> <action> The UE shall set the EPS update status to EU2 NOT UPDATED, </action> and <action> shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs. </action> <action> The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 . </action> <control> <condition> While this timer is running, </condition> <action> the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. </action> </control> <end_state> The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 . </end_state> </control>
<control> <condition> If A/Gb mode or Iu mode is supported by the UE, </condition> <end_state> the UE shall in addition set the GMM state to GMM- DEREGISTERED, </end_state> <action> GPRS update status to GU2 NOT UPDATED, </action> <action> MM update status to U2 NOT UPDATED </action> and <action> shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number, LAI, TMSI and ciphering key sequence number. </action> </control>
<control> <condition> If the UE is operating in single-registration mode, </condition> <end_state> the UE shall in addition set the 5GMM state to 5GMM- DEREGISTERED, </end_state> <action> 5GS update status to 5U2 NOT UPDATED, </action> and <action> shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. </action> </control>
Other values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in subclause 5.6.1.6.
5.6.1.5A Service request procedure for initiating a PDN connection for emergency bearer services not accepted by the network
<control> <condition> If the service request <condition> for initiating a PDN connection for emergency bearer services </condition> cannot be accepted by the network, </condition> <action> the UE shall perform the procedures as described in subclause 5.6.1.5. </action> <control> <condition> Then <condition> if the UE is in the same selected PLMN </condition> <condition> where the last service request was attempted, </condition> </condition> the UE shall: <action> a) inform the upper layers of the failure of the procedure; </action> or <action> b) detach locally, if not detached already, attempt EPS attach for emergency bearer services. </action> </control> </control> NOTE 1: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> If the service request <condition> for initiating a PDN connection for emergency bearer services </condition> fails due to abnormal case a) in subclause 5.6.1.6, </condition> <action> the UE shall perform the actions as described in subclause 5.6.1.6 and inform the upper layers of the failure to access the network. </action> </control>
NOTE 2: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
<control> <condition> If the service request <condition> for initiating a PDN connection for emergency bearer services </condition> fails due to abnormal cases b), c) or e) in subclause 5.6.1.6, </condition> <action> the UE shall perform the procedures as described in subclause 5.6.1.6. </action> <control> <condition> Then <condition> if the UE is in the same selected PLMN </condition> <condition> where the last service request was attempted, </condition> </condition> the UE shall: <action> a) inform the upper layers of the failure of the procedure; </action> or <action> b) detach locally, if not detached already, attempt EPS attach for emergency bearer services. </action> </control> </control> NOTE 3: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN.
5.6.1.5B Service request procedure for UE attached for access to RLOS not accepted by the network
<control> <condition> If the service request <condition> for UE attached for access to RLOS </condition> cannot be accepted by the network, </condition> <action> the UE shall perform the procedures as described in subclause 5.6.1.5. </action> <control> <condition> Then if: <condition> a) <condition> the UE is in the same selected PLMN </condition> <condition> where the last service request was attempted and rejected; </condition> </condition> <condition> b) <condition> the service request procedure was rejected </condition> <condition> with an EMM cause value other than #9, #10 and #40; </condition> </condition> and <condition> c) timer T3346 is not running, </condition> </condition> the UE shall: a) <control> <action> detach locally, </action> <condition> if not detached already, </condition> </control> and <action> perform a PLMN selection according to 3GPP TS 23.122 to attempt EPS attach for access to RLOS via another PLMN. </action> </control> </control>
<control> <condition> If the service request <condition> for UE attached for access to RLOS </condition> fails due to abnormal cases a), b), c) or e) in subclause 5.6.1.6, </condition> <action> the UE shall perform the procedures as described in subclause 5.6.1.6. </action> <control> <condition> Then <condition> if the UE is in the same selected PLMN </condition> <condition> where the last service request was attempted, </condition> </condition> the UE shall: a) <control> <action> detach locally, </action> <condition> if not detached already, </condition> </control> and <action> perform a PLMN selection according to 3GPP TS 23.122 to attempt EPS attach for access to RLOS via another PLMN. </action> </control> </control>
5.6.1.6 Abnormal cases in the UE
The following abnormal cases can be identified:
<control> <condition> a) <condition> Access barred </condition> <condition> because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without "Extended wait time" received from lower layers </condition> </condition> </control>
<control> <condition> <condition> In WB-S1 mode, </condition> <condition> <condition> if the service request procedure is started </condition> <condition> in response to a paging request from the network, </condition> </condition> </condition> <action> access class barring, EAB or ACDC is not applicable. </action> </control>
<control> <condition> <condition> In NB-S1 mode, </condition> <condition> <condition> if the service request procedure is started </condition> <condition> in response to a paging request from the network, </condition> </condition> </condition> <action> access barring is not applicable. </action> </control>
<control> <condition> <condition> If the trigger for the service request procedure is the response to a paging request from the network </condition> and <condition> the NAS signalling connection establishment is rejected by the network, </condition> </condition> <action> the service request procedure shall not be started. </action> <action> The UE stays in the current serving cell and applies normal cell reselection process. </action> <control> <condition> During an implementation dependent time period, </condition> <action> the service request procedure may be started </action> <condition> <condition> when access for "terminating calls" is granted </condition> or <condition> upon a cell change. </condition> </condition> </control> </control>
<control> <condition> <condition> If the service request was initiated for CS fallback </condition> and <condition> the access is barred for "mobile originating CS fallback" (see 3GPP TS 36.331 ) </condition> and <condition> the lower layer indicates "the barring is due to CSFB specific access barring information", </condition> </condition> <action> the service request procedure shall not be started. </action> <action> The UE stays in the current serving cell and applies normal cell reselection process. </action> <control> <action> The service request procedure may be started </action> <condition> if it is still necessary, i.e. when access for "mobile originating CS fallback" is granted or because of a cell change. </condition> </control> </control>
<control> <condition> <condition> If the service request was initiated for CS fallback </condition> and <condition> a CS fallback cancellation request was not received </condition> and <condition> the access is barred for "mobile originating CS fallback" (see 3GPP TS 36.331 ) </condition> and <condition> the lower layer does not indicate "the barring is due to CSFB specific access barring information", </condition> </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures </action> and <action> the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer. </action> </control> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback </condition> </condition> and <condition> the access is barred for "originating calls" (see 3GPP TS 36.331 ), </condition> </condition> <action> the UE shall select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS procedures. </action> </control>
<control> <condition> <condition> If the lower layer indicated the access was barred </condition> <condition> because of access class barring for "originating calls" (see 3GPP TS 36.331 ) </condition> and <condition> if: <condition> a) <condition> <condition> the service request is initiated </condition> <condition> due to a request from upper layers for user plane radio resources, </condition> </condition> and <condition> <condition> the MO MMTEL voice call is started, </condition> <condition> the MO MMTEL video call is started </condition> or <condition> the MO SMSoIP is started; </condition> </condition> </condition> <condition> b) <condition> the service request is initiated </condition> <condition> due to a mobile originated SMS over NAS or SMS over S102; </condition> </condition> or <condition> c) <condition> the service request is initiated </condition> <condition> due to a request from upper layers for user plane radio resources, </condition> <condition> ACDC is applicable to the request and the UE supports ACDC. </condition> </condition> </condition> </condition> <action> then the service request procedure shall be started. </action> The call type used shall be per annex D of this document. </control>
NOTE 1: <control> <condition> <condition> If more than one of MO MMTEL voice call is started, </condition> <condition> MO MMTEL video call is started </condition> <condition> or MO SMSoIP is started conditions are satisfied, </condition> </condition> it is left to UE implementation to determine the call type based on annex D of this document. </control>
<control> <condition> <condition> If access is barred for a certain ACDC category (see 3GPP TS 36.331 ), </condition> and <condition> if the upper layers request user plane radio resources for a higher ACDC category </condition> and <condition> the UE supports ACDC, </condition> </condition> <action> then the service request procedure shall be started. </action> </control>
<control> <condition> <condition> If an access request for an uncategorized application is barred due to ACDC (see 3GPP TS 36.331 ), </condition> and <condition> if the upper layers request user plane radio resources for a certain ACDC category </condition> and <condition> the UE supports ACDC, </condition> </condition> <action> then the service request procedure shall be started. </action> </control>
<control> <condition> Otherwise: </condition> <control> a) <condition> <condition> In WB-S1 mode, </condition> <condition> if access is barred for "originating calls" (see 3GPP TS 36.331 ), </condition> </condition> <action> the service request procedure shall not be started. </action> <action> The UE stays in the current serving cell and applies normal cell reselection process. </action> <control> <action> The service request procedure may be started </action> <condition> <condition> if it is still necessary <condition> when access for "originating calls" is granted </condition> </condition> or <condition> because of a cell change. </condition> </condition> </control> </control> <control> b) <control> <condition> <condition> In NB-S1 mode, </condition> <condition> if access is barred for "originating calls" (see 3GPP TS 36.331 ), </condition> </condition> <action> the service request procedure shall not be started. </action> <action> The UE stays in the current serving cell </action> and <action> applies normal cell reselection process. </action> <action> Further UE behaviour is implementation specific, e.g. the service request procedure is started again after an implementation dependent time; </action> </control> or <control> <condition> <condition> in NB-S1 mode, </condition> <condition> if access is barred for "originating calls" (see 3GPP TS 36.331 ), </condition> and <condition> a request for an exceptional event is received from the upper layers, </condition> </condition> <action> then the service request procedure shall be started. </action> </control> </control> </control>
NOTE 2: <control> <condition> In NB-S1 mode, </condition> the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 ). </control>
<control> <condition> b) <condition> Lower layer failure </condition> or <condition> <condition> release of the NAS signalling connection </condition> <condition> without "Extended wait time", </condition> <condition> without "Extended wait time CP data", </condition> and <condition> without redirection indication received from lower layers </condition> <condition> <condition> before the service request procedure is completed (see subclause 5.6.1.4) </condition> or <condition> before SERVICE REJECT message is received </condition> </condition> </condition> </condition> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback </condition> </condition> and <condition> a CS fallback cancellation request was not received, </condition> </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures </action> and <action> the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, </action> and <action> the UE shall also set the EPS update status to EU2 NOT UPDATED </action> and <end_state> enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE. </end_state> </control> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback </condition> </condition> and <condition> a CS fallback cancellation request was received, </condition> </condition> <action> the UE shall set the EPS update status to EU2 NOT UPDATED </action> and <end_state> enter the state EMM- REGISTERED.ATTEMPTING-TO-UPDATE. </end_state> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback, </condition> </condition> the UE shall either: <action> a) attempt to select cdma2000 1x radio access technology and proceed with appropriate cdma2000 1x CS procedures. </action> <control> <condition> If the UE fails to select cdma2000 1x radio access technology, </condition> <action> the UE shall set the EPS update status to EU2 NOT UPDATED </action> and <end_state> enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE; </end_state> </control> or b) <action> set the EPS update status to EU2 NOT UPDATED </action> and <end_state> enter the state EMM-REGISTERED.ATTEMPTING- TO-UPDATE, </end_state> and <action> perform cell selection according to 3GPP TS 36.304 . </action> </control>
<control> <condition> <condition> If the service request was not initiated </condition> <condition> for CS fallback or 1xCS fallback, </condition> </condition> <end_state> the UE shall enter state EMM- REGISTERED. </end_state> <action> The UE shall abort the service request procedure, </action> <action> stop timer T3417, T3417ext or T3417ext-mt </action> and <action> locally release any resources allocated for the service request procedure. </action> </control>
<control> <condition> c) T3417 expired: </condition> </control>
<control> <end_state> The UE shall enter the state EMM-REGISTERED. </end_state> </control>
<control> <condition> <condition> If the UE triggered the service request procedure </condition> <condition> in EMM-IDLE mode </condition> <condition> in order to obtain packet services, </condition> </condition> <action> then the EMM sublayer shall increment the service request attempt counter, </action> <action> abort the procedure </action> and <action> release locally any resources allocated for the service request procedure. </action> <control> <action> The service request counter shall not be incremented, </action> <condition> if: <condition> a) <condition> the service request procedure is initiated </condition> <condition> to establish a PDN connection for emergency bearer services; </condition> </condition> <condition> b) <condition> the UE has a PDN connection for emergency bearer services established; </condition> <condition> c) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> <condition> d) <condition> the service request is initiated </condition> <condition> in response to paging from the network; </condition> </condition> or <condition> e) the UE <condition> in NB-S1 mode </condition> <condition> is requested by the upper layer to transmit user data related to an exceptional event </condition> and <condition> the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ). </condition> </condition> </condition> </condition> </control> </control>
<control> <condition> If the service request attempt counter is greater than or equal to 5, </condition> <action> the UE shall start timer T3325 (see 3GPP TS 24.008 ). </action> <control> <condition> Additionally <condition> if the service request was initiated </condition> <condition> for an "originating MMTEL voice" call type, </condition> </condition> <action> a notification that the service request was not accepted and that timer T3325 is running shall be provided to the upper layers. </action> </control> </control>
NOTE 3: This can result in the upper layers requesting establishment of a CS voice call (if not already attempted in the CS domain), or other implementation specific mechanisms (see 3GPP TS 24.173 ).
<control> <action> The UE shall not attempt service request until expiry of timer T3325 </action> <condition> unless: <condition> a) the service request is initiated in response to paging from the network; </condition> <condition> b) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> <condition> c) the service request is initiated to establish a PDN connection for emergency bearer services; </condition> <condition> d) the UE has a PDN connection for emergency bearer services established; </condition> <condition> e) the UE is registered in a new PLMN; </condition> or <condition> f) the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ). </condition> </condition> </control>
<control> <condition> <condition> If the service request for "originating MMTEL voice" call type was triggered </condition> <condition> while T3325 is running, </condition> </condition> <action> a notification that the service request was not accepted and that timer T3325 is running shall be provided to the upper layers. </action> </control>
NOTE 4: This can result in the upper layers requesting establishment of a CS voice call (if not already attempted in the CS domain), or other implementation specific mechanisms (see 3GPP TS 24.173 ).
NOTE 5: <control> <action> The NAS signalling connection can also be released </action> <condition> if the UE deems that the network has failed the authentication check as specified in subclause 5.4.2.7. </condition> </control>
<control> <condition> <condition> If the UE triggered the service request procedure </condition> <condition> in order to obtain services other than packet services from EMM-IDLE mode, </condition> </condition> <action> then the EMM sublayer shall abort the procedure </action> and <action> release locally any resources allocated for the service request procedure. </action> </control>
<control> <condition> <condition> If the UE triggered the service request procedure </condition> <condition> in EMM-CONNECTED mode, </condition> </condition> <action> the EMM sublayer shall abort the procedure </action> and <action> consider the service request procedure with "active" flag set or the 1xCS fallback procedure as failed. </action> <action> The UE shall stay in EMM-CONNECTED mode. </action> </control>
<control> <condition> d) T3417ext or T3417ext-mt expired </condition> </control>
<control> <condition> If a CS fallback cancellation request was not received, </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures </action> and <action> the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, </action> and <action> the UE shall also set the EPS update status to EU2 NOT UPDATED </action> and <end_state> enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE. </end_state> </control> </control>
<control> <condition> If a CS fallback cancellation request was received </condition> <action> the UE shall set the EPS update status to EU2 NOT UPDATED </action> and <end_state> enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE. </end_state> </control>
<control> <condition> e) SERVICE REJECT received, other EMM cause values than those treated in subclause 5.6.1.5, and cases of EMM cause values #22, #25 and #31 if considered as abnormal cases according to subclause 5.6.1.5. </condition> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback </condition> </condition> and <condition> a CS fallback cancellation request was not received, </condition> </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures </action> and <action> the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, </action> and <action> the UE shall also set the EPS update status to EU2 NOT UPDATED </action> and <end_state> enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE. </end_state> </control> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback </condition> </condition> and <condition> a CS fallback cancellation request was received, </condition> </condition> <action> the UE shall set the EPS update status to EU2 NOT UPDATED </action> and <end_state> enter the state EMM- REGISTERED.ATTEMPTING-TO-UPDATE. </end_state> </control>
<control> <condition> If the service request was initiated for 1xCS fallback, </condition> <action> the UE shall select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS procedures. </action> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback </condition> </condition> and <condition> the UE has dual Rx/Tx configuration </condition> and <condition> supports enhanced 1xCS fallback, </condition> </condition> <condition> then upon entering EMM-IDLE mode </condition> <action> the UE shall perform tracking area updating procedure. </action> </control>
<control> <condition> <condition> If the service request was not initiated </condition> <condition> for CS fallback or 1xCS fallback, </condition> </condition> <end_state> the UE shall enter state EMM- REGISTERED. </end_state> <action> The UE shall abort the service request procedure, </action> <action> stop timer T3417, T3417ext or T3417ext-mt </action> and <action> locally release any resources allocated for the service request procedure. </action> </control>
<control> <condition> f) Tracking area updating procedure is triggered: </condition> </control>
<control> <action> The UE shall abort the service request procedure, </action> <control> <action> stop timer T3417, T3417ext or T3417ext-mt </action> <condition> if running </condition> </control> and <action> perform the tracking area updating procedure. </action> <action> The "active" flag shall be set in the TRACKING AREA UPDATE REQUEST message. </action> <control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback or 1xCS fallback, </condition> </condition> and <condition> the CS fallback cancellation request was not received, </condition> </condition> <action> the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection </action> <condition> after the completion of the tracking area updating procedure. </condition> </control> </control>
<control> <condition> g) Switch off: </condition> </control>
<control> <start_state> If the UE is in state EMM-SERVICE-REQUEST-INITIATED </start_state> <condition> at switch off, </condition> <action> the detach procedure shall be performed. </action> </control>
<control> <condition> h) Detach procedure collision: </condition> </control>
<control> <condition> <condition> EPS detach containing detach type "re-attach required": </condition> <condition> If the UE receives a DETACH REQUEST message from the network </condition> </condition> <start_state> in state EMM-SERVICE-REQUEST- INITIATED, </start_state> the UE shall take the following actions: <control> a) <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback, </condition> </condition> <action> the UE shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM, CC and GMM specific procedures </action> and <action> the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer; </action> </control> </control> <control> b) <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback, </condition> </condition> <action> the UE shall attempt to select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS procedures; </action> </control> or <control> c) <condition> <condition> If the service request was not initiated </condition> <condition> for CS fallback or 1xCS fallback, </condition> </condition> <action> the detach procedure shall be progressed </action> and <action> the service request procedure shall be aborted. </action> </control> </control>
<control> <condition> <condition> EPS detach containing detach type "re-attach not required": </condition> <condition> If the UE receives a DETACH REQUEST message from the network </condition> </condition> <start_state> in state EMM-SERVICE-REQUEST- INITIATED, </start_state> the UE shall take the following actions: <control> a) <condition> If the DETACH REQUEST message contains an EMM cause other than #2 "IMSI unknown in HSS" or no EMM cause IE, </condition> <action> the detach procedure shall be progressed and the service request procedure shall be aborted. </action> <control> <condition> Additionally, <condition> if the service request was initiated </condition> <condition> for CS fallback or 1xCS fallback, </condition> <condition> but not for CS fallback for emergency call or 1xCS fallback for emergency call, </condition> </condition> <action> the EMM sublayer shall indicate to the MM sublayer or the cdma2000 upper layers that the CS fallback or 1xCS fallback procedure has failed; </action> </control> </control> or <control> b) <condition> If the DETACH REQUEST message contains EMM cause #2 "IMSI unknown in HSS", </condition> <action> the UE will follow the procedure as described below for the detach type "IMSI detach". </action> </control> </control>
<control> <condition> <condition> EPS detach containing detach type "IMSI detach": </condition> <condition> If the UE receives a DETACH REQUEST message from the network </condition> </condition> <start_state> in state EMM-SERVICE-REQUEST- INITIATED, </start_state> the UE shall take the following actions: <control> a) <condition> <condition> if the service request was initiated </condition> <condition> for SMS over NAS or CS fallback, </condition> <condition> but not for CS fallback for emergency call, </condition> </condition> <action> the UE shall abort the service request procedure and progress the detach procedure; </action> </control> or <control> b) <condition> otherwise </condition> <action> the UE shall progress both procedures. </action> </control> </control>
<control> <condition> i) <condition> Transmission failure of SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message indication </condition> <condition> with TAI change from lower layers: </condition> </condition> </control>
<control> <condition> If the current TAI is not in the TAI list, </condition> <action> the service request procedure shall be aborted to perform the tracking area updating procedure. </action> <action> The "active" flag shall be set in the TRACKING AREA UPDATE REQUEST message. </action> <control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback or 1xCS fallback, </condition> </condition> and <condition> the CS fallback cancellation request was not received, </condition> </condition> <action> the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection </action> <condition> after the completion of the tracking area updating procedure. </condition> </control> <control> <condition> If the current TAI is still part of the TAI list, </condition> <action> the UE shall restart the service request procedure. </action> </control> </control>
<control> <condition> j) <condition> Transmission failure of SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message indication </condition> <condition> without TAI change from lower layers: </condition> </condition> </control>
<control> <action> The UE shall restart the service request procedure. </action> </control>
<control> <condition> k)Default or dedicated bearer set up failure: </condition> </control>
<control> <condition> If the lower layers indicate a failure to set up a radio bearer, </condition> <action> the UE shall locally deactivate the EPS bearer as described in subclause 6.4.4.6. </action> </control>
<control> <condition> l) "Extended wait time" from the lower layers: </condition> </control>
<control> <action> The UE shall abort the service request procedure, </action> <end_state> enter state EMM-REGISTERED, </end_state> and <control> <action> stop timer T3417, T3417ext or T3417ext-mt </action> <condition> if still running. </condition> </control> </control>
<control> <condition> If the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", </condition> <action> the UE shall start timer T3346 with the "Extended wait time" value. </action> </control>
<control> <condition> If the SERVICE REQUEST message was sent by a UE configured for NAS signalling low priority, </condition> <action> the UE shall start timer T3346 with the "Extended wait time" value. </action> </control>
<control> <condition> <condition> If the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority" </condition> or <condition> <condition> if the SERVICE REQUEST message was sent by a UE </condition> <condition> not configured for NAS signalling low priority, </condition> <condition> the UE is operating in NB-S1 mode </condition> and <condition> the UE is not a UE configured to use AC11 15 in selected PLMN, </condition> </condition> </condition> <action> then the UE shall start timer T3346 with the "Extended wait time" value. </action> </control>
<control> <condition> In other cases </condition> <action> the UE shall ignore the "Extended wait time". </action> <action> The UE stays in the current serving cell </action> and <action> applies normal cell reselection process. </action> <control> <action> The service request procedure is started, </action> <condition> if still necessary, </condition> <condition> <condition> when timer T3346 expires </condition> or <condition> is stopped. </condition> </condition> </control> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback </condition> </condition> and <condition> a CS fallback cancellation request was not received, </condition> </condition> <action> the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures </action> and <action> the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer. </action> </control> </control>
NOTE 5: <control> <condition> If the UE disables the E-UTRA capability, </condition> then subsequent mobile terminating calls could fail. </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> for CS fallback for emergency call </condition> </condition> and <condition> a CS fallback cancellation request was not received, </condition> </condition> <action> the UE may attempt to select GERAN or UTRAN radio access technology. </action> <action> It then proceeds with appropriate MM and CC specific procedures. </action> <action> The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback, </condition> </condition> <action> the UE shall select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS procedures. </action> </control>
<control> <condition> <condition> If the service request was initiated </condition> <condition> for 1xCS fallback for emergency call, </condition> </condition> <action> the UE may select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS procedures. </action> </control>
<control> <condition> <condition> <condition> If the service request was initiated </condition> <condition> due to a request from the SMS entity to send an SMS </condition> </condition> and <condition> timer T3246 is not running, </condition> </condition> the UE, <condition> if operating in CS/PS mode 1 of operation, </condition> <action> may select GERAN or UTRAN radio access technology. </action> <action> It then proceeds with the appropriate MM procedure. </action> </control>
NOTE 6: <control> <condition> If the UE disables the E-UTRA capability, </condition> then subsequent mobile terminating calls could fail. </control>
<control> <condition> la) "Extended wait time CP data" from the lower layers: </condition> </control>
<control> <action> The UE shall abort the service request procedure for transfer of user data via the control plane, </action> <end_state> enter state EMM- REGISTERED, </end_state> and <control> <action> stop timer T3417 </action> <condition> if still running. </condition> </control> </control>
<control> <condition> <condition> If the UE is operating in NB-S1 mode </condition> and <condition> supports the timer T3448, </condition> </condition> <action> the UE shall start the timer T3448 with the "Extended wait time CP data" value. </action> </control> <control> <condition> <condition> If the UE is operating in NB-S1 mode </condition> and <condition> does not support the timer T3448, </condition> </condition> <action> the UE shall start the timer T3346 with the "Extended wait time CP data" value. </action> </control> <control> <condition> In other cases </condition> <action> the UE shall ignore the "Extended wait time CP data". </action> <action> The UE stays in the current serving cell </action> and <action> applies normal cell reselection process. </action> <control> <action> The service request procedure for transfer of user data via the control plane is started, </action> <condition> <condition> if still necessary, </condition> <condition> <condition> when the timer T3448 expires </condition> or <condition> is stopped. </condition> </condition> </condition> </control> </control>
<control> <condition> m) Timer T3346 is running: </condition> </control>
<control> <action> The UE shall not start the service request procedure </action> <condition> unless: <condition> a) the UE receives a paging; </condition> <condition> b) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> <condition> c) <condition> the UE has a PDN connection for emergency bearer services established </condition> or <condition> is establishing a PDN connection for emergency bearer services; </condition> </condition> <condition> d) the UE is requested by the upper layer for a CS fallback for emergency call or a 1xCS fallback for emergency call; </condition> <condition> e) <condition> <condition> the UE has a PDN connection established without the NAS signalling low priority indication </condition> or <condition> is establishing a PDN connection without the NAS signalling low priority indication </condition> </condition> and <condition> <condition> if the timer T3346 was started </condition> <condition> due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST) </condition> <condition> which contained the low priority indicator set to "MS is configured for NAS signalling low priority"; </condition> </condition> </condition> or <condition> f) the UE <condition> in NB-S1 mode </condition> <condition> is requested by the upper layer to transmit user data related to an exceptional event </condition> </condition> and: <condition> g) the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in NASCONFIG 3GPP TS 31.102 ); </condition> and <condition> h) <condition> timer T3346 was not started </condition> <condition> when NAS signaling connection was established with RRC establishment cause set to "MO exception data". </condition> </condition> </condition> </control>
<control> <condition> If the UE is in EMM-IDLE mode, </condition> <action> the UE stays in the current serving cell and applies normal cell reselection process. </action> <control> <action> The service request procedure is started, </action> <condition> <condition> if still necessary, </condition> <condition> <condition> when timer T3346 expires </condition> or <condition> is stopped. </condition> </condition> </condition> </control> </control>
<control> <condition> Upon upper layer's request for a mobile originated CS fallback which is not for emergency call, </condition> <action> the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. </action> <control> <condition> If the UE finds a suitable GERAN or UTRAN cell, </condition> <action> it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control> <control> <condition> Otherwise </condition> <action> the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer. </action> </control> </control>
NOTE 7: <control> <condition> If the UE disables the E-UTRA capability, </condition> then subsequent mobile terminating calls could fail. </control>
<control> <condition> Upon upper layer's request for a CS fallback for emergency call, </condition> <action> the UE may select GERAN or UTRAN radio access technology. </action> <action> It then proceeds with appropriate MM and CC specific procedures. </action> <action> The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. </action> </control>
<control> <condition> <condition> Upon a request from the SMS entity to send an SMS </condition> and <condition> timer T3246 is not running, </condition> </condition> <condition> the UE, if operating in CS/PS mode 1 of operation, </condition> <action> may select GERAN or UTRAN radio access technology. </action> <action> It then proceeds with the appropriate MM procedure. </action> </control>
NOTE 8: <control> <condition> If the UE disables the E-UTRA capability, </condition> then subsequent mobile terminating calls could fail. </control>
<control> <condition> <condition> Upon upper layer's request for a mobile originated 1x CS fallback </condition> <condition> which is not for emergency call, </condition> </condition> <action> the UE shall select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS call procedures. </action> </control>
<control> <condition> Upon upper layer's request for a 1xCS fallback for emergency call, </condition> <action> the UE may select cdma2000 1x radio access technology. </action> <action> The UE then proceeds with appropriate cdma2000 1x CS call procedures. </action> </control>
<control> <condition> <condition> If the service request procedure was triggered </condition> <condition> for an MO MMTEL voice call is started, </condition> </condition> <action> a notification that the service request procedure was not initiated due to congestion shall be provided to the upper layers. </action> </control>
NOTE 9: This can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP TS 24.173 ).
<control> <condition> n) Failure to find a suitable GERAN or UTRAN cell, </condition> </control>
<control> <condition> after release of the NAS signalling connection </condition> <condition> without "Extended wait time" </condition> and <condition> with redirection indication received from lower layers </condition> <condition> <condition> when the service request was initiated </condition> <condition> for CS fallback: </condition> </condition> <action> The EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, </action> and <action> the UE shall also set the EPS update status to EU2 NOT UPDATED </action> and <end_state> enter the state EMM- REGISTERED.ATTEMPTING-TO-UPDATE. </end_state> <action> The UE shall abort the service request procedure, </action> <action> stop timer T3417ext or T3417ext-mt </action> and <action> locally release any resources allocated for the service request procedure. </action> </control>
<control> <condition> o) Timer T3448 is running: </condition> </control>
<control> <action> The UE in EMM-IDLE mode shall not initiate the service request procedure for transport of user data via the control plane </action> <condition> unless: <condition> a) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> <condition> b) the UE which is only using EPS services with control plane CIoT EPS optimization received a paging; </condition> or <condition> c) the UE <condition> in NB-S1 mode </condition> <condition> is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ). </condition> </condition> </condition> <action> The UE stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> </control>
<control> <condition> p) Timer T3447 is running: </condition> </control>
<control> <action> The UE shall not start any service request procedure </action> <condition> unless: <condition> a) the UE receives a paging; </condition> <condition> b) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> <condition> c) <condition> the UE has a PDN connection for emergency bearer services established </condition> or <condition> is establishing a PDN connection for emergency bearer services. </condition> </condition> </condition> <action> The UE stays in the current serving cell </action> and <action> applies the normal cell reselection process. </action> <control> <action> The service request procedure is started, </action> <condition> if still necessary, </condition> <condition> when timer T3447 expires. </condition> </control> </control>
5.6.1.7 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> <condition> a)Lower layer failure: </condition> </control>
<control> <condition> If a lower layer failure occurs </condition> <condition> before <condition> a SERVICE REJECT message has been sent to the UE </condition> or <condition> the service request procedure has been completed by the network, </condition> </condition> <action> the network enters/stays in EMM-IDLE. </action> </control>
<control> <condition> b) Protocol error: </condition> </control>
<control> <condition> If the SERVICE REQUEST, EXTENDED SERVICE REQUEST or the CONTROL PLANE SERVICE REQUEST message is received with a protocol error, </condition> <action> the network shall return a SERVICE REJECT message with one of the following EMM cause values: #96: invalid mandatory information; #99: information element non-existent or not implemented; #100: conditional IE error; or #111: protocol error, unspecified. </action> <action> The network stays in the current EMM mode. </action> </control>
<control> <condition> c) <condition> More than one SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST received </condition> <condition> before the procedure has been completed (i.e., before SERVICE REJECT message has been sent or service request procedure has been completed): </condition> </condition> </control>
<control> a) <condition> If one or more of the information elements in the SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST for packet services differs from the ones received within the previous SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message for packet services, </condition> <action> the previously initiated service request procedure shall be aborted and the new service request procedure shall be progressed; </action> </control> NOTE: The network actions are implementation dependent for the case that more than one EXTENDED SERVICE REQUEST messages for CS fallback or 1xCS fallback are received and their information elements differ. <control> b) <condition> If the information elements do not differ, </condition> <action> then the network shall continue with the previous service request procedure </action> and <action> shall not treat any further this SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message. </action> </control>
<control> <condition> d) ATTACH REQUEST received </condition> </control>
<control> <condition> before <condition> a SERVICE REJECT message has been sent </condition> or <condition> the service request procedure has been completed: </condition> </condition> <condition> <condition> If an ATTACH REQUEST message is received </condition> and <condition> <condition> the service request procedure has not been completed </condition> or <condition> a SERVICE REJECT message has not been sent, </condition> </condition> </condition> <action> the network may initiate the EMM common procedures, e.g. the EMM authentication procedure. </action> <control> <condition> The network may e.g. after a successful EMM authentication procedure execution, </condition> <action> abort the service request procedure, </action> <action> delete the EMM context, EPS bearer contexts, if any, </action> and <action> progress the new ATTACH REQUEST. </action> </control> </control>
<control> <condition> e) <condition> TRACKING AREA UPDATE REQUEST message received </condition> <condition> before <condition> the service request procedure has been completed </condition> or <condition> a SERVICE REJECT message has been sent </condition> </condition> </condition> </control>
<control> <condition> <condition> If a TRACKING AREA UPDATE REQUEST message is received </condition> and <condition> <condition> the service request procedure has not been completed </condition> or <condition> a SERVICE REJECT message has not been sent, </condition> </condition> </condition> <action> the network may initiate the EMM common procedures, e.g. the EMM authentication procedure. </action> <control> <condition> The network may e.g. after a successful EMM authentication procedure execution, </condition> <action> abort the service request procedure and progress the tracking area updating procedure. </action> </control> </control>
<control> <condition> f) <condition> Default or dedicated bearer set up failure: </condition> <condition> If the lower layers indicate a failure to set up a radio or S1 bearer, </condition> </condition> <action> the MME shall locally deactivate the EPS bearer as described in subclause 6.4.4.6. </action> </control>
5.6.2 Paging procedure
5.6.2.1 General
The paging procedure is used by the network to request the establishment or resumption of a NAS signalling connection to the UE. Another purpose of the paging procedure is to prompt the UE to reattach if necessary as a result of a network failure. <control> <condition> <condition> If the UE is not attached </condition> <condition> when it receives a paging for EPS services, </condition> </condition> <action> the UE shall ignore the paging. </action> </control>
Additionally, the network can use the paging procedure to initiate the mobile terminating CS fallback procedure or SMS or user data transfer via the MME.
5.6.2.2 Paging for EPS services
5.6.2.2.1 Paging for EPS services through E-UTRAN using S-TMSI
5.6.2.2.1.1 General
<control> <action> The network shall initiate the paging procedure for EPS services </action> <action> using S-TMSI </action> <action> with CN domain indicator set to "PS" </action> <condition> <condition> when NAS signalling messages, cdma2000 signalling messages or user data is pending to be sent to the UE </condition> <condition> when no NAS signalling connection exists(see example in figure 5.6.2.2.1.1). </condition> </condition> </control>
<control> <condition> For the UE using eDRX, </condition> <action> the network initiates the paging procedure </action> <condition> <condition> when NAS signalling messages, cdma2000 signalling messages or user data is pending to be sent to the UE </condition> <condition> within the paging time window. </condition> </condition> </control> <control> <condition> <condition> <condition> If NAS signalling messages, cdma2000 signalling messages or user data is pending to be sent to the UE </condition> <condition> outside the paging time window </condition> </condition> and <condition> the eDRX value that the network provides to the UE in the Extended DRX parameters IE during the last attach procedure or the last tracking area updating procedure is not all zeros (i.e. the E-UTRAN eDRX cycle length duration is higher than 5.12 seconds), </condition> </condition> <action> the network initiates the paging procedure at T time ahead of the beginning of the next paging time window. </action> </control>
NOTE 1: T time is a short time period based on implementation. The operator can take possible imperfections in the synchronization between the CN and the UE into account when choosing T time.
<control> <condition> To initiate the procedure </condition> <action> the EMM entity in the network requests the lower layer to start paging </action> (see 3GPP TS 36.300 , 3GPP TS 36.413 ) and <action> shall start the timer </action> : <control> <action> a) T3415 for this paging procedure, </action> <condition> <condition> if the network accepted to use eDRX for the UE </condition> and <condition> the UE does not have a PDN connection for emergency bearer services. </condition> </condition> </control> <control> b) <condition> Otherwise, </condition> <action> T3413 for this paging procedure. </action> </control> </control>
<control> <condition> If the network starts timer T3415, </condition> <action> the network shall set timer T3415 to a value smaller than the value of timer T3- RESPONSE </action> (see 3GPP TS 29.274 for further details on timer T3-RESPONSE). </control>
The EMM entity may provide the lower layer with a list of CSG IDs, including the CSG IDs of both the expired and the not expired subscriptions. <control> <condition> If there is a PDN connection for emergency bearer services established, </condition> <action> the EMM entity in the network shall not provide the list of CSG IDs to the lower layer. </action> </control>
<control> <condition> If the negotiated UE paging probability information is available in the EMM context of the UE, </condition> <action> the EMM entity shall provide the lower layer with the negotiated UE paging probability information (see 3GPP TS 36.300 , 3GPP TS 36.413 ). </action> </control>
<control> <condition> Upon reception of a paging indication, </condition> <condition> if control plane CIoT EPS optimization is not used by the UE, </condition> <control> <action> the UE shall stop the timer T3346, </action> <condition> if running, </condition> </control> and <action> shall initiate: a) a service request procedure to respond to the paging (see 3GPP TS 23.401 and 3GPP TS 36.413 ); or b) a tracking area updating procedure as specified in subclauses 5.5.3.2.2 and 5.5.3.3.2. </action> and <control> additionally <condition> <condition> if the UE is in the EMM-IDLE mode </condition> <condition> with suspend indication, </condition> </condition> <action> resume the suspended NAS signalling connection to the MME as specified in subclause 5.3.1.3. </action> </control> </control>
<control> <condition> Upon reception of a paging indication, </condition> <condition> if control plane CIoT EPS optimization is used by the UE, </condition> <control> <action> the UE shall stop the timer T3346, </action> <condition> if running, </condition> </control> and shall additionally: <control> a) <action> initiate a service request procedure as specified in subclause 5.6.1.2.2 </action> <condition> if the UE is in the EMM-IDLE mode without suspend indication; </condition> </control> <action> b) initiate a tracking area updating procedure as specified in subclauses 5.5.3.2.2; </action> or <control> c) <action> proceed the behaviour as specified in subclause 5.3.1.3 </action> <condition> if the UE is in the EMM-IDLE mode with suspend indication. </condition> </control> </control>
NOTE 2: <control> <condition> <condition> <condition> If the UE is in the EMM-IDLE mode </condition> <condition> without suspend indication </condition> </condition> and <condition> <condition> has an uplink user data to be sent to the network </condition> <condition> using control plane CIoT EPS optimization </condition> <condition> when receiving the paging indication, </condition> </condition> </condition> <action> the UE can piggyback the uplink user data </action> <condition> during the service request procedure initiated to respond to the paging, </condition> as specified in subclause 5.6.1.2.2. </control>
<control> <condition> <condition> If the paging for EPS services was received </condition> <condition> during an ongoing UE-initiated EMM specific procedure or service request procedure, </condition> </condition> <action> then the UE shall ignore the paging. </action> <action> The network shall proceed with the EMM specific procedure or the service request procedure, </action> and <action> stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415). </action> </control> <control> <condition> <condition> If the network receives an ATTACH REQUEST message </condition> <condition> when the paging procedure is ongoing, </condition> </condition> <action> it should be considered as an abnormal case, </action> and the behaviour of the network for this case is specified in subclause 5.6.2.2.1.2. </control>
<control> <action> The network shall stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415) </action> <condition> <condition> <condition> when an integrity- protected response is received from the UE </condition> and <condition> successfully integrity checked by the network </condition> </condition> or <condition> when the EMM entity in the MME receives an indication from the lower layer that it has received the S1-AP UE context resume request message as specified in 3GPP TS 36.413 . </condition> </condition> </control> <control> <condition> <condition> If the response received is not integrity protected, </condition> or <condition> the integrity check is unsuccessful, </condition> </condition> <action> the timer for the paging procedure (i.e. either timer T3413 or timer T3415) shall be kept running </action> <condition> unless: <condition> a) the UE has a PDN connection for emergency bearer services; </condition> or <condition> b) <condition> the response received is a TRACKING AREA UPDATE REQUEST message </condition> and <condition> the security mode control procedure or authentication procedure performed <condition> during tracking area updating procedure </condition> has completed successfully. </condition> </condition> </condition> </control>
<control> <condition> Upon expiry of timer T3413, </condition> <action> the network may reinitiate paging. </action> </control>
<control> <condition> <condition> If the network, <condition> while waiting for a response to the paging sent without paging priority, </condition> receives downlink signalling or downlink data associated with priority EPS bearers, </condition> </condition> <action> the network shall stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415), </action> and <action> then initiate the paging procedure with paging priority. </action> </control>
<control> <condition> Upon expiry of timer T3415, </condition> <action> the network shall abort the paging procedure </action> and <action> shall proceed as specified in 3GPP TS 23.401 . </action> </control>
5.6.2.2.1.2 Abnormal cases on the network side
The following abnormal case can be identified:
a) <control> <condition> <condition> ATTACH REQUEST message received </condition> <condition> when paging procedure is ongoing. </condition> </condition> </control>
<control> <condition> <condition> If an integrity-protected ATTACH REQUEST message is received from the UE </condition> and <condition> successfully integrity checked by the network, </condition> </condition> <action> the network shall abort the paging procedure. </action> </control> <control> <condition> If the ATTACH REQUEST message received is not integrity protected, or the integrity check is unsuccessful, </condition> <action> the paging procedure shall be progressed. </action> </control> <control> <action> The paging procedure shall be aborted </action> <condition> when the EPS authentication procedure performed <condition> during attach procedure </condition> is completed successfully. </condition> </control>
5.6.2.2.1.3 Abnormal cases in the UE
The following abnormal case can be identified: a) The paging indication received for a UE that is attached for access to RLOS
<control> <condition> A UE attached for access to RLOS </condition> <action> shall ignore the paging indication from the network. </action> </control>
<control> b) <condition> <condition> The paging indication received </condition> <condition> when UE-initiated EMM specific procedure or service request procedure is ongoing. </condition> </condition> </control>
<control> <action> The UE shall ignore the paging indication from the network. </action> </control>
5.6.2.2.2 Paging for EPS services through E-UTRAN using IMSI
Paging for EPS services using IMSI is an abnormal procedure used for error recovery in the network.
<control> <action> The network may initiate paging for EPS services using IMSI with CN domain indicator set to "PS" </action> <condition> if the S-TMSI is not available due to a network failure (see example in figure 5.6.2.2.2.1). </condition> </control>
<control> <condition> In S1 mode, </condition> <condition> to initiate the procedure </condition> <action> the EMM entity in the network requests the lower layer to start paging. </action> <control> <condition> <condition> If the TAI list is not available </condition> <condition> due to a network failure, </condition> </condition> <action> the network may perform the paging within all tracking areas served by the MME (see 3GPP TS 36.331 and 3GPP TS 36.413 ). </action> </control> </control>
<control> <condition> <condition> When a UE receives a paging for EPS services </condition> <condition> using IMSI </condition> from the network <condition> before a UE initiated EMM specific procedure has been completed, </condition> </condition> <action> then the UE shall abort the EMM specific procedure </action> and <action> proceed according to the description in this subclause. </action> </control>
<control> <condition> <condition> Upon reception of a paging for EPS services </condition> <condition> using IMSI, </condition> </condition> <control> <action> the UE shall stop timer T3346, </action> <condition> if it is running, </condition> </control> <control> <action> locally deactivate any EPS bearer context(s), </action> <condition> if any, </condition> </control> and <action> locally detach from EPS. </action> <action> Additionally the UE shall delete the following parameters: last visited registered TAI, TAI list, GUTI and KSI . </action> <action> The UE shall set the EPS update status to EU2 NOT UPDATED </action> and <end_state> change the state to EMM-DEREGISTERED. </end_state> <action> The UE shall stop all timers T3396 that are running. </action> <control> <condition> After performing the local detach, </condition> <action> the UE shall then perform an attach procedure as described in subclause 5.5.1.2. </action> <control> <condition> If the UE is operating in CS/PS mode 1 or CS/PS mode 2 of operation, </condition> <action> then the UE shall perform a combined attach procedure as described in subclause 5.5.1.3. </action> </control> </control> </control>
NOTE 1: In some cases, user interaction can be required, thus the UE cannot activate the dedicated bearer context(s), if any, automatically.
NOTE 2: The UE does not respond to the paging except with the ATTACH REQUEST message, hence timers T3413 and T3415 in the network are not used when paging with IMSI.
5.6.2.3 Paging for CS fallback to A/Gb or Iu mode
5.6.2.3.1 General
<control> <action> The network may initiate the paging procedure for CS fallback </action> <condition> when the UE is IMSI attached for non-EPS services </condition> (see example in figure 5.6.2.3.1.1). </control>
<control> <condition> <condition> To initiate the procedure </condition> <condition> when no NAS signalling connection exists, </condition> </condition> <action> the EMM entity in the network requests the lower layer to start paging (see 3GPP TS 36.300 , 3GPP TS 36.413 ). </action> <action> The EMM entity may provide the lower layer with a list of CSG IDs, including the CSG IDs of both the expired and the not expired subscriptions. </action> <control> <condition> If there is a PDN connection for emergency bearer services established, </condition> <action> the EMM entity in the network shall not provide the list of CSG IDs to the lower layer. </action> </control> The paging message includes a UE Paging Identity set to either the UE's S-TMSI or the UE's IMSI, and a CN domain indicator set to "CS" in order to indicate that this is paging for CS fallback. </control>
NOTE: <control> <action> The timers T3413 and T3415 are not started in the network </action> <condition> <condition> when the paging procedure is initiated </condition> <condition> for CS fallback. </condition> </condition> </control>
<control> <condition> <condition> To notify the UE about an incoming mobile terminating CS service </condition> <condition> excluding SMS over SGs </condition> <condition> when a NAS signalling connection exists, </condition> </condition> <action> the EMM entity in the network shall send a CS SERVICE NOTIFICATION message. </action> <action> This message may also include CS service related parameters (e.g. Calling Line Identification, SS or LCS related parameters). </action> </control>
<control> <condition> Upon reception of a paging indication, </condition> <condition> a UE that is IMSI attached for non-EPS services </condition> <action> shall initiate a service request procedure or combined tracking area updating procedure as specified in subclause 5.5.3.3.2. </action> <control> <condition> <condition> If the paging is received </condition> <condition> in EMM-IDLE mode, </condition> </condition> <action> the UE shall respond immediately. </action> </control> <control> <condition> <condition> If the paging is received as a CS SERVICE NOTIFICATION message </condition> <condition> in EMM-CONNECTED mode, </condition> </condition> <action> the UE may request upper layers input i.e. to accept or reject CS fallback before responding with an EXTENDED SERVICE REQUEST. </action> </control> <action> The response is indicated in the CSFB response information element in the EXTENDED SERVICE REQUEST message in both EMM-IDLE and EMM-CONNECTED modes. </action> </control>
5.6.2.3.2 Abnormal cases in the UE
<control> <condition> <condition> A UE that requested "SMS only" </condition> <condition> in the combined attach procedure or combined tracking area updating procedure </condition> </condition> <action> may ignore the CS SERVICE NOTIFICATION message or the paging indication with the CN domain indicator set to "CS". </action> </control>
5.6.2.3.3 Abnormal cases on the network side
The following abnormal case can be identified: a) Void
<control> b) <condition> <condition> ATTACH REQUEST message received </condition> <condition> when paging procedure is ongoing. </condition> </condition> <control> <condition> <condition> If an integrity-protected ATTACH REQUEST message is received from the UE </condition> and <condition> successfully integrity checked by the network, </condition> </condition> <action> the network shall abort the paging procedure. </action> </control> <control> <condition> If the ATTACH REQUEST message received is not integrity protected, or the integrity check is unsuccessful, </condition> <action> the paging procedure shall be progressed. </action> </control> <control> <action> The paging procedure shall be aborted </action> <condition> when the EPS authentication procedure performed <condition> during attach procedure </condition> is completed successfully. </condition> </control> </control>
<control> c) <condition> <condition> TRACKING AREA UPDATE REQUEST message received </condition> <condition> in response to a CS SERVICE NOTIFICATION message. </condition> </condition> <control> <condition> <condition> If the network receives a TRACKING AREA UPDATE REQUEST message </condition> <condition> in response to a CS SERVICE NOTIFICATION message, </condition> </condition> <action> the network shall progress the tracking area updating procedure. </action> </control> </control>
NOTE: <control> <condition> After completion of the tracking area updating procedure </condition> <action> the UE can accept or reject the CS fallback by sending an EXTENDED SERVICE REQUEST message. </action> </control>
<control> d) <condition> <condition> DETACH REQUEST message received </condition> <condition> in response to a CS SERVICE NOTIFICATION message. </condition> </condition> <control> <condition> <condition> If the network receives a DETACH REQUEST message </condition> <condition> with detach type "IMSI detach" or "combined EPS/IMSI detach" </condition> <condition> in response to a CS SERVICE NOTIFICATION message, </condition> </condition> <action> the network shall progress the detach procedure. </action> </control> </control>
5.6.2.4 Paging for SMS
<control> <action> The network shall initiate the paging procedure </action> <condition> when it receives an incoming mobile terminating SMS to the UE </condition> <condition> if the UE is: <condition> a) IMSI attached for non-EPS services or for "SMS only"; </condition> or <condition> b) <condition> attached for EPS services with CIoT EPS optimization </condition> and <condition> the UE has requested "SMS only" </condition> and <condition> the UE is in NB-S1 mode, </condition> and <condition> no NAS signalling connection exists. </condition> </condition> </condition> </control>
<control> <condition> For the UE using eDRX, </condition> <control> <action> the network initiates the paging procedure </action> <condition> when an incoming mobile terminating SMS is received within the paging time window. </condition> </control> <control> <condition> <condition> <condition> If an incoming mobile terminating SMS is received </condition> <condition> outside the paging time window </condition> </condition> and <condition> the eDRX value that the network provides to the UE in the Extended DRX parameters IE during the last attach procedure or the last tracking area updating procedure is not all zeros (i.e. the E-UTRAN eDRX cycle length duration is higher than 5.12 seconds), </condition> </condition> <action> the network initiates the paging procedure at T time ahead of the beginning of the next paging time window. </action> </control> </control>
NOTE: T time is a short time period based on implementation. The operator can take possible imperfections in the synchronization between the CN and the UE into account when choosing T time.
<control> <condition> <condition> To initiate the procedure for SMS </condition> <condition> when no NAS signalling connection exists, </condition> </condition> <action> the EMM entity in the network requests the lower layer to start paging </action> (see 3GPP TS 36.413 ). <action> The paging message shall include a CN domain indicator set to "PS". </action> <control> <condition> If the paging message includes a UE Paging Identity set to the UE's S-TMSI, </condition> <action> the paging procedure is performed according to subclause 5.6.2.2.1. </action> </control> <control> <condition> If the paging message includes a UE Paging Identity set to the UE's IMSI, </condition> <action> the paging procedure is performed according to subclause 5.6.2.2.2. </action> </control> <action> The MME shall not start timers T3413 and T3415 for this procedure. </action> </control>
<control> <condition> If the negotiated UE paging probability information is available in the EMM context of the UE, </condition> <action> the EMM entity shall provide the lower layer with the negotiated UE paging probability information </action> (see 3GPP TS 36.300 , 3GPP TS 36.413 ). </control>
5.6.3 Transport of NAS messages procedure
5.6.3.1 General
<control> The purpose of the transport of NAS messages procedure is to carry SMS messages in an encapsulated form between the MME and the UE. The procedure may be initiated by the UE or the network and can only be used <condition> <condition> when the UE is attached for EPS services and non-EPS services or for EPS services and "SMS only", </condition> and <condition> the UE is in EMM- CONNECTED mode. </condition> </condition> </control>
NOTE 1: <control> <condition> If the UE is in EMM-IDLE mode and is using EPS services with control plane CIoT EPS optimization, </condition> <action> the UE transports the first SMS message by encapsulating it in the NAS message container IE in the Control Plane Service Request message. </action> </control>
NOTE 2: <control> <condition> <condition> When the UE is using EPS services </condition> <condition> with control plane CIoT EPS optimization, </condition> </condition> <action> the network can initiate downlink transport of NAS messages procedure </action> <condition> even if the UE does not have any PDN connections established. </condition> </control>
5.6.3.2 UE initiated transport of NAS messages
<control> <condition> Upon request from the SMS entity to send an SMS message, </condition> <action> the EMM entity in the UE initiates the procedure by sending an UPLINK NAS TRANSPORT message including the SMS message in the NAS message container IE. </action> </control>
NOTE: <control> <condition> <condition> When the UE is using for EPS services </condition> <condition> with control plane CIoT EPS optimization, </condition> </condition> <action> the UE can initiate uplink transport of NAS messages procedure </action> <condition> even if the UE does not any PDN connections established. </condition> </control>
5.6.3.3 Network initiated transport of NAS messages
<control> <condition> The network initiates the procedure </condition> <action> by sending a DOWNLINK NAS TRANSPORT message. </action> <condition> When receiving the DOWNLINK NAS TRANSPORT message, </condition> <action> the EMM entity in the UE shall forward the contents of the NAS message container IE to the SMS entity. </action> </control>
NOTE: <control> <condition> <condition> When the UE is using for EPS services </condition> <condition> with control plane CIoT EPS optimization, </condition> </condition> <action> the network can initiate downlink transport of NAS messages procedure </action> <condition> even if the UE does not any PDN connections established. </condition> </control>
5.6.3.4 Abnormal cases in the UE
The following abnormal case can be identified:
<control> a) <condition> Timer T3346 is running </condition> </control>
<control> <action> The UE shall not send an UPLINK NAS TRANSPORT message </action> <condition> unless: <condition> a) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> <condition> b) the UE has a PDN connection for emergency bearer services established; </condition> or <condition> c) <condition> the UE is configured for dual priority </condition> and <condition> has a PDN connection established without low access priority </condition> <condition> <condition> <condition> but the timer T3346 was started </condition> <condition> in response to NAS signalling request with low access priority. </condition> </condition> </condition> </condition> </condition> </control>
<control> <action> The UPLINK NAS TRANSPORT message can be sent, </action> <condition> if still necessary, </condition> <condition> <condition> when timer T3346 expires </condition> or <condition> is stopped. </condition> </condition> </control>
<control> b) <condition> Timer T3447 is running </condition> </control>
<control> <action> The UE shall not send an UPLINK NAS TRANSPORT message </action> <condition> <condition> when the UE is in EMM-CONNECTED mode </condition> <condition> after the UE attached without PDN connection, </condition> </condition> <condition> unless: <condition> a) the UE is a UE configured to use AC11 15 in the selected PLMN; </condition> or <condition> b) a network initiated signaling message has been received. </condition> </condition> </control>
<control> <action> The UPLINK NAS TRANSPORT message can be sent, </action> <condition> if still necessary, </condition> <condition> when timer T3447 expires. </condition> </control>
5.6.3.5 Abnormal cases on the network side
The following abnormal case can be identified: a) Lower layer indication of non-delivered NAS PDU
<control> <condition> If the DOWNLINK NAS TRANSPORT message is not delivered for any reason, </condition> <action> the MME may discard the message. </action> </control>
5.6.4 Generic transport of NAS messages procedure
5.6.4.1 General
<control> The purpose of the generic transport of NAS messages procedure is to carry protocol messages from various applications (e.g., an LCS application to send an LPP message or a location service message) in an encapsulated form between the MME and the UE. The procedure may be initiated by the UE or the network and can only be used <condition> <condition> when the UE is attached for EPS services </condition> and <condition> is in EMM-CONNECTED mode. </condition> </condition> </control>
5.6.4.2 UE initiated generic transport of NAS messages
<control> <condition> <condition> Upon request from an application to send a message </condition> <condition> encapsulated in the generic transport of NAS message, </condition> </condition> <action> the EMM entity in the UE initiates the procedure by sending an UPLINK GENERIC NAS TRANSPORT message including the corresponding message in the generic message container IE. </action> <action> The application may also request additional information to be included in the UPLINK GENERIC NAS TRANSPORT message in the Additional information IE. </action> The content, coding and interpretation of this information element are dependent on the particular application. <action> The UE shall indicate the application protocol using the generic transport in the corresponding generic message container type. </action> </control> <control> <condition> When receiving the UPLINK GENERIC NAS TRANSPORT message, </condition> <action> the EMM entity in the MME shall provide the contents of the generic message container IE and the generic message container type IE to the corresponding application. </action> <control> <condition> If included, </condition> <action> the EMM entity in the MME shall also provide the contents of the Additional information IE. </action> </control> </control>
5.6.4.3 Network initiated transport of NAS messages
<control> <condition> <condition> Upon request from an application to send a message </condition> <condition> encapsulated in the generic transport of NAS message, </condition> </condition> <action> the EMM entity in the MME initiates the procedure by sending a DOWNLINK GENERIC NAS TRANSPORT message including the corresponding message in the generic message container IE. </action> <action> The application may also request additional information to be included in the DOWNLINK GENERIC NAS TRANSPORT message in the Additional information IE. </action> The content, coding and interpretation of this information element are dependent on the particular application. <action> The MME shall indicate the application protocol using the generic transport in the corresponding generic message container type. </action> </control> <control> <condition> When receiving the DOWNLINK GENERIC NAS TRANSPORT message, </condition> <action> the EMM entity in the UE shall provide the contents of the generic message container IE and the generic message container type IE to the corresponding application. </action> <control> <condition> If included, </condition> <action> the EMM entity in the UE shall also provide the contents of the Additional information IE. </action> </control> </control>
5.6.4.4 Abnormal cases in the UE
The following abnormal case can be identified:
<control> a) <condition> Timer T3346 is running. </condition> </control>
<control> <action> The UE shall not send an UPLINK GENERIC NAS TRANSPORT message </action> <condition> unless: <condition> the UE is a UE configured to use AC11 15 in selected PLMN; </condition> <condition> the UE has a PDN connection for emergency bearer services established; </condition> or <condition> <condition> the UE is configured for dual priority </condition> and <condition> <condition> has a PDN connection established </condition> <condition> without low access priority </condition> <condition> <condition> but the timer T3346 was started </condition> <condition> in response to NAS signalling request with low access priority. </condition> </condition> </condition> </condition> </condition> </control>
<control> <action> The UPLINK GENERIC NAS TRANSPORT message can be sent, </action> <condition> if still necessary, </condition> <condition> <condition> when timer T3346 expires </condition> or <condition> is stopped. </condition> </condition> </control>
<control> b) <condition> Timer T3447 is running. </condition> </control>
<control> <action> The UE shall not send an UPLINK GENERIC NAS TRANSPORT message when the UE is in EMM- CONNECTED mode, </action> <condition> unless: <condition> a) the UE is a UE configured to use AC11 15 in the selected PLMN; </condition> <condition> b) the UE has a PDN connection for emergency bearer services established; </condition> or <condition> c) </condition> a network initiated signaling message has been received. </condition> </control>
<control> <action> The UPLINK GENERIC NAS TRANSPORT message can be sent, </action> <condition> if still necessary, </condition> <condition> when timer T3447 expires. </condition> </control>
5.6.4.5 Abnormal cases on the network side
The following abnormal case can be identified:
<control> <condition> a) Lower layer indication of non-delivered NAS PDU </condition> </control>
<control> <condition> If the DOWNLINK GENERIC NAS TRANSPORT message is not delivered for any reason, </condition> <action> the MME may discard the message. </action> </control>
5.7 Reception of an EMM STATUS message by an EMM entity
The purpose of the sending of the EMM STATUS message is to report at any time certain error conditions detected upon receipt of EMM protocol data. The EMM STATUS message can be sent by both the MME and the UE (see example in figure 5.7.1).
<control> <condition> On receipt of an EMM STATUS message </condition> <action> no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. </action> <action> The local actions to be taken by the MME or the UE on receipt of an EMM STATUS message are implementation dependent. </action> </control>
UE MME EMM STATUS OR EMM STATUS
6 Elementary procedures for EPS session management
6.1 Overview
6.1.1 General
This clause describes the procedures used for EPS session management (ESM) at the radio interface (reference point "LTE-Uu").
The main function of the ESM sublayer is to support the EPS bearer context handling in the UE and in the MME.
The ESM comprises procedures for: a) the activation, deactivation and modification of EPS bearer contexts; b) the request for resources (IP connectivity to a PDN or dedicated bearer resources) by the UE; and c) the transport of user data via the control plane between the UE and the MME.
Each EPS bearer context represents an EPS bearer between the UE and a PDN. <control> <action> EPS bearer contexts can remain activated </action> even if <condition> the radio and S1 bearers constituting the corresponding EPS bearers between UE and MME are temporarily released. </condition> </control>
An EPS bearer context can be either a default bearer context or a dedicated bearer context.
<control> <action> A default EPS bearer context is activated </action> when <condition> the UE requests a connection to a PDN. </condition> </control>
<control> Generally, <action> ESM procedures can be performed </action> only if <condition> <condition> an EMM context has been established between the UE and the MME, </condition> and <condition> the secure exchange of NAS messages has been initiated by the MME by use of the EMM procedures described in clause 5. </condition> 	 </condition> </control> <control> <action> The first default EPS bearer context, however, can be activated </action> <condition> during the EPS attach procedure (see subclause 4.2). </condition> </control> <control> <condition> <condition> Once the UE is successfully attached, </condition> and <condition> the first default EPS bearer context has been activated during or after the attach procedure, </condition> </condition> <action> the UE can request the MME to set up connections to additional PDNs. </action> </control> <control> <condition> For each additional connection, </condition> <action> the MME will activate a separate default EPS bearer context. </action> </control> <control> <action> A default EPS bearer context remains activated </action> <condition> throughout the lifetime of the connection to the PDN. </condition> </control>
A dedicated EPS bearer context is always linked to a default EPS bearer context and represents additional EPS bearer resources between the UE and the PDN. <control> The network can <action> initiate the activation of dedicated EPS bearer contexts together with the activation of the default EPS bearer context or at any time later, </action> <condition> as long as the default EPS bearer context remains activated. </condition> </control> <control> However, <action> the network shall not initiate a dedicated bearer context activation procedure for established PDN connection(s) of "non IP" PDN type. </action> </control>
Default and dedicated EPS bearer contexts can be modified. Dedicated EPS bearer contexts can be released without affecting the default EPS bearer context. <control> <condition> When the default EPS bearer context is released, </condition> then <action> all dedicated EPS bearer contexts linked to it are released </action> too. </control>
The UE can request the network to allocate, modify or release EPS bearer resources. The network can fulfil such a request from the UE by activating a new dedicated EPS bearer context, modifying an EPS bearer context or deactivating an EPS bearer context.
6.1.2 Types of ESM procedures
Two types of ESM procedures can be distinguished: 1) Procedures related to EPS bearer contexts: <control> <action> These procedures are initiated by the network </action> and are used for the manipulation of EPS bearer contexts: a) default EPS bearer context activation; b) dedicated EPS bearer context activation; c) EPS bearer context modification; d) EPS bearer context deactivation. </control>
<control> <action> This procedure is initiated by the network or by the UE </action> and is used for the transport of user data via the control plane: a) transport of user data via the control plane procedure. </control>
2) Transaction related procedures: <control> <action> These procedures are initiated by the UE </action> to request for resources, </control> i.e. a new PDN connection or dedicated bearer resources, or to release these resources: a) PDN connectivity procedure; b) PDN disconnect procedure; c) bearer resource allocation procedure; d) bearer resource modification procedure.
<control> <action> This procedure is initiated by the ProSe UE-to-network relay </action> and is used for the manipulation of EPS bearer contexts: a) remote UE report. </control>
<control> <condition> When combined with the attach procedure, </condition> <action> the PDN connectivity procedure can trigger the network </action> to execute the following transaction related procedure: a) ESM information request procedure. </control>
<control> <condition> <condition> When combined with the attach procedure, </condition> if <condition> EMM-REGISTERED without PDN connection is supported by the UE </condition> and <condition> the network and no PDN connectivity procedure is initiated during the attach procedure, </condition> </condition> <action> the UE or the network executes the following transaction related procedure: a) ESM dummy message procedure. </action> </control>
<control> <action> A successful transaction related procedure initiated by the UE triggers the network to execute one of the procedures related to EPS bearer contexts. </action> </control> <control> <action> The UE treats the start of the procedure related to the EPS bearer context as completion of the transaction related procedure. </action> </control>
<control> <condition> During procedures related to EPS bearer contexts, </condition> <action> the MME and the UE shall not initiate the transport of user data via the control plane procedure until the ongoing procedure is completed. </action> </control>
NOTE 1: The UE determination of the completion of the transport of user data via the control plane procedure is left to the implementation.
NOTE 2: NAS signalling prioritization with respect to the transport of user data via the control plane cannot be guaranteed in the downlink direction in this version of the specification.
<control> Except for the remote UE report procedure and ESM information request procedure, <condition> during transaction related procedures, </condition> the MME and the UE shall not initiate the transport of user data via the control plane procedure <action> until the ongoing procedure is completed. </action> </control>
The following ESM procedures can be related to an EPS bearer context or to a procedure transaction: a) ESM status procedure; b) notification procedure.
6.1.3 ESM sublayer states
6.1.3.1 General
In this subclause the possible states of EPS bearer contexts in the UE and on the network side are described. Each EPS bearer context is associated with an individual state.
6.1.3.2 ESM sublayer states in the UE
6.1.3.2.1 BEARER CONTEXT INACTIVE
No EPS bearer context exists.
6.1.3.2.2 BEARER CONTEXT ACTIVE
The EPS bearer context is active in the UE.
6.1.3.2.3 PROCEDURE TRANSACTION INACTIVE
No procedure transaction exists.
6.1.3.2.4 PROCEDURE TRANSACTION PENDING
The UE has initiated a procedure transaction towards the network.
6.1.3.3 ESM sublayer states in the MME
6.1.3.3.1 BEARER CONTEXT INACTIVE
No EPS bearer context exists.
6.1.3.3.2 BEARER CONTEXT ACTIVE PENDING
The network has initiated an EPS bearer context activation towards the UE.
6.1.3.3.3 BEARER CONTEXT ACTIVE
The EPS bearer context is active in the network.
6.1.3.3.4 BEARER CONTEXT INACTIVE PENDING
The network has initiated an EPS bearer context deactivation towards the UE.
6.1.3.3.5 BEARER CONTEXT MODIFY PENDING
The network has initiated an EPS bearer context modification towards the UE.
ER ACTIVAATCET CIDVOEANFTTAEEU DXCLETTOD RENoICPrET ASEJET XBECTEDT RA EREPJAESCC BTTEIVAARTEETCR IODV EANFTTAEEU XCDLTOET RND EoETICPrEQASXUT TBEE ESRDATE ERQPEUSRE BSETARER ACTIVACTOEAN CDTTEEIVXDCATIOCT ANAECTT DCEEorEXED FTP EA TAPUCSLC TBE EEPAPTRS EBRE ARER AC
6.1.3.3.6 PROCEDURE TRANSACTION INACTIVE
No procedure transaction exists.
6.1.3.3.7 PROCEDURE TRANSACTION PENDING
The network has initiated a procedure transaction towards the UE.
6.1.4 Coordination between ESM and SM
Extended EPS QoS IE, then the bit rates signalled with this IE are also applicable to the R99 QoS.
NOTE 2: Some networks not supporting mobility from S1 mode to A/Gb mode or Iu mode or both do not provide the UE with the GERAN/UTRAN parameters. However, for this case there is no need for the UE to perform mapping to GERAN/UTRAN parameters (i.e. the PDP contexts cannot be transferred to A/Gb mode or Iu mode).
<control> <action> The MME performs the mapping from EPS to R99 QoS parameters </action> according to 3GPP TS 23.401 , annex E. </control>
<control> <condition> At inter-system change from S1 mode to A/Gb mode, </condition> <control> <action> SM shall not activate the PDP context(s) </action> if <condition> SM does not have the following parameters from the active EPS bearer context(s): a) LLC SAPI; b) radio priority; c) transaction identifier; and d) R99 QoS. </condition> </control> </control>
<control> <condition> At inter-system change from S1 mode to Iu mode, </condition> <control> <action> SM shall not activate the PDP context(s) </action> if <condition> SM does not have the following parameter from the active EPS bearer context(s): a) transaction identifier; and b) R99 QoS. </condition> </control> </control>
<control> <condition> For inter-system change from A/Gb mode or Iu mode to S1 mode, </condition> <control> <action> ESM uses the following parameters from each active PDP context: </action> a) NSAPI to map to EPS bearer identity; b) NSAPI of the default PDP context to map to linked EPS bearer identity; c) PDP address and APN of the default PDP context to map to PDN address and APN of the default EPS bearer context; d) TFT of the default PDP context, <condition> if any, </condition> to map to the TFT of the default EPS bearer context; and e) TFTs of the secondary PDP contexts to map to the TFTs of the dedicated EPS bearer contexts. </control> </control>
<control> <action> The MME and the UE perform the mapping from R99 to EPS QoS parameters </action> according to 3GPP TS 23.401 , annex E. </control> <control> In particular <action> the MME derives the APN-AMBR for the corresponding PDN connection from the MBR of the R99 subscribed QoS profile </action> and <action> the UE maps the MBR of its default PDP context to the APN-AMBR of the corresponding PDN connection. </action> </control>
6.1.4A Coordination between ESM and 5GSM
See subclause 6.1.4 in 3GPP TS 24.501 .
6.1.5 Coordination between ESM and EMM for supporting ISR
<control> <condition> The UE with its TIN set as "RAT-related TMSI" for which ISR is activated </condition> shall <action> change its TIN to "GUTI" to locally deactivate ISR </action> and <action> stop the periodic routing area update timer T3312 or T3323, </action> if <condition> running: <condition> a) upon modification of any EPS bearer context which was activated before the ISR is activated in the UE; </condition> <condition> b) at the time when the UE changes from S1 mode to A/Gb mode or Iu mode not due to PS handover procedure (see 3GPP TS 24.008 ), </condition> if <condition> any EPS bearer context activated after the ISR was activated in the UE exists; </condition> or <condition> a) upon deactivation of the last non-emergency EPS bearer context in the UE, </condition> if <condition> the UE has only a PDN connection for emergency bearer services remaining. </condition> </condition> </control>
<control> <action> ISR remains activated on the network side in the above cases. </action> </control>
6.2 IP address allocation
6.2.1 General
The UE can configure an IPv4 address during the establishment of a default EPS bearer context. <control> <action> The UE can obtain an IPv4 address or an IPv6 prefix or both </action> via an IETF-based IP address allocation mechanism once the default bearer is established. </control>
NOTE: From the perspective of the UE, the procedure used to allocate a static IP address via NAS signalling is the same as the procedure used to allocate a dynamic IP address specified in subclause 6.2.2.
<control> <condition> Upon deactivation of the default bearer of a PDN connection, </condition> <action> the UE shall locally release any IPv4 address or IPv6 prefix allocated to the UE for the corresponding PDN connection. </action> </control>
6.2.2 IP address allocation via NAS signalling
<control> <action> The UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message, </action> <condition> <condition> based on its IP stack configuration </condition> if <condition> it requests IP connectivity </condition> </condition> </control> (e.g. the per APN settings specified in 3GPP TS 23.401 ) as follows: <control> a)- <condition> A UE, which is IPv6 and IPv4 capable </condition> and <control> a) <condition> has not been allocated an IP address for this APN, </condition> shall <action> set the PDN type IE to IPv4v6. </action> </control> <control> b) <condition> <condition> has been allocated an IPv4 address for this APN </condition> and <condition> received the ESM cause #52 "single address bearers only allowed", </condition> and <condition> is requesting an IPv6 address, </condition> </condition> shall <action> set the PDN type IE to IPv6. </action> </control> <control> c) <condition> <condition> has been allocated an IPv6 address for this APN </condition> and <condition> received the ESM cause #52 "single address bearers only allowed", </condition> and <condition> is requesting an IPv4 address, </condition> </condition> shall <action> set the PDN type IE to IPv4. </action> </control> </control>
<control> b) A UE, <condition> which is only IPv4 capable, </condition> shall <action> set the PDN type IE to IPv4. </action> </control>
<control> c) A UE, <condition> which is only IPv6 capable, </condition> shall <action> set the PDN type IE to IPv6. </action> </control>
<control> d) <condition> When the IP version capability of the UE is unknown in the UE </condition> (as in the case when the MT and TE are separated and <condition> the capability of the TE is not known in the MT), </condition> the UE shall <action> set the PDN type IE to IPv4v6. </action> </control>
<control> If <condition> the UE wants to use DHCPv4 for IPv4 address assignment, </condition> it shall <action> indicate that to the network within the Protocol Configuration Options IE in the PDN CONNECTIVITY REQUEST. </action> </control>
<control> If <condition> the UE wants to get PDN connectivity for non-IP, </condition> the UE shall <action> set the PDN type IE in the PDN CONNECTIVITY REQUEST message to "non IP". </action> </control> <control> If <condition> the UE wants to get PDN connectivity for Ethernet, </condition> the UE shall <action> set the PDN type IE in the PDN CONNECTIVITY REQUEST message to "Ethernet". </action> </control>
<control> <condition> <condition> On receipt of the PDN CONNECTIVITY REQUEST message sent by the UE, </condition> <condition> the network when allocating an IP address </condition> </condition> shall <action> take into account the PDN type IE, the operator policies of the home and visited network, and the user's subscription data </action> and: <control> a) if <condition> <condition> the UE requests for PDN type IPv4v6, </condition> but <condition> the subscription is limited to IPv4 only or IPv6 only for the requested APN, </condition> </condition> the network shall <action> override the PDN type requested by the UE to be limited to a single address PDN type (IPv4 or IPv6). </action> </control> <control> <condition> In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, </condition> the network shall <action> set the PDN type value to either "IPv4" or "IPv6" </action> and <action> the ESM cause value to #50 "PDN type IPv4 only allowed", </action> or <action> #51 "PDN type IPv6 only allowed", respectively. </action> </control> <control> The UE shall <action> not subsequently initiate another UE requested PDN connectivity procedure to the same APN </action> to obtain a PDN type different from the one allowed by the network <condition> until: <condition> a) all EPS bearer contexts to the given APN are deactivated at the UE as a result of: <condition> i) EPS bearer context synchronization during tracking area updating or service request procedure; </condition> <condition> ii) an EPS bearer context deactivation procedure initiated by the network; </condition> <condition> iii) a local EPS bearer context deactivation without NAS signalling as specified in subclause 6.4.4.6; </condition> <condition> iv) a detach procedure; </condition> or <condition> v) a tracking area updating procedure or service request procedure that is rejected with a cause which results in the UE entering state EMM-DEREGISTERED; </condition> </condition> <condition> b) the PDN type which is used to access to the APN is changed; </condition> </condition> </control> NOTE 1: Request to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers. <control> a) if <condition> <condition> the UE requests PDN type IPv4v6, </condition> but <condition> the PDN GW configuration dictates the use of IPv4 addressing only or IPv6 addressing only for this APN, </condition> </condition> the network shall <action> override the PDN type requested by the UE to limit it to a single address PDN type (IPv4 or IPv6). </action> </control> <control> <condition> In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, </condition> the network shall <action> set the PDN type value to either "IPv4" or "IPv6" </action> and <action> the ESM cause value to #50 "PDN type IPv4 only allowed", </action> or <action> #51 "PDN type IPv6 only allowed", </action> respectively. </control> <control> The UE shall <action> not subsequently initiate another UE requested PDN connectivity procedure to the same APN </action> to obtain a PDN type different from the one allowed by the network <condition> until: <condition> a) all EPS bearer contexts to the given APN are deactivated at the UE and the network as a result of: <condition> i) EPS bearer context synchronization during tracking area updating or service request procedure; </condition> <condition> ii) an EPS bearer context deactivation procedure initiated by the network; </condition> <condition> iii) a local EPS bearer context deactivation without NAS signalling as specified in subclause 6.4.4.6; </condition> <condition> iv) a detach procedure; </condition> <condition> or v) a tracking area updating procedure or service request procedure that is rejected with a cause which results in the UE entering state EMM-DEREGISTERED ; </condition> <condition> b) the PDN type which is used to access to the APN is changed; </condition> </condition> </condition> </control> NOTE 2: Request to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers. <control> a) if <condition> <condition> the UE requests PDN type IPv4v6, </condition> but <condition> the operator uses single addressing per bearer, </condition> </condition> e.g. due to interworking with nodes of earlier releases, the network shall <action> override the PDN type requested by the UE to a single IP version only. </action> </control> <control> <condition> In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, </condition> the network shall <action> set the PDN type value to either "IPv4" or "IPv6" </action> and <action> the ESM cause value to #52 "single address bearers only allowed". </action> </control> <control> The UE should <action> subsequently request another PDN connection for the other IP version </action> using the UE requested PDN connectivity procedure to the same APN with a single address PDN type (IPv4 or IPv6) other than the one already activated; </control> NOTE 3: If the MT and TE are separated, the UE might not be able to use ESM cause #52 "single address bearers only allowed" as a trigger for activating a second single-IP-stack EPS bearer context. <control> b) if <condition> the network sets the PDN type to IPv4 or IPv4v6, </condition> the network shall <action> include an IPv4 address in the PDN address information. </action> </control> <control> <condition> <condition> In this case, </condition> if <condition> the IPv4 address is to be configured using DHCPv4, </condition> </condition> the network shall <action> set the IPv4 address to 0.0.0.0; </action> </control> and <control> c) if <condition> the network sets the PDN type to IPv6 or IPv4v6, </condition> the network shall <action> include the interface identifier that the UE shall use for the link local address in the PDN address information. </action> </control> </control>
<control> The network shall <action> include the PDN type and the PDN address information within the PDN address IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE. </action> </control>
6.2A IP header compression
<control> The UE and the MME <action> may support robust header compression (ROHC) framework (see IETF RFC 5795 ) </action> for IP header compression if <condition> control plane CIoT EPS optimization is supported for PDN connections of IP PDN type. </condition> </control> <control> If <condition> IP header compression for control plane CIoT EPS optimization is supported, </condition> <action> the ROHC profiles defined in 3GPP TS 36.323 may be supported. </action> </control> <control> <action> The ROHC configuration is negotiated and established </action> <condition> during the UE requested PDN connectivity procedure </condition> as specified in subclause 6.5.1. </control> Both the UE and the MME indicate whether IP header compression for control plane CIoT EPS optimization is supported during attach and tracking area updating procedures (see subclauses 5.5.1 and 5.5.3). <control> The ROHC configuration <action> can be re-negotiated </action> by using the UE requested bearer resource modification procedure or the EPS bearer context modification procedure as specified in subclauses 6.4.3 and 6.5.4. </control>
6.3 General on elementary ESM procedures
6.3.1 Services provided by lower layers
Unless explicitly stated otherwise, the procedures described in the following subclauses can only be executed whilst a NAS signalling exists between the UE and the MME.
6.3.2 Principles of address handling for ESM procedures
Transaction related procedures use the procedure transaction identity as address parameter in the ESM message header.
<control> <condition> When the UE or the network initiates a transaction related procedure, </condition> it shall <action> include a valid procedure transaction identity value in the message header </action> and <action> set the EPS bearer identity to "no EPS bearer identity assigned". </action> </control> <control> <condition> When the ProSe UE-to-network relay initiates the transaction related procedure remote UE report, </condition> it shall <action> include a valid procedure transaction identity value in the message header </action> and <action> set the EPS bearer identity to a valid EPS bearer identity value. </action> </control>
<control> If <condition> the response message is again a transaction related message, </condition> e.g. a PDN CONNECTIVITY REJECT, PDN DISCONNECT REJECT, BEARER RESOURCE ALLOCATION REJECT, BEARER RESOURCE MODIFICATION REJECT, ESM INFORMATION REQUEST message or ESM DUMMY MESSAGE from the network or an ESM INFORMATION RESPONSE message or ESM DUMMY MESSAGE from the UE, the sending entity shall <action> include the procedure transaction identity value received with the request message </action> and <action> set the EPS bearer identity to "no EPS bearer identity assigned" </action> (see examples in figures 6.3.2.1, 6.3.2.1a and 6.3.2.2). </control> <control> If <condition> the response message is the transaction related message REMOTE UE REPORT RESPONSE message from the network, </condition> the network shall <action> include the procedure transaction identity value received with the request message </action> and <action> set the EPS bearer identity to the EPS bearer identity value received from the ProSe UE-to-network relay (see example in figure 6.3.2.3). </action> </control>
<control> If <condition> an ESM DUMMY MESSAGE is sent in response to a received ESM DUMMY MESSAGE, </condition> the sending entity shall <action> include the received procedure transaction identity value in the message header </action> and <action> set the EPS bearer identity to "no EPS bearer identity assigned". </action> </control>
UE MME transaction related request (PTI = a, EBI = not assigned) transaction related reject (PTI = a, EBI = not assigned)
UE MME transaction related request (PTI = a, EBI = not assigned) network initiated transaction related request (PTI = a, EBI = not assigned)
initiated transaction related request
UE MME transaction related request (PTI = a, EBI = e) transaction related response (PTI = a, EBI = e)
EPS bearer context related procedures use the EPS bearer identity as address parameter in the ESM message header.
<control> <condition> When the network initiates an EPS bearer context related procedure, </condition> it shall <action> include a valid EPS bearer identity value in the message header. </action> </control> <control> The procedure transaction identity value shall <action> be set as follows: </action> <control> a) If <condition> the EPS bearer context related procedure was triggered by the receipt of a transaction related request message from the UE, </condition> the network shall <action> include the procedure transaction identity value received with the transaction related request message in the message header of the EPS bearer context related request message </action> cr (see example in figure 6.3.2.3). </control> <control> b) If <condition> the procedure was triggered network-internally, </condition> the network shall <action> set the procedure transaction identity value in the message header of the EPS bearer context related request message to "no procedure transaction identity assigned" </action> (see example in figure 6.3.2.4). </control> <control> c) If <condition> the procedure was triggered by the transport of user data via the control plane, </condition> the network shall <action> set the procedure transaction identity value in the message header of the EPS bearer context related request message to "no procedure transaction identity assigned" </action> (see example in figure 6.3.2.5). </control> </control>
<control> <condition> In the response message of the EPS bearer context related procedure, </condition> the UE shall <action> include the EPS bearer identity value received from the network and set the procedure transaction identity value to "no procedure transaction identity assigned". </action> </control>
<control> <condition> <condition> When the UE initiates an EPS bearer context related procedure </condition> and <condition> the procedure was triggered by the transport of user data via the control plane, </condition> </condition> it shall <action> include a valid EPS bearer identity value </action> and <action> set the procedure transaction identity value to "no procedure transaction identity assigned" in the message header </action> (see example in figure 6.3.2.6). </control>
UE MME transaction related request (PTI = a, EBI = unassigned) EPS bearer context related request (PTI = a, EBI = e) EPS bearer context related response (PTI = unassigned, EBI
UE MME EPS bearer context related request (PTI = unassigned, EBI = e)
data via the control plane UE MME EPS bearer context related request (PTI = unassigned, EBI = e)
via the control plane
6.3.3 Abnormal cases in the UE
The following abnormal case can be identified: a) ESM uplink message transmission failure indication by lower layers
<control> <condition> <condition> Unless the procedure descriptions in subclause 6.6 specify a different behaviour, </condition> the following applies: If <condition> lower layers indicate a TAI change, </condition> but <condition> the current TAI is not in the TAI list, </condition> </condition> <control> the ESM procedure shall <action> be aborted and re-initiated </action> <condition> after successfully performing a tracking area updating procedure. </condition> </control> </control>
<control> If <condition> <condition> lower layers indicate a TAI change, </condition> but <condition> the current TAI is still part of the TAI list, </condition> </condition> <action> it is up to the UE implementation how the ESM procedure is re-initiated. </action> </control>
<control> If <condition> lower layers indicate the TAI has not changed, </condition> <action> it is up to the UE implementation how the ESM procedure is re-initiated. </action> </control>
NOTE 1: <control> The ESM procedure can typically <action> be re-initiated using a retransmission mechanism of the uplink message </action> </control> (the one that has previously failed to be transmitted) with new sequence number and message authentication code information thus avoiding to restart the whole procedure.
The case a) above does not apply to the ESM INFORMATION RESPONSE message.
NOTE 2: <control> The ESM INFORMATION RESPONSE message can <action> not be subjected to a transmission failure by lower layers </action> due to handover as no handover message can be accepted by the UE prior to reception of the ATTACH ACCEPT message (see 3GPP TS 36.331 ). </control>
b) Transmission failure of the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message indication from EMM sublayer when the UE received any ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST messages during the attach procedure
It is up to the UE implementation how the dedicated EPS bearer context activation procedure is re-initiated.
NOTE 3: <control> The ESM procedure can typically <action> be re-initiated using a retransmission mechanism of the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message or ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message </action> . with new sequence number and message authentication code information thus avoiding to restart the whole procedure. </control>
6.3.4 Abnormal cases in the network
_MERGED_ <control> The following abnormal case can be identified: <condition> <condition> a) Lower layer indication of non-delivered NAS PDU due to handover </condition> <condition> Unless the procedure descriptions in subclause 6.4, 6.5 or 6.6 specify a different behaviour, </condition> the following applies: </condition> <control> If <condition> <condition> the downlink ESM NAS message could not be delivered due to an intra MME handover </condition> and <condition> the target TA is included in the TAI list, </condition> then <condition> upon successful completion of the intra MME handover </condition> </condition> the MME shall <action> retransmit the ESM message. </action> </control> <control> If <condition> <condition> a failure of the handover procedure is reported by the lower layer </condition> and <condition> the S1 signalling connection exists, </condition> </condition> the MME shall <action> retransmit the downlink ESM NAS message. </action> </control> </control>
_MERGED_ <control> <condition> b) Lower layer indication of non-delivered NAS PDU due to inter-eNodeB connected mode mobility when the transport of user data via the control plane is used </condition> <control> If <condition> <condition> the downlink ESM NAS message could not be delivered due to inter-eNodeB connected mode mobility </condition> and <condition> the MME is not changed, </condition> <condition> then upon successful completion of inter-eNodeB connected mode mobility </condition> </condition> the MME shall <action> retransmit the ESM message. </action> </control> <control> If <condition> <condition> a failure of inter-eNodeB connected mode mobility is reported by the lower layer </condition> and <condition> the S1 signalling connection exists, </condition> </condition> the MME shall <action> retransmit the downlink ESM NAS message. </action> </control> </control>
NOTE: <control> If <condition> <condition> the downlink ESM NAS message could not be delivered </condition> due to inter-eNodeB connected mode mobility and <condition> the MME is changed, </condition> </condition> <action> the retransmission of downlink ESM NAS message is not supported. </action> </control>
6.3.5 Handling of APN based congestion control
<control> The network may <action> detect </action> and <action> start performing the APN based congestion control </action> <condition> when one or more APN congestion criteria as specified in 3GPP TS 23.401 are met. </condition> </control> <control> The network may <action> store an APN congestion back-off time on a per UE and congested APN basis. </action> </control> <control> If <condition> the UE does not provide an APN for a non-emergency PDN connection, </condition> then the MME <action> uses the APN which is used in PDN GW selection procedure as congested APN. </action> </control> <control> <condition> When APN based congestion control is active, </condition> the network may <action> reject session management requests </action> except the modification of bearer resources requests from UEs or <action> disconnect existing PDN connections with ESM cause value #26 "insufficient resources". </action> </control>
<control> In the UE, EPS session management timers T3396 for APN based congestion control are <action> started and stopped on a per APN basis. </action> </control> <control> The APN associated with T3396 <action> is the APN </action> provided by the UE <condition> when the PDN connection is established. </condition> </control> <control> If <condition> <condition> no APN is included in the PDN CONNECTIVITY REQUEST </condition> or, <condition> when applicable, in the ESM INFORMATION RESPONSE message, </condition> </condition> then <action> T3396 is associated with no APN. </action> </control> <control> <condition> For this purpose </condition> the UE shall <action> memorize the APN provided to the network during the PDN connection establishment. </action> </control> <control> The timer T3396 associated with no APN will never <action> be started due to any ESM procedure related to an emergency PDN connection. </action> </control> <control> If <condition> the timer T3396 associated with no APN is running or deactivated, </condition> it does <action> not affect the ability of the UE to request an emergency PDN connection. </action> </control>
<control> If <condition> timer T3396 is running or is deactivated, </condition> the UE is allowed to <action> indicate change of the 3GPP PS data off UE status, </action> <action> initiate PDN disconnection procedure, </action> <action> initiate bearer resource modification procedure to release of bearer resources for the respective APN, </action> </control> and <control> if <condition> the UE is a UE configured to use AC11 15 in selected PLMN, </condition> then <action> the UE is allowed to initiate an attach procedure or any EPS session management procedure for the respective APN. </action> </control>
6.3.5A Handling of group specific session management congestion control
<control> The network may <action> detect </action> and <action> start performing the group specific session management congestion control </action> <condition> when one or more group congestion criteria as specified in 3GPP TS 23.401 are met. </condition> </control> <control> <condition> When group specific session management congestion control is active, </condition> the mechanism for APN based congestion control as specified in subclause 6.3.5 shall <action> be followed. </action> </control>
6.3.6 Handling of network rejection not due to APN based congestion control
<control> The network may <action> include a back-off timer value </action> in an EPS session management reject message to regulate the time interval at which the UE may retry the same procedure. </control> <control> <condition> For ESM cause values other than #26 "insufficient resources", </condition> the network may also <action> include the re-attempt indicator </action> to indicate whether the UE is allowed to re-attempt the corresponding session management procedure for the same APN in A/Gb or Iu mode or N1 mode after inter-system change. </control>
NOTE 1: <control> If <condition> the network includes this back-off timer value, </condition> then <action> the UE is blocked from sending another ESM request for the same procedure for the same PLMN and APN combination for the specified duration. </action> </control>
Therefore, the operator needs to exercise caution in determining the use of this timer value.
NOTE 2: <control> If <condition> the re-attempt indicator is not provided by the network, </condition> a UE registered in its HPLMN or in an EHPLMN can <action> use the configured SM_RetryAtRATChange value </action> specified in the NAS configuration MO or in the USIM NAS file to derive the re-attempt indicator as specified in subclauses 6.5.1.4.3, CONFIG </control>
<control> If <condition> re-attempt in A/Gb or Iu mode or N1 mode is allowed, </condition> the UE shall <action> consider the back-off timer to be applicable only to the EPS session management in S1 mode for the rejected EPS session management procedure and the given PLMN and APN combination. </action> </control> <control> If <condition> re-attempt in A/Gb and Iu mode and N1 mode is not allowed, </condition> the UE shall <action> consider the back- off timer to be applicable to all three NAS protocols, </action> i.e. applicable to the EPS session management in S1 mode for the rejected EPS session management procedure, to the GPRS session management in A/Gb and Iu mode for the corresponding session management procedure and the given PLMN and APN combination and to the 5GS session management in N1 mode for the corresponding session management procedure and the given PLMN and APN combination. </control>
NOTE 3: In the present subclause the terms APN and DNN are referring to the same parameter.
<control> The APN of the PLMN and APN combination associated with the back-off timer <action> is the APN provided by the UE </action> <condition> when the PDN connection is established. </condition> </control> <control> If <condition> <condition> no APN is included in the PDN CONNECTIVITY REQUEST </condition> or, <condition> when applicable, in the ESM INFORMATION RESPONSE message, </condition> then the back-off timer <action> is associated with the combination of the PLMN and no APN. For this purpose the UE shall memorize the APN provided to the network during the PDN connection establishment. </action> </condition> </control> <control> The back-off timer associated with the combination of a PLMN with no APN will <action> never be started </action> due to any ESM procedure related to an emergency PDN connection. </control> <control> If <condition> the back-off timer associated with the combination of a PLMN with no APN is running, </condition> it <action> does not affect the ability of the UE to request an emergency PDN connection. </action> </control>
The network may additionally indicate in the re-attempt indicator that a command to back-off is applicable not only for the PLMN in which the UE received the EPS session management reject message, but for each PLMN included in the equivalent PLMN list at the time when the EPS session management reject message was received.
<control> If <condition> <condition> the back-off timer is running or is deactivated for a given PLMN and APN combination, </condition> and <condition> the UE is a UE configured to use AC11 15 in selected PLMN, </condition> </condition> then the UE <action> is allowed to initiate an attach procedure or any EPS session management procedure for this PLMN and APN combination. </action> </control>
6.3.7 Handling of WLAN offload control
In networks that support offloading of traffic to WLAN, as specified in 3GPP TS 36.331 , a permission to offload is determined for the UE and the PDN connection in accordance with 3GPP TS 23.401 subclause 4.3.23.
6.3.8 Handling of serving PLMN rate control
<control> Serving PLMN rate control <action> enables the serving PLMN to protect its MME and the signalling radio bearers in the E- UTRAN from load generated by NAS messages with user data over control plane. </action> </control> <control> The MME <action> can inform the UE of any local serving PLMN rate control </action> <condition> during the default EPS bearer context activation procedure (see subclause 6.4.1). </condition> </control> <control> If <condition> the serving PLMN rate control is enabled, </condition> <control> the MME shall <action> start the serving PLMN rate control for the PDN connection </action> <condition> when the first NAS message with user data over control plane is received over the PDN connection. </condition> </control> </control> <control> The UE shall <action> limit the rate at which it generates uplink NAS messages with user data over control plane to comply with the serving PLMN policy provided by the network. </action> </control> <control> The indicated rate in a NAS procedure <action> applies to the PDN connection the NAS procedure corresponds to, </action> and <control> the indicated rate <action> is valid </action> <condition> until the PDN connection is released. </condition> </control> </control>
Serving PLMN rate control is applicable for PDN connections established for control plane CIoT EPS optimization only.
<control> Any serving PLMN rate control information provided by the network to the UE <action> is only applicable for the PLMN </action> which provided this information. </control> <control> This serving PLMN rate control information shall <action> be discarded </action> <condition> when the UE successfully registers to another PLMN. </condition> </control>
NOTE: <control> The serving PLMN can <action> discard </action> or <action> delay NAS messages including user data over control plane that exceed the limit provided for serving PLMN rate control. </action> </control>
6.3.9 Handling of APN rate control
<control> APN rate <action> control controls the maximum number of uplink user data messages including uplink exception data reporting sent by the UE in a time interval for the APN in accordance with 3GPP TS 23.401 . </action> </control> <control> The UE shall <action> limit the rate </action> at which it generates uplink user data messages to comply with the APN rate control policy. </control> <control> The NAS shall <action> provide the indicated rates to upper layers for enforcement. </action> </control> <control> The indicated rates in a NAS procedure <action> applies to the APN the NAS procedure corresponds to, </action> and <action> the indicated rates are valid </action> <condition> until a new value is indicated or the last PDN connection using this APN is released. </condition> </control>
<control> If <condition> the UE supports APN rate control, </condition> the UE shall <action> provide the support indication of APN rate control and additional APN rate control for exception data reporting to the network. </action> </control> <control> If <condition> the UE indicates support of additional APN rate control for exception data reporting, </condition> the network may <action> provide the APN rate control parameters for exception data to the UE. </action> </control> <control> If <condition> the UE does not indicate support of additional APN rate control for exception data reporting, </condition> the network <action> shall not provide the APN rate control parameters for exception data to the UE. </action> </control>
<control> If <condition> <condition> an allowed indication of additional exception reports is provided with the APN rate control parameters </condition> and: <condition> a) the additional APN rate control parameters for exception data is provided </condition> and <condition> the limit for additional rate for exception data reporting is not reached; </condition> or <condition> b) the additional APN rate control parameters for exception data is not provided, </condition> </condition> the UE <action> is allowed to send uplink exception reports </action> even if the limit for the APN rate control has been reached. </control>
NOTE 1: <control> The HPLMN can <action> discard or delay user data that exceeds the limit provided for APN rate control. </action> </control>
<control> <condition> Upon inter-system change from S1 mode to N1 mode, </condition> the UE shall <action> store the current APN rate control status </action> for each APN associated with PDN connection(s) to be transferred from S1 mode to N1 mode as specified in 3GPP TS 23.501 . </control>
NOTE 2: How long the UE stores the current APN rate control status is implementation specific.
<control> <condition> Upon inter-system change from N1 mode to S1 mode, </condition> <control> the UE shall <action> use the stored APN rate control status, </action> <condition> <condition> if any, </condition> to comply with the APN rate control policy for an APN as specified in 3GPP TS 23.501 if: <condition> a) there is at least one PDN connection associated with this APN was transferred from N1 mode to S1 mode; </condition> and <condition> b) the validity period of the stored APN rate control status has not expired. </condition> </condition> </control> </control>
<control> <condition> <condition> After inter-system change from S1 mode to N1 mode, </condition> if <condition> all the PDU sessions associated with the same APN that was used in S1 mode are released, </condition> </condition> the UE shall <action> delete the stored APN rate control status for this APN. </action> </control>
6.3.10 Handling of 3GPP PS data off
<control> A UE, <condition> which supports 3GPP PS data off (see 3GPP TS 23.401 ), </condition> can <action> be configured with up to two lists of 3GPP PS data off exempt services </action> as specified in 3GPP TS 24.368 or in the EF USIM file as specified in 3GPPPSDATAOFF 3GPP TS 31.102 : a) a list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN; and b) a list of 3GPP PS data off exempt services to be used in the VPLMN. </control>
<control> If <condition> only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN is configured at the UE, </condition> this list shall <action> be also used in the VPLMN. </action> </control>
<control> If <condition> the UE supports 3GPP PS data off, </condition> <control> the UE shall <action> provide the 3GPP PS data off UE status in the protocol configuration options IE </action> <condition> during attach, UE-requested PDN connectivity, and UE-requested bearer resource modification procedure </condition> </control> </control>
NOTE 1: <control> The <action> sending of the 3GPP PS data off UE status to the network happens </action> also <condition> when the user activates or deactivates 3GPP PS data off while connected via WLAN access only, </condition> and then <action> handover to 3GPP access occur. </action> </control>
<control> The network <action> informs the UE about the support of 3GPP PS data off during the activation of the default bearer of a PDN connection (see subclause 6.4.1). </action> </control> <control> If <condition> 3GPP PS data off support is not indicated in the protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> not indicate any change of 3GPP PS data off UE status </action> for the PDN connection established by the default EPS bearer context activation procedure; </control> <control> <condition> otherwise </condition> the UE shall <action> indicate change of the 3GPP PS data off UE status for the PDN connection </action> by using the UE- requested bearer resource modification procedure as specified in subclause 6.5.4. </control> <control> If <condition> the network does not provide indication of support of 3GPP PS data off during default EPS bearer context activation procedure of the PDN connection, </condition> the UE behaviour for non-exempt service requests from the network <action> is implementation dependent. </action> </control>
<control> <condition> When the 3GPP PS data off UE status is "activated": </condition> <control> a) the UE <action> does not send uplink IP packets </action> <condition> except: <condition> a) for those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN as specified in 3GPP TS 24.368 when the UE is in its HPLMN or EHPLMN; </condition> <condition> b) for those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN when the UE is in the VPLMN, if only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN is configured to the UE as specified in 3GPP TS 24.368 ; </condition> <condition> c) for those services indicated in the list of 3GPP PS data off exempt services to be used in the VPLMN when the UE is in the VPLMN, if the list of 3GPP PS data off exempt services to be used in the VPLMN is configured to the UE as specified in 3GPP TS 24.368 ; </condition> <condition> d) for those services indicated in the EF USIM file as specified in 3GPP TS 31.102 ; 3GPPPSDATAOFF </condition> <condition> e) any uplink traffic due to procedures specified in 3GPP TS 24.229 ; </condition> and <condition> f) any uplink traffic due to procedures specified in 3GPP TS 24.623 ; </condition> </condition> </control> and <action> b) the UE does not send uplink non-IP or Ethernet user data packets. </action> </control>
<control> <condition> Otherwise </condition> the UE <action> sends uplink user data packets without restriction. </action> </control>
NOTE 2: <control> If <condition> the UE supports 3GPP PS data off, </condition> uplink IP packets <action> are filtered as specified in 3GPP TS 24.229 in L.3.1.5. </action> </control>
6.3.11 Handling of Reliable Data Service
<control> If <condition> the UE supports Reliable Data Service (see 3GPP TS 24.250 ), </condition> the UE may <action> request data transfer using Reliable Data Service </action> for a PDN connection in the extended protocol configuration options IE during attach and UE-requested PDN connectivity procedures (see subclause 5.5.1 and 6.5.1). </control>
<control> The Reliable Data Service may <action> only be used with PDN connections </action> for which the "Control plane only" indicator is set or with PDN connections using the control plane CIoT EPS optimization <condition> when the MME does not move such PDN connections to the user plane. </condition> </control>
<control> The SCEF or P-GW shall <action> inform the UE about the acceptance of UE's request </action> for Reliable Data Service usage during the activation of the default bearer of a PDN connection (see subclause 6.4.1) in the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. </control>
<control> If <condition> the SCEF or P-GW accepts the use of Reliable Data Service to transfer data for the specified PDN connection, </condition> the UE shall <action> use this PDN connection exclusively for data transfer using Reliable Data Service; </action> </control> <control> <condition> otherwise </condition> the UE shall <action> not use this PDN connection for data transfer using Reliable Data Service. </action> </control>
6.3.12 Handling of Ethernet PDN type
<control> A UE may <action> support the Ethernet PDN type. </action> </control> <control> A network may <action> support the Ethernet PDN type. </action> </control>
6.4 Network initiated ESM procedures
6.4.1 Default EPS bearer context activation procedure
6.4.1.1 General
The purpose of the default bearer context activation procedure is to establish a default EPS bearer context between the UE and the EPC. <control> The default EPS bearer context activation procedure <action> is initiated by the network as a response to the PDN CONNECTIVITY REQUEST message from the UE. </action> </control> <control> The default bearer context activation procedure can <action> be part of the attach procedure, </action> and <control> if <condition> the attach procedure fails, </condition> the UE shall <action> consider that the default bearer activation has implicitly failed. </action> </control> </control> <control> The default EPS bearer context does <action> not have any TFT assigned </action> <condition> during the activation procedure. </condition> </control> <control> This <action> corresponds to using a match-all packet filter. </action> </control> <control> The network may at anytime after the establishment of this bearer <action> assign a TFT to the default EPS bearer </action> and may <action> subsequently modify the TFT or the packet filters of this default bearer. </action> </control>
6.4.1.2 Default EPS bearer context activation initiated by the network
<control> The MME shall <action> initiate the default bearer context activation procedure </action> by sending an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and <end_state> enter the state BEARER CONTEXT ACTIVE PENDING </end_state> (see example in figure 6.4.1.2.1). </control> <control> <condition> When the default bearer is activated as part of the attach procedure, </condition> the MME shall <action> send the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message together with ATTACH ACCEPT </action> and shall <action> not start the timer T3485. </action> </control> <control> <condition> When the default bearer is activated as the response to a stand-alone PDN CONNECTIVITY REQUEST message apart from the attach procedure, </condition> the MME shall <action> send the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message alone, </action> and <action> start the timer T3485. </action> </control>
<control> The MME shall <action> assign </action> and <action> include an EPS bearer identity in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message selecting a value </action> as specified by subclause 9.3.2. </control> <control> The MME shall <action> retrieve the PTI from the PDN CONNECTIVITY REQUEST message </action> and <action> include it in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. </action> </control> <control> Both the network identifier part and the operator identifier part shall <action> be included in the Access Point Name IE. </action> </control>
6.4.1.3 Default EPS bearer context activation accepted by the UE
<control> <condition> <condition> Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> if <condition> the UE provided an APN for the establishment of the PDN connection, </condition> </condition> <control> the UE shall <action> stop timer T3396 </action> if <condition> it is running for the APN provided by the UE. </condition> </control> </control> <control> If <condition> <condition> the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <control> the UE shall <action> stop the timer T3396 associated with no APN </action> if <condition> it is running. </condition> </control> </control> <control> If <condition> the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message was received in response to a request for an emergency PDN connection, </condition> <control> the UE shall <action> not stop the timer T3396 associated with no APN </action> if <condition> it is running. </condition> </control> </control> <control> <condition> For any case, </condition> the UE shall <action> then send an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message </action> and <end_state> enter the state BEARER CONTEXT ACTIVE. </end_state> </control> <control> <condition> When the default bearer is activated as part of the attach procedure, </condition> the UE shall <action> send the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message together with ATTACH COMPLETE message. </action> </control> <control> <condition> When the default bearer is activated as the response to the stand-alone PDN CONNECTIVITY REQUEST message, </condition> the UE shall <action> send the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message alone. </action> </control>
<control> If <condition> a WLAN offload indication information element is included in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> <control> the UE shall <action> store the WLAN offload acceptability values for this PDN connection </action> and <action> use the E-UTRAN offload acceptability value to determine </action> <condition> whether this PDN connection is offloadable to WLAN or not. </condition> </control> </control>
<control> The UE <action> checks the PTI in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message </action> to identify the UE requested PDN connectivity procedure to which the default bearer context activation is related (see subclause 6.5.1). </control>
<control> If <condition> the UE receives a serving PLMN rate control IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the serving PLMN rate control IE value </action> and <action> use the stored serving PLMN rate control value </action> as the maximum allowed limit of uplink User data container IEs included in ESM DATA TRANSPORT messages for the corresponding PDN connection in accordance with 3GPP TS 23.401 . </control>
<control> If <condition> the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the APN rate control parameters value </action> and <action> use the stored APN rate control parameters value </action> as the maximum allowed limit of uplink user data related to the APN indicated in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in accordance with 3GPP TS 23.401 . </control> <control> If <condition> the UE has a previously stored APN rate control parameters value for this APN, </condition> the UE shall <action> replace the stored APN rate control parameters value for this APN </action> with the received APN rate control parameters value. </control>
<control> If <condition> the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the additional APN rate control parameters for exception data value </action> and <action> use the stored additional APN rate control parameters </action> for exception data value as the maximum allowed limit of uplink exception data related to the APN indicated in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in accordance with 3GPP TS 23.401 . </control> <control> If <condition> the UE has a previously stored additional APN rate control parameters for exception data value for this APN, </condition> the UE shall <action> replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value. </action> </control>
<control> If <condition> the UE receives a small data rate control parameters container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the small data rate control parameters value </action> and <action> use the stored small data rate control parameters value </action> as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 . </control>
<control> If <condition> the UE receives an additional small data rate control parameters for exception data container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the additional small data rate control parameters for exception data value </action> and <action> use the stored additional small data rate control parameters </action> for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 . </control>
<control> If <condition> the UE receives non-IP Link MTU parameter, Ethernet Frame Payload MTU parameter, or IPv4 Link MTU parameter of the protocol configuration options IE or of the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> pass the received Non-IP Link MTU, Ethernet Frame Payload MTU size, or IPv4 Link MTU to the upper layer. </action> </control>
NOTE 1: The Non-IP Link MTU and the IPv4 Link MTU size correspond to the maximum length of user data that can be sent either in the user data container in the ESM DATA TRANSPORT message or via S1-U interface.
NOTE 2: The Ethernet frame payload MTU size corresponds to the maximum length of a payload of an Ethernet frame that can be sent either in the user data container in the ESM DATA TRANSPORT message or via S1-U interface.
<control> <condition> Upon receiving the DNS server security information, </condition> the UE shall <action> pass it to the upper layer. </action> </control> <control> The UE shall <action> use this information to send the DNS over (D)TLS (See 3GPP TS 33.501 ). </action> </control>
NOTE 3: <control> Support of DNS over (D)TLS <action> is based on the informative requirements as specified in 3GPP TS 33.501 . </action> </control>
<control> <condition> Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message, </condition> <control> the MME shall <end_state> enter the state BEARER CONTEXT ACTIVE and stop the timer T3485, </end_state> if <condition> the timer is running. </condition> </control> </control> <control> If <condition> the PDN CONNECTIVITY REQUEST message included a low priority indicator set to "MS is configured for NAS signalling low priority", </condition> the MME shall <action> store the NAS signalling low priority indication within the default EPS bearer context. </action> </control>
6.4.1.4 Default EPS bearer context activation not accepted by the UE
<control> If <condition> the default EPS bearer context activation is part of the attach procedure, </condition> the ESM sublayer shall <action> notify the EMM sublayer of an ESM failure. </action> </control> <control> If <condition> EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> the ESM sublayer shall <action> additionally provide an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message to the EMM sublayer. </action> </control>
<control> If <condition> the default EPS bearer context activation is not part of the attach procedure, </condition> the UE shall <action> send an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message </action> and <end_state> enter the state BEARER CONTEXT INACTIVE. </end_state> </control>
The ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following cause values: #26: insufficient resources; #31: request rejected, unspecified; or #95 111: protocol errors.
<control> <condition> Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message, </condition> <control> the MME shall <end_state> enter the state BEARER CONTEXT INACTIVE </end_state> and <action> stop the timer T3485, </action> if <condition> the timer is running. </condition> </control> </control>
6.4.1.5 Abnormal cases in the UE
<control> The following abnormal cases can be identified: <condition> <condition> a) Default EPS bearer context activation request for an already activated default EPS bearer context: </condition> <condition> If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated default EPS bearer context, </condition> </condition> the UE shall <action> locally deactivate the existing default EPS bearer context and all the associated dedicated EPS bearer contexts, </action> if any, and <action> proceed with the requested default EPS bearer context activation. </action> </control>
<control> <condition> <condition> b) Default EPS bearer context activation request for an already activated dedicated EPS bearer context: </condition> If <condition> the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated dedicated EPS bearer context, </condition> </condition> the UE shall locally <action> deactivate the existing dedicated EPS bearer context </action> and <action> proceed with the requested default EPS bearer context activation. </action> </control>
6.4.1.6 Abnormal cases on the network side
The following abnormal cases can be identified: <control> a) Expiry of timer T3485: <condition> On the first expiry of the timer T3485, </condition> the MME shall <action> resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST </action> and shall <action> reset and restart timer T3485. </action> </control> <control> <action> This retransmission is repeated four times, </action> <control> i.e. <condition> on the fifth expiry of timer T3485, </condition> the MME shall <action> release possibly allocated resources for this activation </action> and shall <action> abort the procedure. </action> </control> </control>
<control> <condition> b) Lower layer indicates that the HeNB rejected the establishment of the default bearer (see 3GPP TS 36.413 ) for a LIPA PDN connection or SIPTO at the local network PDN connection due to a triggered handover: </condition> The MME shall <end_state> enter the state BEARER CONTEXT INACTIVE, </end_state> <action> stop timer T3485 </action> and <action> reject the PDN connectivity request procedure </action> including the ESM cause value #34 "service option temporarily out of order" in the PDN CONNECTIVITY REJECT message. </control> <control> The MME shall <action> release possibly allocated resources for this activation. </action> </control>
6.4.2 Dedicated EPS bearer context activation procedure
6.4.2.1 General
The purpose of the dedicated EPS bearer context activation procedure is to establish an EPS bearer context with specific QoS and TFT between the UE and the EPC.
<control> <condition> In WB-S1 mode, </condition> the dedicated EPS bearer context activation procedure <action> is initiated by the network, </action> but may <action> be requested by the UE by means of the UE </action> requested bearer resource allocation procedure (see subclause 6.5.3) or the UE requested bearer resource modification procedure (see subclause 6.5.4). </control> <control> The dedicated bearer context activation procedure <action> can be part of the attach procedure </action> or <action> be initiated together with the default EPS bearer context activation procedure </action> <condition> when the UE initiated stand-alone PDN connectivity procedure. </condition> </control> <control> If <condition> the attach procedure or the default EPS bearer context activation procedure fails, </condition> the UE shall <action> consider that the dedicated bearer activation has implicitly failed. </action> </control>
<control> The network may <action> initiate the dedicated EPS bearer context activation procedure </action> together with the completion of the service request procedure. </control>
<control> <condition> In NB-S1 mode, </condition> the dedicated EPS bearer contexts activation procedure is <action> not used. </action> </control>
<control> <condition> Upon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode, </condition> if <start_state> the UE has at least one dedicated EPS bearer context in ESM state BEARER CONTEXT ACTIVE, </start_state> the UE shall <action> locally deactivate any such dedicated EPS bearer context </action> and shall <action> include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> Upon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single- registration mode, </condition> the UE shall <action> set each mapped dedicated EPS bearer context, </action> if any, <end_state> to ESM state BEARER CONTEXT INACTIVE </end_state> and shall then <action> include the EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
NOTE: 3GPP TS 23.060 [74] subclause 9.3 specifies that a packet filter applicable for the downlink direction is not mandatory in a TFT.
6.4.2.2 Dedicated EPS bearer context activation initiated by the network
<control> <condition> In WB-S1 mode, </condition> the MME shall <action> initiate the dedicated bearer context activation procedure by sending an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </action> <action> start the timer T3485, </action> and <end_state> enter the state BEARER CONTEXT ACTIVE PENDING (see example in figure 6.4.2.2.1). </end_state> </control>
<control> The MME <action> allocates the EPS bearer identity selecting a value as specified by subclause 9.3.2, </action> and <action> includes it in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. </action> </control> <control> The MME shall <action> include the EPS bearer identity of the associated default bearer as the linked EPS bearer identity in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. </action> </control> <control> If <condition> this procedure was initiated by a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, </condition> the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST shall <action> contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE ALLOCATION REQUEST or BEARER RESOURCE MODIFICATION REQUEST respectively. </action> </control>
6.4.2.3 Dedicated EPS bearer context activation accepted by the UE
<control> <condition> <condition> Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> if <condition> the UE provided an APN for the establishment of the PDN connection, </condition> </condition> <control> the UE shall <action> stop timer T3396, </action> if <condition> it is running for the APN provided by the UE. </condition> </control> </control> <control> If <condition> <condition> the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <control> the UE shall <action> stop the timer T3396 associated with no APN </action> if <condition> it is running. </condition> </control> </control> <control> If <condition> the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, </condition> <control> the UE shall <action> not stop the timer T3396 associated with no APN </action> if <condition> it is running. </condition> </control> </control> <control> <condition> For any case, </condition> the UE shall <action> then check the received TFT before taking it into use, </action> <action> send an ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message </action> and <end_state> enter the state BEARER CONTEXT ACTIVE. </end_state> </control> <control> The ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message shall <action> include the EPS bearer identity. </action> </control>
<control> The linked EPS bearer identity included in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message <action> indicates to the UE to which default bearer, IP address and PDN the dedicated bearer is linked. </action> </control>
<control> If <condition> the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 ), </condition> the UE <action> uses the PTI to identify the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure to which the dedicated bearer context activation is related. </action> </control>
<control> If <condition> <condition> the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 ) </condition> and <condition> the PTI is associated to a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, </condition> </condition> the UE shall <action> release the traffic flow aggregate description associated to the PTI value provided. </action> </control>
<control> The UE shall <action> use the received TFT to apply mapping of uplink traffic flows to the radio bearer. </action> </control>
<control> The UE shall <action> treat any packet filter without explicit direction as being bi-directional. </action> </control>
<control> If <condition> the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the APN rate control parameters value </action> and <action> use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the corresponding APN in accordance with 3GPP TS 23.401 . </action> </control>
<control> If <condition> the UE has a previously stored APN rate control parameters value for this APN, </condition> the UE shall <action> replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value. </action> </control>
<control> If <condition> the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the additional APN rate control parameters for exception data value </action> and <action> use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the corresponding APN in accordance with 3GPP TS 23.401 . </action> </control> <control> If <condition> the UE has a previously stored additional APN rate control parameters for exception data value for this APN, </condition> the UE shall <action> replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value. </action> </control>
<control> If <condition> the UE receives a small data rate control parameters container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the small data rate control parameters value </action> and <action> use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 . </action> </control> <control> If <condition> the UE has a previously stored small data rate control parameters value for this PDU session, </condition> the UE shall <action> replace the stored small data rate control parameters value for this PDU Session with the received small data rate control parameters value. </action> </control>
<control> If <condition> the UE receives an additional small data rate control parameters for exception data container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the additional small data rate control parameters for exception data value </action> and <action> use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 . </action> </control> <control> If <condition> the UE has a previously stored additional small data rate control parameters for exception data value for this PDU session, </condition> the UE shall <action> replace the stored additional small data rate control parameters for exception data value for this PDU session with the received additional small data rate control parameters for exception data value. </action> </control>
<control> If <condition> the UE receives QoS rule(s) of the 5GS QoS flow(s), </condition> which corresponds to the dedicated EPS bearer being activated, in the protocol configuration options IE or the extended protocol configuration options IE of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE <action> stores the QoS rule(s) for use during inter- system change from S1 mode to N1 mode. </action> </control>
<control> <condition> Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message, </condition> the MME shall <action> stop the timerT3485 </action> and <end_state> enter the state BEARER CONTEXT ACTIVE. </end_state> </control>
6.4.2.4 Dedicated EPS bearer context activation not accepted by the UE
<control> <condition> Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> the UE may <action> reject the request from the MME by sending an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message. </action> </control> <control> The message shall <action> include the EPS bearer identity </action> and <action> an ESM cause value indicating the reason for rejecting the dedicated EPS bearer context activation request. </action> </control>
<control> The ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message <action> contains an ESM cause that typically indicates one of the following ESM cause values: #26: insufficient resources; #31: request rejected, unspecified; #41: semantic error in the TFT operation; #42: syntactical error in the TFT operation; #43: invalid EPS bearer identity; #44: semantic error(s) in packet filter(s); #45: syntactical error(s) in packet filter(s); or #95 111: protocol errors. </action> </control>
<control> The UE shall <action> check the TFT in the request message </action> for different types of TFT IE errors as follows: a) Semantic errors in TFT operations: 1) When the TFT operation is an operation other than "Create a new TFT" </control>
<control> The UE shall <action> reject the activation request with ESM cause #41 "semantic error in the TFT operation". </action> </control>
<control> <condition> b) Syntactical errors in TFT operations: 1) When the TFT operation = "Create a new TFT" and the packet filter list in the TFT IE is empty. </condition> </control>
<control> <condition> 2) When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list. </condition> </control>
<control> The UE shall <action> reject the activation request with ESM cause #42 "syntactical error in the TFT operation". </action> </control>
<control> <condition> c) Semantic errors in packet filters: 1) When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, </condition> i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document. </control>
<control> <condition> 2) When the resulting TFT does not contain any packet filter which applicable for the uplink direction. </condition> </control>
<control> The UE shall <action> reject the activation request with ESM cause #44 "semantic errors in packet filter(s)". </action> </control>
<control> <condition> d) Syntactical errors in packet filters: 1) When the TFT operation = "Create a new TFT" and two or more packet filters in the resultant TFT would have identical packet filter identifiers. </condition> </control>
<control> <condition> 2) When the TFT operation = "Create a new TFT" and two or more packet filters in all TFTs associated with this PDN connection would have identical packet filter precedence values. </condition> </control>
<control> <condition> 3) When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier. </condition> </control>
<control> <condition> <condition> In case 2, </condition> if <condition> the old packet filters do not belong to the default EPS bearer context, </condition> </condition> the UE shall <action> not diagnose an error, </action> shall <action> further process the new activation request </action> and, <control> if <condition> it was processed successfully, </condition> shall <action> delete the old packet filters </action> which have identical filter precedence values. </control> </control> <control> Furthermore, <condition> by means of explicit peer-to-peer signalling between the network and the UE, </condition> the UE shall <action> perform a UE requested bearer resource modification procedure </action> to deactivate the EPS bearer context(s) for which it has deleted the packet filters. </control>
<control> <condition> <condition> In case 2, </condition> if <condition> one or more old packet filters belong to the default EPS bearer context, </condition> </condition> the UE shall <action> release the relevant PDN connection. </action> </control> <control> If <condition> the relevant PDN connection is the last one that the UE has and EMM- REGISTERED without PDN connection is not supported by the UE or the MME, </condition> the UE shall <action> detach </action> and <action> re- attach to the network. </action> </control>
<control> <condition> In cases 1 and 3 </condition> the UE shall <action> reject the activation request with ESM cause #45 "syntactical errors in packet filter(s)". </action> </control>
<control> <condition> Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message <start_state> in state BEARER CONTEXT ACTIVE PENDING, </start_state> </condition> the MME shall <action> stop the timer T3485, </action> <end_state> enter the state BEARER CONTEXT INACTIVE </end_state> and <action> abort the dedicated EPS bearer context activation procedure. </action> </control> <control> The MME also <action> requests the lower layer </action> to release the radio resources that were established during the dedicated EPS bearer context activation procedure. </control>
6.4.2.5 Abnormal cases in the UE
<control> The following abnormal cases can be identified: <condition> <condition> a) Dedicated EPS bearer context activation request for an already activated default EPS bearer context: </condition> If <condition> the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated default EPS bearer context, </condition> </condition> the UE shall <action> locally deactivate the existing default EPS bearer context and all the associated dedicated EPS bearer contexts, </action> if any, and <action> proceed with the requested dedicated EPS bearer context activation. </action> </control>
<control> <condition> b) Dedicated EPS bearer context activation request for an already activated dedicated EPS bearer context </condition> </control>
<control> If <condition> the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated dedicated EPS bearer context, </condition> the UE shall <action> locally deactivate the existing dedicated EPS bearer context and proceed with the requested dedicated EPS bearer context activation. </action> </control>
<control> <condition> c) No default EPS bearer context with linked EPS bearer identity activated </condition> </control>
<control> If <condition> the linked EPS bearer identity included in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message does not match the EPS bearer identity of any activated default EPS bearer context, </condition> the UE shall <action> reply with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with ESM cause #43 "invalid EPS bearer identity". </action> </control>
<control> <condition> <condition> d) Dedicated EPS bearer context activation request when the PLMN's maximum number of EPS bearer contexts in S1 mode is reached at the UE: </condition> If <condition> the PLMN's maximum number of EPS bearer contexts in S1 mode is reached at the UE </condition> and <condition> the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, </condition> </condition> the UE shall <action> clear the determination representing the PLMN's maximum number of EPS bearer contexts in S1 mode </action> and <action> proceed with the dedicated EPS bearer context activation procedure. </action> </control>
6.4.2.6 Abnormal cases on the network side
<control> The following abnormal cases can be identified: <condition> a) Expiry of timer T3485: On the first expiry of the timer T3485, </condition> the MME shall <action> resend the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST </action> and shall <action> reset and restart timer T3485. </action> </control> <control> This retransmission <action> is repeated four times, </action> i.e. <control> <condition> on the fifth expiry of timer T3485, </condition> the MME shall <action> abort the procedure, </action> <action> release any resources allocated for this activation </action> and <end_state> enter the state BEARER CONTEXT INACTIVE. </end_state> </control> </control>
<control> <condition> <condition> b) Collision of UE requested PDN disconnect procedure and dedicated EPS bearer context activation procedure: </condition> When the MME receives a PDN DISCONNECT REQUEST message during the dedicated EPS bearer context activation procedure, </condition> and <condition> the EPS bearer to be activated belongs to the PDN connection the UE wants to disconnect, </condition> the MME shall <action> terminate the dedicated bearer context activation procedure locally, </action> <action> release any resources related to this procedure </action> and <action> proceed with the PDN disconnect procedure. </action> </control>
6.4.3 EPS bearer context modification procedure
6.4.3.1 General
The purpose of the EPS bearer context modification procedure is to modify an EPS bearer context with a specific QoS and TFT, or re-negotiate header compression configuration associated to an EPS bearer context. <control> The EPS bearer context modification procedure <action> is initiated by the network, </action> but it may <action> also be initiated as part of the UE requested bearer resource allocation procedure </action> or the UE requested bearer resource modification procedure. </control>
<control> The network may also <action> initiate the EPS bearer context modification procedure to update the APN-AMBR of the UE, </action> for instance after an inter-system handover. </control> See 3GPP TS 23.401 annex E.
<control> The MME may also <action> initiate the EPS bearer context modification procedure </action> to update the WLAN offload indication to the UE, for instance after the MME received an updated WLAN offload indication of a PDN Connection from HSS. See 3GPP TS 23.401 subclause 4.3.23. </control>
<control> The MME may also <action> initiate the EPS bearer context modification procedure </action> to update information required for inter- system change from S1 mode to N1 mode (e.g. session-AMBR, QoS rule(s)). </control> See 3GPP TS 24.501 .
<control> The network may <action> initiate the EPS bearer context modification procedure </action> together with the completion of the service request procedure. </control>
6.4.3.2 EPS bearer context modification initiated by the network
<control> The MME shall <action> initiate the EPS bearer context modification procedure </action> by sending a MODIFY EPS BEARER CONTEXT REQUEST message to the UE, <action> starting the timer T3486, </action> and <end_state> entering the state BEARER CONTEXT MODIFY PENDING </end_state> (see example in figure 6.4.3.2.1). </control>
<control> The MME shall <action> include an EPS bearer identity that identifies the EPS bearer context to be modified in the MODIFY EPS BEARER CONTEXT REQUEST message. </action> </control>
<control> If <condition> this procedure was initiated by a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, </condition> the MODIFY EPS BEARER CONTEXT REQUEST shall <action> contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE ALLOCATION REQUEST or BEARER RESOURCE MODIFICATION REQUEST respectively. </action> </control>
<control> If <condition> the UE indicated "Control plane CIoT EPS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the UE network capability IE in the latest ATTACH REQUEST message or the TRACKING AREA UPDATE REQUEST message, </condition> and the MME <action> supports Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization, </action> the MME may <action> include the Header compression configuration IE in the MODIFY EPS BEARER CONTEXT REQUEST message to re-negotiate header compression configuration associated to an EPS bearer context. </action> </control>
6.4.3.3 EPS bearer context modification accepted by the UE
<control> <condition> <condition> Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, </condition> if <condition> the UE provided an APN for the establishment of the PDN connection, </condition> </condition> <control> <action> the UE shall stop timer T3396, </action> if <condition> it is running for the APN provided by the UE. </condition> </control> </control> <control> If <condition> the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", </condition> <control> the UE shall <action> stop the timer T3396 </action> associated with no APN if <condition> it is running. </condition> </control> </control> <control> If <condition> the MODIFY EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, </condition> the UE shall <control> <action> not stop the timer T3396 associated with no APN </action> if <condition> it is running. </condition> </control> </control> <control> For any case, <control> the UE shall <action> then check the received TFT </action> <condition> before taking it into use and send a MODIFY EPS BEARER CONTEXT ACCEPT message to the MME. </condition> </control> </control>
<control> If <condition> the MODIFY EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 ), </condition> the UE <action> uses the PTI to identify the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure to which the EPS bearer context modification is related (see subclause 6.5.3 and subclause 6.5.4). </action> </control>
<control> If <condition> <condition> the MODIFY EPS BEARER CONTEXT REQUEST message contains a PTI value </condition> other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 ) and <condition> the PTI is associated to a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, </condition> </condition> the UE shall <action> release the traffic flow aggregate description associated to the PTI value provided. </action> </control>
<control> If <condition> the EPS bearer context that is modified is a GBR bearer and the MODIFY EPS BEARER CONTEXT REQUEST message does not contain the Guaranteed Bit Rate (GBR) and the Maximum Bit Rate (MBR) values for uplink and downlink, </condition> the UE shall <action> continue to use the previously received values for the Guaranteed Bit Rate (GBR) and the Maximum Bit Rate (MBR) for the corresponding bearer. </action> </control>
<control> The UE shall <action> use the received TFT to apply mapping of uplink traffic flows to the radio bearer </action> if <condition> the TFT contains packet filters for the uplink direction. </condition> </control>
<control> If <condition> a WLAN offload indication information element is included in the MODIFY EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the WLAN offload acceptability values for this PDN connection </action> and <action> use the E-UTRAN offload acceptability value to determine </action> whether this PDN connection is offloadable to WLAN or not. </control>
<control> If <condition> the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the APN rate control parameters value </action> and <action> use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the corresponding APN in accordance with 3GPP TS 23.401 . </action> </control> <control> If <condition> the UE has a previously stored APN rate control parameters value for this APN, </condition> the UE shall <action> replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value. </action> </control>
<control> If <condition> the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the additional APN rate control parameters for exception data value </action> and <action> use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the corresponding APN in accordance with 3GPP TS 23.401 . </action> </control> <control> If <condition> the UE has a previously stored additional APN rate control parameters for exception data value for this APN, </condition> the UE shall <action> replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value. </action> </control>
<control> If <condition> the UE receives a small data rate control parameters container in the protocol configuration options IE or the extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter- system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 . </action> </control> <control> If <condition> the UE has a previously stored small data rate control parameters value for this PDU session, </condition> the UE shall <action> replace the stored small data rate control parameters value for this PDU Session with the received small data rate control parameters value. </action> </control>
<control> If <condition> the UE receives an additional small data rate control parameters for exception data container in the protocol configuration options IE or the extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 . </action> </control> <control> If <condition> the UE has a previously stored additional small data rate control parameters for exception data value for this PDU session, </condition> the UE shall <action> replace the stored additional small data rate control parameters for exception data value for this PDU session with the received additional small data rate control parameters for exception data value. </action> </control>
<control> <condition> Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message with a session-AMBR and QoS rule(s) in the protocol configuration options IE or the extended protocol configuration options IE, </condition> the UE <action> stores the session- AMBR and QoS rule(s) for use during inter-system change from S1 mode to N1 mode. </action> </control>
<control> <condition> Upon receipt of the MODIFY EPS BEARER CONTEXT ACCEPT message, </condition> the MME shall <action> stop the timer T3486 </action> and <end_state> enter the state BEARER CONTEXT ACTIVE. </end_state> </control>
6.4.3.4 EPS bearer context modification not accepted by the UE
<control> <condition> Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, </condition> the UE may <action> reject the request from the MME by sending a MODIFY EPS BEARER CONTEXT REJECT message to the MME. </action> </control> <control> The message shall <action> include the EPS bearer identity and an ESM cause value indicating the reason for rejecting the EPS bearer context modification request. </action> </control>
<control> The MODIFY EPS BEARER CONTEXT REJECT message <action> contains an ESM cause that typically indicates one of the following ESM cause values: </action> #26: insufficient resources; #41: semantic error in the TFT operation; #42: syntactical error in the TFT operation; #43: invalid EPS bearer identity; #44: semantic error(s) in packet filter(s); #45: syntactical error(s) in packet filter(s); or #95 111: protocol errors. </control>
<control> The UE shall <action> check the TFT in the request message for different types of TFT IE errors as follows: </action> a) Semantic errors in TFT operations: 1) TFT operation = "Create a new TFT" when there is already an existing TFT for the EPS bearer context. </control>
<control> 2) <condition> When the TFT operation is an operation other than "Create a new TFT", </condition> the EPS bearer context being modified <action> is the default EPS bearer content </action> and <action> there is no TFT for the default EPS bearer context. </action> </control>
<control> <condition> 3) TFT operation = "Delete packet filters from existing TFT" when it would render the TFT empty. </condition> </control>
<control> <condition> 4) TFT operation = "Delete existing TFT" for a dedicated EPS bearer context. </condition> </control>
<control> <condition> In case 4 </condition> the UE shall <action> reject the modification request with ESM cause #41 "semantic error in the TFT operation". </action> </control>
<control> <condition> In the other cases </condition> the UE shall <action> not diagnose an error and perform the following actions to resolve the inconsistency: </action> </control> <control> <condition> In case 1 </condition> the UE shall <action> further process the new activation request to create a new TFT and, </action> <control> if <condition> it was processed successfully, </condition> <action> delete the old TFT. </action> </control> </control>
<control> <condition> In case 2 </condition> the UE shall: <action> a) process the new request and if the TFT operation is "Delete existing TFT" or "Delete packet filters from existing TFT", </action> and <control> if <condition> no error according to items b, c, and d was detected, </condition> <action> consider the TFT as successfully deleted; </action> </control> <control> <action> b) process the new request as an activation request, </action> if <condition> the TFT operation is "Add packet filters in existing TFT" or "Replace packet filters in existing TFT". </condition> </control> </control>
<control> <condition> <condition> In case 3, </condition> if <condition> the packet filters belong to a dedicated EPS bearer context, </condition> </condition> the UE shall <action> process the new deletion request </action> and, <control> if <condition> no error according to items b, c, and d was detected, </condition> the UE shall <action> reject the modification request with ESM cause #41 "semantic error in the TFT operation". </action> </control> </control>
<control> <condition> <condition> In case 3, </condition> if <condition> the packet filters belong to the default EPS bearer context, </condition> </condition> the UE shall <action> process the new deletion request </action> and <control> if <condition> no error according to items b, c, and d was detected then delete the existing TFT, </condition> <action> this corresponds to using match-all packet filter for the default EPS bearer context. </action> </control> </control>
<control> <condition> <condition> b) Syntactical errors in TFT operations: </condition> <condition> 1) When the TFT operation = "Create a new TFT", </condition> <action> "Add packet filters in existing TFT", </action> <action> "Replace packet filters in existing TFT" </action> or <action> "Delete packet filters from existing TFT" </action> and <action> the packet filter list in the TFT IE is empty. </action> </condition> </control>
<control> <condition> 2) TFT operation = "Delete existing TFT" or "No TFT operation" with a non-empty packet filter list in the TFT IE. </condition> </control>
<control> <condition> 3) TFT operation = "Replace packet filters in existing TFT" when the packet filter to be replaced does not exist in the original TFT. </condition> </control>
<control> <condition> 4) TFT operation = "Delete packet filters from existing TFT" when the packet filter to be deleted does not exist in the original TFT. </condition> </control>
<control> <condition> 6) When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list. </condition> </control>
<control> <condition> In case 3 </condition> the UE shall <action> not diagnose an error, </action> <action> further process the replace request </action> and, <control> if <condition> no error according to items c and d was detected, </condition> <action> include the packet filters received to the existing TFT. </action> </control> </control>
<control> <condition> In case 4 </condition> the UE shall <action> not diagnose an error, </action> <action> further process the deletion request </action> and, <control> if <condition> no error according to items c and d was detected, </condition> <action> consider the respective packet filter as successfully deleted. </action> </control> </control>
<control> <condition> Otherwise </condition> the UE shall <action> reject the modification request with ESM cause #42 "syntactical error in the TFT operation". </action> </control>
<control> <condition> c) Semantic errors in packet filters: 1) When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. </condition> </control> How the UE determines a semantic error in a packet filter is outside the scope of the present document.
<control> <condition> 2) When the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter applicable for the uplink direction among the packet filters created on request from the network. </condition> </control>
<control> The UE shall <action> reject the modification request with ESM cause #44 "semantic errors in packet filter(s)". </action> </control>
<control> <condition> d) Syntactical errors in packet filters: 1) When the TFT operation = "Create a new TFT", "Add packet filters to existing TFT", or "Replace packet filters in existing TFT" and two or more packet filters in the resultant TFT would have identical packet filter identifiers. </condition> </control>
<control> <condition> 2) When the TFT operation = "Create a new TFT", "Add packet filters to existing TFT" or "Replace packet filters in existing TFT", and two or more packet filters among all TFTs associated with this PDN connection would have identical packet filter precedence values. </condition> </control>
<control> <condition> 3) When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier. </condition> </control>
<control> <condition> <condition> In case 1, </condition> if <condition> two or more packet filters with identical packet filter identifiers are contained in the new request, </condition> </condition> the UE shall <action> reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)". </action> </control> <control> <condition> Otherwise, </condition> the UE shall <action> not diagnose an error, </action> <action> further process the new request </action> and, <control> if <condition> it was processed successfully, </condition> <action> delete the old packet filters which have the identical packet filter identifiers. </action> </control> </control>
<control> <condition> <condition> In case 2, </condition> if <condition> the old packet filters do not belong to the default EPS bearer context, </condition> </condition> the UE shall <action> not diagnose an error, </action> shall <action> further process the new request </action> and, <control> if <condition> it was processed successfully, </condition> shall <action> delete the old packet filters which have identical filter precedence values. </action> </control> </control> <control> Furthermore, the UE shall <action> perform a UE requested bearer resource modification request procedure </action> to delete the corresponding packet filters for which it has deleted. </control>
<control> <condition> <condition> In case 2, </condition> if <condition> one or more old packet filters belong to the default EPS bearer context, </condition> </condition> the UE shall <action> release the relevant PDN connection. </action> </control> <control> If <condition> <condition> the relevant PDN connection is the last one that the UE has </condition> and <condition> EMM- REGISTERED without PDN connection is not supported by the UE or the MME, </condition> </condition> the UE shall <action> detach and re- attach to the network. </action> </control>
<control> <condition> Otherwise </condition> the UE shall <action> reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)". </action> </control>
<control> <condition> <condition> Upon receipt of the MODIFY EPS BEARER CONTEXT REJECT message </condition> <condition> with ESM cause value other than #43 "invalid EPS bearer identity" </condition> </condition> <start_state> in state BEARER CONTEXT MODIFY PENDING, </start_state> the MME shall <action> stop the timer T3486, </action> <end_state> enter the state BEARER CONTEXT ACTIVE </end_state> and <action> abort the EPS bearer context modification procedure. </action> </control> <control> If <condition> the network receives the MODIFY EPS BEARER CONTEXT REJECT message with ESM cause #43 "invalid EPS bearer identity", </condition> the MME locally <action> deactivates the EPS bearer context(s) without peer-to-peer ESM signalling. </action> </control> <control> <condition> When the MME detects that after the failed EPS bearer context modification there is a misalignment between the EPS bearer configuration and the EPS bearer context configuration or between the QoS on NAS and AS level, </condition> the MME should <action> initiate the necessary procedures to achieve a re-alignment. </action> </control>
6.4.3.5 Abnormal cases in the UE
Apart from the case described in subclause 6.3.3, no abnormal cases have been identified.
6.4.3.6 Abnormal cases on the network side
<control> The following abnormal cases can be identified: <control> <condition> a) Expiry of timer T3486: On the first expiry of the timer T3486, </condition> the MME shall <action> resend the MODIFY EPS BEARER CONTEXT REQUEST </action> and shall <action> reset and restart timer T3486. </action> </control> <control> This retransmission <action> is repeated four times, </action> i.e. <control> <condition> on the fifth expiry of timer T3486, </condition> the MME shall <action> abort the procedure </action> and <end_state> enter the state BEARER CONTEXT ACTIVE. </end_state> </control> </control> </control>
<control> The MME may <action> continue to use the previous configuration of the EPS bearer context </action> or <action> initiate an EPS bearer context deactivation procedure. </action> </control>
<control> <condition> <condition> b) Collision of UE requested PDN disconnect procedure and EPS bearer context modification: </condition> <condition> When the MME receives a PDN DISCONNECT REQUEST message during an EPS bearer context modification procedure, and the EPS bearer to be modified belongs to the PDN connection the UE wants to disconnect, </condition> </condition> the MME shall <action> terminate the EPS bearer context modification procedure locally, </action> <action> release any resources related to this procedure </action> and <action> proceed with the PDN disconnect procedure. </action> </control>
6.4.4 EPS bearer context deactivation procedure
6.4.4.1 General
The purpose of the EPS bearer context deactivation procedure is to deactivate an EPS bearer context or disconnect from a PDN by deactivating all EPS bearer contexts to the PDN. The EPS bearer context deactivation procedure is initiated by the network, and it may be triggered by the UE by means of the UE requested bearer resource modification procedure or UE requested PDN disconnect procedure.
<control> <condition> <condition> In the case of EPS bearer context deactivation with reactivation requested for a PDN connection, </condition> if <condition> no NAS signalling connection exists, </condition> </condition> the MME <action> follows the procedures for re-establishing the NAS signalling connection and deactivating the EPS bearer contexts to the PDN with reactivation requested, as specified in 3GPP TS 23.401 subclauses 5.4.4.1 and 5.10.3 and 3GPP TS 23.380 subclause 5.4.2.1. </action> </control>
<control> If <condition> <condition> a UE is receiving emergency bearer services from a CSG cell, </condition> and <condition> the CSG subscription expires or is removed, </condition> </condition> the MME shall <action> deactivate all non-emergency EPS bearers if any. </action> </control> <control> The MME shall <action> not deactivate the emergency EPS bearers. </action> </control>
<control> If <condition> a detach is requested by the HSS for a UE that has bearers for emergency services, </condition> the MME shall <action> send a DEACTIVATE EPS BEARER CONTEXT REQUEST message to the UE for all bearers that are not allocated for emergency services. </action> </control>
6.4.4.2 EPS bearer context deactivation initiated by the network
<control> If <condition> a NAS signalling connection exists when the MME initiates the EPS bearer context deactivation procedure, </condition> the MME shall <action> initiate the EPS bearer context deactivation procedure by sending a DEACTIVATE EPS BEARER CONTEXT REQUEST message to the UE, </action> <action> start the timer T3495, </action> and <end_state> enter the state BEARER CONTEXT INACTIVE PENDING (see example in figure 6.4.4.2.1). </end_state> </control> <control> The DEACTIVATE EPS BEARER CONTEXT REQUEST message <action> contains an ESM cause typically indicating one of the following: </action> #8: operator determined barring; #26: insufficient resources; #29: user authentication or authorization failed; #36: regular deactivation; #38: network failure; #39: reactivation requested; #112: APN restriction value incompatible with active EPS bearer context; or #113: Multiple accesses to a PDN connection not allowed. </control>
<control> <condition> If the deactivation is triggered by a UE initiated bearer resource modification procedure or UE requested PDN disconnect procedure, </condition> <action> the DEACTIVATE EPS BEARER CONTEXT REQUEST message shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE MODIFICATION REQUEST or PDN DISCONNECT REQUEST respectively. </action> </control>
<control> <condition> When the MME wants to deactivate all EPS bearer contexts of a PDN connection and thus disconnect the UE from the PDN, </condition> the MME shall <action> include the EPS bearer identity of the default bearer associated to the PDN in the DEACTIVATE EPS BEARER CONTEXT REQUEST message. </action> </control> <control> <condition> In this case, </condition> the MME shall <action> not include the WLAN offload indication in the DEACTIVATE EPS BEARER CONTEXT REQUEST message, </action> and <control> if <condition> the UE receives the WLAN offload indication, </condition> the UE shall <action> ignore the indication. </action> </control> </control>
<control> <condition> If no NAS signalling connection exists when the MME initiates the EPS bearer context deactivation, </condition> the ESM entity in the MME shall <action> locally deactivate the EPS bearer context towards the UE without any peer-to-peer ESM signalling between the MME and the UE. </action> </control>
NOTE: <control> The EPS bearer context state(s) <action> can be synchronized </action> between the UE and the MME <condition> at the next EMM- IDLE to EMM-CONNECTED transition, </condition> e.g. during a service request or tracking area updating procedure. </control>
6.4.4.3 EPS bearer context deactivation accepted by the UE
<control> <condition> Upon receipt of the DEACTIVATE EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> delete the EPS bearer context identified by the EPS bearer identity. </action> </control> <control> <condition> After deactivating the identified EPS bearer context, </condition> the UE shall <action> respond to the MME with the DEACTIVATE EPS BEARER CONTEXT ACCEPT. </action> </control>
<control> If <condition> the EPS bearer identity indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST is that of the default bearer to a PDN, </condition> the UE shall <action> delete all EPS bearer contexts associated to the PDN. </action> </control> <control> <condition> After deactivating all EPS bearer contexts, </condition> the UE shall <action> respond to the MME with the DEACTIVATE EPS BEARER CONTEXT ACCEPT. </action> </control>
<control> <condition> Upon sending the DEACTIVATE EPS BEARER CONTEXT ACCEPT message, </condition> the UE shall <end_state> enter the state BEARER CONTEXT INACTIVE. </end_state> </control> <control> If <condition> due to the EPS bearer context deactivation only the PDN connection for emergency bearer services remains established, </condition> the UE shall <action> consider itself attached for emergency bearer services only. </action> </control>
<control> If <condition> <condition> the DEACTIVATE EPS BEARER CONTEXT REQUEST includes ESM cause #39 "reactivation requested" </condition> and <condition> the EPS bearer context is a default EPS bearer context, </condition> and <condition> the UE provided an APN for the establishment of the PDN connection, </condition> </condition> <control> the UE shall <action> stop timer T3396 </action> if <condition> it is running for the APN provided by the UE. </condition> </control> </control> <control> The UE should <action> then re- initiate the UE requested PDN connectivity procedure for the same APN as the deactivated default EPS bearer context to reactivate the EPS bearer context. </action> </control> <control> If <condition> the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", </condition> <control> the UE shall <action> stop the timer T3396 </action> associated with no APN if <condition> it is running, </condition> </control> and should <action> re-initiate the UE requested PDN connectivity procedure without including an APN. </action> </control> <control> Additionally, the UE should <action> re-initiate the request(s) for dedicated bearer resources that have been activated on request of the UE and released as a result of this EPS bearer context deactivation procedure. </action> </control> <control> If <condition> the DEACTIVATE EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, </condition> <control> the UE shall <action> not stop the timer T3396 </action> associated with no APN if <condition> it is running. </condition> </control> </control> <control> The UE should then <action> re- initiate the UE requested PDN connectivity procedure for the emergency PDN connection. </action> </control>
NOTE 1: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer context(s) automatically.
NOTE 2: The UE behaviour is not specified for the case where the DEACTIVATE EPS BEARER CONTEXT REQUEST includes ESM cause #39 "reactivation requested" and the deactivated EPS bearer context was a dedicated EPS bearer context.
<control> If <condition> the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 ), </condition> the UE <action> uses the PTI to identify the UE requested bearer resource modification procedure or UE requested PDN disconnect procedure to which the EPS bearer context deactivation is related (see subclause 6.5.4). </action> </control>
<control> If <condition> the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 ), </condition> the UE shall <action> release the traffic flow aggregate description associated to the PTI value provided. </action> </control>
<control> If <condition> the ESM cause value is #26 "insufficient resources", </condition> the network may <action> include a value for timer T3396 </action> in the DEACTIVATE EPS BEARER CONTEXT REQUEST message. </control> <control> The UE shall <action> take different actions depending on the timer value received for timer T3396 </action> (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.5): <control> i) if <condition> the timer value indicates neither zero nor deactivated, </condition> the UE shall <action> stop timer T3396 associated with the corresponding APN, </action> if <condition> it is running. </condition> </control> </control> <control> The UE shall <action> start timer T3396 with received value </action> and <action> not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN </action> <condition> until timer T3396 expires or the timer T3396 is stopped. </condition> </control> <control> If <condition> the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", </condition> the UE shall <action> stop timer T3396 associated with no APN, </action> if <condition> it is running. </condition> </control> <control> The UE shall <action> start timer T3396 with the received value </action> and <action> not send another PDN CONNECTIVITY REQUEST message </action> without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non- emergency PDN connection established without an APN provided by the UE, <condition> until timer T3396 expires or timer T3396 is stopped. </condition> </control> <control> The UE shall <action> not stop timer T3396 upon a PLMN change or inter-system change; </action> <control> ii) if <condition> the timer value indicates that this timer is deactivated, </condition> the UE shall <action> not send another PDN CONNECTIVITY REQUEST, </action> BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. </control> </control> <control> If <condition> the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", </condition> the UE shall <action> not send another PDN CONNECTIVITY REQUEST message </action> without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE , <condition> <condition> until the UE is switched off </condition> or <condition> the USIM is removed, </condition> or <condition> the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message </condition> for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection <condition> without an APN provided by the UE. </condition> </condition> </control> <control> The timer T3396 <action> remains deactivated </action> <condition> upon a PLMN change or inter-system change; </condition> and <control> iii) if <condition> the timer value indicates zero, </condition> the UE: a) shall <action> stop timer T3396 </action> associated with the corresponding APN, if running, and may <action> send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; </action> and <control> b) if <condition> <condition> the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> the UE shall <action> stop timer T3396 associated with no APN, </action> if running, and may <action> send another PDN CONNECTIVITY REQUEST message without an APN </action> , or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE. </control> </control> </control>
<control> If <condition> the timer T3396 is running </condition> when the UE <start_state> enters state EMM-DEREGISTERED, </start_state> the UE <action> remains switched on, </action> and <action> the USIM in the UE remains the same, </action> <control> then <action> timer T3396 is kept </action> running <condition> until it expires or it is stopped. </condition> </control> </control>
<control> If <condition> the UE is switched off when the timer T3396 is running, </condition> the UE shall <action> behave as follows </action> <condition> <condition> when the UE is switched on </condition> and <condition> the USIM in the UE remains the same: </condition> </condition> <control> a) <action> let t1 be the time remaining for T3396 timeout at switch off </action> and <action> let t be the time elapsed between switch off and switch on. </action> </control> <control> If <condition> t1 is greater than t, </condition> then the timer shall <action> be restarted with the value t1 t. </action> </control> <control> If <condition> t1 is equal to or less than t, </condition> then the timer <action> need not be restarted. </action> </control> <control> If <condition> the UE is not capable of determining t, </condition> then the UE shall <action> restart the timer with the value t1; </action> <control> b) if <condition> prior to switch off, </condition> timer T3396 <action> was running for a specific APN, </action> because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" <action> was rejected with timer T3396, </action> and <control> if <condition> timer T3396 is restarted at switch on, </condition> then the UE configured for dual priority shall <action> handle session management requests as indicated in subclause 6.5.5; </action> </control> </control> and <control> c) if <condition> prior to switch off timer T3396 was running </condition> because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" <action> was rejected with timer T3396, </action> </control> and <control> if <condition> timer T3396 is restarted at switch on, </condition> then the UE configured for dual priority shall <action> handle session management requests as indicated in subclause 6.5.5. </action> </control> </control> </control>
<control> If <condition> the T3396 IE is not included, </condition> the UE shall <action> proceed with deactivation procedure </action> and <action> then send DEACTIVATE EPS BEARER CONTEXT ACCEPT message. </action> </control>
<control> <condition> Upon receipt of the DEACTIVATE EPS BEARER CONTEXT ACCEPT message, </condition> the MME shall <end_state> enter the state BEARER CONTEXT INACTIVE </end_state> and <action> stop the timer T3495. </action> </control>
6.4.4.4 Abnormal cases in the UE
<control> The following abnormal case can be identified: <condition> <condition> a) UE is requested to deactivate a default EPS bearer context of the last PDN connection: </condition> If <condition> EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> and <condition> the UE determines that the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is the default EPS bearer of the last PDN connection that the UE has, </condition> </condition> then the UE shall <action> respond by performing a detach procedure. </action> </control> <control> Additionally, the UE should <action> perform an attach procedure. </action> </control>
<control> If <condition> EMM-REGISTERED without PDN connection is supported </condition> by the UE and the MME, the UE shall <action> proceed with the deactivation procedure as specified in subclause 6.4.4.3. </action> </control>
NOTE: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s), if any, automatically.
6.4.4.5 Abnormal cases on the network side
<control> The following abnormal cases can be identified: <condition> <condition> a) Expiry of timer T3495: </condition> <condition> On the first expiry of the timer T3495, </condition> </condition> the MME shall <action> resend the DEACTIVATE EPS BEARER CONTEXT REQUEST </action> and shall <action> reset and restart timer T3495. </action> </control> <control> <action> This retransmission is repeated four times, </action> i.e. <control> <condition> on the fifth expiry of timer T3495, </condition> the MME shall <action> abort the procedure </action> and <action> deactivate the EPS bearer context locally </action> without any peer-to-peer ESM signalling between the MME and the UE. </control> </control>
<control> <condition> <condition> b) Collision of UE requested PDN disconnect procedure and EPS bearer context deactivation: </condition> <condition> When the MME receives a PDN DISCONNECT REQUEST message during the EPS bearer context deactivation procedure, </condition> <condition> and the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a dedicated EPS bearer belonging to the PDN connection the UE wants to disconnect, </condition> </condition> the MME shall <action> proceed with both procedures. </action> </control> <control> If <condition> the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is the default EPS bearer, </condition> the MME shall <action> proceed with the EPS bearer context deactivation procedure. </action> </control>
6.4.4.6 Local EPS bearer context deactivation without NAS signalling
<control> The UE and the MME deactivate EPS bearer contexts locally without peer-to-peer ESM signalling in the following cases: <condition> <condition> 1) during the service request procedure, </condition> if <condition> the E-UTRAN establishes the user plane radio bearers for one or more EPS bearer contexts but not for all the EPS bearer contexts, </condition> </condition> e.g. due to radio access control (see subclause 5.6.1.4 for details); </control>
<control> <condition> <condition> 1a) during the resume of NAS signalling connection procedure as specified in subclause 5.3.1.3, </condition> if <condition> one or more but not all the suspended user plane radio bearers are resumed; </condition> </condition> </control>
<control> <condition> <condition> 2) during the tracking area updating procedure but the network established the user plane radio bearers due to downlink pending data, </condition> if <condition> the E-UTRAN establishes the user plane radio bearers for one or more EPS bearer contexts but not for all the EPS bearer contexts indicated active by both UE and network; </condition> </condition> </control> NOTE 1: The synchronisation of the EPS bearers, for which the user plane radio bearers need to be established, indicated in EPS bearer context status information element in TRACKING AREA UPDATE ACCEPT message is not applicable in item 2.
<control> <condition> <condition> 3) during handover, </condition> if <condition> the target E-UTRAN does not establish all the user plane radio bearers for the UE; </condition> </condition> </control>
<control> 4) if <condition> the E-UTRAN releases one or more user plane radio bearers but not all the user plane radio bearers of the UE due to E-UTRAN specific reasons; or </condition> </control>
<control> 5) if <condition> triggered by an NBIFOM procedure (see 3GPP TS 24.161 ), for an NBIFOM multi-access PDN connection. </condition> </control>
<control> <condition> For cases 1) to 4), </condition> based on the indication from the lower layers, the UE and the MME shall <action> locally deactivate the EPS bearer contexts for which no user plane radio bearers are set up. </action> </control>
NOTE 2: The above cases 1) to 4) do not apply for the UE when an RRC connection release occurs. <control> The lower layers in the UE <action> provide the user plane radio bearer context status </action> to the ESM sublayer when a change in the user plane radio bearers is detected by the lower layers including establishment and release of user plane radio bearers for the UE in connected mode. </control>
NOTE 3: The above cases 1) to 4) do not apply for the MME when the S1 release procedure occurs as specified in 3GPP TS 23.401 ).
<control> If <condition> due to any of the cases described above the UE locally deactivates a default EPS bearer context, </condition> the UE shall <action> locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context. </action> </control>
<control> If <condition> <condition> the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection, </condition> and <condition> EMM- REGISTERED without PDN connection is not supported by the UE or the MME, </condition> </condition> the UE shall <action> perform a local detach </action> and <end_state> enter state EMM-DEREGISTERED. </end_state> </control> <control> If <condition> this occurs during a service request procedure for CS fallback, </condition> the UE shall <action> reselect to GERAN or UTRAN </action> and <action> continue with the CS service, </action> <control> <condition> otherwise </condition> the UE shall <action> initiate an attach procedure. </action> </control> </control>
<control> If <condition> <condition> the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection, </condition> and <condition> EMM- REGISTERED without PDN connection is supported by the UE and the MME, </condition> </condition> the UE shall <end_state> enter state EMM- REGISTERED. </end_state> </control>
<control> If <condition> <condition> the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection for non-emergency bearer services </condition> and <condition> only the PDN connection for emergency bearer services remains established, </condition> </condition> the UE shall <action> consider itself attached for emergency bearer services only. </action> </control>
<control> The MME shall <action> deactivate the GBR EPS bearer contexts locally without peer-to-peer ESM signalling, </action> <condition> when the MME performs locally </condition> the release of the S1AP signalling connection due to the S1AP signalling connection is lost. </control> <control> All non- GBR EPS bearers established <action> are preserved in the MME and in the PDN GW. </action> </control>
<control> If <condition> the E-UTRAN requests the MME to release the S1AP signalling connection, </condition> the MME shall <action> deactivate or preserve the GBR EPS bearer contexts according to 3GPP TS 23.401 , </action> subclause 5.3.5. </control> <control> All non-GBR EPS bearer contexts established <action> are preserved </action> in the MME and in the PDN GW. </control>
NOTE 4: <control> The UE and the MME <action> will synchronize the EPS bearer contexts subsequently </action> <condition> during the next service request procedure, </condition> tracking area updating procedure or routing area updating procedure. </control>
<control> If <condition> due to any of the cases described above the MME locally deactivates a default EPS bearer context, </condition> the MME shall <action> locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. </action> </control>
<control> If <condition> <condition> the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection, </condition> and <condition> EMM- REGISTERED without PDN connection is not supported by the UE or the MME, </condition> </condition> the MME shall <action> perform a local detach </action> and <end_state> enter state EMM-DEREGISTERED. </end_state> </control>
<control> If <condition> <condition> the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection, </condition> and <condition> EMM- REGISTERED without PDN connection is supported by the UE and the MME, </condition> </condition> the MME shall <end_state> enter state EMM- REGISTERED. </end_state> </control>
<control> For EPS bearer context deactivation procedure initiated by the network, if <condition> no NAS signalling connection exists, </condition> the MME <action> locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling </action> </control> <control> <condition> In the case of reactivation requested, </condition> the MME <action> can perform this local deactivation </action> <condition> only when the EMM-entity in the network was unable to re- establish the NAS signalling connection. </condition> </control> <control> The EPS bearer context deactivation procedure <action> is not initiated </action> by the network when the MME disconnects the UE from the last remaining PDN to which it is connected and EMM-REGISTERED without PDN connection is not supported by the UE or the MME. </control> <control> <condition> In this case, </condition> the MME <action> initiates a network initiated detach procedure. </action> </control>
<control> If <condition> <condition> the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection for non-emergency bearer services </condition> and <condition> only the PDN connection for emergency bearer services remains established for the UE, </condition> </condition> the MME shall <action> consider the UE to be attached for emergency bearer services only. </action> </control>
6.5 UE requested ESM procedures
6.5.0 General
The UE's maximum number of active EPS bearer contexts in a PLMN is determined by whichever is the lowest of the maximum number of EPS bearer identities allowed by the protocol (as specified in 3GPP TS 24.007 subclause 11.2.3.1.5), the PLMN's maximum number of EPS bearer contexts in S1 mode and the UE's implementation- specific maximum number of EPS bearer contexts.
NOTE 1: Subclauses 6.5.1.4 and 6.5.3.4 specify how the UE determines the PLMN's maximum number of EPS bearer contexts in S1 mode.
<control> <condition> In earlier versions of the protocol, </condition> the maximum number of simultaneously active EPS bearer contexts <action> was limited by lower layer protocols to 8. </action> </control>
<control> <condition> In the present version of the protocol, </condition> the UE and the network may <action> support a maximum number of 15 EPS bearer contexts. </action> </control>
<control> A UE supporting signalling for a maximum number of 15 EPS bearer contexts shall <action> support the extended range or EPS bearer identities from 0 to 15 </action> (as specified in 3GPP TS 24.007 subclause 11.2.3.1.5). </control> <control> The UE <action> indicates support of signalling </action> for a maximum number of 15 EPS bearer contexts by setting the 15 bearers bit in the UE Network Capability IE. </control>
<control> A network supporting signalling for a maximum number of 15 EPS bearer contexts shall <action> support the extended range or EPS bearer identities from 0 to 15 (as specified in 3GPP TS 24.007 subclause 11.2.3.1.5). </action> </control> <control> The network <action> indicates support of signalling for a maximum number of 15 EPS bearer contexts by setting the 15 bearers bit in the EPS network feature support IE. </action> </control>
NOTE 2: <control> A UE and a network not supporting signalling for a maximum number of 15 EPS bearer contexts <action> will treat the EPS bearer identity values 1 to 4 as 'reserved' values. </action> </control>
<control> <condition> For a UE in NB-S1 mode, </condition> the UE's implementation-specific maximum number of active user plane radio bearers <action> is 2 </action> (as defined in 3GPP TS 36.300 ) <condition> <condition> when the UE sets the Multiple DRB support bit to "Multiple DRB supported" </condition> <condition> during attach or tracking area updating procedures, and 1 otherwise. </condition> </condition> </control>
<control> <condition> Upon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single- registration mode, </condition> <control> if: <condition> a) the number of active default EPS bearer contexts in the UE is larger than the UE's implementation-specific maximum number of active user plane radio bearers; </condition> and <condition> b) the UE is using user plane CIoT EPS optimization; </condition> </control> the UE shall <action> locally deactivate at least one default EPS bearer context such that the total number of active default EPS bearer contexts that remained does not exceed the UE's implementation-specific maximum number of active user plane radio bearers. </action> </control> <control> <condition> In this case, </condition> choosing which EPS bearer context to deactivate <action> is implementation specific. </action> </control> <control> The UE shall <action> then include the EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message. </action> </control>
6.5.1 UE requested PDN connectivity procedure
6.5.1.1 General
The purpose of the UE requested PDN connectivity procedure is for a UE to request the setup of a default EPS bearer to a PDN. The UE requests connectivity to a PDN by sending a PDN CONNECTIVITY REQUEST message to the network. If accepted by the network, this procedure initiates the establishment of a default EPS bearer context. If EMM- REGISTERED without PDN connection is not supported by the UE or the MME, the procedure is used either to establish the first default bearer by including the PDN CONNECTIVITY REQUEST message into the initial attach message, or to establish subsequent default bearers to additional PDNs in order to allow the UE simultaneous access to multiple PDNs by sending the message stand-alone. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the procedure is used to establish the first or subsequent default bearers to a PDN or additional PDNs by sending the PDN CONNECTIVITY REQUEST message stand-alone.
<control> If <condition> the UE requests PDN connectivity for emergency bearer services, </condition> the MME shall <action> not check for regional restrictions or subscription restrictions </action> <condition> when processing the PDN CONNECTIVITY REQUEST message. </condition> </control>
<control> If <condition> there is already a PDN connection for emergency bearer services established, </condition> the UE shall <action> not request an additional PDN connection for emergency bearer services. </action> </control>
<control> A UE attached for emergency bearer services shall <action> not request a PDN connection to any other PDN. </action> </control>
<control> A UE attached for access to RLOS shall <action> not request any additional PDN connection for RLOS nor any PDN connection to any other PDN. </action> </control>
<control> The UE <action> may also initiate the UE requested PDN connectivity procedure </action> to add 3GPP access to the PDN connection which is already established over WLAN as specified in the subclause 6.2.2 of 3GPP TS 23.161 . </control>
<control> The UE may also <action> initiate the UE requested PDN connectivity procedure </action> to transfer an existing PDU session in the 5GS to EPS as specified in 3GPP TS 24.501 . </control>
<control> If <condition> <condition> the UE supports the device triggering short message </condition> as specified in 3GPP TS 23.040 and supports non-IP PDN type, then <condition> upon receiving from ESMS entity as specified in 3GPP TS 24.007 an indication requesting establishment of a PDN connection for non-IP PDN type using the default APN as specified in 3GPP TS 24.011 , </condition> </condition> the UE shall <action> initiate the UE requested PDN connectivity procedure in order to request connectivity to a PDN using the default APN and non-IP PDN type. </action> </control>
6.5.1.2 UE requested PDN connectivity procedure initiation
<control> In order to request connectivity to a PDN, the UE shall <action> send a PDN CONNECTIVITY REQUEST message to the MME, </action> <action> start timer T3482 </action> and <end_state> enter the state PROCEDURE TRANSACTION PENDING </end_state> (see example in figure 6.5.1.2.1). </control>
<control> <condition> When the PDN CONNECTIVITY REQUEST message is sent together with an ATTACH REQUEST message, </condition> <action> the UE shall not start timer T3482 </action> and shall <action> not include the APN. </action> </control>
NOTE 1: <control> If <condition> <condition> the UE needs to provide protocol configuration options which require ciphering or provide an APN, </condition> <condition> or both, </condition> <condition> during the attach procedure, </condition> </condition> the ESM information transfer flag <action> is included in the PDN CONNECTIVITY REQUEST. </action> </control> <control> The MME then at a later stage in the PDN connectivity procedure initiates the ESM information request procedure in which the UE <action> can provide the MME with protocol configuration options or APN or both. </action> </control>
<control> In order to request a PDN connection for emergency bearer services or for access to RLOS, the UE shall <action> not include an APN in the PDN CONNECTIVITY REQUEST message </action> or, when applicable, in the ESM INFORMATION RESPONSE message. </control>
<control> In order to request connectivity to a PDN using the default APN, the UE <action> includes the access point name IE in the PDN CONNECTIVITY REQUEST message </action> or, when applicable, in the ESM INFORMATION RESPONSE message, according to the following conditions: <control> a) if <condition> use of a PDN using the default APN requires PAP/CHAP, </condition> then <action> the UE should include the Access point name IE; </action> </control> <control> and b) <condition> in all other conditions, </condition> the UE <action> need not include the Access point name IE. </action> </control> </control>
<control> In order to request connectivity to an additional PDN using a specific APN, the UE shall <action> include the requested APN in the PDN CONNECTIVITY REQUEST message. </action> </control>
<control> In the PDN type IE the UE shall <action> either indicate the IP version capability of the IP stack associated with the UE </action> or non IP or Ethernet as specified in subclause 6.2.2. </control>
<control> If <condition> <condition> the PDN type value of the PDN type IE is set to IPv4 or IPv6 or IPv4v6 </condition> and <condition> the UE indicates "Control plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message, </condition> </condition> the UE <action> may include the Header compression configuration IE in the PDN CONNECTIVITY REQUEST message. </action> </control>
<control> The UE shall <action> set the request type to "initial request" </action> <condition> <condition> when the UE is establishing a new PDN connectivity to a PDN in an attach procedure or in a stand-alone PDN connectivity procedure </condition> or <condition> when the UE is a 5G-RG and requests establishment of a PDN connection as a user-plane resource of an MA PDU session to be established. </condition> </condition> </control> <control> The UE shall <action> set the request type to "emergency" </action> <condition> when the UE is requesting a new PDN connectivity for emergency bearer services. </condition> </control> <control> The UE shall <action> set the request type to "handover" </action> <condition> <condition> when the connectivity to a PDN is to be transferred from a non-3GPP access network to the 3GPP access network, </condition> <condition> when the UE initiates the procedure to add 3GPP access to the PDN connection which is already established over WLAN, when the UE supporting N1 mode requests transfer of an existing non- emergency PDU session in 5GS </condition> or <condition> when the UE is a 5G-RG and requests establishment of a PDN connection as a user- plane resource of an already established MA PDU session. </condition> </condition> </control> <control> The UE shall <action> set the request type to "handover of emergency bearer services" </action> <condition> <condition> when a PDN connection for emergency bearer services is to be transferred from a WLAN to the 3GPP access network </condition> or <condition> when the UE supporting N1 mode requests transfer of an existing emergency PDU session in 5GS. </condition> </condition> </control>
<control> The UE shall <action> set the request type to "RLOS" </action> <condition> when the UE is requesting a new PDN connection for RLOS. </condition> </control>
<control> If <condition> the UE supports DSMIPv6, </condition> the UE <action> may include a request for obtaining the IPv6 address and optionally the IPv4 address of the home agent in the Protocol configuration options IE in the PDN CONNECTIVITY REQUEST message. </action> </control>
<control> The UE <action> may also include a request for obtaining the IPv6 Home Network Prefix. </action> </control> <control> The UE shall <action> request the IPv6 Home Network Prefix </action> <condition> only if the UE has requested the home agent IPv6 address. </condition> </control> <control> The requested home agent address(es) and the Home Network Prefix <action> are related to the APN the UE requested connectivity for. </action> </control>
<control> The UE <action> may set the ESM information transfer flag in the PDN CONNECTIVITY REQUEST message </action> to indicate that it has ESM information, i.e. protocol configuration options, APN, or both, that needs to be sent after the NAS signalling security has been activated between the UE and the MME. </control>
<control> If <condition> the UE supports A/Gb mode or Iu mode or both, </condition> the UE shall <action> indicate the support of the network requested bearer control procedures (see 3GPP TS 24.008 ) in A/Gb mode or Iu mode in the protocol configuration options IE. </action> </control>
<control> If <condition> the UE supports N1 mode and the request type is: a) "initial request" or "emergency", </condition> the UE shall <action> generate a PDU session ID, </action> <action> associate the PDU session ID with the PDN connection that is being established, </action> and <action> include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE; </action> <control> <condition> <condition> b) "handover" or "handover of emergency bearer services", </condition> and <condition> the UE requests: 1) transfer of an existing PDU session in 5GS or establishment of a PDN connection as a user-plane resource of an already established MA PDU session, </condition> </condition> the UE shall <action> associate the PDU session ID of the PDU session with the PDN connection that is being established for the existing PDU session and include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE; </action> </control> or </control>
<control> <condition> 2) transfer of an existing PDN connection in a non-3GPP access connected to the EPC and a PDU session ID is associated with the existing PDN connection, </condition> the UE shall <action> include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE. </action> </control>
NOTE 2: <control> The UE can also <action> have an S-NSSAI associated with the PDN connection, </action> if <condition> the S-NSSAI was provided by the network during the PDN connection establishment via non-3GPP access to EPC (see 3GPP TS 24.302 ). </condition> </control> <control> The UE <action> stores this S-NSSAI for later use </action> <condition> during inter-system change from S1 mode to N1 mode. </condition> </control>
<control> If <condition> the UE supporting N1 mode supports receiving QoS rules with the length of two octets or QoS flow descriptions with the length of two octets via the extended protocol configuration options IE, </condition> the UE shall <action> include the QoS rules </action> with the length of two octets support indicator or the QoS flow descriptions with the length of two octets support indicator, respectively, in the protocol configuration options IE or the extended protocol configuration options IE. </control>
<control> Protocol configuration options provided in the ESM INFORMATION RESPONSE message <action> replace any protocol configuration options provided in the PDN CONNECTIVITY REQUEST message. </action> </control>
<control> <condition> When the UE initiates the procedure to add 3GPP access to the PDN connection that is already established over WLAN, </condition> the UE shall <action> provide the same APN as that of the PDN connection established over WLAN in the PDN connectivity procedure as specified in the subclause 6.2.2 of 3GPP TS 23.161 . </action> </control>
<control> If <condition> the UE supports APN rate control, </condition> the UE shall <action> include an APN rate control support indicator and an additional APN rate control for exception data support indicator in the protocol configuration options IE or extended protocol configuration options IE. </action> </control>
<control> If <condition> the UE supports DNS over (D)TLS (see 3GPP TS 33.501 ), </condition> the UE shall <action> include the extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST message </action> and <action> include DNS server security information indicator. </action> </control>
NOTE 3: Support of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.501 .
6.5.1.3 UE requested PDN connectivity procedure accepted by the network
<control> <condition> Upon receipt of the PDN CONNECTIVITY REQUEST message, </condition> the MME <action> checks whether the ESM information transfer flag is included. </action> </control> <control> If <condition> the flag is included </condition> the MME <action> waits for completion </action> of the ESM information request procedure before proceeding with the PDN connectivity procedure. </control> <control> The MME then <action> checks if connectivity with the requested PDN can be established. </action> </control> <control> If <condition> no requested APN is included in the PDN CONNECTIVITY REQUEST message or the ESM INFORMATION RESPONSE message and the request type is different from "emergency" and from "handover of emergency bearer services" and from "RLOS", </condition> the MME shall <action> use the default APN as the requested APN. </action> </control>
<control> If <condition> the request type is "emergency" or "handover of emergency bearer services", </condition> the MME shall <action> use the APN configured for emergency bearer services </action> or <action> select the statically configured PDN GW for unauthenticated UEs, if applicable. </action> </control> <control> If <condition> the request type is "RLOS", </condition> the MME shall <action> use the APN configured for RLOS. </action> </control>
<control> If <condition> the network receives a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing PDN connection, and multiple PDN connections for a given APN are allowed, </condition> the network <action> retains the existing EPS bearer contexts for the PDN connection and proceeds with the requested PDN connectivity procedure. </action> </control>
<control> If <condition> <condition> the lower layers provide a GW Transport Layer Address value identifying a L-GW together with the PDN CONNECTIVITY REQUEST message </condition> and <condition> a PDN connection is established as a LIPA PDN connection due to the PDN CONNECTIVITY REQUEST message, </condition> </condition> then the MME shall <action> store the GW Transport Layer Address value as the P-GW address in the EPS bearer context of the LIPA PDN connection. </action> </control>
<control> If <condition> <condition> the lower layers provide a SIPTO L-GW Transport Layer Address value identifying a L-GW together with the PDN CONNECTIVITY REQUEST message </condition> and <condition> a PDN connection is established as a SIPTO at the local network PDN connection due to the PDN CONNECTIVITY REQUEST message, </condition> </condition> then the MME shall <action> store the SIPTO L-GW Transport Layer Address value as the P-GW address in the EPS bearer context of the SIPTO at the local network PDN connection. </action> </control>
<control> If <condition> the lower layers provide a LHN-ID value together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a SIPTO at the local network PDN connection due to the PDN CONNECTIVITY REQUEST message, </condition> then the MME shall <action> store the LHN-ID value in the EPS bearer context of the SIPTO at the local network PDN connection. </action> </control>
NOTE: The receipt of a LHN-ID value during the establishment of the PDN connection, during tracking area updating procedure or during inter-MME handover can be used as an indication by the MME that the SIPTO at the local network PDN connection is established to a stand-alone GW (see 3GPP TS 23.401 ).
<control> If <condition> connectivity with the requested PDN is accepted by the network, </condition> the MME shall <action> initiate the default EPS bearer context activation procedure (see subclause 6.4.1). </action> </control>
<control> If <condition> connectivity with the requested PDN is accepted and the network considers this PDN connection a LIPA PDN connection, </condition> then subject to operator policy the MME shall <action> include in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message the Connectivity type IE indicating "the PDN connection is considered a LIPA PDN connection". </action> </control>
<control> If <condition> <condition> connectivity with the requested PDN is accepted, </condition> <condition> but with a restriction of IP version (i.e. both an IPv4 address and an IPv6 prefix is requested, </condition> <condition> but only one particular IP version, </condition> or <condition> </condition> only single IP version bearers are supported/allowed by the network), </condition> ESM cause #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", or #52 "single address bearers only allowed", respectively, shall <action> be included in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. </action> </control>
<control> If <condition> <condition> connectivity with the requested PDN is accepted </condition> and <condition> the UE provided the Header compression configuration IE in the PDN CONNECTIVITY REQUEST message, </condition> </condition> the MME may <action> include the Header compression configuration IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. </action> </control> <control> Furthermore, if <condition> the MME decides that the associated PDN connection is only for control plane CIoT EPS optimization (see subclause 5.3.15), </condition> the MME shall <action> include the Control plane only indication in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. </action> </control>
<control> <condition> Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> the UE shall <action> stop timer T3482 </action> and <end_state> enter the state PROCEDURE TRANSACTION INACTIVE. </end_state> </control> <control> The UE should <action> ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. </action> </control> The way to achieve this is implementation dependent. <control> <condition> While the PTI value is not released, </condition> the UE <action> regards any received ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see subclause 7.3.1). </action> </control>
<control> <condition> Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the Connectivity type IE indicating "the PDN connection is considered a LIPA PDN connection", </condition> the UE <action> provides an indication to the upper layers that the connectivity is provided by a LIPA PDN connection. </action> </control>
<control> <condition> <condition> Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> if <condition> the 3GPP PS data off UE status is "activated", </condition> </condition> the UE <action> behaves as described in subclause 6.3.10. </action> </control>
<control> <condition> <condition> Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> if <condition> the SCEF or P-GW indicates acceptance of use of Reliable Data Service to transfer data for the PDN connection, </condition> </condition> the UE <action> behaves as described in subclause 6.3.11. </action> </control>
<control> <condition> <condition> Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, </condition> if <condition> an S-NSSAI and the PLMN ID that this S-NSSAI relates to are provided in the protocol configuration options IE or extended protocol configuration options IE, </condition> </condition> the UE shall <action> delete the stored S-NSSAI, </action> if any, and shall <action> store the S-NSSAI provided in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and the associated PLMN ID along with the corresponding PDU session ID that the UE provided in the PDN CONNECTIVITY REQUEST message. </action> </control> The usage of the PDU session ID and the corresponding S-NSSAI with the associated PLMN ID is specified in 3GPP TS 24.501 .
<control> <condition> Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with a session-AMBR and QoS rule(s), </condition> which correspond to the default EPS bearer of the PDN connectivity being activated, in the protocol configuration options IE or the extended protocol configuration options IE, the UE <action> stores the session-AMBR and QoS rule(s) for use during inter-system change from S1 mode to N1 mode. </action> </control>
6.5.1.4 UE requested PDN connectivity procedure not accepted by the network
6.5.1.4.1 General
<control> If <condition> connectivity with the requested PDN cannot be accepted by the network, </condition> the MME shall <action> send a PDN CONNECTIVITY REJECT message to the UE. </action> </control> <control> The message shall <action> contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested PDN connectivity. </action> </control>
The ESM cause IE typically indicates one of the following ESM cause values: #8: operator determined barring; #26: insufficient resources; #27: missing or unknown APN; #28: unknown PDN type; #29: user authentication or authorization failed; #30: request rejected by Serving GW or PDN GW; #31: request rejected, unspecified; #32: service option not supported; #33: requested service option not subscribed; #34: service option temporarily out of order; #35: PTI already in use; #38: network failure; #50: PDN type IPv4 only allowed; #51: PDN type IPv6 only allowed; #53: ESM information not received; #54: PDN connection does not exist; #55: multiple PDN connections for a given APN not allowed; #57: PDN type IPv4v6 only allowed; #58: PDN type non IP only allowed; #61: PDN type Ethernet only allowed; #65: maximum number of EPS bearers reached; #66: requested APN not supported in current RAT and PLMN combination; #95 111: protocol errors; #112: APN restriction value incompatible with active EPS bearer context; #113: Multiple accesses to a PDN connection not allowed.
<control> The network may <action> include a Back-off timer value IE in the PDN CONNECTIVITY REJECT message. </action> </control> <control> If <condition> <condition> the ESM cause value is #26 "insufficient resources" </condition> and <condition> the PDN CONNECTIVITY REQUEST message was received via a NAS signalling connection established with RRC establishment cause "High priority access AC 11 15" </condition> or <condition> the request type in the PDN CONNECTIVITY REQUEST message was set to "emergency" or "handover of emergency bearer services", </condition> </condition> the network shall <action> not include a Back-off timer value IE. </action> </control>
<control> If <condition> the ESM cause value is #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" or #61 "PDN type Ethernet only allowed", </condition> the network <action> may include the Re-attempt indicator IE without Back-off timer value IE to indicate whether the UE is allowed to attempt a PDN connectivity procedure in an equivalent PLMN for the same APN in S1 mode using the same PDN type. </action> </control>
<control> If <condition> the ESM cause value is #66 "requested APN not supported in current RAT and PLMN combination", </condition> the network <action> may include the Re-attempt indicator IE without Back-off timer value IE </action> to indicate whether the UE is allowed to attempt a PDN connectivity procedure in an equivalent PLMN for the same APN in S1 mode. </control>
<control> <condition> Upon receipt of the PDN CONNECTIVITY REJECT message, </condition> the UE shall <action> stop timer T3482 </action> and <end_state> enter the state PROCEDURE TRANSACTION INACTIVE. </end_state> </control>
<control> If <condition> the PDN CONNECTIVITY REJECT message is due to an ESM failure notified by EMM layer (i.e., EMM cause #19 "ESM failure" included in an ATTACH REJECT message), </condition> the UE <action> may include a different APN in the PDN CONNECTIVITY REQUEST message. </action> </control>
NOTE 1: <control> <condition> When receiving EMM cause #19 "ESM failure", </condition> coordination <action> is required </action> between the EMM and ESM sublayers in the UE to notify the ESM failure. </control>
<control> <condition> If <condition> <condition> the PDN CONNECTIVITY REQUEST message was sent </condition> <condition> with request type set to "emergency" or "handover of emergency bearer services" </condition> <condition> in a stand-alone PDN connectivity procedure </condition> </condition> and <condition> the UE receives a PDN CONNECTIVITY REJECT message, </condition> </condition> then the UE may: <action> a) inform the upper layers of the failure to establish the emergency bearer; </action> or NOTE 2: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN. <control> <action> b) detach locally, </action> <control> if <condition> not detached already, </condition> <action> attempt EPS attach for emergency bearer services. </action> </control> </control> </control>
<control> If <condition> <condition> the PDN CONNECTIVITY REQUEST message was sent with PDN type set to "Ethernet" </condition> and <condition> the UE receives a PDN CONNECTIVITY REJECT message with ESM cause #58 "PDN type non IP only allowed", </condition> </condition> then the UE may <action> attempt a PDN connectivity procedure with the non-IP PDN type. </action> </control>
6.5.1.4.2 Handling of network rejection due to ESM cause #26
<control> If <condition> <condition> the ESM cause value is #26 "insufficient resources" </condition> and <condition> the Back-off timer value IE is included, </condition> </condition> the UE shall <action> ignore the Re-attempt indicator IE provided by the network, </action> if any, and <action> behave as follows: </action> <control> 1) if <condition> the PDN CONNECTIVITY REQUEST message was sent standalone, </condition> the UE shall <action> take different actions </action> depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; </control> <control> if <condition> the UE is a UE configured to use AC11 15 in selected PLMN, </condition> <action> exceptions are specified in subclause 6.3.5): </action> </control> <control> i) if <condition> the timer value indicates neither zero nor deactivated and an APN was included in the PDN CONNECTIVITY REQUEST message, </condition> <control> the UE shall <action> stop timer T3396 associated with the corresponding APN, </action> if <condition> it is running. </condition> </control> </control> <control> If <condition> <condition> the timer value indicates neither zero nor deactivated, </condition> <condition> no APN was included in the PDN CONNECTIVITY REQUEST message </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <control> the UE shall <action> stop timer T3396 associated with no APN </action> if <condition> it is running. </condition> </control> </control> <control> The UE shall then <action> start timer T3396 with the value provided in the Back-off timer value IE </action> and: <action> a) shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN that was sent by the UE, until timer T3396 expires </action> or <action> timer T3396 is stopped; </action> and <control> <action> b) shall not send another PDN CONNECTIVITY REQUEST message without an APN </action> and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST for a non-emergency PDN connection established without an APN provided by the UE, if <condition> <condition> no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", </condition> <condition> until timer T3396 expires or timer T3396 is stopped. </condition> </condition> </control> </control> </control>
<control> The UE shall <action> not stop timer T3396 <condition> upon a PLMN change or inter-system change; </condition> <control> ii) if <condition> the timer value indicates that this timer is deactivated, </condition> the UE: <action> a) shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST </action> with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network; </control> and b) shall <action> not send another PDN CONNECTIVITY REQUEST message </action> without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. </action> </control>
<control> The timer T3396 <action> remains deactivated upon a PLMN change or inter-system change; </action> and <control> iii) if <condition> the timer value indicates zero, </condition> the UE: a) shall <action> stop timer T3396 associated with the corresponding APN, </action> if running, and <action> may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; </action> and <control> b) if <condition> <condition> no APN was included in the PDN CONNECTIVITY REQUEST message </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> the UE shall <action> stop timer T3396 associated with no APN, </action> if running, and <action> may send another PDN CONNECTIVITY REQUEST message without an APN, </action> or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE; and </control> </control> </control>
<control> 2) if <condition> the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, </condition> the UE shall <action> take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE </action> and on the integrity protection of the ATTACH REJECT message (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.5): </control> <control> i) if <condition> the ATTACH REJECT message is not integrity protected and an APN was sent by the UE during the attach procedure, </condition> the UE shall <action> stop timer T3396 associated with the corresponding APN </action> if it is running. </control> <control> If <condition> <condition> the ATTACH REJECT message is not integrity protected, </condition> <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> and <condition> an APN was not sent by the UE, </condition> </condition> the UE shall <action> stop timer T3396 associated with no APN </action> if it is running. </control> <control> The UE shall <action> then start timer T3396 with a random value </action> from a default range specified in table 11.2.3 defined in 3GPP TS 24.008 , and: a) shall <action> not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, </action> <condition> until timer T3396 expires or timer T3396 is stopped; </condition> and <control> b) shall <action> not initiate a new attach procedure </action> without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", <condition> until timer T3396 expires. </condition> </control> </control>
<control> The UE shall <action> not stop timer T3396 </action> <condition> upon a PLMN change or inter-system change; </condition> <control> ii) if <condition> the ATTACH REJECT message is integrity protected, </condition> the UE shall <action> proceed as follows: </action> </control> <control> a) if <condition> the timer value indicates neither zero nor deactivated and an APN was sent by the UE during the attach procedure, </condition> the UE shall <action> stop timer T3396 associated with the corresponding APN </action> if it is running. </control> </control> <control> <control> If <condition> <condition> the timer value indicates neither zero nor deactivated, </condition> the request type <condition> was different from "emergency" and from "handover of emergency bearer services", </condition> and <condition> an APN was not sent by the UE during the attach procedure, </condition> </condition> the UE shall <action> stop timer T3396 associated </action> with no APN if it is running. </control> </control> <control> The UE shall <action> then start timer T3396 </action> with the value provided in the Back-off timer value IE and: <control> a) shall <action> not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, </action> <condition> until timer T3396 expires or timer T3396 is stopped; </condition> </control> <control> and b) shall <action> not initiate a new attach procedure without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", </action> if <condition> <condition> the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", </condition> <condition> until timer T3396 expires. </condition> </condition> </control> </control>
<control> The UE shall <action> not stop timer T3396 upon a PLMN change or inter-system change; </action> <control> b) if <condition> the timer value indicates that this timer is deactivated, </condition> the UE: a) shall <action> not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, </action> <condition> until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message for the same APN from the network; </condition> </control> and <control> b) shall <action> not initiate a new attach procedure without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", </action> if <condition> <condition> the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", </condition> <condition> until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE. </condition> </condition> </control> </control>
<control> The timer T3396 <action> remains deactivated </action> <condition> upon a PLMN change or inter-system change; </condition> and <control> c) if <condition> the timer value indicates that this timer is zero, </condition> the UE shall <action> proceed as specified in subclause 5.5.1.2.6 item d. </action> </control> </control>
<control> If <condition> the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent standalone, </condition> then the UE may <action> send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN. </action> </control>
<control> <condition> When the timer T3396 is running or the timer is deactivated, </condition> the UE <action> is allowed to initiate an attach procedure or PDN connectivity procedure if the procedure is for emergency bearer services. </action> </control>
<control> If <start_state> the timer T3396 is running when the UE enters state EMM-DEREGISTERED, </start_state> the UE <action> remains switched on, </action> and <action> the USIM in the UE remains the same, </action> then timer T3396 <action> is kept running </action> <condition> until it expires or it is stopped. </condition> </control>
<control> If <condition> <condition> the UE is switched off when the timer T3396 is running, </condition> and if <condition> the USIM in the UE remains the same when the UE is switched on, </condition> </condition> the UE shall <action> behave as follows: a) let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. </action> <control> <control> If <condition> t1 is greater than t, </condition> then the timer shall <action> be restarted with the value t1 t. </action> </control> <control> If <condition> t1 is equal to or less than t, </condition> then the timer <action> need not be restarted. </action> </control> <control> If <condition> the UE is not capable of determining t, </condition> then the UE shall <action> restart the timer with the value t1; </action> <control> b) if <condition> prior to switch off, </condition> timer T3396 <action> was running for a specific APN, </action> </control> and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5; <control> and c) if <condition> <condition> prior to switch off timer T3396 was running </condition> because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if <condition> timer T3396 is restarted at switch on, </condition> </condition> then the UE configured for dual priority shall <action> handle session management requests as indicated in subclause 6.5.5. </action> </control> </control> </control> </control>
6.5.1.4.3 Handling of network rejection due to ESM cause other than ESM cause #26
<control> 2) if <condition> the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, </condition> the UE shall <action> take different actions depending on the timer value received in the Back-off timer value IE and on the integrity protection of the ATTACH REJECT message </action> (if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.6): </control> <control> i) if <condition> the ATTACH REJECT message is not integrity protected, </condition> the UE shall <action> start the back-off timer with a random value from a default range specified in table 11.2.3(see 3GPP TS 24.008 ), </action> and: <control> a) shall <action> not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, </action> <condition> until the back-off timer expires, </condition> the UE is switched off or the USIM is removed; </control> and <control> b) shall <action> not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN </action> without an APN and with request type different from "emergency" and from "handover of emergency bearer services", <condition> <condition> if the UE did not provide any APN during the attach procedure and the request type was different from "emergency", </condition> <condition> until the back-off timer expires, </condition> </condition> the UE <action> is switched off or the USIM is removed; </action> </control> </control> and <control> ii) if <condition> the ATTACH REJECT message is integrity protected, </condition> the UE shall <action> proceed as follows: </action> <control> a) if <condition> the timer value indicates neither zero nor deactivated, </condition> the UE shall <action> start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination </action> and: <action> a) shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, </action> <condition> until the back-off timer expires, </condition> the UE <action> is switched off or the USIM is removed; </action> and b) shall <action> not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services", </action> <condition> <condition> the UE did not provide any APN during the attach procedure </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> <condition> until the back-off timer expires, </condition> </condition> the UE <action> is switched off or the USIM is removed; </action> </control> <control> b) if <condition> the timer value indicates that this timer M is deactivated, </condition> the UE: <control> c) shall <action> not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, </action> <condition> until the UE is switched off or the USIM is removed; </condition> </control> and <control> d) shall <action> not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN </action> without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if <condition> <condition> the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", </condition> <condition> until the UE is switched off or the USIM is removed; </condition> </condition> </control> and <control> c) if <condition> the timer value indicates that this timer is zero, </condition> the UE shall <action> proceed as specified in subclause 5.5.1.2.6 item d. </action> </control> </control> </control>
<control> If <condition> the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent standalone, </condition> then the UE shall <action> ignore the Re-attempt indicator IE provided by the network in PDN CONNECTIVITY REJECT, </action> if any. </control>
<control> 1) Additionally, if <condition> the ESM cause value is #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported", or #33 "requested service option not subscribed", the UE shall proceed as follows: a) if the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list, </condition> the UE shall <action> behave as described above in the present subclause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 or in USIM file NAS as specified in 3GPP TS 31.102 , </action> if available, as CONFIG back-off timer value; </control> <control> and <condition> b) otherwise, </condition> if <condition> <condition> the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, </condition> or if <condition> the SM_RetryWaitTime value is not configured, </condition> </condition> the UE shall <action> behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer. </action> </control>
<control> 2) For ESM cause values different from #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported", or #33 "requested service option not subscribed", the UE behaviour regarding the start of a back-off timer <action> is unspecified. </action> </control>
<control> The UE shall <action> not stop any back-off timer upon a PLMN change or inter-system change. </action> </control> <control> If <condition> the network indicates that a back-off timer for the PDN connectivity procedure and PLMN and APN combination is deactivated, </condition> then it <action> remains deactivated upon a PLMN change or inter-system change. </action> </control>
NOTE 1: This means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode or N1 mode to S1 mode. Thus the UE can still be prevented from sending another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN.
<control> If <condition> the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent together with an ATTACH REQUEST, </condition> the UE shall <action> ignore the Re-attempt indicator IE provided by the network in PDN CONNECTIVITY REJECT, </action> if any, and <action> proceed as specified in subclause 5.5.1.2.6, item d. </action> </control>
<control> If <condition> the back-off timer is started upon receipt of a PDN CONNECTIVITY REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, </condition> the UE <action> behaves as follows: </action> 1) after a PLMN change the UE may send a PDN CONNECTIVITY REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the PDN connectivity procedure and the combination of new PLMN and APN; </control>
<control> Furthermore as an implementation option, <condition> <condition> for the ESM cause values #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported" or #33 "requested service option not subscribed", </condition> if <condition> the network does not include a Re-attempt indicator IE, </condition> </condition> the UE <action> may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type, </action> or <control> the UE <action> may decide not to automatically send another PDN CONNECTIVITY REQUEST message included in an ATTACH REQUEST message without an APN using the same PDN type </action> if <condition> <condition> the UE did not provide any APN in the PDN connectivity procedure, </condition> if <condition> the UE is registered to a new PLMN which is in the list of equivalent PLMNs. </condition> </condition> </control> </control>
<control> 2) if <condition> <condition> the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, </condition> or <condition> the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, </condition> </condition> then: <control> a) if <condition> the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list, </condition> the UE shall <action> apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 or in USIM file NAS as specified in 3GPP TS 31.102 , </action> if available, to determine whether the UE may attempt a CONFIG PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session establishment procedure for the same PLMN and APN combination in N1 mode; </control> and <control> b) if <condition> <condition> the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, </condition> or if <condition> the NAS configuration MO as specified in 3GPP TS 24.368 is not available and the value for inter-system change is not configured in the USIM file NAS , </condition> </condition> then the UE behaviour regarding a PDP context CONFIG activation procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session establishment procedure for the same PLMN and APN combination in N1 mode <action> are unspecified; and </action> </control> </control>
<control> 3) if <condition> the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, </condition> then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall <action> start a back-off timer for the PDN connectivity procedure with the value provided by the network, </action> or <action> deactivate the respective back-off timer as follows: </action> <control> a) if <condition> the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, </condition> the UE shall <action> start or deactivate the back-off timer for S1 mode only; </action> </control> and <control> b) <condition> otherwise </condition> the UE shall <action> start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode. </action> </control> </control>
<control> If <condition> <condition> the back-off timer for a PLMN and APN combination was started or deactivated in A/Gb or Iu mode upon receipt of an ACTIVATE PDP CONTEXT REJECT message (see 3GPP TS 24.008 ) </condition> and <condition> the network indicated that re- attempt in S1 mode is allowed, </condition> </condition> then this back-off timer <action> does not prevent the UE from sending a PDN CONNECTIVITY REQUEST message in this PLMN for the same APN </action> after inter-system change to S1 mode. </control> <control> If <condition> the network indicated that re-attempt in S1 mode is not allowed, </condition> the UE shall <action> not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, </action> the UE <action> is switched off or the USIM is removed. </action> </control>
<control> If <condition> <condition> a back-off timer for a PLMN and APN combination, </condition> in combination with any S-NSSAI or <condition> without S-NSSAI (see 3GPP TS 24.501 ) was started or deactivated in N1 mode upon receipt of a PDU SESSION ESTABLISHMENT REJECT message (see 3GPP TS 24.501 ) and the network indicated that re-attempt in S1 mode is allowed, </condition> </condition> then <action> this back-off timer does not prevent the UE from sending a PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. </action> </control> <control> If <condition> the network indicated that re-attempt in S1 mode is not allowed, </condition> the UE shall <action> not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter- system change to S1 mode </action> <condition> until the timer expires, </condition> <action> the UE is switched off or the USIM is removed. </action> </control> <control> If <condition> <condition> more than one back-off timers for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed </condition> and <condition> no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, </condition> </condition> the UE shall <action> not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until all timers have expired. </action> </control> <control> If <condition> at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, </condition> the UE shall <action> not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN </action> <condition> until the UE is switched off or the USIM is removed. </condition> </control>
NOTE 2: The back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.
NOTE 3: Reference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.
<control> <condition> When the back-off timer is running or the timer is deactivated, </condition> the UE <action> is allowed to initiate an attach procedure or PDN connectivity procedure </action> if <condition> the procedure is for emergency bearer services. </condition> </control>
<control> If <condition> the ESM cause value is #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" or #61 "PDN type Ethernet only allowed", </condition> the UE shall <action> ignore the Back-off timer value IE provided by the network, </action> if any. </control> <control> The UE shall <action> not automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type </action> <condition> until any of the following conditions is fulfilled: </condition> <control> <condition> <condition> a) the UE is registered to a new PLMN, </condition> and <condition> either the network did not include a Re-attempt indicator IE in the PDN CONNECTIVITY REJECT message or the Re-attempt indicator IE included in the message indicated that re-attempt in an equivalent PLMN is allowed; </condition> </condition> <control> <condition> b) the UE is registered to a new PLMN which was not in the list of equivalent PLMNs at the time when the PDN CONNECTIVITY REJECT message was received; </condition> </control> <control> <condition> c) the PDN type which is used to access to the APN is changed; </condition> <control> <condition> d) the UE is switched off; </condition> </control> <control> <condition> or e) the USIM is removed. </condition> </control> </control> </control> </control>
<control> <condition> For the ESM cause values #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" and #61 "PDN type Ethernet only allowed", </condition> the UE shall <action> ignore the value of the RATC bit in the Re-attempt indicator IE provided by the network, if any. </action> </control>
NOTE 4: For the ESM cause values #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" and #61 "PDN type Ethernet only allowed", re-attempt in A/Gb, Iu, or N1 mode for the same APN (or no APN, if no APN was indicated by the UE) using the same PDN type is not allowed.
<control> Furthermore as an implementation option, for the SM cause values #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" and #61 "PDN type Ethernet only allowed", <control> if <condition> the network does not include a Re-attempt indicator IE </condition> the UE may <action> decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type, </action> </control> if <condition> the UE is registered to a new PLMN which is in the list of equivalent PLMNs. </condition> </control>
NOTE 5: Request to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers.
<control> If <condition> the ESM cause value is #65 "maximum number of EPS bearers reached", </condition> the UE shall <action> determine the PLMN's maximum number of EPS bearer contexts in S1 mode (see subclause 6.5.0) as the number of active EPS bearer contexts it has. </action> </control> <control> The UE shall <action> ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, </action> if any. </control>
NOTE 6: In some situations, when attempting to establish multiple EPS bearer contexts, the number of active EPS bearer contexts that the UE has when ESM cause #65 is received is not equal to the maximum number of EPS bearer contexts reached in the network.
NOTE 7: When the network supports emergency bearer services, it is not expected that ESM cause #65 is returned by the network when the UE requests a PDN connection for emergency bearer services.
<control> The PLMN's maximum number of EPS bearer contexts in S1 mode <action> applies to the PLMN in which the ESM cause #65 "maximum number of EPS bearers reached" is received. </action> </control> <control> <condition> <condition> When the UE is switched off, when the USIM is removed, </condition> or <condition> when there is a change in the value indicated by the network in the 15 bearers bit of the EPS network feature support IE, </condition> </condition> the UE shall <action> clear all previous determinations representing PLMNs maximum number of EPS bearer contexts in S1 mode. </action> </control> <control> <condition> Upon successful registration with a new PLMN, </condition> </control> <control> the UE <action> may clear previous determinations representing any PLMN's maximum number(s) of EPS bearer contexts in S1 mode. </action> </control>
<control> If <condition> the ESM cause value is #66 "requested APN not supported in current RAT and PLMN combination", </condition> the UE shall <action> take different actions depending on the Back-off timer value IE and the Re-attempt indicator IE optionally included: </action> <control> <condition> <condition> 1) If the PDN CONNECTIVITY REQUEST message was sent standalone, </condition> <condition> the Back-off timer value IE is not included, </condition> and <condition> either the Re-attempt indicator IE is not included or the Re-attempt indicator IE is included indicating that re-attempt in an equivalent PLMN is allowed, </condition> </condition> the UE shall <action> not send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode </action> <condition> until the UE is switched off or the USIM is removed; </condition> </control> </control>
<control> 2) if <condition> <condition> the PDN CONNECTIVITY REQUEST message was sent standalone, </condition> <condition> the Back-off timer value IE is not included, </condition> and <condition> the Re-attempt indicator IE is included and indicates that re-attempt in an equivalent PLMN is not allowed, </condition> </condition> the UE shall <action> not send a PDN CONNECTIVITY REQUEST message for the same APN in any PLMN in the list of equivalent PLMNs in S1 mode </action> <condition> until the UE is switched off or the USIM is removed; </condition> </control>
<control> 3) if <condition> the PDN CONNECTIVITY REQUEST message was sent standalone and the Back-off timer value IE is included, </condition> the UE shall <action> take different actions depending on the timer value received in the Back-off timer value IE </action> (if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.6): <control> i) if <condition> the timer value indicates neither zero nor deactivated, </condition> the UE shall <action> start the back-off timer with the value provided in the Back-off timer value IE for the PLMN and APN combination </action> and shall <action> not send another PDN CONNECTIVITY REQUEST for the same APN in the current PLMN in S1 mode </action> <condition> until the back-off timer expires, the UE is switched off or the USIM is removed; </condition> <control> ii) if <condition> the timer value indicates that this timer is deactivated, </condition> the UE shall <action> not send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode </action> <condition> until the UE is switched off or the USIM is removed; </condition> </control> and <control> iii) if <condition> the timer value indicates that this timer is zero, </condition> the UE <action> may send a PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN; and </action> </control> </control> </control>
<control> 4) if <condition> the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, </condition> the UE shall <action> take different actions depending on the integrity protection of the ATTACH REJECT message </action> </control> (if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.6): <control> i) if <condition> the ATTACH REJECT message is not integrity protected, regardless whether the Back-off timer IE is included, </condition> the UE shall <action> start the back-off timer with a random value from a default range specified in table 11.2.3(see 3GPP TS 24.008 ), </action> and shall <action> not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, </action> <condition> until the back-off timer expires, </condition> <condition> the UE is switched off or the USIM is removed; </condition> </control> and <control> ii) if <condition> the ATTACH REJECT message is integrity protected, </condition> the UE shall <action> proceed as follows: </action> </control> <control> a) if <condition> the Back-off timer value IE is included and the timer value indicates neither zero nor deactivated, </condition> the UE shall <action> start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination </action> and shall <action> not initiate a new attach procedure </action> or <action> send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, </action> <condition> until the back-off timer expires, </condition> <condition> the UE is switched off or the USIM is removed; </condition> </control> <control> b) if <condition> the Back-off timer value IE is included and the timer value indicates that this timer is deactivated, </condition> the UE shall <action> not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, </action> <condition> until the UE is switched off or the USIM is removed; </condition> </control> <control> c) if <condition> the Back-off timer value IE is included and the timer value indicates that this timer is zero, </condition> the UE shall <action> proceed as specified in subclause 5.5.1.2.6 item d; </action> </control> <control> d) if <condition> <condition> the Back-off timer value IE is not included, </condition> and <condition> either the Re-attempt indicator IE is not included or the Re-attempt indicator IE is included indicating that re-attempt in an equivalent PLMN is allowed, </condition> </condition> the UE shall <action> not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode </action> <condition> until the UE is switched off or the USIM is removed; </condition> </control> and <control> e) if <condition> <condition> the Back-off timer value IE is not included, </condition> and <condition> the Re-attempt indicator IE is included and indicates that re-attempt in an equivalent PLMN is not allowed, </condition> </condition> the UE shall <action> not initiate a new attach procedure or send a PDN CONNECTIVITY REQUEST message for the same APN in any PLMN in the list of equivalent PLMNs in S1 mode </action> <condition> until the UE is switched off or the USIM is removed. </condition> </control>
NOTE 8: Receiving ESM cause value #66 during an attach procedure without APN is not expected and the UE behaviour is implementation specific.
<control> If <condition> the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, </condition> then <action> a) for cases 3.i, 4.i and 4.ii.a the UE shall additionally start a back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure for each combination of a PLMN from the equivalent PLMN list and the APN; </action> and <action> b) for cases 3.ii and 4.ii.b the UE shall deactivate the respective back-off timers for the PDN connectivity procedure for each combination of a PLMN from the equivalent PLMN list and the APN. </action> </control>
<control> <condition> For the ESM cause value #66 "requested APN not supported in current RAT and PLMN combination" </condition> the UE shall <action> ignore the value of the RATC bit in the Re-attempt indicator IE provided by the network, </action> if any. </control>
<control> If <condition> the ESM cause value is #54 "PDN connection does not exist", </condition> the UE shall <action> ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, </action> if any, and <action> take different actions as follows: </action> <control> a) if <condition> the PDN CONNECTIVITY REQUEST message was sent standalone, </condition> the UE shall <action> set the request type to "initial request" in the subsequent PDN CONNECTIVITY REQUEST message to establish a PDN connectivity to the same APN; </action> b) if <action> the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST message, </action> the UE shall <action> set the request type to "initial request" in the PDN CONNECTIVITY REQUEST message </action> which is included in the subsequent ATTACH REQUEST message to establish a PDN connectivity to the same APN. </control> </control>
NOTE 9: User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer context(s) automatically.
6.5.1.4A Handling the maximum number of active EPS bearer contexts
<control> If <condition> the maximum number of active EPS bearer contexts is reached at the UE </condition> (see subclause 6.5.0) and the upper layers of the UE request connectivity to a PDN the UE shall <action> not send a PDN CONNECTIVITY REQUEST message unless an active EPS bearer is deactivated. </action> </control> <control> If <condition> the UE needs to de-activate an active EPS bearer context, </condition> choosing which EPS bearer context to de-activate <action> is implementation specific, </action> however the UE shall <action> not deactivate an EPS bearer context for emergency. </action> </control>
NOTE: Subclause 6.5.1.6 specifies that a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing, non-emergency PDN connection can be acceptable, in some cases. In these cases the UE does not need to de-activate an active EPS bearer context if the maximum number of active EPS bearer contexts is reached at the UE.
<control> If <condition> the UE needs to de-activate an EPS bearer context in order to request an emergency EPS bearer context, </condition> it shall <action> either de-activate an EPS bearer context locally or via explicit signalling. </action> </control> <control> If <condition> the UE performs local de-activation, </condition> the UE shall <action> perform tracking area updating procedure to indicate EPS bearer context status to the network. </action> </control>
6.5.1.4B Void
6.5.1.4C Handling the maximum number of active user plane radio bearers in NB-S1 mode
<control> <condition> <condition> When the maximum number of active user plane radio bearers in NB-S1 mode is reached (see subclause 6.5.0) </condition> and <condition> upper layers request for more DRBs for PDN connections other than PDN connections with those DRBs, </condition> </condition> the UE can <action> choose to release one or more of the PDN connections to cater for the upper layer request. </action> </control> <control> The choice of which PDN connection to be released <action> is implementation specific. </action> </control>
<control> If <condition> <condition> the maximum number of active user plane radio bearers in NB-S1 mode is reached </condition> and <condition> the upper layers of the UE request user-plane resources for exception data reporting, </condition> </condition> the UE shall <action> release a PDN connection that has user-plane resources to cater for the request for exception data reporting. </action> </control> <control> The choice of which PDN connection to be released <action> is implementation specific. </action> </control>
<control> If <condition> the UE needs to release a PDN connection for the reasons stated in this subclause, </condition> a PDN connection that is used for exception data reporting shall <action> not be released. </action> </control>
<control> If <condition> the UE releases a PDN connection to cater for the upper layer request, </condition> the UE shall <action> release the PDN connection via explicit ESM signalling. </action> </control>
6.5.1.5 Abnormal cases in the UE
<control> The following abnormal cases can be identified: <condition> a) T3482 expired </condition> </control>
<control> <condition> <condition> On the first expiry of the timer T3482: </condition> <condition> a) if the PDN CONNECTIVITY REQUEST message was sent with request type set to "emergency" or "handover of emergency bearer services" in a stand-alone PDN connectivity procedure, </condition> then the UE shall: <action> a) inform the upper layers of the failure to establish the emergency bearer; </action> or NOTE: This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 can result in the emergency call being attempted to another IP-CAN. </condition> </control>
<control> <condition> <condition> b) detach locally, </condition> if <condition> not detached already, </condition> </condition> <action> attempt EPS attach </action> for emergency bearer services. <control> <condition> a) otherwise, </condition> the UE shall <action> resend the PDN CONNECTIVITY REQUEST </action> and shall <action> reset and restart timerT3482. </action> </control> <control> This retransmission <action> is repeated four times, </action> <control> i.e. <condition> on the fifth expiry of timer T3482, </condition> the UE shall <action> abort the procedure, </action> <action> release the PTI allocated for this invocation </action> and <end_state> enter the state PROCEDURE TRANSACTION INACTIVE. </end_state> </control> </control> </control>
<control> <condition> b) T3447 is running </condition> </control>
<control> The UE shall <action> not send a PDN CONNECTIVITY REQUEST message </action> <condition> <condition> when the UE is in EMM-CONNECTED mode after the UE attached without PDN connection, </condition> <condition> unless: a) establishment of a PDN connection for emergency bearer services is requested; </condition> <condition> b) the UE is a UE configured to use AC11 15 in the selected PLMN; </condition> or <condition> c) a network initiated signalling message has been received. </condition> </condition> </control>
<control> The PDN CONNECTIVITY REQUEST message <action> can be sent, </action> if <condition> <condition> still necessary, </condition> <condition> when timer T3447 expires. </condition> </condition> </control>
6.5.1.6 Abnormal cases on the network side
<control> The following abnormal cases can be identified: <condition> a) UE initiated PDN connectivity request for an already existing PDN connection: If the network receives a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing PDN connection, </condition> </control>
<control> If <condition> <condition> the information elements in the PDN CONNECTIVITY REQUEST message do not differ from the ones received within the previous PDN CONNECTIVITY REQUEST message, </condition> and <condition> the MME has not received the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message from UE, </condition> </condition> the network shall <action> resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message </action> and <action> continue the previous procedure. </action> </control>
<control> If <condition> <condition> one or more information elements in the PDN CONNECTIVITY REQUEST message differ from the ones received within the previous PDN CONNECTIVITY REQUEST message, </condition> and <condition> multiple PDN connections for a given APN are not allowed, </condition> </condition> the network may <action> deactivate the existing EPS bearer contexts for the PDN connection locally without notification to the UE and proceed with the requested PDN connectivity procedure </action> or <action> may reject this PDN connectivity procedure including the ESM cause #55 "multiple PDN connections for a given APN not allowed", in the PDN CONNECTIVITY REJECT message. </action> </control>
<control> If <condition> <condition> the network receives a PDN CONNECTIVITY REQUEST message with request type "emergency" </condition> and <condition> the MME has not received the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message from UE for the previous PDN connectivity request for emergency bearer services, </condition> </condition> the network shall <action> resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and continue the previous procedure. </action> </control> <control> If <condition> there is already a PDN connection for emergency bearer services existing, </condition> the MME shall <action> reject the request with ESM cause #55 "multiple PDN connections for a given APN not allowed" or deactivate the existing EPS bearer contexts for the PDN connection locally without notification to the UE and proceed with the requested PDN connectivity procedure. </action> </control>
<control> <condition> <condition> b) UE initiated PDN connectivity request with request type "handover" for a PDN connection that does not exist: </condition> If <condition> the network receives a PDN CONNECTIVITY REQUEST message for either a default APN or a specific APN with request type set to "handover" </condition> and <condition> the MME does not have any information about that PDN connection, </condition> </condition> then MME shall <action> reject the PDN connectivity request procedure including the ESM cause #54 "PDN connection does not exist", </action> in the PDN CONNECTIVITY REJECT message. </control>
<control> <condition> <condition> c) ESM information not received: </condition> If <condition> the ESM information transfer flag in the PDN CONNECTIVITY REQUEST message has been set </condition> and <condition> the ESM information is not received before the final expiry of timer T3489 </condition> </condition> as described in subclause 6.6.1.2.6, the MME shall <action> reject the PDN connectivity request procedure </action> including the ESM cause #53 "ESM information not received", in the PDN CONNECTIVITY REJECT message. </control>
<control> <condition> d) Additional UE initiated PDN connectivity request received from a UE that is attached for emergency bearer services: </condition> The MME shall <action> reject the request with ESM cause #31 "request rejected, unspecified". </action> </control>
<control> <condition> <condition> e) A PDN CONNECTIVITY REQUEST message with request type "handover of emergency bearer services" received from a UE and the MME does not have any information about a P-GW currently providing emergency bearer services for the UE </condition> or <condition> the MME is not configured with an address of a P-GW in the MME emergency configuration data: </condition> </condition> MME shall <action> 	 reject the PDN connectivity request procedure </action> including the ESM cause #54 "PDN connection does not exist", in the PDN CONNECTIVITY REJECT message. </control>
<control> <condition> f) Additional UE initiated PDN connectivity request received from a UE that is attached for access to RLOS: </condition> The MME shall <action> reject the request with ESM cause #31 "request rejected, unspecified". </action> </control>
6.5.1.7 Handling PDN connectivity request for UE configured for dual priority
<control> If <condition> <condition> a PDN connection exists that was established due to a request including a low priority indicator set to "MS is configured for NAS signalling low priority" </condition> and <condition> the upper layers of the UE request to establish a PDN connection with the same APN and a low priority indicator set to "MS is not configured for NAS signalling low priority", </condition> <condition> when initiating the PDN connectivity request procedure, </condition> </condition> the UE shall: <action> a) send a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as the existing PDN connection. </action> <control> If <condition> the UE receives a PDN CONNECTIVITY REJECT message with ESM cause #55 "multiple PDN connections for a given APN not allowed", </condition> the upper layers <action> are informed of this; </action> </control> or <action> b) send a PDN CONNECTIVITY REQUEST message with the same APN after the successful deactivation of the existing PDN connection. </action> </control>
NOTE: The above list of options also apply for the case when the existing PDN connection was established due to a request including a low priority indicator set to "MS is not configured for NAS signalling low priority" and the new request to establish a PDN connection with the same APN contains a low priority indicator set to "MS is configured for NAS signalling low priority".
<control> As an alternative the upper layers of <action> the UE can request to establish a PDN connection with a different APN. </action> </control>
6.5.2 UE requested PDN disconnect procedure
6.5.2.1 General
The purpose of the UE requested PDN disconnection procedure is for a UE to request disconnection from one PDN. <control> <condition> If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> <action> the UE can initiate this procedure to disconnect from any PDN as long as it is connected to at least one other PDN. </action> </control> <control> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> <action> UE can initiate this procedure to disconnect from any PDN. </action> </control> With this procedure, all EPS bearer contexts established towards this PDN, including the default EPS bearer context, are released.
The UE is allowed to initiate the PDN disconnection procedure even if the timer T3396 is running.
6.5.2.2 UE requested PDN disconnection procedure initiation
<control> <condition> In order to request PDN disconnection from a PDN, </condition> <action> the UE shall send a PDN DISCONNECT REQUEST message to the MME, </action> <action> start the timer T3492 </action> and <action> enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.2.2.1). </action> </control> The PDN DISCONNECT REQUEST message shall include the EPS bearer identity of the default bearer associated with the PDN to disconnect from as the linked EPS bearer identity in the PDN DISCONNECT REQUEST message.
6.5.2.3 UE requested PDN disconnection procedure accepted by the network
<control> <condition> Upon receipt of the PDN DISCONNECT REQUEST message, </condition> <condition> if it is accepted by the network, </condition> <action> the MME shall initiate the bearer context deactivation procedure by sending the DEACTIVATE EPS BEARER CONTEXT REQUEST message including the linked EPS bearer identity of the default bearer associated with the PDN to disconnect from and the PTI. </action> </control> The behaviour of the MME is described in subclause 6.4.4.
<control> <condition> Upon receipt of the DEACTIVATE EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the PDN DISCONNECT REQUEST message, </condition> <action> the UE shall stop the timer T3492 </action> and <action> enter the state PROCEDURE TRANSACTION INACTIVE. </action> </control> The behaviour of the UE is described in subclause 6.4.4. <control> <action> The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. </action> </control> The way to achieve this is implementation dependent. <control> <condition> While the PTI value is not released, </condition> <action> the UE regards any received DEACTIVATE EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission. </action> </control>
<control> <condition> On reception of DEACTIVATE EPS BEARER CONTEXT ACCEPT message from the UE, </condition> <action> the MME releases all the resources reserved for the PDN in the network. </action> </control>
6.5.2.4 UE requested PDN disconnection procedure not accepted by the network
<control> <condition> <condition> Upon receipt of the PDN DISCONNECT REQUEST message, </condition> <condition> if it is not accepted by the network, </condition> </condition> <action> the MME shall send a PDN DISCONNECT REJECT message to the UE. </action> </control> The PDN DISCONNECT REJECT message shall contain the PTI and an ESM cause IE that typically indicates one of the following ESM cause values: #35: PTI already in use; #43: invalid EPS bearer identity; #49: last PDN disconnection not allowed; #95 111: protocol errors.
<control> <condition> If EMM-REGISTERED without PDN connection is supported by the UE and the MME, </condition> <action> then ESM cause #49 "last PDN disconnection not allowed" is not applicable. </action> </control>
<control> <condition> Upon receipt of the PDN DISCONNECT REJECT message, </condition> <action> the UE shall stop the timer T3492, </action> <action> enter the state PROCEDURE TRANSACTION INACTIVE and abort the PDN disconnection procedure. </action> </control> <control> <condition> <condition> Additionally, in all cases with the exception of the UE having received ESM cause #49 "last PDN disconnection not allowed" </condition> <condition> if EMM- REGISTERED without PDN connection is not supported by the UE or the MME, </condition> </condition> <action> the UE shall deactivate all EPS bearer contexts for this PDN connection locally without peer-to-peer signalling between the UE and the MME. </action> </control> <control> <condition> If the UE receives ESM cause #49 "last PDN disconnection not allowed" </condition> and <condition> the UE has any other PDN connections established, </condition> <action> the UE may locally deactivate, without peer-to-peer signalling between the UE and the MME, all EPS bearer contexts associated with those other PDN connections. </action> </control>
6.5.2.5 Abnormal cases in the UE
<control> The following abnormal cases can be identified: </control> <control> a) Expiry of timer T3492: <condition> On the first expiry of the timer T3492, </condition> <action> the UE shall resend the PDN DISCONNECT REQUEST </action> and <action> shall reset and restart timer T3492. </action> </control> This retransmission is repeated four times, i.e. <control> <condition> on the fifth expiry of timer T3492, </condition> <action> the UE shall abort the procedure, </action> <action> deactivate all EPS bearer contexts for this PDN connection locally without peer-to- peer signalling between the UE and the MME, </action> <action> release the PTI allocated for this invocation and enter the state PROCEDURE TRANSACTION INACTIVE. </action> </control> <control> <condition> <condition> In order to synchronize EPS bearer contexts status with the MME, </condition> <condition> on indication of "back to E-UTRAN coverage" from the lower layers, </condition> </condition> <action> the UE shall send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME. </action> </control>
<control> b) Collision of UE requested PDN disconnect procedure and dedicated EPS bearer context activation procedure: <condition> <condition> When the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, </condition> and <condition> the EPS bearer to be activated belongs to the PDN connection the UE wants to disconnect, </condition> </condition> <action> the UE shall ignore the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message </action> and <action> proceed with the PDN disconnect procedure. </action> </control>
<control> c) Collision of UE requested PDN disconnect procedure and EPS bearer context modification: <condition> <condition> When the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, </condition> and <condition> the EPS bearer to be modified belongs to the PDN connection the UE wants to disconnect, </condition> </condition> <action> the UE shall ignore the MODIFY EPS BEARER CONTEXT REQUEST message </action> and <action> proceed with the PDN disconnect procedure. </action> </control>
<control> d) Collision of UE requested PDN disconnect procedure and EPS bearer context deactivation procedure: <condition> When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, </condition> and <condition> the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a dedicated EPS bearer belonging to the PDN connection the UE wants to disconnect, </condition> <action> the UE shall proceed with both procedures. </action> </control>
6.5.2.6 Abnormal cases on the network side
<control> The following abnormal cases can be identified: </control> <control> a) No PDN connection with the linked EPS bearer identity activated: <condition> If the linked EPS bearer identity included in the PDN DISCONNECT REQUEST message does not belong to the default EPS bearer context of an established PDN connection, </condition> <action> the MME shall reply with a PDN DISCONNECT REJECT message with ESM cause #43 "invalid EPS bearer identity". </action> </control>
6.5.3 UE requested bearer resource allocation procedure
6.5.3.1 General
The purpose of the UE requested bearer resource allocation procedure is for a UE to request an allocation of bearer resources for a traffic flow aggregate. The UE requests a specific QoS demand (QCI) and optionally sends a GBR requirement for a new traffic flow aggregate. If accepted by the network, this procedure invokes a dedicated EPS bearer context activation procedure (see subclause 6.4.2) or an EPS bearer context modification procedure (see subclause 6.4.3).
<control> <condition> If there is a PDN connection for emergency bearer services established, </condition> <action> the UE shall not request additional bearer resources for this PDN connection. </action> </control>
6.5.3.2 UE requested bearer resource allocation procedure initiation
<control> <condition> In order to request the allocation of bearer resources for one traffic flow aggregate, </condition> <action> the UE shall send a BEARER RESOURCE ALLOCATION REQUEST message to the MME, </action> <action> start timer T3480 </action> and <action> enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.3.2.1). </action> </control>
The UE shall include the EPS bearer identity of the default EPS bearer associated with the requested bearer resource in the Linked EPS bearer identity IE. The UE shall set the TFT operation code in the Traffic flow aggregate IE to "Create new TFT". The packet filters in the Traffic flow aggregate IE shall include at least one packet filter applicable for the uplink direction. In the Required traffic flow QoS IE, the UE shall indicate a QCI and, if the UE also includes a GBR, the additional GBR required for the traffic flow aggregate.
UE Network
Start T3480 BEARER RESOURCE ALLOCATION REQUEST ACTIVATE DEDICATED EPS BEARER CONTEXT
Stop T3480 REQUEST OR MODIFY EPS BEARER CONTEXT REQUEST
Stop T3480 OR BEARER RESOURCE ALLOCATION REJECT
Stop T3480
<control> <condition> For the NBIFOM procedures as defined in 3GPP TS 24.161, </condition> <action> the UE may send a BEARER RESOURCE ALLOCATION REQUEST message to the MME. </action> <condition> If the traffic flow aggregate IE is not needed in those procedures, </condition> <action> the UE shall set: a) the length indicator of the Traffic flow aggregate IE to the value 1; </action> <control> <action> b) the TFT operation code to "000"; </action> </control> <control> <action> c) the E bit to zero; </action> </control> and <control> <action> d) the number of packet filters to zero; and in the Required traffic flow QoS IE: </action> </control> <control> <action> e) the length indicator to the value 1; and f) the QCI to zero. </action> </control> </control>
6.5.3.3 UE requested bearer resource allocation procedure accepted by the network
<control> <condition> Upon receipt of the BEARER RESOURCE ALLOCATION REQUEST message, </condition> <action> the MME checks whether the resources requested by the UE can be established by verifying the EPS bearer identity given in the Linked EPS bearer identity IE to be any of the active default EPS bearer context(s). </action> </control>
<control> <condition> If the bearer resource allocation requested is accepted by the network, </condition> <action> the MME shall initiate either a dedicated EPS bearer context activation procedure </action> or <action> an EPS bearer context modification procedure. </action> </control> <control> <condition> <condition> Upon receipt of an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST </condition> or <condition> MODIFY EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the BEARER RESOURCE ALLOCATION REQUEST message, </condition> </condition> <action> the UE shall stop timer T3480 </action> and <action> enter the state PROCEDURE TRANSACTION INACTIVE. </action> </control> The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. <control> <condition> While the PTI value is not released, </condition> <action> the UE regards any received ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see subclause 7.3.1). </action> </control>
<control> <condition> If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is received, </condition> <action> the UE shall verify that the EPS bearer identity given in the EPS bearer identity IE is not already used by any EPS bearer context. </action> <action> The UE shall then proceed as described in subclause 6.4.2.3 or subclause 6.4.2.4. </action> </control>
<control> <condition> If the MODIFY EPS BEARER CONTEXT REQUEST message is received, </condition> <action> the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is any of the active EPS bearer contexts. </action> <action> The UE shall then proceed as described in subclause 6.4.3.3 or subclause 6.4.3.4. </action> </control>
6.5.3.4 UE requested bearer resource allocation procedure not accepted by the network
6.5.3.4.1 General
<control> <condition> If the bearer resource allocation requested cannot be accepted by the network, </condition> <action> the MME shall send a BEARER RESOURCE ALLOCATION REJECT message to the UE. </action> </control> The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested bearer resource allocation.
The ESM cause value typically indicates one of the following: #26: insufficient resources; #30: request rejected by Serving GW or PDN GW; #31: request rejected, unspecified; #32: service option not supported; #33: requested service option not subscribed; #34: service option temporarily out of order; #35: PTI already in use; #37: EPS QoS not accepted; #41: semantic error in the TFT operation; #42: syntactical error in the TFT operation; #43: invalid EPS bearer identity; #44: semantic error(s) in packet filter(s); #45: syntactical error(s) in packet filter(s); #56: collision with network initiated request; #59: unsupported QCI value; #60: bearer handling not supported; #65: maximum number of EPS bearers reached; or #95 111: protocol errors.
<control> <condition> If the bearer resource allocation requested is for an established LIPA PDN connection </condition> or <condition> SIPTO at the local network PDN connection, </condition> <action> then the network shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #60 "bearer handling not supported". </action> </control>
<control> <condition> If the requested new TFT is not available, </condition> <action> then the BEARER RESOURCE ALLOCATION REJECT message shall be sent. </action> </control>
The TFT in the request message is checked by the network for different types of TFT IE errors as follows: a) Semantic errors in TFT operations: 1) When the TFT operation is an operation other than "Create a new TFT".
The network shall reject the allocation request with ESM cause #41 "semantic error in the TFT operation".
b) Syntactical errors in TFT operations: 1) When the TFT operation = "Create a new TFT" and the packet filter list in the TFT IE is empty.
<control> 2) <condition> When there are other types of syntactical errors in the coding of the TFT IE, </condition> such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list. <action> The network shall reject the allocation request with ESM cause #42 "syntactical error in the TFT operation". </action> c) Semantic errors in packet filters: 1) When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the network determines a semantic error in a packet filter is outside the scope of the present document. 2) When the resulting TFT does not contain any packet filter which applicable for the uplink direction. </control>
The network shall reject the allocation request with ESM cause #44 "semantic errors in packet filter(s)".
<control> d) <condition> Syntactical errors in packet filters: 1) When the TFT operation = "Create a new TFT" and two or more packet filters in the resultant TFT would have identical packet filter identifiers. </condition> </control>
<control> 2) <condition> When the TFT operation = "Create a new TFT" and two or more packet filters among all TFTs associated with the PDN connection would have identical packet filter precedence values. </condition> </control>
<control> 3) <condition> When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier. </condition> </control>
<control> <condition> <condition> In case 2, </condition> <condition> if the old packet filters do not belong to the default EPS bearer context, </condition> </condition> <action> the network shall not diagnose an error, </action> <action> shall further process the new request </action> </control> and, <control> <condition> if it was processed successfully, </condition> <action> shall delete the old packet filters which have identical filter precedence values. </action> <action> Furthermore, the network shall perform an EPS bearer context deactivation request procedure to deactivate the dedicated EPS bearer context(s) for which it has deleted the packet filters. </action> </control>
<control> <condition> <condition> In case 2, </condition> <condition> if one or more old packet filters belong to the default EPS bearer context, </condition> </condition> <action> the network shall release the relevant PDN connection using the EPS bearer context deactivation procedure. </action> </control> <control> <condition> <condition> if it is the last remaining PDN connection </condition> and <condition> EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> </condition> <action> the network shall detach the UE using detach type "re-attach required". </action> </control>
<control> <condition> Otherwise </condition> <action> the network shall reject the allocation request with ESM cause #45 "syntactical errors in packet filter(s)". </action> </control>
The network may include a Back-off timer value IE in the BEARER RESOURCE ALLOCATION REJECT message.
<control> <condition> <condition> If the Back-off timer value IE is included </condition> and <condition> the ESM cause value is different from #26 "insufficient resources" </condition> and <condition> #65 "maximum number of EPS bearers reached", </condition> </condition> <action> the network may include the Re-attempt indicator IE to indicate: a) whether the UE is allowed to attempt a secondary PDP context activation procedure in the PLMN for the same APN in A/Gb or Iu mode or a PDU session modification procedure in the PLMN for the same APN in N1 mode; </action> and <action> b) whether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN. </action> </control>
<control> <condition> Upon receipt of a BEARER RESOURCE ALLOCATION REJECT message, </condition> <action> the UE shall stop the timer T3480, </action> <action> release the traffic flow aggregate description associated to the PTI value, </action> and <end_state> enter the state PROCEDURE TRANSACTION INACTIVE. </end_state> </control>
6.5.3.4.2 Handling of network rejection due to ESM cause #26
<control> <condition> <condition> If the ESM cause value is #26 "insufficient resources" </condition> and <condition> the Back-off timer value IE is included, </condition> </condition> <action> the UE shall ignore the Re-attempt indicator IE provided by the network, if any, </action> and <action> take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE </action> (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.5): <control> <control> i) <condition> if the timer value indicates neither zero nor deactivated, </condition> <action> the UE shall stop timer T3396 associated with the corresponding APN, </action> <condition> if it is running. </condition> </control> <control> <action> The UE shall then start T3396 with the value provided in the Back-off timer value IE </action> and <action> not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN </action> <condition> until timer T3396 expires or timer T3396 is stopped. </condition> </control> <control> <condition> <condition> If the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> </control> <control> <action> the UE shall stop the timer T3396 associated with no APN </action> <condition> if it is running. </condition> </control> <control> <action> The UE shall start timer T3396 with the received value </action> and <action> not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", </action> or <action> another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, </action> <condition> <condition> until timer T3396 expires </condition> or <condition> timer T3396 is stopped. </condition> </condition> <control> <action> The UE shall not stop timer T3396 </action> <condition> upon a PLMN change or inter- system change; </condition> </control> </control> </control> <control> ii) <condition> if the timer value indicates that this timer is deactivated, </condition> <control> <action> the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for the same APN </action> <condition> <condition> until the UE is switched off </condition> or <condition> the USIM is removed </condition> or <condition> the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST </condition> or <condition> MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network </condition> or <condition> a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. </condition> </condition> </control> <control> <condition> If the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </control> <control> <action> the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", </action> or <action> another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, </action> <condition> <condition> until the UE is switched off or the USIM is removed, </condition> <condition> or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, </condition> or <condition> a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. </condition> </condition> </control> <control> <action> The timer T3396 remains deactivated </action> <condition> upon a PLMN change or inter-system change; </condition> </control> </control> or <control> iii) <condition> if the timer value indicates zero, </condition> <action> the UE: a) shall stop timer T3396 associated with the corresponding APN, if running, </action> and <action> may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; </action> and <control> b) <condition> <condition> if the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE. </action> </control> </control> </control>
<control> <condition> If the Back-off timer value IE is not included, </condition> <action> the UE may send a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST messages for the same APN. </action> </control>
The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.
<control> <condition> <condition> If the timer T3396 is running </condition> <condition> when the UE enters state EMM-DEREGISTERED, </condition> </condition> </control> <control> <action> the UE remains switched on, </action> and <action> the USIM in the UE remains the same, </action> then <action> timer T3396 is kept running </action> <condition> until it expires or it is stopped. </condition> </control>
<control> <condition> <condition> If the UE is switched off when the timer T3396 is running, </condition> and <condition> if the USIM in the UE remains the same when the UE is switched on, </condition> </condition> </control> the UE behaves as follows: <control> a) <action> let t1 be the time remaining for T3396 timeout at switch off </action> and <action> let t be the time elapsed between switch off and switch on. </action> <condition> If t1 is greater than t, </condition> <action> then the timer shall be restarted with the value t1 t. </action> </control> <control> <condition> If t1 is equal to or less than t, </condition> <action> then the timer need not be restarted. </action> <condition> If the UE is not capable of determining t, </condition> <action> then the UE shall restart the timer with the value t1; </action> </control> <control> b) <condition> if prior to switch off, </condition> <action> timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, </action> </control> and <control> <condition> if timer T3396 is restarted at switch on, </condition> then <action> the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5; </action> </control> and <control> c) <condition> <condition> if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, </condition> and <condition> if timer T3396 is restarted at switch on, </condition> </condition> then <action> the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5. </action> </control>
6.5.3.4.3 Handling of network rejection due to ESM cause other than ESM cause #26
<control> <condition> <condition> If the ESM cause value is different from #26 "insufficient resources" and #65 "maximum number of EPS bearers reached", </condition> <condition> and the Back-off timer value IE is included, </condition> </condition> <action> the UE shall behave as follows depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.6): </action> </control> <control> a) <condition> if the timer value indicates neither zero nor deactivated, </condition> <action> the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the bearer resource allocation procedure and PLMN and APN combination </action> </control> and <control> <action> not send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN </action> <condition> until the back-off timer expires, </condition> </control> the UE is switched off or the USIM is removed; <control> b) <condition> if the timer value indicates that this timer is deactivated, </condition> <action> the UE shall not send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN </action> <condition> until the UE is switched off or the USIM is removed; </condition> </control> and <control> c) <condition> if the timer value indicates zero, </condition> <action> the UE may send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN. </action> </control>
<control> <condition> If the Back-off timer value IE is not included, </condition> then <action> the UE shall ignore the Re-attempt Indicator IE provided by the network, if any. </action> </control>
<control> 1) Additionally, <condition> if the ESM cause value is #32 "service option not supported", </condition> or <condition> #33 "requested service option not subscribed", </condition> </control> the UE shall proceed as follows: <control> a) <condition> <condition> if the UE is registered in the HPLMN </condition> or <condition> in a PLMN that is within the EHPLMN list, </condition> </condition> the <action> UE shall behave as described above in the present subclause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 in USIM file NAS as specified in 3GPP TS 31.102 , if available, as CONFIG back-off timer value; </action> </control> and <control> b) <condition> <condition> otherwise, </condition> <condition> if the UE is not registered in its HPLMN </condition> or <condition> a PLMN that is within the EHPLMN list </condition> or <condition> the SM_RetryWaitTime value is not configured, </condition> </condition> <action> the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer. </action> </control>
<control> 2) <condition> For ESM cause values different from #32 "service option not supported", </condition> or <condition> #33 "requested service option not subscribed", </condition> the UE behaviour regarding the start of a back-off timer is unspecified. </control>
<control> <action> The UE shall not stop any back-off timer </action> <condition> upon a PLMN change or inter-system change. </condition> </control> <control> <condition> If the network indicates that a back-off timer for the bearer resource allocation procedure and PLMN and APN combination is deactivated, </condition> <action> then it remains deactivated upon a PLMN change or inter-system change. </action> </control>
NOTE 1: This means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode or N1 mode to S1 mode. Thus the UE can still be prevented from sending another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN.
<control> <condition> <condition> If the back-off timer is started upon receipt of BEARER RESOURCE ALLOCATION REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) </condition> or <condition> the back-off timer is deactivated, </condition> </condition> </control> the UE behaves as follows: <control> 1) <condition> after a PLMN change </condition> <action> the UE may send a BEARER RESOURCE ALLOCATION REQUEST message for the same APN in the new PLMN, </action> <condition> if the back-off timer is not running </condition> and is not deactivated for the bearer resource allocation procedure and the combination of new PLMN and APN; </control>
<control> Furthermore as an implementation option, <condition> <condition> for the ESM cause values #32 "service option not supported" </condition> or <condition> #33 "requested service option not subscribed", </condition> <condition> if the network does not include a Re-attempt indicator IE, </condition> </condition> </control> <control> <action> the UE may decide not to automatically send another BEARER RESOURCE ALLOCATION REQUEST message for the same APN that was sent by the UE, </action> <condition> if the UE is registered to a new PLMN which is in the list of equivalent PLMNs. </condition> </control>
<control> 2) <condition> <condition> if the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, </condition> or <condition> the UE ignores the Re-attempt indicator IE, </condition> </condition> e.g. because the Back-off timer value IE is not included, then: <control> a) <condition> <condition> if the UE is registered in its HPLMN </condition> or <condition> in a PLMN that is within the EHPLMN list, </condition> </condition> <action> the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 or in USIM file NAS as specified in 3GPP TS 31.102, if available, </action> to <action> determine whether the UE may attempt a CONFIG secondary PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session modification procedure for the same PLMN and APN combination in N1 mode; </action> </control> and <control> b) <condition> <condition> if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, </condition> or <condition> if the NAS configuration MO as specified in 3GPP TS 24.368 is not available </condition> and <condition> the value for inter-system change is not configured in the USIM file NAS, </condition> </condition> then the UE behaviour regarding a secondary PDP CONFIG context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session modification procedure for the same PLMN and APN combination in N1 mode are unspecified; </control> </control> and
<control> 3) <condition> <condition> if the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, </condition> then <condition> depending on the timer value received in the Back-off timer value IE, </condition> </condition> <action> for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the bearer resource allocation procedure with the value provided by the network, </action> </control> or <control> <action> deactivate the respective back-off timer as follows: </action> </control> <control> a) <condition> if the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, </condition> <action> the UE shall start or deactivate the back-off timer for S1 mode only; </action> </control> and <control> b) <condition> otherwise </condition> <action> the UE shall start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode. </action> </control>
<control> <condition> <condition> If the back-off timer for a PLMN and APN combination was started or deactivated in A/Gb or Iu mode upon receipt of an ACTIVATE SECONDARY PDP CONTEXT REJECT message (see 3GPP TS 24.008 ) </condition> and <condition> the network indicated that re-attempt in S1 mode is allowed, </condition> </condition> <action> then this back-off timer does not prevent the UE from sending a BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. </action> </control> <control> <condition> If the network indicated that re-attempt in S1 mode is not allowed, </condition> <action> the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN </action> <condition> after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed. </condition> </control>
<control> <condition> <condition> If a back-off timer for a PLMN and APN combination, in combination with any S-NSSAI or without S-NSSAI (see 3GPP TS 24.501 ) was started or deactivated in N1 mode </condition> <condition> upon receipt of a PDU SESSION MODIFICATION REJECT message (see 3GPP TS 24.501 ) </condition> and <condition> the network indicated that re-attempt in S1 mode is allowed, </condition> </condition> then <action> this back-off timer does not prevent the UE from sending a BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN </action> <condition> after inter-system change to S1 mode. </condition> </control> <control> <condition> If the network indicated that re-attempt in S1 mode is not allowed, </condition> <action> the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN </action> <condition> after inter-system change to S1 mode until the timer expires, </condition> <action> the UE is switched off or the USIM is removed. </action> </control> <control> <condition> If more than one back-off timer for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed </condition> and <condition> no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, </condition> <action> the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode </action> <condition> until all timers have expired. </condition> </control> <control> <condition> If at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, </condition> <action> the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN </action> <condition> until the UE is switched off or the USIM is removed. </condition> </control>
NOTE 2: The back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.
NOTE 3: Reference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.
<control> <condition> If the ESM cause value is #65 "maximum number of EPS bearers reached", </condition> <action> the UE shall determine the PLMN's maximum number of EPS bearer contexts in S1 mode (see subclause 6.5.0) as the number of active EPS bearer contexts it has. </action> <action> The UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any. </action> </control>
NOTE 5: In some situations, when attempting to establish multiple EPS bearer contexts, the number of active EPS bearer contexts in the UE when cause #65 is received is not equal to the maximum number of EPS bearer contexts reached in the network.
<control> The PLMN's maximum number of EPS bearer contexts in S1 mode applies to the PLMN in which the ESM cause #65 "maximum number of EPS bearers reached" is received. <condition> When the UE is switched off or when the USIM is removed, </condition> <action> the UE shall clear all previous determinations representing any PLMN's maximum number of EPS bearer contexts in S1 mode. </action> </control> <control> <condition> Upon successful registration with a new PLMN, </condition> <action> the UE may clear previous determinations representing any PLMN's maximum number of EPS bearer contexts in S1 mode. </action> </control>
The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.
6.5.3.4A Handling the maximum number of active EPS bearer contexts
<control> <condition> <condition> If the UE requests allocation of additional bearer resources, </condition> and <condition> the network has reached its maximum number of active EPS bearer contexts, </condition> </condition> <action> then the network can: a) reject the request if the network decides that it is necessary to allocate a dedicated EPS bearer context; </action> or <action> b) accept the request by sending a MODIFY EPS BEARER CONTEXT REQUEST message. </action> </control>
NOTE: An example of where the network will reject the request for allocation of additional bearer resources is when the request includes a GBR requirement while all existing bearers are non-GBR bearers, and the maximum number of active EPS bearer contexts has been reached at the network.
<control> <condition> <condition> If the maximum number of active EPS bearer contexts is reached at the UE </condition> (see subclause 6.5.0) and <condition> the UE de- activates an active EPS bearer context prior to sending the request for additional bearer resources, </condition> </condition> then choosing which EPS bearer context to de-activate is a implementation specific, however the <action> UE shall not deactivate a default EPS bearer context for emergency. </action> </control>
6.5.3.5 Abnormal cases in the UE
The following abnormal cases can be identified: <control> a) <condition> Expiry of timer T3480: On the first expiry of the timer T3480, </condition> <action> the UE shall resend the BEARER RESOURCE ALLOCATION REQUEST </action> and <action> shall reset and restart timer T3480. </action> This retransmission is repeated four times, </control> i.e. <control> <condition> on the fifth expiry of timer T3480, </condition> <action> the UE shall abort the procedure, release the PTI allocated for this activation and enter the state PROCEDURE TRANSACTION INACTIVE. </action> </control>
<control> b) <condition> Unknown EPS bearer context </condition> </control>
<control> <condition> Upon receipt of the BEARER RESOURCE ALLOCATION REJECT message including ESM cause #43 "invalid EPS bearer identity", </condition> <action> the UE shall deactivate the existing default EPS bearer context locally without peer-to-peer signalling between the UE and the MME </action> and <action> shall stop the timer T3480. </action> </control>
<control> c) <condition> Collision of a UE requested bearer resource allocation procedure </condition> and <condition> an EPS bearer context deactivation procedure. </condition> </control>
<control> <condition> When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message for the default EPS bearer context related to the UE requested bearer resource allocation procedure, </condition> <action> the UE shall abort the UE requested bearer resource allocation procedure </action> and <action> shall stop the timer T3480 and proceed with the EPS bearer context deactivation procedure. </action> </control>
6.5.3.6 Abnormal cases on the network side
The following abnormal case can be identified: <control> a) <condition> No PDN connection with the linked EPS bearer identity activated: </condition> </control> <control> <condition> If the linked EPS bearer identity included in the BEARER RESOURCE ALLOCATION REQUEST message does not belong to the default EPS bearer context of an established PDN connection, </condition> <action> the MME shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #43 "invalid EPS bearer identity". </action> </control>
<control> b) <condition> BEARER RESOURCE ALLOCATION REQUEST message received for a PDN connection established for emergency bearer services: </condition> <action> The MME shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #31 "request rejected, unspecified". </action> </control>
6.5.4 UE requested bearer resource modification procedure
6.5.4.1 General
The purpose of the UE requested bearer resource modification procedure is for a UE to request a modification, or release of bearer resources for a traffic flow aggregate, or modification of a traffic flow aggregate by replacing packet filters or adding packet filters, or re-negotiate header compression configuration associated to an EPS bearer context, or to indicate a change of 3GPP PS data off UE status for a PDN connection. <control> <condition> When requesting a modification of bearer resources for a traffic flow aggregate or a modification of a traffic flow aggregate, </condition> <action> the UE can modify the existing GBR. </action> </control>
<control> <condition> If accepted by the network, </condition> <action> this procedure invokes a dedicated EPS bearer context activation procedure (see subclause 6.4.2), an EPS bearer context modification procedure (see subclause 6.4.3), </action> or <action> an EPS bearer context deactivation procedure (see subclause 6.4.4). </action> </control>
<control> <condition> If there is a PDN connection for emergency bearer services established, </condition> <action> the UE shall not request a modification of bearer resources for this PDN connection. </action> </control>
<control> <condition> When the UE requested bearer resource modification procedure is used to indicate a change of 3GPP PS data off UE status for a PDN connection (see subclause 6.3.10), </condition> </control> <control> <action> the UE shall initiate the UE requested bearer resource modification procedure </action> <condition> even if the timer T3396 or the back-off timer is running or is deactivated. </condition> </control>
6.5.4.2 UE requested bearer resource modification procedure initiation
<control> <condition> In order to request the modification of bearer resources for one traffic flow aggregate, </condition> <action> the UE shall send a BEARER RESOURCE MODIFICATION REQUEST message to the MME, </action> <action> start timer T3481 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.4.2.1). </action> </control>
<control> <action> The UE shall include the EPS bearer identity of the EPS bearer associated with the traffic flow aggregate in the EPS bearer identity for packet filter IE. </action> </control>
<control> <condition> To request a change of the GBR without changing the packet filter(s), </condition> <action> the UE shall set the TFT operation code in the Traffic flow aggregate IE to "no TFT operation" and include the packet filter identifier(s) to which the change of the GBR applies in the Packet filter identifier parameter in the parameters list. </action> <action> The UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE. </action> </control>
<control> <condition> To request a modification of a traffic flow aggregate, </condition> <action> the UE shall set the TFT operation code in the Traffic flow aggregate IE to "Replace packet filters in existing TFT" or "Add packet filters to existing TFT". </action> </control> <control> <condition> If the TFT operation code is set to "Add packet filters to existing TFT", </condition> <action> the UE shall include in the parameter list one existing packet filter identifier to which the newly added packet filter(s) is linked. </action> </control> <control> <condition> If the EPS bearer is a GBR bearer and the UE also wishes to request a change of GBR, </condition> <action> the UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE. </action> </control>
<control> <condition> To request a release of bearer resources, </condition> <action> the UE shall set the TFT operation code in the Traffic flow aggregate IE to "Delete packet filters from existing TFT". </action> </control> <control> <condition> <condition> If the EPS bearer is a GBR bearer </condition> and <condition> the UE does not request the release of all bearer resources, </condition> </condition> <action> the UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE. </action> </control>
<control> <condition> To request re-negotiation of header compression configuration associated to an EPS bearer context, </condition> <action> the UE shall include the Header compression configuration IE in the BEARER RESOURCE MODIFICATION REQUEST message </action> </control> <control> <condition> if the network indicated "Control plane CIoT EPS optimization supported" </condition> and <condition> "Header compression for control plane CIoT EPS optimization supported" in the EPS network feature support IE. </condition> </control>
<control> <condition> <condition> After an inter-system change from N1 mode to S1 mode, </condition> if: a) <condition> the UE is operating in single-registration mode </condition> and <condition> has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network; </condition> </condition> </control> <control> b) <condition> the PDN type value of the PDN type IE is set to "IPv4", "IPv6" or "IPv4v6"; </condition> </control> <control> c) <condition> the UE indicates "Control plane CIoT EPS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message; </condition> </control> and <control> d) <condition> the network indicates "Control plane CIoT 5GS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message; </condition> <action> the UE shall send a BEARER RESOURCE MODIFICATION REQUEST message to the MME </action> and <action> include the Header compression configuration IE to negotiate the header compression configuration. </action> </control>
<control> <condition> To indicate a change of 3GPP PS data off UE status associated to a PDN connection, </condition> <action> the UE shall include the protocol configuration options IE in the BEARER RESOURCE MODIFICATION REQUEST message </action> and <action> set the 3GPP PS data off UE status </action> </control> <control> <condition> only if: a) the network included the 3GPP PS data off support indication in the protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message when the PDN connection was established; </condition> </control> <control> or b) <condition> the PDU session was established when in N1 mode. </condition> </control>
The UE behaves as described in subclause 6.3.10.
<control> <condition> <condition> If the UE requests the modification of a traffic flow aggregate, </condition> <condition> which is assigned to a dedicated EPS bearer context, </condition> </condition> <action> it shall ensure that at least one packet filter applicable for the uplink direction remains among the packet filters created on request from the UE in that TFT, or no own packet filters. </action> </control>
NOTE: <control> <condition> <condition> If the UE requests the release of all bearer resources of a GBR bearer </condition> and <condition> includes a Required traffic flow QoS IE in the BEARER RESOURCE MODIFICATION REQUEST message, </condition> </condition> the network ignores the Required traffic flow QoS IE. </control>
<control> <condition> If the UE includes the Required traffic flow QoS IE, </condition> <action> the UE shall set the QCI to the current QCI value of the EPS bearer context. </action> </control>
<control> <condition> If the UE requests the release of bearer resources, </condition> <action> the ESM cause value typically indicates one of the following: #36: regular deactivation. </action> </control>
UE Network
Start T3481 BEARER RESOURCE MODIFICATION REQUEST ACTIVATE DEDICATED EPS BEARER CONTEXT
Stop T3481 REQUEST OR MODIFY EPS BEARER CONTEXT REQUEST
Stop T3481 OR DEACTIVATE EPS BEARER CONTEXT REQUEST
Stop T3481 OR BEARER RESOURCE MODIFICATION REJECT
Stop T3481
<control> <condition> For the NBIFOM procedures as defined in 3GPP TS 24.161, </condition> <action> the UE may send a BEARER RESOURCE MODIFICATION REQUEST message to the MME. </action> </control>
It is possible that the traffic flow aggregate IE is not needed in the following procedures: a) re-negotiation of header compression configuration associated to an EPS bearer context; b) indicating a change of 3GPP PS data off UE status associated to a PDN connection; or c) NBIFOM procedures.
<control> <condition> If the traffic flow aggregate IE is not needed, </condition> <action> the UE shall set: a) the length indicator of the Traffic flow aggregate IE to the value 1; </action> </control> <control> b) <action> the TFT operation code to "000"; </action> </control> <control> c) <action> the E bit to zero; </action> </control> and <control> d) <action> the number of packet filters to zero. </action> </control>
6.5.4.3 UE requested bearer resource modification procedure accepted by the network
<control> <condition> Upon receipt of the BEARER RESOURCE MODIFICATION REQUEST message, </condition> <action> the MME checks whether the resources requested by the UE can be established, </action> <action> modified or released by verifying the EPS bearer identity given in the EPS bearer identity for packet filter IE. </action> </control>
<control> <condition> If the bearer resource modification requested is accepted by the network, </condition> <action> the MME shall initiate either a dedicated EPS bearer context activation procedure, </action> <action> an EPS bearer context modification procedure </action> or <action> an EPS bearer context deactivation procedure. </action> </control>
<control> <condition> If the request to re-negotiate header compression configuration associated to an EPS bearer context is accepted by the network, </condition> <action> the MME shall initiate an EPS bearer context modification procedure. </action> </control>
<control> <condition> If the bearer resource modification requests a release of bearer resources that results in the TFT of the EPS bearer context containing only packet filters applicable to the uplink direction, </condition> <action> the network may initiate the EPS bearer context deactivation procedure. </action> </control>
<control> <condition> <condition> Upon receipt of an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST, </condition> <condition> MODIFY EPS BEARER CONTEXT REQUEST </condition> or <condition> DEACTIVATE EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the BEARER RESOURCE MODIFICATION REQUEST message, </condition> </condition> <action> the UE shall stop timer T3481 </action> and <action> enter the state PROCEDURE TRANSACTION INACTIVE. </action> </control> UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. <control> <condition> While the PTI value is not released, </condition> <action> the UE regards any received ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST or DEACTIVATE EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see subclause 7.3.1). </action> </control>
<control> i) <condition> If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is received, </condition> <action> the UE shall verify that the EPS bearer identity given in the EPS bearer identity IE is not already used by any EPS bearer context. </action> <action> The UE shall then proceed as described in subclause 6.4.2.3 or subclause 6.4.2.4. </action> </control>
<control> ii) <condition> If the MODIFY EPS BEARER CONTEXT REQUEST message is received, </condition> <action> the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is any of the active EPS bearer contexts. </action> <action> The UE shall then proceed as described in subclause 6.4.3.3 or subclause 6.4.3.4. </action> </control>
<control> iii) <condition> If the DEACTIVATE EPS BEARER CONTEXT REQUEST message is received, </condition> <action> the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is one of the active EPS bearer contexts. </action> <action> The UE shall then proceed as described in subclause 6.4.4.3. </action> </control>
<control> <condition> <condition> In case i, </condition> <condition> after successful completion of the dedicated EPS bearer context activation procedure, </condition> </condition> <action> the network may initiate an EPS bearer context modification procedure to delete the packet filters which have packet filter identifiers indicated by the UE in the Traffic flow aggregate IE in the BEARER RESOURCE MODIFICATION REQUEST message </action> and <action> for which the network created new packet filters during the dedicated EPS bearer context activation procedure. </action> </control> <control> <condition> In this case </condition> <action> the MME shall set the procedure transaction identity value in the MODIFY EPS BEARER CONTEXT REQUEST message to "no procedure transaction identity assigned". </action> </control>
6.5.4.4 UE requested bearer resource modification procedure not accepted by the network
6.5.4.4.1 General
<control> <condition> If the bearer resource modification requested cannot be accepted by the network, </condition> <action> the MME shall send a BEARER RESOURCE MODIFICATION REJECT message to the UE. </action> The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested bearer resource modification. </control>
The ESM cause value typically indicates one of the following: #26: insufficient resources; #30: request rejected by Serving GW or PDN GW; #31: request rejected, unspecified; #32: service option not supported; #33: requested service option not subscribed; #34: service option temporarily out of order; #35: PTI already in use; #37: EPS QoS not accepted; #41: semantic error in the TFT operation; #42: syntactical error in the TFT operation; #43: invalid EPS bearer identity; #44: semantic error(s) in packet filter(s); #45: syntactical error(s) in packet filter(s); #56: collision with network initiated request; #59: unsupported QCI value; #60: bearer handling not supported; or #95 111: protocol errors.
<control> If the bearer resource modification requested is for an established LIPA PDN connection or SIPTO at the local network PDN connection, then the network shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #60 "bearer handling not supported". </control>
<control> <condition> If the requested new TFT is not available, </condition> then <action> the BEARER RESOURCE MODIFICATION REJECT message shall be sent. </action> </control>
<control> The TFT in the request message is checked by the network for different types of TFT IE errors as follows: </control> <control> a) <condition> <condition> Semantic errors in TFT operations: </condition> 1) <condition> When the TFT operation is an operation other than "Replace packet filters in existing TFT", </condition> </condition> <action> "Add packet filters to existing TFT", </action> <action> "Delete packet filters from existing TFT" </action> or <action> "No TFT operation". </action> </control>
<control> 2) <condition> When the TFT operation is "Replace packet filters in existing TFT", "Add packet filters to existing TFT" or "Delete packet filters from existing TFT", </condition> the EPS bearer context being modified is the default EPS bearer content and there is no TFT for the default EPS bearer context. </control>
<control> 3) TFT operation = "Delete packet filters from existing TFT" when it would render the TFT empty. </control>
<control> <condition> In case 1 </condition> <action> the network shall reject the modification request with ESM cause #41 "semantic error in the TFT operation". </action> </control>
<control> <condition> In case 2, </condition> <condition> if the TFT operation is "Delete packet filters from existing TFT", </condition> <action> the network shall further process the new request </action> </control> and, <control> <condition> if no error according to items b, c, and d was detected, </condition> <action> shall perform an EPS bearer context modification procedure including the value of EPS bearer identity for packet filter IE in the EPS bearer identity IE and a TFT IE with TFT operation = "Delete existing TFT" in the MODIFY EPS BEARER CONTEXT REQUEST message. </action> </control>
<control> <condition> <condition> In case 2, </condition> <condition> if the TFT operation is "Replace packet filters in existing TFT" </condition> or <condition> "Add packet filters to existing TFT", </condition> </condition> <action> the network shall process the new request as a request with TFT operation = "Create a new TFT". </action> </control>
<control> <condition> In case 3, </condition> <condition> if the packet filters belong to a dedicated EPS bearer context, </condition> <action> the network shall process the new deletion request </action> </control> and, <control> <condition> if no error according to items b, c, and d was detected, </condition> <action> delete the existing TFT. </action> </control> <control> <condition> After successful deletion of the TFT, </condition> <action> the network shall perform an EPS bearer context deactivation request procedure to deactivate the dedicated EPS bearer context between the UE and the network. </action> </control>
<control> <condition> In case 3, </condition> <condition> if the packet filters belong to the default EPS bearer context, </condition> <action> the network shall process the new deletion request </action> </control> and <control> <condition> if no error according to items b, c, and d was detected </condition> <action> then perform an EPS bearer context modification procedure to remove the existing TFT of the default EPS bearer context, this corresponds to using match-all packet filter for the default EPS bearer context. </action> </control>
<control> b) <condition> Syntactical errors in TFT operations: 1) When the TFT operation = "Replace packet filters in existing TFT", "Add packet filters to existing TFT" or "Delete packet filters from existing TFT", and the packet filter list in the TFT IE is empty. </condition> </control>
<control> 2) <condition> TFT operation = "No TFT operation" with a non-empty packet filter list in the TFT IE. </condition> </control>
<control> 3) <condition> TFT operation = "Replace packet filters in existing TFT" when the packet filter to be replaced does not exist in the original TFT. </condition> </control>
<control> 4) <condition> TFT operation = "Delete packet filters from existing TFT" when the packet filter to be deleted does not exist in the original TFT. </condition> </control>
<control> 5) <condition> Void </condition> </control>
<control> <condition> 6) When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list. </condition> </control>
<control> 7) <condition> TFT operation = "No TFT operation" with an empty parameters list. </condition> </control>
<control> <condition> In case 3 </condition> <action> the network shall not diagnose an error, </action> <action> shall further process the replace request </action> </control> and, <control> <condition> if no error according to items c and d was detected, </condition> <action> shall perform an EPS bearer context modification procedure using TFT operation = "Add packet filters to existing TFT" to include the packet filters received to the existing TFT. </action> </control>
<control> <condition> In case 4 </condition> <action> the network shall not diagnose an error, </action> <action> shall further process the deletion request </action> </control> and, <control> <condition> if no error according to items c and d was detected, </condition> <action> shall perform an EPS bearer context modification procedure including the value of EPS bearer identity for packet filter IE in the EPS bearer identity IE and a TFT IE with TFT operation = "Delete packet filters from existing TFT" and the received packet filter identifier(s) in the MODIFY EPS BEARER CONTEXT REQUEST message. </action> </control>
<control> <condition> Otherwise </condition> <action> the network shall reject the modification request with ESM cause #42 "syntactical error in the TFT operation". </action> </control>
<control> c) Semantic errors in packet filters: 1) When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the network determines a semantic error in a packet filter is outside the scope of the present document. </control>
<control> 2) <condition> When the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter applicable for the uplink direction. </condition> </control>
The network shall reject the modification request with ESM cause #44 "semantic errors in packet filter(s)".
<control> d) <condition> <condition> Syntactical errors in packet filters: 1) When the TFT operation = "Replace packet filters in existing TFT" or "Add packet filters to existing TFT", </condition> and <condition> two or more packet filters in the resultant TFT would have identical packet filter identifiers. </condition> </condition> </control>
<control> 2) <condition> <condition> When the TFT operation = "Replace packet filters in existing TFT" or "Add packet filters to existing TFT", </condition> and <condition> two or more packet filters in all TFTs associated with the PDN connection would have identical packet filter precedence values. </condition> </condition> </control>
<control> 3) <condition> When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier. </condition> </control>
<control> <condition> In case 2, </condition> <condition> if the old packet filters do not belong to the default EPS bearer context, </condition> <action> the network shall not diagnose an error, </action> <action> shall further process the new request </action> </control> and, <control> <condition> if it was processed successfully, </condition> <action> shall delete the old packet filters which have identical filter precedence values. </action> <action> Furthermore, the network shall perform an EPS bearer context deactivation procedure to deactivate the dedicated EPS bearer context(s) for which it has deleted the packet filters. </action> </control>
<control> <condition> <condition> In case 2, </condition> <condition> if one or more old packet filters belong to the default EPS bearer context, </condition> </condition> <action> the network shall release the relevant PDN connection using the EPS bearer context deactivation procedure. </action> <condition> <condition> If the relevant PDN connection is the last one </condition> and <condition> EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> </condition> <action> the network shall detach the UE using detach type "re-attach required". </action> </control>
<control> <condition> Otherwise </condition> <action> the network shall reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)". </action> </control>
The network may include a Back-off timer value IE in the BEARER RESOURCE MODIFICATION REJECT message.
<control> <action> The network shall not include the ESM cause value #26 "insufficient resources" in the BEARER RESOURCE MODIFICATION REJECT message </action> <condition> due to APN based congestion control being active. </condition> </control>
<control> <condition> If the Back-off timer value IE is included </condition> and <condition> the ESM cause value is not #26 "insufficient resources", </condition> <action> the network may include the Re-attempt indicator IE to indicate: a) whether the UE is allowed to attempt a PDP context modification procedure in the PLMN for the same APN in A/Gb or Iu mode or a PDU session modification procedure in the PLMN for the same APN in N1 mode;and b) whether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN. </action> </control>
<control> <condition> If the Back-off timer value IE is included </condition> and <condition> the ESM cause value is not #26 "insufficient resources", </condition> <action> the network may include the Re-attempt indicator IE to indicate: a) whether the UE is allowed to attempt a PDP context modification procedure in the PLMN for the same APN in A/Gb or Iu mode or a PDU session modification procedure in the PLMN for the same APN in N1 mode; and b) whether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN. </action> </control>
<control> <condition> Upon receipt of a BEARER RESOURCE MODIFICATION REJECT message, </condition> <action> the UE shall stop the timer T3481, </action> <action> release the traffic flow aggregate description associated to the PTI value, </action> and <action> enter the state PROCEDURE TRANSACTION INACTIVE. </action> </control> <control> the ESM cause included in the BEARER RESOURCE MODIFICATION REJECT message is #43 "invalid EPS bearer identity", <action> the UE locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling. </action> </control>
6.5.4.4.2 Handling of network rejection due to ESM cause #26
<control> <condition> <condition> If the ESM cause value is #26 "insufficient resources" </condition> and <condition> the Back-off timer value IE is included, </condition> </condition> <action> the UE shall ignore the Re-attempt indicator IE provided by the network, if any, </action> and <action> take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; </action> </control> <control> <condition> if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.5): </condition> </control> <control> i) <condition> if the timer value indicates neither zero nor deactivated, </condition> <action> the UE shall stop timer T3396 associated with the corresponding APN, if it is running. </action> <action> The UE shall then start T3396 with the value provided in the Back-off timer value IE </action> and <action> not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN </action> <condition> until timer T3396 expires or timer T3396 is stopped. </condition> </control> <control> <condition> <condition> If the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall stop the timer T3396 associated with no APN if it is running. </action> <action> The UE shall start timer T3396 with the received value </action> and <action> not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", </action> or <action> another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, </action> <condition> <condition> until timer T3396 expires </condition> or <condition> timer T3396 is stopped. </condition> </condition> </control> <control> <action> The UE shall not stop timer T3396 </action> <condition> <condition> upon a PLMN change </condition> or <condition> inter- system change; </condition> </condition> </control> <control> ii) <condition> if the timer value indicates that this timer is deactivated, </condition> <action> the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for the same APN </action> </control> <control> <condition> <condition> until the UE is switched off </condition> or <condition> the USIM is removed </condition> or <condition> the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network </condition> or <condition> a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. </condition> </condition> </control> <control> <condition> <condition> If the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, </action> </control> <control> <condition> <condition> until the UE is switched off or the USIM is removed, </condition> or <condition> the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, </condition> or <condition> a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. </condition> </condition> </control> <control> <action> The timer T3396 remains deactivated </action> <condition> upon a PLMN change </condition> or <condition> inter-system change; </condition> </control> or <control> iii) <condition> if the timer value indicates zero, </condition> <action> UE: a) shall stop timer T3396 associated with the corresponding APN, if running, </action> and <action> may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; </action> </control> and <control> b) <condition> <condition> if the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall stop timer T3396 associated with no APN, if running, </action> and <action> may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE. </action> </control>
<control> <condition> If the Back-off timer value IE is not included, </condition> <action> the UE may send a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST messages for the same APN. </action> </control>
The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.
<control> <condition> If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, </condition> <action> the UE remains switched on, </action> <action> and the USIM in the UE remains the same, </action> <action> then timer T3396 is kept running until it expires or it is stopped. </action> </control>
<control> <condition> <condition> If the UE is switched off </condition> <condition> when the timer T3396 is running, </condition> and <condition> if the USIM in the UE remains the same </condition> <condition> when the UE is switched on, </condition> </condition> <action> the UE behaves as follows: </action> </control> <control> a) <action> let t1 be the time remaining for T3396 timeout at switch off </action> and <action> let t be the time elapsed between switch off and switch on. </action> <condition> If t1 is greater than t, </condition> <action> then the timer shall be restarted with the value t1 t. </action> </control> <control> <condition> If t1 is equal to or less than t, </condition> <action> then the timer need not be restarted. </action> </control> <control> <condition> If the UE is not capable of determining t, </condition> <action> then the UE shall restart the timer with the value t1; </action> </control> <control> b) <condition> if prior to switch off, </condition> <action> timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, </action> </control> and <control> <condition> if timer T3396 is restarted at switch on, </condition> <action> then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5; </action> </control> and <control> c) <condition> <condition> if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, </condition> and <condition> if timer T3396 is restarted at switch on, </condition> </condition> <action> then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5. </action> </control>
6.5.4.4.3 Handling of network rejection due to ESM cause other than ESM cause #26
<control> <condition> If the ESM cause value is not #26 "insufficient resources", </condition> and <condition> the Back-off timer value IE is included, </condition> <action> the UE shall behave as follows depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.6): </action> <control> <control> a) <condition> if the timer value indicates neither zero nor deactivated, </condition> <action> the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the bearer resource modification procedure and PLMN and APN combination </action> and <action> not send another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in subclause 6.5.4.1, </action> </control> <control> <condition> in the PLMN for the same APN until the back-off timer expires, </condition> <action> the UE is switched off </action> or <action> the USIM is removed; </action> </control> </control> <control> b) <condition> if the timer value indicates that this timer is deactivated, </condition> <action> the UE shall not send another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in subclause 6.5.4.1, in the PLMN for the same APN </action> <condition> until the UE is switched off </condition> or <condition> the USIM is removed; </condition> </control> and <control> c) <condition> if the timer value indicates zero, </condition> <action> the UE may send another BEARER RESOURCE MODIFICATION REQUEST message in the PLMN for the same APN. </action> </control> </control>
<control> <condition> If the Back-off timer value IE is not included, </condition> <action> then the UE shall ignore the Re-attempt indicator IE provided by the network, if any. </action> </control>
<control> 1) Additionally, <condition> if the ESM cause value is #32 "service option not supported", </condition> or <condition> #33 "requested service option not subscribed", </condition> <action> the UE shall proceed as follows: </action> </control> <control> a) <condition> <condition> if the UE is registered in the HPLMN </condition> or <condition> in a PLMN that is within the EHPLMN list, </condition> </condition> <action> the UE shall behave as described above in the present subclause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 </action> or <action> in USIM file NAS as specified in 3GPP TS 31.102, if available, as CONFIG back-off timer value; </action> </control> and <control> b) <condition> <condition> otherwise, </condition> <condition> if the UE is not registered in its HPLMN </condition> or <condition> a PLMN that is within the EHPLMN list </condition> or <condition> the SM_RetryWaitTime value is not configured, </condition> </condition> <action> the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer. </action> </control>
<control> 2) <condition> For ESM cause values different from #32 "service option not supported", </condition> or <condition> #33 "requested service option not subscribed", </condition> the UE behaviour regarding the start of a back-off timer is unspecified. </control>
<control> <action> The UE shall not stop any back-off timer </action> <condition> <condition> upon a PLMN change or inter-system change. </condition> <condition> If the network indicates that a back-off timer for the bearer resource modification procedure and PLMN and APN combination is deactivated, </condition> </condition> <action> then it remains deactivated upon a PLMN change or inter-system change. </action> </control>
NOTE 1: This means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode or N1 mode to S1 mode. Thus the UE can still be prevented from sending another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in subclause 6.5.4.1, in the PLMN for the same APN. <control> <condition> <condition> If the ESM cause value is #26 "insufficient resources" </condition> and <condition> the Back-off timer value IE is included, </condition> </condition> <action> the UE shall ignore the Re-attempt indicator IE provided by the network, if any, </action> and <action> take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; </action> </control> <control> <condition> if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.5): </condition> </control> <control> i) <condition> if the timer value indicates neither zero nor deactivated, </condition> <action> the UE shall stop timer T3396 associated with the corresponding APN, if it is running. </action> <action> The UE shall then start T3396 with the value provided in the Back-off timer value IE </action> and <action> not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN </action> <condition> until timer T3396 expires or timer T3396 is stopped. </condition> </control> <control> <condition> <condition> If the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall stop the timer T3396 associated with no APN if it is running. </action> <action> The UE shall start timer T3396 with the received value </action> and <action> not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", </action> or <action> another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, </action> <condition> <condition> until timer T3396 expires </condition> or <condition> timer T3396 is stopped. </condition> </condition> </control> <control> <action> The UE shall not stop timer T3396 </action> <condition> <condition> upon a PLMN change </condition> or <condition> inter- system change; </condition> </condition> </control> <control> ii) <condition> if the timer value indicates that this timer is deactivated, </condition> <action> the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for the same APN </action> </control> <control> <condition> <condition> until the UE is switched off </condition> or <condition> the USIM is removed </condition> or <condition> the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network </condition> or <condition> a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. </condition> </condition> </control> <control> <condition> <condition> If the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, </action> </control> <control> <condition> <condition> until the UE is switched off or the USIM is removed, </condition> or <condition> the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, </condition> or <condition> a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. </condition> </condition> </control> <control> <action> The timer T3396 remains deactivated </action> <condition> upon a PLMN change </condition> or <condition> inter-system change; </condition> </control> or <control> iii) <condition> if the timer value indicates zero, </condition> <action> UE: a) shall stop timer T3396 associated with the corresponding APN, if running, </action> and <action> may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; </action> </control> and <control> b) <condition> <condition> if the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall stop timer T3396 associated with no APN, if running, </action> and <action> may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE. </action> </control>
<control> <condition> <condition> If the back-off timer is started upon receipt of BEARER RESOURCE MODIFICATION REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) </condition> or <condition> the back-off timer is deactivated, </condition> </condition> <action> the UE behaves as follows: </action> </control>
<control> 1) <condition> after a PLMN change </condition> <action> the UE may send a BEARER RESOURCE MODIFICATION REQUEST message for the same APN in the new PLMN, </action> </control> <control> <condition> <condition> if the back-off timer is not running </condition> and <condition> is not deactivated for the bearer resource modification procedure and the combination of new PLMN and APN; </condition> </condition> </control>
<control> <condition> <condition> Furthermore as an implementation option, for the ESM cause values #32 "service option not supported" or #33 "requested service option not subscribed", </condition> <condition> if the network does not include a Re-attempt indicator IE, </condition> </condition> <action> the UE may decide not to automatically send another BEARER RESOURCE MODIFICATION REQUEST message for the same APN that was sent by the UE, </action> <condition> if the UE is registered to a new PLMN which is in the list of equivalent PLMNs. </condition> </control>
<control> 2) <condition> <condition> if the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, </condition> or <condition> the UE ignores the Re-attempt indicator IE, </condition> </condition> </control> e.g. because the Back-off timer value IE is not included, <control> then: a) <condition> if the UE is registered in its HPLMN </condition> or <condition> in a PLMN that is within the EHPLMN list, </condition> <action> the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 or in USIM file NAS as specified in 3GPP TS 31.102, if available, </action> <action> to determine whether the UE may attempt a CONFIG PDP context modification procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session modification procedure for the same PLMN and APN combination in N1 mode; </action> </control> and <control> b) <condition> <condition> if the UE is not registered in its HPLMN </condition> or <condition> in a PLMN that is within the EHPLMN list, </condition> or <condition> if the NAS configuration MO as specified in 3GPP TS 24.368 is not available </condition> and <condition> the value for inter-system change is not configured in the USIM file NAS, </condition> </condition> then the UE behaviour regarding a PDP context CONFIG modification procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session modification procedure for the same PLMN and APN combination in N1 mode are unspecified; </control> and
<control> 3) <condition> if the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, </condition> then depending on the timer value received in the Back-off timer value IE, </control> <control> <condition> for each combination of a PLMN from the equivalent PLMN list and the APN </condition> <action> the UE shall start a back-off timer for the bearer resource modification procedure with the value provided by the netwo <control> <condition> <condition> If the ESM cause value is #26 "insufficient resources" </condition> and <condition> the Back-off timer value IE is included, </condition> </condition> <action> the UE shall ignore the Re-attempt indicator IE provided by the network, if any, </action> and <action> take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; </action> </control> <control> <condition> if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.5): </condition> </control> <control> i) <condition> if the timer value indicates neither zero nor deactivated, </condition> <action> the UE shall stop timer T3396 associated with the corresponding APN, if it is running. </action> <action> The UE shall then start T3396 with the value provided in the Back-off timer value IE </action> and <action> not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN </action> <condition> until timer T3396 expires or timer T3396 is stopped. </condition> </control> <control> <condition> <condition> If the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall stop the timer T3396 associated with no APN if it is running. </action> <action> The UE shall start timer T3396 with the received value </action> and <action> not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", </action> or <action> another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, </action> <condition> <condition> until timer T3396 expires </condition> or <condition> timer T3396 is stopped. </condition> </condition> </control> <control> <action> The UE shall not stop timer T3396 </action> <condition> <condition> upon a PLMN change </condition> or <condition> inter- system change; </condition> </condition> </control> <control> ii) <condition> if the timer value indicates that this timer is deactivated, </condition> <action> the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for the same APN </action> </control> <control> <condition> <condition> until the UE is switched off </condition> or <condition> the USIM is removed </condition> or <condition> the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network </condition> or <condition> a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. </condition> </condition> </control> <control> <condition> <condition> If the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, </action> </control> <control> <condition> <condition> until the UE is switched off or the USIM is removed, </condition> or <condition> the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, </condition> or <condition> a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. </condition> </condition> </control> <control> <action> The timer T3396 remains deactivated </action> <condition> upon a PLMN change </condition> or <condition> inter-system change; </condition> </control> or <control> iii) <condition> if the timer value indicates zero, </condition> <action> UE: a) shall stop timer T3396 associated with the corresponding APN, if running, </action> and <action> may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; </action> </control> and <control> b) <condition> <condition> if the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall stop timer T3396 associated with no APN, if running, </action> and <action> may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE. </action> </control> rk, </action> or <action> deactivate the respective back-off timer as follows: </action> </control> <control> a) <condition> if the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, </condition> <action> the UE shall start </action> or <action> deactivate the back-off timer for S1 mode only; </action> </control> and <control> b) <condition> otherwise </condition> <action> the UE shall start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode. </action> </control>
<control> <condition> <condition> If the back-off timer for a PLMN and APN combination was started or deactivated </condition> <condition> upon receipt of an MODIFY PDP CONTEXT REJECT message (see 3GPP TS 24.008 ) </condition> and <condition> the network indicated that re-attempt in S1 mode is allowed, </condition> </condition> <action> then this back-off timer does not prevent the UE from sending a BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. </action> <control> <condition> If the network indicated that re-attempt in S1 mode is not allowed, </condition> <action> the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN </action> <condition> <condition> after inter-system change to S1 mode until the timer expires, </condition> <condition> the UE is switched off </condition> or <condition> the USIM is removed. </condition> </condition> </control> </control>
<control> <condition> <condition> If a back-off timers for a PLMN and APN combination, in combination with any S-NSSAI or without S-NSSAI (see 3GPP TS 24.501 ) was started </condition> or <condition> deactivated in N1 mode </condition> <condition> upon receipt of a PDU SESSION MODIFICATION REJECT message (see 3GPP TS 24.501 ) </condition> <condition> and the network indicated that re-attempt in S1 mode is allowed, </condition> </condition> <action> then this back-off timer does not prevent the UE from sending a BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. </action> </control> <control> <condition> If the network indicated that re-attempt in S1 mode is not allowed, </condition> <action> the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode </action> <condition> until the timer expires, </condition> <action> the UE is switched off or the USIM is removed. </action> </control> <control> <condition> <condition> If more than one back-off timer for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed </condition> and <condition> no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, </condition> </condition> <action> the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN </action> <condition> after inter-system change to S1 mode until all timers have expired. </condition> </control> <control> <condition> If at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, </condition> <action> the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN </action> <condition> until the UE is switched off or the USIM is removed. </condition> </control>
NOTE 2: The back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.
NOTE 3: Reference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.
The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.
6.5.4.5 Abnormal cases in the UE
The following abnormal cases can be identified: <control> a) Expiry of timer T3481: <condition> On the first expiry of the timer T3481, </condition> <action> the UE shall resend the BEARER RESOURCE MODIFICATION REQUEST </action> and <action> shall reset and restart timer T3481. </action> This retransmission is repeated four times, i.e. <control> <condition> on the fifth expiry of timer T3481, </condition> <action> the UE shall abort the procedure, </action> <action> release the PTI allocated for this activation </action> and <action> enter the state PROCEDURE TRANSACTION INACTIVE. </action> </control> <control> <condition> In addition, if the UE had initiated resource release for all the traffic flows for the bearer, </condition> <action> it shall deactivate the EPS bearer context locally without peer-to-peer signalling between the UE and the MME. </action> </control> <control> In order to synchronize the EPS bearer context status with the MME, <condition> on indication of "back to E-UTRAN coverage" from the lower layers, </condition> <action> the UE shall send a TRACKING AREA UPDATE REQUEST message </action> <action>that includes the EPS bearer context status IE </action> </control> <control> <condition> <condition> If the ESM cause value is #26 "insufficient resources" </condition> and <condition> the Back-off timer value IE is included, </condition> </condition> <action> the UE shall ignore the Re-attempt indicator IE provided by the network, if any, </action> and <action> take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; </action> </control> <control> <condition> if the UE is a UE configured to use AC11 15 in selected PLMN, exceptions are specified in subclause 6.3.5): </condition> </control> <control> i) <condition> if the timer value indicates neither zero nor deactivated, </condition> <action> the UE shall stop timer T3396 associated with the corresponding APN, if it is running. </action> <action> The UE shall then start T3396 with the value provided in the Back-off timer value IE </action> and <action> not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN </action> <condition> until timer T3396 expires or timer T3396 is stopped. </condition> </control> <control> <condition> <condition> If the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall stop the timer T3396 associated with no APN if it is running. </action> <action> The UE shall start timer T3396 with the received value </action> and <action> not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", </action> or <action> another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, </action> <condition> <condition> until timer T3396 expires </condition> or <condition> timer T3396 is stopped. </condition> </condition> </control> <control> <action> The UE shall not stop timer T3396 </action> <condition> <condition> upon a PLMN change </condition> or <condition> inter- system change; </condition> </condition> </control> <control> ii) <condition> if the timer value indicates that this timer is deactivated, </condition> <action> the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for the same APN </action> </control> <control> <condition> <condition> until the UE is switched off </condition> or <condition> the USIM is removed </condition> or <condition> the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network </condition> or <condition> a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. </condition> </condition> </control> <control> <condition> <condition> If the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, </action> </control> <control> <condition> <condition> until the UE is switched off or the USIM is removed, </condition> or <condition> the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, </condition> or <condition> a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. </condition> </condition> </control> <control> <action> The timer T3396 remains deactivated </action> <condition> upon a PLMN change </condition> or <condition> inter-system change; </condition> </control> or <control> iii) <condition> if the timer value indicates zero, </condition> <action> UE: a) shall stop timer T3396 associated with the corresponding APN, if running, </action> and <action> may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; </action> </control> and <control> b) <condition> <condition> if the UE did not provide an APN for the establishment of the PDN connection </condition> and <condition> the request type was different from "emergency" and from "handover of emergency bearer services", </condition> </condition> <action> the UE shall stop timer T3396 associated with no APN, if running, </action> and <action> may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE. </action> </control> r resource modification procedure and an EPS bearer context deactivation procedure. <condition> <condition> When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message during the bearer resource modification procedure, </condition> and <condition> the EPS bearer identity indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a EPS bearer context the UE indicated in the UE requested bearer resource modification procedure, </condition> </condition> <action> then the UE shall abort the UE requested bearer resource modification procedure and shall stop the timer T2381 </action> and <action> proceed with the EPS bearer context deactivation procedure. </action> </control>
d) <control> <action> Rejection of a UE requested bearer resource modification procedure </action> <condition> when the UE has initiated the procedure to release all traffic flows for the bearer Upon receipt of a BEARER RESOURCE MODIFICATION REJECT message with ESM cause value #31 "request rejected, unspecified", </condition> </control> <control> <condition> if the UE had initiated resource release for all the traffic flows for the bearer, </condition> <action> it shall deactivate the EPS bearer context locally without peer-to-peer signalling between the UE and the MME </action> and <action> shall stop the timer T3481. </action> </control> <control> <condition> In order to synchronize the EPS bearer context status with the MME, </condition> <action> the UE may send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME. </action> </control>
6.5.4.6 Abnormal cases on the network side
The following abnormal cases can be identified:
<control> a) <condition> Unknown EPS bearer context </condition> </control>
<control> <condition> If the EPS bearer identity provided in the EPS bearer identity for packet filter IE in the BEARER RESOURCE MODIFICATION REQUEST message indicates an EPS bearer identity value </condition> and <condition> this does not belong to any already activated EPS bearer context, </condition> <action> the MME shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #43 "invalid EPS bearer identity". </action> </control>
<control> b) <condition> BEARER RESOURCE MODIFICATION REQUEST message received for a PDN connection established for emergency bearer services: </condition> <action> The MME shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #30 "request rejected by Serving GW or PDN GW". </action> </control>
6.5.5 Handling session management request for UE configured for dual priority
<control> <condition> If timer T3396 is running for a specific APN due to one of the following reasons: </condition> </control> <control> a) <condition> <condition> a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396 </condition> and <condition> ESM cause value #26 "insufficient resources"; </condition> </condition> </control> <control> b) <condition> <condition> a DEACTIVATE EPS BEARER CONTEXT REQUEST message was received with a timer value for timer T3396 </condition> and <condition> ESM cause value #26 "insufficient resources" for a PDN connection established with low priority indicator set to "MS is configured for NAS signalling low priority", </condition> </condition> </control> or <control> a) <condition> <condition> because the UE received a DEACTIVATE EPS BEARER CONTEXT REQUEST message containing a timer value for timer T3396 </condition> and <condition> ESM cause value #26 "insufficient resources" for a PDN connection established with low priority indicator set to "MS is configured for NAS signalling low priority", </condition> <condition> upon request of the upper layers </condition> </condition> </control> the UE can: <control> b) <action> send a PDN CONNECTIVITY REQUEST message to the same APN, with low priority indicator set to "MS is not configured for NAS signalling low priority"; </action> </control> or, <control> c) <action> send a BEARER RESOURCE MODIFICATI <control> b) <condition> BEARER RESOURCE MODIFICATION REQUEST message received for a PDN connection established for emergency bearer services: </condition> <action> The MME shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #30 "request rejected by Serving GW or PDN GW". </action> </control> ON REQUEST </action> or <action> BEARER RESOURCE ALLOCATION REQUEST message, with low priority indicator set to "MS is not configured for NAS signalling low priority", for a PDN connection established with low priority indicator set to "MS is not configured for NAS signalling low priority" exists. </action> </control>
<control> <condition> If timer T3396 is running, </condition> <condition> because any of the following messages containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396 </condition> and <condition> ESM cause value #26 "insufficient resources" </condition> </control> <control> a) <condition> a PDN CONNECTIVITY REQUEST without APN and with request type different from "emergency" and from "handover of emergency bearer services" </condition> , <action> sent together with an ATTACH REQUEST message; </action> </control> <control> b) <condition> a stand-alone PDN CONNECTIVITY REQUEST message without APN and with request type different from "emergency" and from "handover of emergency bearer services"; </condition> </control> or <control> c) <condition> a BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message sent for a non-emergency PDN connection established without APN provided by the UE, </condition> </control> or <control> <condition> <condition> because the UE received a DEACTIVATE EPS BEARER CONTEXT REQUEST message containing a timer value for timer T3396 </condition> and <condition> ESM cause value #26 "insufficient resources" for a non-emergency PDN connection established without APN provided by the UE </condition> and <condition> established with low priority indicator set to "MS is configured for NAS signalling low priority", </condition> then <condition> upon request of the upper layers </condition> </condition> <action> the UE can initiate a new attach procedure </action> or <action> stand-alone PDN CONNECTIVITY REQUEST procedure without APN and with request type different from "emergency" and from "handover of emergency bearer services", with low priority indicator set to "MS is not configured for NAS signalling low priority". </action> </control>
<control> <condition> For requests with low priority indicator set to "MS is configured for NAS signalling low priority", </condition> <action> the UE shall follow the procedures specified in subclause 6.5.1.4. </action> </control>
6.6 Miscellaneous procedures
6.6.1 Exchange of protocol configuration options
6.6.1.1 General
The UE and the PDN GW can exchange protocol configuration options via the dedicated ESM information request procedure or via other ESM procedures.
<control> <condition> If supported by the network and UE end-to-end for a PDN connection, </condition> protocol configuration options shall be exchanged via the extended protocol configuration options IE. </control> <control> <condition> Otherwise </condition> the protocol configuration options IE is used. </control>
NOTE 1: In this version of the protocol inter-system mobility to and from NB-S1 mode is supported. During inter- system-mobility from NB-S1 mode to WB-S1 mode the end-to-end support of the extended protocol configuration options IE can be lost, e.g. if the new MME does not support the extended protocol configuration options IE.
<control> For the UE, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection </control> if <control> <condition> a) the UE is in NB-S1 mode; </condition> </control> <control> b) <condition> the PDN Type requested for the PDN connection is non-IP or Ethernet; </condition> </control> or <control> c) <condition> <condition> the network has indicated support of the extended protocol configuration options IE in the last ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message </condition> and <condition> the network has included the extended protocol configuration options IE in at least one EPS session management message received by the UE for this PDN connection. </condition> </condition> </control>
<control> For the MME, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection </control> if <control> a) <condition> the UE is in NB-S1 mode; </condition> </control> <control> b) <condition> the PDN Type requested for the PDN connection is non-IP or Ethernet; </condition> </control> or <control> c) the UE has indicated support of the extended protocol configuration options IE in the last ATTACH REQUEST or TRACKING AREA UPDATING REQUEST message, and the MME has received the extended protocol configuration options IE in at least one message sent by the PDN GW towards the UE for this PDN connection </control>
NOTE 2: For the PDN GW, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if the last support indication received from the MME or S-GW indicates that extended protocol configuration options is supported for this PDN connection (for details see 3GPP TS 29.274).
6.6.1.2 ESM information request procedure
6.6.1.2.1 General
<control> <control> The ESM information request procedure is used by the network to retrieve ESM information </control> , i.e. <control> protocol configuration options, APN, or both from the UE during the attach procedure </control> <condition> if the UE indicated in the PDN CONNECTIVITY REQUEST message that it has ESM information that needs to be sent security protected. </condition> <control> The purpose of this procedure is to provide privacy for the ESM information if ciphering is enabled in the network. </control> </control>
6.6.1.2.2 ESM information request initiated by the network
<control> <action> The network intiates the ESM information request procedure by sending a ESM INFORMATION REQUEST message to the UE, </action> <action> starting timer T3489 </action> and <end_state> entering the state PROCEDURE TRANSACTION PENDING (see example in figure 6.6.1.2.2.1). </end_state> This message shall be sent only after the security context has been setup, </control> and <control> <condition> if the ESM information transfer flag has been set in the PDN CONNECTIVITY REQUEST message, </condition> <action> The MME shall set the EPS bearer identity of the ESM INFORMATION REQUEST message to the value "no EPS bearer identity assigned" </action> and <action> include the PTI from the associated PDN CONNECTIVITY REQUEST message. </action> </control>
6.6.1.2.3 ESM information request completion by the UE
<control> <condition> Upon receipt of the ESM INFORMATION REQUEST message, </condition> <action> the UE shall send an ESM INFORMATION RESPONSE message to the network. </action> <action> The UE shall include all the protocol configuration options that need to be transferred security protected, and APN if required, to the network in the ESM INFORMATION RESPONSE message. </action> </control>
The UE shall set the EPS bearer identity of the ESM INFORMATION RESPONSE message to the value "no EPS bearer identity assigned" and include the PTI from the ESM INFORMATION REQUEST message.
6.6.1.2.4 ESM information request completion by the network
<control> <condition> Upon receipt of the ESM INFORMATION RESPONSE message, </condition> <action> the network shall stop timer T3489 </action> and <end_state> enter the state PROCEDURE TRANSACTION INACTIVE. </end_state> </control> A protocol configuration options IE or extended protocol configuration options IE included in the ESM INFORMATION RESPONSE message replaces any protocol configuration options IE or extended protocol configuration options IE that the network previously may have received during the attach procedure execution.
6.6.1.2.5 Abnormal cases in the UE
Apart from the case described in subclause 6.3.3, no abnormal cases have been identified.
6.6.1.2.6 Abnormal cases on the network side
The following abnormal cases can be identified: <control> a) Expiry of timer T3489: <condition> On the first expiry of the timer T3489, </condition> <action> the MME shall resend the ESM INFORMATION REQUEST message </action> and <action> shall reset and restart timer T3489. </action> This retransmission is repeated two times, </control> i.e. <control> <condition> on the third expiry of timer T3489, </condition> <action> the MME shall abort the procedure, </action> <action> release any resources for this procedure </action> and <action> reject the associated PDN connectivity procedure including the ESM cause #53 "ESM information not received", in the PDN CONNECTIVITY REJECT message. </action> </control>
6.6.1.3 Exchange of protocol configuration options in other messages
<control> <action> The UE may include a protocol configuration options IE or extended protocol configuration options IE on EPS bearer context activation, EPS bearer context deactivation, EPS bearer context modification, PDN connectivity request, PDN disconnect request, bearer resource allocation request and bearer resource modification request </action> <condition> if the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the PDN GW or the SCEF. </condition> In particular, the UE may use this procedure on EPS bearer context activation to perform the MSISDN notification procedure as specified in 3GPP TS 24.008 , subclause 6.4. </control>
<control> <action> The PDN GW or the SCEF may include a protocol configuration options IE or extended protocol configuration options IE on EPS bearer context activation, EPS bearer context deactivation, EPS bearer context modification, PDN connectivity reject, PDN disconnect reject, bearer resource allocation reject and bearer resource modification reject </action> <condition> if the PDN GW or the SCEF wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE. </condition> In particular, the PDN GW may use this procedure on EPS bearer context activation to perform the MSISDN notification procedure as specified in 3GPP TS 24.008 , subclause 6.4. </control>
6.6.2 Notification procedure
6.6.2.1 General
The network can use the notification procedure to inform the UE about events which are relevant for the upper layer which is using an EPS bearer context or has requested a procedure transaction.
<control> <condition> If the UE has indicated that it supports the notification procedure, </condition> <action> the network may initiate the procedure at any time </action> <condition> while a PDN connection exists or a procedure transaction is ongoing. </condition> </control>
6.6.2.2 Notification procedure initiation by the network
The network initiates the notification procedure by sending a NOTIFICATION message to the UE (see example in figure 6.6.2.2.1).
6.6.2.3 Notification procedure in the UE
<control> <condition> When the UE receives a NOTIFICATION message, </condition> <action> the ESM protocol entity in the UE shall provide the notification indicator to the upper layer. </action> </control>
The notification indicator can have the following value: #1: SRVCC handover cancelled, IMS session re-establishment required.
6.6.2.4 Abnormal cases on the network side
The following abnormal case can be identified:
<control> a) <condition> Lower layer indication of non-delivered NAS PDU due to handover </condition> </control>
<control> <condition> <condition> If the NOTIFICATION message could not be delivered due to an intra MME handover, </condition> <condition> then upon successful completion of the intra MME handover </condition> </condition> <action> the MME shall retransmit the NOTIFICATION message. </action> </control> <control> <condition> <condition> If a failure of the handover procedure is reported by the lower layer </condition> and <condition> the S1 signalling connection exists, </condition> </condition> <action> the MME shall retransmit the NOTIFICATION message. </action> </control>
6.6.3 Remote UE Report procedure
6.6.3.1 General
The purpose of the Remote UE Report procedure is for a UE acting as ProSe UE-to-network relay to notify the network that a remote UE is connected to the ProSe UE-to-network relay or disconnected from the ProSe UE-to-network relay as specified in 3GPP TS 23.303.
6.6.3.2 Remote UE Report initiated by the UE
<control> <action> The UE initiates the Remote UE Report procedure by sending a REMOTE UE REPORT message to the network, </action> <action> starting timer T3493 </action> and <end_state> entering the state PROCEDURE TRANSACTION PENDING (see example in figure 6.6.3.2.1). </end_state> <action> The UE shall include information of newly connected or disconnected remote UEs to the network in the REMOTE UE REPORT message. </action> </control> <control> <condition> If any encrypted IMSI remote UE identity is included in the REMOTE UE REPORT message, </condition> <action> the UE shall include the corresponding ProSe Key Management Function address. </action> <action> The UE shall include the default EPS bearer identity of the PDN connection associated with the remote UE connected to the ProSe UE-to-network relay </action> or <action> disconnected from the ProSe UE-to-network relay. </action> </control>
NOTE: Encrypted IMSI remote UE identities corresponding to different ProSe Key Management Function addresses need to be reported using separate REMOTE UE REPORT messages.
UE Network REMOTE UE REPORT
Start T3493 REMOTE UE REPORT RESPONSE
Stop T3493
6.6.3.3 Remote UE Report completion by the network
<control> <condition> Upon receipt of the REMOTE UE REPORT message, </condition> <action> the MME shall send an REMOTE UE REPORT RESPONSE message to the UE. </action> <action> The MME shall include the PTI from the REMOTE UE REPORT message. </action> </control>
6.6.3.4 Remote UE Report completion by the UE
<control> <condition> Upon receipt of the REMOTE UE REPORT RESPONSE message, </condition> <action> the UE shall stop timer T3493 and enter the state PROCEDURE TRANSACTION INACTIVE. </action> </control>
6.6.3.5 Abnormal cases in the UE
The following abnormal cases can be identified: <control> a) Expiry of timer T3493: <condition> On the first expiry of the timer T3493, </condition> <action> the UE shall resend the REMOTE UE REPORT message </action> and <action> shall reset and restart timer T3493. </action> </control> This retransmission is repeated two times, i.e. <control> <condition> on the third expiry of timer T3493, </condition> <action> the UE shall abort the procedure </action> and <action> release any resources for this procedure. </action> </control>
<control> NOTE: <condition> After the abortion of the Remote UE Report procedure, </condition> <action> the Remote UE Report procedure for the remote UE(s) can be restarted </action> and how to restart the procedure is left to UE implementation. </control>
6.6.3.6 Abnormal cases on the network side
No abnormal cases have been identified.
6.6.4 Transport of user data via the control plane procedure
6.6.4.1 General
The purpose of the transport of user data via the control plane procedure is to transfer user data via the control plane in an encapsulated form between the UE and the MME.
<control> <action> The procedure may be initiated by the UE or the network </action> <condition> when the UE is in EMM-CONNECTED mode. </condition> </control>
<control> <action> The procedure may also be initiated by the UE </action> <condition> in EMM-IDLE mode by including the ESM DATA TRANSPORT message in a CONTROL PLANE SERVICE REQUEST message. </condition> </control>
6.6.4.2 UE initiated transport of user data via the control plane
<control> <condition> Upon receipt of a request to transfer user data via the control plane, </condition> <condition> if the UE is in EMM-CONNECTED mode, </condition> <action> the UE initiates the procedure by sending the ESM DATA TRANSPORT message including the user data to be sent in the User data container IE (see example in figure 6.6.4.2.1). </action> </control> The length of the value part of the User data container IE should not exceed the link MTU size for the respective type of user data (IPv4, IPv6 or Non-IP). If the user data in the value part of the User data container IE is an Ethernet frame, then the length of the Ethernet frame payload should not exceed the Ethernet frame payload MTU size.
NOTE: The recommended maximum size for link MTU is 1358 octets to prevent fragmentation in the backbone network (see 3GPP TS 23.060 [74]). Depending on the network configuration, setting link MTU size to a value larger than 1358 octets could lead to inefficient core network implementation due to fragmentation.
<control> <condition> If the UE is in EMM-IDLE mode, </condition> <action> the UE initiates the procedure by sending the ESM DATA TRANSPORT message included in a CONTROL PLANE SERVICE REQUEST message. </action> </control>
<control> <condition> Based on information provided by the upper layers, </condition> <action> the UE may include a Release assistance indication IE in the ESM DATA TRANSPORT message to inform the network that </action> </control>
<control> 1) <condition> subsequent to the current uplink data transmission no further uplink or downlink data transmission (e.g. an acknowledgement or response) is expected; </condition> i.e. the upper layers indicated that data exchanges have completed with the current UL data transfer; </control> or
<control> 2) <condition> <condition> subsequent to the current uplink data transmission only a single downlink data transmission </condition> and <condition> no further uplink data transmission is expected; </condition> </condition> </control> i.e. the upper layers indicated that data exchanges will have completed with the next downlink data transmission.
<control> <condition> When receiving the ESM DATA TRANSPORT message, </condition> <action> the MME shall identify the PDN connection to the SCEF or to the PDN GW, </action> </control> <control> <condition> based on the EPS bearer identity included in message, </condition> and <action> forward the contents of the User data container IE accordingly. </action> </control> <control> <condition> If the ESM DATA TRANSPORT message includes a Release assistance indication IE, </condition> <action> then ESM layer indicates to the EMM layer to initiate release of the NAS signalling connection, </action> </control>
<control> 1) <condition> <condition> if the release assistance indication indicates that no further uplink </condition> and <condition> no further downlink data transmission subsequent to the uplink data transmission is expected; </condition> </condition> </control> or
<control> 2) <condition> <condition> upon subsequent delivery of the next received downlink data transmission to the UE </condition> <condition> if the release assistance indication indicates that only a single downlink data transmission </condition> and <condition> no further uplink data transmission subsequent to the uplink data transmission is expected. </condition> </condition> </control>
6.6.4.3 Network initiated transport of user data via the control plane
The network initiates the procedure by sending the ESM DATA TRANSPORT message (see example in figure 6.6.4.3.1). <control> <condition> Upon receiving the ESM DATA TRANSPORT message, </condition> </control> the UE shall: <control> a) <action> forward the contents of the User data container IE to the upper layers. </action> </control>
6.6.4.4 Abnormal cases in the UE
The following abnormal case can be identified: <control> a) <condition> T3396 is running, </condition> <action> The UE shall not send an ESM DATA TRANSPORT message </action> <condition> unless a) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> </control> or <control> b) <condition> <condition> the ESM DATA TRANSPORT message is used for an exception data reporting </condition> and <condition> the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 or the USIM file EF in 3GPP TS 31.102 ). </condition> </condition> </control>
<control> <action> The ESM DATA TRANSPORT message can be sent, </action> <condition> <condition> if still necessary, </condition> <condition> when timer T3396 expires or is stopped. </condition> </condition> </control>
b) Transmission failure of the ESM DATA TRANSPORT message indication from lower layers
<control> <condition> <condition> If lower layers indicate a TAI change </condition> and <condition> the current TAI is not in the TAI list, </condition> </condition> <action> the transport of user data via the control plane procedure shall be aborted </action> and <action> re-initiated after successfully performing a tracking area updating procedure </action> </control> <control> <condition> <condition> if the control plane CIoT EPS optimisation is still used </condition> and <condition> the user data exists. </condition> </condition> <action> The "signalling active" flag shall be set in the TRACKING AREA UPDATE REQUEST message. </action> </control>
<control> <condition> <condition> If lower layers indicate a TAI change, </condition> <condition> but the current TAI is still part of the TAI list, </condition> or <condition> the TAI has not changed, </condition> </condition> <action> the transport of user data via the control plane procedure shall be re-initiated immediately </action> <condition> if the user data still exists by including the ESM DATA TRANSPORT message in a CONTROL PLANE SERVICE REQUEST message. </condition> </control>
NOTE: How the ESM sublayer handles the retransmission of user data via the control plane is up to the UE implementation.
c) NAS-MAC calculation indication from lower layers
<control> <condition> If lower layers indicate to calculate an NAS-MAC, </condition> <action> the UE shall calculate an NAS_MAC as specified in 3GPP TS 33.401 </action> and <action> then provide the calculated NAS_MAC and 5 least significant bits of the uplink NAS COUNT used to calculate the NAS-MAC to lower layers (see 3GPP TS 36.331 ). </action> <action> The UE shall increase the uplink NAS COUNT by one after the calculation of the NAS_MAC. </action> </control>
6.6.4.5 Abnormal cases on the network side
Apart from the case described in subclause 6.3.4, no other abnormal cases have been identified.
6.7 Reception of an ESM STATUS message by an ESM entity
The purpose of the sending of the ESM STATUS message is to report at any time certain error conditions detected upon receipt of ESM protocol data. The ESM STATUS message can be sent by both the MME and the UE (see example in figure 6.7.1).
<control> <condition> If the ESM entity of the UE receives an ESM STATUS message </condition> <action> the UE shall take different actions depending on the received ESM cause value: #43 (Invalid EPS bearer identity); </action> </control>
<control> <action> The UE shall abort any ongoing ESM procedure related to the received EPS bearer identity, </action> <action> stop any related timer, </action> and <action> deactivate the corresponding EPS bearer context locally (without peer to peer signalling between the UE and the MME). </action> </control>
<control> <action> The UE shall abort any ongoing ESM procedure related to the received PTI value </action> and <action> stop any related timer. </action> </control>
<control> <action> The UE shall abort any ongoing ESM procedure related to the PTI or EPS bearer identity </action> and <action> stop any related timer. </action> </control>
<control> <condition> On receipt of an ESM STATUS message with any other ESM cause value </condition> <action> no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. </action> </control>
<control> <condition> If the ESM entity of the MME receives an ESM STATUS message </condition> <action> the MME shall take different actions depending on the received ESM cause value: #43 (Invalid EPS bearer identity); </action> </control>
<control> <action> The MME shall abort any ongoing ESM procedure related to the received EPS bearer identity, </action> <action> stop any related timer, </action> and <action> deactivate the corresponding EPS bearer context locally (without peer to peer signalling between the MME and the UE). </action> </control>
<control> <action> The MME shall abort any ongoing ESM procedure related to the received PTI value </action> and <action> stop any related timer. </action> </control>
<control> <action> The MME shall abort any ongoing ESM procedure related to the PTI or EPS bearer identity </action> and <action> stop any related timer. </action> </control>
The local actions to be taken by the MME on receipt of an ESM STATUS message with any other ESM cause value are implementation dependent.
7 Handling of unknown, unforeseen, and erroneous protocol data
7.1 General
The procedures specified in the present document apply to those messages which pass the checks described in this subclause.
This subclause also specifies procedures for the handling of unknown, unforeseen, and erroneous protocol data by the receiving entity. These procedures are called "error handling procedures", but in addition to providing recovery mechanisms for error situations they define a compatibility mechanism for future extensions of the protocols.
Subclauses 7.1 to 7.8 shall be applied in order of precedence.
Most error handling procedures are mandatory for the UE.
Detailed error handling procedures in the network are implementation dependent and may vary from PLMN to PLMN. However, when extensions of this protocol are developed, networks will be assumed to have the error handling that is indicated in this subclause as mandatory ("shall") and that is indicated as strongly recommended ("should").
Also, the error handling of the network is only considered as mandatory or strongly recommended when certain thresholds for errors are not reached during a dedicated connection.
For definition of semantical and syntactical errors see 3GPP TS 24.007 , subclause 11.4.2.
7.2 Message too short
<control> <condition> When a message is received that is too short to contain a complete message type information element, </condition> that message shall be ignored </control> , cf. 3GPP TS 24.007 .
7.3 Unknown or unforeseen procedure transaction identity or EPS bearer identity
7.3.1 Procedure transaction identity
The following network procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in an ESM message: a) <control> <condition> <condition> If the network receives a PDN CONNECTIVITY REQUEST message </condition> <condition> with an unassigned or reserved PTI value, </condition> </condition> <action> the network shall respond with a PDN CONNECTIVITY REJECT message including ESM cause #81 "invalid PTI value". </action> </control>
b) <control> <condition> <condition> If the network receives a PDN DISCONNECT REQUEST message </condition> <condition> with an unassigned or reserved PTI value, </condition> </condition> <action> the network shall respond with a PDN DISCONNECT REJECT message including ESM cause #81 "invalid PTI value". </action> </control>
c) <control> <condition> <condition> If the network receives a BEARER RESOURCE ALLOCATION REQUEST message </condition> <condition> with an unassigned or reserved PTI value, </condition> </condition> <action> the network shall respond with a BEARER RESOURCE ALLOCATION REJECT message including ESM cause #81 "invalid PTI value". </action> </control>
d) <control> <condition> <condition> If the network receives a BEARER RESOURCE MODIFICATION REQUEST message </condition> <condition> with an unassigned or reserved PTI value, </condition> </condition> <action> the network shall respond with a BEARER RESOURCE MODIFICATION REJECT message including ESM cause #81 "invalid PTI value". </action> </control>
e) <control> <control> <condition> <condition> If the network receives an ESM INFORMATION RESPONSE message </condition> <condition> which includes an unassigned or reserved PTI value, </condition> </condition> <action> the network shall ignore the message. </action> </control> <control> <condition> If the PTI is an assigned value that does not match the PTI in use for any ongoing transaction related procedure, </condition> <action> the network shall respond with an ESM STATUS message including ESM cause #81 "invalid PTI value". </action> </control> </control>
f) <control> <condition> If the network receives an ESM message other than those listed in items a through e above with a reserved PTI value, </condition> <action> the network shall ignore the message. </action> </control>
The following UE procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in an ESM message: a) <control> <condition> <condition> If the UE receives a PDN CONNECTIVITY REJECT message </condition> <condition> in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, </condition> </condition> <action> the UE shall ignore the message. </action> </control>
b) <control> <condition> <condition> If the UE receives a PDN DISCONNECT REJECT message </condition> <condition> in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, </condition> </condition> <action> the UE shall ignore the message. </action> </control>
c) <control> <condition> <condition> If the UE receives a BEARER RESOURCE ALLOCATION REJECT message </condition> <condition> in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, </condition> </condition> <action> the UE shall ignore the message. </action> </control>
d) <control> <condition> <condition> If the UE receives a BEARER RESOURCE MODIFICATION REJECT message </condition> <condition> in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, </condition> </condition> <action> the UE shall ignore the message. </action> </control>
e) <control> <control> <condition> <condition> If the UE receives an ESM INFORMATION REQUEST message </condition> <condition> in which the PTI value is an unassigned or reserved value, </condition> </condition> <action> the UE shall ignore the message. </action> </control> <control> <condition> <condition> If the PTI is an assigned value </condition> <condition> that does not match a PTI in use for a pending UE requested PDN connectivity procedure for which the ESM information transfer flag was set in the PDN CONNECTIVITY REQUEST message, </condition> </condition> <action> the UE shall respond with an ESM STATUS message including ESM cause #47 "PTI mismatch". </action> </control> </control>
f) <control> <condition> <condition> If the UE receives a NOTIFICATION message </condition> <condition> in which the PTI value is an unassigned value, </condition> </condition> <action> the UE shall proceed as specified in subclause 7.3.2. </action> </control> <control> <condition> If the PTI is a reserved value, </condition> <action> the UE shall respond with an ESM STATUS message including ESM cause #81 "invalid PTI value". </action> </control> <control> <condition> <condition> If the PTI is an assigned value </condition> <condition> that does not match any PTI in use, </condition> </condition> <action> the UE shall respond with an ESM STATUS message including ESM cause #47 "PTI mismatch". </action> </control>
g) <control> <condition> <condition> If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message </condition> <condition> in which the PTI value is an assigned value that does not match any PTI in use, </condition> </condition> <control> <condition> if the UE detects that this request is a network retransmission of an already accepted request (see subclause 6.5.1.3) </condition> <action> the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message. </action> </control> <control> <condition> Otherwise, </condition> <action> the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch". </action> </control> </control>
h) <control> <condition> <condition> If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message </condition> <condition> which contains a reserved or unassigned PTI value, </condition> </condition> <action> the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value". </action> </control>
i) <control> <condition> <condition> If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message </condition> <condition> in which the PTI value is an assigned value that does not match any PTI in use, </condition> </condition> <control> <condition> if the UE detects that this request is a network retransmission of an already accepted request (see subclauses 6.5.3.3 and 6.5.4.3) </condition> <action> the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. </action> </control> <control> <condition> Otherwise, </condition> <action> the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch". </action> </control> </control>
j) <control> <condition> <condition> If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message </condition> <condition> which contains a reserved PTI value, </condition> </condition> <action> the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value". </action> </control>
k) <control> <condition> <condition> If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message </condition> <condition> in which the PTI value is an assigned value that does not match any PTI in use, </condition> </condition> <control> <condition> if the UE detects that this request is a network retransmission of an already accepted request (see subclauses 6.5.3.3 and 6.5.4.3) </condition> <action> the UE shall respond with a MODIFY EPS BEARER CONTEXT ACCEPT message </action> </control> . <control> <condition> Otherwise, </condition> <action> the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch". </action> </control> </control>
l) <control> <condition> <condition> If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message </condition> <condition> which contains a reserved PTI value, </condition> </condition> <action> the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value". </action> </control>
m) <control> <condition> <condition> If the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message </condition> <condition> in which the PTI value is a reserved value or an assigned value that does not match any PTI in use, </condition> </condition> <action> the UE shall ignore the message. </action> </control>
n) <control> <condition> If the UE receives an ESM message other than those listed in items a through m with a reserved PTI value or an assigned value that does not match any PTI in use, </condition> <action> the UE shall ignore the message. </action> </control>
7.3.2 EPS bearer identity
The following network procedures shall apply for handling an unknown, erroneous, or unforeseen EPS bearer identity received in the header of an ESM message (specified as the header of a standard L3 message, see 3GPP TS 24.007 ): a) <control> <condition> <condition> If the network receives a PDN CONNECTIVITY REQUEST message </condition> <condition> which includes an assigned or reserved EPS bearer identity value, </condition> </condition> <action> the network shall respond with a PDN CONNECTIVITY REJECT message including ESM cause #43 "invalid EPS bearer identity". </action> </control>
b) <control> <condition> <condition> If the network receives a PDN DISCONNECT REQUEST message </condition> <condition> which includes an assigned or reserved EPS bearer identity value, </condition> </condition> <action> the network shall respond with a PDN DISCONNECT REJECT message including ESM cause #43 "invalid EPS bearer identity". </action> </control>
c) <control> <condition> <condition> If the network receives a BEARER RESOURCE ALLOCATION REQUEST message </condition> <condition> which includes an assigned or reserved EPS bearer identity value, </condition> </condition> <action> the network shall respond with a BEARER RESOURCE ALLOCATION REJECT message including ESM cause #43 "invalid EPS bearer identity". </action> </control>
d) <control> <condition> <condition> If the network receives a BEARER RESOURCE MODIFICATION REQUEST message </condition> <condition> which includes an assigned or reserved EPS bearer identity value, </condition> </condition> <action> the network shall respond with a BEARER RESOURCE MODIFICATION REJECT message including ESM cause #43 "invalid EPS bearer identity". </action> </control>
e) <control> <condition> <condition> If the network receives an ESM INFORMATION RESPONSE message </condition> <condition> which includes an assigned or reserved EPS bearer identity value, </condition> </condition> <action> the network shall ignore the message. </action> </control>
f) <control> <condition> <condition> If the network receives an ESM DATA TRANSPORT message </condition> <condition> which includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, </condition> </condition> <action> the network shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity". </action> </control>
g) <control> <condition> If the network receives an ESM message other than those listed in items a through e above in which the message includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, </condition> <action> the network shall ignore the message. </action> </control>
The following UE procedures shall apply for handling an unknown, erroneous, or unforeseen EPS bearer identity received in the header of an ESM message: a) <control> <condition> <condition> If the UE receives a PDN CONNECTIVITY REJECT message </condition> <condition> which includes an assigned or reserved EPS bearer identity value, </condition> </condition> <action> the UE shall ignore the message. </action> </control>
b) <control> <condition> <condition> If the UE receives a PDN DISCONNECT REJECT message </condition> <condition> which includes an assigned or reserved EPS bearer identity value, </condition> </condition> <action> the UE shall ignore the message. </action> </control>
c) <control> <condition> <condition> If the UE receives a BEARER RESOURCE ALLOCATION REJECT message </condition> <condition> which includes an assigned or reserved EPS bearer identity value, </condition> </condition> <action> the UE shall ignore the message. </action> </control>
d) <control> <condition> <condition> If the UE receives a BEARER RESOURCE MODIFICATION REJECT message </condition> <condition> which includes an assigned or reserved EPS bearer identity value, </condition> </condition> <action> the UE shall ignore the message. </action> </control>
e) <control> <condition> <condition> If the UE receives an ESM INFORMATION REQUEST message </condition> <condition> which includes an assigned or reserved EPS bearer identity value, </condition> </condition> <action> the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity". </action> </control>
f) <control> <condition> <condition> If the UE receives a NOTIFICATION message </condition> <condition> which includes a reserved EPS bearer identity value, an assigned EPS bearer identity value that does not match an existing EPS bearer context, or the combination of an unassigned PTI value and an unassigned EPS bearer identity value, </condition> </condition> <action> the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity". </action> </control>
g) <control> <condition> <condition> If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message </condition> <condition> which includes an unassigned or reserved EPS bearer identity value, </condition> </condition> <action> the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity". </action> </control>
h) <control> <condition> <condition> If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message </condition> <condition> which includes an unassigned or reserved EPS bearer identity value, </condition> </condition> <action> the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity". </action> </control>
i) <control> <condition> <condition> If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message </condition> <condition> which includes an unassigned or reserved EPS bearer identity value or an assigned EPS bearer identity value that does not match an existing EPS bearer context, </condition> </condition> <action> the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity". </action> </control>
j) <control> <condition> <condition> If the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message </condition> <condition> which includes an unassigned or reserved EPS bearer identity value or an assigned EPS bearer identity value that does not match an existing EPS bearer context, </condition> </condition> <action> the UE shall respond with a DEACTIVATE EPS BEARER CONTEXT ACCEPT message with the EPS bearer identity set to the received EPS bearer identity. </action> </control>
k) <control> <condition> <condition> If the UE receives an ESM DATA TRANSPORT message </condition> <condition> which includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, </condition> </condition> <action> the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity". </action> </control>
l) <control> <condition> If the UE receives an ESM message other than those listed in items a through j in which the message includes an unassigned or reserved EPS bearer identity value or a value that does not match an EPS bearer context of an established PDN connection, </condition> <action> the UE shall ignore the message. </action> </control>
7.4 Unknown or unforeseen message type
<control> <condition> <condition> If UE receives an EMM message or ESM message </condition> <condition> with message type not defined for the protocol discriminator (PD) or not implemented by the receiver, </condition> </condition> <action> it shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #97 "message type non-existent or not implemented". </action> </control>
<control> <condition> <condition> If the network receives an EMM or ESM message </condition> <condition> <condition> <condition> with message type not defined for the PD </condition> or <condition> not implemented by the receiver </condition> </condition> <condition> in a protocol state where reception of an unsolicited message with the given PD from the UE is not foreseen in the protocol, </condition> </condition> </condition> <action> the network actions are implementation dependent. </action> </control> <control> <condition> Otherwise, <condition> if the network receives a message with message type not defined for the PD </condition> or <condition> not implemented by the receiver, </condition> </condition> <action> it shall ignore the message </action> <action> except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #97 "message type non-existent or not implemented". </action> </control>
NOTE: A message type not defined for the PD in the given direction is regarded by the receiver as a message type not defined for the PD, see 3GPP TS 24.007 .
<control> <condition> If the UE receives a message not compatible with the protocol state, </condition> <action> the UE shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #98 "message type not compatible with protocol state". </action> </control>
<control> <condition> If the network receives a message not compatible with the protocol state, </condition> <action> the network actions are implementation dependent. </action> </control>
7.5 Non-semantical mandatory information element errors
7.5.1 Common procedures
<control> <condition> <condition> When on receipt of a message, a) an "imperative message part" error; or b) a "missing mandatory IE" error is diagnosed </condition> or <condition> when a message containing: c) a syntactically incorrect mandatory IE; d) an IE unknown in the message, but encoded as "comprehension required" (see 3GPP TS 24.007 ); or e) an out of sequence IE encoded as "comprehension required" (see 3GPP TS 24.007 ) is received, </condition> </condition> <control> the UE shall proceed as follows: <condition> If the message is not one of the messages listed in subclause 7.5.3, item a, b, c, or d, </condition> <action> the UE shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #96 "invalid mandatory information"; </action> </control> and <control> the network shall proceed as follows: <condition> If the message is not one of the messages listed in subclause 7.5.3, item e, f, g or h, the network shall either: </condition> <action> a) try to treat the message (the exact further actions are implementation dependent); </action> or <action> b) ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #96 "invalid mandatory information". </action> </control> </control>
7.5.2 EPS mobility management
No exceptional cases are described for mobility management messages.
<control> <action> No semantical or syntactical diagnosis other than presence and length shall be performed on the ESM message container information element in the ATTACH REQUEST, ATTACH ACCEPT, ATTACH COMPLETE and CONTROL PLANE SERVICE REQUEST messages. </action> </control>
7.5.3 EPS session management
The following UE procedures shall apply for handling an error encountered with a mandatory information element in an ESM message: a) <control> <condition> If the message is an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, </condition> <action> an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned. </action> </control> b) <control> <condition> If the message is an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST, </condition> <action> an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned. </action> </control> c) <control> <condition> If the message is a MODIFY EPS BEARER CONTEXT REQUEST, </condition> <action> a MODIFY EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned. </action> </control> d) <control> <condition> If the message is a DEACTIVATE EPS BEARER CONTEXT REQUEST, </condition> <action> a DEACTIVATE EPS BEARER CONTEXT ACCEPT message shall be returned. All resources associated with that EPS bearer shall be released. </action> </control>
The following network procedures shall apply for handling an error encountered with a mandatory information element in an ESM message: a) <control> <condition> If the message is a PDN CONNECTIVITY REQUEST, </condition> <action> a PDN CONNECTIVITY REJECT message with ESM cause #96 "invalid mandatory information", shall be returned. </action> </control> b) <control> <condition> If the message is a PDN DISCONNECT REQUEST, </condition> <action> a PDN DISCONNECT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned. </action> </control> c) <control> <condition> If the message is a BEARER RESOURCE ALLOCATION REQUEST, </condition> <action> a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #96 "invalid mandatory information", shall be returned. </action> </control> d) <control> <condition> If the message is a BEARER RESOURCE MODIFICATION REQUEST, </condition> <action> a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #96 "invalid mandatory information", shall be returned. </action> </control>
7.6 Unknown and unforeseen IEs in the non-imperative message part
7.6.1 IEIs unknown in the message
<control> <action> The UE shall ignore all IEs unknown in a message which are not encoded as "comprehension required" (see 3GPP TS 24.007 ). </action> </control>
The network shall take the same approach.
7.6.2 Out of sequence IEs
<control> <action> The UE shall ignore all out of sequence IEs in a message which are not encoded as "comprehension required" (see 3GPP TS 24.007 ). </action> <action> The network should take the same approach. </action> </control>
7.6.3 Repeated IEs
<control> <condition> <condition> If an information element with format T, TV, TLV, or TLV-E is repeated in a message </condition> <condition> in which repetition of the information element is not specified in clause 8 of the present document, </condition> </condition> <action> the UE shall handle only the contents of the information element appearing first </action> and <action> shall ignore all subsequent repetitions of the information element. </action> </control> <control> <condition> When repetition of information elements is specified, </condition> <action> the UE shall handle only the contents of specified repeated information elements. </action> </control> <control> <condition> If the limit on repetition of information elements is exceeded, </condition> <action> the UE shall handle the contents of information elements appearing first up to the limit of repetitions </action> and <action> shall ignore all subsequent repetitions of the information element. </action> </control>
<control> <action> The network should follow the same procedures. </action> </control>
7.7 Non-imperative message part errors
This category includes: a) syntactically incorrect optional IEs; and b) conditional IE errors.
7.7.1 Syntactically incorrect optional IEs
<control> <action> The UE shall treat all optional IEs that are syntactically incorrect in a message as not present in the message. </action> </control>
<control> <action> The network shall take the same approach. </action> </control>
7.7.2 Conditional IE errors
<control> <condition> <condition> <condition> When upon receipt of a EMM or ESM message </condition> <condition> <condition> the UE diagnoses a "missing conditional IE" error </condition> or <condition> an "unexpected conditional IE" error, </condition> </condition> </condition> or <condition> <condition> when it receives a EMM or ESM message </condition> <condition> containing at least one syntactically incorrect conditional IE, </condition> </condition> </condition> <action> the UE shall ignore the message </action> and <action> shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #100 "conditional IE error". </action> </control>
<control> <condition> <condition> <condition> When the network receives a message </condition> and <condition> diagnoses a "missing conditional IE" error or an "unexpected conditional IE" error </condition> or <condition> when it receives a message containing at least one syntactically incorrect conditional IE, </condition> </condition> </condition> the network shall either: <action> a) try to treat the message (the exact further actions are implementation dependent); </action> or <action> b) ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #100 "conditional IE error". </action> </control>
7.8 Messages with semantically incorrect contents
<control> <condition> When a message with semantically incorrect contents is received, </condition> <action> the UE shall perform the foreseen reactions of the procedural part of the present document (i.e. of clauses 4, 5 and 6). </action> <control> <condition> If however no such reactions are specified, </condition> <action> the UE shall ignore the message </action> except that <action> it shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #95 "semantically incorrect message". </action> </control> </control>
<control> <action> The network should follow the same procedure except that a status message is not normally transmitted. </action> </control>
8 Message functional definitions and contents
8.1 Overview
This clause defines the structure of the messages of the Layer 3 (L3) protocols defined in the present document. These are standard L3 messages as defined in 3GPP TS 24.007 .
Each definition given in the present clause includes: a) a brief description of the message direction and use, including whether the message has: 1. Local significance, i.e. relevant only on the originating or terminating access; 2. Access significance, i.e. relevant in the originating and terminating access, but not in the network; 3. Dual significance, i.e. relevant in either the originating or terminating access and in the network; or 4. Global significance, i.e. relevant in the originating and terminating access and in the network.
b) a table listing the Information Elements (IE) known in the message and the order of their appearance in the message. All IEs that may be repeated are explicitly indicated (The V, LV and LV-E formatted IEs, which compose the imperative part of the message, occur before the T, TV, TLV and TLV-E formatted IEs which compose the non-imperative part of the message, see 3GPP TS 24.007 ). In a (maximal) sequence of consecutive IEs with half octet length, the first IE with half octet length occupies bits 1 to 4 of octet N, the second IE bits 5 to 8 of octet N, the third IE bits 1 to 4 of octet N+1 etc. Such a sequence always has an even number of elements.
For each information element the table indicates: 1. The Information Element Identifier (IEI), in hexadecimal notation, if the IE has format T, TV, TLV or TLV-E. If the IEI has half octet length, it is specified by a notation representing the IEI as a hexadecimal digit followed by a "-" (example: B-).
NOTE: The same IEI can be used for different information element types in different messages of the same protocol.
2. The name of the information element (which may give an idea of the semantics of the element). The name of the information element followed by "IE" or "information element" is used in this technical report as reference to the information element within a message.
3. The name of the type of the information element (which indicates the coding of the value part of the IE), and generally, the referenced subclause of clause 9 of the present document describing the value part of the information element.
4. The presence requirement indication (M, C, or O) for the IE as defined in 3GPP TS 24.007 .
6. The length of the information element (or permissible range of lengths), in octets, in the message, where "?" means that the maximum length of the IE is only constrained by link layer protocol. This indication is non- normative.
c) subclauses specifying, where appropriate, conditions for IEs with presence requirement C or O in the relevant message which together with other conditions specified in the present document define when the information elements shall be included or not, what non-presence of such IEs means, and for IEs with presence requirement
C the static conditions for presence or non-presence of the IEs or for both cases (see 3GPP TS 24.007 ).
8.2 EPS mobility management messages
8.2.1 Attach accept
8.2.1.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> to indicate that the corresponding attach request has been accepted. </condition> </control> See table 8.2.1.1.
Message type: ATTACH ACCEPT
Direction: network to UE
8.2.1.2 GUTI
This IE may be included to assign a GUTI to the UE during attach or combined EPS/IMSI attach.
8.2.1.3 Location area identification
This IE may be included to assign a new location area identification to a UE during a combined attach.
8.2.1.4 MS identity
This IE may be included to assign or unassign a new TMSI to a UE during a combined attach.
8.2.1.5 EMM cause
This IE shall be included when IMSI attach for non-EPS services is not successful during a combined EPS/IMSI attach procedure.
8.2.1.6 T3402 value
This IE may be included to indicate a value for timer T3402.
8.2.1.7 T3423 value
This IE may be included to indicate a value for timer T3423.
<control> <condition> If this IE is not included, </condition> <action> the UE shall use the default value. </action> </control>
8.2.1.8 Equivalent PLMNs
This IE may be included in order to assign a new equivalent PLMNs list to a UE.
8.2.1.9 Emergency number list
This IE may be sent by the network. <control> <condition> If this IE is sent, </condition> <action> the contents of this IE indicates a list of emergency numbers valid within the same country as in the PLMN from which this IE is received. </action> </control>
8.2.1.9A Extended emergency number list
This IE may be sent by the network. <control> <condition> If this IE is sent, </condition> <action> the contents of this IE indicates a list of emergency numbers (with URN information) valid within the same country as in the PLMN from which this IE is received or valid only in the PLMN from which this IE is received. </action> </control>
8.2.1.10 EPS network feature support
The network may include this IE to inform the UE of the support of certain features. <control> <condition> If this IE is not included </condition> <action> then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero, </action> <condition> except for the S1-u data transfer (S1-U data) (octet 4, bit 2). </condition> </control>
NOTE: In this exceptional case, the UE deems that the network supports S1-u data transfer.
8.2.1.11 Additional update result
The network may include this IE to provide the UE with additional information about the result of: a) a combined attach procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and "SMS only"; or b) an attach procedure requested for CIoT EPS optimizations if the procedure was successful for EPS services and "SMS only".
8.2.1.12 T3412 extended value
The network may include this IE to provide the UE with longer periodic tracking area update timer.
8.2.1.13 T3324 value
<control> <action> The network shall include the T3324 value IE </action> <condition> if: a) the UE included the T3324 value IE in the ATTACH REQUEST message; and b) the network supports PSM and accepts the use of PSM. </condition> </control>
8.2.1.14 Extended DRX parameters
<control> <action> The network shall include the Extended DRX parameters IE </action> <condition> if: <condition> a) the UE included the Extended DRX parameters IE in the ATTACH REQUEST message; </condition> and <condition> b) the network supports eDRX and accepts the use of eDRX. </condition> </condition> </control>
8.2.1.15 DCN-ID
This IE is included in the message when the network wishes to provide a DCN-ID to the UE.
8.2.1.16 SMS services status
<control> This IE may be included <condition> when a normal attach procedure for EPS services and "SMS only" was successful for EPS services only. </condition> </control>
8.2.1.17 Non-3GPP NW provided policies
<control> <action> This IE is included </action> <condition> if the network needs to indicate whether emergency numbers provided via non-3GPP access can be used to initiate UE detected emergency calls (see 3GPP TS 24.302 ). </condition> </control> <control> <condition> If this IE is not included </condition> <action> then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero. </action> </control>
8.2.1.18 T3448 value
<control> <action> The network may include this IE </action> <condition> <condition> if the congestion control for transport of user data via the control plane is active </condition> and <condition> the UE supports timer T3448. </condition> </condition> </control>
8.2.1.19 Network policy
<control> <action> This IE is included </action> <condition> if the network needs to indicate network policy information to the UE. </condition> </control> <control> <condition> If this IE is not included </condition> <action> then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero. </action> </control>
8.2.1.20 T3447 value
<control> <action> The network may include T3447 value IE </action> <condition> if: <condition> a) the UE has indicated support for service gap control in the ATTACH REQUEST message; </condition> and <condition> b) the EMM context contains a service gap time value. </condition> </condition> </control>
8.2.1.21 Ciphering key data
<control> <action> This IE is included </action> <condition> if the network needs to send ciphering key data to the UE for ciphered broadcast assistance data. </condition> </control>
8.2.1.22 UE radio capability ID
<control> <action> This IE may be included </action> <condition> in WB-S1 mode </condition> <condition> <condition> if both the UE and the network supports RACS </condition> and <condition> the network needs to assign a network-assigned UE radio capability ID to the UE. </condition> </condition> </control>
8.2.1.23 UE radio capability ID deletion indication
<control> <action> This IE may be included </action> <condition> in WB-S1 mode </condition> <condition> <condition> if both the UE and the network supports RACS </condition> and <condition> the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN. </condition> </condition> </control>
8.2.1.24 Negotiated WUS assistance information
<control> <action> The network shall include the Negotiated WUS assistance information IE </action> <condition> if: <condition> a) the UE supports WUS assistance; </condition> <condition> b) the MME supports and accepts the use of WUS assistance; </condition> and <condition> c) the UE is not attaching for emergency bearer services. </condition> </condition> </control>
8.2.1.25 Negotiated DRX parameter in NB-S1 mode
<control> <action> The network shall include the Negotiated DRX parameter in NB-S1 mode IE </action> <condition> if the UE has included the DRX parameter in NB-S1 mode IE in the ATTACH REQUEST message. </condition> </control>
8.2.2 Attach complete
<control> <action> This message is sent by the UE to the network </action> <condition> in response to an ATTACH ACCEPT message. </condition> </control> See table 8.2.2.1.
Message type: ATTACH COMPLETE
Direction: UE to network
8.2.3 Attach reject
8.2.3.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> to indicate that the corresponding attach request has been rejected. </condition> </control> See table 8.2.3.1.
Message type: ATTACH REJECT
Direction: network to UE
8.2.3.2 ESM message container
This IE is included to carry a single ESM message.
8.2.3.3 T3346 value
<control> <action> The MME may include this IE </action> <condition> when the NAS level mobility management congestion control is active. </condition> </control>
8.2.3.4 T3402 value
This IE may be included to indicate a value for timer T3402.
8.2.3.5 Extended EMM cause
This IE may be included by the network to indicate additional information associated with the EMM cause.
8.2.4 Attach request
8.2.4.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> in order to perform an attach procedure. </condition> </control> See table 8.2.4.1.
Message type: ATTACH REQUEST
Direction: UE to network
8.2.4.2 Old P-TMSI signature
<control> <action> The UE shall include this IE </action> <condition> <condition> if the UE holds a valid P-TMSI signature, P-TMSI and RAI, </condition> and <condition> <condition> the TIN either indicates "P-TMSI" </condition> or <condition> is deleted. </condition> </condition> </condition> </control> <control> <condition> <condition> If the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 or 3GPP TS 31.102 </condition> and <condition> is attaching in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs, </condition> </condition> <action> the UE shall not include this IE. </action> </control>
8.2.4.3 Additional GUTI
<control> <action> The UE shall include this IE </action> <condition> <condition> if the TIN indicates "P-TMSI" </condition> and <condition> the UE holds a valid GUTI, P-TMSI and RAI. </condition> </condition> </control> <control> <condition> <condition> If the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 or 3GPP TS 31.102 </condition> and <condition> is attaching in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs, </condition> </condition> <action> the UE shall not include this IE. </action> </control>
8.2.4.4 Last visited registered TAI
<control> <action> This IE shall be included </action> <condition> if the UE holds a valid last visited registered TAI. </condition> </control>
8.2.4.5 DRX parameter
<control> <action> This IE is included </action> <condition> if UE supports A/Gb mode or Iu mode or if the UE wants to indicate its UE specific DRX parameters to the network. </condition> </control>
8.2.4.6 MS network capability
<control> <condition> A UE supporting A/Gb mode or Iu mode </condition> <action> shall include this IE </action> <condition> to indicate its capabilities to the network. </condition> </control>
8.2.4.7 Old location area identification
<control> <action> The UE shall include this IE </action> <condition> during a combined attach procedure </condition> <condition> if it has a valid location area identification. </condition> </control>
8.2.4.8 TMSI status
<control> <action> The UE shall include this IE </action> <condition> during combined attach procedure </condition> <condition> if it has no valid TMSI available. </condition> </control>
8.2.4.9 Mobile station classmark 2
<control> <action> This IE shall be included </action> <condition> <condition> <condition> if the UE supports SRVCC to GERAN or UTRAN </condition> or <condition> supports vSRVCC to UTRAN (see 3GPP TS 23.216 ), </condition> or if the UE is performing a combined attach procedure. </condition> </condition> </control>
8.2.4.10 Mobile station classmark 3
<control> <action> This IE shall be included </action> <condition> if the UE supports SRVCC to GERAN. </condition> </control>
8.2.4.11 Supported Codecs
<control> <action> This IE shall be included </action> <condition> <condition> if the UE supports SRVCC to GERAN or UTRAN </condition> or <condition> <condition> supports vSRVCC to UTRAN </condition> <condition> to indicate its supported speech codecs for CS speech calls. </condition> </condition> </condition> </control>
8.2.4.12 Additional update type
<control> <action> The UE shall include this IE </action> <condition> if the UE requests "SMS only" or CIoT EPS optimizations. </condition> </control>
8.2.4.13 Voice domain preference and UE's usage setting
<control> <action> This IE shall be included </action> <condition> in WB-S1 mode </condition> <condition> if and only <condition> if the UE supports: a) CS fallback and SMS over SGs; </condition> or <condition> b) <condition> if the UE is configured to support IMS voice, </condition> <condition> but does not support 1xCS fallback. </condition> </condition> </condition> </control>
8.2.4.14 Device properties
<control> <action> This IE shall be included </action> <condition> if the UE is configured for NAS signalling low priority. </condition> </control>
8.2.4.15 Old GUTI type
<control> <action> The UE shall include this IE </action> <condition> if the type of identity in the EPS mobile identity IE is set to "GUTI". </condition> </control>
8.2.4.16 MS network feature support
<control> <action> This IE shall be included </action> <condition> if the UE supports extended periodic timer T3412. </condition> </control>
8.2.4.17 TMSI based NRI container
<control> <action> The UE shall include this IE </action> <condition> during a combined attach procedure </condition> <condition> if it has a valid TMSI. </condition> </control>
8.2.4.18 T3324 value
The UE may include this IE to request the use of PSM.
8.2.4.19 T3412 extended value
<control> <action> The UE may include this IE </action> to request a particular T3412 value <condition> if the T3324 value IE is included. </condition> </control>
8.2.4.20 Extended DRX parameters
The UE may include this IE to request the use of eDRX.
8.2.4.21 UE additional security capability
<control> <action> The UE shall include this IE </action> <condition> <condition> if the UE supports dual connectivity with NR </condition> or <condition> if the UE supports N1 mode. </condition> </condition> </control>
8.2.4.22 UE status
<control> <action> This IE shall be included </action> <condition> if the UE wants to provide the network with information concerning aspects of the current UE registration status which is used for interworking with 5GS. </condition> </control>
8.2.4.23 Additional information requested
<control> <action> The UE shall include this IE </action> <condition> <condition> if the UE supports ciphered broadcast assistance data </condition> and <condition> the UE needs to obtain new ciphering keys for ciphered broadcast assistance data. </condition> </condition> </control>
8.2.4.24 N1 UE network capability
<control> <action> The UE shall include this IE </action> <condition> <condition> if the UE supports N1 mode </condition> and <condition> needs to indicate the supported CIoT network behaviour for 5GCN. </condition> </condition> </control>
8.2.4.25 UE radio capability ID availability IE
<control> <action> The UE shall include this IE </action> <condition> in WB-S1 mode </condition> <condition> if the UE supports RACS and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN. </condition> </control>
8.2.4.26 Requested WUS assistance information
<control> <action> The UE may include this IE </action> <condition> <condition> if it supports WUS assistance </condition> and <condition> it is not attaching for emergency bearer services. </condition> </condition> </control>
8.2.4.27 DRX parameter in NB-S1 mode
<control> <action> This IE is included </action> <condition> if the UE intends to use the UE specific DRX parameter </condition> <condition> in NB-S1 mode. </condition> </control>
8.2.5 Authentication failure
8.2.5.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> to indicate that authentication of the network has failed. </condition> </control> See table 8.2.5.1.
Message type: AUTHENTICATION FAILURE
Direction: UE to network
8.2.5.2 Authentication failure parameter
<control> <action> This IE shall be sent </action> <condition> if and only if the EMM cause was #21 "synch failure". </condition> <action> It shall include the response to the authentication challenge from the USIM, which is made up of the AUTS parameter (see 3GPP TS 33.102 ). </action> </control>
8.2.6 Authentication reject
<control> <action> This message is sent by the network to the UE </action> <condition> to indicate that the authentication procedure has failed and that the UE shall abort all activities. </condition> </control> See table 8.2.6.1.
Message type: AUTHENTICATION REJECT
Direction: network to UE
8.2.7 Authentication request
<control> <action> This message is sent by the network to the UE </action> <condition> to initiate authentication of the UE identity. </condition> </control> See table 8.2.7.1.
Message type: AUTHENTICATION REQUEST
Direction: network to UE
8.2.8 Authentication response
<control> <action> This message is sent by the UE to the network </action> <condition> to deliver a calculated authentication response to the network. </condition> </control> See table 8.2.8.1.
Message type: AUTHENTICATION RESPONSE
Direction: UE to network
8.2.9 CS service notification
8.2.9.1 Message definition
<control> <action> This message is sent by the network </action> <condition> <condition> when a paging request with CS call indicator was received via SGs for a UE, </condition> and <condition> a NAS signalling connection is already established for the UE. </condition> </condition> </control> See table 8.2.9.1.
Message type: CS SERVICE NOTIFICATION
Direction: network to UE
8.2.9.2 CLI
<control> <action> The network shall send this IE </action> <condition> if it was received via SGs. </condition> </control> It contains the identification of the calling line for the mobile terminating call in the CS domain, which triggered the paging via SGs.
8.2.9.3 SS Code
<control> <action> The network shall send this IE </action> <condition> if it was received via SGs. </condition> </control> It contains information on the supplementary service transaction in the CS domain, which triggered the paging via SGs.
8.2.9.4 LCS indicator
<control> <action> The network shall send this IE </action> <condition> if it was received via SGs. </condition> </control> It indicates that the paging was triggered by a terminating LCS request in the CS domain.
8.2.9.5 LCS client identity
<control> <action> The network shall send this IE </action> <condition> if it was received via SGs. </condition> </control> It contains information related to the requestor of the terminating LCS request in the CS domain.
8.2.10 Detach accept
8.2.10.1 Detach accept (UE originating detach)
<control> <action> This message is sent by the network </action> <condition> to indicate that the detach procedure has been completed. </condition> </control> See table 8.2.10.1.1.
Message type: DETACH ACCEPT
Direction: network to UE
8.2.10.2 Detach accept (UE terminated detach)
<control> <action> This message is sent by the UE </action> <condition> to indicate that the detach procedure has been completed. </condition> </control> See table 8.2.10.2.1.
Message type: DETACH ACCEPT
Direction: UE to network
8.2.11 Detach request
8.2.11.1 Detach request (UE originating detach)
<control> <action> This message is sent by the UE </action> <condition> to request the release of an EMM context. </condition> </control> See table 8.2.11.1.1.
Message type: DETACH REQUEST
Direction: UE to network
8.2.11.2 Detach request (UE terminated detach)
8.2.11.2.1 Message definition
<control> <action> This message is sent by the network </action> <condition> to request the release of an EMM context. </condition> </control> See table 8.2.11.2.1.
Message type: DETACH REQUEST
Direction: network to UE
8.2.11.2.2 EMM cause
This information element is included if an EMM cause is provided.
8.2.12 Downlink NAS Transport
<control> <action> This message is sent by the network </action> <condition> to the UE in order to carry an SMS message in encapsulated format. </condition> </control> See table 8.2.12.1.
Message type: DOWNLINK NAS TRANSPORT
Direction: network to UE
8.2.13 EMM information
8.2.13.1 Message definition
<control> <action> This message is sent by the network at any time </action> <condition> during EMM context is established </condition> <condition> to send certain information to the UE. </condition> </control> See table 8.2.13.1.
Message type: EMM INFORMATION
Significance: local
Direction: network to UE
8.2.13.2 Full name for network
This IE may be sent by the network. <control> <condition> If this IE is sent, </condition> <action> the contents of this IE indicate the "full length name of the network" that the network wishes the UE to associate with the MCC and MNC contained in the last visited tracking area identification. </action> </control>
8.2.13.3 Short name for network
This IE may be sent by the network. <control> <condition> If this IE is sent, </condition> <action> the contents of this IE indicate the "abbreviated name of the network" that the network wishes the UE to associate with the MCC and MNC contained in the last visited tracking area identification. </action> </control>
8.2.13.4 Local time zone
This IE may be sent by the network. The UE should assume that this time zone applies to the tracking area of the current cell, and also applies to the tracking area list if available in the UE.
NOTE: The time information can be inaccurate, especially when the TAI list includes tracking areas belonging to different time zones.
<control> <condition> If the local time zone has been adjusted for daylight saving time, </condition> <action> the network shall indicate this by including the Network daylight saving time IE. </action> </control>
8.2.13.5 Universal time and local time zone
This IE may be sent by the network. The UE should assume that this time zone applies to the tracking area the UE is currently in, and also applies to the tracking area list if available in the UE. The UE shall not assume that the time information is accurate.
NOTE: The time information can be inaccurate, especially when the TAI list includes tracking areas belonging to different time zones.
<control> <condition> If the local time zone has been adjusted for daylight saving time, </condition> <action> the network shall indicate this by including the Network daylight saving time IE. </action> </control>
8.2.13.6 Network daylight saving time
This IE may be sent by the network. <control> <condition> If this IE is sent, </condition> <action> the contents of this IE indicates the value that has been used to adjust the local time zone. </action> </control>
8.2.14 EMM status
<control> <action> This message is sent by the UE or by the network at any time </action> <condition> to report certain error conditions listed in clause 7. </condition> </control> See table 8.2.14.1.
Message type: EMM STATUS
Significance: local
8.2.15 Extended service request
8.2.15.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> a) <condition> to initiate a CS fallback or 1xCS fallback call or respond to a mobile terminated CS fallback or 1xCS fallback request from the network; </condition> or <condition> b) <condition> to request the establishment of a NAS signalling connection and of the radio and S1 bearers for packet services, </condition> <condition> if the UE needs to provide additional information that cannot be provided via a SERVICE REQUEST message. </condition> </condition> </condition> </control>
See table 8.2.15.1.
Message type: EXTENDED SERVICE REQUEST
Direction: UE to network
8.2.15.2 CSFB response
<control> <action> The UE shall include this IE only </action> <condition> if the Service type information element indicates "mobile terminating CS fallback or 1xCS fallback". </condition> </control>
NOTE: The UE does not include this IE for mobile terminating 1xCS fallback.
8.2.15.3 EPS bearer context status
<control> <action> This IE shall be included </action> <condition> if the UE wants to indicate the EPS bearer contexts that are active within the UE. </condition> </control>
8.2.15.4 Device properties
<control> <action> The UE shall include this IE </action> <condition> if the UE is configured for NAS signalling low priority. </condition> </control>
8.2.16 GUTI reallocation command
8.2.16.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> to reallocate a GUTI and optionally to provide a new TAI list or a new DCN-ID or both. </condition> </control> See table 8.2.16.1.
Message type: GUTI REALLOCATION COMMAND
Direction: network to UE
8.2.16.2 TAI list
<control> <action> This IE may be included </action> <condition> to assign a TAI list to the UE. </condition> </control>
8.2.16.3 DCN-ID
<control> <action> This IE may be included </action> <condition> to assign a new DCN-ID to the UE. </condition> </control>
8.2.16.4 UE radio capability ID
<control> <action> This IE may be included </action> <condition> in WB-S1 mode </condition> <condition> <condition> if both the UE and the network support RACS </condition> and <condition> the network needs to assign a network-assigned UE radio capability ID to the UE. </condition> </condition> </control> <control> <condition> If this IE is included, </condition> <action> the UE radio capability ID deletion indication IE shall not be included. </action> </control>
8.2.16.5 UE radio capability ID deletion indication
<control> <action> This IE may be included </action> <condition> in WB-S1 mode </condition> <condition> <condition> if both the UE and the network support RACS </condition> and <condition> the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN. </condition> </condition> </control> <control> <condition> If this IE is included, </condition> <action> the UE radio capability ID IE shall not be included. </action> </control>
8.2.17 GUTI reallocation complete
<control> <action> This message is sent by the UE to the network </action> <condition> to indicate that reallocation of a GUTI has taken place. </condition> </control> See table 8.2.17.1.
Message type: GUTI REALLOCATION COMPLETE
Direction: UE to network
8.2.18 Identity request
<control> <action> This message is sent by the network to the UE </action> <condition> to request the UE to provide the specified identity. </condition> </control> See table 8.2.18.1.
Message type: IDENTITY REQUEST
Direction: network to UE
8.2.19 Identity response
<control> <action> This message is sent by the UE to the network </action> <condition> <condition> in response to an IDENTITY REQUEST message </condition> and <condition> provides the requested identity. </condition> </condition> </control> See table 8.2.19.1.
Message type: IDENTITY RESPONSE
Direction: UE to network
8.2.20 Security mode command
8.2.20.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> to establish NAS signalling security. </condition> </control> See table 8.2.20.1.
Message type: SECURITY MODE COMMAND
Direction: network to UE
8.2.20.2 IMEISV request
<control> <action> The MME may include this information element </action> <condition> to request the UE to send its IMEISV with the corresponding SECURITY MODE COMPLETE message. </condition> </control>
8.2.20.3 Replayed nonce UE
<control> <action> The MME may include this information element </action> <condition> to indicate to the UE to use the replayed nonce . </condition> </control>
8.2.20.4 Nonce MME
<control> <action> The MME may include this information element </action> <condition> to indicate to the UE to use the nonce . </condition> </control>
8.2.20.5 Hash MME
<control> <action> The MME shall include this information element </action> <condition> when the MME is initiating a SECURITY MODE COMMAND </condition> <condition> <condition> during an attach or tracking area updating procedure </condition> and <condition> <condition> the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message was received </condition> <condition> <condition> without integrity protection </condition> or <condition> did not successfully pass the integrity check at the MME. </condition> </condition> </condition> </condition> </control>
8.2.20.6 Replayed UE additional security capability
<control> <action> The MME shall include this IE </action> <condition> <condition> if the MME supports handling of UE additional security capabilities, </condition> <condition> <condition> the MME is initiating a SECURITY MODE COMMAND </condition> <condition> during an attach or tracking area updating procedure </condition> </condition> and <condition> the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message included a UE additional security capability IE. </condition> </condition> </control>
8.2.20.7 UE radio capability ID request
<control> <action> The MME may include this information element </action> <condition> in WB-S1 mode </condition> <condition> to request the UE to send its UE radio capability ID with the corresponding SECURITY MODE COMPLETE message. </condition> </control>
8.2.21 Security mode complete
8.2.21.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> in response to a SECURITY MODE COMMAND message. </condition> </control> See table 8.2.21.1.
Message type: SECURITY MODE COMPLETE
Direction: UE to network
8.2.21.2 IMEISV
<control> <action> The UE shall include this information element, </action> <condition> if the IMEISV was requested within the corresponding SECURITY MODE COMMAND message. </condition> </control>
8.2.21.3 Replayed NAS message container
<control> <action> The UE shall include this information element, </action> <condition> if <condition> during an ongoing attach or tracking area updating procedure, </condition> <condition> the MME included HASH in the SECURITY MODE COMMAND message </condition> and <condition> HASH has a different value from the hash value locally calculated at the UE as described in 3GPP TS 33.401 . </condition> </condition> </control>
8.2.21.4 UE radio capability ID
<control> <action> The UE shall include this information element </action> <condition> in WB-S1 mode </condition> <condition> if the UE radio capability ID was requested within the corresponding SECURITY MODE COMMAND message. </condition> </control>
8.2.22 Security mode reject
<control> <action> This message is sent by the UE to the network </action> <condition> to indicate that the corresponding security mode command has been rejected. </condition> </control> See table 8.2.22.1.
Message type: SECURITY MODE REJECT
Direction: UE to network
8.2.23 Security protected NAS message
<control> <action> This message is sent by the UE or the network </action> <condition> to transfer a NAS message together with the sequence number and the message authentication code protecting the message. </condition> </control> See table 8.2.23.1.
Message type: SECURITY PROTECTED NAS MESSAGE
8.2.24 Service reject
8.2.24.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> in order to reject the service request procedure. </condition> </control> See table 8.2.24.1.
Message type: SERVICE REJECT
Direction: network to UE
8.2.24.2 T3442 value
<control> <action> The MME shall include this IE </action> <condition> when the EMM cause value is #39 "CS service temporarily not available". </condition> </control>
8.2.24.3 T3346 value
<control> <action> The MME may include this IE </action> <condition> when the general NAS level mobility management congestion control is active. </condition> </control>
8.2.24.4 T3448 value
<control> <action> The network may include this IE </action> <condition> <condition> if the congestion control for transport of user data via the control plane is active </condition> and <condition> the UE supports timer T3448. </condition> </condition> </control>
8.2.25 Service request
<control> <action> This message is sent by the UE to the network </action> <condition> to request the establishment of a NAS signalling connection and of the radio and S1 bearers. </condition> </control> Its structure does not follow the structure of a standard layer 3 message. See table 8.2.25.1.
Message type: SERVICE REQUEST
Direction: UE to network
8.2.26 Tracking area update accept
8.2.26.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> <condition> to provide the UE with EPS mobility management related data </condition> <condition> in response to a tracking area update request message. </condition> </condition> </control> See table 8.2.26.1.
Message type: TRACKING AREA UPDATE ACCEPT
Direction: network to UE
8.2.26.2 T3412 value
<control> <action> The MME shall include this IE </action> <condition> during normal and combined tracking area updating procedure, </condition> </control> and <control> <action> may include this IE </action> <condition> during periodic tracking area updating procedure. </condition> </control>
<control> <action> The MME shall include this IE </action> <condition> if it includes the T3412 extended value IE. </condition> </control>
8.2.26.3 GUTI
<control> <action> This IE may be included </action> <condition> to assign a GUTI to a UE. </condition> </control>
8.2.26.4 TAI list
<control> <action> This IE may be included </action> <condition> to assign a TAI list to a UE. </condition> </control>
8.2.26.5 EPS bearer context status
<control> <action> This IE shall be included </action> <condition> if the network wants to indicate the EPS bearer contexts that are active for the UE in the network. </condition> </control>
8.2.26.6 Location area identification
<control> <action> This IE may be included </action> <condition> to assign a new location area identification to a UE during a combined TA/LA update. </condition> </control>
8.2.26.7 MS identity
<control> <action> This IE may be included </action> <condition> to assign or unassign a new TMSI to a UE during a combined TA/LA update. </condition> </control>
8.2.26.8 EMM cause
<control> <action> This IE shall be included </action> <condition> if the combined tracking area updating procedure was successful for EPS services only. </condition> </control>
8.2.26.9 T3402 value
<control> <action> This IE may be included </action> <condition> to indicate a value for timer T3402. </condition> </control>
8.2.26.10 T3423 value
<control> <action> This IE may be included to </action> <condition> indicate a value for timer T3423. </condition> </control> <control> <action> If this IE is not included, </action> <condition> the UE shall use the default value. </condition> </control>
8.2.26.11 Equivalent PLMNs
<control> <action> This IE may be included </action> <condition> in order to assign a new equivalent PLMNs list to a UE. </condition> </control>
8.2.26.12 Emergency number list
This IE may be sent by the network. <control> <condition> If this IE is sent, </condition> <action> the contents of this IE indicates a list of emergency numbers valid within the same country as in the PLMN from which this IE is received. </action> </control>
8.2.26.12A Extended emergency number list
This IE may be sent by the network. <control> <condition> If this IE is sent, </condition> <action> the contents of this IE indicates a list of emergency numbers (with URN information) valid </action> <condition> Iwithin the same country as in the PLMN from which this IE is received or valid only in the PLMN from which this IE is received. </condition> </control>
8.2.26.13 EPS network feature support
<control> <action> The network may include this IE </action> <condition> to inform the UE of the support of certain features. </condition> </control> <control> <condition> If this IE is not included </condition> <action> then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero, except for the S1-u data transfer (S1-U data) (octet 4, bit 2). </action> </control>
NOTE: <control> <condition> In this exceptional case, </condition> <action> the UE deems that the network supports S1-u data transfer. </action> </control>
8.2.26.14 Additional update result
<control> <action> The network may include this IE </action> <condition> <condition> to provide the UE with additional information </condition> about the result of: <condition> a) a combined tracking area updating procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and "SMS only"; </condition> or <condition> b) a normal tracking area updating procedure requested for CIoT EPS optimizations if the procedure was successful for EPS services and "SMS only". </condition> </condition> </control>
8.2.26.15 T3412 extended value
<control> <action> The network may include this IE </action> <condition> to provide the UE with a longer periodic tracking area update timer. </condition> </control>
8.2.26.16 T3324 value
<control> <action> The network shall include the T3324 value IE </action> <condition> if: a) the UE included the T3324 value IE in the TRACKING AREA UPDATE REQUEST message; and b) the network supports PSM and accepts the use of PSM. </condition> </control>
8.2.26.17 Extended DRX parameters
<control> <action> The network shall include the Extended DRX parameters IE </action> <condition> if: <condition> a) the UE included the Extended DRX parameters IE in the TRACKING AREA UPDATE REQUEST message; </condition> and <condition> b) the network supports eDRX and accepts the use of eDRX. </condition> </condition> </control>
8.2.26.18 DCN-ID
<control> <action> This IE is included in the message </action> <condition> when the network wishes to provide a DCN-ID to the UE. </condition> </control>
8.2.26.19 SMS services status
<control> <action> This IE may be included </action> <condition> <condition> when a normal tracking area updating procedure for EPS services </condition> and <condition> "SMS only" was successful for EPS services only. </condition> </condition> </control>
8.2.26.20 Non-3GPP NW provided policies
<control> <action> This IE is included </action> <condition> if the network needs to indicate whether emergency numbers provided via non-3GPP access can be used to initiate UE detected emergency calls (see 3GPP TS 24.302 ). </condition> </control> <control> <condition> If this IE is not included </condition> <action> then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero. </action> </control>
8.2.26.21 T3448 value
<control> <action> The network may include this IE </action> <condition> <condition> if the congestion control for transport of user data via the control plane is active </condition> and <condition> the UE supports timer T3448. </condition> </condition> </control>
8.2.26.22 Network policy
<control> <action> This IE is included </action> <condition> if the network needs to indicate network policy information to the UE, </condition> </control> <control> <condition> If this IE is not included </condition> <action> then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero. </action> </control>
8.2.26.23 T3447 value
<control> <action> The network may include T3447 value IE </action> <condition> if: <condition> a) the UE has indicated support for service gap control in the TRACKING AREA UPDATE REQUEST messages; </condition> and <condition> b) the EMM context contains a service gap time value. </condition> </condition> </control>
8.2.26.24 Ciphering key data
<control> <action> This IE is included </action> <condition> if the network needs to send ciphering key data to the UE for ciphered broadcast assistance data. </condition> </control>
8.2.26.25 UE radio capability ID
<control> <action> This IE may be included </action> <condition> in WB-S1 mode </condition> <condition> <condition> if both the UE and the network supports RACS </condition> and <condition> the network needs to assign a network-assigned UE radio capability ID to the UE. </condition> </condition> </control>
8.2.26.26 UE radio capability ID deletion indication
<control> <action> This IE may be included </action> <condition> in WB-S1 mode </condition> <condition> <condition> if both the UE and the network supports RACS </condition> and <condition> the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN. </condition> </condition> </control>
8.2.26.27 Negotiated WUS assistance information
<control> <action> The network shall include the Negotiated WUS assistance information IE </action> <condition> if: <condition> a) the UE supports WUS assistance; <condition> </condition> b) the MME supports and accepts the use of WUS assistance; </condition> and <condition> c) the UE is not attaching for emergency bearer services. </condition> </condition> </control>
8.2.26.28 Negotiated DRX parameter in NB-S1 mode
<control> <action> The network shall include the Negotiated DRX parameter </action> <condition> in NB-S1 mode IE </condition> <condition> if the UE has included the DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE REQUEST message. </condition> </control>
8.2.27 Tracking area update complete
<control> <action> This message shall be sent by the UE to the network </action> <condition> in response to a tracking area update accept message </condition> <condition> <condition> if a GUTI has been changed </condition> or <condition> a new TMSI has been assigned. </condition> </condition> </control> See table 8.2.27.1.
Message type: TRACKING AREA UPDATE COMPLETE
Direction: UE to network
8.2.28 Tracking area update reject
8.2.28.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> in order to reject the tracking area updating procedure. </condition> </control> See table 8.2.28.1.
Message type: TRACKING AREA UPDATE REJECT
Direction: network to UE
8.2.28.2 T3346 value
<control> <action> The MME may include this IE </action> <condition> when the general NAS level mobility management congestion control is active. </condition> </control>
8.2.28.3 Extended EMM cause
<control> <action> This IE may be included by the network </action> <condition> to indicate additional information associated with the EMM cause. </condition> </control>
8.2.29 Tracking area update request
8.2.29.1 Message definition
The purposes of sending the tracking area update request by the UE to the network are described in subclause 5.5.3.1.
See table 8.2.29.1.
Message type: TRACKING AREA UPDATE REQUEST
Direction: UE to network
8.2.29.2 Non-current native NAS key set identifier
<control> <action> The UE shall include this IE </action> <condition> <condition> if the UE has a valid non-current native EPS security context </condition> <condition> <condition> <condition> when the UE performs an A/Gb mode or Iu mode or N1 mode to S1 mode inter-system change </condition> <condition> in EMM-CONNECTED mode </condition> </condition> and <condition> <condition> the UE uses a mapped EPS security context </condition> <condition> to protect the TRACKING AREA UPDATE REQUEST message. </condition> </condition> </condition> </condition> </control>
8.2.29.3 GPRS ciphering key sequence number
<control> <action> The UE shall include this IE </action> <condition> <condition> <condition> if the UE performs an A/Gb mode or Iu mode to S1 mode inter-system change </condition> <condition> in EMM- IDLE mode </condition> </condition> and <condition> the TIN indicates "P-TMSI". </condition> </condition> </control>
8.2.29.4 Old P-TMSI signature
<control> <action> The UE shall include this IE </action> <condition> <condition> if the TIN indicates "P-TMSI" </condition> and <condition> the UE holds a valid P-TMSI signature, P-TMSI and RAI. </condition> </condition> </control>
8.2.29.5 Additional GUTI
<control> <action> The UE shall include this IE </action> <condition> <condition> if the TIN indicates "P-TMSI" </condition> and <condition> the UE holds a valid GUTI, P-TMSI and RAI. </condition> </condition> </control>
8.2.29.6 Nonce UE
<control> <action> This IE is included </action> <condition> <condition> <condition> if the UE performs an A/Gb mode or Iu mode to S1 mode inter-system change </condition> <condition> in idle mode </condition> </condition> and <condition> the TIN is set to "P-TMSI". </condition> </condition> </control>
8.2.29.7 UE network capability
<control> <action> The UE shall include this IE, </action> <condition> unless the UE performs a periodic tracking area updating procedure. </condition> </control>
8.2.29.8 Last visited registered TAI
<control> <action> This IE shall be included </action> <condition> if the UE holds a valid last visited registered TAI. </condition> </control>
8.2.29.9 DRX parameter
<control> <action> This IE is included by the UE </action> <condition> to indicate a change of UE specific DRX parameters to the network. </condition> </control>
8.2.29.10 UE radio capability information update needed
<control> <action> The UE shall include this IE </action> <condition> if the UE radio capability information in the network needs to be updated. </condition> </control>
8.2.29.11 EPS bearer context status
<control> <action> This IE shall be included </action> <condition> if the UE wants to indicate the EPS bearer contexts that are active within the UE. </condition> </control>
8.2.29.12 MS network capability
<control> <condition> A UE supporting A/Gb mode or Iu mode shall </condition> <action> include this IE, </action> <condition> unless the UE performs a periodic tracking area updating procedure. </condition> </control>
8.2.29.13 Old location area identification
<control> <action> The UE shall include this IE </action> <condition> during a combined tracking area updating procedure </condition> <condition> if it has a valid location area identification. </condition> </control>
8.2.29.14 TMSI status
<control> <action> The UE shall include this IE </action> <condition> during a combined tracking area updating procedure </condition> <condition> if it has no valid TMSI available. </condition> </control>
8.2.29.15 Mobile station classmark 2
<control> <action> This IE shall be included </action> <condition> <condition> if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN (see 3GPP TS 23.216 ), </condition> or <condition> if the UE is performing a combined tracking area updating procedure. </condition> </condition> </control>
8.2.29.16 Mobile station classmark 3
<control> <action> This IE shall be included </action> <condition> if the UE supports SRVCC to GERAN. </condition> </control>
8.2.29.17 Supported Codecs
<control> <action> This IE shall be included </action> <condition> <condition> if the UE supports SRVCC to GERAN or UTRAN </condition> or <condition> supports vSRVCC to UTRAN to indicate its supported speech codecs for CS speech calls. </condition> </condition> </control>
8.2.29.18 Additional update type
<control> <action> The UE shall include this IE </action> <condition> if the UE requests "SMS only" or CIoT EPS optimizations, </condition> <condition> unless the UE performs a periodic tracking area updating procedure. </condition> </control>
8.2.29.19 Voice domain preference and UE's usage setting
<control> <action> This IE shall be included </action> <condition> in WB-S1 mode </condition> <condition> <condition> if and only if the UE supports: a) CS fallback and SMS over SGs; </condition> or <condition> b) <condition> if the UE is configured to support IMS voice, </condition> <condition> but does not support 1xCS fallback. </condition> </condition> </condition> </control>
8.2.29.20 Old GUTI type
<control> <action> The UE shall include this IE. </action> </control>
8.2.29.21 Device properties
<control> <action> This IE shall be included </action> <condition> if the UE is configured for NAS signalling low priority. </condition> </control>
8.2.29.22 MS network feature support
<control> <action> This IE shall be included </action> <condition> if the UE supports extended periodic timer T3412. </condition> </control>
8.2.29.23 TMSI based NRI container
<control> <action> The UE shall include this IE </action> <condition> if it has a valid TMSI. </condition> </control>
8.2.29.24 T3324 value
<control> <action> The UE may include this IE </action> <condition> to request the use of PSM. </condition> </control>
8.2.29.25 T3412 extended value
<control> <action> The UE may include this IE </action> <condition> to request a particular T3412 value </condition> <condition> if the T3324 value IE is included. </condition> </control>
8.2.29.26 Extended DRX parameters
<control> <action> The UE may include this IE </action> <condition> to request the use of eDRX. </condition> </control>
8.2.29.27 UE additional security capability
<control> <action> The UE shall include this IE </action> <condition> <condition> if the UE supports dual connectivity with NR </condition> or <condition> if the UE supports N1 mode. </condition> </condition> </control>
8.2.29.28 UE status
<control> <action> This IE shall be included </action> <condition> if the UE wants to provide the network with information concerning aspects of the current UE registration status which is used for interworking with 5GS. </condition> </control>
8.2.29.29 Additional information requested
<control> <action> The UE shall include this IE </action> <condition> <condition> if the UE supports ciphered broadcast assistance data </condition> and <condition> the UE needs to obtain new ciphering keys for ciphered broadcast assistance data. </condition> </condition> </control>
8.2.29.30 N1 UE network capability
<control> <action> The UE shall include this IE </action> <condition> <condition> if the UE supports N1 mode </condition> and <condition> <condition> needs to indicate the supported CIoT network behaviour for 5GCN, </condition> <condition> unless the UE performs a periodic tracking area updating procedure. </condition> </condition> </condition> </control>
8.2.29.31 UE radio capability ID availability IE
<control> <action> The UE may include this IE </action> <condition> in WB-S1 mode </condition> <condition> <condition> if the UE supports RACS </condition> and <condition> the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN. </condition> </condition> </control>
8.2.29.32 DRX parameter in NB-S1 mode
<control> <action> This IE is included </action> <condition> <condition> <condition> if the UE intends to use or change the UE specific DRX parameter </condition> <condition> in NB-S1 mode, </condition> </condition> <condition> except when the UE performs a periodic tracking area updating procedure. </condition> </condition> </control>
8.2.29.33 Requested WUS assistance information
<control> <action> The UE may include this IE </action> <condition> <condition> if it supports WUS assistance </condition> and <condition> it is not attaching for emergency bearer services. </condition> </condition> </control>
8.2.30 Uplink NAS Transport
<control> <action> This message is sent by the UE to the network </action> <condition> in order to carry an SMS message in encapsulated format. </condition> </control> See table 8.2.30.1.
Message type: UPLINK NAS TRANSPORT
Direction: UE to network
8.2.31 Downlink generic NAS transport
8.2.31.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> in order to carry an application message in encapsulated format. </condition> </control> See table 8.2.31.1.
Message type: DOWNLINK GENERIC NAS TRANSPORT
Direction: network to UE
8.2.31.2 Additional information
<control> <action> The MME may include this information element </action> <condition> if the application wants to send any additional information. </condition> </control>
8.2.32 Uplink generic NAS transport
8.2.32.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> in order to carry an application protocol message in encapsulated format. </condition> </control>
See table 8.2.32.1.
Message type: UPLINK GENERIC NAS TRANSPORT
Direction: UE to network
8.2.32.2 Additional information
<control> <action> The UE may include this information element </action> <condition> if the application wants to send any additional information. </condition> </control>
8.2.33 CONTROL PLANE SERVICE REQUEST
8.2.33.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> when the UE is using EPS services with control plane CIoT EPS optimization. </condition> </control> See table 8.2.33.1.
Message type: CONTROL PLANE SERVICE REQUEST
Direction: UE to network
8.2.33.2 ESM message container
<control> <action> The UE shall include this IE, </action> <condition> if it wants to send an ESM message to the network. </condition> </control>
8.2.33.3 NAS message container
<control> <action> The UE shall include this IE, </action> <condition> <condition> if it is in EMM-IDLE mode </condition> and <condition> has pending SMS messages to be sent. </condition> </condition> </control>
8.2.33.4 EPS bearer context status
<control> <action> The UE shall include this IE, </action> <condition> if it wants to indicate the EPS bearer contexts that are active within the UE. </condition> </control>
8.2.33.5 Device properties
<control> <action> The UE shall include this IE </action> <condition> if the UE is configured for NAS signalling low priority. </condition> </control>
8.2.34 Service Accept
8.2.34.1 Message definition
<control> <action> This message is sent by the network </action> <condition> in response to the SERVICE REQUEST message, the EXTENDED SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message. </condition> </control> See table 8.2.34.1.
Message type: SERVICE ACCEPT
Direction: network to UE
8.2.34.2 EPS bearer context status
<control> <action> This IE shall be included </action> <condition> if the network wants to indicate the EPS bearer contexts that are active for the UE in the network. </condition> </control>
8.2.34.3 T3448 value
<control> <action> The network may include this IE </action> <condition> <condition> if the congestion control for transport of user data via the control plane is active </condition> and <condition> the UE supports timer T3448. </condition> </condition> </control>
8.3 EPS session management messages
8.3.1 Activate dedicated EPS bearer context accept
8.3.1.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> <condition> to acknowledge activation of a dedicated EPS bearer context associated </condition> <condition> with the same PDN address(es) and APN as an already active EPS bearer context. </condition> </condition> </control> See table 8.3.1.1.
Message type: ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT
Direction: UE to network
8.3.1.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.1.3 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 . </condition> </control>
8.3.1.4 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.2 Activate dedicated EPS bearer context reject
8.3.2.1 Message definition
<control> <action> This message is sent by UE to the network </action> <condition> to reject activation of a dedicated EPS bearer context. </condition> </control> See table 8.3.2.1.
Message type: ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT
Direction: UE to network
8.3.2.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.2.3 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.2.4 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </control>
8.3.3 Activate dedicated EPS bearer context request
8.3.3.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> <condition> to request activation of a dedicated EPS bearer context <condition> </condition> associated with the same PDN address(es) and APN as an already active default EPS bearer context. </condition> </condition> </control> See table 8.3.3.1.
Message type: ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST
Direction: network to UE
8.3.3.2 Transaction identifier
<control> <condition> If the UE supports A/Gb mode or Iu mode or both, </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both </condition> <action> shall include this IE </action> </control>
8.3.3.3 Negotiated QoS
<control> <condition> If the UE supports A/Gb mode or Iu mode or both, </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both </condition> <action> shall include the corresponding R99 QoS parameter values of a PDP context. </action> </control>
8.3.3.4 Negotiated LLC SAPI
<control> <condition> If the UE supports A/Gb mode, </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode </condition> <action> shall include this IE. </action> </control>
8.3.3.5 Radio priority
<control> <condition> If the UE supports A/Gb mode, </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode </condition> <action> shall include this IE. </action> </control>
8.3.3.6 Packet flow identifier
<control> <condition> If the UE supports A/Gb mode and BSS packet flow procedures, </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode </condition> <action> shall include this IE. </action> </control>
8.3.3.7 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.3.8 WLAN offload indication
<control> <action> This IE shall be included in the message </action> <condition> when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18. </condition> </control>
8.3.3.9 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.3.10 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.3.11 Extended EPS QoS
<control> <action> This IE shall be included in the message </action> <condition> <condition> only if the network wishes to transmit the maximum and guaranteed bit rate values to the UE </condition> and <condition> at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3. </condition> </condition> </control>
8.3.4 Activate default EPS bearer context accept
8.3.4.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> to acknowledge activation of a default EPS bearer context. </condition> </control> See table 8.3.4.1.
Message type: ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT
Direction: UE to network
8.3.4.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.4.3 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.5 Activate default EPS bearer context reject
8.3.5.1 Message definition
<control> <action> This message is sent by UE to the network </action> <condition> to reject activation of a default EPS bearer context. </condition> </control> See table 8.3.5.1.
Message type: ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT
Direction: UE to network
8.3.5.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.5.3 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE </condition> and <condition> the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.6 Activate default EPS bearer context request
8.3.6.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> to request activation of a default EPS bearer context. </condition> </control> See table 8.3.6.1.
Message type: ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST
Direction: network to UE
8.3.6.2 Transaction identifier
<control> <condition> If the UE supports A/Gb mode or Iu mode or both, </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both </condition> <action> shall include this IE. </action> </control>
8.3.6.3 Negotiated QoS
<control> <condition> If the UE supports A/Gb mode or Iu mode or both, </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both </condition> <action> shall include the corresponding R99 QoS parameter values of a PDP context. </action> </control>
8.3.6.4 Negotiated LLC SAPI
<control> <condition> If the UE supports A/Gb mode or Iu mode or both, </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode or Iu mode If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode </condition> <action> shall include this IE. </action> </control>
8.3.6.5 Radio priority
<control> <condition> If the UE supports A/Gb mode, </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode </condition> <action> shall include this IE. </action> </control>
8.3.6.6 Packet flow identifier
<control> <condition> If the UE supports A/Gb mode and BSS packet flow procedures, </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode </condition> <action> shall include this IE. </action> </control>
8.3.6.7 APN-AMBR
<control> <action> This IE is included in the message </action> <condition> when the network wishes to transmit the APN-AMBR to the UE for possible uplink policy enforcement. </condition> </control>
8.3.6.8 ESM cause
<control> <action> The network shall include this IE, </action> <condition> if the network allocated a PDN address of a PDN type which is different from the PDN type requested by the UE. </condition> </control>
8.3.6.9 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.6.9 Protocol configuration options
<control> <action> This IE shall be included </action> <condition> <condition> if the network supports Local IP address in the traffic flow aggregate description and TFT filter, </condition> <condition> the PDN Type is different from Non-IP and Ethernet, </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.6.10 Connectivity type
<control> <action> The network shall include the Connectivity type IE </action> <condition> if: <condition> a) the network is configured to indicate when a PDN connection is a LIPA PDN connection; </condition> and <condition> b) the present PDN connection is a LIPA PDN connection. </condition> </condition> </control>
8.3.6.11 WLAN offload indication
<control> <action> This IE shall be included in the message </action> <condition> when the network wishes to indicate </condition> <condition> if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18. </condition> </control>
8.3.6.12 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.6.13 Header compression configuration
<control> <action> The network may include the Header compression configuration IE </action> <condition> if: <condition> a) the network accepts an IP PDN type; </condition> and <condition> b) control plane CIoT EPS optimization is selected. </condition> </condition> </control>
8.3.6.14 Control plane only indication
<control> <action> The network shall include the Control plane only indication IE </action> <condition> if the associated PDN connection is only for control plane CIoT EPS optimization. </condition> </control>
8.3.6.15 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
<control> <action> This IE shall be included </action> <condition> <condition> if the network supports Local IP address in the traffic flow aggregate description and TFT filter, the PDN Type is different from Non-IP and Ethernet, </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.6.16 Serving PLMN rate control
<control> <action> This IE shall be included </action> <condition> when the network wishes to indicate the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval. </condition> </control>
8.3.6.17 Extended APN aggregate maximum bit rate
<control> <action> This IE shall be included in the message </action> <condition> <condition> only if the network wishes to transmit the APN-AMBR values to the UE for possible uplink policy enforcement </condition> and <condition> at least one of the values to be transmitted exceeds the maximum value specified in the APN aggregate maximum bit rate information element in subclause 9.9.4.2. </condition> </condition> </control>
8.3.7 Bearer resource allocation reject
8.3.7.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> to reject the allocation of a dedicated bearer resource. </condition> </control> See table 8.3.7.1.
Message type: BEARER RESOURCE ALLOCATION REJECT
Direction: network to UE
8.3.7.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.7.3 Back-off timer value
<control> <action> The network may include this IE </action> <condition> if the ESM cause is not #65 "maximum number of EPS bearers reached", </condition> <condition> to request a minimum time interval before procedure retry is allowed. </condition> </control>
8.3.7.4 Re-attempt indicator
<control> <action> The network may include this IE </action> <condition> only if it includes the Back-off timer value IE </condition> and <condition> the ESM cause value is not #26 "insufficient resources". </condition> </control>
8.3.7.5 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.7.6 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.8 Bearer resource allocation request
8.3.8.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> to request the allocation of a dedicated bearer resource. </condition> </control> See table 8.3.8.1.
Message type: BEARER RESOURCE ALLOCATION REQUEST
Direction: UE to network
8.3.8.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.8.3 Device properties
<control> <action> The UE shall include this IE </action> <condition> if the UE is configured for NAS signalling low priority. </condition> </control>
8.3.8.4 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.8.5 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.8.6 Extended EPS QoS
<control> <action> This IE shall be included in the message </action> <condition> <condition> only if the UE wishes to transmit the maximum and guaranteed bit rate values to the network </condition> and <condition> at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3. </condition> </condition> </control>
8.3.9 Bearer resource modification reject
8.3.9.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> to reject the modification of a dedicated bearer resource. </condition> </control> See table 8.3.9.1.
Message type: BEARER RESOURCE MODIFICATION REJECT
Direction: network to UE
8.3.9.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.9.3 Back-off timer value
<control> <action> The network may include this IE </action> <condition> to request a minimum time interval before procedure retry is allowed. </condition> </control>
8.3.9.4 Re-attempt indicator
<control> <action> The network may include this IE </action> <condition> <condition> only if it includes the Back-off timer value IE </condition> and <condition> the ESM cause value is not #26 "insufficient resources". </condition> </condition> </control>
8.3.9.5 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.9.6 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.10 Bearer resource modification request
8.3.10.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> <condition> to request the modification of a dedicated bearer resource, </condition> or <condition> to request re-negotiation of header compression configuration associated to an EPS bearer context </condition> </condition> <condition> if the network has previously indicated support of Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization. </condition> </control> See table 8.3.10.1.
Message type: BEARER RESOURCE MODIFICATION REQUEST
Direction: UE to network
8.3.10.2 Required traffic flow QoS
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE requests a change of QoS for the indicated traffic flows </condition> and <condition> does not request to release all bearer resources for the EPS bearer context. </condition> </condition> </control>
8.3.10.3 ESM cause
<control> <action> This IE is included in the message </action> <condition> when the UE requests the release of a dedicated bearer resource. </condition> </control>
8.3.10.4 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.10.5 Device properties
<control> <action> The UE shall include this IE </action> <condition> if the UE is configured for NAS signalling low priority. </condition> </control>
8.3.10.6 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.10.7 Header compression configuration
<control> <action> This IE is included in the message </action> <condition> if: <condition> a) <condition> the UE wishes to re-negotiate header compression configuration associated to an EPS bearer context </condition> and <condition> both the UE and the network supports Control plane CIoT EPS optimization and header compression; </condition> </condition> or <condition> b) <condition> to negotiate header compression configuration associated to an EPS bearer context after an inter-system change from N1 mode to S1 mode </condition> <condition> when both the UE and the network support control plane CIoT EPS optimization and header compression, </condition> and <condition> the UE is operating in single-registration mode </condition> and <condition> has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network. </condition> </condition> </condition> </control>
8.3.10.8 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.10.9 Extended EPS QoS
<control> <action> This IE shall be included in the message </action> <condition> <condition> only if the UE wishes to transmit the maximum and guaranteed bit rate values to the network </condition> and <condition> at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3. </condition> </condition> </control>
8.3.11 Deactivate EPS bearer context accept
8.3.11.1 Message definition
<control> <action> This message is sent by the UE </action> <condition> to acknowledge deactivation of the EPS bearer context requested in the corresponding Deactivate EPS bearer context request message. </condition> </control> See table 8.3.11.1.
Message type: DEACTIVATE EPS BEARER CONTEXT ACCEPT
Direction: UE to network
8.3.11.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.11.3 Void
8.3.11.4 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.12 Deactivate EPS bearer context request
8.3.12.1 Message definition
<control> <action> This message is sent by the network to </action> <condition> request deactivation of an active EPS bearer context. </condition> </control> See table 8.3.12.1.
Message type: DEACTIVATE EPS BEARER CONTEXT REQUEST
Direction: network to UE
8.3.12.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.12.3 T3396 value
<control> <action> The network may include this IE </action> <condition> if the ESM cause is #26 "insufficient resources". </condition> </control>
8.3.12.4 WLAN offload indication
<control> <action> This IE shall be included in the message </action> <condition> <condition> when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18. </condition> </condition> </control> <control> <condition> If the MME wishes to deactivate all EPS bearer contexts of a PDN connection, </condition> <action> MME shall not include this IE. </action> </control>
8.3.12.5 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.12.6 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.12A ESM dummy message
<control> <action> This message is sent by the UE or the network included in an ESM message container information element </action> <condition> during an attach procedure, </condition> <condition> if the UE does not request for PDN connection. </condition> </control> See table 8.3.12A.1.
Message type: ESM DUMMY MESSAGE
8.3.13 ESM information request
<control> <action> This message is sent by the network </action> <condition> to the UE to request the UE to provide ESM information, i.e. protocol configuration options or APN or both. </condition> </control> See table 8.3.13.1.
Message type: ESM INFORMATION REQUEST
Direction: network to UE
8.3.14 ESM information response
8.3.14.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> <condition> in response to an ESM INFORMATION REQUEST message </condition> and <condition> provides the requested ESM information. </condition> </condition> </control> See table 8.3.14.1.
Message type: ESM INFORMATION RESPONSE
Direction: UE to network
8.3.14.2 Access point name
<control> <action> This IE is included in the message </action> <condition> when the UE wishes to request network connectivity as defined by a certain access point name during the attach procedure. </condition> </control>
8.3.14.3 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> when, <condition> during the attach procedure, </condition> <condition> the UE wishes to transmit security protected (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, </condition> <condition> the UE is in WB-S1 mode </condition> and <condition> the PDN Type requested is different from Non-IP and Ethernet. </condition> </condition> </control>
<control> <action> This IE shall be included </action> <condition> <condition> if the UE supports local IP address in traffic flow aggregate description and TFT filter, </condition> <condition> the UE is in WB-S1 mode </condition> and <condition> the PDN Type requested is different from Non-IP and Ethernet. </condition> </condition> </control>
<control> <action> This IE shall not be included </action> <condition> if the Extended protocol configuration options IE is included in the message. </condition> </control>
8.3.14.4 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> when, <condition> during the attach procedure, </condition> <condition> the UE wishes to transmit security protected (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, </condition> and <condition> <condition> the UE is in NB-S1 mode or </condition> <condition> Non-IP or Ethernet PDN Type is requested. </condition> </condition> </condition> </control>
<control> <action> This IE shall be included </action> <condition> if the UE supports local IP address in traffic flow aggregate description and TFT filter, </condition> <condition> the UE is in NB-S1 mode </condition> and <condition> the PDN Type requested is different from Non-IP and Ethernet. </condition> </control>
<control> <action> This IE shall not be included </action> <condition> if the Protocol configuration options IE is included in the message. </condition> </control>
8.3.15 ESM status
<control> <action> This message is sent by the network or the UE </action> <condition> <condition> to pass information on the status of the indicated EPS bearer context </condition> and <condition> report certain error conditions (e.g. as listed in clause 7). </condition> </condition> </control> See table 8.3.15.1.
Message type: ESM STATUS
8.3.16 Modify EPS bearer context accept
8.3.16.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> to acknowledge the modification of an active EPS bearer context. </condition> </control> See table 8.3.16.1.
Message type: MODIFY EPS BEARER CONTEXT ACCEPT
Direction: UE to network
8.3.16.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.16.3 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.16.4 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.17 Modify EPS bearer context reject
8.3.17.1 Message definition
<control> <action> This message is sent by the UE or the network </action> <condition> to reject a modification of an active EPS bearer context. </condition> </control> See table 8.3.17.1.
Message type: MODIFY EPS BEARER CONTEXT REJECT
Direction: UE to network
8.3.17.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.17.3 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.17.4 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.18 Modify EPS bearer context request
8.3.18.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> <condition> <condition> to request modification of an active EPS bearer context, </condition> or <condition> to request re- negotiation of header compression configuration associated to an EPS bearer context </condition> </condition> <condition> if the UE has previously indicated support of Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization. </condition> </condition> </control> See table 8.3.18.1.
Message type: MODIFY EPS BEARER CONTEXT REQUEST
Direction: network to UE
8.3.18.2 New EPS QoS
<control> <condition> When the EPS QoS of the EPS bearer context is modified, </condition> <action> the network shall include the modified EPS QoS assigned to the EPS bearer context. </action> </control>
8.3.18.3 TFT
This IE provides the UE with packet filters.
8.3.18.4 New QoS
<control> <condition> <condition> If the UE supports A/Gb mode or Iu mode or both </condition> and <condition> when the corresponding R99 QoS of the EPS bearer context is modified, </condition> </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both </condition> <action> shall include the corresponding R99 QoS parameter values of a PDP context. </action> </control>
8.3.18.5 Negotiated LLC SAPI
<control> <condition> <condition> If the UE supports A/Gb mode </condition> and <condition> when the negotiated LLC SAPI is modified, </condition> </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode </condition> <action> shall include this IE. </action> </control>
8.3.18.6 Radio priority
<control> <condition> <condition> If the UE supports A/Gb mode </condition> and <condition> when the radio priority is modified, </condition> </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode </condition> <action> shall include this IE. </action> </control>
8.3.18.7 Packet flow identifier
<control> <condition> If the UE supports A/Gb mode and BSS packet flow procedures, </condition> <condition> a network supporting mobility from S1 mode to A/Gb mode </condition> <action> shall include this IE. </action> </control>
8.3.18.8 APN-AMBR
<control> <action> This IE is included </action> <condition> when the APN-AMBR has been changed by the network. </condition> </control>
8.3.18.9 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.18.10 WLAN offload indication
<control> <action> This IE shall be included in the message </action> <condition> when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18. </condition> </control>
8.3.18.11 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.18.12 Header compression configuration
<control> <action> This IE is included in the message </action> <condition> <condition> if the network wishes to re-negotiate header compression configuration associated to an EPS bearer context </condition> and <condition> both the UE and the network support Control plane CIoT EPS optimization and header compression. </condition> </condition> </control>
8.3.18.13 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.18.14 Extended APN-AMBR
<control> <action> This IE shall be included in the message </action> <condition> <condition> only if at least one of the APN-AMBR values has been changed by the network </condition> and <condition> at least one of the values to be transmitted exceeds the maximum value specified in the APN aggregate maximum bit rate information element in subclause 9.9.4.2. </condition> </condition> </control>
8.3.18.15 Extended EPS QoS
<control> <action> This IE shall be included in the message only </action> <condition> <condition> if the network wishes to transmit the maximum and guaranteed bit rate values to the UE </condition> and <condition> at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3. </condition> </condition> </control>
8.3.18A Notification
<control> <action> This message is sent by the network </action> <condition> to inform the UE about events which are relevant for the upper layer using an EPS bearer context or having requested a procedure transaction. </condition> </control> See table 8.3.18A.1.
Message type: NOTIFICATION
Significance: local
Direction: network to UE
8.3.19 PDN connectivity reject
8.3.19.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> to reject establishment of a PDN connection. </condition> </control> See table 8.3.19.1.
Message type: PDN CONNECTIVITY REJECT
Direction: network to UE
8.3.19.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.19.3 Back-off timer value
<control> <action> The network may include this IE </action> <condition> <condition> if the ESM cause is not #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #54 "PDN connection does not exist", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", #61 "PDN type Ethernet only allowed", or #65 "maximum number of EPS bearers reached", </condition> <condition> to request a minimum time interval before procedure retry is allowed. </condition> </condition> </control>
8.3.19.4 Re-attempt indicator
<control> <action> The network may include this IE </action> <condition> <condition> only if the ESM cause value is #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", #61 "PDN type Ethernet only allowed", or #66 "requested APN not supported in current RAT and PLMN combination", </condition> or <condition> <condition> if the network includes the Back-off timer value IE </condition> and <condition> the ESM cause value is not #26 "insufficient resources". </condition> </condition> </condition> </control>
8.3.19.5 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.20 PDN connectivity request
8.3.20.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> to initiate establishment of a PDN connection. </condition> </control> See table 8.3.20.1.
Message type: PDN CONNECTIVITY REQUEST
Direction: UE to network
8.3.20.2 ESM information transfer flag
<control> <action> The UE shall include this IE in the PDN CONNECTIVITY REQUEST message sent </action> <condition> during the attach procedure </condition> <condition> <condition> if the UE has protocol configuration options that need to be transferred security protected </condition> or <condition> wishes to provide an access point name for the PDN connection to be established during the attach procedure. </condition> </condition> </control>
8.3.20.3 Access point name
<control> <action> This IE is included in the message </action> <condition> when the UE wishes to request network connectivity as defined by a certain access point name. </condition> </control> <control> <action> This IE shall not be included </action> <condition> <condition> when the PDN CONNECTIVITY REQUEST message is included in an ATTACH REQUEST message </condition> or <condition> if the request type indicates "emergency" or "handover of emergency bearer services" or "RLOS". </condition> </condition> </control>
8.3.20.4 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, </condition> <condition> the UE is in WB-S1 mode </condition> and <condition> the PDN Type requested is different from Non-IP and Ethernet. </condition> </condition> </control>
<control> <action> This IE shall be included </action> <condition> <condition> if the UE supports local IP address in traffic flow aggregate description and TFT filter, </condition> <condition> the UE is in WB-S1 mode </condition> and <condition> the PDN Type requested is different from Non-IP and Ethernet. </condition> </condition> </control>
<control> <action> This IE shall not be included </action> <condition> if the Extended protocol configuration options IE is included in the message. </condition> </control>
8.3.20.5 Device properties
<control> <action> The UE shall include this IE </action> <condition> if the UE is configured for NAS signalling low priority. </condition> </control>
8.3.20.6 NBIFOM container
<control> <action> This information element is used </action> <condition> to transfer information associated with network-based IP flow mobility, </condition> </control> see 3GPP TS 24.161 .
8.3.20.7 Header compression configuration
<control> <action> The UE shall include the Header compression configuration IE </action> <condition> if: <condition> a) the PDN type value of the PDN type IE is set to IPv4 or IPv6 or IPv4v6; </condition> <condition> b) the UE indicates "Control Plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message; </condition> and <condition> c) the UE supports header compression. </condition> </condition> </control>
8.3.20.8 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, </condition> and <condition> the UE is in NB-S1 mode or Non-IP or Ethernet PDN Type is requested. </condition> </condition> </control>
<control> <action> This IE shall be included </action> <condition> <condition> if the UE supports local IP address in traffic flow aggregate description and TFT filter, </condition> <condition> the UE is in NB-S1 mode </condition> and <condition> the PDN Type requested is different from Non-IP and Ethernet. </condition> </condition> </control>
<control> <action> This IE shall not be included </action> <condition> if the Protocol configuration options IE is included in the message. </condition> </control>
8.3.21 PDN disconnect reject
8.3.21.1 Message definition
<control> <action> This message is sent by the network to the UE </action> <condition> to reject release of a PDN connection. </condition> </control> See table 8.3.21.1.
Message type: PDN DISCONNECT REJECT
Direction: network to UE
8.3.21.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.21.3 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.22 PDN disconnect request
8.3.22.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> to initiate release of a PDN connection. </condition> </control> See table 8.3.22.1.
Message type: PDN DISCONNECT REQUEST
Direction: UE to network
8.3.22.2 Protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.22.3 Extended protocol configuration options
<control> <action> This IE is included in the message </action> <condition> <condition> when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network </condition> and <condition> the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1). </condition> </condition> </control>
8.3.23 Remote UE report
8.3.23.1 Message definition
<control> <action> This message is sent by the UE to the network </action> <condition> to report connection or disconnection of remote UE(s). </condition> </control> See table 8.3.23.1.
Message type: REMOTE UE REPORT
Direction: UE to network
8.3.23.2 Remote UE Context Connected
<control> <action> This IE is included in the message by the UE </action> <condition> acting as ProSe UE-to-network relay </condition> <condition> to provide the network with newly connected remote UE information as specified in 3GPP TS 23.303 . </condition> </control>
8.3.23.3 Remote UE Context Disconnected
<control> <action> This IE is included in the message by the UE </action> <condition> acting as ProSe UE-to-Network Relay </condition> <condition> to provide the network with disconnected remote UE information as specified in 3GPP TS 23.303 . </condition> </control>
8.3.23.4 ProSe Key Management Function Address
<control> <action> This IE is included in the message by the UE </action> <condition> acting as ProSe UE-to-network relay </condition> <condition> <condition> to provide the network with the address of the ProSe Key Management Function associated </condition> <condition> with the remote UEs connected to or disconnected from the ProSe UE-to-network relay. </condition> </condition> </control>
8.3.24 Remote UE report response
8.3.24.1 Message definition
<control> <action> This message is sent by the network </action> <condition> to the UE to acknowledge receipt of a Remote UE report message. </condition> </control> See table 8.3.24.1.
Message type: REMOTE UE REPORT RESPONSE
Direction: network to UE
8.3.25 ESM DATA TRANSPORT
8.3.25.1 Message definition
<control> <action> This message is sent by the UE or the network </action> <condition> in order to carry user data in an encapsulated format. </condition> </control> See table 8.3.25.1.
Message type: ESM DATA TRANSPORT
8.3.25.2 Release assistance indication
<control> <action> The UE may include this IE </action> <condition> to inform the network whether <condition> a) no further uplink and no further downlink data transmission is expected; </condition> or <condition> b) <condition> only a single downlink data transmission (e.g. acknowledgement or response to uplink data) </condition> and <condition> no further uplink data transmission subsequent to the uplink data transmission is expected. </condition> </condition> </condition> </control>
9 General message format and information elements coding
9.1 Overview
<control> Within the protocols defined in the present document, every message, except the SERVICE REQUEST message, is a standard L3 message as defined in 3GPP TS 24.007 .This means that the message consists of the following parts: 1) <condition> if the message is a plain NAS message: </condition> a) protocol discriminator; b) EPS bearer identity or security header type; c) procedure transaction identity; d) message type; e) other information elements, as required. 2) <condition> if the message is a security protected NAS message: </condition> a) protocol discriminator; b) security header type; c) message authentication code; d) sequence number; e) plain NAS message, as defined in item 1. </control>
The organization of a plain NAS message is illustrated in the example shown in figure 9.1.1.
The organization of a security protected NAS message is illustrated in the example shown in figure 9.1.2.
octet 5 octet 6 octet 7
The EPS bearer identity and the procedure transaction identity are only used in messages with protocol discriminator EPS session management. Octet 1a with the procedure transaction identity shall only be included in these messages.
<control> <condition> Unless specified otherwise in the message descriptions of clause 8, </condition> a particular information element shall not be present more than once in a given message. </control>
<control> <condition> When a field extends over more than one octet, </condition> the order of bit values progressively decreases as the octet number increases. The most significant bit of the field is represented by the highest numbered bit of the lowest numbered octet of the field. The least significant bit of the field is represented by the lowest numbered bit of the highest numbered octet of the field. </control>
9.2 Protocol discriminator
The Protocol Discriminator (PD) and its use are defined in 3GPP TS 24.007 . The protocol discriminator in the header (see 3GPP TS 24.007 ) of a security protected NAS message is encoded as "EPS mobility management messages".
9.3 Security header type and EPS bearer identity
9.3.1 Security header type
Bits 5 to 8 of the first octet of every EPS Mobility Management (EMM) message contain the Security header type IE. This IE includes control information related to the security protection of a NAS message. The total size of the Security header type IE is 4 bits.
The Security header type IE can take the values shown in table 9.3.1.
An EMM message received with the security header type encoded as 0000 shall be treated as not security protected, plain NAS message. <control> <condition> A protocol entity sending a not security protected EMM message </condition> <action> shall send the message as plain NAS message </action> and <action> encode the security header type as 0000. </action> </control>
9.3.2 EPS bearer identity
Bits 5 to 8 of the first octet of every EPS Session Management (ESM) message contain the EPS bearer identity. The EPS bearer identity and its use to identify a message flow are defined in 3GPP TS 24.007 .
<control> <condition> If the UE or the MME or both do not support signalling for a maximum number of 15 EPS bearer contexts, </condition> <action> the MME shall select the EPS bearer identity from the value range 5 to 15, </action> or <action> select the value 0 <condition> when it needs to indicate that no EPS bearer identity is assigned. </condition> </action> </control>
NOTE: <control> <condition> When assigning EPS bearer identities from the range 1 to 4, </condition> the MME can take into account that these EPS bearer contexts will be subject to local deactivation if the UE performs inter-system change to A/Gb mode or Iu mode or if it performs a change to an MME not supporting signalling for a maximum number of 15 EPS bearer contexts. </control>
9.4 Procedure transaction identity
Bits 1 to 8 of the second octet (octet 1a) of every EPS Session Management (ESM) message contain the procedure transaction identity. The procedure transaction identity and its use are defined in 3GPP TS 24.007 .
9.5 Message authentication code
The Message authentication code (MAC) information element contains the integrity protection information for the message. <control> <action> The MAC IE shall be included in the security protected NAS message </action> <condition> <condition> if a valid EPS security context exists </condition> and <condition> security functions are started. </condition> </condition> </control> The usage of MAC is specified in subclause 4.4.3.3.
9.6 Sequence number
This IE includes the NAS message sequence number (SN) which consists of the eight least significant bits of the NAS COUNT for a security protected NAS message The usage of SN is specified in subclause 4.4.3.
9.7 NAS message
This IE includes a complete plain NAS message as specified in subclause 8.2 and 8.3. The SECURITY PROTECTED NAS MESSAGE and the SERVICE REQUEST message are not plain NAS messages and shall not be included in this IE.
9.8 Message type
The message type IE and its use are defined in 3GPP TS 24.007 . Tables 9.8.1 and 9.8.2 define the value part of the message type IE used in the EPS mobility management protocol and EPS session management protocol.
9.9 Other information elements
9.9.1 General
4 and 6) are defined in 3GPP TS 24.007 .
The first octet of an information element in the non-imperative part contains the IEI of the information element. <control> <condition> If this octet does not correspond to an IEI known in the message, </condition> <action> the receiver shall determine whether this IE is of type 1 or 2 (i.e. it is an information element of one octet length) or an IE of type 4 (i.e. that the next octet is the length indicator indicating the length of the remaining of the information element) (see 3GPP TS 24.007 ). </action> </control> This allows the receiver to jump over unknown information elements and to analyse any following information elements.
The definitions of information elements which are common for the EMM and ESM protocols or which are used by access stratum protocols are described in subclause 9.9.2.
The information elements of the EMM or ESM protocols can be defined by reference to an appropriate specification, e.g., "see subclause 10.5.6.3 in 3GPP TS 24.008 ".
9.9.2 Common information elements
9.9.2.0 Additional information
The purpose of the Additional information information element is to provide additional information to upper layers in relation to the generic NAS message transport mechanism.
The Additional information information element is coded as shown in figure 9.9.2.0.1 and table 9.9.2.0.1.
The Additional information is a type 4 information element with a minimum length of 3 octets.
9.9.2.0A Device properties
See subclause 10.5.7.8 in 3GPP TS 24.008 .
9.9.2.1 EPS bearer context status
The purpose of the EPS bearer context status information element is to indicate the state of each EPS bearer context that can be identified by an EPS bearer identity.
The EPS bearer context status information element is coded as shown in figure 9.9.2.1.1 and table 9.9.2.1.1.
The EPS bearer context status information element is a type 4 information element with 4 octets length.
octet 1 octet 2 octet 3 octet 4 EBI(x) shall be coded as follows: EBI(0): Bit 1 of octet 3 is spare and shall be coded as zero.
EBI(1) EBI(15): 0 indicates that the ESM state of the corresponding EPS bearer context is BEARER CONTEXT-INACTIVE.
1 indicates that the ESM state of the corresponding EPS bearer context is not BEARER CONTEXT-INACTIVE
9.9.2.2 Location area identification
See subclause 10.5.1.3 in 3GPP TS 24.008 .
9.9.2.3 Mobile identity
See subclause 10.5.1.4 in 3GPP TS 24.008 .
9.9.2.4 Mobile station classmark 2
See subclause 10.5.1.6 in 3GPP TS 24.008 .
9.9.2.5 Mobile station classmark 3
See subclause 10.5.1.7 in 3GPP TS 24.008 .
9.9.2.6 NAS security parameters from E-UTRA
The purpose of the NAS security parameters from E-UTRA information element is to provide the UE with information that enables the UE to create a mapped UMTS security context.
The NAS security parameters from E-UTRA information element is coded as shown in figure 9.9.2.6.1 and table 9.9.2.6.1.
The NAS security parameters from E-UTRA is a type 3 information element with a length of 2 octets.
The value part of the NAS security parameters from E-UTRA information element is included in specific information elements within some RRC messages sent to the UE; see 3GPP TS 36.331 . For these cases the coding of the information element identifier and length information is defined in 3GPP TS 36.331 .
9.9.2.7 NAS security parameters to E-UTRA
The purpose of the NAS security parameters to E-UTRA information element is to provide the UE with parameters that enable the UE to create a mapped EPS security context and take this context into use after inter-system handover to S1 mode.
The NAS security parameters to E-UTRA information element is coded as shown in figure 9.9.2.7.1 and table 9.9.2.7.1.
The NAS security parameters to E-UTRA is a type 3 information element with a length of 7 octets.
The value part of the NAS security parameters to E-UTRA information element is included in specific information elements within some RRC messages sent to the UE; see 3GPP TS 36.331 . For these cases the coding of the information element identifier and length information is defined in 3GPP TS 36.331 .
octet 7
9.9.2.8 PLMN list
See subclause 10.5.1.13 in 3GPP TS 24.008 .
9.9.2.9 Spare half octet
This element is used in the description of EMM and ESM messages when an odd number of half octet type 1 information elements are used. This element is filled with spare bits set to zero and is placed in bits 5 to 8 of the octet unless otherwise specified.
9.9.2.10 Supported codec list
See subclause 10.5.4.32 in 3GPP TS 24.008 .
9.9.3 EPS Mobility Management (EMM) information elements
9.9.3.0A Additional update result
The purpose of the Additional update result information element is to provide additional information about the result of a combined attach procedure or a combined tracking area updating procedure.
The Additional update result information element is coded as shown in figure 9.9.3.0A.1 and table 9.9.3.0A.1.
The Additional update result is a type 1 information element.
Octet 1
9.9.3.0B Additional update type
The purpose of the Additional update type information element is to provide additional information about the type of request for an attach or a tracking area updating procedure.
The Additional update type information element is coded as shown in figure 9.9.3.0B.1 and table 9.9.3.0B.1.
The Additional update type is a type 1 information element.
Additional update type value (AUTV) (octet 1)
0 no additional information. If received it shall be interpreted as request for combined attach or combined tracking area updating.
1 SMS only
0 keeping the NAS signalling connection is not required after the completion of the tracking area updating procedure
1 keeping the NAS signalling connection is required after the completion of the tracking area updating procedure
Preferred CIoT network behaviour (PNB-CIoT) (octet 1)
0 0 no additional information
0 1 control plane CIoT EPS optimization
1 0 user plane CIoT EPS optimization
9.9.3.1 Authentication failure parameter
See subclause 10.5.3.2.2 in 3GPP TS 24.008 .
9.9.3.2 Authentication parameter AUTN
See subclause 10.5.3.1.1 in 3GPP TS 24.008 .
9.9.3.3 Authentication parameter RAND
See subclause 10.5.3.1 in 3GPP TS 24.008 .
9.9.3.4 Authentication response parameter
The purpose of the Authentication response parameter information element is to provide the network with the authentication response calculated in the USIM.
The Authentication response parameter information element is coded as shown in figure 9.9.3.4.1 and table 9.9.3.4.1.
The Authentication response parameter is a type 4 information element with a minimum length of 6 octets and a maximum length of 18 octets.
In an EPS authentication challenge, the response calculated in the USIM (RES) is minimum 4 octets and may be up to
16 octets in length.
In a 5G AKA authentication challenge, the response calculated in the ME (RES*) is 16 octets in length.
octet 18
RES value (octet 3 to 18)
This contains the RES or RES*.
9.9.3.4A Ciphering key sequence number
See subclause 10.5.1.2 in 3GPP TS 24.008 .
9.9.3.4B SMS services status
The purpose of the SMS services status information element is to indicate the status of availability for SMS services requested by the UE during the normal attach procedure or tracking area updating procedure.
The SMS services status information element is coded as shown in figure 9.9.3.4B.1 and table 9.9.3.4B.1.
The SMS services status is a type 1 information element.
SMS services status value (octet 1, bit 1 to 3)
0 0 0 SMS services not available
0 0 1 SMS services not available in this PLMN
<control> <action> All other values are unused and shall be treated as abnormal case, </action> <condition> if received by the UE. </condition> </control>
Bit 4 of octet 1 is spare and shall be coded as zero.
9.9.3.5 CSFB response
The purpose of the CSFB response information element is to indicate whether the UE accepts or rejects a paging for CS fallback.
The CSFB response information element is coded as shown in figure 9.9.3.5.1 and table 9.9.3.5.1.
The CSFB response is a type 1 information element.
9.9.3.6 Daylight saving time
See subclause 10.5.3.12 in 3GPP TS 24.008 .
9.9.3.7 Detach type
The purpose of the Detach type information element is to indicate the type of detach.
The Detach type information element is coded as shown in figure 9.9.3.7.1 and table 9.9.3.7.1.
The Detach type is a type 1 information element.
Type of detach (octet 1)
In the UE to network direction: Bits
All other values are interpreted as "combined EPS/IMSI detach" in this version of the protocol.
In the network to UE direction: Bits
All other values are interpreted as "re-attach not required" in this version of the protocol.
Switch off (octet 1)
In the UE to network direction: Bit
0 normal detach
1 switch off
In the network to UE direction bit 4 is spare. The network shall set this bit to zero.
9.9.3.8 DRX parameter
See subclause 10.5.5.6 in 3GPP TS 24.008 .
9.9.3.9 EMM cause
The purpose of the EMM cause information element is to indicate the reason why an EMM request from the UE is rejected by the network.
The EMM cause information element is coded as shown in figure 9.9.3.9.1 and table 9.9.3.9.1.
The EMM cause is a type 3 information element with 2 octets length.
Cause value (octet 2)
9.9.3.10 EPS attach result
The purpose of the EPS attach result information element is to specify the result of an attach procedure.
The EPS attach result information element is coded as shown in figure 9.9.3.10.1 and table 9.9.3.10.1.
The EPS attach result is a type 1 information element.
EPS attach result value (octet 1)
All other values are reserved.
Bit 4 of octet 1 is spare and shall be coded as zero.
9.9.3.11 EPS attach type
The purpose of the EPS attach type information element is to indicate the type of the requested attach.
The EPS attach type information element is coded as shown in figure 9.9.3.11.1 and table 9.9.3.11.1.
The EPS attach type is a type 1 information element.
9.9.3.12 EPS mobile identity
The purpose of the EPS mobile identity information element is to provide either the IMSI, the GUTI or the IMEI.
The EPS mobile identity information element is coded as shown in figures 9.9.3.12.1 and 9.9.3.12.2 and table 9.9.3.12.1.
The EPS mobile identity is a type 4 information element with a minimum length of 3 octets and a maximum length of 13 octets.
Type of identity (octet 3)
All other values are reserved.
0 even number of identity digits and also when the GUTI is used
1 odd number of identity digits
For the IMSI, this field is coded using BCD coding. <control> <condition> If the number of identity digits is even </condition> <action> then bits 5 to 8 of the last octet shall be filled with an end mark coded as "1111". </action> </control>
For the GUTI, then bits 5 to 8 of octet 3 are coded as "1111", octet 4 through 6 contain the MCC and MNC values as specified below, and bit 8 of octet 7 is the most significant bit and bit 1 of the last octet the least significant bit for the subsequent fields. The required fields for the GUTI are as defined in 3GPP TS 23.003 .
MCC, Mobile country code (octet 4, octet 5 bits 1 to 4)
The MCC field is coded as in ITU-T Recommendation E.212 , annex A.
MNC, Mobile network code (octet 5 bits 5 to 8, octet 6)
The coding of this field is the responsibility of each administration but BCD coding shall be used. The MNC shall consist of 2 or 3 digits. <control> <condition> If a network operator decides to use only two digits in the MNC, </condition> <action> bits 5 to 8 of octet 5 shall be coded as "1111". </action> </control>
The contents of the MCC and MNC digits are coded as octets 6 to 8 of the Temporary Mobile Group Identity IE in figure 10.5.154 of 3GPP TS 24.008 .
For the IMEI, this field is coded using BCD coding. The format of the IMEI is described in 3GPP TS 23.003 .
9.9.3.12A EPS network feature support
The purpose of the EPS network feature support information element is to indicate whether certain features are supported by the network.
The EPS network feature support information element is coded as shown in figure 9.9.3.12A.1 and table 9.9.3.12A.1.
The EPS network feature support is a type 4 information element with a minimum length of 3 octets and a maximum length of 4 octets.
<control> <condition> If the network does not include octet 4 as defined below in the present version of the protocol, </condition> <action> then the UE shall interpret this as a receipt of an information element with all bits of octet 4 coded as zero. </action> </control>
octet 3 octet 4* IMS voice over PS session indicator (IMS VoPS) (octet 3, bit 1)
0 IMS voice over PS session in S1 mode not supported
1 IMS voice over PS session in S1 mode supported
Emergency bearer services indicator (EMC BS) (octet 3, bit 2)
0 emergency bearer services in S1 mode not supported
1 emergency bearer services in S1 mode supported
Location services indicator in EPC (EPC-LCS) (octet 3, bit 3)
0 location services via EPC not supported
1 location services via EPC supported
Location services indicator in CS (CS-LCS) (octet 3, bit 4 to 5)
0 0 no information about support of location services via CS domain is available
0 1 location services via CS domain supported
1 0 location services via CS domain not supported
Support of EXTENDED SERVICE REQUEST for packet services (ESRPS)
0 network does not support use of EXTENDED SERVICE REQUEST to request for packet services
1 network supports use of EXTENDED SERVICE REQUEST to request for packet services
EMM REGISTERED without PDN connectivity (ERw/oPDN)
This bit indicates the capability for EMM-REGISTERED without PDN connection
0 EMM-REGISTERED without PDN connection not supported
1 EMM-REGISTERED without PDN connectionsupported
Control plane CIoT EPS optimization (CP CIoT)
This bit indicates the capability for control plane CIoT EPS optimization
0 Control plane CIoT EPS optimization not supported
1 Control plane CIoT EPS optimization supported
User plane CIoT EPS optimization (UP CIoT)
This bit indicates the capability for user plane CIoT EPS optimization
0 User plane CIoT EPS optimization not supported
1 User plane CIoT EPS optimization supported
This bit indicates the capability for S1-u data transfer. This bit shall be considered only if the Control plane CIoT EPS optimization (CP CIoT) bit (octet 3, bit 8) is set to 1. <control> <condition> If the Control plane CIoT EPS optimization (CP CIoT) bit (octet 3, bit 8) is set to 0, </condition> <action> the UE shall assume S1-u data transfer is supported. </action> </control>
0 S1-u data transfer not supported
1 S1-u data transfer supported
Header compression for control plane CIoT EPS optimization (HC-CP CIoT)
This bit indicates the capability for header compression for control plane CIoT EPS optimization
0 Header compression for control plane CIoT EPS optimization not supported
1 Header compression for control plane CIoT EPS optimization supported
Extended protocol configuration options (ePCO) (octet 4, bit 4)
This bit indicates the support of the extended protocol configuration options IE.
0 Extended protocol configuration options IE not supported
1 Extended protocol configuration options IE supported
Restriction on enhanced coverage (RestrictEC) (octet 4, bit 5)
This bit indicates if the use of enhanced coverage is restricted or not.
0 Use of enhanced coverage is not restricted
1 Use of enhanced coverage is restricted
Restriction on the use of dual connectivity with NR (RestrictDCNR) (octet 4, bit 6)
This bit indicates if the use of dual connectivity with NR is restricted or not.
0 Use of dual connectivity with NR is not restricted
1 Use of dual connectivity with NR is restricted
This bit indicates whether interworking without N26 interface is supported.
0 Interworking without N26 interface not supported
1 Interworking without N26 interface supported
Signalling for a maximum number of 15 EPS bearer contexts (15 bearers) (octet 4, bit
This bit indicates the support of signalling for a maximum number of 15 EPS bearer contexts.
0 Signalling for a maximum number of 15 EPS bearer contexts not supported
1 Signalling for a maximum number of 15 EPS bearer contexts supported
9.9.3.13 EPS update result
The purpose of the EPS update result information element is to specify the result of the associated updating procedure.
The EPS update result information element is coded as shown in figure 9.9.3.13.1 and table 9.9.3.13.1.
The EPS update result is a type 1 information element.
9.9.3.14 EPS update type
The purpose of the EPS update type information element is to specify the area the updating procedure is associated with.
The EPS update type information element is coded as shown in figure 9.9.3.14.1 and table 9.9.3.14.1.
The EPS update type is a type 1 information element.
0 1 0 combined TA/LA updating with IMSI attach
1 0 0 unused; shall be interpreted as "TA updating", if received by the network.
1 0 1 unused; shall be interpreted as "TA updating", if received by the network.
All other values are reserved.
0 No bearer establishment requested
1 Bearer establishment requested
9.9.3.15 ESM message container
The purpose of the ESM message container information element is to enable piggybacked transfer of a single ESM message within an EMM message. The ESM message included in this IE shall be coded as specified in subclause 8.3, i.e. without NAS security header.
The ESM message container information element is coded as shown in figure 9.9.3.15.1 and table 9.9.3.15.1.
The ESM message container is a type 6 information element.
ESM message container contents (octet 4 to octet n); Max value of 65535 octets
This IE can contain any ESM PDU as defined in subclause 8.3.
9.9.3.16 GPRS timer
See subclause 10.5.7.3 in 3GPP TS 24.008 .
9.9.3.16A GPRS timer 2
See subclause 10.5.7.4 in 3GPP TS 24.008 .
9.9.3.16B GPRS timer 3
See subclause 10.5.7.4a in 3GPP TS 24.008 .
9.9.3.17 Identity type 2
See subclause 10.5.5.9 in 3GPP TS 24.008 .
9.9.3.18 IMEISV request
See subclause 10.5.5.10 in 3GPP TS 24.008 .
9.9.3.19 KSI and sequence number
The purpose of the KSI and sequence number information element is to provide the network with the key set identifier (KSI) value of the current EPS security context and the 5 least significant bits of the NAS COUNT value applicable for the message including this information element.
The KSI and sequence number information element is coded as shown in figure 9.9.3.19.1 and table 9.9.3.19.1.
The KSI and sequence number is a type 3 information element with a length of 2 octets.
This field contains the 5 least significant bits of the NAS COUNT value applicable when this message is sent.
This field contains the key set identifier value, as specified in bit 1 to 3 of octet 1 of the NAS key set identifier information element. (see subclause 9.9.3.21.)
9.9.3.20 MS network capability
See subclause 10.5.5.12 in 3GPP TS 24.008 .
9.9.3.20A MS network feature support
See subclause 10.5.1.15 in 3GPP TS 24.008 .
9.9.3.21 NAS key set identifier
The NAS key set identifier is allocated by the network.
The NAS key set identifier information element is coded as shown in figure 9.9.3.21.1 and table 9.9.3.21.1.
The NAS key set identifier is a type 1 information element.
Type of security context flag (TSC) (octet 1)
0 native security context (for KSIASME or KSIAMF)
1 mapped security context (for KSISGSN or KSIAMF)
TSC does not apply for NAS key set identifier value "111".
NAS key set identifier (octet 1)
0 0 0 through possible values for the NAS key set identifier
1 1 1 no key is available (UE to network);
reserved (network to UE)
9.9.3.22 NAS message container
This information element is used to encapsulate the SMS messages transferred between the UE and the network. The NAS message container information element is coded as shown in figure 9.9.3.22.1 and table 9.9.3.22.1.
The NAS message container is a type 4 information element with a minimum length of 4 octets and a maximum length of 253 octets.
NAS message container contents (octet 3 to octet n)
This IE can contain an SMS message (i.e. CP-DATA, CP-ACK or CP-ERROR) as defined in subclause 7.2 in 3GPP TS 24.011 .
9.9.3.23 NAS security algorithms
The purpose of the NAS security algorithms information element is to indicate the algorithms to be used for ciphering and integrity protection.
The NAS security algorithms information element is coded as shown in figure 9.9.3.23.1 and table 9.9.3.23.1.
The NAS security algorithms is a type 3 information element with a length of 2 octets.
Type of integrity protection algorithm (octet 2, bit 1 to 3)
Type of ciphering algorithm (octet 2, bit 5 to 7)
Bit 4 and 8 of octet 2 are spare and shall be coded as zero.
9.9.3.24 Network name
See subclause 10.5.3.5a in 3GPP TS 24.008 .
9.9.3.24A Network resource identifier container
See subclause 10.5.5.31 in 3GPP TS 24.008 .
9.9.3.25 Nonce
The purpose of the Nonce information element is to transfer a 32-bit nonce value to support deriving a new mapped EPS security context.
The Nonce information element is coded as shown in figure 9.9.3.25.1 and table 9.9.3.25.1.
The Nonce is a type 3 information element with a length of 5 octets.
Nonce value (octet 2 to 5)
This field contains the binary representation of the nonce. Bit 8 of octet 2 represents the most significant bit of the nonce and bit 1 of octet 5 the least significant bit.
9.9.3.25A Paging identity
The purpose of the Paging identity information element is to indicate the identity used for paging for non-EPS services.
The Paging identity information element is coded as shown in figure 9.9.3.25A.1 and table 9.9.3.25A.1.
The Paging identity is a type 3 information element with 2 octets length.
Paging identity value (octet 2)
0 IMSI
1 TMSI
See subclause 10.5.5.8 in 3GPP TS 24.008 .
9.9.3.26A Extended EMM cause
The purpose of the extended EMM cause information element is to indicate additional information associated with the EMM cause.
The Extended EMM cause information element is coded as shown in figure 9.9.3.26A.1 and table 9.9.3.26A.1.
The Extended EMM cause is a type 1 information element.
1 E-UTRAN not allowed
EPS optimization info (octet 1, bit 2)
0 No EPS optimization information
1 requested EPS optimization not supported
1 NB-IoT not allowed
Bit 4 of octet 1 is spare and shall be coded as zero.
9.9.3.27 Service type
The purpose of the Service type information element is to specify the purpose of the service request procedure.
The Service type information element is coded as shown in figure 9.9.3.27.1 and table 9.9.3.27.1.
The Service type is a type 1 information element.
9.9.3.28 Short MAC
The purpose of the Short MAC information element is to protect the integrity of a SERVICE REQUEST message.
The integrity protection shall include octet 1 and 2 of the SERVICE REQUEST message. For the used algorithm and other input parameters to the algorithm see subclause 9.5. Only the 2 least significant octets of the resulting message authentication code are included in the information element.
The Short MAC information element is coded as shown in figure 9.9.3.28.1 and table 9.9.3.28.1.
The Short MAC is a type 3 information element with a length of 3 octets.
Short MAC value (octet 2 and 3)
This field contains the 2 least significant octets of the message authentication code calculated for the SERVICE REQUEST message. Bit 1 of octet 3 contains the least significant bit, and bit 8 of octet 2 the most significant bit of these 2 octets.
9.9.3.29 Time zone
See subclause 10.5.3.8 in 3GPP TS 24.008 .
9.9.3.30 Time zone and time
See subclause 10.5.3.9 in 3GPP TS 24.008 .
9.9.3.31 TMSI status
See subclause 10.5.5.4 in 3GPP TS 24.008 .
9.9.3.32 Tracking area identity
The purpose of the Tracking area identity information element is to provide an unambiguous identification of tracking areas within the area covered by the 3GPP system.
The Tracking area identity information element is coded as shown in figure 9.9.3.32.1 and table 9.9.3.32.1.
The Tracking area identity is a type 3 information element with a length of 6 octets.
octet 6 MCC, Mobile country code (octet 2 and 3)
The MCC field is coded as in ITU-T Rec. E212 , annex A.
<control> <condition> If the TAI is deleted </condition> <action> the MCC and MNC shall take the value from the deleted TAI. </action> </control>
<control> <condition> In abnormal cases, </condition> <action> the MCC stored in the UE can contain elements not in the set {0, 1 ... 9}. </action> <action> In such cases the UE should transmit the stored values using full hexadecimal encoding. </action> <control> <condition> When receiving such an MCC, </condition> <action> the network shall treat the TAI as deleted. </action> </control> </control>
MNC, Mobile network code (octet 3 bits 5 to 8, octet 4)
The coding of this field is the responsibility of each administration, but BCD coding shall be used. The MNC shall consist of 2 or 3 digits. For PCS 1900 for NA, Federal regulation mandates that a 3-digit MNC shall be used. <control> <condition> However a network operator may decide to use only two digits in the MNC in the TAI over the radio interface. </condition> <action> In this case, bits 5 to 8 of octet 3 shall be coded as "1111". </action> <action> Mobile equipment shall accept a TAI coded in such a way. </action> <action> In such cases the UE shall transmit the stored values using full hexadecimal encoding. </action> <control> <condition> When receiving such an MNC, </condition> <action> the network shall treat the TAI as deleted. </action> </control> </control>
<control> <action> The same handling shall apply for the network, </action> <condition> if a 3-digit MNC is sent by the UE to a network using only a 2-digit MNC. </condition> </control>
TAC, Tracking area code (octet 5 and 6)
In the TAC field bit 8 of octet 5 is the most significant bit and bit 1 of octet 6 the least significant bit.
The coding of the tracking area code is the responsibility of each administration except that two values are used to mark the TAC, and hence the TAI, as deleted. Coding using full hexadecimal representation may be used. The tracking area code consists of 2 octets.
<control> <condition> If a TAI has to be deleted </condition> <action> then all bits of the tracking area code shall be set to one with the exception of the least significant bit which shall be set to zero. </action> </control> <control> <condition> If a USIM is inserted in a mobile equipment with the tracking area code containing all zeros, </condition> <action> then the mobile equipment shall recognise this TAC as part of a deleted TAI. </action> </control>
9.9.3.33 Tracking area identity list
The purpose of the Tracking area identity list information element is to transfer a list of tracking areas from the network to the UE. The coding of the information element allows combining different types of lists. The lists of type "00" and "01" allow a more compact encoding, when the different TAIs are sharing the PLMN identity.
The Tracking area identity list information element is coded as shown in figure 9.9.3.33.1, figure 9.9.3.33.2, figure 9.9.3.33.3, figure 9.9.3.33.4 and table 9.9.3.33.1.
The Tracking area identity list is a type 4 information element, with a minimum length of 8 octets and a maximum length of 98 octets. The list can contain a maximum of 16 different tracking area identities.
Value part of the Tracking area identity list information element (octet 3 to n)
The value part of the Tracking area identity list information element consists of one or several partial tracking area identity lists. The length of each partial tracking area identity list can be determined from the 'type of list' field and the 'number of elements' field in the first octet of the partial tracking area identity list.
<control> <action> The UE shall store the complete list received. </action> <control> <condition> If more than 16 TAIs are included in this information element, </condition> <action> the UE shall store the first 16 TAIs </action> and <action> ignore the remaining octets of the information element. </action> </control> </control>
Partial tracking area identity list:
Type of list (octet 1)
0 0 list of TACs belonging to one PLMN, with non-consecutive TAC values
0 1 list of TACs belonging to one PLMN, with consecutive TAC values
1 0 list of TAIs belonging to different PLMNs (see NOTE)
All other values are reserved.
Number of elements (octet 1)
All other values are unused and shall be interpreted as 16, if received by the UE.
Bit 8 of octet 1 is spare and shall be coded as zero.
For type of list = "00" and number of elements = k: octet 2 to 4 contain the MCC+MNC, and for j = 1, k: octet 2j+3 and 2j+4 contain the TAC of the j-th TAI belonging to the partial list,
For type of list = "01" and number of elements = k: octet 2 to 4 contain the MCC+MNC, and octet 5 and 6 contain the TAC of the first TAI belonging to the partial list.
The TAC values of the other k-1 TAIs are TAC+1, TAC+2, , TAC+k-1.
For type of list = "10" and number of elements = k: for j = 1, k.
octet 5j-3 to 5j-1 contain the MCC+MNC, and octet 5j and 5j+1 contain the TAC of the j-th TAI belonging to the partial list.
MCC, Mobile country code
The MCC field is coded as in ITU-T Recommendation E.212 , annex A.
MNC, Mobile network code
The coding of this field is the responsibility of each administration but BCD coding shall be used. The MNC shall consist of 2 or 3 digits. <control> <condition> If a network operator decides to use only two digits in the MNC, </condition> <action> MNC digit 3 shall be coded as "1111". </action> </control>
TAC, Tracking area code
9.9.3.34 UE network capability
The purpose of the UE network capability information element is to provide the network with information concerning aspects of the UE related to EPS or interworking with GPRS and 5GS. The contents might affect the manner in which the network handles the operation of the UE. The UE network capability information indicates general UE characteristics and it shall therefore, except for fields explicitly indicated, be independent of the frequency band of the channel it is sent on.
The UE network capability information element is coded as shown in figure 9.9.3.34.1 and table 9.9.3.34.1.
The UE network capability is a type 4 information element with a minimum length of 4 octets and a maximum length of 15 octets
NOTE: The requirements for the support of UMTS security algorithms in the UE are specified in 3GPP TS 33.102 , and the requirements for the support of EPS security algorithms in 3GPP TS 33.401 .
15* EPS encryption algorithms supported (octet 3)
EPS encryption algorithm EEA0 supported (octet 3, bit 8)
0 EPS encryption algorithm EEA0 not supported
1 EPS encryption algorithm EEA0 supported
EPS encryption algorithm 128-EEA1 supported (octet 3, bit 7)
0 EPS encryption algorithm 128-EEA1 not supported
1 EPS encryption algorithm 128-EEA1 supported
EPS encryption algorithm 128-EEA2 supported (octet 3, bit 6)
0 EPS encryption algorithm 128-EEA2 not supported
1 EPS encryption algorithm 128-EEA2 supported
EPS encryption algorithm 128-EEA3 supported (octet 3, bit 5)
0 EPS encryption algorithm 128-EEA3 not supported
1 EPS encryption algorithm 128-EEA3 supported
EPS encryption algorithm EEA4 supported (octet 3, bit 4)
0 EPS encryption algorithm EEA4 not supported
1 EPS encryption algorithm EEA4 supported
EPS encryption algorithm EEA5 supported (octet 3, bit 3)
0 EPS encryption algorithm EEA5 not supported
1 EPS encryption algorithm EEA5 supported
EPS encryption algorithm EEA6 supported (octet 3, bit 2)
0 EPS encryption algorithm EEA6 not supported
1 EPS encryption algorithm EEA6 supported
EPS encryption algorithm EEA7 supported (octet 3, bit 1)
0 EPS encryption algorithm EEA7 not supported
1 EPS encryption algorithm EEA7 supported
EPS integrity algorithms supported (octet 4)
EPS integrity algorithm EIA0 supported (octet 4, bit 8)
0 EPS integrity algorithm EIA0 not supported
1 EPS integrity algorithm EIA0 supported
EPS integrity algorithm 128-EIA1 supported (octet 4, bit 7)
0 EPS integrity algorithm 128-EIA1 not supported
1 EPS integrity algorithm 128-EIA1 supported
EPS integrity algorithm 128-EIA2 supported (octet 4, bit 6)
0 EPS integrity algorithm 128-EIA2 not supported
1 EPS integrity algorithm 128-EIA2 supported
EPS integrity algorithm 128-EIA3 supported (octet 4, bit 5)
0 EPS integrity algorithm 128-EIA3 not supported
1 EPS integrity algorithm 128-EIA3 supported
EPS integrity algorithm EIA4 supported (octet 4, bit 4)
0 EPS integrity algorithm EIA4 not supported
1 EPS integrity algorithm EIA4 supported
EPS integrity algorithm EIA5 supported (octet 4, bit 3)
0 EPS integrity algorithm EIA5 not supported
1 EPS integrity algorithm EIA5 supported
EPS integrity algorithm EIA6 supported (octet 4, bit 2)
0 EPS integrity algorithm EIA6 not supported
1 EPS integrity algorithm EIA6 supported
EPS integrity algorithm EIA7 supported (octet 4, bit 1)
0 EPS integrity algorithm EIA7 not supported
1 EPS integrity algorithm EIA7 supported UMTS encryption algorithms supported (octet 5)
UMTS encryption algorithm UEA0 supported (octet 5, bit 8)
0 UMTS encryption algorithm UEA0 not supported
1 UMTS encryption algorithm UEA0 supported
UMTS encryption algorithm UEA1 supported (octet 5, bit 7)
0 UMTS encryption algorithm UEA1 not supported
1 UMTS encryption algorithm UEA1 supported
UMTS encryption algorithm UEA2 supported (octet 5, bit 6)
0 UMTS encryption algorithm UEA2 not supported
1 UMTS encryption algorithm UEA2 supported
UMTS encryption algorithm UEA3 supported (octet 5, bit 5)
0 UMTS encryption algorithm UEA3 not supported
1 UMTS encryption algorithm UEA3 supported
UMTS encryption algorithm UEA4 supported (octet 5, bit 4)
0 UMTS encryption algorithm UEA4 not supported
1 UMTS encryption algorithm UEA4 supported
UMTS encryption algorithm UEA5 supported (octet 5, bit 3)
0 UMTS encryption algorithm UEA5 not supported
1 UMTS encryption algorithm UEA5 supported
UMTS encryption algorithm UEA6 supported (octet 5, bit 2)
0 UMTS encryption algorithm UEA6 not supported
1 UMTS encryption algorithm UEA6 supported
UMTS encryption algorithm UEA7 supported (octet 5, bit 1)
0 UMTS encryption algorithm UEA7 not supported
1 UMTS encryption algorithm UEA7 supported
This information field indicates the likely treatment of UCS2 encoded character strings by the UE.
0 The UE has a preference for the default alphabet (defined in
1 The UE has no preference between the use of the default alphabet and
the use of UCS2.
UMTS integrity algorithms supported (octet 6)
UMTS integrity algorithm UIA1 supported (octet 6, bit 7)
0 UMTS integrity algorithm UIA1 not supported
1 UMTS integrity algorithm UIA1 supported
UMTS integrity algorithm UIA2 supported (octet 6, bit 6)
0 UMTS integrity algorithm UIA2 not supported
1 UMTS integrity algorithm UIA2 supported
UMTS integrity algorithm UIA3 supported (octet 6, bit 5)
0 UMTS integrity algorithm UIA3 not supported
1 UMTS integrity algorithm UIA3 supported
UMTS integrity algorithm UIA4 supported (octet 6, bit 4)
0 UMTS integrity algorithm UIA4 not supported
1 UMTS integrity algorithm UIA4 supported
UMTS integrity algorithm UIA5 supported (octet 6, bit 3)
0 UMTS integrity algorithm UIA5 not supported
1 UMTS integrity algorithm UIA5 supported
UMTS integrity algorithm UIA6 supported (octet 6, bit 2)
0 UMTS integrity algorithm UIA6 not supported
1 UMTS integrity algorithm UIA6 supported UMTS integrity algorithm UIA7 supported (octet 6, bit 1)
0 UMTS integrity algorithm UIA7 not supported
1 UMTS integrity algorithm UIA7 supported
NF capability (octet 7, bit 1)
0 notification procedure not supported
1 notification procedure supported
0 SRVCC from E-UTRAN to cdma2000 1x CS not supported
1 SRVCC from E-UTRAN to cdma2000 1x CS supported
Location services (LCS) notification mechanisms capability (octet 7, bit 3)
0 LCS notification mechanisms not supported
1 LCS notification mechanisms supported (see 3GPP TS 24.171 )
LTE Positioning Protocol (LPP) capability (octet 7, bit 4)
0 LPP not supported
Access class control for CSFB (ACC-CSFB) capability (octet 7, bit 5)
0 eNodeB-based access class control for CSFB not supported
1 eNodeB-based access class control for CSFB supported
H.245 After SRVCC Handover capability (H.245-ASH) (octet 7, bit 6)
This bit indicates the capability for H.245 with support and use of pre-defined codecs, and if needed, H.245 codec negotiation after SRVCC handover.
0 H.245 after SRVCC handover capability not supported
1 H.245 after SRVCC handover capability supported
This bit indicates the capability for ProSe.
0 ProSe not supported
1 ProSe supported
ProSe direct discovery (ProSe-dd) (octet 7, bit 8)
This bit indicates the capability for ProSe direct discovery.
0 ProSe direct discovery not supported
1 ProSe direct discovery supported
ProSe direct communication (ProSe-dc) (octet 8, bit 1)
This bit indicates the capability for ProSe direct communication.
0 ProSe direct communication not supported
1 ProSe direct communication supported
This bit indicates the capability to act as a ProSe UE-to-network relay
0 Acting as a ProSe UE-to-network relay not supported
1 Acting as a ProSe UE-to-network relay supported
Control plane CIoT EPS optimization (CP CIoT) (octet 8, bit 3)
This bit indicates the capability for control plane CIoT EPS optimization.
0 Control plane CIoT EPS optimization not supported
1 Control plane CIoT EPS optimization supported
User plane CIoT EPS optimization (UP CIoT) (octet 8, bit 4)
This bit indicates the capability for user plane CIoT EPS optimization.
0 User plane CIoT EPS optimization not supported
1 User plane CIoT EPS optimization supported
This bit indicates the capability for S1-u data transfer. <control> <action> This bit shall be considered only </action> <condition> if the Control plane CIoT EPS optimization (CP CIoT) bit (octet 8, bit 3) is set to 1. </condition> </control> <control> <condition> If the Control plane CIoT EPS optimization (CP CIoT) bit (octet 8, bit 3) is set to 0, </condition> <action> the MME shall assume S1-u data transfer is supported by the UE. </action> </control>
0 S1-U data transfer not supported
1 S1-U data transfer supported
This bit indicates the capability for EMM REGISTERED without PDN connectivity.
0 EMM-REGISTERED without PDN connection not supported
1 EMM-REGISTERED without PDN connection supported
Header compression for control plane CIoT EPS optimization (HC-CP CIoT) (octet 8, bit 7)
This bit indicates the capability for header compression for control plane CIoT EPS optimization.
0 Header compression for control plane CIoT EPS optimization not supported
1 Header compression for control plane CIoT EPS optimization supported
Extended protocol configuration options (ePCO) (octet 8, bit 8)
This bit indicates the support of the extended protocol configuration options IE.
0 Extended protocol configuration options IE not supported
1 Extended protocol configuration options IE supported
Multiple DRB support (multipleDRB) (octet 9, bit 1)
This bit indicates the capability to support multiple user plane radio bearers (see 3GPP TS 36.306 , 3GPP TS 36.331 ) in NB-S1 mode.
0 Multiple DRB not supported
1 Multiple DRB supported
This bit indicates the capability for V2X communication over E-UTRA-PC5.
0 V2X communication over E-UTRA-PC5 not supported
1 V2X communication over E-UTRA-PC5 supported
Restriction on use of enhanced coverage support (RestrictEC) (octet 9, bit 3)
This bit indicates the capability to support restriction on use of enhanced coverage.
0 Restriction on use of enhanced coverage not supported
1 Restriction on use of enhanced coverage supported
Control plane data backoff support (CP backoff) (octet 9, bit 4)
This bit indicates the support of back-off timer for transport of user data via the control plane..
0 back-off timer for transport of user data via the control plane not supported
1 back-off timer for transport of user data via the control plane supported
Dual connectivity with NR (DCNR) (octet 9, bit 5)
This bit indicates the capability for dual connecitivity with NR.
0 dual connectivity with NR not supported
1 dual connectivity with NR supported
This bit indicates the capability for N1 mode.
0 N1 mode not supported
1 N1 mode supported
Service gap control (SGC) (octet 9, bit 7)
This bit indicates the capability for service gap control
0 service gap control not supported
1 service gap control supported
Signalling for a maximum number of 15 EPS bearer contexts (15 bearers) (octet 9, bit
This bit indicates the support of signalling for a maximum number of 15 EPS bearer contexts
0 Signalling for a maximum number of 15 EPS bearer contexts not supported
1 Signalling for a maximum number of 15 EPS bearer contexts supported
Radio capability signaling optimisation (RACS) capability (octet 10, bit 1)
This bit indicates the capability for RACS.
0 RACS not supported
1 RACS supported
This bit indicates the support of wake-up signal assistance
0 WUS assistance not supported
1 WUS assistance supported
Control plane Mobile Terminated-Early Data Transmission (CP-MT-EDT) (octet 10, bit
This bit indicates the support of control plane Mobile Terminated-Early Data
Transmission
0 Control plane Mobile Terminated-Early Data Transmission not supported
1 Control plane Mobile Terminated-Early Data Transmission supported
User plane Mobile Terminated-Early Data Transmission (UP-MT-EDT) (octet 10, bit 4)
This bit indicates the support of user plane Mobile Terminated-Early Data Transmission
0 User plane Mobile Terminated-Early Data Transmission not supported
1 User plane Mobile Terminated-Early Data Transmission supported
This bit indicates the capability for V2X communication over NR-PC5.
0 V2X communication over NR-PC5 not supported
1 V2X communication over NR-PC5 supported
<control> All other bits in octet 10 to 15 are spare and shall be coded as zero, <condition> if the respective octet is included in the information element. </condition> </control>
NOTE 1: <control> <condition> For a UE supporting dual connectivity with NR, </condition> <condition> if the UE supports one of the encryption algorithms for E-UTRAN (bits 8 to 5 of octet 3), </condition> it shall support the same algorithm for NR-PDCP as specified in 3GPP TS 33.401 . </control> The NR- PDCP is specified in 3GPP TS 38.323 .
NOTE 2: <control> <condition> For a UE supporting dual connectivity with NR, </condition> <condition> if the UE supports one of the integrity algorithms for E-UTRAN (bits 8 to 5 of octet 4), </condition> it shall support the same algorithm for NR-PDCP as specified in 3GPP TS 33.401 . </control>
9.9.3.35 UE radio capability information update needed
The purpose of the UE radio capability information update needed information element is to indicate whether the MME shall delete the stored UE radio capability information, if any.
The UE radio capability information update needed information element is coded as shown in figure 9.9.3.35.1and table 9.9.3.35.1.
The UE radio capability information update needed is a type 1 information element.
UE radio capability information update needed flag (URC upd) (octet 1)
0 UE radio capability information update not needed
1 UE radio capability information update needed
9.9.3.36 UE security capability
The UE security capability information element is used by the network to indicate which security algorithms are supported by the UE in S1 mode, Iu mode and Gb mode. Security algorithms supported in S1 mode are supported both for NAS and for AS security. <control> <condition> If the UE supports S101 mode, </condition> <action> then these security algorithms are also supported for NAS security in S101 mode. </action> </control>
The UE security capability information element is coded as shown in figure 9.9.3.36.1 and table 9.9.3.36.1.
The UE security capability is a type 4 information element with a minimum length of 4 octets and a maximum length of 7 octets.
Octets 5, 6, and 7 are optional. If octet 5 is included, then also octet 6 shall be included and octet 7 may be included.
<control> <condition> If a UE did not indicate support of any security algorithm for Gb mode, </condition> <action> octet 7 shall not be included. </action> </control> <control> <condition> If the UE did not indicate support of any security algorithm for Iu mode and Gb mode, </condition> <action> octets 5, 6, and 7 shall not be included. </action> </control>
<control> <condition> If the UE did not indicate support of any security algorithm for Iu mode but indicated support of a security algorithm for Gb mode, </condition> <action> octets 5, 6, and 7 shall be included. </action> <action> In this case octets 5 and 6 are filled with the value of zeroes. </action> </control>
octet 7* EPS encryption algorithms supported (octet 3)
EPS encryption algorithm EEA0 supported (octet 3, bit 8)
0 EPS encryption algorithm EEA0 not supported
1 EPS encryption algorithm EEA0 supported
EPS encryption algorithm 128-EEA1 supported (octet 3, bit 7)
0 EPS encryption algorithm 128-EEA1 not supported
1 EPS encryption algorithm 128-EEA1 supported
EPS encryption algorithm 128-EEA2 supported (octet 3, bit 6)
0 EPS encryption algorithm 128-EEA2 not supported
1 EPS encryption algorithm 128-EEA2 supported
EPS encryption algorithm 128-EEA3 supported (octet 3, bit 5)
0 EPS encryption algorithm 128-EEA3 not supported
1 EPS encryption algorithm 128-EEA3 supported
EPS encryption algorithm EEA4 supported (octet 3, bit 4)
0 EPS encryption algorithm EEA4 not supported
1 EPS encryption algorithm EEA4 supported
EPS encryption algorithm EEA5 supported (octet 3, bit 3)
0 EPS encryption algorithm EEA5 not supported
1 EPS encryption algorithm EEA5 supported
EPS encryption algorithm EEA6 supported (octet 3, bit 2)
0 EPS encryption algorithm EEA6 not supported
1 EPS encryption algorithm EEA6 supported
EPS encryption algorithm EEA7 supported (octet 3, bit 1)
0 EPS encryption algorithm EEA7 not supported
1 EPS encryption algorithm EEA7 supported
EPS integrity algorithms supported (octet 4)
EPS integrity algorithm EIA0 supported (octet 4, bit 8)
0 EPS integrity algorithm EIA0 not supported
1 EPS integrity algorithm EIA0 supported
EPS integrity algorithm 128-EIA1 supported (octet 4, bit 7)
0 EPS integrity algorithm 128-EIA1 not supported
1 EPS integrity algorithm 128-EIA1 supported
EPS integrity algorithm 128-EIA2 supported (octet 4, bit 6)
0 EPS integrity algorithm 128-EIA2 not supported
1 EPS integrity algorithm 128-EIA2 supported
EPS integrity algorithm 128-EIA3 supported (octet 4, bit 5)
0 EPS integrity algorithm 128-EIA3 not supported
1 EPS integrity algorithm 128-EIA3 supported
EPS integrity algorithm EIA4 supported (octet 4, bit 4)
0 EPS integrity algorithm EIA4 not supported
1 EPS integrity algorithm EIA4 supported
EPS integrity algorithm EIA5 supported (octet 4, bit 3)
0 EPS integrity algorithm EIA5 not supported
1 EPS integrity algorithm EIA5 supported
EPS integrity algorithm EIA6 supported (octet 4, bit 2)
0 EPS integrity algorithm EIA6 not supported
1 EPS integrity algorithm EIA6 supported
EPS integrity algorithm EIA7 supported (octet 4, bit 1)
0 EPS integrity algorithm EIA7 not supported
1 EPS integrity algorithm EIA7 supported UMTS encryption algorithms supported (octet 5)
UMTS encryption algorithm UEA0 supported (octet 5, bit 8)
0 UMTS encryption algorithm UEA0 not supported
1 UMTS encryption algorithm UEA0 supported
UMTS encryption algorithm UEA1 supported (octet 5, bit 7)
0 UMTS encryption algorithm UEA1 not supported
1 UMTS encryption algorithm UEA1 supported
UMTS encryption algorithm UEA2 supported (octet 5, bit 6)
0 UMTS encryption algorithm UEA2 not supported
1 UMTS encryption algorithm UEA2 supported
UMTS encryption algorithm UEA3 supported (octet 5, bit 5)
0 UMTS encryption algorithm UEA3 not supported
1 UMTS encryption algorithm UEA3 supported
UMTS encryption algorithm UEA4 supported (octet 5, bit 4)
0 UMTS encryption algorithm UEA4 not supported
1 UMTS encryption algorithm UEA4 supported
UMTS encryption algorithm UEA5 supported (octet 5, bit 3)
0 UMTS encryption algorithm UEA5 not supported
1 UMTS encryption algorithm UEA5 supported
UMTS encryption algorithm UEA6 supported (octet 5, bit 2)
0 UMTS encryption algorithm UEA6 not supported
1 UMTS encryption algorithm UEA6 supported
UMTS encryption algorithm UEA7 supported (octet 5, bit 1)
0 UMTS encryption algorithm UEA7 not supported
1 UMTS encryption algorithm UEA7 supported
UMTS integrity algorithms supported (octet 6)
Bit 8 of octet 6 is spare and shall be coded as zero.
UMTS integrity algorithm UIA1 supported (octet 6, bit 7)
0 UMTS integrity algorithm UIA1 not supported
1 UMTS integrity algorithm UIA1 supported
UMTS integrity algorithm UIA2 supported (octet 6, bit 6)
0 UMTS integrity algorithm UIA2 not supported
1 UMTS integrity algorithm UIA2 supported
UMTS integrity algorithm UIA3 supported (octet 6, bit 5)
0 UMTS integrity algorithm UIA3 not supported
1 UMTS integrity algorithm UIA3 supported
UMTS integrity algorithm UIA4 supported (octet 6, bit 4)
0 UMTS integrity algorithm UIA4 not supported
1 UMTS integrity algorithm UIA4 supported
UMTS integrity algorithm UIA5 supported (octet 6, bit 3)
0 UMTS integrity algorithm UIA5 not supported
1 UMTS integrity algorithm UIA5 supported
UMTS integrity algorithm UIA6 supported (octet 6, bit 2)
0 UMTS integrity algorithm UIA6 not supported
1 UMTS integrity algorithm UIA6 supported
UMTS integrity algorithm UIA7 supported (octet 6, bit 1)
0 UMTS integrity algorithm UIA7 not supported
1 UMTS integrity algorithm UIA7 supported
GPRS encryption algorithms supported (octet 7)
Bit 8 of octet 7 is spare and shall be coded as zero.
GPRS encryption algorithm GEA1 supported (octet 7, bit 7)
0 GPRS encryption algorithm GEA1 not supported
1 GPRS encryption algorithm GEA1 supported
GPRS encryption algorithm GEA2 supported (octet 7, bit 6)
0 GPRS encryption algorithm GEA2 not supported
1 GPRS encryption algorithm GEA2 supported
GPRS encryption algorithm GEA3 supported (octet 7, bit 5)
0 GPRS encryption algorithm GEA3 not supported
1 GPRS encryption algorithm GEA3 supported
GPRS encryption algorithm GEA4 supported (octet 7, bit 4)
0 GPRS encryption algorithm GEA4 not supported
1 GPRS encryption algorithm GEA4 supported
GPRS encryption algorithm GEA5 supported (octet 7, bit 3)
0 GPRS encryption algorithm GEA5 not supported
1 GPRS encryption algorithm GEA5 supported
GPRS encryption algorithm GEA6 supported (octet 7, bit 2)
0 GPRS encryption algorithm GEA6 not supported
1 GPRS encryption algorithm GEA6 supported
GPRS encryption algorithm GEA7 supported (octet 7, bit 1)
0 GPRS encryption algorithm GEA7 not supported
1 GPRS encryption algorithm GEA7 supported
NOTE 1: <control> <condition> For a UE supporting dual connectivity with NR, </condition> <condition> if the UE supports one of the encryption algorithms for E-UTRAN (bits 8 to 5 of octet 3), </condition> it shall support the same algorithm for NR-PDCP as specified in 3GPP TS 33.401 . </control>
NOTE 2: <control> <condition> For a UE supporting dual connectivity with NR, </condition> <condition> if the UE supports one of the integrity algorithms for E-UTRAN different from EIA0 (bits 7 to 5 of octet 4), </condition> it shall support the same algorithm for NR-PDCP as specified in 3GPP TS 33.401 . </control>
9.9.3.37 Emergency Number List
See subclause 10.5.3.13 in 3GPP TS 24.008 .
9.9.3.37A Extended emergency number list
The purpose of this information element is to encode one or more local emergency number(s) together with a sub- services field containing zero or more sub-services of the associated emergency service URN and a validity indication.
An emergency service URN is a service URN with top level service type of "sos" as specified in IETF RFC 5031 .
EXAMPLE 1: <control> <condition> If the associated emergency service URN is "urn:service:sos.gas", </condition> there is only one sub-service provided in the sub-services field which is "gas". </control>
EXAMPLE 2: <control> <condition> If the associated emergency service URN is "urn:service:sos", </condition> there is no sub-services provided in the sub-services field and the length of the sub-services field is "0". </control>
NOTE: The associated emergency service URN can be a country-specific emergency service URN as defined in 3GPP TS 24.229 .
The Extended emergency number list information element is coded as shown in figure 9.9.3.37A.1 and table 9.9.3.37A.1.
T he Extended emergency number list IE is a type 6 information element with a minimum length of 7 octets and a maximum length of 65538 octets.
NOTE 1: The length shall contain the number of octets used to encode the number digits.
NOTE 2: The number digit(s) in octet 6 precedes the digit(s) in octet 7 etc. The number digit, which would be entered first, is located in octet 6, bits 1 to 4. The contents of the number digits are coded as shown in table 10.5.118/3GPP TS 24.008 .
NOTE 3: <control> <condition> If the emergency number contains an odd number of digits, </condition> <action> bits 5 to 8 of the last octet of the respective emergency number shall be filled with an end mark coded as "1111". </action> </control>
NOTE 4: The length shall contain the number of octets used to encode the sub-services field.
NOTE 5: The characters of the sub-services of the associated emergency service URN shall be coded in accordance to GSM 7 bit default alphabet (see 3GPP TS 23.038 ) and the first character starts in octet j+1, l+1 or n+1.
EXAMPLE 3: <control> <condition> If the associated emergency service URN is "urn:service:sos.police.municipal", </condition> the sub-services field contains "police.municipal" and the first character is "p". </control>
Extended Emergency Number List Validity (EENLV) (octet 4)
0 Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received
1 Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received
9.9.3.38 CLI
The purpose of the CLI information element is to convey information about the calling line for a terminated call to a CS fallback capable UE.
The CLI information element is coded as shown in figure 9.9.3.38.1 and table 9.9.3.38.1.
The CLI is a type 4 information element with a minimum length of 3 octets and a maximum length of 14 octets.
9.9.3.39 SS Code
The purpose of the SS code information element is to convey information related to a network initiated supplementary service request to a CS fallback capable UE.
The SS Code information element is coded as shown in figure 9.9.3.39.1 and table 9.9.3.39.1.
The SS Code is a type 3 information element with 2 octets length.
9.9.3.40 LCS indicator
The purpose of the LCS indicator information element is to indicate that the origin of the message is due to a LCS request and the type of this request to a CS fallback capable UE.
The LCS indicator information element is coded as shown in figure 9.9.3.40.1 and table 9.9.3.40.1.
The LCS indicator is a type 3 information element with 2 octets length.
LCS indicator value to Normal, unspecified in this version of the protocol
9.9.3.41 LCS client identity
The purpose of the LCS client identity information element is to convey information related to the client of a LCS request for a CS fallback capable UE.
The LCS client identity information element is coded as shown in figure 9.9.3.41.1 and table 9.9.3.41.1.
The LCI client identity is a type 4 information element with a minimum length of 3 octets and a maximum length of 257 octets
9.9.3.42 Generic message container type
The purpose of the generic message container type information element is to specify the type of message contained in the generic message container IE. The generic message container type information element is coded as shown in table 9.9.3.42.1.
9.9.3.43 Generic message container
This information element is used to encapsulate the application message transferred between the UE and the network.The generic message container information element is coded as shown in figure 9.9.3.43.1 and table 9.9.3.43.1.
The generic message container is a type 6 information element.
Generic message container contents (octet 4 to octet n); Max value of 65535 octets
The coding of the contents of the generic message container is dependent on the particular application.
9.9.3.44 Voice domain preference and UE's usage setting
See subclause 10.5.5.28 in 3GPP TS 24.008 .
9.9.3.45 GUTI type
The purpose of the GUTI type information element is to indicate whether the GUTI included in the same message in an information element of type EPS mobile identity represents a native GUTI or a mapped GUTI.
The GUTI type information element information element is coded as shown in figure 9.9.3.45.1 and table 9.9.3.45.1.
The GUTI type is a type 1 information element.
GUTI type (octet 1)
0 Native GUTI
1 Mapped GUTI
Bits 2 to 4 of octet 1 are spare and shall be coded as zero.
9.9.3.46 Extended DRX parameters
See subclause 10.5.5.32 in 3GPP TS 24.008 .
9.9.3.47 Control plane service type
The purpose of the Control plane service type information element is to specify the purpose of the CONTROL PLANE SERVICE REQUEST message.
The Control plane service type information element is coded as shown in figure 9.9.3.47.1 and table 9.9.3.47.1.
The Control plane service type is a type 1 information element.
Control plane service type value (octet 1, bit 1 to 3)
0 0 0 mobile originating request
0 0 1 mobile terminating request
to unused; shall be interpreted as " mobile originating request", if received
0 No radio bearer establishment requested
1 Radio bearer establishment requested
See subclause 10.5.5.35 in 3GPP TS 24.008 .
9.9.3.49 Non-3GPP NW provided policies
See subclause 10.5.5.37 in 3GPP TS 24.008 .
9.9.3.50 Hash MME
The purpose of the Hash information element is to transfer a 64-bit hash value to the UE so the UE can check the calculated value against the value locally calculated by the UE to determine whether the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message sent by the UE has been modified.
The Hash information element is coded as shown in figure 9.9.3.50.1 and table 9.9.3.50.1.
The Hash is a type 4 information element with a length of 10 octets.
HashMME value (octet 3 to 10)
This field contains the binary representation of the HashMME. Bit 8 of octet 3 represents the most significant bit of the HashMME and bit 1 of octet 10 the least significant bit.
9.9.3.51 Replayed NAS message container
<control> The purpose of the Replayed NAS message containerIE is to, during an ongoing attach or tracking area updating procedure, re-send the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message with which the UE had initiated the procedure, <condition> <condition> if the MME has included a HASH in the SECURITY MODE COMMAND message </condition> and <condition> MME the HASH is different from the hash value locally calculated at the UE as described in 3GPP TS 33.401 . </condition> </condition> </control> <control> <condition> If an MME ATTACH REQUEST message is included in this IE, </condition> <action> the ATTACH REQUEST message shall be coded as specified in subclause 8.2.4, i.e. without NAS security header. </action> </control> <control> <condition> If a TRACKING AREA UPDATE REQUEST message is included in this IE, </condition> <action> the TRACKING AREA UPDATE REQUEST message shall be coded as specified in subclause 8.2.29, i.e. without NAS security header. </action> </control>
The Replayed NAS message container information element is coded as shown in figure 9.9.3.51.1 and table 9.9.3.51.1.
The Replayed NAS message container is a type 6 information element.
Replayed NAS message container contents (octet 4 to octet n); Max value of 65535 octets
This IE can contain an ATTACH REQUEST message as defined in subclause 8.2.4, or a TRACKING AREA UPDATE REQUEST message as defined in subclause 8.2.29.
9.9.3.52 Network policy
The purpose of the Network policy information element is to provide network policy information to the UE during attach or tracking area updating procedure via the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message.
The Network policy information element is coded as shown in figure 9.9.3.52.1 and table 9.9.3.52.1.
The Network policy is a type 1 information element.
Network policy value
Redirection to GERAN security policy (redir-policy) (octet 1, bit 1)
0 Unsecured redirection to GERAN allowed
1 Unsecured redirection to GERAN not allowed
Bits 2 to 4 are spare and shall be set to "0".
9.9.3.53 UE additional security capability
The UE additional security capability information element is used by the UE to indicate which additional security algorithms are supported by the UE for S1 mode in dual connectivity with NR or for N1 mode or both.
The UE additional security capability information element is coded as shown in figure 9.9.3.53.1 and table 9.9.3.53.1.
The UE additional security capability is a type 4 information element with a length of 6 octets.
0 5GS encryption algorithm 5G-EA0 not supported
1 5GS encryption algorithm 5G-EA0 supported
0 5GS encryption algorithm 128-5G-EA1 not supported
1 5GS encryption algorithm 128-5G-EA1 supported
0 5GS encryption algorithm 128-5G-EA2 not supported
1 5GS encryption algorithm 128-5G-EA2 supported
0 5GS encryption algorithm 128-5G-EA3 not supported
1 5GS encryption algorithm 128-5G-EA3 supported
0 5GS encryption algorithm 5G-EA4 not supported
1 5GS encryption algorithm 5G-EA4 supported
0 5GS encryption algorithm 5G-EA5 not supported
1 5GS encryption algorithm 5G-EA5 supported
0 5GS encryption algorithm 5G-EA6 not supported
1 5GS encryption algorithm 5G-EA6 supported
0 5GS encryption algorithm 5G-EA7 not supported
1 5GS encryption algorithm 5G-EA7 supported
5GS encryption algorithms supported (octet 4)
0 5GS encryption algorithm 5G-EA8 not supported
1 5GS encryption algorithm 5G-EA8 supported
0 5GS encryption algorithm 5G-EA9 not supported
1 5GS encryption algorithm 5G-EA9 supported
0 5GS encryption algorithm 5G-EA10 not supported
1 5GS encryption algorithm 5G-EA10 supported
0 5GS encryption algorithm 5G-EA11 not supported
1 5GS encryption algorithm 5G-EA11 supported
0 5GS encryption algorithm 5G-EA12 not supported
1 5GS encryption algorithm 5G-EA12 supported
0 5GS encryption algorithm 5G-EA13 not supported
1 5GS encryption algorithm 5G-EA13 supported
0 5GS encryption algorithm 5G-EA14 not supported
1 5GS encryption algorithm 5G-EA14 supported
0 5GS encryption algorithm 5G-EA15 not supported
1 5GS encryption algorithm 5G-EA15 supported
0 5GS integrity algorithm 5G-IA0 not supported
1 5GS integrity algorithm 5G-IA0 supported
0 5GS integrity algorithm 128-5G-IA1 not supported
1 5GS integrity algorithm 128-5G-IA1 supported
0 5GS integrity algorithm 128-5G-IA2 not supported
1 5GS integrity algorithm 128-5G-IA2 supported
0 5GS integrity algorithm 128-5G-IA3 not supported
1 5GS integrity algorithm 128-5G-IA3 supported
0 5GS integrity algorithm 5G-IA4 not supported
1 5GS integrity algorithm 5G-IA4 supported
0 5GS integrity algorithm 5G-IA5 not supported
1 5GS integrity algorithm 5G-IA5 supported
0 5GS integrity algorithm 5G-IA6 not supported
1 5GS integrity algorithm 5G-IA6 supported
0 5GS integrity algorithm 5G-IA7 not supported
1 5GS integrity algorithm 5G-IA7 supported
5GS integrity algorithms supported (octet 6)
0 5GS integrity algorithm 5G-IA8 not supported
1 5GS integrity algorithm 5G-IA8 supported
0 5GS integrity algorithm 5G-IA9 not supported
1 5GS integrity algorithm 5G-IA9 supported
0 5GS integrity algorithm 5G-IA10 not supported
1 5GS integrity algorithm 5G-IA10 supported
0 5GS integrity algorithm 5G-IA11 not supported
1 5GS integrity algorithm 5G-IA11 supported
0 5GS integrity algorithm 5G-IA12 not supported
1 5GS integrity algorithm 5G-IA12 supported
0 5GS integrity algorithm 5G-IA13 not supported
1 5GS integrity algorithm 5G-IA13 supported
0 5GS integrity algorithm 5G-IA14 not supported
1 5GS integrity algorithm 5G-IA14 supported
0 5GS integrity algorithm 5G-IA15 not supported
1 5GS integrity algorithm 5G-IA15 supported
NOTE 1: <control> <condition> For a UE supporting dual connectivity with NR. </condition> <condition> if the UE supports one of the encryption algorithms for 5GS in bits 8 to 5 of octet 3, </condition> <action> it shall support the same algorithms for E-UTRAN as specified in 3GPP TS 33.401 . </action> </control>
NOTE 2: <control> <condition> For a UE supporting dual connectivity with NR, </condition> <condition> if the UE supports one of the integrity protection algorithms for 5GS different from 5G-IA0 (bits 7 to 5 of octet 5), </condition> <action> it shall support the same algorithms for E-UTRAN as specified in 3GPP TS 33.401 . </action> </control>
NOTE 3: <control> This algorithm is not applicable to dual connectivity with NR. <condition> A UE not supporting N1 mode </condition> <action> shall set this bit to "0". </action> </control>
9.9.3.54 UE status
See subclause 9.11.3.56 in 3GPP TS 24.501 .
9.9.3.55 Additional information requested
The purpose of the Additional information requested information element is to enable the UE to request ciphering keys for deciphering of ciphered broadcast assistance data.
The Additional information requested information element is coded as shown in figure 9.9.3.55.1 and table 9.9.3.55.1.
The Additional information requested is a type 3 information element with a length of 2 octets.
Ciphering keys for ciphered broadcast assistance data (CipherKey) (octet 2, bit 1)
0 ciphering keys for ciphered broadcast assistance data not requested
1 ciphering keys for ciphered broadcast assistance data requested
Bits 8 to 2 of octet 2 are spare and shall be coded as zero.
9.9.3.56 Ciphering key data
The purpose of the Ciphering key data information element is to transfer a list of ciphering data sets from the network to the UE for deciphering of ciphered assistance data.
The Ciphering key data information element is coded as shown in figure 9.9.3.56.1, figure 9.9.3.56.2 and table 9.9.3.56.1.
The Ciphering key data is a type 6 information element, with a minimum length of 35 octets and a maximum length of 2291 octets. The list can contain a maximum of 16 ciphering data sets.
octet i octet i+1*
octet l* octet l+1*
octet m* octet m+1*
octet n*
octet 18 octet 19 octet 20
octet k octet k+1
octet k+4 octet k+5
octet k+9 octet k+10 octet k+11 octet k+12
Value part of the Ciphering key data information element (octets 4 to n)
The value part of the Ciphering key data information element consists of one or several ciphering data sets.
<control> <action> The UE shall store the complete list received. </action> <condition> If more than 16 ciphering data sets are included in this information element, </condition> <action> the UE shall store the first 16 ciphering data sets </action> and <action> ignore the remaining octets of the information element. </action> </control>
Ciphering data set:
Ciphering set ID (octets 1 to 2)
This field contains the binary encoding of the ID identifying the ciphering set.
Ciphering key (octets 3 to octet 18)
This field contains the 128 bit ciphering key.
This field contains the binary encoding of the length, in octets, of the c0 counter. The maximum value for the length of the c0 counter is 16 octets. Bits 8 to 6 of octect 19 are spare and shall be coded as zero.
This field contains the binary encoding of the c0 counter.
Positioning SIB types for which the ciphering data set is applicable (octets k+1 to k+4)
Ciphering data set applicable for positioning SIB type 1-1 (octet k+1, bit 8)
0 Ciphering data set not applicable to positioning SIB type 1-1
1 Ciphering data set applicable to positioning SIB type 1-1
Ciphering data set applicable for positioning SIB type 1-2 (octet k+1, bit 7)
0 Ciphering data set not applicable to positioning SIB type 1-2
1 Ciphering data set applicable to positioning SIB type 1-2
Ciphering data set applicable for positioning SIB type 1-3 (octet k+1, bit 6)
0 Ciphering data set not applicable to positioning SIB type 1-3
1 Ciphering data set applicable to positioning SIB type 1-3
Ciphering data set applicable for positioning SIB type 1-4 (octet k+1, bit 5)
0 Ciphering data set not applicable to positioning SIB type 1-4
1 Ciphering data set applicable to positioning SIB type 1-4
Ciphering data set applicable for positioning SIB type 1-5 (octet k+1, bit 4)
0 Ciphering data set not applicable to positioning SIB type 1-5
1 Ciphering data set applicable to positioning SIB type 1-5
Ciphering data set applicable for positioning SIB type 1-6 (octet k+1, bit 3)
0 Ciphering data set not applicable to positioning SIB type 1-6
1 Ciphering data set applicable to positioning SIB type 1-6
Ciphering data set applicable for positioning SIB type 1-7 (octet k+1, bit 2)
0 Ciphering data set not applicable to positioning SIB type 1-7
1 Ciphering data set applicable to positioning SIB type 1-7
Ciphering data set applicable for positioning SIB type 2-1 (octet k+1, bit 1)
0 Ciphering data set not applicable to positioning SIB type 2-1
1 Ciphering data set applicable to positioning SIB type 2-1
Ciphering data set applicable for positioning SIB type 2-2 (octet k+2, bit 8)
0 Ciphering data set not applicable to positioning SIB type 2-2
1 Ciphering data set applicable to positioning SIB type 2-2
Ciphering data set applicable for positioning SIB type 2-3 (octet k+2, bit 7)
0 Ciphering data set not applicable to positioning SIB type 2-3
1 Ciphering data set applicable to positioning SIB type 2-3
Ciphering data set applicable for positioning SIB type 2-4 (octet k+2, bit 6)
0 Ciphering data set not applicable to positioning SIB type 2-4
1 Ciphering data set applicable to positioning SIB type 2-4
Ciphering data set applicable for positioning SIB type 2-5 (octet k+2, bit 5)
0 Ciphering data set not applicable to positioning SIB type 2-5
1 Ciphering data set applicable to positioning SIB type 2-5
Ciphering data set applicable for positioning SIB type 2-6 (octet k+2, bit 4)
0 Ciphering data set not applicable to positioning SIB type 2-6
1 Ciphering data set applicable to positioning SIB type 2-6
Ciphering data set applicable for positioning SIB type 2-7 (octet k+2, bit 3)
0 Ciphering data set not applicable to positioning SIB type 2-7
1 Ciphering data set applicable to positioning SIB type 2-7
Ciphering data set applicable for positioning SIB type 2-8 (octet k+2, bit 2)
0 Ciphering data set not applicable to positioning SIB type 2-8
1 Ciphering data set applicable to positioning SIB type 2-8
Ciphering data set applicable for positioning SIB type 2-9 (octet k+2, bit 1)
0 Ciphering data set not applicable to positioning SIB type 2-9
1 Ciphering data set applicable to positioning SIB type 2-9
Ciphering data set applicable for positioning SIB type 2-10 (octet k+3, bit 8)
0 Ciphering data set not applicable to positioning SIB type 2-10
1 Ciphering data set applicable to positioning SIB type 2-10
Ciphering data set applicable for positioning SIB type 2-11 (octet k+3, bit 7)
0 Ciphering data set not applicable to positioning SIB type 2-11
1 Ciphering data set applicable to positioning SIB type 2-11
Ciphering data set applicable for positioning SIB type 2-12 (octet k+3, bit 6)
0 Ciphering data set not applicable to positioning SIB type 2-12
1 Ciphering data set applicable to positioning SIB type 2-12
Ciphering data set applicable for positioning SIB type 2-13 (octet k+3, bit 5)
0 Ciphering data set not applicable to positioning SIB type 2-13
1 Ciphering data set applicable to positioning SIB type 2-13
Ciphering data set applicable for positioning SIB type 2-14 (octet k+3, bit 4)
0 Ciphering data set not applicable to positioning SIB type 2-14
1 Ciphering data set applicable to positioning SIB type 2-14
Ciphering data set applicable for positioning SIB type 2-15 (octet k+3, bit 3)
0 Ciphering data set not applicable to positioning SIB type 2-15
1 Ciphering data set applicable to positioning SIB type 2-15
Ciphering data set applicable for positioning SIB type 2-16 (octet k+3, bit 2)
0 Ciphering data set not applicable to positioning SIB type 2-16
1 Ciphering data set applicable to positioning SIB type 2-16
Ciphering data set applicable for positioning SIB type 2-17 (octet k+3, bit 1)
0 Ciphering data set not applicable to positioning SIB type 2-17
1 Ciphering data set applicable to positioning SIB type 2-17
Ciphering data set applicable for positioning SIB type 2-18 (octet k+4, bit 8)
0 Ciphering data set not applicable to positioning SIB type 2-18
1 Ciphering data set applicable to positioning SIB type 2-18
Ciphering data set applicable for positioning SIB type 2-19 (octet k+4, bit 7)
0 Ciphering data set not applicable to positioning SIB type 2-19
1 Ciphering data set applicable to positioning SIB type 2-19
Ciphering data set applicable for positioning SIB type 3-1 (octet k+4, bit 6)
0 Ciphering data set not applicable to positioning SIB type 3-1
1 Ciphering data set applicable to positioning SIB type 3-1
Bits 5 to 1 of octet k+4 are spare and shall be coded as zero.
Validity start time (octets k+5 to k+9)
This field contains the UTC time when the ciphering data set becomes valid, encoded as octets 2 to 6 of the Time zone and time IE specified in 3GPP TS 24. 008 .
Validity duration (octets k+10 to k+11)
This field contains the duration for which the ciphering data set is valid after the validity start time, in units of minutes.
TAIs list (octets k+12 to n)
<control> This field contains the list of tracking areas for which the ciphering data set is applicable, encoded as octets 2 to n of the Tracking area identity list IE as specified in subclause 9.9.3.33. </control> <control> <condition> If the TAIs list is empty (as indicated by a zero length), </condition> the ciphering data set is applicable to the entire serving PLMN. </control>
9.9.3.57 N1 UE network capability
The purpose of the N1 UE network capability IE is to allow the UE that supports N1 mode, to provide the network with information related to the UEs capabilities for 5GS.
The N1 UE network capability information element is coded as shown in figure 9.9.3.57.1 and table 9.9.3.57.1.
The N1 UE network capability is a type 4 information element.
octet 1 octet 2
This bit indicates the capability for control plane CIoT 5GS optimization
0 Control plane CIoT 5GS optimization not supported
1 Control plane CIoT 5GS optimization supported
This bit indicates the capability for N3 data transfer.
0 N3 data transfer supported
1 N3 data transfer not supported
Header compression for control plane CIoT 5GS optimization (5G-HC-CP CIoT) (octet
This bit indicates the capability for header compression for control plane CIoT 5GS optimization.
0 Header compression for control plane CIoT 5GS optimization not supported
1 Header compression for control plane CIoT 5GS optimization supported
This bit indicates the capability for user plane CIoT 5GS optimization
0 User plane CIoT 5GS optimization not supported
1 User plane CIoT 5GS optimization supported
5GS Preferred CIoT network behaviour (5GS-PNB-CIoT) (octet 3, bits 5 and 6)
These bits indicates the 5GS CIoT network behaviour the UE prefers to use
0 0 no additional information
0 1 control plane CIoT 5GS optimization
1 0 user plane CIoT 5GS optimization
<control> All other bits in octet 3 are spare and shall be coded as zero, <condition> if the respective octet is included in the information element. </condition> </control>
9.9.3.58 UE radio capability ID availability
The purpose of the UE radio capability ID availability information element is to indicate that the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN.
The UE radio capability ID availability is a type 4 information element with a length of 3 octets.
The UE radio capability ID availability information element is coded as shown in figure 9.9.3.58.1 and table 9.9.3.58.1.
octet 3 UE radio capability ID availability value (bits 3 to 1 of octet 3)
0 0 0 UE radio capability ID not available
0 0 1 UE radio capability ID available
All other values are interpreted as UE radio capability ID not available by this version of the protocol.
Bits 4 to 8 of octet 3 are spare and shall be coded as zero.
9.9.3.59 UE radio capability ID request
The purpose of the UE radio capability ID request information element is to indicate that the UE radio capability ID shall be included by the UE in the SECURITY MODE COMPLETE message.
The UE radio capability ID request is a type 4 information element with a length of 3 octets.
The UE radio capability ID request information element is coded as shown in figure 9.9.3.59.1 and table 9.9.3.59.1.
UE radio capability ID request (URCIDR) (octet 3, bit 1)
0 UE radio capability ID not requested
1 UE radio capability ID requested
Bits 2 to 8 of octet 3 are spare and shall be coded as zero.
9.9.3.60 UE radio capability ID
See subclause 9.11.3.68 in 3GPP TS 24.501 .
9.9.3.61 UE radio capability ID deletion indication
See subclause 9.11.3.zz in 3GPP TS 24.501 .
9.9.3.62 WUS assistance information
The purpose of the WUS assistance information information element is to transfer the required assistance information to determine the WUS group used when paging the UE.
The coding of the information element allows combining different types of WUS assistance information.
The WUS assistance information information element is coded as shown in figure 9.9.3.62.1, figure 9.9.3.62.2 and table 9.9.3.62.1.
The WUS assistance information is a type 4 information element, with a minimum length of 3 octets.
octet i octet i+1*
octet l* octet l+1*
octet m* octet m+1*
octet n*
Value part of the WUS assistance information information element (octet 3 to n)
The value part of the WUS assistance information information element consists of one or several types of WUS assistance information.
WUS assistance information type:
Type of information (octet 1)
0 0 0 UE paging probability information
All other values are reserved.
UE paging probability information value:
This field contains the value of UE paging probability information requested by the UE or negotiated by the network. It represents the probability of the UE receiving the paging.
bit
All other values shall be interpreted as 10100 by this version of the protocol.
9.9.3.63 NB-S1 DRX parameter
The purpose of the NB-S1 DRX parameter information element is to indicate that the UE intends to use the UE specific DRX parameter in NB-S1 mode and for the network to indicate the negotiated UE specific DRX parameter to be used at paging in NB-S1 mode.
The NB-S1 DRX parameters information element is coded as shown in figure 9.9.3.63.1 and table 9.9.3.63.1.
The NB-S1 DRX parameters is a type 4 information element with a length of 3 octets.
octet 3 NB-S1 mode DRX value (bits 4 to 1 of octet 3)
This field represents the DRX cycle parameter 'T' as defined in 3GPP TS 36.304 .
0 0 0 0 DRX value not specified and use cell specific DRX value
All other values shall be interpreted as "DRX value not specified and use cell specific DRX value" by this version of the protocol.
Bits 5 to 8 of octet 3 are spare and shall be coded as zero.
9.9.4 EPS Session Management (ESM) information elements
9.9.4.1 Access point name
See subclause 10.5.6.1 in 3GPP TS 24.008 .
9.9.4.2 APN aggregate maximum bit rate
The purpose of the APN aggregate maximum bit rate information element is to indicate the initial subscribed APN- AMBR when the UE establishes a PDN connection or to indicate the new APN-AMBR if it is changed by the network.
The APN aggregate maximum bit rate information element is coded as shown in figure 9.9.4.2.1 and table 9.9.4.2.1.
The APN aggregate maximum bit rate is a type 4 information element with a minimum length of 4 octets and a maximum length of 8 octets. Octets 5-8 are optional. <control> <condition> If octet 5 is included, </condition> <action> then octet 6 shall also be included, </action> and <action> octets 7-8 may be included. </action> </control> <control> <condition> If octet 7 is included, </condition> <action> then octet 8 shall also be included. </action> </control> The length of the APN-AMBR IE can be either 4 octets, 6 octets or 8 octets.
to giving a range of values from 1 kbps to 63 kbps in 1 kbps increments.
to giving a range of values from 64 kbps to 568 kbps in 8 kbps increments.
to giving a range of values from 576 kbps to 8640 kbps in 64 kbps increments.
<control> <condition> If the network wants to indicate an APN-AMBR for downlink higher than 8640 kbps, </condition> <action> it shall set octet 3 to "11111110", i.e. 8640 kbps, </action> and <action> shall encode the value for the APN-AMBR in octet 5. </action> </control>
Coding is identical to that of APN-AMBR for downlink.
APN-AMBR for downlink (extended), octet 5
For all other values: Ignore the value indicated by the APN-AMBR for downlink in octet 3
to giving a range of values from 8700 kbps to 16000 kbps in 100 kbps increments.
to giving a range of values from 17 Mbps to 128 Mbps in 1 Mbps increments.
to giving a range of values from 130 Mbps to 256 Mbps in 2 Mbps increments.
APN-AMBR for uplink (extended), octet 6
This field is an extension of the APN-AMBR for uplink in octet 4. The coding is identical to that of the APN-AMBR for downlink (extended).
APN-AMBR for downlink (extended-2), octet 7
octets 3 and 5.
to the APN-AMBR for downlink and APN-AMBR for downlink (extended) in octets 3 and 5),
<control> <condition> If the network wants to indicate an APN-AMBR value for downlink higher than 65280 Mbps, </condition> <action> it shall set octet 5 to "11111010" and octet 7 to "11111110", i.e. 65280 Mbps, </action> and <action> shall encode the higher value for the APN-AMBR in the extended APN aggregate maximum bit rate information element specified in subclause 9.9.4.29. </action> </control>
APN-AMBR for uplink (extended-2), octet 8
This field is an extension of the APN-AMBR for uplink and APN-AMBR for uplink (extended) in octets 4 and 6. The coding is identical to that of the APN-AMBR for downlink (extended-2).
<control> <condition> If the UE or the network wants to indicate an APN-AMBR value for uplink higher than 65280 Mbps, </condition> <action> it shall set octet 8 to "11111110", i.e. 65280 Mbps, </action> and <action> shall encode the higher value for the APN-AMBR in the extended APN aggregate maximum bit rate information element specified in subclause 9.9.4.29. </action> </control>
9.9.4.2A Connectivity type
See subclause 10.5.6.19 in 3GPP TS 24.008 .
9.9.4.3 EPS quality of service
The purpose of the EPS quality of service information element is to specify the QoS parameters for an EPS bearer context.
The EPS quality of service information element is coded as shown in figure 9.9.4.3.1 and table 9.9.4.3.1.
The EPS quality of service is a type 4 information element with a minimum length of 3 octets and a maximum length of 15 octets. <control> <condition> If octet 4 is included, </condition> <action> then octets 5-7 shall also be included, </action> and <action> octets 8-15 may be included. </action> </control> <control> <condition> If octet 8 is included, </condition> <action> then octets 4-11 shall also be included, </action> and <action> octets 12-15 may be included. </action> </control> <control> <condition> If octet 12 is included, </condition> <action> then octets 4-15 shall also be included. </action> </control> The length of the EPS QoS IE can be either 3 octets, 7 octets, 11 octets or 15 octets.
Refer to 3GPP TS 23.203 for a detailed description of the QoS Class Identifier (QCI).
Quality of Service Class Identifier (QCI), octet 3 (see 3GPP TS 23.203 and 3GPP TS 29.212 ) to Operator-specific QCIs
The network shall consider all other values not explicitly defined in this version of the protocol as unsupported.
NOTE: <control> <action> The UE shall use this value, </action> <condition> <condition> if the information element has presence requirement "M" in a message, </condition> <condition> but the information element does not serve any useful purpose in the specific procedure for which the message is sent (see subclause 6.5.3.2). QCI values 10-127 were reserved in earlier versions of the protocol. </condition> </condition> </control>
<control> <condition> If the UE receives a QCI value (excluding the reserved QCI values) that it does not understand, </condition> <action> the UE shall choose a QCI value from the set of QCI values defined in this version of the protocol (see 3GPP TS 23.203 and 3GPP TS 29.212 ) and associated with: a) GBR bearers if the IE includes a guaranteed bit rate value; and b) non-GBR bearers if the IE does not include a guaranteed bit rate value. </action> </control> <control> <action> The UE shall use this chosen QCI value </action> <condition> for internal operations only. </condition> </control> <control> <action> The UE shall use the received QCI value </action> <condition> in subsequent NAS signalling procedures. </condition> </control>
<control> <condition> For all non-GBR QCIs, </condition> <action> the maximum and guaranteed bit rates shall be ignored. </action> </control>
Maximum bit rate for uplink, octet 4 (see 3GPP TS 23.107 )
to giving a range of values from 1 kbps to 63 kbps in 1 kbps increments.
to giving a range of values from 64 kbps to 568 kbps in 8 kbps increments.
to giving a range of values from 576 kbps to 8640 kbps in 64 kbps increments.
<control> <condition> If the sending entity wants to indicate a maximum bit rate for uplink higher than 8640 kbps, </condition> <action> it shall set octet 4 to "11111110", i.e. 8640 kbps, </action> and <action> shall encode the value for the maximum bit rate in octet 8. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
Maximum bit rate for downlink, octet 5 (see 3GPP TS 23.107 )
Coding is identical to that of maximum bit rate for uplink.
<control> <condition> If the sending entity wants to indicate a maximum bit rate for downlink higher than 8640 kbps, </condition> <action> it shall set octet 5 to "11111110", i.e. 8640 kbps, </action> and <action> shall encode the value for the maximum bit rate in octet 9. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
<control> In this version of the protocol, <condition> for messages specified in the present document, </condition> <action> the sending entity shall not request 0 kbps for both the maximum bit rate for downlink and the maximum bit rate for uplink at the same time. </action> </control> <control> <condition> Any entity receiving a request for 0 kbps in both the maximum bit rate for downlink and the maximum bit rate for uplink </condition> <action> shall consider that as a syntactical error (see clause 8 of 3GPP TS 24.008 ). </action> </control>
Guaranteed bit rate for uplink, octet 6 (see 3GPP TS 23.107 )
Coding is identical to that of maximum bit rate for uplink.
<control> <condition> If the sending entity wants to indicate a guaranteed bit rate for uplink higher than 8640 kbps, </condition> <action> it shall set octet 6 to "11111110", i.e. 8640 kbps, , </action> and <action> shall encode the value for the guaranteed bit rate in octet 10. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
Guaranteed bit rate for downlink, octet 7 (see 3GPP TS 23.107 )
Coding is identical to that of maximum bit rate for uplink.
<control> <condition> If the sending entity wants to indicate a guaranteed bit rate for downlink higher than 8640 kbps, </condition> <action> it shall set octet 7 to "11111110", i.e. 8640 kbps, </action> and <action> shall encode the value for the guaranteed bit rate in octet 11. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
Maximum bit rate for uplink (extended), octet 8
<control> <condition> For all other values: </condition> <action> ignore the value indicated by the maximum bit rate for uplink in octet 4 </action> </control>
to giving a range of values from 8700 kbps to 16000 kbps in 100 kbps increments.
to giving a range of values from 17 Mbps to 128 Mbps in 1 Mbps increments.
to giving a range of values from 130 Mbps to 256 Mbps in 2 Mbps increments.
<control> <condition> If the sending entity wants to indicate a Maximum bit rate for uplink higher than 256 Mbps, </condition> <action> it shall set octet 8 to "11111010", i.e. 256 Mbps, </action> and <action> shall encode the value for the Maximum bit rate in octet 12. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
Maximum bit rate for downlink (extended), octet 9
This field is an extension of the maximum bit rate for downlink in octet 5. The coding is identical to that of the maximum bit rate for uplink (extended).
<control> <condition> If the sending entity wants to indicate a Maximum bit rate for downlink higher than 256 Mbps, </condition> <action> it shall set octet 9 to "11111010", i.e. 256 Mbps, </action> and <action> shall encode the value for the Maximum bit rate in octet 13. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
Guaranteed bit rate for uplink (extended), octet 10
<control> <condition> For all other values: </condition> <action> ignore the value indicated by the guaranteed bit rate for uplink in octet 6 </action> </control>
to giving a range of values from 8700 kbps to 16000 kbps in 100 kbps increments.
to giving a range of values from 17 Mbps to 128 Mbps in 1 Mbps increments.
to giving a range of values from 130 Mbps to 256 Mbps in 2 Mbps increments.
<control> <condition> If the sending entity wants to indicate a Guaranteed bit rate for uplink higher than 256 Mbps, </condition> <action> it shall set octet 10 to "11111010", i.e. 256 Mbps, </action> and <action> shall encode the value for the Maximum bit rate in octet 14. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
Guaranteed bit rate for downlink (extended), octet 11
This field is an extension of the guaranteed bit rate for downlink in octet 7. The coding is identical to that of guaranteed bit rate for uplink (extended).
<control> <condition> If the sending entity wants to indicate a Guaranteed bit rate for downlink higher than 256 Mbps, </condition> <action> it shall set octet 11 to "11111010", i.e. 256 Mbps, </action> and <action> shall encode the value for the Maximum bit rate in octet 15. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
Maximum bit rate for uplink (extended-2), octet 12
<control> <condition> For all other values: </condition> <action> Ignore the value indicated by the Maximum bit rate for upink in octet 4 </action> </control>
<control> <condition> If the sending entity wants to indicate a Maximum bit rate for uplink higher than 10 Gbps, </condition> <action> it shall set octet 12 to "11110110", i.e. 10 Gbps, </action> and <action> shall encode the value for the maximum bit rate in the Extended quality of service information element specified in subclause 9.9.4.30. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
The UE shall map all other values not explicitly defined onto the maximum value defined in this version of the protocol.
Maximum bit rate for downlink (extended-2), octet 13
This field is an extension of the Maximum bit rate for downlink in octet 9. The coding is identical to that of the Maximum bit rate for uplink (extended-2).
<control> <condition> If the sending entity wants to indicate a Maximum bit rate for downlink higher than 10 Gbps, </condition> <action> it shall set octet 13 to "11110110", i.e. 10 Gbps, </action> and <action> shall encode the value for the maximum bit rate in the Extended quality of service information element specified in subclause 9.9.4.30. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
The UE shall map all other values not explicitly defined onto the maximum value defined in this version of the protocol.
Guaranteed bit rate for uplink (extended-2), octet 14
<control> <condition> For all other values: </condition> <action> Ignore the value indicated by the Guaranteed bit rate for uplink in octet 6 </action> </control>
<control> <condition> If the sending entity wants to indicate a Guaranteed bit rate for uplink higher than 10 Gbps, </condition> <action> it shall set octet 14 to "11110110", i.e. 10 Gbps, </action> and <action> shall encode the value for the guaranteed bit rate in the Extended quality of service information element specified in subclause 9.9.4.30. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
The UE shall map all other values not explicitly defined onto the maximum value defined in this version of the protocol.
Guaranteed bit rate for downlink (extended-2), octet 15
This field is an extension of the Guaranteed bit rate for downlink in octet 11. The coding is identical to that of the Guaranteed bit rate for uplink (extended-2).
<control> <condition> If the sending entity wants to indicate a Guaranteed bit rate for downlink higher than 10 Gbps, </condition> <action> it shall set octet 15 to "11110110", i.e. 10 Gbps, </action> and <action> shall encode the value for the guaranteed bit rate in the Extended quality of service information element specified in subclause 9.9.4.30. </action> </control>
<control> <action> The network shall map all other values </action> <condition> not explicitly defined onto one of the values defined in this version of the protocol. </condition> <action> The network shall return a negotiated value which is explicitly defined in this version of the protocol. </action> </control>
The UE shall map all other values not explicitly defined onto the maximum value defined in this version of the protocol.
9.9.4.4 ESM cause
The purpose of the ESM cause information element is to indicate the reason why a session management request is rejected.
The ESM cause information element is coded as shown in figure 9.9.4.4.1 and table 9.9.4.4.1.
The ESM cause is a type 3 information element with 2 octets length.
9.9.4.5 ESM information transfer flag
The purpose of the ESM information transfer flag information element is to indicate whether ESM information, i.e. protocol configuration options or APN or both, is to be transferred security protected.
The ESM information transfer flag information element is coded as shown in figure 9.9.4.5.1 and table 9.9.4.5.1.
The ESM information transfer flag is a type 1 information element.
EIT (ESM information transfer)
0 security protected ESM information transfer not required
1 security protected ESM information transfer required
9.9.4.6 Linked EPS bearer identity
The purpose of the Linked EPS bearer identity IE is to identify the default bearer that is associated with a dedicated EPS bearer or to identify the EPS bearer (default or dedicated) with which one or more packet filters specified in a traffic flow aggregate are associated.
The Linked EPS bearer identity information element is coded as shown in figure 9.9.4.6.1 and table 9.9.4.6.1.
The Linked EPS bearer identity is a type 1 information element.
Linked EPS bearer identity (bits 1-4)
9.9.4.7 LLC service access point identifier
See subclause 10.5.6.9 in 3GPP TS 24.008 .
9.9.4.7A Notification indicator
The purpose of the Notification indicator information element is to inform the UE about an event which is relevant for the upper layer using an EPS bearer context or having requested a procedure transaction.
The Notification indicator information element is coded as shown in figure 9.9.4.7A.1 and table 9.9.4.7A.1.
The Notification indicator is a type 4 information element with 3 octets length.
Notification indicator value (octet 3)
All other values are reserved.
9.9.4.8 Packet flow identifier
See subclause 10.5.6.11 in 3GPP TS 24.008 .
9.9.4.9 PDN address
The PDN address information element can assign an IPv4 address to the UE associated with a packet data network and provide the UE with an interface identifier to be used to build the IPv6 link local address.
The PDN address information element is coded as shown in figure 9.9.4.9.1 and table 9.9.4.9.1.
The PDN address is a type 4 information element with minimum length of 7 octets and a maximum length of 15 octets.
octet 15 PDN type value (octet 3)
All other values are reserved.
Bit 4 to 8 of octet 3 are spare and shall be coded as zero.
PDN address information (octet 4 to 15)
<control> <condition> If PDN type value indicates IPv4, </condition> <action> the PDN address information in octet 4 to octet 7 contains an IPv4 address. </action> <action> Bit 8 of octet 4 represents the most significant bit of the IPv4 address </action> and <action> bit 1 of octet 7 the least significant bit. </action> </control>
<control> <condition> If PDN type value indicates IPv6, </condition> <action> the PDN address information in octet 4 to octet 11 contains an IPv6 interface identifier. </action> <action> Bit 8 of octet 4 represents the most significant bit of the IPv6 interface identifier </action> and <action> bit 1 of octet 11 the least significant bit. </action> </control>
<control> <condition> If PDN type value indicates IPv4v6, </condition> <action> the PDN address information in octet 4 to octet 15 contains an IPv6 interface identifier and an IPv4 address. </action> <action> Bit 8 of octet 4 represents the most significant bit of the IPv6 interface identifier </action> and <action> bit 1 of octet 11 the least significant bit. </action> <action> Bit 8 of octet 12 represents the most significant bit of the IPv4 address </action> and <action> bit 1 of octet 15 the least significant bit. </action> </control>
<control> <condition> If PDN type value indicates IPv4 or IPv4v6 and DHCPv4 is to be used to allocate the IPv4 address, </condition> <action> the IPv4 address shall be coded as 0.0.0.0. </action> </control>
<control> <condition> If PDN type value indicates non IP, </condition> <action> the PDN address information in octet 4 to octet 7 are spare </action> and <action> shall be coded as zero. </action> </control>
<control> <condition> If PDN type value indicates Ethernet, </condition> <action> the PDN address information in octet 4 to octet 7 are spare </action> and <action> shall be coded as zero. </action> </control>
9.9.4.10 PDN type
The purpose of the PDN type information element is to indicate: a) the IP version capability of the IP stack associated with the UE; b) non IP; or c) Ethernet.
The PDN type information element is coded as shown in figure 9.9.4.10.1 and table 9.9.4.10.1.
The PDN type is a type 1 information element.
1 0 0 unused; shall be interpreted as "IPv6" if received by the network
All other values are reserved.
Bit 4 of octet 1 is spare and shall be coded as zero.
9.9.4.11 Protocol configuration options
See subclause 10.5.6.3 in 3GPP TS 24.008 .
9.9.4.12 Quality of service
See subclause 10.5.6.5 in 3GPP TS 24.008 .
9.9.4.13 Radio priority
See subclause 10.5.7.2 in 3GPP TS 24.008 .
The purpose of the Re-attempt indicator information element is to indicate a condition under which the UE is allowed, in the current PLMN for the same APN, to re-attempt a session management procedure (see 3GPP TS 24.008 ) corresponding to the EPS session management procedure which was rejected by the network.
The Re-attempt indicator information element is coded as shown in figure 9.9.4.13A/3GPP TS 24.301 and table 9.9.4.13A/3GPP TS 24.301.
The Re-attempt indicator is a type 4 information element with a length of 3 octets.
0 UE is allowed to re-attempt the procedure in A/Gb mode or Iu mode or N1 mode
1 UE is not allowed to re-attempt the procedure in A/Gb mode or Iu mode or N1 mode
0 UE is allowed to re-attempt the procedure in an equivalent PLMN
1 UE is not allowed to re-attempt the procedure in an equivalent PLMN
Bits 3 to 8 of octet 3 are spare and shall be encoded as zero.
9.9.4.14 Request type
See subclause 10.5.6.17 in 3GPP TS 24.008 .
9.9.4.15 Traffic flow aggregate description
The purpose of the Traffic flow aggregate description information element is to specify the aggregate of one of more packet filters and their related parameters and operations. The traffic flow aggregate description may contain the aggregate of packet filters for the downlink direction, the uplink direction or packet filters that apply for both directions.
The packet filters determine the traffic mapping to EPS bearer contexts. <control> <action> The downlink packet filters shall be applied by the network, </action> and <action> the uplink packet filters shall be applied by the UE. </action> </control> <control> <condition> A packet filter that applies for both directions </condition> <action> shall be applied by the network as a downlink packet filter </action> and <action> by the UE as an uplink packet filter. </action> </control>
<control> <condition> When the traffic flow aggregate description is used in the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure, </condition> <action> it is associated to a particular procedure identified by a procedure transaction identity (PTI). </action> </control> <control> Therefore, <action> the UE shall release the traffic flow aggregate description </action> <condition> when the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure is completed. </condition> </control> <control> <action> The UE shall not include the packet filters of a particular traffic flow aggregate description in any other traffic flow aggregate description </action> <condition> when multiple UE requested bearer resource allocation procedures and/or UE requested bearer resource modification procedures are ongoing in parallel. </condition> </control>
The Traffic flow aggregate description information element is encoded using the same format as the Traffic flow template (TFT) information element (see subclause 10.5.6.12 in 3GPP TS 24.008 ). <control> <condition> When sending this IE in the BEARER RESOURCE ALLOCATION REQUEST message or the BEARER RESOURCE MODIFICATION REQUEST message, </condition> <control> <action> the UE shall set the packet filter identifier values to 0 </action> <condition> if the packet filters are newly created; </condition> </control> <control> <condition> otherwise, </condition> <action> the UE shall set the packet filter identifier values from those of already assigned packet filter identifiers of the existing EPS bearer, </action> so that they are unique across all packet filters for the EPS bearer context indicated by the EPS bearer identity IE. </control> </control>
9.9.4.16 Traffic flow template
See subclause 10.5.6.12 in 3GPP TS 24.008 .
9.9.4.17 Transaction identifier
The purpose of the Transaction identifier information element is to represent the corresponding PDP context in A/Gb mode or Iu mode which is mapped from the EPS bearer context.
The Transaction identifier information element is coded as the Linked TI information element in 3GPP TS 24.008 , subclause 10.5.6.7.
9.9.4.18 WLAN offload acceptability
See subclause 10.5.6.20 in 3GPP TS 24.008 .
9.9.4.19 NBIFOM container
See subclause 10.5.6.21 in 3GPP TS 24.008 .
9.9.4.20 Remote UE context list
The purpose of the Remote UE context list information element is to provide identity and optionally IP address of a remote UE connected to, or disconnected from, a UE acting as a ProSe UE-to-network relay.
The Remote UE context list information element is coded as shown in figure 9.9.4.20.1 and table 9.9.4.20.1.
The Remote UE context list is a type 6 information element with a minimum length of 5 octets and a maximum length of 65538 octets.
octet 4 octet 5 to a
octet b
octet m
Remote UE context (octet 5 etc)
The contents of remote UE context are applicable for one individual UE and are coded as shown in figure 9.9.4.20.2 and table 9.9.4.20.2.
octet m octet m+1 octet m+2* octet j octet j+1
octet j+k
0 even number of identity digits
1 odd number of identity digits
Type of user identity (octet 4)
All other values are reserved.
<control> <condition> For the Encrypted IMSI, </condition> <action> this field is coded as a 128-bit string. </action> <action> Bits 5 to 8 of octet 4 are not part of the encrypted IMSI </action> and <action> shall be coded as zero. </action> <action> Bit 8 of octet 5 represents the most significant bit of the encrypted IMSI </action> and <action> bit 1 of octet 21 the least significant bit. </action> </control>
<control> <condition> For the IMSI, </condition> <action> this field is coded using BCD coding. </action> <control> <condition> If the number of identity digits is even </condition> <action> then bits 5 to 8 of the last octet shall be filled with an end mark coded as "1111". </action> </control> </control> The format of IMSI is described in 3GPP TS 23.003 .
<control> <condition> For the MSISDN, </condition> <action> this field is coded using BCD coding. </action> </control> The format of MSISDN is described in 3GPP TS 23.003 .
<control> <condition> For the IMEI, </condition> <action> this field is coded using BCD coding. </action> </control> The format of the IMEI is described in 3GPP TS 23.003 .
<control> <condition> For the IMEISV, </condition> <action> this field is coded using BCD coding. </action> <action> Bits 5 to 8 of the last octet shall be filled with an end mark coded as "1111". </action> </control> The format of the IMEISV is described in 3GPP TS 23.003 .
Bits 4 to 8 of octet j are spare and shall be coded as zero.
Address type (octet j)
0 0 0 No IP Info
All other values are reserved.
<control> <condition> If Address type indicates IPv4, </condition> <action> the Address information in octet j+1 to octet j+6 contains the IPv4 address and port number. </action> <action> Bit 8 of octet j+1 represents the most significant bit of the IP address </action> and <action> bit 1 of octet j+4 the least significant bit. </action> <action> Bit 8 of octet j+5 represents the most significant bit of the port number </action> and <action> bit 1 of octet j+6 the least significant bit. </action> </control>
<control> <condition> If Address type indicates IPv6, </condition> <action> the Address information in octet j+1 to octet j+8 contains the /64 IPv6 prefix of a remote UE. </action> <action> Bit 8 of octet j+1 represents the most significant bit of the /64 IPv6 prefix </action> and <action> bit 1 of octet j+8 the least significant bit. </action> </control>
<control> <condition> If Address type indicates No IP info, </condition> <action> the Address information octets are not included. </action> </control>
9.9.4.21 PKMF address
The purpose of the PKMF address information element is to provide IP address of a ProSe Key Management Function associated with remote UEs connected to or disconnected from a UE acting as a ProSe UE-to-network relay.
The PKMF address information element is coded as shown in figure 9.9.4.21.1 and table 9.9.4.21.1.
The PKMF address is a type 4 information element with a minimum length of 3 octets and a maximum length of 19 octets.
octet 4+k
Bits 4 to 8 of octet 1 are spare and shall be coded as zero.
Address type (octet 1)
All other values are reserved.
<control> <condition> If Address type indicates IPv4, </condition> <action> the Address information in octet 4 to octet 7 contains the IPv4 address. </action> <action> Bit 8 of octet 4 represents the most significant bit of the IP address </action> and <action> bit 1 of octet 7 the least significant bit. </action> </control>
<control> <condition> If Address type indicates IPv6, </condition> <action> the Address information in octet 4 to octet 19 contains the IPv6 address. </action> <action> Bit 8 of octet 4 represents the most significant bit of the IP address </action> and <action> bit 1 of octet 19 the least significant bit. </action> </control>
9.9.4.22 Header compression configuration
The purpose of the Header compression configuration information element is to negotiate ROHC channel setup parameters specified in IETF RFC 5795 and, optionally, provide additional header compression context setup parameters.
The Header compression configuration information element is coded as shown in figure 9.9.4.22.1 and table 9.9.4.22.1.
The Header compression configuration is a type 4 information element with a minimum length of 5 octets and a maximum length of 257 octets.
The optional Additional header compression parameters container field conveys the additional header compression context setup parameters as specified in 3GPP TS 23.401 in a generic container. This field corresponds to the profile-specific information in the header of the ROHC IR packet type in IETF RFC 5795 .
octet n* ROHC Profiles (octet 3)
The ROHC Profiles shall indicate which of the ROHC profiles is supported. <control> <condition> When a particular bit is set to 1, </condition> <action> this indicates that the corresponding profile is supported. </action> </control> The No Compression profile 0x0000 (see IETF RFC 5795 ) shall always be supported. <control> <condition> When all the bits are set to 0, </condition> <action> this indicates that only the No Compression profile 0x0000 is supported. </action> </control>
Profile 0x0002 support indicator (see IETF RFC 3095 and IETF RFC 4815 ) (octet 3 bit 1)
0 RoHC profile 0x0002 (UDP/IP) is not supported
1 RoHC profile 0x0002 (UDP/IP) is supported
Profile 0x0003 support indicator (see IETF RFC 3095 and IETF RFC 4815 ) (octet 3 bit 2)
0 RoHC profile 0x0003 (ESP/IP) is not supported
1 RoHC profile 0x0003 (ESP/IP) is supported
Profile 0x0004 support indicator (see IETF RFC 3843 and IETF RFC 4815 ) (octet 3 bit 3)
0 RoHC profile 0x0004 (IP) is not supported
1 RoHC profile 0x0004 (IP) is supported
0 RoHC profile 0x0006 (TCP/IP) is not supported
1 RoHC profile 0x0006 (TCP/IP) is supported
0 RoHC profile 0x0102 (UDP/IP) is not supported
1 RoHC profile 0x0102 (UDP/IP) is supported
0 RoHC profile 0x0103 (ESP/IP) is not supported
1 RoHC profile 0x0103 (ESP/IP) is supported
0 RoHC profile 0x0104 (IP) is not supported
1 RoHC profile 0x0104 (IP) is supported
Bits 8 is spare and shall be set to 0.
This is the MAX_CID value as specified in 3GPP TS 36.323 . It is encoded in binary coding with a value in the range from 1 to 16383.
Additional header compression context parameters type (octet 6).
The Additional header compression context parameters type octet indicates the profile associated with the profile- specific information in the Additional header compression context parameters container.
to
Additional header compression context parameters container (octets 7 to n).
Additional header compression context parameters container carries the profile-specific information (see IETF RFC 5795 ). The maximum size is 251 octets.
9.9.4.23 Control plane only indication
The purpose of the Control plane only indication information element is to indicate that a PDN connection is only for control plane CIoT EPS optimization, e.g. the PDN connection is with an SCEF (see 3GPP TS 23.401 ).
The Control plane only indication information element is coded as shown in figure 9.9.4.23.1.
The Control plane only indication is a type 1 information element.
Control plane only indication value (CPOI) (octet 1)
0 reserved
1 PDN connection can be used for control plane CIoT EPS optimization only
The value 0 is reserved. <control> <condition> If received, </condition> <action> it shall be interpreted as if the Control plane indication IE was not included in the message. </action> </control>
Bits 4 to 2 of octet 1 are spare and shall be all encoded as zero.
9.9.4.24 User data container
This information element is used to encapsulate the user data transferred between the UE and the MME. The User data container information element is coded as shown in figure 9.9.4.24.1 and table 9.9.4.24.1.
The User data container is a type 6 information element.
User data container contents (octet 4 to octet n)
These octets include user data to be delivered between UE and MME.
9.9.4.25 Release assistance indication
The purpose of the Release assistance indication IE is to inform the network whether a) no further uplink and no further downlink data transmission is expected; or b) only a single downlink data transmission (e.g. acknowledgement or response to uplink data) and no further uplink data transmission subsequent to the uplink data transmission is expected.
The Release assistance indication information element is coded as shown in figure 9.9.4.25.1 and table 9.9.4.25.1.
The Release assistance indication is a type 1 information element.
9.9.4.26 Extended protocol configuration options
See subclause 10.5.6.3A in 3GPP TS 24.008 .
9.9.4.27 Header compression configuration status
The purpose of the Header compression configuration status information element is to indicate the status of the Header compression configuration for each EPS bearer using Control plane CIoT EPS optimisation that can be identified by an EPS bearer identity.
The Header compression confguration status information element is a type 4 information element with 4 the length of 4 octets.
octet 1 octet 2 octet 3 octet 4
EBI(x) shall be coded as follows: EBI(0): Bit 0 of octet 3 is spare and shall be coded as zero.
EBI(1) EBI(15): 0 indicates that the header compression configuration for the corresponding EPS bearer is used.
1 indicates that the header compression configuration for the corresponding EPS bearer is not used.
9.9.4.28 Serving PLMN rate control
The purpose of the Serving PLMN rate control information element is to indicate the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send via a PDN connection per
The Serving PLMN rate control information element is coded as shown in figure 9.9.4.28.1.
The Serving PLMN rate control is a type 4 information element with 4 octets length.
Serving PLMN rate control value (octet 3 to octet 4) is a binary encoded integer indicating the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval. The Serving PLMN rate control value is an integer equal to or higher than 10. The Serving PLMN rate control value FFFFH indicates that the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval is not restricted.
9.9.4.29 Extended APN aggregate maximum bit rate
The purpose of the extended APN aggregate maximum bit rate information element is to indicate the initial subscribed APN-AMBR with a value higher than 65280 Mbps when the UE establishes a PDN connection or to indicate the new APN-AMBR with a value higher than 65280 Mbps if it is changed by the network.
<control> <action> The receiving entity shall ignore the bit rate values </action> <condition> which are included in the extended APN aggregate maximum bit rate information element and not higher than 65280 Mbps. </condition> </control>
The extended APN aggregate maximum bit rate information element is coded as shown in figure 9.9.4.29.1 and table 9.9.4.29.1.
The extended APN aggregate maximum bit rate is a type 4 information element with a length of 8 octets.
Unit for extended APN-AMBR for downlink (octet 3)
Other values shall be interpreted as multiples of 256 Pbps in this version of the protocol.
Extended APN-AMBR for downlink (octets 4 and 5)
Octets 4 and 5 represent the binary coded value of extended APN-AMBR for downlink in units defined by octet 3
Unit for extended APN-AMBR for uplink (octet 6)
The coding is identical to that of the unit for extended APN-AMBR for downlink
Extended APN-AMBR for uplink (octets 7 and 8)
Octets 7 and 8 represent the binary coded value of extended APN-AMBR for uplink in units defined by octet 6.
NOTE: In this release of the specifications if received it shall be interpreted as value is incremented in multiples of 4 Mbps. In earlier releases of specifications, the interpretation of this value is up to implementation.
9.9.4.30 Extended quality of service
The purpose of the Extended quality of service information element is to indicate for an EPS bearer context the maximum bit rates for uplink and downlink and the guaranteed bit rates for uplink and downlink, if at least one of the bit rates has a value higher than 10 Gbps.
The Extended quality of service information element is coded as shown in figure 9.9.4.30.1 and table 9.9.4.30.1. <control> <condition> For uplink and downlink, </condition> <condition> if the sending entity only has to indicate one bit rate (i.e, with a value higher than 10 Gbps), </condition> it shall encode the other bit rate (i.e., with a value smaller or equal to 10 Gbps) as "00000000". The receiving entity shall ignore a bit rate which is included in the extended quality of service information element and has a value smaller or equal to 10 Gbps. </control>
The Extended quality of service is a type 4 information element with a length of 12 octets.
Unit for maximum bit rate (octet 3)
Other values shall be interpreted as multiples of 256 Pbps in this version of the protocol.
Maximum bit rate for uplink (octets 4 and 5)
Octets 4 and 5 represent the binary coded value of maximum bit rate for uplink in units defined by octet 3.
Maximum bit rate for downlink (octets 6 and 7)
Octets 6 and 7 represent the binary coded value of maximum bit rate for downlink in units defined by octet 3.
Unit for guaranteed bit rate (octet 8)
The coding is identical to that of the unit for maximum bit rate (octet 3).
Guaranteed bit rate for uplink (octets 9 and 10)
Octets 9 and 10 represent the binary coded value of guaranteed bit rate for uplink in units defined by octet 8.
Guaranteed bit rate for downlink (octets 11 and 12)
Octets 11 and 12 represent the binary coded value of guaranteed bit rate for downlink in units defined by octet 8.
NOTE: In this release of the specifications if received it shall be interpreted as value is incremented in multiples of 200 Kbps. In earlier releases of specifications, the interpretation of this value is up to implementation.
10 List of system parameters
10.1 General
The description of timers in the following tables should be considered a brief summary.
10.2 Timers of EPS mobility management
10.3 Timers of EPS session management
NOTE 1: The back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.
NOTE 2: Reference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation.
Annex A (informative): Cause values for EPS mobility management
A.1 Causes related to UE identification
<control> Cause #2 IMSI unknown in HSS: <action> This EMM cause is sent to the UE </action> <condition> <condition> if the UE is not known (registered) in the HSS </condition> or <condition> if the UE has packet only subscription. </condition> </condition> <action> This EMM cause does not affect operation of the EPS service, although is may be used by an EMM procedure. </action> </control>
<control> Cause #3 Illegal UE: <action> This EMM cause is sent to the UE </action> <condition> <condition> when the network refuses service to the UE </condition> <condition> <condition> either because an identity of the UE is not acceptable to the network </condition> or <condition> because the UE does not pass the authentication check, i.e. the RES received from the UE is different from that generated by the network. </condition> </condition> </condition> </control>
<control> Cause #6 Illegal ME: <action> This EMM cause is sent to the UE </action> <condition> if the ME used is not acceptable to the network, e.g. blacklisted. </condition> </control>
<control> Cause #9 UE identity cannot be derived by the network: <action> This EMM cause is sent to the UE </action> <condition> when the network cannot derive the UE's identity from the GUTI/S-TMSI/P- TMSI and RAI e.g. no matching identity/context in the network or failure to validate the UE's identity due to integrity check failure of the received message. </condition> </control>
<control> Cause #10 Implicitly detached: <action> This EMM cause is sent to the UE either </action> <condition> <condition> if the network has implicitly detached the UE, e.g. after the implicit detach timer has expired, </condition> or <condition> if the EMM context data related to the subscription does not exist in the MME <condition> e.g. <condition> because of a MME restart, </condition> or <condition> because of a periodic tracking area update request routed to a new MME. </condition> </condition> </condition> </condition> </control>
A.2 Cause related to subscription options
<control> Cause #5 IMEI not accepted: <action> This cause is sent to the UE </action> <condition> if the network does not accept an attach procedure for emergency bearer services using an IMEI. </condition> </control>
<control> Cause #7 EPS services not allowed: <action> This EMM cause is sent to the UE </action> <condition> when it is not allowed to operate EPS services. </condition> </control>
<control> Cause #8 EPS services and non-EPS services not allowed: <action> This EMM cause is sent to the UE </action> <condition> when it is not allowed to operate either EPS or non-EPS services. </condition> </control>
<control> Cause #11 PLMN not allowed: <action> This EMM cause is sent to the UE </action> <condition> <condition> if it requests service, </condition> or <condition> <condition> if the network initiates a detach request, </condition> <condition> in a PLMN where the UE, by subscription or due to operator determined barring, is not allowed to operate. </condition> </condition> </condition> </control>
<control> Cause #12 Tracking area not allowed: <action> This EMM cause is sent to the UE </action> <condition> if it requests service, or if the network initiates a detach request, in a tracking area where the HPLMN determines that the UE, by subscription, is not allowed to operate. </condition> </control>
NOTE 1: <control> <condition> If EMM cause #12 is sent to a roaming subscriber </condition> <action> the subscriber is denied service </action> <condition> even if other PLMNs are available on which registration was possible. </condition> </control>
<control> Cause #13 Roaming not allowed in this tracking area: <action> This EMM cause is sent to an UE </action> <condition> <condition> which requests service, </condition> or <condition> if <condition> the network initiates a detach request, </condition> <condition> in a tracking area of a PLMN which by subscription offers roaming to that UE but not in that tracking area. </condition> </condition> </condition> </control>
<control> Cause #14 EPS services not allowed in this PLMN: <action> This EMM cause is sent to the UE </action> <condition> <condition> which requests service, </condition> or <condition> <condition> if the network initiates a detach request, </condition> <condition> in a PLMN which does not offer roaming for EPS services to that UE. </condition> </condition> </condition> </control>
NOTE 2: <control> <condition> Since only one list of forbidden PLMNs for packet services is maintained in the UE, </condition> <action> then the "forbidden PLMNs for GPRS service" is the maintained list and the forbidden PLMNs for EPS service is equivalent to it. </action> </control>
<control> <condition> Cause #15 No suitable cells in tracking area: </condition> </control>
<control> <action> This EMM cause is sent to the UE </action> <condition> <condition> if it requests service, </condition> or <condition> <condition> if the network initiates a detach request, </condition> </condition> <condition> in a tracking area where the UE, by subscription, is not allowed to operate, </condition> </condition> <condition> but when it should find another allowed tracking area or location area in the same PLMN or an equivalent PLMN. </condition> </control>
NOTE 3: Cause #15 and cause #12 differ in the fact that cause #12 does not trigger the UE to search for another allowed tracking area on the same PLMN.
<control> Cause #25 Not authorized for this CSG: <action> This EMM cause is sent to the UE </action> <condition> <condition> if it requests access, </condition> or <condition> <condition> if the network initiates a detach request, </condition> <condition> <condition> in a CSG cell with CSG ID </condition> <condition> <condition> where the UE either has no subscription to operate </condition> or <condition> the UE's subscription has expired and it should find another cell in the same PLMN or an equivalent PLMN. </condition> </condition> </condition> </condition> </condition> </control>
<control> Cause #35 Requested service option not authorized in this PLMN: <action> This EMM cause is sent to the UE </action> <condition> <condition> if it requests in a PLMN a service option </condition> <condition> for which it is not authorized, </condition> <condition> e.g. if it attempts to attach for relay node operation in a PLMN with a USIM which does not belong to a relay node- specific subscription. </condition> </condition> </control>
<control> Cause #40 No EPS bearer context activated: <action> This EMM cause is sent to the UE, </action> <condition> if <condition> during a tracking area updating procedure or a service request, </condition> <condition> the MME detects that there is no active EPS bearer context in the network. </condition> </condition> </control>
<control> Cause #31 Redirection to 5GCN required: <action> This EMM cause is sent to the UE </action> <condition> <condition> if it requests service in a PLMN </condition> <condition> where the UE by operator policy, <condition> is not allowed in EPC </condition> and <condition> redirection to 5GCN is required. </condition> </condition> </condition> </control>
A.3 Causes related to PLMN specific network failures and congestion/authentication failures
<control> Cause #16 MSC temporarily not reachable: <action> This EMM cause is sent to the UE </action> <condition> <condition> if it requests a combined EPS attach or tracking area updating </condition> <condition> in a PLMN where the MSC is temporarily not reachable via the EPS part of the network. </condition> </condition> </control>
<control> Cause #17 Network failure: <action> This EMM cause is sent to the UE </action> <condition> <condition> if the MME cannot service an UE generated request </condition> <condition> because of PLMN failures. </condition> </condition> </control>
<control> Cause #18 CS domain not available: <action> This EMM cause is sent to the UE </action> <condition> <condition> if the MME cannot service an UE generated request </condition> <condition> <condition> because CS domain is not available </condition> and <condition> SMS in MME is not supported. </condition> </condition> </condition> </control>
<control> Cause #19 ESM failure: <action> This EMM cause is sent to the UE </action> <condition> when there is a failure in the ESM message contained in the EMM message. </condition> </control>
<control> Cause #20 MAC failure: <action> This EMM cause is sent to the network </action> <condition> if the USIM detects that the MAC in the AUTHENTICATION REQUEST message is not fresh (see 3GPP TS 33.401 ). </condition> </control>
<control> Cause #21 Synch failure: <action> This EMM cause is sent to the network </action> <condition> if the USIM detects that the SQN in the AUTHENTICATION REQUEST message is out of range (see 3GPP TS 33.401 ). </condition> </control>
<control> Cause #22 Congestion: <action> This EMM cause is sent to the UE </action> <condition> because of congestion in the network (e.g. no channel, facility busy/congested etc.). </condition> </control>
<control> Cause #23 UE security capabilities mismatch: <action> This EMM cause is sent to the network </action> <condition> if the UE detects that the UE security capability does not match the one sent back by the network. </condition> </control>
<control> Cause #24 Security mode rejected, unspecified: <action> This EMM cause is sent to the network </action> <condition> <condition> if the security mode command is rejected by the UE </condition> <condition> <condition> if the UE detects that the nonce does not match the one sent back by the network </condition> or <condition> for unspecified reasons. </condition> </condition> </condition> </control>
UE
<control> Cause #26 Non-EPS authentication unacceptable: <action> This EMM cause is sent to the network in S1 mode </action> <condition> if the "separation bit" in the AMF field of AUTN is set to 0 in the AUTHENTICATION REQUEST message (see 3GPP TS 33.401 ). </condition> </control>
<control> Cause #39 CS service temporarily not available: <action> This EMM cause is sent to the UE </action> <condition> <condition> when the CS fallback or 1xCS fallback request cannot be served temporarily due to O&amp;M reasons </condition> or <condition> a mobile terminating CS fallback call is aborted by the network during call establishment (see 3GPP TS 29.118 ). </condition> </condition> </control>
<control> Cause #42 Severe network failure: <action> This EMM cause is sent to the UE </action> <condition> <condition> when the network has determined that the requested procedure cannot be completed successfully due to network failure. </condition> <condition> <condition> The failure is not expected to be temporary </condition> and <condition> repeated request is not likely to succeed in near future. </condition> </condition> </condition> </control>
A.4 Causes related to nature of request NOTE: This subclause has no entries in this version of the specification
A.5 Causes related to invalid messages
Cause value #95 Semantically incorrect message.
Cause value #96 Invalid mandatory information.
Cause value #97 Message type non-existent or not implemented.
Cause value #98 Message type not compatible with protocol state.
Cause value #99 Information element non-existent or not implemented.
Cause value #100 Conditional IE error.
Cause value #101 Message not compatible with protocol state.
Cause value #111 Protocol error, unspecified.
Annex B (informative): Cause values for EPS session management
B.1 Causes related to nature of request
<control> Cause #8 Operator Determined Barring: <action> This ESM cause is used by the network </action> <condition> <condition> to indicate that the requested service was rejected by the MME </condition> <condition> due to Operator Determined Barring. </condition> </condition> </control>
<control> Cause #26 Insufficient resources: <action> This ESM cause is used by the UE or by the network </action> <condition> <condition> to indicate that the requested service cannot be provided </condition> <condition> due to insufficient resources. </condition> </condition> </control>
<control> Cause #27 Missing or unknown APN: <action> This ESM cause is used by the network </action> <condition> <condition> to indicate that the requested service was rejected by the external packet data network </condition> <condition> <condition> because the access point name was not included although required </condition> or <condition> if the access point name could not be resolved. </condition> </condition> </condition> </control>
<control> Cause #28 Unknown PDN type: <action> This ESM cause is used by the network </action> <condition> <condition> to indicate that the requested service was rejected by the external packet data network </condition> <condition> because the PDN type could not be recognised. </condition> </condition> </control>
<control> <condition> Cause #29 User authentication or authorization failed: </condition> </control>
<control> <action> This ESM cause is used by the network </action> <condition> <condition> <condition> to indicate that the requested service was rejected by the external packet data network </condition> <condition> due to a failed user authentication </condition> or <condition> revoked by the external packet data network. </condition> </condition> </condition> </control>
<control> Cause #30 Request rejected by Serving GW or PDN GW: <action> This ESM cause is used by the network </action> <condition> to indicate that the requested service or operation or the request for a resource was rejected by the Serving GW or PDN GW. </condition> </control>
<control> Cause #31 Request rejected, unspecified: <action> This ESM cause is used by the network or by the UE </action> <condition> <condition> to indicate that the requested service or operation or the request for a resource was rejected </condition> <condition> due to unspecified reasons. </condition> </condition> </control>
<control> Cause #32 Service option not supported: <action> This ESM cause is used by the network </action> <condition> <condition> when the UE requests a service </condition> <condition> which is not supported by the PLMN. </condition> </condition> </control>
<control> Cause #33 Requested service option not subscribed : <action> This ESM cause is sent </action> <condition> <condition> when the UE requests a service option </condition> <condition> for which it has no subscription. </condition> </condition> </control>
<control> Cause #34 Service option temporarily out of order: <action> This ESM cause is sent </action> <condition> <condition> when the network cannot service the request </condition> <condition> because of temporary outage of one or more functions required for supporting the service. </condition> </condition> </control>
<control> Cause #35 PTI already in use: <action> This ESM cause is used by the network </action> <condition> to indicate that the PTI included by the UE is already in use by another active UE requested procedure for this UE. </condition> </control>
<control> Cause #36 Regular deactivation: <action> This ESM cause is used </action> <condition> to indicate a regular UE or network initiated release of EPS bearer resources. </condition> </control>
<control> Cause #37 EPS QoS not accepted: <action> This ESM cause is used by the network </action> <condition> if the new EPS QoS cannot be accepted that was indicated in the UE request. </condition> </control>
<control> Cause #38 Network failure: <action> This ESM cause is used by the network </action> <condition> <condition> to indicate that the requested service was rejected </condition> <condition> due to an error situation in the network. </condition> </condition> </control>
<control> Cause #39 Reactivation requested: <action> This ESM cause is used by the network </action> <condition> to request a PDN connection reactivation. </condition> </control>
<control> Cause #41 Semantic error in the TFT operation: <action> This ESM cause is used by the network or the UE </action> <condition> <condition> to indicate that the requested service was rejected </condition> <condition> due to a semantic error in the TFT operation included in the request. </condition> </condition> </control>
<control> Cause #42 Syntactical error in the TFT operation: <action> This ESM cause is used by the network or the UE </action> <condition> <condition> to indicate that the requested service was rejected </condition> <condition> due to a syntactical error in the TFT operation included in the request. </condition> </condition> </control>
<control> Cause #43 Invalid EPS bearer identity: <action> This ESM cause is used by the network or the UE </action> <condition> <condition> to indicate that the EPS bearer identity value provided to it is not a valid value for the received message </condition> or <condition> the EPS bearer context identified by the linked EPS bearer identity IE in the request is not active. </condition> </condition> </control>
<control> Cause #44 Semantic errors in packet filter(s): <action> This ESM cause is used by the network or the UE </action> <condition> <condition> to indicate that the requested service was rejected </condition> <condition> due to one or more semantic errors in packet filter(s) of the TFT included in the request. </condition> </condition> </control>
<control> Cause #45 Syntactical error in packet filter(s): <action> This ESM cause is used by the network or the UE </action> <condition> <condition> to indicate that the requested service was rejected </condition> <condition> due to one or more syntactical errors in packet filter(s) of the TFT included in the request. </condition> </condition> </control>
<control> Cause #47 PTI mismatch: <action> This ESM cause is used by the UE </action> <condition> to indicate that the PTI value which is included in the ESM message that the UE receives does not match a PTI in use. </condition> </control>
<control> Cause #49 Last PDN disconnection not allowed: <action> This ESM cause is used by the network, </action> <condition> <condition> in case of EMM-REGISTERED without PDN connection is not supported by the UE or the MME, </condition> <condition> to indicate that the UE requested PDN disconnection procedure on the last remaining PDN connection is not allowed. </condition> </condition> </control>
<control> Cause #50 PDN type IPv4 only allowed: <action> This ESM cause is used by the network </action> <condition> to indicate that only PDN type IPv4 is allowed for the requested PDN connectivity. </condition> </control>
<control> Cause #51 PDN type IPv6 only allowed: <action> This ESM cause is used by the network </action> <condition> to indicate that only PDN type IPv6 is allowed for the requested PDN connectivity. </condition> </control>
<control> Cause #52 single address bearers only allowed: <action> This ESM cause is used by the network </action> <condition> <condition> to indicate that the requested PDN connectivity is accepted </condition> <condition> with the restriction that only single IP version bearers are allowed. </condition> </condition> </control>
<control> Cause #53 ESM information not received: <action> This ESM cause is used by the network </action> <condition> <condition> to indicate that the PDN connectivity procedure was rejected </condition> <condition> due to the ESM information was not received. </condition> </condition> </control>
<control> Cause #54 PDN connection does not exist: <action> This ESM cause is used by the network at handover from a non-3GPP access network </action> <condition> to indicate that the MME does not have any information about the requested PDN connection. </condition> </control>
<control> Cause #55 Multiple PDN connections for a given APN not allowed: <action> This ESM cause is used by the network </action> <condition> <condition> to indicate that the PDN connectivity procedure was rejected </condition> <condition> due to multiple PDN connections for a given APN are not allowed. </condition> </condition> </control>
<control> Cause #56 Collision with network initiated request: <action> This ESM cause is used by the network </action> <condition> <condition> to indicate that the network has already initiated the activation, modification or deactivation of bearer resources </condition> <condition> which was requested by the UE. </condition> </condition> </control>
<control> Cause #57 PDN type IPv4v6 only allowed: <action> This ESM cause is used by the network </action> <condition> to indicate that only PDN types IPv4, IPv6 or IPv4v6 are allowed for the requested PDN connectivity. </condition> </control>
<control> Cause #58 PDN type non IP only allowed: <action> This ESM cause is used by the network </action> <condition> to indicate that only PDN type non IP is allowed for the requested PDN connectivity. </condition> </control>
<control> Cause #59 Unsupported QCI value: <action> This ESM cause is used by the network </action> <condition> if the QCI indicated in the UE request cannot be supported. </condition> </control>
<control> Cause #60 Bearer handling not supported: <action> This ESM cause is used by the network </action> <condition> to indicate that the procedure requested by the UE was rejected because the bearer handling is not supported. </condition> </control>
<control> Cause #61 PDN type Ethernet only allowed: <action> This ESM cause is used by the network </action> <condition> to indicate that only PDN type Ethernet is allowed for the requested PDN connectivity. </condition> </control>
<control> Cause #65 Maximum number of EPS bearers reached: <action> This ESM cause is used by the network </action> <condition> <condition> to indicate that the procedure requested by the UE was rejected </condition> <condition> as the network has reached the maximum number of simultaneously active EPS bearer contexts for the UE. </condition> </condition> </control>
<control> Cause #66 Requested APN not supported in current RAT and PLMN combination: <action> This ESM cause is used by the network </action> <condition> to indicate that the procedure requested by the UE was rejected as the requested APN is not supported in the current RAT and PLMN. </condition> </control>
<control> Cause #81 Invalid PTI value: <action> This ESM cause is used by the network or UE </action> <condition> to indicate that the PTI provided to it is unassigned or reserved. </condition> </control>
<control> Cause #112 APN restriction value incompatible with active EPS bearer context: <action> This ESM cause is used by the network </action> <condition> to indicate that the EPS bearer context(s) have an APN restriction value that is not allowed in combination with a currently active EPS bearer context. Restriction values are defined in 3GPP TS 23.060 . </condition> </control>
<control> Cause #113 Multiple accesses to a PDN connection not allowed: <action> This ESM cause is used by the network </action> <condition> to indicate that multiple accesses to a PDN connection for NBIFOM is not allowed. </condition> </control>
B.2 Protocol errors (e.g., unknown message) class
<control> Cause #95 Semantically incorrect message: <action> This ESM cause is used </action> <condition> <condition> to report receipt of a message </condition> <condition> with semantically incorrect contents. </condition> </condition> </control>
<control> Cause #96 Invalid mandatory information: <action> This ESM cause indicates </action> <condition> <condition> that the equipment sending this ESM cause has received a message </condition> <condition> with a non- semantical mandatory IE error. </condition> </condition> </control>
<control> Cause #97 Message type non-existent or not implemented: <action> This ESM cause indicates </action> <condition> <condition> that the equipment sending this ESM cause has received a message </condition> <condition> <condition> with a message type it does not recognize </condition> <condition> <condition> either because this is a message not defined, </condition> or <condition> defined but not implemented by the equipment sending this ESM cause. </condition> </condition> </condition> </condition> </control>
<control> Cause #98 Message type not compatible with protocol state: <action> This ESM cause indicates </action> <condition> that the equipment sending this ESM cause has received a message not compatible with the protocol state. </condition> </control>
<control> Cause #99 Information element non-existent or not implemented: <action> This ESM cause indicates </action> <condition> <condition> that the equipment sending this ESM cause has received a message </condition> <condition> <condition> which includes information elements not recognized </condition> <condition> <condition> because the information element identifier is not defined </condition> or <condition> it is defined but not implemented by the equipment sending the ESM cause. </condition> </condition> </condition> </condition> However, the information element is not required to be present in the message in order for the equipment sending the ESM cause to process the message. </control>
<control> Cause #100 Conditional IE error: <action> This ESM cause indicates </action> <condition> <condition> that the equipment sending this cause has received a message </condition> <condition> with conditional IE errors. </condition> </condition> </control>
<control> Cause #101 Message not compatible with protocol state: <action> This ESM cause indicates </action> <condition> <condition> that a message has been received </condition> <condition> which is incompatible with the protocol state. </condition> </condition> </control>
<control> Cause #111 Protocol error, unspecified: <action> This ESM cause is used </action> <condition> <condition> to report a protocol error event </condition> <condition> only when no other ESM cause in the protocol error class applies. </condition> </condition> </control>
Annex C (normative): Storage of EMM information
<control> <action> The following EMM parameters shall be stored on the USIM </action> <condition> if the corresponding file is present: a) GUTI; b) last visited registered TAI; c) EPS update status; d) Allowed CSG list; e) Operator CSG list; and f) EPS security context parameters from a full native EPS security context (see 3GPP TS 33.401 ). </condition> </control>
The presence and format of corresponding files on the USIM is specified in 3GPP TS 31.102 .
<control> <condition> If the corresponding file is not present on the USIM, </condition> <action> these EMM parameters except allowed CSG list are stored in a non-volatile memory in the ME together with the IMSI from the USIM. </action> <control> <action> The allowed CSG list is stored in a non-volatile memory in the ME </action> <condition> if the UE supports CSG selection. </condition> </control> <control> <action> These EMM parameters can only be used </action> <condition> if the IMSI from the USIM matches the IMSI stored in the non-volatile memory; </condition> </control> <control> <condition> else </condition> <action> the UE shall delete the EMM parameters. </action> </control> </control>
<control> <action> The TIN parameter can only be used </action> <condition> if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME; </condition> </control> <control> <condition> else </condition> <action> the UE shall delete the TIN parameter. </action> </control>
The DCN-ID list consists of DCN-IDs stored together with a PLMN identity. The list can have zero or more entries and the maximum length shall be at least 32 entries. <control> <condition> When the maximum length is reached </condition> <action> any new entry shall replace the oldest entry in the list. </action> </control> There shall be no duplicated PLMN identities in the list and <control> <action> any existing DCN-ID shall be deleted </action> <condition> when a new DCN-ID is added for the same PLMN. </condition> </control>
<control> <action> The DCN-ID list can only be used </action> <condition> if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME; </condition> </control> <control> <condition> else </condition> <action> the UE shall delete the DCN-ID list. </action> </control> <control> <action> The UE shall delete the stored DCN-ID list </action> <condition> if the default standardized DCN-ID in the UE is changed. </condition> </control>
Each network-assigned UE radio capability ID is stored together with a PLMN identity of the PLMN that provided it as well as a mapping to the corresponding UE radio configuration, and is valid in that PLMN. <control> <action> A network-assigned UE radio capability ID can only be used </action> <condition> if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME, </condition> </control> <control> <condition> else </condition> <action> the UE shall delete the network-assigned UE radio capability ID. </action> </control> <control> <action> The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs. </action> <action> There shall be only one network-assigned UE radio capability ID stored for a given combination of PLMN identity and UE radio configuration </action> and <control> <action> any existing UE radio capability ID shall be deleted </action> <condition> when a new UE radio capability ID is added for the same combination of PLMN identity and UE radio configuration. </condition> </control> </control> <control> <condition> <condition> If the UE receives a network-assigned UE radio capability ID </condition> <condition> with a Version ID value different from the value included in the network-assigned UE radio capability ID(s) stored at the UE for the serving PLMN, </condition> </condition> <action> the UE may delete these stored network-assigned UE radio capability ID(s). </action> </control>
<control> <condition> If the UE is attached for emergency bearer services, </condition> <action> the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. </action> <action> Instead the UE shall temporarily store these parameters locally in the ME </action> and <control> <action> the UE shall delete these parameters </action> <condition> when the UE is detached. </condition> </control> </control>
<control> <condition> If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 , </condition> <action> the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. </action> <action> Instead the UE shall temporarily store these parameters locally in the ME </action> and <control> <action> the UE shall delete these parameters </action> <condition> <condition> when the UE enters EMM- DEREGISTERED.eCALL-INACTIVE state, </condition> <condition> the UE is switched-off </condition> or <condition> the USIM is removed. </condition> </condition> </control> </control>
<control> <condition> If the UE is attached for access to RLOS, </condition> <action> the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. </action> <action> Instead, the UE shall temporarily store these parameters locally in the ME and </action> <control> <action> the UE shall delete these parameters </action> <condition> after detach. </condition> </control> </control>
Annex D (normative): Establishment cause (S1 mode only)
D.1 Mapping of NAS procedure to RRC establishment cause (S1 mode only)
<control> <condition> <condition> When EMM requests the establishment of a NAS-signalling connection, </condition> or <condition> when EMM requests the lower layers to resume a NAS signalling connection, </condition> </condition> <action> the RRC establishment cause used by the UE shall be selected according to the NAS procedure as specified in table D.1.1. </action> <action> The EMM shall also indicate to the lower layer for the purpose of access control, the call type associated with the RRC establishment cause as specified in table D.1.1. </action> <control> <condition> If the UE is configured for EAB (see the "ExtendedAccessBarring" leaf of NAS configuration MO in 3GPP TS 24.368 or 3GPP TS 31.102 ), </condition> <action> the EMM shall indicate to the lower layer for the purpose of access control that EAB applies for this request </action> <condition> except for the following cases: <condition> a) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> <condition> b) the UE is answering to paging; </condition> <condition> c) the RRC Establishment cause is set to "Emergency call"; </condition> <condition> d) <condition> the UE is configured to allow overriding EAB (see the "Override_ExtendedAccessBarring" leaf of the NAS configuration MO as specified in 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> and <condition> receives an indication from the upper layers to override EAB; </condition> </condition> or <condition> e) <condition> the UE is configured to allow overriding EAB (see the "Override_ExtendedAccessBarring" leaf of the NAS configuration MO as specified in 3GPP TS 24.368 or 3GPP TS 31.102 ) </condition> and <condition> already has a PDN connection that was established with EAB override. </condition> </condition> </condition> </control> </control>
Note 1: <control> <condition> For these NAS procedures in WB-S1 mode initiated by UEs of access class 12, 13 or 14 in their home country, </condition> <action> the RRC establishment cause will be set to "High priority access AC 11 15". </action> </control> For this purpose, the home country is defined as the country to which the MCC part of the IMSI is associated, see 3GPP TS 23.122 for the definition of country.
<control> <condition> For these NAS procedures in WB-S1 mode initiated by UE of access class 11 or 15 in their HPLMN (if the EHPLMN list is not present or is empty) or EHPLMN (if the EHPLMN list is present), </condition> <action> the RRC establishment cause will be set to "High priority access AC 11 15". </action> </control>
Note 2: This row is not applicable for mobile terminating 1xCS fallback with 1xCS paging request received over E- UTRAN.
Note 3: <control> <condition> For these NAS procedures, </condition> <action> the lower layers can change the RRC establishment cause from "MO data" or from "MO Signalling" to "MO Voice Call", </action> <condition> if the serving cell requests the UE to use the RRC establishment cause "MO voice call" (see 3GPP TS 36.331 ). </condition> </control>
Note 4: It is an implementation option to initiate attach request carrying a PDN CONNECTIVITY REQUEST with request type "handover of emergency bearer services" to support access transfer of an ongoing emergency session from non-3GPP access to 3GPP access when the UE is not already in EMM- REGISTERED state.
Note 5: <control> <condition> For these NAS procedures, </condition> <action> the lower layers can change the RRC establishment cause from "MO Signalling" to "MO Voice Call" during EPS fallback for IMS voice (see 3GPP TS 36.331 ). </action> </control>
NOTE: The RRC establishment cause can be used by the network to prioritise the connection establishment request from the UE at high load situations in the network.
Annex E (informative): Guidelines for enhancements to MS network capability IE and UE network capability IE
The UE uses the information elements MS network capability and UE network capability to inform the core network about its network related capabilities. Both information elements can be signalled in any of the modes: A/Gb mode, Iu mode and S1 mode.
The purpose of the present annex is to give some guidelines how to select the information element(s) to be enhanced if new capabilities need to be added.
<control> 1) <condition> If a capability is related to a feature that can be used in a network supporting A/Gb mode only or Iu mode only or both, </condition> <action> the capability will be signalled in the MS network capability IE. </action> </control>
<control> 2) <condition> If a capability is related to a feature that can be used in network supporting S1 mode only, </condition> <action> the capability will be signalled in the UE network capability IE. </action> </control>
<control> 3) <condition> If a capability is related to a feature that can be used only in a network supporting both S1 mode and at least one of the two modes A/Gb mode and Iu mode, </condition> <action> the capability is added </action> only to one of the two information elements: <control> a) <condition> If the information is used by the MME only, </condition> <action> the capability will be signalled in the UE network capability IE. </action> </control> <control> b) <condition> If the information is used by the SGSN only or both by the SGSN and by the MME, </condition> <action> the capability will be signalled in the MS network capability IE. </action> </control> </control>
NOTE: The reason for rules 1 and 2 is that a UE not supporting A/Gb mode and Iu mode will not provide the MS network capability IE to the network and a UE not supporting S1 mode will not provide the UE network capability IE. In some cases, due to rules 1 and 2 the capability indicator will be included in both information elements.
EXAMPLE 1: The support indicator for UCS2 is included in both information elements.
EXAMPLE 2: The "SRVCC to GERAN/UTRAN capability" is included in the MS network capability IE, as it is used both by the MME for SRVCC from E-UTRAN to GERAN/UTRAN and by the SGSN for SRVCC from UTRAN HSPA to GERAN/UTRAN.
Annex F (normative): Application specific Congestion control for Data Communication (ACDC)
The UE may support the procedures in this annex.
<control> <condition> If the UE supports ACDC, </condition> <action> the EMM layer shall determine the ACDC category applicable to the request based on the application identifier received from the upper layers and the configuration information in the "ACDCConf" leaf of ACDC MO as specified in 3GPP TS 24.105 or in the USIM EF as specified in 3GPP TS 31.102 . </action> </control>
ACDC NOTE 1: As an implementation option, the upper layers can determine the ACDC category and send it to the EMM layer. Then the EMM layer need not read the ACDC MO or USIM to determine the ACDC category.
<control> <action> The EMM sublayer shall indicate to the lower layers, for the purpose of access control: </action> <control> a) <action> the ACDC category that applies to this request </action> <condition> if only one ACDC category is applicable; </condition> </control> <control> b) <action> the highest ranked ACDC category among the ACDC categories that applies to this request </action> <condition> if multiple ACDC categories are applicable; </condition> </control> or <control> c) <action> this request is for an uncategorized application </action> <condition> <condition> if an application identifier received from the upper layers is not mapped to any ACDC category, </condition> <condition> except for the following cases: <condition> a) the UE is a UE configured to use AC11 15 in selected PLMN; </condition> <condition> b) the UE is answering to paging; </condition> <condition> f) the RRC Establishment cause is set to "Emergency call"; </condition> or <condition> c) if conditions MO MMTEL voice call is started or MO MMTEL video call is started or MO SMSoIP is started, is satisfied. </condition> </condition> </condition> </control> </control>
NOTE 2: The request from the EMM sublayer refers to either a request to establish an initial NAS signalling connection or a request to re-establish a NAS signalling connection.
<control> <condition> <condition> If the UE supports ACDC </condition> and <condition> access is barred because of ACDC, </condition> </condition> <action> the EMM layer shall keep track of the ACDC category for which access is barred </action> and <action> it shall not send a request for the same ACDC category or a lower ACDC category until access is granted. </action> </control>
<control> <condition> <condition> If the UE supports ACDC </condition> and <condition> access is barred because of ACDC, </condition> </condition> <action> the EMM layer shall not send a request for any uncategorized application until access is granted. </action> </control>
